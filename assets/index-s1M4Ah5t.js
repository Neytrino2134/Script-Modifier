(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();function Fx(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Sg={exports:{}},Cl={},Tg={exports:{}},Ct={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $i=Symbol.for("react.element"),zx=Symbol.for("react.portal"),Gx=Symbol.for("react.fragment"),Ux=Symbol.for("react.strict_mode"),Hx=Symbol.for("react.profiler"),Bx=Symbol.for("react.provider"),Vx=Symbol.for("react.context"),$x=Symbol.for("react.forward_ref"),Wx=Symbol.for("react.suspense"),Yx=Symbol.for("react.memo"),qx=Symbol.for("react.lazy"),yp=Symbol.iterator;function Kx(e){return e===null||typeof e!="object"?null:(e=yp&&e[yp]||e["@@iterator"],typeof e=="function"?e:null)}var Eg={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ng=Object.assign,kg={};function Fa(e,t,n){this.props=e,this.context=t,this.refs=kg,this.updater=n||Eg}Fa.prototype.isReactComponent={};Fa.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Fa.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Ag(){}Ag.prototype=Fa.prototype;function Wd(e,t,n){this.props=e,this.context=t,this.refs=kg,this.updater=n||Eg}var Yd=Wd.prototype=new Ag;Yd.constructor=Wd;Ng(Yd,Fa.prototype);Yd.isPureReactComponent=!0;var xp=Array.isArray,Ig=Object.prototype.hasOwnProperty,qd={current:null},Pg={key:!0,ref:!0,__self:!0,__source:!0};function Rg(e,t,n){var r,a={},i=null,s=null;if(t!=null)for(r in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(i=""+t.key),t)Ig.call(t,r)&&!Pg.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(l===1)a.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps,l)a[r]===void 0&&(a[r]=l[r]);return{$$typeof:$i,type:e,key:i,ref:s,props:a,_owner:qd.current}}function Jx(e,t){return{$$typeof:$i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Kd(e){return typeof e=="object"&&e!==null&&e.$$typeof===$i}function Xx(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var vp=/\/+/g;function rc(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Xx(""+e.key):t.toString(36)}function Ps(e,t,n,r,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var s=!1;if(e===null)s=!0;else switch(i){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case $i:case zx:s=!0}}if(s)return s=e,a=a(s),e=r===""?"."+rc(s,0):r,xp(a)?(n="",e!=null&&(n=e.replace(vp,"$&/")+"/"),Ps(a,t,n,"",function(d){return d})):a!=null&&(Kd(a)&&(a=Jx(a,n+(!a.key||s&&s.key===a.key?"":(""+a.key).replace(vp,"$&/")+"/")+e)),t.push(a)),1;if(s=0,r=r===""?".":r+":",xp(e))for(var l=0;l<e.length;l++){i=e[l];var c=r+rc(i,l);s+=Ps(i,t,n,c,a)}else if(c=Kx(e),typeof c=="function")for(e=c.call(e),l=0;!(i=e.next()).done;)i=i.value,c=r+rc(i,l++),s+=Ps(i,t,n,c,a);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function os(e,t,n){if(e==null)return e;var r=[],a=0;return Ps(e,r,"","",function(i){return t.call(n,i,a++)}),r}function Zx(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Vn={current:null},Rs={transition:null},Qx={ReactCurrentDispatcher:Vn,ReactCurrentBatchConfig:Rs,ReactCurrentOwner:qd};function Mg(){throw Error("act(...) is not supported in production builds of React.")}Ct.Children={map:os,forEach:function(e,t,n){os(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return os(e,function(){t++}),t},toArray:function(e){return os(e,function(t){return t})||[]},only:function(e){if(!Kd(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ct.Component=Fa;Ct.Fragment=Gx;Ct.Profiler=Hx;Ct.PureComponent=Wd;Ct.StrictMode=Ux;Ct.Suspense=Wx;Ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qx;Ct.act=Mg;Ct.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Ng({},e.props),a=e.key,i=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,s=qd.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)Ig.call(t,c)&&!Pg.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:$i,type:e.type,key:a,ref:i,props:r,_owner:s}};Ct.createContext=function(e){return e={$$typeof:Vx,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Bx,_context:e},e.Consumer=e};Ct.createElement=Rg;Ct.createFactory=function(e){var t=Rg.bind(null,e);return t.type=e,t};Ct.createRef=function(){return{current:null}};Ct.forwardRef=function(e){return{$$typeof:$x,render:e}};Ct.isValidElement=Kd;Ct.lazy=function(e){return{$$typeof:qx,_payload:{_status:-1,_result:e},_init:Zx}};Ct.memo=function(e,t){return{$$typeof:Yx,type:e,compare:t===void 0?null:t}};Ct.startTransition=function(e){var t=Rs.transition;Rs.transition={};try{e()}finally{Rs.transition=t}};Ct.unstable_act=Mg;Ct.useCallback=function(e,t){return Vn.current.useCallback(e,t)};Ct.useContext=function(e){return Vn.current.useContext(e)};Ct.useDebugValue=function(){};Ct.useDeferredValue=function(e){return Vn.current.useDeferredValue(e)};Ct.useEffect=function(e,t){return Vn.current.useEffect(e,t)};Ct.useId=function(){return Vn.current.useId()};Ct.useImperativeHandle=function(e,t,n){return Vn.current.useImperativeHandle(e,t,n)};Ct.useInsertionEffect=function(e,t){return Vn.current.useInsertionEffect(e,t)};Ct.useLayoutEffect=function(e,t){return Vn.current.useLayoutEffect(e,t)};Ct.useMemo=function(e,t){return Vn.current.useMemo(e,t)};Ct.useReducer=function(e,t,n){return Vn.current.useReducer(e,t,n)};Ct.useRef=function(e){return Vn.current.useRef(e)};Ct.useState=function(e){return Vn.current.useState(e)};Ct.useSyncExternalStore=function(e,t,n){return Vn.current.useSyncExternalStore(e,t,n)};Ct.useTransition=function(){return Vn.current.useTransition()};Ct.version="18.3.1";Tg.exports=Ct;var x=Tg.exports;const _t=Fx(x);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ev=x,tv=Symbol.for("react.element"),nv=Symbol.for("react.fragment"),ov=Object.prototype.hasOwnProperty,rv=ev.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,av={key:!0,ref:!0,__self:!0,__source:!0};function jg(e,t,n){var r,a={},i=null,s=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(s=t.ref);for(r in t)ov.call(t,r)&&!av.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:tv,type:e,key:i,ref:s,props:a,_owner:rv.current}}Cl.Fragment=nv;Cl.jsx=jg;Cl.jsxs=jg;Sg.exports=Cl;var o=Sg.exports,Dc={},Lg={exports:{}},oo={},Dg={exports:{}},Og={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(L,D){var G=L.length;L.push(D);e:for(;0<G;){var q=G-1>>>1,ie=L[q];if(0<a(ie,D))L[q]=D,L[G]=ie,G=q;else break e}}function n(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var D=L[0],G=L.pop();if(G!==D){L[0]=G;e:for(var q=0,ie=L.length,te=ie>>>1;q<te;){var ye=2*(q+1)-1,ue=L[ye],$=ye+1,ee=L[$];if(0>a(ue,G))$<ie&&0>a(ee,ue)?(L[q]=ee,L[$]=G,q=$):(L[q]=ue,L[ye]=G,q=ye);else if($<ie&&0>a(ee,G))L[q]=ee,L[$]=G,q=$;else break e}}return D}function a(L,D){var G=L.sortIndex-D.sortIndex;return G!==0?G:L.id-D.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var s=Date,l=s.now();e.unstable_now=function(){return s.now()-l}}var c=[],d=[],h=1,g=null,m=3,_=!1,y=!1,v=!1,C=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function f(L){for(var D=n(d);D!==null;){if(D.callback===null)r(d);else if(D.startTime<=L)r(d),D.sortIndex=D.expirationTime,t(c,D);else break;D=n(d)}}function T(L){if(v=!1,f(L),!y)if(n(c)!==null)y=!0,U(I);else{var D=n(d);D!==null&&z(T,D.startTime-L)}}function I(L,D){y=!1,v&&(v=!1,w(N),N=-1),_=!0;var G=m;try{for(f(D),g=n(c);g!==null&&(!(g.expirationTime>D)||L&&!P());){var q=g.callback;if(typeof q=="function"){g.callback=null,m=g.priorityLevel;var ie=q(g.expirationTime<=D);D=e.unstable_now(),typeof ie=="function"?g.callback=ie:g===n(c)&&r(c),f(D)}else r(c);g=n(c)}if(g!==null)var te=!0;else{var ye=n(d);ye!==null&&z(T,ye.startTime-D),te=!1}return te}finally{g=null,m=G,_=!1}}var E=!1,R=null,N=-1,A=5,k=-1;function P(){return!(e.unstable_now()-k<A)}function M(){if(R!==null){var L=e.unstable_now();k=L;var D=!0;try{D=R(!0,L)}finally{D?H():(E=!1,R=null)}}else E=!1}var H;if(typeof b=="function")H=function(){b(M)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,O=W.port2;W.port1.onmessage=M,H=function(){O.postMessage(null)}}else H=function(){C(M,0)};function U(L){R=L,E||(E=!0,H())}function z(L,D){N=C(function(){L(e.unstable_now())},D)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(L){L.callback=null},e.unstable_continueExecution=function(){y||_||(y=!0,U(I))},e.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<L?Math.floor(1e3/L):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(L){switch(m){case 1:case 2:case 3:var D=3;break;default:D=m}var G=m;m=D;try{return L()}finally{m=G}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(L,D){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var G=m;m=L;try{return D()}finally{m=G}},e.unstable_scheduleCallback=function(L,D,G){var q=e.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?q+G:q):G=q,L){case 1:var ie=-1;break;case 2:ie=250;break;case 5:ie=1073741823;break;case 4:ie=1e4;break;default:ie=5e3}return ie=G+ie,L={id:h++,callback:D,priorityLevel:L,startTime:G,expirationTime:ie,sortIndex:-1},G>q?(L.sortIndex=G,t(d,L),n(c)===null&&L===n(d)&&(v?(w(N),N=-1):v=!0,z(T,G-q))):(L.sortIndex=ie,t(c,L),y||_||(y=!0,U(I))),L},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(L){var D=m;return function(){var G=m;m=D;try{return L.apply(this,arguments)}finally{m=G}}}})(Og);Dg.exports=Og;var iv=Dg.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sv=x,no=iv;function He(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Fg=new Set,Ni={};function Xr(e,t){Pa(e,t),Pa(e+"Capture",t)}function Pa(e,t){for(Ni[e]=t,e=0;e<t.length;e++)Fg.add(t[e])}var qo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Oc=Object.prototype.hasOwnProperty,lv=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,bp={},wp={};function cv(e){return Oc.call(wp,e)?!0:Oc.call(bp,e)?!1:lv.test(e)?wp[e]=!0:(bp[e]=!0,!1)}function dv(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function uv(e,t,n,r){if(t===null||typeof t>"u"||dv(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function $n(e,t,n,r,a,i,s){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=s}var En={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){En[e]=new $n(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];En[t]=new $n(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){En[e]=new $n(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){En[e]=new $n(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){En[e]=new $n(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){En[e]=new $n(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){En[e]=new $n(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){En[e]=new $n(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){En[e]=new $n(e,5,!1,e.toLowerCase(),null,!1,!1)});var Jd=/[\-:]([a-z])/g;function Xd(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Jd,Xd);En[t]=new $n(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Jd,Xd);En[t]=new $n(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Jd,Xd);En[t]=new $n(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){En[e]=new $n(e,1,!1,e.toLowerCase(),null,!1,!1)});En.xlinkHref=new $n("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){En[e]=new $n(e,1,!1,e.toLowerCase(),null,!0,!0)});function Zd(e,t,n,r){var a=En.hasOwnProperty(t)?En[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(uv(t,n,a,r)&&(n=null),r||a===null?cv(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=n===null?a.type===3?!1:"":n:(t=a.attributeName,r=a.attributeNamespace,n===null?e.removeAttribute(t):(a=a.type,n=a===3||a===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var er=sv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,rs=Symbol.for("react.element"),ca=Symbol.for("react.portal"),da=Symbol.for("react.fragment"),Qd=Symbol.for("react.strict_mode"),Fc=Symbol.for("react.profiler"),zg=Symbol.for("react.provider"),Gg=Symbol.for("react.context"),eu=Symbol.for("react.forward_ref"),zc=Symbol.for("react.suspense"),Gc=Symbol.for("react.suspense_list"),tu=Symbol.for("react.memo"),dr=Symbol.for("react.lazy"),Ug=Symbol.for("react.offscreen"),_p=Symbol.iterator;function ei(e){return e===null||typeof e!="object"?null:(e=_p&&e[_p]||e["@@iterator"],typeof e=="function"?e:null)}var an=Object.assign,ac;function ui(e){if(ac===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);ac=t&&t[1]||""}return`
`+ac+e}var ic=!1;function sc(e,t){if(!e||ic)return"";ic=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var r=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){r=d}e.call(t.prototype)}else{try{throw Error()}catch(d){r=d}e()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var a=d.stack.split(`
`),i=r.stack.split(`
`),s=a.length-1,l=i.length-1;1<=s&&0<=l&&a[s]!==i[l];)l--;for(;1<=s&&0<=l;s--,l--)if(a[s]!==i[l]){if(s!==1||l!==1)do if(s--,l--,0>l||a[s]!==i[l]){var c=`
`+a[s].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=s&&0<=l);break}}}finally{ic=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?ui(e):""}function pv(e){switch(e.tag){case 5:return ui(e.type);case 16:return ui("Lazy");case 13:return ui("Suspense");case 19:return ui("SuspenseList");case 0:case 2:case 15:return e=sc(e.type,!1),e;case 11:return e=sc(e.type.render,!1),e;case 1:return e=sc(e.type,!0),e;default:return""}}function Uc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case da:return"Fragment";case ca:return"Portal";case Fc:return"Profiler";case Qd:return"StrictMode";case zc:return"Suspense";case Gc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Gg:return(e.displayName||"Context")+".Consumer";case zg:return(e._context.displayName||"Context")+".Provider";case eu:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case tu:return t=e.displayName||null,t!==null?t:Uc(e.type)||"Memo";case dr:t=e._payload,e=e._init;try{return Uc(e(t))}catch{}}return null}function hv(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Uc(t);case 8:return t===Qd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Sr(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Hg(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function mv(e){var t=Hg(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(s){r=""+s,i.call(this,s)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function as(e){e._valueTracker||(e._valueTracker=mv(e))}function Bg(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Hg(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function Ws(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Hc(e,t){var n=t.checked;return an({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Cp(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=Sr(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Vg(e,t){t=t.checked,t!=null&&Zd(e,"checked",t,!1)}function Bc(e,t){Vg(e,t);var n=Sr(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Vc(e,t.type,n):t.hasOwnProperty("defaultValue")&&Vc(e,t.type,Sr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Sp(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Vc(e,t,n){(t!=="number"||Ws(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var pi=Array.isArray;function Ca(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Sr(n),t=null,a=0;a<e.length;a++){if(e[a].value===n){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function $c(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(He(91));return an({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Tp(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(He(92));if(pi(n)){if(1<n.length)throw Error(He(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Sr(n)}}function $g(e,t){var n=Sr(t.value),r=Sr(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function Ep(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Wg(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Wc(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Wg(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var is,Yg=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(is=is||document.createElement("div"),is.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=is.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ki(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var fi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},gv=["Webkit","ms","Moz","O"];Object.keys(fi).forEach(function(e){gv.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fi[t]=fi[e]})});function qg(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||fi.hasOwnProperty(e)&&fi[e]?(""+t).trim():t+"px"}function Kg(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,a=qg(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}var fv=an({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Yc(e,t){if(t){if(fv[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(He(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(He(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(He(61))}if(t.style!=null&&typeof t.style!="object")throw Error(He(62))}}function qc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Kc=null;function nu(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Jc=null,Sa=null,Ta=null;function Np(e){if(e=qi(e)){if(typeof Jc!="function")throw Error(He(280));var t=e.stateNode;t&&(t=kl(t),Jc(e.stateNode,e.type,t))}}function Jg(e){Sa?Ta?Ta.push(e):Ta=[e]:Sa=e}function Xg(){if(Sa){var e=Sa,t=Ta;if(Ta=Sa=null,Np(e),t)for(e=0;e<t.length;e++)Np(t[e])}}function Zg(e,t){return e(t)}function Qg(){}var lc=!1;function e0(e,t,n){if(lc)return e(t,n);lc=!0;try{return Zg(e,t,n)}finally{lc=!1,(Sa!==null||Ta!==null)&&(Qg(),Xg())}}function Ai(e,t){var n=e.stateNode;if(n===null)return null;var r=kl(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(He(231,t,typeof n));return n}var Xc=!1;if(qo)try{var ti={};Object.defineProperty(ti,"passive",{get:function(){Xc=!0}}),window.addEventListener("test",ti,ti),window.removeEventListener("test",ti,ti)}catch{Xc=!1}function yv(e,t,n,r,a,i,s,l,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(n,d)}catch(h){this.onError(h)}}var yi=!1,Ys=null,qs=!1,Zc=null,xv={onError:function(e){yi=!0,Ys=e}};function vv(e,t,n,r,a,i,s,l,c){yi=!1,Ys=null,yv.apply(xv,arguments)}function bv(e,t,n,r,a,i,s,l,c){if(vv.apply(this,arguments),yi){if(yi){var d=Ys;yi=!1,Ys=null}else throw Error(He(198));qs||(qs=!0,Zc=d)}}function Zr(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function t0(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function kp(e){if(Zr(e)!==e)throw Error(He(188))}function wv(e){var t=e.alternate;if(!t){if(t=Zr(e),t===null)throw Error(He(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(a===null)break;var i=a.alternate;if(i===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return kp(a),e;if(i===r)return kp(a),t;i=i.sibling}throw Error(He(188))}if(n.return!==r.return)n=a,r=i;else{for(var s=!1,l=a.child;l;){if(l===n){s=!0,n=a,r=i;break}if(l===r){s=!0,r=a,n=i;break}l=l.sibling}if(!s){for(l=i.child;l;){if(l===n){s=!0,n=i,r=a;break}if(l===r){s=!0,r=i,n=a;break}l=l.sibling}if(!s)throw Error(He(189))}}if(n.alternate!==r)throw Error(He(190))}if(n.tag!==3)throw Error(He(188));return n.stateNode.current===n?e:t}function n0(e){return e=wv(e),e!==null?o0(e):null}function o0(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=o0(e);if(t!==null)return t;e=e.sibling}return null}var r0=no.unstable_scheduleCallback,Ap=no.unstable_cancelCallback,_v=no.unstable_shouldYield,Cv=no.unstable_requestPaint,dn=no.unstable_now,Sv=no.unstable_getCurrentPriorityLevel,ou=no.unstable_ImmediatePriority,a0=no.unstable_UserBlockingPriority,Ks=no.unstable_NormalPriority,Tv=no.unstable_LowPriority,i0=no.unstable_IdlePriority,Sl=null,Oo=null;function Ev(e){if(Oo&&typeof Oo.onCommitFiberRoot=="function")try{Oo.onCommitFiberRoot(Sl,e,void 0,(e.current.flags&128)===128)}catch{}}var To=Math.clz32?Math.clz32:Av,Nv=Math.log,kv=Math.LN2;function Av(e){return e>>>=0,e===0?32:31-(Nv(e)/kv|0)|0}var ss=64,ls=4194304;function hi(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Js(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,s=n&268435455;if(s!==0){var l=s&~a;l!==0?r=hi(l):(i&=s,i!==0&&(r=hi(i)))}else s=n&~a,s!==0?r=hi(s):i!==0&&(r=hi(i));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,i=t&-t,a>=i||a===16&&(i&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-To(t),a=1<<n,r|=e[n],t&=~a;return r}function Iv(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Pv(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var s=31-To(i),l=1<<s,c=a[s];c===-1?(!(l&n)||l&r)&&(a[s]=Iv(l,t)):c<=t&&(e.expiredLanes|=l),i&=~l}}function Qc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function s0(){var e=ss;return ss<<=1,!(ss&4194240)&&(ss=64),e}function cc(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Wi(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-To(t),e[t]=n}function Rv(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-To(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}function ru(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-To(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var Ot=0;function l0(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var c0,au,d0,u0,p0,ed=!1,cs=[],fr=null,yr=null,xr=null,Ii=new Map,Pi=new Map,pr=[],Mv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ip(e,t){switch(e){case"focusin":case"focusout":fr=null;break;case"dragenter":case"dragleave":yr=null;break;case"mouseover":case"mouseout":xr=null;break;case"pointerover":case"pointerout":Ii.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pi.delete(t.pointerId)}}function ni(e,t,n,r,a,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},t!==null&&(t=qi(t),t!==null&&au(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function jv(e,t,n,r,a){switch(t){case"focusin":return fr=ni(fr,e,t,n,r,a),!0;case"dragenter":return yr=ni(yr,e,t,n,r,a),!0;case"mouseover":return xr=ni(xr,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Ii.set(i,ni(Ii.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,Pi.set(i,ni(Pi.get(i)||null,e,t,n,r,a)),!0}return!1}function h0(e){var t=Gr(e.target);if(t!==null){var n=Zr(t);if(n!==null){if(t=n.tag,t===13){if(t=t0(n),t!==null){e.blockedOn=t,p0(e.priority,function(){d0(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ms(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=td(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);Kc=r,n.target.dispatchEvent(r),Kc=null}else return t=qi(n),t!==null&&au(t),e.blockedOn=n,!1;t.shift()}return!0}function Pp(e,t,n){Ms(e)&&n.delete(t)}function Lv(){ed=!1,fr!==null&&Ms(fr)&&(fr=null),yr!==null&&Ms(yr)&&(yr=null),xr!==null&&Ms(xr)&&(xr=null),Ii.forEach(Pp),Pi.forEach(Pp)}function oi(e,t){e.blockedOn===t&&(e.blockedOn=null,ed||(ed=!0,no.unstable_scheduleCallback(no.unstable_NormalPriority,Lv)))}function Ri(e){function t(a){return oi(a,e)}if(0<cs.length){oi(cs[0],e);for(var n=1;n<cs.length;n++){var r=cs[n];r.blockedOn===e&&(r.blockedOn=null)}}for(fr!==null&&oi(fr,e),yr!==null&&oi(yr,e),xr!==null&&oi(xr,e),Ii.forEach(t),Pi.forEach(t),n=0;n<pr.length;n++)r=pr[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<pr.length&&(n=pr[0],n.blockedOn===null);)h0(n),n.blockedOn===null&&pr.shift()}var Ea=er.ReactCurrentBatchConfig,Xs=!0;function Dv(e,t,n,r){var a=Ot,i=Ea.transition;Ea.transition=null;try{Ot=1,iu(e,t,n,r)}finally{Ot=a,Ea.transition=i}}function Ov(e,t,n,r){var a=Ot,i=Ea.transition;Ea.transition=null;try{Ot=4,iu(e,t,n,r)}finally{Ot=a,Ea.transition=i}}function iu(e,t,n,r){if(Xs){var a=td(e,t,n,r);if(a===null)vc(e,t,r,Zs,n),Ip(e,r);else if(jv(a,e,t,n,r))r.stopPropagation();else if(Ip(e,r),t&4&&-1<Mv.indexOf(e)){for(;a!==null;){var i=qi(a);if(i!==null&&c0(i),i=td(e,t,n,r),i===null&&vc(e,t,r,Zs,n),i===a)break;a=i}a!==null&&r.stopPropagation()}else vc(e,t,r,null,n)}}var Zs=null;function td(e,t,n,r){if(Zs=null,e=nu(r),e=Gr(e),e!==null)if(t=Zr(e),t===null)e=null;else if(n=t.tag,n===13){if(e=t0(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Zs=e,null}function m0(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Sv()){case ou:return 1;case a0:return 4;case Ks:case Tv:return 16;case i0:return 536870912;default:return 16}default:return 16}}var mr=null,su=null,js=null;function g0(){if(js)return js;var e,t=su,n=t.length,r,a="value"in mr?mr.value:mr.textContent,i=a.length;for(e=0;e<n&&t[e]===a[e];e++);var s=n-e;for(r=1;r<=s&&t[n-r]===a[i-r];r++);return js=a.slice(e,1<r?1-r:void 0)}function Ls(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function ds(){return!0}function Rp(){return!1}function ro(e){function t(n,r,a,i,s){this._reactName=n,this._targetInst=a,this.type=r,this.nativeEvent=i,this.target=s,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?ds:Rp,this.isPropagationStopped=Rp,this}return an(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=ds)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=ds)},persist:function(){},isPersistent:ds}),t}var za={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lu=ro(za),Yi=an({},za,{view:0,detail:0}),Fv=ro(Yi),dc,uc,ri,Tl=an({},Yi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:cu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ri&&(ri&&e.type==="mousemove"?(dc=e.screenX-ri.screenX,uc=e.screenY-ri.screenY):uc=dc=0,ri=e),dc)},movementY:function(e){return"movementY"in e?e.movementY:uc}}),Mp=ro(Tl),zv=an({},Tl,{dataTransfer:0}),Gv=ro(zv),Uv=an({},Yi,{relatedTarget:0}),pc=ro(Uv),Hv=an({},za,{animationName:0,elapsedTime:0,pseudoElement:0}),Bv=ro(Hv),Vv=an({},za,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),$v=ro(Vv),Wv=an({},za,{data:0}),jp=ro(Wv),Yv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Kv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Jv(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Kv[e])?!!t[e]:!1}function cu(){return Jv}var Xv=an({},Yi,{key:function(e){if(e.key){var t=Yv[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Ls(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?qv[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:cu,charCode:function(e){return e.type==="keypress"?Ls(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Ls(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Zv=ro(Xv),Qv=an({},Tl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Lp=ro(Qv),e2=an({},Yi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:cu}),t2=ro(e2),n2=an({},za,{propertyName:0,elapsedTime:0,pseudoElement:0}),o2=ro(n2),r2=an({},Tl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),a2=ro(r2),i2=[9,13,27,32],du=qo&&"CompositionEvent"in window,xi=null;qo&&"documentMode"in document&&(xi=document.documentMode);var s2=qo&&"TextEvent"in window&&!xi,f0=qo&&(!du||xi&&8<xi&&11>=xi),Dp=" ",Op=!1;function y0(e,t){switch(e){case"keyup":return i2.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function x0(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ua=!1;function l2(e,t){switch(e){case"compositionend":return x0(t);case"keypress":return t.which!==32?null:(Op=!0,Dp);case"textInput":return e=t.data,e===Dp&&Op?null:e;default:return null}}function c2(e,t){if(ua)return e==="compositionend"||!du&&y0(e,t)?(e=g0(),js=su=mr=null,ua=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return f0&&t.locale!=="ko"?null:t.data;default:return null}}var d2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Fp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!d2[e.type]:t==="textarea"}function v0(e,t,n,r){Jg(r),t=Qs(t,"onChange"),0<t.length&&(n=new lu("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var vi=null,Mi=null;function u2(e){I0(e,0)}function El(e){var t=ma(e);if(Bg(t))return e}function p2(e,t){if(e==="change")return t}var b0=!1;if(qo){var hc;if(qo){var mc="oninput"in document;if(!mc){var zp=document.createElement("div");zp.setAttribute("oninput","return;"),mc=typeof zp.oninput=="function"}hc=mc}else hc=!1;b0=hc&&(!document.documentMode||9<document.documentMode)}function Gp(){vi&&(vi.detachEvent("onpropertychange",w0),Mi=vi=null)}function w0(e){if(e.propertyName==="value"&&El(Mi)){var t=[];v0(t,Mi,e,nu(e)),e0(u2,t)}}function h2(e,t,n){e==="focusin"?(Gp(),vi=t,Mi=n,vi.attachEvent("onpropertychange",w0)):e==="focusout"&&Gp()}function m2(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return El(Mi)}function g2(e,t){if(e==="click")return El(t)}function f2(e,t){if(e==="input"||e==="change")return El(t)}function y2(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ao=typeof Object.is=="function"?Object.is:y2;function ji(e,t){if(Ao(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!Oc.call(t,a)||!Ao(e[a],t[a]))return!1}return!0}function Up(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Hp(e,t){var n=Up(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Up(n)}}function _0(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?_0(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function C0(){for(var e=window,t=Ws();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Ws(e.document)}return t}function uu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function x2(e){var t=C0(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&_0(n.ownerDocument.documentElement,n)){if(r!==null&&uu(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=r.end===void 0?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=Hp(n,i);var s=Hp(n,r);a&&s&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var v2=qo&&"documentMode"in document&&11>=document.documentMode,pa=null,nd=null,bi=null,od=!1;function Bp(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;od||pa==null||pa!==Ws(r)||(r=pa,"selectionStart"in r&&uu(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),bi&&ji(bi,r)||(bi=r,r=Qs(nd,"onSelect"),0<r.length&&(t=new lu("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=pa)))}function us(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ha={animationend:us("Animation","AnimationEnd"),animationiteration:us("Animation","AnimationIteration"),animationstart:us("Animation","AnimationStart"),transitionend:us("Transition","TransitionEnd")},gc={},S0={};qo&&(S0=document.createElement("div").style,"AnimationEvent"in window||(delete ha.animationend.animation,delete ha.animationiteration.animation,delete ha.animationstart.animation),"TransitionEvent"in window||delete ha.transitionend.transition);function Nl(e){if(gc[e])return gc[e];if(!ha[e])return e;var t=ha[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in S0)return gc[e]=t[n];return e}var T0=Nl("animationend"),E0=Nl("animationiteration"),N0=Nl("animationstart"),k0=Nl("transitionend"),A0=new Map,Vp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Er(e,t){A0.set(e,t),Xr(t,[e])}for(var fc=0;fc<Vp.length;fc++){var yc=Vp[fc],b2=yc.toLowerCase(),w2=yc[0].toUpperCase()+yc.slice(1);Er(b2,"on"+w2)}Er(T0,"onAnimationEnd");Er(E0,"onAnimationIteration");Er(N0,"onAnimationStart");Er("dblclick","onDoubleClick");Er("focusin","onFocus");Er("focusout","onBlur");Er(k0,"onTransitionEnd");Pa("onMouseEnter",["mouseout","mouseover"]);Pa("onMouseLeave",["mouseout","mouseover"]);Pa("onPointerEnter",["pointerout","pointerover"]);Pa("onPointerLeave",["pointerout","pointerover"]);Xr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Xr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Xr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Xr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Xr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Xr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_2=new Set("cancel close invalid load scroll toggle".split(" ").concat(mi));function $p(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,bv(r,t,void 0,e),e.currentTarget=null}function I0(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var s=r.length-1;0<=s;s--){var l=r[s],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&a.isPropagationStopped())break e;$p(a,l,d),i=c}else for(s=0;s<r.length;s++){if(l=r[s],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&a.isPropagationStopped())break e;$p(a,l,d),i=c}}}if(qs)throw e=Zc,qs=!1,Zc=null,e}function Jt(e,t){var n=t[ld];n===void 0&&(n=t[ld]=new Set);var r=e+"__bubble";n.has(r)||(P0(t,e,2,!1),n.add(r))}function xc(e,t,n){var r=0;t&&(r|=4),P0(n,e,r,t)}var ps="_reactListening"+Math.random().toString(36).slice(2);function Li(e){if(!e[ps]){e[ps]=!0,Fg.forEach(function(n){n!=="selectionchange"&&(_2.has(n)||xc(n,!1,e),xc(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[ps]||(t[ps]=!0,xc("selectionchange",!1,t))}}function P0(e,t,n,r){switch(m0(t)){case 1:var a=Dv;break;case 4:a=Ov;break;default:a=iu}n=a.bind(null,t,n,e),a=void 0,!Xc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):a!==void 0?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function vc(e,t,n,r,a){var i=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var l=r.stateNode.containerInfo;if(l===a||l.nodeType===8&&l.parentNode===a)break;if(s===4)for(s=r.return;s!==null;){var c=s.tag;if((c===3||c===4)&&(c=s.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;s=s.return}for(;l!==null;){if(s=Gr(l),s===null)return;if(c=s.tag,c===5||c===6){r=i=s;continue e}l=l.parentNode}}r=r.return}e0(function(){var d=i,h=nu(n),g=[];e:{var m=A0.get(e);if(m!==void 0){var _=lu,y=e;switch(e){case"keypress":if(Ls(n)===0)break e;case"keydown":case"keyup":_=Zv;break;case"focusin":y="focus",_=pc;break;case"focusout":y="blur",_=pc;break;case"beforeblur":case"afterblur":_=pc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_=Mp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_=Gv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_=t2;break;case T0:case E0:case N0:_=Bv;break;case k0:_=o2;break;case"scroll":_=Fv;break;case"wheel":_=a2;break;case"copy":case"cut":case"paste":_=$v;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_=Lp}var v=(t&4)!==0,C=!v&&e==="scroll",w=v?m!==null?m+"Capture":null:m;v=[];for(var b=d,f;b!==null;){f=b;var T=f.stateNode;if(f.tag===5&&T!==null&&(f=T,w!==null&&(T=Ai(b,w),T!=null&&v.push(Di(b,T,f)))),C)break;b=b.return}0<v.length&&(m=new _(m,y,null,n,h),g.push({event:m,listeners:v}))}}if(!(t&7)){e:{if(m=e==="mouseover"||e==="pointerover",_=e==="mouseout"||e==="pointerout",m&&n!==Kc&&(y=n.relatedTarget||n.fromElement)&&(Gr(y)||y[Ko]))break e;if((_||m)&&(m=h.window===h?h:(m=h.ownerDocument)?m.defaultView||m.parentWindow:window,_?(y=n.relatedTarget||n.toElement,_=d,y=y?Gr(y):null,y!==null&&(C=Zr(y),y!==C||y.tag!==5&&y.tag!==6)&&(y=null)):(_=null,y=d),_!==y)){if(v=Mp,T="onMouseLeave",w="onMouseEnter",b="mouse",(e==="pointerout"||e==="pointerover")&&(v=Lp,T="onPointerLeave",w="onPointerEnter",b="pointer"),C=_==null?m:ma(_),f=y==null?m:ma(y),m=new v(T,b+"leave",_,n,h),m.target=C,m.relatedTarget=f,T=null,Gr(h)===d&&(v=new v(w,b+"enter",y,n,h),v.target=f,v.relatedTarget=C,T=v),C=T,_&&y)t:{for(v=_,w=y,b=0,f=v;f;f=na(f))b++;for(f=0,T=w;T;T=na(T))f++;for(;0<b-f;)v=na(v),b--;for(;0<f-b;)w=na(w),f--;for(;b--;){if(v===w||w!==null&&v===w.alternate)break t;v=na(v),w=na(w)}v=null}else v=null;_!==null&&Wp(g,m,_,v,!1),y!==null&&C!==null&&Wp(g,C,y,v,!0)}}e:{if(m=d?ma(d):window,_=m.nodeName&&m.nodeName.toLowerCase(),_==="select"||_==="input"&&m.type==="file")var I=p2;else if(Fp(m))if(b0)I=f2;else{I=m2;var E=h2}else(_=m.nodeName)&&_.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(I=g2);if(I&&(I=I(e,d))){v0(g,I,n,h);break e}E&&E(e,m,d),e==="focusout"&&(E=m._wrapperState)&&E.controlled&&m.type==="number"&&Vc(m,"number",m.value)}switch(E=d?ma(d):window,e){case"focusin":(Fp(E)||E.contentEditable==="true")&&(pa=E,nd=d,bi=null);break;case"focusout":bi=nd=pa=null;break;case"mousedown":od=!0;break;case"contextmenu":case"mouseup":case"dragend":od=!1,Bp(g,n,h);break;case"selectionchange":if(v2)break;case"keydown":case"keyup":Bp(g,n,h)}var R;if(du)e:{switch(e){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else ua?y0(e,n)&&(N="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(N="onCompositionStart");N&&(f0&&n.locale!=="ko"&&(ua||N!=="onCompositionStart"?N==="onCompositionEnd"&&ua&&(R=g0()):(mr=h,su="value"in mr?mr.value:mr.textContent,ua=!0)),E=Qs(d,N),0<E.length&&(N=new jp(N,e,null,n,h),g.push({event:N,listeners:E}),R?N.data=R:(R=x0(n),R!==null&&(N.data=R)))),(R=s2?l2(e,n):c2(e,n))&&(d=Qs(d,"onBeforeInput"),0<d.length&&(h=new jp("onBeforeInput","beforeinput",null,n,h),g.push({event:h,listeners:d}),h.data=R))}I0(g,t)})}function Di(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Qs(e,t){for(var n=t+"Capture",r=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=Ai(e,n),i!=null&&r.unshift(Di(e,i,a)),i=Ai(e,t),i!=null&&r.push(Di(e,i,a))),e=e.return}return r}function na(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Wp(e,t,n,r,a){for(var i=t._reactName,s=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,a?(c=Ai(n,i),c!=null&&s.unshift(Di(n,c,l))):a||(c=Ai(n,i),c!=null&&s.push(Di(n,c,l)))),n=n.return}s.length!==0&&e.push({event:t,listeners:s})}var C2=/\r\n?/g,S2=/\u0000|\uFFFD/g;function Yp(e){return(typeof e=="string"?e:""+e).replace(C2,`
`).replace(S2,"")}function hs(e,t,n){if(t=Yp(t),Yp(e)!==t&&n)throw Error(He(425))}function el(){}var rd=null,ad=null;function id(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var sd=typeof setTimeout=="function"?setTimeout:void 0,T2=typeof clearTimeout=="function"?clearTimeout:void 0,qp=typeof Promise=="function"?Promise:void 0,E2=typeof queueMicrotask=="function"?queueMicrotask:typeof qp<"u"?function(e){return qp.resolve(null).then(e).catch(N2)}:sd;function N2(e){setTimeout(function(){throw e})}function bc(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"){if(r===0){e.removeChild(a),Ri(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=a}while(n);Ri(t)}function vr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Kp(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Ga=Math.random().toString(36).slice(2),Do="__reactFiber$"+Ga,Oi="__reactProps$"+Ga,Ko="__reactContainer$"+Ga,ld="__reactEvents$"+Ga,k2="__reactListeners$"+Ga,A2="__reactHandles$"+Ga;function Gr(e){var t=e[Do];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ko]||n[Do]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Kp(e);e!==null;){if(n=e[Do])return n;e=Kp(e)}return t}e=n,n=e.parentNode}return null}function qi(e){return e=e[Do]||e[Ko],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ma(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(He(33))}function kl(e){return e[Oi]||null}var cd=[],ga=-1;function Nr(e){return{current:e}}function Xt(e){0>ga||(e.current=cd[ga],cd[ga]=null,ga--)}function Wt(e,t){ga++,cd[ga]=e.current,e.current=t}var Tr={},Dn=Nr(Tr),Kn=Nr(!1),$r=Tr;function Ra(e,t){var n=e.type.contextTypes;if(!n)return Tr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in n)a[i]=t[i];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Jn(e){return e=e.childContextTypes,e!=null}function tl(){Xt(Kn),Xt(Dn)}function Jp(e,t,n){if(Dn.current!==Tr)throw Error(He(168));Wt(Dn,t),Wt(Kn,n)}function R0(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(He(108,hv(e)||"Unknown",a));return an({},n,r)}function nl(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Tr,$r=Dn.current,Wt(Dn,e),Wt(Kn,Kn.current),!0}function Xp(e,t,n){var r=e.stateNode;if(!r)throw Error(He(169));n?(e=R0(e,t,$r),r.__reactInternalMemoizedMergedChildContext=e,Xt(Kn),Xt(Dn),Wt(Dn,e)):Xt(Kn),Wt(Kn,n)}var Ho=null,Al=!1,wc=!1;function M0(e){Ho===null?Ho=[e]:Ho.push(e)}function I2(e){Al=!0,M0(e)}function kr(){if(!wc&&Ho!==null){wc=!0;var e=0,t=Ot;try{var n=Ho;for(Ot=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}Ho=null,Al=!1}catch(a){throw Ho!==null&&(Ho=Ho.slice(e+1)),r0(ou,kr),a}finally{Ot=t,wc=!1}}return null}var fa=[],ya=0,ol=null,rl=0,lo=[],co=0,Wr=null,Vo=1,$o="";function Dr(e,t){fa[ya++]=rl,fa[ya++]=ol,ol=e,rl=t}function j0(e,t,n){lo[co++]=Vo,lo[co++]=$o,lo[co++]=Wr,Wr=e;var r=Vo;e=$o;var a=32-To(r)-1;r&=~(1<<a),n+=1;var i=32-To(t)+a;if(30<i){var s=a-a%5;i=(r&(1<<s)-1).toString(32),r>>=s,a-=s,Vo=1<<32-To(t)+a|n<<a|r,$o=i+e}else Vo=1<<i|n<<a|r,$o=e}function pu(e){e.return!==null&&(Dr(e,1),j0(e,1,0))}function hu(e){for(;e===ol;)ol=fa[--ya],fa[ya]=null,rl=fa[--ya],fa[ya]=null;for(;e===Wr;)Wr=lo[--co],lo[co]=null,$o=lo[--co],lo[co]=null,Vo=lo[--co],lo[co]=null}var to=null,eo=null,Qt=!1,So=null;function L0(e,t){var n=uo(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Zp(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,to=e,eo=vr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,to=e,eo=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Wr!==null?{id:Vo,overflow:$o}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=uo(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,to=e,eo=null,!0):!1;default:return!1}}function dd(e){return(e.mode&1)!==0&&(e.flags&128)===0}function ud(e){if(Qt){var t=eo;if(t){var n=t;if(!Zp(e,t)){if(dd(e))throw Error(He(418));t=vr(n.nextSibling);var r=to;t&&Zp(e,t)?L0(r,n):(e.flags=e.flags&-4097|2,Qt=!1,to=e)}}else{if(dd(e))throw Error(He(418));e.flags=e.flags&-4097|2,Qt=!1,to=e}}}function Qp(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;to=e}function ms(e){if(e!==to)return!1;if(!Qt)return Qp(e),Qt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!id(e.type,e.memoizedProps)),t&&(t=eo)){if(dd(e))throw D0(),Error(He(418));for(;t;)L0(e,t),t=vr(t.nextSibling)}if(Qp(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(He(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){eo=vr(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}eo=null}}else eo=to?vr(e.stateNode.nextSibling):null;return!0}function D0(){for(var e=eo;e;)e=vr(e.nextSibling)}function Ma(){eo=to=null,Qt=!1}function mu(e){So===null?So=[e]:So.push(e)}var P2=er.ReactCurrentBatchConfig;function ai(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(He(309));var r=n.stateNode}if(!r)throw Error(He(147,e));var a=r,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(s){var l=a.refs;s===null?delete l[i]:l[i]=s},t._stringRef=i,t)}if(typeof e!="string")throw Error(He(284));if(!n._owner)throw Error(He(290,e))}return e}function gs(e,t){throw e=Object.prototype.toString.call(t),Error(He(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function eh(e){var t=e._init;return t(e._payload)}function O0(e){function t(w,b){if(e){var f=w.deletions;f===null?(w.deletions=[b],w.flags|=16):f.push(b)}}function n(w,b){if(!e)return null;for(;b!==null;)t(w,b),b=b.sibling;return null}function r(w,b){for(w=new Map;b!==null;)b.key!==null?w.set(b.key,b):w.set(b.index,b),b=b.sibling;return w}function a(w,b){return w=Cr(w,b),w.index=0,w.sibling=null,w}function i(w,b,f){return w.index=f,e?(f=w.alternate,f!==null?(f=f.index,f<b?(w.flags|=2,b):f):(w.flags|=2,b)):(w.flags|=1048576,b)}function s(w){return e&&w.alternate===null&&(w.flags|=2),w}function l(w,b,f,T){return b===null||b.tag!==6?(b=kc(f,w.mode,T),b.return=w,b):(b=a(b,f),b.return=w,b)}function c(w,b,f,T){var I=f.type;return I===da?h(w,b,f.props.children,T,f.key):b!==null&&(b.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===dr&&eh(I)===b.type)?(T=a(b,f.props),T.ref=ai(w,b,f),T.return=w,T):(T=Hs(f.type,f.key,f.props,null,w.mode,T),T.ref=ai(w,b,f),T.return=w,T)}function d(w,b,f,T){return b===null||b.tag!==4||b.stateNode.containerInfo!==f.containerInfo||b.stateNode.implementation!==f.implementation?(b=Ac(f,w.mode,T),b.return=w,b):(b=a(b,f.children||[]),b.return=w,b)}function h(w,b,f,T,I){return b===null||b.tag!==7?(b=Vr(f,w.mode,T,I),b.return=w,b):(b=a(b,f),b.return=w,b)}function g(w,b,f){if(typeof b=="string"&&b!==""||typeof b=="number")return b=kc(""+b,w.mode,f),b.return=w,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case rs:return f=Hs(b.type,b.key,b.props,null,w.mode,f),f.ref=ai(w,null,b),f.return=w,f;case ca:return b=Ac(b,w.mode,f),b.return=w,b;case dr:var T=b._init;return g(w,T(b._payload),f)}if(pi(b)||ei(b))return b=Vr(b,w.mode,f,null),b.return=w,b;gs(w,b)}return null}function m(w,b,f,T){var I=b!==null?b.key:null;if(typeof f=="string"&&f!==""||typeof f=="number")return I!==null?null:l(w,b,""+f,T);if(typeof f=="object"&&f!==null){switch(f.$$typeof){case rs:return f.key===I?c(w,b,f,T):null;case ca:return f.key===I?d(w,b,f,T):null;case dr:return I=f._init,m(w,b,I(f._payload),T)}if(pi(f)||ei(f))return I!==null?null:h(w,b,f,T,null);gs(w,f)}return null}function _(w,b,f,T,I){if(typeof T=="string"&&T!==""||typeof T=="number")return w=w.get(f)||null,l(b,w,""+T,I);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case rs:return w=w.get(T.key===null?f:T.key)||null,c(b,w,T,I);case ca:return w=w.get(T.key===null?f:T.key)||null,d(b,w,T,I);case dr:var E=T._init;return _(w,b,f,E(T._payload),I)}if(pi(T)||ei(T))return w=w.get(f)||null,h(b,w,T,I,null);gs(b,T)}return null}function y(w,b,f,T){for(var I=null,E=null,R=b,N=b=0,A=null;R!==null&&N<f.length;N++){R.index>N?(A=R,R=null):A=R.sibling;var k=m(w,R,f[N],T);if(k===null){R===null&&(R=A);break}e&&R&&k.alternate===null&&t(w,R),b=i(k,b,N),E===null?I=k:E.sibling=k,E=k,R=A}if(N===f.length)return n(w,R),Qt&&Dr(w,N),I;if(R===null){for(;N<f.length;N++)R=g(w,f[N],T),R!==null&&(b=i(R,b,N),E===null?I=R:E.sibling=R,E=R);return Qt&&Dr(w,N),I}for(R=r(w,R);N<f.length;N++)A=_(R,w,N,f[N],T),A!==null&&(e&&A.alternate!==null&&R.delete(A.key===null?N:A.key),b=i(A,b,N),E===null?I=A:E.sibling=A,E=A);return e&&R.forEach(function(P){return t(w,P)}),Qt&&Dr(w,N),I}function v(w,b,f,T){var I=ei(f);if(typeof I!="function")throw Error(He(150));if(f=I.call(f),f==null)throw Error(He(151));for(var E=I=null,R=b,N=b=0,A=null,k=f.next();R!==null&&!k.done;N++,k=f.next()){R.index>N?(A=R,R=null):A=R.sibling;var P=m(w,R,k.value,T);if(P===null){R===null&&(R=A);break}e&&R&&P.alternate===null&&t(w,R),b=i(P,b,N),E===null?I=P:E.sibling=P,E=P,R=A}if(k.done)return n(w,R),Qt&&Dr(w,N),I;if(R===null){for(;!k.done;N++,k=f.next())k=g(w,k.value,T),k!==null&&(b=i(k,b,N),E===null?I=k:E.sibling=k,E=k);return Qt&&Dr(w,N),I}for(R=r(w,R);!k.done;N++,k=f.next())k=_(R,w,N,k.value,T),k!==null&&(e&&k.alternate!==null&&R.delete(k.key===null?N:k.key),b=i(k,b,N),E===null?I=k:E.sibling=k,E=k);return e&&R.forEach(function(M){return t(w,M)}),Qt&&Dr(w,N),I}function C(w,b,f,T){if(typeof f=="object"&&f!==null&&f.type===da&&f.key===null&&(f=f.props.children),typeof f=="object"&&f!==null){switch(f.$$typeof){case rs:e:{for(var I=f.key,E=b;E!==null;){if(E.key===I){if(I=f.type,I===da){if(E.tag===7){n(w,E.sibling),b=a(E,f.props.children),b.return=w,w=b;break e}}else if(E.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===dr&&eh(I)===E.type){n(w,E.sibling),b=a(E,f.props),b.ref=ai(w,E,f),b.return=w,w=b;break e}n(w,E);break}else t(w,E);E=E.sibling}f.type===da?(b=Vr(f.props.children,w.mode,T,f.key),b.return=w,w=b):(T=Hs(f.type,f.key,f.props,null,w.mode,T),T.ref=ai(w,b,f),T.return=w,w=T)}return s(w);case ca:e:{for(E=f.key;b!==null;){if(b.key===E)if(b.tag===4&&b.stateNode.containerInfo===f.containerInfo&&b.stateNode.implementation===f.implementation){n(w,b.sibling),b=a(b,f.children||[]),b.return=w,w=b;break e}else{n(w,b);break}else t(w,b);b=b.sibling}b=Ac(f,w.mode,T),b.return=w,w=b}return s(w);case dr:return E=f._init,C(w,b,E(f._payload),T)}if(pi(f))return y(w,b,f,T);if(ei(f))return v(w,b,f,T);gs(w,f)}return typeof f=="string"&&f!==""||typeof f=="number"?(f=""+f,b!==null&&b.tag===6?(n(w,b.sibling),b=a(b,f),b.return=w,w=b):(n(w,b),b=kc(f,w.mode,T),b.return=w,w=b),s(w)):n(w,b)}return C}var ja=O0(!0),F0=O0(!1),al=Nr(null),il=null,xa=null,gu=null;function fu(){gu=xa=il=null}function yu(e){var t=al.current;Xt(al),e._currentValue=t}function pd(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Na(e,t){il=e,gu=xa=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(qn=!0),e.firstContext=null)}function mo(e){var t=e._currentValue;if(gu!==e)if(e={context:e,memoizedValue:t,next:null},xa===null){if(il===null)throw Error(He(308));xa=e,il.dependencies={lanes:0,firstContext:e}}else xa=xa.next=e;return t}var Ur=null;function xu(e){Ur===null?Ur=[e]:Ur.push(e)}function z0(e,t,n,r){var a=t.interleaved;return a===null?(n.next=n,xu(t)):(n.next=a.next,a.next=n),t.interleaved=n,Jo(e,r)}function Jo(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var ur=!1;function vu(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function G0(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Yo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function br(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Tt&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Jo(e,n)}return a=r.interleaved,a===null?(t.next=t,xu(r)):(t.next=a.next,a.next=t),r.interleaved=t,Jo(e,n)}function Ds(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,ru(e,n)}}function th(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var a=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?a=i=s:i=i.next=s,n=n.next}while(n!==null);i===null?a=i=t:i=i.next=t}else a=i=t;n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function sl(e,t,n,r){var a=e.updateQueue;ur=!1;var i=a.firstBaseUpdate,s=a.lastBaseUpdate,l=a.shared.pending;if(l!==null){a.shared.pending=null;var c=l,d=c.next;c.next=null,s===null?i=d:s.next=d,s=c;var h=e.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==s&&(l===null?h.firstBaseUpdate=d:l.next=d,h.lastBaseUpdate=c))}if(i!==null){var g=a.baseState;s=0,h=d=c=null,l=i;do{var m=l.lane,_=l.eventTime;if((r&m)===m){h!==null&&(h=h.next={eventTime:_,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var y=e,v=l;switch(m=t,_=n,v.tag){case 1:if(y=v.payload,typeof y=="function"){g=y.call(_,g,m);break e}g=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=v.payload,m=typeof y=="function"?y.call(_,g,m):y,m==null)break e;g=an({},g,m);break e;case 2:ur=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,m=a.effects,m===null?a.effects=[l]:m.push(l))}else _={eventTime:_,lane:m,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(d=h=_,c=g):h=h.next=_,s|=m;if(l=l.next,l===null){if(l=a.shared.pending,l===null)break;m=l,l=m.next,m.next=null,a.lastBaseUpdate=m,a.shared.pending=null}}while(!0);if(h===null&&(c=g),a.baseState=c,a.firstBaseUpdate=d,a.lastBaseUpdate=h,t=a.shared.interleaved,t!==null){a=t;do s|=a.lane,a=a.next;while(a!==t)}else i===null&&(a.shared.lanes=0);qr|=s,e.lanes=s,e.memoizedState=g}}function nh(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=n,typeof a!="function")throw Error(He(191,a));a.call(r)}}}var Ki={},Fo=Nr(Ki),Fi=Nr(Ki),zi=Nr(Ki);function Hr(e){if(e===Ki)throw Error(He(174));return e}function bu(e,t){switch(Wt(zi,t),Wt(Fi,e),Wt(Fo,Ki),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Wc(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Wc(t,e)}Xt(Fo),Wt(Fo,t)}function La(){Xt(Fo),Xt(Fi),Xt(zi)}function U0(e){Hr(zi.current);var t=Hr(Fo.current),n=Wc(t,e.type);t!==n&&(Wt(Fi,e),Wt(Fo,n))}function wu(e){Fi.current===e&&(Xt(Fo),Xt(Fi))}var on=Nr(0);function ll(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var _c=[];function _u(){for(var e=0;e<_c.length;e++)_c[e]._workInProgressVersionPrimary=null;_c.length=0}var Os=er.ReactCurrentDispatcher,Cc=er.ReactCurrentBatchConfig,Yr=0,rn=null,fn=null,bn=null,cl=!1,wi=!1,Gi=0,R2=0;function kn(){throw Error(He(321))}function Cu(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Ao(e[n],t[n]))return!1;return!0}function Su(e,t,n,r,a,i){if(Yr=i,rn=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Os.current=e===null||e.memoizedState===null?D2:O2,e=n(r,a),wi){i=0;do{if(wi=!1,Gi=0,25<=i)throw Error(He(301));i+=1,bn=fn=null,t.updateQueue=null,Os.current=F2,e=n(r,a)}while(wi)}if(Os.current=dl,t=fn!==null&&fn.next!==null,Yr=0,bn=fn=rn=null,cl=!1,t)throw Error(He(300));return e}function Tu(){var e=Gi!==0;return Gi=0,e}function Lo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bn===null?rn.memoizedState=bn=e:bn=bn.next=e,bn}function go(){if(fn===null){var e=rn.alternate;e=e!==null?e.memoizedState:null}else e=fn.next;var t=bn===null?rn.memoizedState:bn.next;if(t!==null)bn=t,fn=e;else{if(e===null)throw Error(He(310));fn=e,e={memoizedState:fn.memoizedState,baseState:fn.baseState,baseQueue:fn.baseQueue,queue:fn.queue,next:null},bn===null?rn.memoizedState=bn=e:bn=bn.next=e}return bn}function Ui(e,t){return typeof t=="function"?t(e):t}function Sc(e){var t=go(),n=t.queue;if(n===null)throw Error(He(311));n.lastRenderedReducer=e;var r=fn,a=r.baseQueue,i=n.pending;if(i!==null){if(a!==null){var s=a.next;a.next=i.next,i.next=s}r.baseQueue=a=i,n.pending=null}if(a!==null){i=a.next,r=r.baseState;var l=s=null,c=null,d=i;do{var h=d.lane;if((Yr&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var g={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=g,s=r):c=c.next=g,rn.lanes|=h,qr|=h}d=d.next}while(d!==null&&d!==i);c===null?s=r:c.next=l,Ao(r,t.memoizedState)||(qn=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(e=n.interleaved,e!==null){a=e;do i=a.lane,rn.lanes|=i,qr|=i,a=a.next;while(a!==e)}else a===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Tc(e){var t=go(),n=t.queue;if(n===null)throw Error(He(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,i=t.memoizedState;if(a!==null){n.pending=null;var s=a=a.next;do i=e(i,s.action),s=s.next;while(s!==a);Ao(i,t.memoizedState)||(qn=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function H0(){}function B0(e,t){var n=rn,r=go(),a=t(),i=!Ao(r.memoizedState,a);if(i&&(r.memoizedState=a,qn=!0),r=r.queue,Eu(W0.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||bn!==null&&bn.memoizedState.tag&1){if(n.flags|=2048,Hi(9,$0.bind(null,n,r,a,t),void 0,null),wn===null)throw Error(He(349));Yr&30||V0(n,t,a)}return a}function V0(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=rn.updateQueue,t===null?(t={lastEffect:null,stores:null},rn.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function $0(e,t,n,r){t.value=n,t.getSnapshot=r,Y0(t)&&q0(e)}function W0(e,t,n){return n(function(){Y0(t)&&q0(e)})}function Y0(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Ao(e,n)}catch{return!0}}function q0(e){var t=Jo(e,1);t!==null&&Eo(t,e,1,-1)}function oh(e){var t=Lo();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ui,lastRenderedState:e},t.queue=e,e=e.dispatch=L2.bind(null,rn,e),[t.memoizedState,e]}function Hi(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=rn.updateQueue,t===null?(t={lastEffect:null,stores:null},rn.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function K0(){return go().memoizedState}function Fs(e,t,n,r){var a=Lo();rn.flags|=e,a.memoizedState=Hi(1|t,n,void 0,r===void 0?null:r)}function Il(e,t,n,r){var a=go();r=r===void 0?null:r;var i=void 0;if(fn!==null){var s=fn.memoizedState;if(i=s.destroy,r!==null&&Cu(r,s.deps)){a.memoizedState=Hi(t,n,i,r);return}}rn.flags|=e,a.memoizedState=Hi(1|t,n,i,r)}function rh(e,t){return Fs(8390656,8,e,t)}function Eu(e,t){return Il(2048,8,e,t)}function J0(e,t){return Il(4,2,e,t)}function X0(e,t){return Il(4,4,e,t)}function Z0(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Q0(e,t,n){return n=n!=null?n.concat([e]):null,Il(4,4,Z0.bind(null,t,e),n)}function Nu(){}function ef(e,t){var n=go();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Cu(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function tf(e,t){var n=go();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Cu(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function nf(e,t,n){return Yr&21?(Ao(n,t)||(n=s0(),rn.lanes|=n,qr|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,qn=!0),e.memoizedState=n)}function M2(e,t){var n=Ot;Ot=n!==0&&4>n?n:4,e(!0);var r=Cc.transition;Cc.transition={};try{e(!1),t()}finally{Ot=n,Cc.transition=r}}function of(){return go().memoizedState}function j2(e,t,n){var r=_r(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rf(e))af(t,n);else if(n=z0(e,t,n,r),n!==null){var a=Un();Eo(n,e,r,a),sf(n,t,r)}}function L2(e,t,n){var r=_r(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rf(e))af(t,a);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var s=t.lastRenderedState,l=i(s,n);if(a.hasEagerState=!0,a.eagerState=l,Ao(l,s)){var c=t.interleaved;c===null?(a.next=a,xu(t)):(a.next=c.next,c.next=a),t.interleaved=a;return}}catch{}finally{}n=z0(e,t,a,r),n!==null&&(a=Un(),Eo(n,e,r,a),sf(n,t,r))}}function rf(e){var t=e.alternate;return e===rn||t!==null&&t===rn}function af(e,t){wi=cl=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function sf(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,ru(e,n)}}var dl={readContext:mo,useCallback:kn,useContext:kn,useEffect:kn,useImperativeHandle:kn,useInsertionEffect:kn,useLayoutEffect:kn,useMemo:kn,useReducer:kn,useRef:kn,useState:kn,useDebugValue:kn,useDeferredValue:kn,useTransition:kn,useMutableSource:kn,useSyncExternalStore:kn,useId:kn,unstable_isNewReconciler:!1},D2={readContext:mo,useCallback:function(e,t){return Lo().memoizedState=[e,t===void 0?null:t],e},useContext:mo,useEffect:rh,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Fs(4194308,4,Z0.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Fs(4194308,4,e,t)},useInsertionEffect:function(e,t){return Fs(4,2,e,t)},useMemo:function(e,t){var n=Lo();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Lo();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=j2.bind(null,rn,e),[r.memoizedState,e]},useRef:function(e){var t=Lo();return e={current:e},t.memoizedState=e},useState:oh,useDebugValue:Nu,useDeferredValue:function(e){return Lo().memoizedState=e},useTransition:function(){var e=oh(!1),t=e[0];return e=M2.bind(null,e[1]),Lo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=rn,a=Lo();if(Qt){if(n===void 0)throw Error(He(407));n=n()}else{if(n=t(),wn===null)throw Error(He(349));Yr&30||V0(r,t,n)}a.memoizedState=n;var i={value:n,getSnapshot:t};return a.queue=i,rh(W0.bind(null,r,i,e),[e]),r.flags|=2048,Hi(9,$0.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=Lo(),t=wn.identifierPrefix;if(Qt){var n=$o,r=Vo;n=(r&~(1<<32-To(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=Gi++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=R2++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},O2={readContext:mo,useCallback:ef,useContext:mo,useEffect:Eu,useImperativeHandle:Q0,useInsertionEffect:J0,useLayoutEffect:X0,useMemo:tf,useReducer:Sc,useRef:K0,useState:function(){return Sc(Ui)},useDebugValue:Nu,useDeferredValue:function(e){var t=go();return nf(t,fn.memoizedState,e)},useTransition:function(){var e=Sc(Ui)[0],t=go().memoizedState;return[e,t]},useMutableSource:H0,useSyncExternalStore:B0,useId:of,unstable_isNewReconciler:!1},F2={readContext:mo,useCallback:ef,useContext:mo,useEffect:Eu,useImperativeHandle:Q0,useInsertionEffect:J0,useLayoutEffect:X0,useMemo:tf,useReducer:Tc,useRef:K0,useState:function(){return Tc(Ui)},useDebugValue:Nu,useDeferredValue:function(e){var t=go();return fn===null?t.memoizedState=e:nf(t,fn.memoizedState,e)},useTransition:function(){var e=Tc(Ui)[0],t=go().memoizedState;return[e,t]},useMutableSource:H0,useSyncExternalStore:B0,useId:of,unstable_isNewReconciler:!1};function _o(e,t){if(e&&e.defaultProps){t=an({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function hd(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:an({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Pl={isMounted:function(e){return(e=e._reactInternals)?Zr(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Un(),a=_r(e),i=Yo(r,a);i.payload=t,n!=null&&(i.callback=n),t=br(e,i,a),t!==null&&(Eo(t,e,a,r),Ds(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Un(),a=_r(e),i=Yo(r,a);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=br(e,i,a),t!==null&&(Eo(t,e,a,r),Ds(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Un(),r=_r(e),a=Yo(n,r);a.tag=2,t!=null&&(a.callback=t),t=br(e,a,r),t!==null&&(Eo(t,e,r,n),Ds(t,e,r))}};function ah(e,t,n,r,a,i,s){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,i,s):t.prototype&&t.prototype.isPureReactComponent?!ji(n,r)||!ji(a,i):!0}function lf(e,t,n){var r=!1,a=Tr,i=t.contextType;return typeof i=="object"&&i!==null?i=mo(i):(a=Jn(t)?$r:Dn.current,r=t.contextTypes,i=(r=r!=null)?Ra(e,a):Tr),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Pl,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function ih(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Pl.enqueueReplaceState(t,t.state,null)}function md(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},vu(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=mo(i):(i=Jn(t)?$r:Dn.current,a.context=Ra(e,i)),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(hd(e,t,i,n),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&Pl.enqueueReplaceState(a,a.state,null),sl(e,n,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function Da(e,t){try{var n="",r=t;do n+=pv(r),r=r.return;while(r);var a=n}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a,digest:null}}function Ec(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function gd(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var z2=typeof WeakMap=="function"?WeakMap:Map;function cf(e,t,n){n=Yo(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){pl||(pl=!0,Td=r),gd(e,t)},n}function df(e,t,n){n=Yo(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){gd(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){gd(e,t),typeof r!="function"&&(wr===null?wr=new Set([this]):wr.add(this));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),n}function sh(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new z2;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Q2.bind(null,e,t,n),t.then(e,e))}function lh(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function ch(e,t,n,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Yo(-1,1),t.tag=2,br(n,t,1))),n.lanes|=1),e)}var G2=er.ReactCurrentOwner,qn=!1;function Gn(e,t,n,r){t.child=e===null?F0(t,null,n,r):ja(t,e.child,n,r)}function dh(e,t,n,r,a){n=n.render;var i=t.ref;return Na(t,a),r=Su(e,t,n,r,i,a),n=Tu(),e!==null&&!qn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Xo(e,t,a)):(Qt&&n&&pu(t),t.flags|=1,Gn(e,t,r,a),t.child)}function uh(e,t,n,r,a){if(e===null){var i=n.type;return typeof i=="function"&&!Lu(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,uf(e,t,i,r,a)):(e=Hs(n.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&a)){var s=i.memoizedProps;if(n=n.compare,n=n!==null?n:ji,n(s,r)&&e.ref===t.ref)return Xo(e,t,a)}return t.flags|=1,e=Cr(i,r),e.ref=t.ref,e.return=t,t.child=e}function uf(e,t,n,r,a){if(e!==null){var i=e.memoizedProps;if(ji(i,r)&&e.ref===t.ref)if(qn=!1,t.pendingProps=r=i,(e.lanes&a)!==0)e.flags&131072&&(qn=!0);else return t.lanes=e.lanes,Xo(e,t,a)}return fd(e,t,n,r,a)}function pf(e,t,n){var r=t.pendingProps,a=r.children,i=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Wt(ba,Qn),Qn|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Wt(ba,Qn),Qn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Wt(ba,Qn),Qn|=r}else i!==null?(r=i.baseLanes|n,t.memoizedState=null):r=n,Wt(ba,Qn),Qn|=r;return Gn(e,t,a,n),t.child}function hf(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function fd(e,t,n,r,a){var i=Jn(n)?$r:Dn.current;return i=Ra(t,i),Na(t,a),n=Su(e,t,n,r,i,a),r=Tu(),e!==null&&!qn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Xo(e,t,a)):(Qt&&r&&pu(t),t.flags|=1,Gn(e,t,n,a),t.child)}function ph(e,t,n,r,a){if(Jn(n)){var i=!0;nl(t)}else i=!1;if(Na(t,a),t.stateNode===null)zs(e,t),lf(t,n,r),md(t,n,r,a),r=!0;else if(e===null){var s=t.stateNode,l=t.memoizedProps;s.props=l;var c=s.context,d=n.contextType;typeof d=="object"&&d!==null?d=mo(d):(d=Jn(n)?$r:Dn.current,d=Ra(t,d));var h=n.getDerivedStateFromProps,g=typeof h=="function"||typeof s.getSnapshotBeforeUpdate=="function";g||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==r||c!==d)&&ih(t,s,r,d),ur=!1;var m=t.memoizedState;s.state=m,sl(t,r,s,a),c=t.memoizedState,l!==r||m!==c||Kn.current||ur?(typeof h=="function"&&(hd(t,n,h,r),c=t.memoizedState),(l=ur||ah(t,n,l,r,m,c,d))?(g||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.flags|=4194308)):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),s.props=r,s.state=c,s.context=d,r=l):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,G0(e,t),l=t.memoizedProps,d=t.type===t.elementType?l:_o(t.type,l),s.props=d,g=t.pendingProps,m=s.context,c=n.contextType,typeof c=="object"&&c!==null?c=mo(c):(c=Jn(n)?$r:Dn.current,c=Ra(t,c));var _=n.getDerivedStateFromProps;(h=typeof _=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(l!==g||m!==c)&&ih(t,s,r,c),ur=!1,m=t.memoizedState,s.state=m,sl(t,r,s,a);var y=t.memoizedState;l!==g||m!==y||Kn.current||ur?(typeof _=="function"&&(hd(t,n,_,r),y=t.memoizedState),(d=ur||ah(t,n,d,r,m,y,c)||!1)?(h||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,y,c),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,y,c)),typeof s.componentDidUpdate=="function"&&(t.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=y),s.props=r,s.state=y,s.context=c,r=d):(typeof s.componentDidUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),r=!1)}return yd(e,t,n,r,i,a)}function yd(e,t,n,r,a,i){hf(e,t);var s=(t.flags&128)!==0;if(!r&&!s)return a&&Xp(t,n,!1),Xo(e,t,i);r=t.stateNode,G2.current=t;var l=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&s?(t.child=ja(t,e.child,null,i),t.child=ja(t,null,l,i)):Gn(e,t,l,i),t.memoizedState=r.state,a&&Xp(t,n,!0),t.child}function mf(e){var t=e.stateNode;t.pendingContext?Jp(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Jp(e,t.context,!1),bu(e,t.containerInfo)}function hh(e,t,n,r,a){return Ma(),mu(a),t.flags|=256,Gn(e,t,n,r),t.child}var xd={dehydrated:null,treeContext:null,retryLane:0};function vd(e){return{baseLanes:e,cachePool:null,transitions:null}}function gf(e,t,n){var r=t.pendingProps,a=on.current,i=!1,s=(t.flags&128)!==0,l;if((l=s)||(l=e!==null&&e.memoizedState===null?!1:(a&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),Wt(on,a&1),e===null)return ud(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=r.children,e=r.fallback,i?(r=t.mode,i=t.child,s={mode:"hidden",children:s},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=s):i=jl(s,r,0,null),e=Vr(e,r,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=vd(n),t.memoizedState=xd,e):ku(t,s));if(a=e.memoizedState,a!==null&&(l=a.dehydrated,l!==null))return U2(e,t,s,r,l,a,n);if(i){i=r.fallback,s=t.mode,a=e.child,l=a.sibling;var c={mode:"hidden",children:r.children};return!(s&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=c,t.deletions=null):(r=Cr(a,c),r.subtreeFlags=a.subtreeFlags&14680064),l!==null?i=Cr(l,i):(i=Vr(i,s,n,null),i.flags|=2),i.return=t,r.return=t,r.sibling=i,t.child=r,r=i,i=t.child,s=e.child.memoizedState,s=s===null?vd(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},i.memoizedState=s,i.childLanes=e.childLanes&~n,t.memoizedState=xd,r}return i=e.child,e=i.sibling,r=Cr(i,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function ku(e,t){return t=jl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function fs(e,t,n,r){return r!==null&&mu(r),ja(t,e.child,null,n),e=ku(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function U2(e,t,n,r,a,i,s){if(n)return t.flags&256?(t.flags&=-257,r=Ec(Error(He(422))),fs(e,t,s,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=r.fallback,a=t.mode,r=jl({mode:"visible",children:r.children},a,0,null),i=Vr(i,a,s,null),i.flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,t.mode&1&&ja(t,e.child,null,s),t.child.memoizedState=vd(s),t.memoizedState=xd,i);if(!(t.mode&1))return fs(e,t,s,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(He(419)),r=Ec(i,r,void 0),fs(e,t,s,r)}if(l=(s&e.childLanes)!==0,qn||l){if(r=wn,r!==null){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|s)?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,Jo(e,a),Eo(r,e,a,-1))}return ju(),r=Ec(Error(He(421))),fs(e,t,s,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=e1.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,eo=vr(a.nextSibling),to=t,Qt=!0,So=null,e!==null&&(lo[co++]=Vo,lo[co++]=$o,lo[co++]=Wr,Vo=e.id,$o=e.overflow,Wr=t),t=ku(t,r.children),t.flags|=4096,t)}function mh(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),pd(e.return,t,n)}function Nc(e,t,n,r,a){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function ff(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(Gn(e,t,r.children,n),r=on.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&mh(e,n,t);else if(e.tag===19)mh(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Wt(on,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;n!==null;)e=n.alternate,e!==null&&ll(e)===null&&(a=n),n=n.sibling;n=a,n===null?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Nc(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&ll(e)===null){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Nc(t,!0,n,null,i);break;case"together":Nc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function zs(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Xo(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),qr|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(He(153));if(t.child!==null){for(e=t.child,n=Cr(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Cr(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function H2(e,t,n){switch(t.tag){case 3:mf(t),Ma();break;case 5:U0(t);break;case 1:Jn(t.type)&&nl(t);break;case 4:bu(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Wt(al,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(Wt(on,on.current&1),t.flags|=128,null):n&t.child.childLanes?gf(e,t,n):(Wt(on,on.current&1),e=Xo(e,t,n),e!==null?e.sibling:null);Wt(on,on.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return ff(e,t,n);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Wt(on,on.current),r)break;return null;case 22:case 23:return t.lanes=0,pf(e,t,n)}return Xo(e,t,n)}var yf,bd,xf,vf;yf=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};bd=function(){};xf=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Hr(Fo.current);var i=null;switch(n){case"input":a=Hc(e,a),r=Hc(e,r),i=[];break;case"select":a=an({},a,{value:void 0}),r=an({},r,{value:void 0}),i=[];break;case"textarea":a=$c(e,a),r=$c(e,r),i=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=el)}Yc(n,r);var s;n=null;for(d in a)if(!r.hasOwnProperty(d)&&a.hasOwnProperty(d)&&a[d]!=null)if(d==="style"){var l=a[d];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Ni.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=a!=null?a[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Ni.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Jt("scroll",e),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(t.updateQueue=d)&&(t.flags|=4)}};vf=function(e,t,n,r){n!==r&&(t.flags|=4)};function ii(e,t){if(!Qt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function An(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function B2(e,t,n){var r=t.pendingProps;switch(hu(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return An(t),null;case 1:return Jn(t.type)&&tl(),An(t),null;case 3:return r=t.stateNode,La(),Xt(Kn),Xt(Dn),_u(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(ms(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,So!==null&&(kd(So),So=null))),bd(e,t),An(t),null;case 5:wu(t);var a=Hr(zi.current);if(n=t.type,e!==null&&t.stateNode!=null)xf(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(He(166));return An(t),null}if(e=Hr(Fo.current),ms(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[Do]=t,r[Oi]=i,e=(t.mode&1)!==0,n){case"dialog":Jt("cancel",r),Jt("close",r);break;case"iframe":case"object":case"embed":Jt("load",r);break;case"video":case"audio":for(a=0;a<mi.length;a++)Jt(mi[a],r);break;case"source":Jt("error",r);break;case"img":case"image":case"link":Jt("error",r),Jt("load",r);break;case"details":Jt("toggle",r);break;case"input":Cp(r,i),Jt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Jt("invalid",r);break;case"textarea":Tp(r,i),Jt("invalid",r)}Yc(n,i),a=null;for(var s in i)if(i.hasOwnProperty(s)){var l=i[s];s==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&hs(r.textContent,l,e),a=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&hs(r.textContent,l,e),a=["children",""+l]):Ni.hasOwnProperty(s)&&l!=null&&s==="onScroll"&&Jt("scroll",r)}switch(n){case"input":as(r),Sp(r,i,!0);break;case"textarea":as(r),Ep(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=el)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{s=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Wg(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=s.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=s.createElement(n,{is:r.is}):(e=s.createElement(n),n==="select"&&(s=e,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):e=s.createElementNS(e,n),e[Do]=t,e[Oi]=r,yf(e,t,!1,!1),t.stateNode=e;e:{switch(s=qc(n,r),n){case"dialog":Jt("cancel",e),Jt("close",e),a=r;break;case"iframe":case"object":case"embed":Jt("load",e),a=r;break;case"video":case"audio":for(a=0;a<mi.length;a++)Jt(mi[a],e);a=r;break;case"source":Jt("error",e),a=r;break;case"img":case"image":case"link":Jt("error",e),Jt("load",e),a=r;break;case"details":Jt("toggle",e),a=r;break;case"input":Cp(e,r),a=Hc(e,r),Jt("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=an({},r,{value:void 0}),Jt("invalid",e);break;case"textarea":Tp(e,r),a=$c(e,r),Jt("invalid",e);break;default:a=r}Yc(n,a),l=a;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?Kg(e,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Yg(e,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&ki(e,c):typeof c=="number"&&ki(e,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Ni.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Jt("scroll",e):c!=null&&Zd(e,i,c,s))}switch(n){case"input":as(e),Sp(e,r,!1);break;case"textarea":as(e),Ep(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Sr(r.value));break;case"select":e.multiple=!!r.multiple,i=r.value,i!=null?Ca(e,!!r.multiple,i,!1):r.defaultValue!=null&&Ca(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=el)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return An(t),null;case 6:if(e&&t.stateNode!=null)vf(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(He(166));if(n=Hr(zi.current),Hr(Fo.current),ms(t)){if(r=t.stateNode,n=t.memoizedProps,r[Do]=t,(i=r.nodeValue!==n)&&(e=to,e!==null))switch(e.tag){case 3:hs(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&hs(r.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Do]=t,t.stateNode=r}return An(t),null;case 13:if(Xt(on),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Qt&&eo!==null&&t.mode&1&&!(t.flags&128))D0(),Ma(),t.flags|=98560,i=!1;else if(i=ms(t),r!==null&&r.dehydrated!==null){if(e===null){if(!i)throw Error(He(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(He(317));i[Do]=t}else Ma(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;An(t),i=!1}else So!==null&&(kd(So),So=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||on.current&1?yn===0&&(yn=3):ju())),t.updateQueue!==null&&(t.flags|=4),An(t),null);case 4:return La(),bd(e,t),e===null&&Li(t.stateNode.containerInfo),An(t),null;case 10:return yu(t.type._context),An(t),null;case 17:return Jn(t.type)&&tl(),An(t),null;case 19:if(Xt(on),i=t.memoizedState,i===null)return An(t),null;if(r=(t.flags&128)!==0,s=i.rendering,s===null)if(r)ii(i,!1);else{if(yn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(s=ll(e),s!==null){for(t.flags|=128,ii(i,!1),r=s.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)i=n,e=r,i.flags&=14680066,s=i.alternate,s===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=s.childLanes,i.lanes=s.lanes,i.child=s.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=s.memoizedProps,i.memoizedState=s.memoizedState,i.updateQueue=s.updateQueue,i.type=s.type,e=s.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Wt(on,on.current&1|2),t.child}e=e.sibling}i.tail!==null&&dn()>Oa&&(t.flags|=128,r=!0,ii(i,!1),t.lanes=4194304)}else{if(!r)if(e=ll(s),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),ii(i,!0),i.tail===null&&i.tailMode==="hidden"&&!s.alternate&&!Qt)return An(t),null}else 2*dn()-i.renderingStartTime>Oa&&n!==1073741824&&(t.flags|=128,r=!0,ii(i,!1),t.lanes=4194304);i.isBackwards?(s.sibling=t.child,t.child=s):(n=i.last,n!==null?n.sibling=s:t.child=s,i.last=s)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=dn(),t.sibling=null,n=on.current,Wt(on,r?n&1|2:n&1),t):(An(t),null);case 22:case 23:return Mu(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?Qn&1073741824&&(An(t),t.subtreeFlags&6&&(t.flags|=8192)):An(t),null;case 24:return null;case 25:return null}throw Error(He(156,t.tag))}function V2(e,t){switch(hu(t),t.tag){case 1:return Jn(t.type)&&tl(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return La(),Xt(Kn),Xt(Dn),_u(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return wu(t),null;case 13:if(Xt(on),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(He(340));Ma()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Xt(on),null;case 4:return La(),null;case 10:return yu(t.type._context),null;case 22:case 23:return Mu(),null;case 24:return null;default:return null}}var ys=!1,jn=!1,$2=typeof WeakSet=="function"?WeakSet:Set,Xe=null;function va(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ln(e,t,r)}else n.current=null}function wd(e,t,n){try{n()}catch(r){ln(e,t,r)}}var gh=!1;function W2(e,t){if(rd=Xs,e=C0(),uu(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var s=0,l=-1,c=-1,d=0,h=0,g=e,m=null;t:for(;;){for(var _;g!==n||a!==0&&g.nodeType!==3||(l=s+a),g!==i||r!==0&&g.nodeType!==3||(c=s+r),g.nodeType===3&&(s+=g.nodeValue.length),(_=g.firstChild)!==null;)m=g,g=_;for(;;){if(g===e)break t;if(m===n&&++d===a&&(l=s),m===i&&++h===r&&(c=s),(_=g.nextSibling)!==null)break;g=m,m=g.parentNode}g=_}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ad={focusedElem:e,selectionRange:n},Xs=!1,Xe=t;Xe!==null;)if(t=Xe,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Xe=e;else for(;Xe!==null;){t=Xe;try{var y=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var v=y.memoizedProps,C=y.memoizedState,w=t.stateNode,b=w.getSnapshotBeforeUpdate(t.elementType===t.type?v:_o(t.type,v),C);w.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var f=t.stateNode.containerInfo;f.nodeType===1?f.textContent="":f.nodeType===9&&f.documentElement&&f.removeChild(f.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(He(163))}}catch(T){ln(t,t.return,T)}if(e=t.sibling,e!==null){e.return=t.return,Xe=e;break}Xe=t.return}return y=gh,gh=!1,y}function _i(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,i!==void 0&&wd(t,n,i)}a=a.next}while(a!==r)}}function Rl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function _d(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function bf(e){var t=e.alternate;t!==null&&(e.alternate=null,bf(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Do],delete t[Oi],delete t[ld],delete t[k2],delete t[A2])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function wf(e){return e.tag===5||e.tag===3||e.tag===4}function fh(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||wf(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Cd(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=el));else if(r!==4&&(e=e.child,e!==null))for(Cd(e,t,n),e=e.sibling;e!==null;)Cd(e,t,n),e=e.sibling}function Sd(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Sd(e,t,n),e=e.sibling;e!==null;)Sd(e,t,n),e=e.sibling}var Sn=null,Co=!1;function ir(e,t,n){for(n=n.child;n!==null;)_f(e,t,n),n=n.sibling}function _f(e,t,n){if(Oo&&typeof Oo.onCommitFiberUnmount=="function")try{Oo.onCommitFiberUnmount(Sl,n)}catch{}switch(n.tag){case 5:jn||va(n,t);case 6:var r=Sn,a=Co;Sn=null,ir(e,t,n),Sn=r,Co=a,Sn!==null&&(Co?(e=Sn,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Sn.removeChild(n.stateNode));break;case 18:Sn!==null&&(Co?(e=Sn,n=n.stateNode,e.nodeType===8?bc(e.parentNode,n):e.nodeType===1&&bc(e,n),Ri(e)):bc(Sn,n.stateNode));break;case 4:r=Sn,a=Co,Sn=n.stateNode.containerInfo,Co=!0,ir(e,t,n),Sn=r,Co=a;break;case 0:case 11:case 14:case 15:if(!jn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var i=a,s=i.destroy;i=i.tag,s!==void 0&&(i&2||i&4)&&wd(n,t,s),a=a.next}while(a!==r)}ir(e,t,n);break;case 1:if(!jn&&(va(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){ln(n,t,l)}ir(e,t,n);break;case 21:ir(e,t,n);break;case 22:n.mode&1?(jn=(r=jn)||n.memoizedState!==null,ir(e,t,n),jn=r):ir(e,t,n);break;default:ir(e,t,n)}}function yh(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new $2),t.forEach(function(r){var a=t1.bind(null,e,r);n.has(r)||(n.add(r),r.then(a,a))})}}function wo(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r];try{var i=e,s=t,l=s;e:for(;l!==null;){switch(l.tag){case 5:Sn=l.stateNode,Co=!1;break e;case 3:Sn=l.stateNode.containerInfo,Co=!0;break e;case 4:Sn=l.stateNode.containerInfo,Co=!0;break e}l=l.return}if(Sn===null)throw Error(He(160));_f(i,s,a),Sn=null,Co=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(d){ln(a,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Cf(t,e),t=t.sibling}function Cf(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(wo(t,e),jo(e),r&4){try{_i(3,e,e.return),Rl(3,e)}catch(v){ln(e,e.return,v)}try{_i(5,e,e.return)}catch(v){ln(e,e.return,v)}}break;case 1:wo(t,e),jo(e),r&512&&n!==null&&va(n,n.return);break;case 5:if(wo(t,e),jo(e),r&512&&n!==null&&va(n,n.return),e.flags&32){var a=e.stateNode;try{ki(a,"")}catch(v){ln(e,e.return,v)}}if(r&4&&(a=e.stateNode,a!=null)){var i=e.memoizedProps,s=n!==null?n.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Vg(a,i),qc(l,s);var d=qc(l,i);for(s=0;s<c.length;s+=2){var h=c[s],g=c[s+1];h==="style"?Kg(a,g):h==="dangerouslySetInnerHTML"?Yg(a,g):h==="children"?ki(a,g):Zd(a,h,g,d)}switch(l){case"input":Bc(a,i);break;case"textarea":$g(a,i);break;case"select":var m=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var _=i.value;_!=null?Ca(a,!!i.multiple,_,!1):m!==!!i.multiple&&(i.defaultValue!=null?Ca(a,!!i.multiple,i.defaultValue,!0):Ca(a,!!i.multiple,i.multiple?[]:"",!1))}a[Oi]=i}catch(v){ln(e,e.return,v)}}break;case 6:if(wo(t,e),jo(e),r&4){if(e.stateNode===null)throw Error(He(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(v){ln(e,e.return,v)}}break;case 3:if(wo(t,e),jo(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ri(t.containerInfo)}catch(v){ln(e,e.return,v)}break;case 4:wo(t,e),jo(e);break;case 13:wo(t,e),jo(e),a=e.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||(Pu=dn())),r&4&&yh(e);break;case 22:if(h=n!==null&&n.memoizedState!==null,e.mode&1?(jn=(d=jn)||h,wo(t,e),jn=d):wo(t,e),jo(e),r&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!h&&e.mode&1)for(Xe=e,h=e.child;h!==null;){for(g=Xe=h;Xe!==null;){switch(m=Xe,_=m.child,m.tag){case 0:case 11:case 14:case 15:_i(4,m,m.return);break;case 1:va(m,m.return);var y=m.stateNode;if(typeof y.componentWillUnmount=="function"){r=m,n=m.return;try{t=r,y.props=t.memoizedProps,y.state=t.memoizedState,y.componentWillUnmount()}catch(v){ln(r,n,v)}}break;case 5:va(m,m.return);break;case 22:if(m.memoizedState!==null){vh(g);continue}}_!==null?(_.return=m,Xe=_):vh(g)}h=h.sibling}e:for(h=null,g=e;;){if(g.tag===5){if(h===null){h=g;try{a=g.stateNode,d?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=g.stateNode,c=g.memoizedProps.style,s=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=qg("display",s))}catch(v){ln(e,e.return,v)}}}else if(g.tag===6){if(h===null)try{g.stateNode.nodeValue=d?"":g.memoizedProps}catch(v){ln(e,e.return,v)}}else if((g.tag!==22&&g.tag!==23||g.memoizedState===null||g===e)&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===e)break e;for(;g.sibling===null;){if(g.return===null||g.return===e)break e;h===g&&(h=null),g=g.return}h===g&&(h=null),g.sibling.return=g.return,g=g.sibling}}break;case 19:wo(t,e),jo(e),r&4&&yh(e);break;case 21:break;default:wo(t,e),jo(e)}}function jo(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(wf(n)){var r=n;break e}n=n.return}throw Error(He(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(ki(a,""),r.flags&=-33);var i=fh(e);Sd(e,i,a);break;case 3:case 4:var s=r.stateNode.containerInfo,l=fh(e);Cd(e,l,s);break;default:throw Error(He(161))}}catch(c){ln(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Y2(e,t,n){Xe=e,Sf(e)}function Sf(e,t,n){for(var r=(e.mode&1)!==0;Xe!==null;){var a=Xe,i=a.child;if(a.tag===22&&r){var s=a.memoizedState!==null||ys;if(!s){var l=a.alternate,c=l!==null&&l.memoizedState!==null||jn;l=ys;var d=jn;if(ys=s,(jn=c)&&!d)for(Xe=a;Xe!==null;)s=Xe,c=s.child,s.tag===22&&s.memoizedState!==null?bh(a):c!==null?(c.return=s,Xe=c):bh(a);for(;i!==null;)Xe=i,Sf(i),i=i.sibling;Xe=a,ys=l,jn=d}xh(e)}else a.subtreeFlags&8772&&i!==null?(i.return=a,Xe=i):xh(e)}}function xh(e){for(;Xe!==null;){var t=Xe;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:jn||Rl(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!jn)if(n===null)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:_o(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&nh(t,i,r);break;case 3:var s=t.updateQueue;if(s!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}nh(t,s,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var g=h.dehydrated;g!==null&&Ri(g)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(He(163))}jn||t.flags&512&&_d(t)}catch(m){ln(t,t.return,m)}}if(t===e){Xe=null;break}if(n=t.sibling,n!==null){n.return=t.return,Xe=n;break}Xe=t.return}}function vh(e){for(;Xe!==null;){var t=Xe;if(t===e){Xe=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Xe=n;break}Xe=t.return}}function bh(e){for(;Xe!==null;){var t=Xe;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Rl(4,t)}catch(c){ln(t,n,c)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(c){ln(t,a,c)}}var i=t.return;try{_d(t)}catch(c){ln(t,i,c)}break;case 5:var s=t.return;try{_d(t)}catch(c){ln(t,s,c)}}}catch(c){ln(t,t.return,c)}if(t===e){Xe=null;break}var l=t.sibling;if(l!==null){l.return=t.return,Xe=l;break}Xe=t.return}}var q2=Math.ceil,ul=er.ReactCurrentDispatcher,Au=er.ReactCurrentOwner,po=er.ReactCurrentBatchConfig,Tt=0,wn=null,mn=null,Tn=0,Qn=0,ba=Nr(0),yn=0,Bi=null,qr=0,Ml=0,Iu=0,Ci=null,Wn=null,Pu=0,Oa=1/0,Uo=null,pl=!1,Td=null,wr=null,xs=!1,gr=null,hl=0,Si=0,Ed=null,Gs=-1,Us=0;function Un(){return Tt&6?dn():Gs!==-1?Gs:Gs=dn()}function _r(e){return e.mode&1?Tt&2&&Tn!==0?Tn&-Tn:P2.transition!==null?(Us===0&&(Us=s0()),Us):(e=Ot,e!==0||(e=window.event,e=e===void 0?16:m0(e.type)),e):1}function Eo(e,t,n,r){if(50<Si)throw Si=0,Ed=null,Error(He(185));Wi(e,n,r),(!(Tt&2)||e!==wn)&&(e===wn&&(!(Tt&2)&&(Ml|=n),yn===4&&hr(e,Tn)),Xn(e,r),n===1&&Tt===0&&!(t.mode&1)&&(Oa=dn()+500,Al&&kr()))}function Xn(e,t){var n=e.callbackNode;Pv(e,t);var r=Js(e,e===wn?Tn:0);if(r===0)n!==null&&Ap(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&Ap(n),t===1)e.tag===0?I2(wh.bind(null,e)):M0(wh.bind(null,e)),E2(function(){!(Tt&6)&&kr()}),n=null;else{switch(l0(r)){case 1:n=ou;break;case 4:n=a0;break;case 16:n=Ks;break;case 536870912:n=i0;break;default:n=Ks}n=Rf(n,Tf.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Tf(e,t){if(Gs=-1,Us=0,Tt&6)throw Error(He(327));var n=e.callbackNode;if(ka()&&e.callbackNode!==n)return null;var r=Js(e,e===wn?Tn:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=ml(e,r);else{t=r;var a=Tt;Tt|=2;var i=Nf();(wn!==e||Tn!==t)&&(Uo=null,Oa=dn()+500,Br(e,t));do try{X2();break}catch(l){Ef(e,l)}while(!0);fu(),ul.current=i,Tt=a,mn!==null?t=0:(wn=null,Tn=0,t=yn)}if(t!==0){if(t===2&&(a=Qc(e),a!==0&&(r=a,t=Nd(e,a))),t===1)throw n=Bi,Br(e,0),hr(e,r),Xn(e,dn()),n;if(t===6)hr(e,r);else{if(a=e.current.alternate,!(r&30)&&!K2(a)&&(t=ml(e,r),t===2&&(i=Qc(e),i!==0&&(r=i,t=Nd(e,i))),t===1))throw n=Bi,Br(e,0),hr(e,r),Xn(e,dn()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(He(345));case 2:Or(e,Wn,Uo);break;case 3:if(hr(e,r),(r&130023424)===r&&(t=Pu+500-dn(),10<t)){if(Js(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){Un(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=sd(Or.bind(null,e,Wn,Uo),t);break}Or(e,Wn,Uo);break;case 4:if(hr(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-To(r);i=1<<s,s=t[s],s>a&&(a=s),r&=~i}if(r=a,r=dn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*q2(r/1960))-r,10<r){e.timeoutHandle=sd(Or.bind(null,e,Wn,Uo),r);break}Or(e,Wn,Uo);break;case 5:Or(e,Wn,Uo);break;default:throw Error(He(329))}}}return Xn(e,dn()),e.callbackNode===n?Tf.bind(null,e):null}function Nd(e,t){var n=Ci;return e.current.memoizedState.isDehydrated&&(Br(e,t).flags|=256),e=ml(e,t),e!==2&&(t=Wn,Wn=n,t!==null&&kd(t)),e}function kd(e){Wn===null?Wn=e:Wn.push.apply(Wn,e)}function K2(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!Ao(i(),a))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function hr(e,t){for(t&=~Iu,t&=~Ml,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-To(t),r=1<<n;e[n]=-1,t&=~r}}function wh(e){if(Tt&6)throw Error(He(327));ka();var t=Js(e,0);if(!(t&1))return Xn(e,dn()),null;var n=ml(e,t);if(e.tag!==0&&n===2){var r=Qc(e);r!==0&&(t=r,n=Nd(e,r))}if(n===1)throw n=Bi,Br(e,0),hr(e,t),Xn(e,dn()),n;if(n===6)throw Error(He(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Or(e,Wn,Uo),Xn(e,dn()),null}function Ru(e,t){var n=Tt;Tt|=1;try{return e(t)}finally{Tt=n,Tt===0&&(Oa=dn()+500,Al&&kr())}}function Kr(e){gr!==null&&gr.tag===0&&!(Tt&6)&&ka();var t=Tt;Tt|=1;var n=po.transition,r=Ot;try{if(po.transition=null,Ot=1,e)return e()}finally{Ot=r,po.transition=n,Tt=t,!(Tt&6)&&kr()}}function Mu(){Qn=ba.current,Xt(ba)}function Br(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,T2(n)),mn!==null)for(n=mn.return;n!==null;){var r=n;switch(hu(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&tl();break;case 3:La(),Xt(Kn),Xt(Dn),_u();break;case 5:wu(r);break;case 4:La();break;case 13:Xt(on);break;case 19:Xt(on);break;case 10:yu(r.type._context);break;case 22:case 23:Mu()}n=n.return}if(wn=e,mn=e=Cr(e.current,null),Tn=Qn=t,yn=0,Bi=null,Iu=Ml=qr=0,Wn=Ci=null,Ur!==null){for(t=0;t<Ur.length;t++)if(n=Ur[t],r=n.interleaved,r!==null){n.interleaved=null;var a=r.next,i=n.pending;if(i!==null){var s=i.next;i.next=a,r.next=s}n.pending=r}Ur=null}return e}function Ef(e,t){do{var n=mn;try{if(fu(),Os.current=dl,cl){for(var r=rn.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}cl=!1}if(Yr=0,bn=fn=rn=null,wi=!1,Gi=0,Au.current=null,n===null||n.return===null){yn=1,Bi=t,mn=null;break}e:{var i=e,s=n.return,l=n,c=t;if(t=Tn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=l,g=h.tag;if(!(h.mode&1)&&(g===0||g===11||g===15)){var m=h.alternate;m?(h.updateQueue=m.updateQueue,h.memoizedState=m.memoizedState,h.lanes=m.lanes):(h.updateQueue=null,h.memoizedState=null)}var _=lh(s);if(_!==null){_.flags&=-257,ch(_,s,l,i,t),_.mode&1&&sh(i,d,t),t=_,c=d;var y=t.updateQueue;if(y===null){var v=new Set;v.add(c),t.updateQueue=v}else y.add(c);break e}else{if(!(t&1)){sh(i,d,t),ju();break e}c=Error(He(426))}}else if(Qt&&l.mode&1){var C=lh(s);if(C!==null){!(C.flags&65536)&&(C.flags|=256),ch(C,s,l,i,t),mu(Da(c,l));break e}}i=c=Da(c,l),yn!==4&&(yn=2),Ci===null?Ci=[i]:Ci.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var w=cf(i,c,t);th(i,w);break e;case 1:l=c;var b=i.type,f=i.stateNode;if(!(i.flags&128)&&(typeof b.getDerivedStateFromError=="function"||f!==null&&typeof f.componentDidCatch=="function"&&(wr===null||!wr.has(f)))){i.flags|=65536,t&=-t,i.lanes|=t;var T=df(i,l,t);th(i,T);break e}}i=i.return}while(i!==null)}Af(n)}catch(I){t=I,mn===n&&n!==null&&(mn=n=n.return);continue}break}while(!0)}function Nf(){var e=ul.current;return ul.current=dl,e===null?dl:e}function ju(){(yn===0||yn===3||yn===2)&&(yn=4),wn===null||!(qr&268435455)&&!(Ml&268435455)||hr(wn,Tn)}function ml(e,t){var n=Tt;Tt|=2;var r=Nf();(wn!==e||Tn!==t)&&(Uo=null,Br(e,t));do try{J2();break}catch(a){Ef(e,a)}while(!0);if(fu(),Tt=n,ul.current=r,mn!==null)throw Error(He(261));return wn=null,Tn=0,yn}function J2(){for(;mn!==null;)kf(mn)}function X2(){for(;mn!==null&&!_v();)kf(mn)}function kf(e){var t=Pf(e.alternate,e,Qn);e.memoizedProps=e.pendingProps,t===null?Af(e):mn=t,Au.current=null}function Af(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=V2(n,t),n!==null){n.flags&=32767,mn=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{yn=6,mn=null;return}}else if(n=B2(n,t,Qn),n!==null){mn=n;return}if(t=t.sibling,t!==null){mn=t;return}mn=t=e}while(t!==null);yn===0&&(yn=5)}function Or(e,t,n){var r=Ot,a=po.transition;try{po.transition=null,Ot=1,Z2(e,t,n,r)}finally{po.transition=a,Ot=r}return null}function Z2(e,t,n,r){do ka();while(gr!==null);if(Tt&6)throw Error(He(327));n=e.finishedWork;var a=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(He(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(Rv(e,i),e===wn&&(mn=wn=null,Tn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||xs||(xs=!0,Rf(Ks,function(){return ka(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=po.transition,po.transition=null;var s=Ot;Ot=1;var l=Tt;Tt|=4,Au.current=null,W2(e,n),Cf(n,e),x2(ad),Xs=!!rd,ad=rd=null,e.current=n,Y2(n),Cv(),Tt=l,Ot=s,po.transition=i}else e.current=n;if(xs&&(xs=!1,gr=e,hl=a),i=e.pendingLanes,i===0&&(wr=null),Ev(n.stateNode),Xn(e,dn()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(pl)throw pl=!1,e=Td,Td=null,e;return hl&1&&e.tag!==0&&ka(),i=e.pendingLanes,i&1?e===Ed?Si++:(Si=0,Ed=e):Si=0,kr(),null}function ka(){if(gr!==null){var e=l0(hl),t=po.transition,n=Ot;try{if(po.transition=null,Ot=16>e?16:e,gr===null)var r=!1;else{if(e=gr,gr=null,hl=0,Tt&6)throw Error(He(331));var a=Tt;for(Tt|=4,Xe=e.current;Xe!==null;){var i=Xe,s=i.child;if(Xe.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(Xe=d;Xe!==null;){var h=Xe;switch(h.tag){case 0:case 11:case 15:_i(8,h,i)}var g=h.child;if(g!==null)g.return=h,Xe=g;else for(;Xe!==null;){h=Xe;var m=h.sibling,_=h.return;if(bf(h),h===d){Xe=null;break}if(m!==null){m.return=_,Xe=m;break}Xe=_}}}var y=i.alternate;if(y!==null){var v=y.child;if(v!==null){y.child=null;do{var C=v.sibling;v.sibling=null,v=C}while(v!==null)}}Xe=i}}if(i.subtreeFlags&2064&&s!==null)s.return=i,Xe=s;else e:for(;Xe!==null;){if(i=Xe,i.flags&2048)switch(i.tag){case 0:case 11:case 15:_i(9,i,i.return)}var w=i.sibling;if(w!==null){w.return=i.return,Xe=w;break e}Xe=i.return}}var b=e.current;for(Xe=b;Xe!==null;){s=Xe;var f=s.child;if(s.subtreeFlags&2064&&f!==null)f.return=s,Xe=f;else e:for(s=b;Xe!==null;){if(l=Xe,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Rl(9,l)}}catch(I){ln(l,l.return,I)}if(l===s){Xe=null;break e}var T=l.sibling;if(T!==null){T.return=l.return,Xe=T;break e}Xe=l.return}}if(Tt=a,kr(),Oo&&typeof Oo.onPostCommitFiberRoot=="function")try{Oo.onPostCommitFiberRoot(Sl,e)}catch{}r=!0}return r}finally{Ot=n,po.transition=t}}return!1}function _h(e,t,n){t=Da(n,t),t=cf(e,t,1),e=br(e,t,1),t=Un(),e!==null&&(Wi(e,1,t),Xn(e,t))}function ln(e,t,n){if(e.tag===3)_h(e,e,n);else for(;t!==null;){if(t.tag===3){_h(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(wr===null||!wr.has(r))){e=Da(n,e),e=df(t,e,1),t=br(t,e,1),e=Un(),t!==null&&(Wi(t,1,e),Xn(t,e));break}}t=t.return}}function Q2(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Un(),e.pingedLanes|=e.suspendedLanes&n,wn===e&&(Tn&n)===n&&(yn===4||yn===3&&(Tn&130023424)===Tn&&500>dn()-Pu?Br(e,0):Iu|=n),Xn(e,t)}function If(e,t){t===0&&(e.mode&1?(t=ls,ls<<=1,!(ls&130023424)&&(ls=4194304)):t=1);var n=Un();e=Jo(e,t),e!==null&&(Wi(e,t,n),Xn(e,n))}function e1(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),If(e,n)}function t1(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(He(314))}r!==null&&r.delete(t),If(e,n)}var Pf;Pf=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Kn.current)qn=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return qn=!1,H2(e,t,n);qn=!!(e.flags&131072)}else qn=!1,Qt&&t.flags&1048576&&j0(t,rl,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;zs(e,t),e=t.pendingProps;var a=Ra(t,Dn.current);Na(t,n),a=Su(null,t,r,e,a,n);var i=Tu();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Jn(r)?(i=!0,nl(t)):i=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,vu(t),a.updater=Pl,t.stateNode=a,a._reactInternals=t,md(t,r,e,n),t=yd(null,t,r,!0,i,n)):(t.tag=0,Qt&&i&&pu(t),Gn(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(zs(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=o1(r),e=_o(r,e),a){case 0:t=fd(null,t,r,e,n);break e;case 1:t=ph(null,t,r,e,n);break e;case 11:t=dh(null,t,r,e,n);break e;case 14:t=uh(null,t,r,_o(r.type,e),n);break e}throw Error(He(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:_o(r,a),fd(e,t,r,a,n);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:_o(r,a),ph(e,t,r,a,n);case 3:e:{if(mf(t),e===null)throw Error(He(387));r=t.pendingProps,i=t.memoizedState,a=i.element,G0(e,t),sl(t,r,null,n);var s=t.memoizedState;if(r=s.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){a=Da(Error(He(423)),t),t=hh(e,t,r,n,a);break e}else if(r!==a){a=Da(Error(He(424)),t),t=hh(e,t,r,n,a);break e}else for(eo=vr(t.stateNode.containerInfo.firstChild),to=t,Qt=!0,So=null,n=F0(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ma(),r===a){t=Xo(e,t,n);break e}Gn(e,t,r,n)}t=t.child}return t;case 5:return U0(t),e===null&&ud(t),r=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,s=a.children,id(r,a)?s=null:i!==null&&id(r,i)&&(t.flags|=32),hf(e,t),Gn(e,t,s,n),t.child;case 6:return e===null&&ud(t),null;case 13:return gf(e,t,n);case 4:return bu(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=ja(t,null,r,n):Gn(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:_o(r,a),dh(e,t,r,a,n);case 7:return Gn(e,t,t.pendingProps,n),t.child;case 8:return Gn(e,t,t.pendingProps.children,n),t.child;case 12:return Gn(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,i=t.memoizedProps,s=a.value,Wt(al,r._currentValue),r._currentValue=s,i!==null)if(Ao(i.value,s)){if(i.children===a.children&&!Kn.current){t=Xo(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){s=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Yo(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),pd(i.return,n,t),l.lanes|=n;break}c=c.next}}else if(i.tag===10)s=i.type===t.type?null:i.child;else if(i.tag===18){if(s=i.return,s===null)throw Error(He(341));s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),pd(s,n,t),s=i.sibling}else s=i.child;if(s!==null)s.return=i;else for(s=i;s!==null;){if(s===t){s=null;break}if(i=s.sibling,i!==null){i.return=s.return,s=i;break}s=s.return}i=s}Gn(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Na(t,n),a=mo(a),r=r(a),t.flags|=1,Gn(e,t,r,n),t.child;case 14:return r=t.type,a=_o(r,t.pendingProps),a=_o(r.type,a),uh(e,t,r,a,n);case 15:return uf(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:_o(r,a),zs(e,t),t.tag=1,Jn(r)?(e=!0,nl(t)):e=!1,Na(t,n),lf(t,r,a),md(t,r,a,n),yd(null,t,r,!0,e,n);case 19:return ff(e,t,n);case 22:return pf(e,t,n)}throw Error(He(156,t.tag))};function Rf(e,t){return r0(e,t)}function n1(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function uo(e,t,n,r){return new n1(e,t,n,r)}function Lu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function o1(e){if(typeof e=="function")return Lu(e)?1:0;if(e!=null){if(e=e.$$typeof,e===eu)return 11;if(e===tu)return 14}return 2}function Cr(e,t){var n=e.alternate;return n===null?(n=uo(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Hs(e,t,n,r,a,i){var s=2;if(r=e,typeof e=="function")Lu(e)&&(s=1);else if(typeof e=="string")s=5;else e:switch(e){case da:return Vr(n.children,a,i,t);case Qd:s=8,a|=8;break;case Fc:return e=uo(12,n,t,a|2),e.elementType=Fc,e.lanes=i,e;case zc:return e=uo(13,n,t,a),e.elementType=zc,e.lanes=i,e;case Gc:return e=uo(19,n,t,a),e.elementType=Gc,e.lanes=i,e;case Ug:return jl(n,a,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case zg:s=10;break e;case Gg:s=9;break e;case eu:s=11;break e;case tu:s=14;break e;case dr:s=16,r=null;break e}throw Error(He(130,e==null?e:typeof e,""))}return t=uo(s,n,t,a),t.elementType=e,t.type=r,t.lanes=i,t}function Vr(e,t,n,r){return e=uo(7,e,r,t),e.lanes=n,e}function jl(e,t,n,r){return e=uo(22,e,r,t),e.elementType=Ug,e.lanes=n,e.stateNode={isHidden:!1},e}function kc(e,t,n){return e=uo(6,e,null,t),e.lanes=n,e}function Ac(e,t,n){return t=uo(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function r1(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=cc(0),this.expirationTimes=cc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cc(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Du(e,t,n,r,a,i,s,l,c){return e=new r1(e,t,n,l,c),t===1?(t=1,i===!0&&(t|=8)):t=0,i=uo(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},vu(i),e}function a1(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ca,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function Mf(e){if(!e)return Tr;e=e._reactInternals;e:{if(Zr(e)!==e||e.tag!==1)throw Error(He(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Jn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(He(171))}if(e.tag===1){var n=e.type;if(Jn(n))return R0(e,n,t)}return t}function jf(e,t,n,r,a,i,s,l,c){return e=Du(n,r,!0,e,a,i,s,l,c),e.context=Mf(null),n=e.current,r=Un(),a=_r(n),i=Yo(r,a),i.callback=t??null,br(n,i,a),e.current.lanes=a,Wi(e,a,r),Xn(e,r),e}function Ll(e,t,n,r){var a=t.current,i=Un(),s=_r(a);return n=Mf(n),t.context===null?t.context=n:t.pendingContext=n,t=Yo(i,s),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=br(a,t,s),e!==null&&(Eo(e,a,s,i),Ds(e,a,s)),s}function gl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Ch(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Ou(e,t){Ch(e,t),(e=e.alternate)&&Ch(e,t)}function i1(){return null}var Lf=typeof reportError=="function"?reportError:function(e){console.error(e)};function Fu(e){this._internalRoot=e}Dl.prototype.render=Fu.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(He(409));Ll(e,t,null,null)};Dl.prototype.unmount=Fu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Kr(function(){Ll(null,e,null,null)}),t[Ko]=null}};function Dl(e){this._internalRoot=e}Dl.prototype.unstable_scheduleHydration=function(e){if(e){var t=u0();e={blockedOn:null,target:e,priority:t};for(var n=0;n<pr.length&&t!==0&&t<pr[n].priority;n++);pr.splice(n,0,e),n===0&&h0(e)}};function zu(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Ol(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Sh(){}function s1(e,t,n,r,a){if(a){if(typeof r=="function"){var i=r;r=function(){var d=gl(s);i.call(d)}}var s=jf(t,r,e,0,null,!1,!1,"",Sh);return e._reactRootContainer=s,e[Ko]=s.current,Li(e.nodeType===8?e.parentNode:e),Kr(),s}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var l=r;r=function(){var d=gl(c);l.call(d)}}var c=Du(e,0,!1,null,null,!1,!1,"",Sh);return e._reactRootContainer=c,e[Ko]=c.current,Li(e.nodeType===8?e.parentNode:e),Kr(function(){Ll(t,c,n,r)}),c}function Fl(e,t,n,r,a){var i=n._reactRootContainer;if(i){var s=i;if(typeof a=="function"){var l=a;a=function(){var c=gl(s);l.call(c)}}Ll(t,s,e,a)}else s=s1(n,t,e,a,r);return gl(s)}c0=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=hi(t.pendingLanes);n!==0&&(ru(t,n|1),Xn(t,dn()),!(Tt&6)&&(Oa=dn()+500,kr()))}break;case 13:Kr(function(){var r=Jo(e,1);if(r!==null){var a=Un();Eo(r,e,1,a)}}),Ou(e,1)}};au=function(e){if(e.tag===13){var t=Jo(e,134217728);if(t!==null){var n=Un();Eo(t,e,134217728,n)}Ou(e,134217728)}};d0=function(e){if(e.tag===13){var t=_r(e),n=Jo(e,t);if(n!==null){var r=Un();Eo(n,e,t,r)}Ou(e,t)}};u0=function(){return Ot};p0=function(e,t){var n=Ot;try{return Ot=e,t()}finally{Ot=n}};Jc=function(e,t,n){switch(t){case"input":if(Bc(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=kl(r);if(!a)throw Error(He(90));Bg(r),Bc(r,a)}}}break;case"textarea":$g(e,n);break;case"select":t=n.value,t!=null&&Ca(e,!!n.multiple,t,!1)}};Zg=Ru;Qg=Kr;var l1={usingClientEntryPoint:!1,Events:[qi,ma,kl,Jg,Xg,Ru]},si={findFiberByHostInstance:Gr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},c1={bundleType:si.bundleType,version:si.version,rendererPackageName:si.rendererPackageName,rendererConfig:si.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:er.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=n0(e),e===null?null:e.stateNode},findFiberByHostInstance:si.findFiberByHostInstance||i1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vs.isDisabled&&vs.supportsFiber)try{Sl=vs.inject(c1),Oo=vs}catch{}}oo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=l1;oo.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!zu(t))throw Error(He(200));return a1(e,t,null,n)};oo.createRoot=function(e,t){if(!zu(e))throw Error(He(299));var n=!1,r="",a=Lf;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Du(e,1,!1,null,null,n,!1,r,a),e[Ko]=t.current,Li(e.nodeType===8?e.parentNode:e),new Fu(t)};oo.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(He(188)):(e=Object.keys(e).join(","),Error(He(268,e)));return e=n0(t),e=e===null?null:e.stateNode,e};oo.flushSync=function(e){return Kr(e)};oo.hydrate=function(e,t,n){if(!Ol(t))throw Error(He(200));return Fl(null,e,t,!0,n)};oo.hydrateRoot=function(e,t,n){if(!zu(e))throw Error(He(405));var r=n!=null&&n.hydratedSources||null,a=!1,i="",s=Lf;if(n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),t=jf(t,null,e,1,n??null,a,!1,i,s),e[Ko]=t.current,Li(e),r)for(e=0;e<r.length;e++)n=r[e],a=n._getVersion,a=a(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Dl(t)};oo.render=function(e,t,n){if(!Ol(t))throw Error(He(200));return Fl(null,e,t,!1,n)};oo.unmountComponentAtNode=function(e){if(!Ol(e))throw Error(He(40));return e._reactRootContainer?(Kr(function(){Fl(null,null,e,!1,function(){e._reactRootContainer=null,e[Ko]=null})}),!0):!1};oo.unstable_batchedUpdates=Ru;oo.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Ol(n))throw Error(He(200));if(e==null||e._reactInternals===void 0)throw Error(He(38));return Fl(e,t,n,!1,r)};oo.version="18.3.1-next-f1338f8080-20240426";function Df(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Df)}catch(e){console.error(e)}}Df(),Lg.exports=oo;var Ji=Lg.exports,Th=Ji;Dc.createRoot=Th.createRoot,Dc.hydrateRoot=Th.hydrateRoot;var S=(e=>(e.TEXT_INPUT="TEXT_INPUT",e.PROMPT_PROCESSOR="PROMPT_PROCESSOR",e.PROMPT_ANALYZER="PROMPT_ANALYZER",e.CHARACTER_ANALYZER="CHARACTER_ANALYZER",e.CHARACTER_GENERATOR="CHARACTER_GENERATOR",e.IMAGE_GENERATOR="IMAGE_GENERATOR",e.IMAGE_PREVIEW="IMAGE_PREVIEW",e.CHARACTER_CARD="CHARACTER_CARD",e.GEMINI_CHAT="GEMINI_CHAT",e.TRANSLATOR="TRANSLATOR",e.SCRIPT_GENERATOR="SCRIPT_GENERATOR",e.SCRIPT_ANALYZER="SCRIPT_ANALYZER",e.SCRIPT_PROMPT_MODIFIER="SCRIPT_PROMPT_MODIFIER",e.ERROR_ANALYZER="ERROR_ANALYZER",e.NOTE="NOTE",e.IDEA_GENERATOR="IDEA_GENERATOR",e.REROUTE_DOT="REROUTE_DOT",e.DATA_READER="DATA_READER",e.SPEECH_SYNTHESIZER="SPEECH_SYNTHESIZER",e.NARRATOR_TEXT_GENERATOR="NARRATOR_TEXT_GENERATOR",e.AUDIO_TRANSCRIBER="AUDIO_TRANSCRIBER",e.YOUTUBE_TITLE_GENERATOR="YOUTUBE_TITLE_GENERATOR",e.MUSIC_IDEA_GENERATOR="MUSIC_IDEA_GENERATOR",e.YOUTUBE_ANALYTICS="YOUTUBE_ANALYTICS",e.IMAGE_EDITOR="IMAGE_EDITOR",e))(S||{}),$t=(e=>(e.FOLDER="FOLDER",e.PROMPT="PROMPT",e))($t||{}),Ze=(e=>(e.FOLDER="FOLDER",e.GROUP="GROUP",e.CHARACTERS="CHARACTERS",e.SCRIPT="SCRIPT",e.ANALYSIS="ANALYSIS",e.FINAL_PROMPTS="FINAL_PROMPTS",e.YOUTUBE="YOUTUBE",e.MUSIC="MUSIC",e))(Ze||{});const d1={"app.title":"Script Modifier","app.description":"Visually create, refine, and generate scripts with the Gemini API.","app.slogan":"Connect ideas to create a masterpiece","app.subtitle":"Visualize Your Scripts","app.error.title":"Notification","app.error.copy":"Copy Error","app.error.copied":"Copied!","error.quotaExceeded":"You have reached your usage limit. Please check your API key quota or try again later.","error.apiKeyMissing":"API key not found. Please set your Gemini API key in the settings.","error.freeKeyNotAvailable":"Free/development API key is not available in this environment. Please provide your own key.","error.fileReadError":"Error reading file.","error.videoConversionError":"Failed to convert video to audio.","error.unsupportedFile":"Unsupported file type.","error.promptModifierFile":"This file belongs to another application (Prompt Modifier). Please open it in that application.","error.invalidFileType":"Invalid file type. Please load a Script Modifier Canvas or Project file.","welcome.iAmDeveloper":"I am a Developer","welcome.letsGo":"Let's Go!","welcome.resume":"Resume","welcome.reload":"Reload App","welcome.reloadTitle":"Reset & Reload?","welcome.reloadMessage":"This will clear the entire canvas and reload the application. Unsaved data will be lost. Are you sure?","welcome.confirmReload":"Reset & Reload","dialog.welcome.title":"Script Modifier","dialog.welcome.heading":"Welcome to","dialog.welcome.intro1":"Welcome to Script Modifier - your visual workspace for creating stories with Gemini.","dialog.welcome.intro2":"To get started, please select your language and enter your Gemini API key.","dialog.welcome.apiKeyExplanation":"Your API Key is stored locally in your browser. We do not send it to any server other than Google's Gemini API."},u1={"toolbar.edit":"Edit (V)","toolbar.cutter":"Cut Connection (C)","toolbar.selection":"Selection (S)","toolbar.reroute":"Reroute Dot (R)","toolbar.zoom":"Zoom (Z)","toolbar.snapToGrid":"Snap to Grid (Shift+W)","toolbar.resetZoom":"Reset Zoom","toolbar.lineStyleSpaghetti":"Spaghetti Lines (Shift+E)","toolbar.lineStyleOrthogonal":"Orthogonal Lines (Shift+E)","toolbar.addNode":"Add Node (F)","toolbar.catalog":"Catalog (Ctrl+Space)","toolbar.settings":"Settings","toolbar.resetToDefault":"Reset to Default","toolbar.closeProject":"Close Project / Clear","toolbar.enterFullscreen":"Fullscreen","toolbar.exitFullscreen":"Exit Fullscreen","toolbar.home":"Home","toolbar.addTextInput":"Text Input (T)","toolbar.addPromptAnalyzer":"Prompt Analyzer (A)","toolbar.addCharacterAnalyzer":"Character Analyzer","toolbar.addCharacterGenerator":"Character Generator (Shift+C)","toolbar.addImageGenerator":"Image Generator (O)","toolbar.addImagePreview":"Image Preview (I)","toolbar.addCharacterCard":"Character Card (Ctrl+Shift+C)","toolbar.addPromptProcessor":"Prompt Processor (P)","toolbar.addGeminiChat":"Gemini Chat (G)","toolbar.addTranslator":"Translator (L)","toolbar.addIdeaGenerator":"Idea Generator (Shift+A)","toolbar.addScriptGenerator":"Script Generator (Shift+S)","toolbar.addScriptAnalyzer":"Script Analyzer (Shift+D)","toolbar.addScriptPromptModifier":"Prompt Finalizer (Shift+F)","toolbar.addErrorAnalyzer":"Error Analyzer","toolbar.addNote":"Note (N)","toolbar.addDataReader":"Data Reader (Shift+R)","toolbar.addSpeechSynthesizer":"Speech Synthesizer (Shift+N)","toolbar.addNarratorTextGenerator":"Narrator Text Generator (Shift+G)","toolbar.addAudioTranscriber":"Audio Transcriber (Shift+B)","toolbar.addYouTubeTitleGenerator":"YouTube Title Generator (Shift+T)","toolbar.addMusicIdeaGenerator":"Music Idea Generator (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube Analytics (Shift+Y)","toolbar.addImageEditor":"Image Editor","toolbar.saveCanvas":"Save Canvas (Ctrl+S)","toolbar.saveProject":"Save Project (Ctrl+Shift+S)","toolbar.loadCanvas":"Load Canvas (Ctrl+O)","toolbar.clearCanvas":"Clear Canvas","toolbar.group.general":"General","toolbar.group.scripting":"Scripting","toolbar.group.prompting":"Prompting & Analysis","toolbar.group.characters":"Characters","toolbar.group.ai":"AI Tools","toolbar.group.file":"File","toolbar.group.images":"Images","toolbar.group.audio":"Audio","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"Canvas Controls","toolbar.expand":"Expand Panel","toolbar.collapse":"Collapse Panel","toolbar.toggleHeaders":"Toggle Headers","hotkeys.file.title":"File","hotkeys.file.save":"Save Canvas (Ctrl+S)","hotkeys.file.saveProject":"Save Project (Ctrl+Shift+S)","hotkeys.file.load":"Load Canvas (Ctrl+O)","hotkeys.tools.title":"Tools","hotkeys.tools.edit":"Edit","hotkeys.tools.cutter":"Cutter","hotkeys.tools.selection":"Selection","hotkeys.tools.reroute":"Reroute","hotkeys.tools.zoom":"Zoom","hotkeys.tools.group":"Group (G)","hotkeys.tools.deleteGroup":"Delete Group","hotkeys.tools.closeNode":"Close Node","hotkeys.tools.toggleLineStyle":"Toggle Line Style","hotkeys.tools.snapToGrid":"Snap to Grid","hotkeys.tools.selectAll":"Select All","hotkeys.tools.deselectAll":"Deselect All","hotkeys.tools.duplicate":"Duplicate (Content)","hotkeys.windows.title":"Windows","hotkeys.windows.search":"Search (F)","hotkeys.windows.quickAdd":"Quick Add (Space)","hotkeys.windows.catalog":"Catalog","hotkeys.createNode.title":"Create Node","hotkeys.hide":"Hide Hotkeys","help.title":"Hotkeys","hotkeys.show":"Show Hotkeys","search.placeholder":"Search for a node...","search.noResults":"No nodes found.","search.node.text_input.title":"Text Input","search.node.text_input.description":"A simple text box for your ideas. (T)","search.node.prompt_processor.title":"Prompt Processor","search.node.prompt_processor.description":"Enhances and combines prompts with AI. (P)","search.node.prompt_analyzer.title":"Prompt Analyzer","search.node.prompt_analyzer.description":"Splits a prompt into environment, character, and action. (A)","search.node.character_analyzer.title":"Character Analyzer","search.node.character_analyzer.description":"Splits a description into character and clothing.","search.node.character_generator.title":"Character Generator","search.node.character_generator.description":"Creates detailed characters from an idea. (Shift+C)","search.node.image_generator.title":"Image Generator","search.node.image_generator.description":"Generates an image from a text prompt using the Gemini API. (O)","search.node.image_preview.title":"Image Preview","search.node.image_preview.description":"Displays an image from a file. Drag and drop an image file onto the node. (I)","search.node.character_card.title":"Character Card","search.node.character_card.description":"Stores a character's image, name, and prompt. Allows image generation, saving, and loading. (Ctrl+Shift+C)","search.node.gemini_chat.title":"Gemini Chat","search.node.gemini_chat.description":"Node for direct conversation with Gemini AI. Maintains chat history. (G)","search.node.translator.title":"Translator","search.node.translator.description":"Translates incoming text to the selected language. (L)","search.node.script_generator.title":"Script Generator","search.node.script_generator.description":"Takes a story idea and generates a series of script scenes. (Shift+S)","search.node.script_analyzer.title":"Script Analyzer","search.node.script_analyzer.description":"Analyzes the script structure, breaking it down into characters and frames with detailed descriptions. (Shift+D)","search.node.script_prompt_modifier.title":"Prompt Finalizer","search.node.script_prompt_modifier.description":"Takes analyzed script data and synthesizes final, artistic prompts for image generation for each frame. (Shift+F)","search.node.error_analyzer.title":"Error Analyzer","search.node.error_analyzer.description":"Checks and corrects text for spelling and grammar errors.","search.node.note.title":"Note","search.node.note.description":"A simple text area for your notes. Does not connect to other nodes. (N)","search.node.reroute_dot.title":"Reroute Dot","search.node.reroute_dot.description":"A point to redirect and branch connections.","search.node.data_reader.title":"Data Reader","search.node.data_reader.description":"Displays raw text from a connection. (Shift+R)","search.node.speech_synthesizer.title":"Speech Synthesizer","search.node.speech_synthesizer.description":"Converts text to speech using a selected voice. (Shift+N)","search.node.idea_generator.title":"Idea Generator","search.node.idea_generator.description":"Generates categories (Action, Place, Obstacle) and combines them into a story idea. (Shift+A)","search.node.narrator_text_generator.title":"Narrator Text Generator","search.node.narrator_text_generator.description":"Generates text for a narrator or announcer based on a short prompt and style. (Shift+G)","search.node.audio_transcriber.title":"Audio Transcriber","search.node.audio_transcriber.description":"Uploads an audio or video file and converts its audio to text using Gemini API. (Shift+B)","search.node.youtube_title_generator.title":"YouTube Title Generator","search.node.youtube_title_generator.description":"Generates catchy titles, descriptions, and tags for a YouTube video. (Shift+T)","search.node.music_idea_generator.title":"Music Idea Generator","search.node.music_idea_generator.description":"Generates song lyrics or a musical prompt based on an idea. (Shift+M)","search.node.youtube_analytics":"YouTube Analytics","search.node.youtube_analytics.description":"Analyzes channel statistics and provides growth strategy advice. (Shift+Y)","search.node.image_editor.title":"Image Editor","search.node.image_editor.description":"Edit images with AI (Inpainting, Outpainting).","search.group.input":"Input","search.group.process":"Processing","search.group.scripting":"Scripting","search.group.character":"Characters","search.group.images":"Images","search.group.ai":"AI Tools","search.group.audio":"Audio","search.group.youtube":"YouTube","contextMenu.tools":"Tools","contextMenu.assignSlot":"Assign Slot {index}","contextMenu.addNodeFromSlot":"Add {node} ({index})","connectionMenu.title":"Add Node","quickAddMenu.title":"Quick Add","contextMenu.paste":"Paste (Ctrl+V)","node.content.simpleActions":"Simple Actions","node.content.smartConcept":"Smart Concept","tooltip.model.flash":"Gemini Flash: Fast, efficient, good for drafts.","tooltip.model.pro":"Gemini Pro: High intelligence, complex reasoning, detailed.","tooltip.lang.ru":"Generate script in Russian.","tooltip.lang.en":"Generate script in English.","tooltip.lang.es":"Generate script in Spanish.","tooltip.lang.de":"Generate script in German.","tooltip.lang.uz":"Generate script in Uzbek.","tooltip.lang.fr":"Generate script in French.","tooltip.lang.it":"Generate script in Italian.","tooltip.lang.pt":"Generate script in Portuguese.","tooltip.lang.zh":"Generate script in Chinese.","node.action.locateInStack":"Find in stack","help.tabs.hotkeys":"Help & Hotkeys","help.tabs.links":"Other Apps & Links","help.category.socials":"Socials","help.category.stable":"Google AI Studio (Stable)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":"Web / Netlify","help.category.github":"GitHub Repositories","help.link.youtube":"YouTube Channel","help.link.telegram_channel":"Telegram Channel","help.link.telegram_chat":"Telegram Chat","help.sub.news":"News & Updates","help.sub.discussion":"Discussion","help.sub.stable":"Stable Version","help.sub.alpha":"Alpha Version","languages.ru":"Russian","languages.en":"English","languages.es":"Spanish","languages.fr":"French","languages.de":"German","languages.it":"Italian","languages.pt":"Portuguese","languages.zh":"Chinese","languages.ja":"Japanese","languages.ko":"Korean","languages.uz":"Uzbek","youtube_analytics.mode.analytics":"Analytics","youtube_analytics.mode.planner":"Planner","planner.activeChannels":"Active Channels","planner.noChannels":"No channels. Add one in Analytics.","planner.addTask":"Add Task","planner.taskPlaceholder":"Video Idea or Title...","planner.noTasks":"No tasks for this day.","planner.globalGoals":"Global Goals","planner.dailyRoutine":"Daily Routine","planner.specificTasks":"Tasks","planner.dailyOverview":"Daily Overview","planner.newGoalTitle":"Title (e.g. Discipline)","planner.days":"Days","planner.addHabit":"Add habit...","planner.save":"Save","planner.cancel":"Cancel","planner.dayProgress":"Day {current}","planner.totalDays":"{total} Total","youtube_analytics.goal":"Goal","youtube_analytics.suggestion":"Suggestion","youtube_analytics.longViews":"Long Views","youtube_analytics.shortsViews":"Shorts Views","youtube_analytics.videoViews":"Video Views","youtube_analytics.monthlyViewsSum":"Monthly Views (Sum)","youtube_analytics.subs":"Subs","youtube_analytics.views_short":"Views","youtube_analytics.vids_short":"Vids","youtube_analytics.monetization":"Monetization","youtube_analytics.currentSubs":"Current Subs","youtube_analytics.accept":"Accept","youtube_analytics.videos_wk":"Videos (Wk)","youtube_analytics.vids_wk":"Videos/Wk","youtube_analytics.vids_mo":"Videos/Mo","youtube_analytics.subs_short":"Subs"},p1={"node.title.text_input":"Text Input","node.title.prompt_processor":"Prompt Processor","node.title.prompt_analyzer":"Prompt Analyzer","node.title.character_analyzer":"Character Analyzer","node.title.character_generator":"Character Generator","node.title.image_generator":"Image Generator","node.title.image_preview":"Image Preview","node.title.character_card":"Character Card","node.title.gemini_chat":"Gemini Chat","node.title.translator":"Translator","node.title.script_generator":"Script Generator","node.title.script_analyzer":"Script Analyzer","node.title.script_prompt_modifier":"Prompt Finalizer","node.title.error_analyzer":"Error Analyzer","node.title.note":"Note","node.title.reroute_dot":"Reroute Dot","node.title.data_reader":"Data Reader","node.title.speech_synthesizer":"Speech Synthesizer","node.title.idea_generator":"Idea Generator","node.title.narrator_text_generator":"Narrator Text Generator","node.title.audio_transcriber":"Audio Transcriber","node.title.youtube_title_generator":"YouTube Title Generator","node.title.music_idea_generator":"Music Idea Generator","node.title.youtube_analytics":"YouTube Analytics","node.title.image_editor":"Image Editor","node.help.text_input":"Enter basic ideas, keywords, or descriptions here. Can be connected to a Prompt Processor.","node.help.prompt_processor":"Takes text from other nodes and uses AI to combine them into a detailed, artistic prompt.","node.help.prompt_analyzer":"Analyzes incoming text and splits it into four parts: Environment, Character, Action, and Style.","node.help.character_analyzer":"Analyzes a character description and splits it into physical appearance and clothing.","node.help.character_generator":"Takes an idea prompt and generates one or more detailed character descriptions.","node.help.image_generator":"Generates an image from a text prompt using the Gemini API.","node.help.image_preview":"Displays an image from a file. Drag and drop an image file onto the node.","node.help.character_card":"Stores a character's image, name, and prompt. Allows image generation, saving, and loading.","node.help.gemini_chat":"Node for direct conversation with Gemini AI. Maintains chat history.","node.help.translator":"Translates incoming text to the selected language.","node.help.script_generator":"Takes a story idea and generates a series of script scenes.","node.help.script_analyzer":"Analyzes the script structure, breaking it down into characters and frames with detailed descriptions.","node.help.script_prompt_modifier":"Takes analyzed script data and synthesizes final, artistic prompts for image generation for each frame.","node.help.error_analyzer":"Checks and corrects text for spelling and grammar errors.","node.help.note":"A simple text area for your notes. Does not connect to other nodes.","node.help.reroute_dot":"A point to redirect and branch connections.","node.help.data_reader":"Displays raw text from a connection.","node.help.speech_synthesizer":"Converts text to speech using a selected voice.","node.help.idea_generator":"Two-stage node for generating ideas (Categories -> Idea).","node.help.narrator_text_generator":"Generates text for a narrator or announcer based on a short prompt and style.","node.help.audio_transcriber":"Uploads an audio or video file and converts its audio to text using Gemini API.","node.help.youtube_title_generator":"Generates catchy titles, descriptions, and tags for a YouTube video.","node.help.music_idea_generator":"Generates song lyrics or a musical prompt based on an idea.","node.help.youtube_analytics":"Analyzes channel statistics and provides growth strategy advice.","node.help.image_editor":"Edit images with AI (Inpainting, Outpainting).","node.action.help":"Help","node.action.expand":"Expand","node.action.collapse":"Collapse (H)","node.action.expandAll":"Expand All","node.action.collapseAll":"Collapse All","node.action.expandAllScenes":"Expand All Scenes","node.action.collapseAllScenes":"Collapse All Scenes","node.action.expandAllFrames":"Expand All Frames","node.action.collapseAllFrames":"Collapse All Frames","node.action.expandPanel":"Expand Panel","node.action.collapsePanel":"Collapse Panel","node.action.togglePanel":"Toggle Panel","node.action.collapseScene":"Collapse Scene","node.action.expandScene":"Expand Scene","node.action.collapseFrame":"Collapse Frame","node.action.expandFrame":"Expand Frame","node.action.collapseCharacter":"Collapse Character","node.action.expandCharacter":"Expand Character","node.action.clear":"Clear","node.action.clearTooltip":"Clear input field.","node.action.clearChat":"Clear Chat","node.action.paste":"Paste","node.action.copy":"Copy","node.action.duplicateWithContent":"Duplicate (Content)","node.action.duplicateEmpty":"Duplicate (Empty)","node.action.cutConnections":"Cut Connections","node.action.close":"Close","node.action.executeChain":"Execute Chain","node.action.executeFullChain":"Execute Full Chain","node.action.processChainForward":"Process Chain Forward","node.action.executeChainTitle":"Execute all connected nodes.","node.action.addCharacter":"Add Character","node.action.addScene":"Add Scene","node.action.addFrame":"Add Frame","node.action.addFirstFrame":"Add First Frame","node.action.deleteItem":"Delete","node.action.moveUp":"Move Up","node.action.moveDown":"Move Down","node.action.saveImage":"Save Image","node.action.loadImage":"Load Image","node.action.saveCharacter":"Save to Disk","node.action.loadCharacter":"Load from Disk","node.action.readData":"Read Data","node.action.refreshData":"Refresh Data","node.action.stop":"Stop","node.action.stopping":"Stopping...","node.action.embedCharacter":"Embed Character","node.action.downloadFinalPrompts":"Download Prompts","node.action.rename":"Rename","node.action.index":"Index","node.action.improveConcept":"Improve Concept","node.action.improveConceptTooltip":"Enrich and add visual details.","node.action.downloadJson":"Download JSON","node.action.downloadSRT":"Download SRT","node.action.markPrimary":"Mark as Primary","node.input.default":"Input","node.output.default":"Output","node.output.allCharacters":"All Characters","node.output.primaryCharacter":"Primary Character","node.content.action":"Action","node.content.actionPlaceholder":"Action prompt...","node.content.allScriptParts":"All Script Parts","node.content.allScriptAnalyzerData":"Analyzer Data","node.content.allNarratorData":"All Narrator Data","node.content.analyzeCharacters":"Analyze Characters","node.content.analyzeFromScene":"Analyze From:","node.content.analyzeUpToScene":"to","node.content.endPlaceholder":"end","node.content.generateFromFrame":"Generate From Frame:","node.content.generateUpToFrame":"to frame","node.content.analyzeFromFrame":"Finalize From Frame:","node.content.processFromFrame":"Process From Frame:","node.content.processFromScene":"Process From Scene:","node.content.analyzePrompt":"Analyze Prompt","node.content.analyzeScript":"Analyze Script","node.content.analyzing":"Analyzing...","node.content.applyAliases":"Apply Aliases","node.content.applyAliasesTooltip":"Replaces names with aliases (Index).","node.content.character":"Character","node.content.characterIndex":"Index","node.content.characterPlaceholder":"Character prompt...","node.content.character_plural":"characters","node.content.characters":"Characters","node.content.charactersSynced":"Characters Synced","node.content.noCharactersConnected":"No characters connected.","node.content.appearance":"Appearance","node.content.personality":"Personality","node.content.characterType":"Type","node.content.characterTypeShort":"Type","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Anthro (Animals)","node.content.characterType.chibi":"Chibi (Cute)","node.content.characterType.key_item":"Key Item","node.content.style":"Style","node.content.style.none":"None","node.content.style.simple":"Simple","node.content.style.realistic":"Realistic/Cinematic","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Realistic","node.content.style.2d_animation":"2D Animation","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Custom","node.content.chatPlaceholder":"Type a message...","node.content.clothing":"Clothing","node.content.clothingPlaceholder":"Clothing prompt...","node.content.connectedPlaceholder":"Connected","node.content.dataPlaceholder":"Data will appear here...","node.content.readData":"Read Data","node.content.reading":"Reading...","node.content.description":"Description","node.content.sceneDescription":"Scene Description","node.content.duration":"Duration","node.content.enhancePrompt":"Generate Prompt","node.content.enhancedPromptHere":"Enhanced prompt will appear here...","node.content.enhancing":"Enhancing...","node.content.environment":"Environment","node.content.environmentPlaceholder":"Environment prompt...","node.content.environmentPrompt":"Environment & Background","node.content.compositionAndBlocking":"Composition & Action","node.content.executingChain":"Executing Chain...","node.content.imagePrompt":"Image Prompt","node.content.finalPrompt":"Final Prompt","node.content.finalPrompt_plural":"Final Prompts","node.content.fixErrors":"Fix Errors","node.content.fixingErrors":"Fixing...","node.content.frame":"Frame","node.content.frame_plural":"Frames","node.content.frames":"Output Frames","node.content.frames_analyzed":"Frames Analyzed: {count}","node.content.framesPerScene":"Frames per Scene","node.content.minFrames":"Min","node.content.maxFrames":"Max","node.content.numberOfCharactersShort":"Qty","node.content.fullDescription":"Full Description","node.content.generateCharacters":"Generate Characters","node.content.generateEntities":"GENERATE CHARACTERS","node.content.generateFinalPrompts":"Generate Final Prompts","node.content.generatingProgress":"Generating {current} of {total}","node.content.generateImage":"Generate Image","node.content.generateScript":"Generate Script","node.content.generateSpeech":"Generate Speech","node.content.generateText":"Generate Text","node.content.generateSSML":"Generate SSML","node.content.generateStyle":"Generate Style","node.content.generating":"Generating...","node.content.improving":"Improving...","node.content.generatedAudio":"Generated Audio","node.content.imagePromptPlaceholder":"Enter prompt for image...","node.content.modificationPromptPlaceholder":"Modification request...","node.content.narrator":"Narrator","node.content.narratorEnabled":"Enable Narrator","node.content.narratorEnabledInfo":"Adds voiceover text.","node.content.narratorMode":"Narrator Mode","node.content.narratorMode.normal":"Normal / Voiceover","node.content.narratorMode.dual":"Two Narrators","node.content.narratorMode.first_person":"First Person","node.content.role":"Role","node.content.role.narrator":"Narrator","node.content.role.announcer":"Announcer","node.content.role.first_person":"First Person","node.content.role.dual_narrator":"Two Narrators","node.content.role.dual_announcer":"Two Announcers","node.content.scene":"Scene","node.content.scene_plural":"scenes","node.content.scenes":"Scenes","node.content.scenes_generated":"Scenes Generated: {count}","node.content.sceneContext":"Scene Context","node.content.sceneContextPlaceholder":"Mood, environment, light...","node.content.scriptPromptPlaceholder":"Enter story idea...","node.content.seconds":"sec","node.content.stylePlaceholder":"Style prompt...","node.content.stylePromptPlaceholder":"Enter style prompt here...","node.content.styleOverride":"Override Style","node.content.summary":"Summary","node.content.targetLanguage":"Target Language","node.content.textToSynthesize":"Text to synthesize...","node.content.translate":"Translate","node.content.translatePlaceholder":"Text to translate...","node.content.translatedTextPlaceholder":"Translation will appear here...","node.content.translating":"Translating...","node.content.useExistingCharacters":"Use existing characters","node.content.useExistingCharactersInfo":"Uses data from connected characters instead of generating new ones.","node.content.createKeyItem":"Create Secondary/Items","node.content.createSecondaryChars":"Secondary Characters","node.content.createKeyItems":"Key Items","node.content.createKeyItemInfo":"Allows AI to create secondary characters or items.","node.content.noCharacters":"No Characters","node.content.noCharactersInfo":"Focus on events and atmosphere (documentary style).","node.content.videoPrompt":"Dynamics & Motion","node.content.videoPrompts":"Video Prompts","node.content.voice":"Voice","node.content.previewVoice":"Test Voice","node.content.voicePreviewText":"Hello, this is a voice test.","node.content.inputScripts":"Input Scenes","node.content.inputFrames":"Input Frames","node.content.outputScript":"Output Scenes","node.content.requestCategories":"Request Categories","node.content.generateIdea":"Generate Idea","node.content.requestNewCategories":"New Categories","node.content.category.action":"Action","node.content.category.place":"Place","node.content.category.obstacle":"Obstacle","node.content.generatedIdea":"Generated Idea","node.content.storyFormat":"Story Format","node.content.theme":"Theme","node.content.parameters":"Parameters","node.content.advancedMode":"Advanced Mode","node.content.numberOfScenes":"Number of scenes","node.content.numberOfScenes.auto":"Auto","node.content.detailedPlot":"Detailed Plot","node.content.detailedPlotInfo":"Enables detailed descriptions.","node.content.includeSubscribeScene":"Subscribe Scene","node.content.includeSubscribeSceneInfo":"Adds a scene asking to subscribe.","node.content.genre":"Genre","node.content.genre2":"Genre 2","node.content.breakIntoParagraphs":"Break Paragraphs","node.content.copyVideoPrompt":"Copy Video Prompt","node.content.generateVideoPrompt":"Generate Video Prompt","node.content.model":"Model","node.content.processWholeScene":"Process Whole Scene","node.content.processWholeSceneInfo":"Processes all frames of a scene at once for consistency.","node.content.batchProcessing":"Batch Processing","node.content.batchProcessingInfo":"Process all selected scenes in one context.","node.content.extendedAnalysis":"Extended Analysis","node.content.extendedAnalysisInfo":"Splits scenes into detailed shots.","node.content.professionalStoryboard":"Director Storyboard","node.content.professionalStoryboardInfo":"Analysis based on cinematographic rules.","node.content.generateStartEndFrames":"Generate Start/End Frames","node.content.autoIndexCharacters":"Auto-index Characters","node.content.autoIndexCharactersInfo":"Automatically replaces names with aliases.","node.content.imageToText":"Image to Text","node.content.extracting":"Extracting...","node.content.extractedText":"Extracted Text","node.content.activePromptStack":"Active Prompt Stack","node.content.noCharactersAnalyzed":"No characters analyzed.","node.content.promptsGeneratedPlaceholder":"Generated prompts will appear here.","node.content.noCharactersInScript":"No characters in script.","node.content.noInputScenes":"No input data. Please connect a Script Generator.","node.content.status":"Status","node.content.status.ready":"Ready","node.content.status.paused":"Paused","node.content.status.generating":"Generating","node.content.status.total":"Total: {generated} / {total}","node.content.status.batch":"Processing: {current} of {total}","node.content.status.time":"Time: {current}s / {total}s","node.content.refreshing":"Refreshing...","node.content.totalFrames":"Total Frames: {count}","node.content.uploadAudio":"Upload Audio/Video","node.content.noAudioLoaded":"No audio","node.content.audioLoaded":"Audio loaded","node.content.transcriptionPlaceholder":"Transcription will appear here...","node.content.transcribe":"Transcribe","node.content.transcribing":"Transcribing...","node.content.convertingVideo":"Converting video...","node.content.recommendedFrames":"Estimated Frames","node.content.shotType":"Shot","node.content.shotType.ws":"WS (Wide)","node.content.shotType.ms":"MS (Medium)","node.content.shotType.cu":"CU (Close-up)","node.content.shotType.ecu":"ECU (Extreme Close-up)","node.content.shotType.ls":"LS (Long Shot)","node.content.characterDetail":"Character Detail","node.content.noCharDesc":"No Character Desc","node.content.includeGeneralCharDesc":"General Visual Desc","node.content.includeFullCharDesc":"Detailed Visual Desc","node.content.safeGeneration":"Safe Generation","node.content.shotFilter":"Shot Filter","node.content.shotFilter.all":"All","node.content.shotFilter.wideOnly":"Wide Only","instruction.desc.shot_filter_all":"Allow all shot types (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Restrict to wide shots (WS, MS, LS). No close-ups.","node.content.anthroEnabled":"Anthro Animals","node.content.subscribeEnhancement":"Enhance Subscribe CTA","node.content.thinkingEnabled":"Thinking Mode","node.content.scenelessMode":"Sceneless","instruction.desc.sceneless_mode":"Disable narrative engine. Generate scenes directly from concept.","instruction.sceneless_mode":"Scene List Mode","node.content.microActionBreakdown":"Micro-Actions","node.content.microActionBreakdownInfo":"Decomposes complex actions into phases (Prep, Action, Reaction).","node.content.commercialSafe":"Commercial Safe","instruction.desc.commercial_safe":"Strictly avoids trademarks (Disney, Pixar, etc.) and replaces with generic descriptions.","node.content.findStack":"Find in stack...","node.content.notePlaceholder":"Enter your note here...","node.content.textInputPlaceholder":"Enter text here...","node.content.spm_stack.priming":"1. Priming & Context","node.content.spm_stack.physics":"2. Physics & Logic","node.content.spm_stack.hierarchy":"3. Subject Hierarchy","node.content.spm_stack.construction":"4. Construction & Format","node.content.scriptGenerationStack":"SCRIPT GENERATION STACK","node.content.entityGenerationStack":"ENTITY GENERATION STACK","node.content.sg_stack.priming":"PRIMING & CONTEXT","node.content.mainChars":"MAIN","node.content.secChars":"SECONDARY","node.content.keyItems":"ITEMS","node.content.thumbnailPrompt":"Thumbnail Prompt","node.content.stack.system":"1. System & Context","node.content.stack.role":"2. Role & Core Logic","node.content.stack.cinematography":"3. Cinematography","node.content.stack.world":"4. World & Continuity","node.content.sg_stack.narrative":"NARRATIVE ENGINE","node.content.sg_stack.world":"VISUAL WORLD","node.content.sg_stack.constraints":"OUTPUT FORMAT & CONSTRAINTS","node.content.suffix":"Suffix"},h1={"genre.general":"General","genre.comedy":"Comedy","genre.drama":"Drama","genre.action":"Action","genre.scifi":"Sci-Fi","genre.fantasy":"Fantasy","genre.horror":"Horror","genre.thriller":"Thriller","genre.childrens_animation":"Animated cartoons for children","genre.shorts_story":"Short stories for shorts","genre.scientific_historical":"Scientific-Historical Narrative","character_generator.promptPlaceholder":'Enter an idea, e.g., "brave knight, keeper of the ancient forest, who protects a magical sword"',"idea_generator.randomTheme":"Get a random theme","idea_generator.randomCombination":"Random Combination","idea_generator.themePlaceholder":"e.g., Space, Kitchen, Fantasy Forest","idea_generator.initialMessage":'Fill in a theme (optional) and click "{buttonName}" to get started.',"idea_generator.ideaPlaceholder":"The generated idea will appear here...","idea_generator.format.general":"General","idea_generator.format.childrens":"Children's","idea_generator.format.adventure":"Adventure","idea_generator.format.fantasy":"Fantasy / Magic","idea_generator.format.detective":"Detective","idea_generator.format.scifi":"Sci-Fi","idea_generator.format.horror":"Horror","idea_generator.format.historical":"Historical","gender.male":"Male","gender.female":"Female","node.content.autoDownload":"Auto-download upon generation","node.content.downloadSelected":"Download Selected","node.content.intonation":"Intonation","intonation.standard":"Standard","intonation.cheerful":"Cheerful","intonation.angry":"Angry","intonation.sad":"Sad","intonation.excited":"Excited","intonation.announcer":"Announcer","intonation.whispering":"Whispering","node.content.sceneMode":"Scene Mode","node.content.connectNarratorData":"Connect 'All Narrator Data' from a Script Generator.","node.content.sceneModeActive":"Scene Mode is active. Data is received from connection.","speech_synthesizer.mode.simple":"Simple","speech_synthesizer.mode.scene":"Scene","speech_synthesizer.multiSpeaker":"Two Speakers","speech_synthesizer.speaker1Name":"Speaker 1 Name","speech_synthesizer.speaker2Name":"Speaker 2 Name","speech_synthesizer.multiSpeakerHint":'Speaker names must match the names in the text (e.g., "Man: ...", "Woman: ...").',"speech_synthesizer.ssmlHint":"Intonation is controlled by SSML tags in the text.","youtube_analytics.authorName":"Author Name","youtube_analytics.videoTitle":"Video Title","youtube_analytics.views":"Views","youtube_analytics.addToChannel":"Add to Channel","youtube_analytics.noIncomingData":"No incoming data.","youtube_analytics.videoAdded":"Video added!","youtube_analytics.dragDrop":"Drag & Drop Row Screenshot Here","youtube_analytics.thumbnailUpdated":"Thumbnail updated","youtube_analytics.statsTrend":"Stats Trend","youtube_analytics.currentChannel":"Current Channel","youtube_analytics.growth":"Growth","youtube_analytics.allChannels":"All Channels","youtube_analytics.saveDisk":"Save to Disk","youtube_analytics.saveCatalog":"Save to Catalog","youtube_analytics.loadDisk":"Load from Disk","youtube_analytics.analyzing":"Analyzing...","youtube_analytics.askAI":"Ask AI for Advice","youtube_analytics.clickForAdvice":'Click "Ask AI" to get advice.',"youtube_analytics.dailyNotes":"Daily Notes","youtube_analytics.logDailyStats":"Log Daily Stats","youtube_analytics.subscribers":"Subscribers","youtube_analytics.totalViews":"Total Views","youtube_analytics.updateStats":"Update Stats","youtube_analytics.history":"History","youtube_analytics.noHistory":"No history yet.","youtube_analytics.noNotes":"No notes yet.","youtube_analytics.noVideos":"No videos yet.","youtube_analytics.loadedFromDisk":"Loaded from disk","youtube_analytics.loadFailed":"Failed to load file","youtube_analytics.savedToDisk":"Saved to disk","youtube_title_generator.mode.title":"Video Title","youtube_title_generator.mode.channel":"Channel Info","youtube_title_generator.ideaPlaceholder":"Enter video idea or topic...","youtube_title_generator.channelIdeaPlaceholder":"Enter channel theme or niche...","youtube_title_generator.title":"Title","youtube_title_generator.description":"Description","youtube_title_generator.tags":"Tags","youtube_title_generator.channelName":"Channel Name","youtube_title_generator.channelDescription":"Channel Description","youtube_title_generator.channelKeywords":"Keywords","youtube_title_generator.channelHandle":"Handle (@)","music_idea_generator.mode.lyrics":"Lyrics","music_idea_generator.mode.music_prompt":"Music Prompt","music_idea_generator.ideaPlaceholder":"Enter song theme or mood...","music_idea_generator.songTitle":"Song Title","music_idea_generator.songTitlePlaceholder":"Title...","music_idea_generator.lyricsPlaceholder":"Lyrics will appear here...","music_idea_generator.musicPromptPlaceholder":"AI Music Prompt will appear here...","chat.mode.general":"General","chat.mode.script":"Script Expert","chat.mode.prompt":"Prompt Expert","chat.mode.youtube":"YouTube Expert","youtube_analytics.goalPlaceholder":"e.g. 1000 Subscribers","youtube_analytics.videoDescriptionPlaceholder":"Video description...","youtube_analytics.contextPlaceholder":"Ask specific question or provide context..."},m1={"catalog.title":"Catalog","catalog.tabs.groups":"Groups","catalog.tabs.library":"Prompt Library","catalog.tabs.characters":"Characters","catalog.tabs.scripts":"Scripts","catalog.tabs.analysis":"Analysis","catalog.tabs.final_prompts":"Final Prompts","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"Music Ideas","catalog.empty.title":"Catalog is empty","catalog.empty.description":"Save an item to see it here, or import one from a file.","catalog.loadFromFile":"Add to Catalog from File","catalog.card.addToCanvas":"Add to Canvas","catalog.card.rename":"Rename","catalog.card.save":"Save to Disk","catalog.card.delete":"Delete","library.loadFromFile":"Load from File","library.empty.title":"Folder is empty","library.empty.description":"Create a new folder or prompt to get started.","library.emptyPrompt":"No content","library.actions.newFolder":"New Folder","library.actions.newPrompt":"New Prompt","library.actions.copy":"Copy to Clipboard","library.actions.edit":"Edit Prompt","group.rename":"Rename Group","group.saveToCatalog":"Save to Catalog","group.saveToDisk":"Save to Disk","group.ungroup":"Ungroup (Shift+Click to delete content)","group.button.create":"Group ({count})"},g1={"dialog.rename.title":"Rename Item","dialog.rename.group.title":"Rename Group","dialog.rename.catalog.title":"Rename Catalog Item","dialog.rename.label":"New name","dialog.rename.confirm":"Rename","dialog.rename.cancel":"Cancel","dialog.promptEdit.title":"Edit Prompt","dialog.promptEdit.nameLabel":"Prompt Name","dialog.promptEdit.contentLabel":"Prompt Content","dialog.promptEdit.confirm":"Save","dialog.promptEdit.cancel":"Cancel","dialog.reset.title":"Reset Canvas","dialog.reset.message":"Are you sure you want to reset the canvas to its default state? This will clear all current work and restore the initial template.","dialog.exit.title":"Close Project?","dialog.exit.message":"Are you sure? All unsaved data will be lost, and you will return to the welcome screen.","dialog.settings.title":"Settings","dialog.settings.apiKeyLabel":"Gemini API Key","dialog.settings.apiKeyPlaceholder":"Enter your API key here","dialog.settings.getApiKeyLink":"Get your API key from Google AI Studio","dialog.settings.useFreeKey":"Use the free (limited) API key","dialog.settings.save":"Save","dialog.settings.close":"Close","dialog.apiKey.title":"API Key Settings","dialog.apiKey.description":"To use this application, you need a Gemini API key. Please enter your key below. It will be stored locally in your browser.","dialog.apiKey.keyExists":"An API key is already saved in your browser.","dialog.apiKey.clear":"Clear Saved Key","dialog.apiKey.save":"Save Key","dialog.apiKey.update":"Update Key","dialog.apiKey.useFreeKey":"Use free key (for development)","dialog.permission.title":"Clipboard Access","dialog.permission.description":'This application requests access to your clipboard to enable the "Paste" functionality in nodes. We will only read from your clipboard when you explicitly use this feature.',"dialog.permission.decline":"Decline","dialog.permission.allow":"Allow","alert.groupSaved":'Group "{groupTitle}" saved to catalog!',"toast.groupSavedToDisk":'Group "{groupTitle}" saved to disk!',"alert.confirmDelete":"Are you sure you want to delete this item from the catalog?","alert.invalidCatalogFile":"Invalid or corrupted catalog item file.","alert.loadCatalogFailed":"Failed to load catalog item","alert.confirmLoadProject":"Loading a project will replace all current data (tabs, catalog, settings). Are you sure?","dialog.confirmDelete.title":"Confirm Deletion","dialog.confirmDelete.message":'Are you sure you want to delete "{itemName}"? This action cannot be undone.',"dialog.confirmDelete.folderMessage":'Are you sure you want to delete the folder "{itemName}" and all its contents? This action cannot be undone.',"dialog.confirmDelete.confirm":"Delete","dialog.confirmDelete.cancel":"Cancel","dialog.confirmClear.title":"Confirm Clear Canvas","dialog.confirmClear.message":"Are you sure you want to delete everything on the canvas? This action cannot be undone.","toast.copied":"Copied to clipboard","toast.pasted":"Pasted!","toast.cleared":"Cleared","toast.resetComplete":"Reset to default","toast.projectSaved":"Project saved to disk","toast.canvasSaved":"Canvas saved to disk","toast.saveFailed":"Failed to save project","toast.connectionsCut":"Connections cut","toast.charSaved":"Character saved to disk","toast.charLoaded":"Character loaded","toast.videoPasted":"Video added from clipboard","toast.savedToCatalog":"Saved to Catalog","toast.apiKeySaved":"API Key saved successfully","toast.apiKeyCleared":"API Key cleared","toast.projectLoaded":"Project loaded successfully","alert.batchMismatch":"Warning: Scene {scene} frame count mismatch (Expected: {expected}, Got: {got}). Mapping best effort."},f1={"instruction.desc.safe_gen":"CRITICAL SAFETY CONSTRAINT: Strictly avoid any words that trigger AI safety filters. Replace terms like 'teenager', 'intimate', or 'revealing' with artistic alternatives like 'young person', 'artistic composition', or 'stylized'.","instruction.desc.layered_no_style":"Structure: 1. [Global Background] -> 2. [Subject Visuals] + [FULL POSE & ACTION] -> 3. [Camera]. You MUST describe the physical body geometry and movement."},y1={"instruction.sg_inputs":"Input Data","instruction.desc.sg_inputs":"Source: Concept/Idea, Character Profiles.","instruction.core_director":"VFX Supervisor","instruction.desc.core_director":"You are a VFX Supervisor. Describe raw footage, lighting, and physics, NOT literary feelings.","instruction.sg_thinking":"Visual Logic","instruction.desc.sg_thinking":"Visualize the set physics before writing. Where is the light coming from?","instruction.sg_improve_input":"The Sacred Prompt","instruction.desc.sg_improve_input":"The input prompt is SACRED. Do not discard ANY detail. Keep every smell, item, and color, then expand around it.","instruction.sg_anti_compression":"Anti-Compression","instruction.desc.sg_anti_compression":'ZERO OMISSION POLICY. Forbidden to summarize. Output text must be LONGER than input. If input says "cinnamon", output must have "cinnamon".',"instruction.sg_exposition":"Atmospheric Entry","instruction.desc.sg_exposition":"MANDATORY: Start every scene with 2-3 sentences establishing the location/mood BEFORE the character appears.","instruction.sg_delayed_reveal":"Cinematic Reveal","instruction.desc.sg_delayed_reveal":'Do not show the face immediately. Use "view from behind", "through objects", or "establishing shots" first.',"instruction.sg_metaphor":"Visual Proxies","instruction.desc.sg_metaphor":"Use visual symbols (broken objects, weather) to convey internal character states.","instruction.sg_pacing":"Action Atomization","instruction.desc.sg_pacing":"Break down every verb into 3-5 physical micro-movements.","instruction.sg_subtext":"Subtext","instruction.desc.sg_subtext":"Create tension between dialogue and action. Characters should rarely speak the truth directly.","instruction.desc.sg_frame_estimation":"Dynamic analysis: 5-9 frames (Low), 10-15 (Mid), 16-25 (High). Count visual beats.","instruction.rule_visuals":"Physics Only","instruction.desc.rule_visuals":"Show, Don't Tell. Describe physical actions and environmental changes.","instruction.sg_visual_dna":"Visual DNA","instruction.desc.sg_visual_dna":"Comprehensive description of lighting, color palette, and atmosphere.","instruction.rule_flow":"Seamless Flow","instruction.desc.rule_flow":"Ensure logical continuity between scenes.","instruction.rule_atmosphere":"Atmosphere","instruction.desc.rule_atmosphere":"Describe tactile details. PRESERVE specific smells and sounds from input by converting them to visual cues.","instruction.sg_visual_style":"Visual Style","instruction.desc.sg_visual_style":"Request: Generate a detailed visual style description based on '{style}'.","instruction.char_detailed_style":"Stylized Detail","instruction.desc.char_detailed_style":"Integrates the global visual style into each character's technical generation prompt for maximum visual consistency.","instruction.sg_genre":"Genre Context","instruction.desc.sg_genre":"Context: {genre}","instruction.char_smart_concept":"Smart Concept","instruction.desc.char_smart_concept":"AI chooses: Full Body for Characters / Frame-Fill for Objects.","instruction.char_no_dupes":"No Duplicates","instruction.desc.char_no_dupes":"CRITICAL: Do NOT re-generate characters unless a COSTUME CHANGE is required. In that case, create a duplicate with the new outfit.","instruction.create_secondary_chars":"Secondary Characters","instruction.desc.create_secondary_chars":"You MAY generate new secondary characters if the plot requires it. Costume changes are allowed.","instruction.create_key_items":"Key Items","instruction.desc.create_key_items":"Mandatory creation of 'Character Cards' for items appearing in >2 frames or multiple scenes.","instruction.char_secondary_ok":"New Chars Allowed","instruction.desc.char_secondary_ok":"You MAY generate new secondary characters or key items. IF OUTFIT CHANGE: Create a new card for the main character with the new clothing prompt.","instruction.sg_anthro":"Anthro","instruction.desc.sg_anthro":"Characters must be Anthropomorphic animals.","instruction.sg_no_chars":"No Characters","instruction.desc.sg_no_chars":"Documentary style / No named characters.","instruction.sg_detailed_plot":"Detailed Plot","instruction.desc.sg_detailed_plot":"Provide highly detailed descriptions of actions and plot.","instruction.sg_subscribe":"Subscribe Scene","instruction.desc.sg_subscribe":"Include a 4th-wall breaking subscribe scene.","instruction.char_gray_bg":"Visual Concept","instruction.desc.char_gray_bg":"For every character visual prompt, ALWAYS append: ', full body character concept on a gray background'.","instruction.char_no_new":"No New Chars","instruction.desc.char_no_new":"Do NOT create any new characters or items. Use ONLY the provided Existing Characters.","instruction.sg_new_chars":"New Characters","instruction.desc.sg_new_chars":"Generate new characters based on prompt.","instruction.sg_living_world":"Living World","instruction.desc.sg_living_world_simple":"Background extras are normal people.","instruction.desc.sg_living_world_anthro":"Background extras are animals.","instruction.sg_simple_actions":"Simple Actions","instruction.desc.sg_simple_actions":"Avoid complex physics/gymnastics. Prefer stable, renderable poses.","instruction.commercial_safe":"Commercial Safe","instruction.desc.commercial_safe":"Strictly avoids known trademarks, brands (Disney, Pixar, etc.), and copyrighted character names."},x1={"instruction.ana_role":"Analyzer Role","instruction.desc.ana_role":"You are a world-class Film Director and Cinematographer. You write instructions for AI generation. Each frame must be described repeatedly and in detail, independently of the previous one, while maintaining the context of previous frames. Do not use literary abbreviations or devices.","instruction.ana_cinema":"Cinematography","instruction.desc.ana_cinema":"Professional terms: Wide Shot, Close-up, Dutch Angle, Bokeh for framing and lighting.","instruction.ana_cinema_wide":"Cinematography (Wide)","instruction.desc.ana_cinema_wide":"Professional terms: Wide Shot, Long Shot. NO Close-ups.","instruction.ana_anthro_logic":"Anthro Logic","instruction.desc.ana_anthro_logic":'Explicitly describe characters as Anthropomorphic Animals (e.g., "Anthropomorphic Fox") in every frame description.',"instruction.ana_subscribe_logic":"Subscribe CTA","instruction.desc.ana_subscribe_logic":"If the scene asks to Subscribe, add visual actions: characters holding signs or interacting with 3D text.","instruction.rule_hierarchy":"Master Framing Algorithm","instruction.desc.rule_hierarchy":"Strict order: 1. Global Context. 2. Full Character Posture & Active Interaction (e.g. dragging). 3. Detail. Describe the full action even if partly out of frame.","instruction.rule_living_world":"Living World","instruction.desc.rule_living_world":"If public place, describe background extras/silhouettes consistent with the world context.","instruction.desc.rule_living_world_anthro":"Background extras/crowds must be Anthropomorphic Animals (NOT humans).","instruction.rule_persistence":"Persistence","instruction.desc.rule_persistence":"SCENE-WIDE CHRONOLOGICAL PERSISTENCE: Maintain a persistent global state for the entire scene. Every frame is part of a single physical space. Track the exact position, pose, and status of every character and object, even when they are off-camera. If Character A is in Frame 1 but the camera cuts to Character B in Frame 2, Character A must still exist logically in their last position. If an object is moved, it stays moved. Ensure total continuity across the sequence.","instruction.rule_mandatory_bg":"Set Design Manifesto","instruction.desc.rule_mandatory_bg":"MANDATORY: Describe the PHYSICAL SET, not just a 'background'. 1. Location (In/Out). 2. Furniture (Color, Material, Position). 3. Lighting (Warm/Cold) & Palette. This context is fixed and applies to all frames.","instruction.desc.rule_mandatory_bg_wide":"FORBIDDEN to leave background empty. Since you are using WIDE SHOTS only, you must provide comprehensive geography, horizon, and weather details in every frame.","instruction.shot_filter_wide":"Wide Shots Only","instruction.desc.shot_filter_wide":"STRICT FILTER: Use ONLY Wide, Long, and Medium shots. Close-ups (CU/ECU) are forbidden.","instruction.storyboard_rules":"Shot Variety","instruction.desc.storyboard_rules":"Alternate between WS/LS (Wide), MS (Medium), and CU/ECU (Close-up) shots for dynamic pacing and emotional focus.","instruction.storyboard_rules_wide":"Shot Variety (Wide Only)","instruction.desc.storyboard_rules_wide":"Use only Wide, Long, and Establishing shots. Vary the angle (Low/High/Aerial). NO Close-ups.","instruction.tech_directives":"Camera Control","instruction.desc.tech_directives":"Strict technical terminology. For shot types use ONLY abbreviations (WS, MS, CU).","instruction.tech_directives_wide":"Camera Control (Wide)","instruction.desc.tech_directives_wide":"Strict technical terminology. Use ONLY abbreviations (WS, MS, LS). NO CU/ECU.","instruction.use_aliases":"Use Aliases","instruction.desc.use_aliases":"Use Entity-N format (Strictly English). Rest of text in target language.","instruction.character_array_integrity":"Array Integrity","instruction.desc.character_array_integrity":"CRITICAL: The `characters` array MUST include every Entity-N mentioned in the prompt text.","instruction.action_phase_breakdown":"Micro-Actions","instruction.desc.action_phase_breakdown":"Decompose complex actions into preparation, initiation, apex, and reaction phases.","instruction.desc.action_phase_breakdown_wide":"Decompose phases, but KEEP CAMERA WIDE. Show impact via full-body posture, not zoom.","instruction.batch_processing":"Batch Processing","instruction.desc.batch_processing":"Analyze all provided scenes as a continuous sequence to maintain narrative and visual consistency.","instruction.ana_prompt_lang":"Prompt Language","instruction.desc.ana_prompt_lang":"Image and video prompts are strictly in English for best model compatibility.","instruction.extended_visuals":"Extended Visual Breakdown","instruction.desc.extended_visuals":"Decomposes scenes into short, expressive sequences (Wide, MS, CU, Detail). Focuses on cinematic rhythm, vibrant emotions, dynamic composition, and sincere energy.","instruction.extended_visuals_wide":"Extended Visual Breakdown (Wide)","instruction.desc.extended_visuals_wide":"Decomposes scenes into sequences using strictly Wide/Medium shots. Focuses on geography, group dynamics, and atmosphere. No Close-ups.","instruction.desc.target_lang":"Frame analysis and descriptions will be generated in this language.","instruction.rule_isolation":"Zero Context","instruction.desc.rule_isolation":"CRITICAL: The image generator DOES NOT know about the previous frame. You MUST re-describe the environment and weather in every single frame.","instruction.sensory_saturation":"Anti-Brevity","instruction.desc.sensory_saturation":'FORBIDDEN to be brief. Instead of "Hands gripping", write "Dirty hands with white knuckles tightly gripping the cold glass".',"instruction.ana_no_pov":"No POV","instruction.desc.ana_no_pov":'CRITICAL NEGATIVE: STRICT BAN on "POV" or "First-Person" shots. The camera MUST be external (Over-the-shoulder, Wide, etc.).',"instruction.desc.static_frame_logic":'STRICT BAN on movement verbs ("walking", "swaying"). Describe a FROZEN moment. "Foam frozen in air", "Leaves angled by wind".',"instruction.desc.anatomical_posing":'Describe body GEOMETRY. Instead of "resting", write: "Lying supine, arms at sides, head tilted back".',"instruction.desc.motion_dynamics":"SEPARATION: Image Prompt = 100% Static. Video Prompt = Movement & Time (breathing, waves, wind).","instruction.desc.anatomical_strictness":'RIGGING: Prevents "Arms behind head AND holding drink". Forces separate description: Left Arm [state], Right Arm [state]. Eliminates extra limbs.',"instruction.desc.prop_consistency":'OBJECT LOCK: Forbidden to use generic nouns ("sword", "phone"). Must specify visual attributes ("rusted iron sword", "cracked black phone") and repeat them.',"instruction.desc.subject_hierarchy":'INVISIBLE CONTEXT: If showing a Close-up of feet, you MUST describe: "Feet of Character-A WHO IS DRAGGING Character-B". Link the part to the whole action.',"instruction.inputs_data":"Inputs","instruction.desc.inputs_data":"Source Data: Script Summary, Character Profiles, Scene Texts.","instruction.static_frame_logic":"Strict Static","instruction.anatomical_posing":"Anatomical Posing","instruction.anatomical_strictness":"Anatomy Logic","instruction.prop_consistency":"Object Specificity","instruction.subject_hierarchy":"Context Anchoring","instruction.motion_dynamics":"Motion Dynamics","instruction.entity_limit":"Entity Limit","instruction.desc.entity_limit":"STRICTLY FORBIDDEN to use more than 3 entities per frame. Break crowded scenes into smaller group shots."},v1={"instruction.inputs":"Inputs","instruction.desc.inputs":"Source Data: Script Frames, Character Visuals, Scene Style, Global Scene Context.","instruction.role":"Role: Lead Environment Artist","instruction.desc.role":"You are an expert Lead Environment Artist and AI Prompt Engineer. Synthesize inputs into a definitive visual description.","instruction.layered":"Algorithm: Unified Flow","instruction.desc.layered":"Generates a SINGLE seamless block. Structure: [Style] -> [MASTER SET DESIGN FROM CONTEXT] -> [Visuals] + [POSE & ACTION] -> [Camera].","instruction.desc.layered_no_char":"Structure: [MASTER SET DESIGN] -> [Index] + [FULL POSE & ACTION]. Omits appearance but explicitly describes body geometry/movement.","instruction.visuals":"Style: Saturation","instruction.desc.visuals":"Use rich visual descriptors: volumetric lighting, chiaroscuro, 8k textures, depth of field.","instruction.process_whole_scene":"Batch Scene","instruction.desc.process_whole_scene":"Analyze entire scene at once for consistency.","instruction.video":"Video","instruction.desc.video":"Video Prompt: [Index] (Detailed Visual Desc) [Action] in one block. Dynamics: [Env Motion]. Camera: [Movements]. NO NAMES.","instruction.stateless":"Rule: Stateless","instruction.desc.stateless":'Treat every frame as independent. MANDATORY: Fully redescribe action of EVERY character from scratch (Posture -> Limbs -> Face). No abbreviations like "same pose".',"instruction.rule_static":"Rule: Static","instruction.desc.rule_static":"Describe only the frozen moment. No narrative transitions.","instruction.atmosphere_fix":"Atmospheric Anchor","instruction.desc.atmosphere_fix":"Describe mood as physical properties of air and light.","instruction.subject_focus":"Context Hierarchy","instruction.desc.subject_focus":"CRITICAL: Even for Close-ups, describe 1. Full Character + ACTIVE INTERACTION (e.g. dragging). 2. Pose. 3. Detail. The AI needs the full context to render parts correctly.","instruction.always_env":"MANDATORY SET DESIGN","instruction.desc.always_env":"CRITICAL: Use the provided 'Global Scene Context' as the ABSOLUTE TRUTH for the background. You MUST inject the specific furniture, lighting, and textures from the context into the environment layer of EVERY prompt. Do not hallucinate generic backgrounds.","instruction.pm_anthro":"Anthro Detail","instruction.desc.pm_anthro":'MANDATORY: Word "anthropomorphic" before species in both Image AND Video. Enhanced textures/anatomy.',"instruction.pm_subscribe":"Legible Text","instruction.desc.pm_subscribe":'Ensure text like "SUBSCRIBE" is legible and integrated (neon, signs, 3D) in the final image prompt.',"instruction.strict_char_index":"Characters","instruction.desc.strict_char_index":"Strictly map character Aliases (Character-N) to each frame data.","instruction.no_names":"CRITICAL: NO NAMES","instruction.desc.no_names":"CRITICAL: Names banned. Use [Entity-N]. Tag inside brackets MUST be in English (e.g., [Entity-1]), do not translate it.","instruction.general_char_desc":"General Detail","instruction.desc.general_char_desc":"Summarize and incorporate a CONCISE, GENERAL version of the visual prompt from the character's profile.","instruction.full_char_desc":"Full Detail","instruction.desc.full_char_desc":"Incorporate the FULL and DETAILED visual prompt from the character's profile exactly as written.","instruction.formatting":"Formatting","instruction.desc.formatting":"Enables explicit HEADERS (Environment, Interaction, Technical) and line breaks. Use this if you want structure instead of a flat text block.","instruction.anatomical_strictness":"Anatomy Logic","instruction.desc.anatomical_strictness":'RIGGING: Prevents "Arms behind head AND holding drink". Forces separate description: Left Arm [state], Right Arm [state]. Eliminates extra limbs.',"instruction.img_vid_consistency":"Img->Vid Flow","instruction.desc.img_vid_consistency":"Image Prompt = Setup/Start Frame (Static). Video Prompt = Action/Movement (Evolution). Ensures video evolves naturally from the static image.","instruction.desc.prop_enhancement":'MATERIALITY: Amplifies object descriptions from input (e.g. "red board" -> "glossy red fiberglass"). Preserves specified colors/types.',"instruction.no_pov":"CRITICAL: NO POV","instruction.desc.no_pov":'STRICT BAN on First Person/POV angles. Camera MUST be external (Third Person). No "through eyes" or "view from".'},b1={"instruction.music_role":"Music Producer Role","instruction.desc.music_role":"Expert Composer and Lyricist role definition.","instruction.music_input":"Input Data","instruction.desc.music_input":"The theme or idea provided by the user.","instruction.music_creative":"Creative Freedom","instruction.desc.music_creative":"Forces AI to interpret vibe metaphorically, not literally. Prevents generic outputs.","instruction.music_lyrics":"Lyrics Structure","instruction.desc.music_lyrics":"Generates Verse/Chorus structure fitting the genre.","instruction.music_verse_count":"Verse Count","instruction.desc.music_verse_count":"Strictly controls the number of verses generated.","instruction.music_prompt_rule":"AI Music Prompt","instruction.desc.music_prompt_rule":"Technical tags for Suno/Udio (BPM, Instruments, Vocals). Max 1000 chars.","instruction.music_format":"JSON Output","instruction.desc.music_format":"Strict JSON structure for integration."},w1={"instruction.yt_role":"YouTube Strategist","instruction.desc.yt_role":"Expert in SEO, CTR, and Viral Psychology.","instruction.yt_input":"Input Data","instruction.desc.yt_input":"The topic or niche provided.","instruction.yt_title_mode":"Video Metadata","instruction.desc.yt_title_mode":"Optimizes Titles/Desc/Tags for maximum clicks.","instruction.yt_channel_mode":"Channel Branding","instruction.desc.yt_channel_mode":"Creates consistent Name, Bio, and Handle.","instruction.yt_format":"JSON Output","instruction.desc.yt_format":"Strict JSON structure for integration.","instruction.yt_hashtags":"Embed Hashtags","instruction.desc.yt_hashtags":"Appends #hashtags to the description field.","instruction.yt_thumbnail":"Thumbnail Prompt","instruction.desc.yt_thumbnail":"Generates a visual description for a click-worthy cover image."},_1={"instruction.narrator_role_story":"Storyteller Role","instruction.desc.narrator_role_story":"Engaging, descriptive tone for narratives.","instruction.narrator_role_news":"Announcer Role","instruction.desc.narrator_role_news":"Punchy, authoritative tone for broadcasts.","instruction.narrator_role_fps":"First Person Role","instruction.desc.narrator_role_fps":"Internal monologue and subjective reaction.","instruction.narrator_input":"Input Data","instruction.desc.narrator_input":"The raw text or scene description provided.","instruction.narrator_ssml":"SSML Tags","instruction.desc.narrator_ssml":"Adds breath, pauses, and emphasis tags for TTS.","instruction.narrator_format":"JSON Output","instruction.desc.narrator_format":"Strict JSON structure with language keys."},C1={...f1,...y1,...x1,...v1,...b1,...w1,..._1},S1={...d1,...u1,...p1,...h1,...m1,...g1,...C1},T1={"app.title":" ","app.description":" ,         Gemini API.","app.slogan":" ,   ","app.subtitle":"  ","app.error.title":"","app.error.copy":" ","app.error.copied":"!","error.quotaExceeded":"   . ,    API-    .","error.apiKeyMissing":"API   . ,   API  Gemini  .","error.freeKeyNotAvailable":"/ API     . ,    .","error.fileReadError":"  .","error.videoConversionError":"     .","error.unsupportedFile":"  .","error.promptModifierFile":"     (Prompt Modifier). ,     .","error.invalidFileType":"  . ,      Script Modifier.","welcome.iAmDeveloper":" ","welcome.letsGo":"!","welcome.resume":"","welcome.reload":"","welcome.reloadTitle":"  ?","welcome.reloadMessage":"      .    .  ?","welcome.confirmReload":"  ","dialog.welcome.title":"Script Modifier","dialog.welcome.heading":"  ","dialog.welcome.intro1":"   Script Modifier          Gemini.","dialog.welcome.intro2":"       API  Gemini.","dialog.welcome.apiKeyExplanation":" API     .        ,  Google Gemini API."},E1={"toolbar.edit":" (V)","toolbar.cutter":" (C)","toolbar.selection":" (S)","toolbar.reroute":" (R)","toolbar.zoom":" (Z)","toolbar.snapToGrid":"   (Shift+W)","toolbar.resetZoom":" ","toolbar.lineStyleSpaghetti":" (Shift+E)","toolbar.lineStyleOrthogonal":" (Shift+E)","toolbar.addNode":"  (F)","toolbar.catalog":" (Ctrl+Space)","toolbar.settings":"","toolbar.resetToDefault":" ","toolbar.closeProject":"  / ","toolbar.enterFullscreen":"  ","toolbar.exitFullscreen":"   ","toolbar.home":"","toolbar.addTextInput":"  (T)","toolbar.addPromptAnalyzer":"  (A)","toolbar.addCharacterAnalyzer":" ","toolbar.addCharacterGenerator":"  (Shift+C)","toolbar.addImageGenerator":"  (O)","toolbar.addImagePreview":"  (I)","toolbar.addCharacterCard":"  (Ctrl+Shift+C)","toolbar.addPromptProcessor":"  (P)","toolbar.addGeminiChat":" Gemini (G)","toolbar.addTranslator":" (L)","toolbar.addIdeaGenerator":"  (Shift+A)","toolbar.addScriptGenerator":"  (Shift+S)","toolbar.addScriptAnalyzer":"  (Shift+D)","toolbar.addScriptPromptModifier":"  (Shift+F)","toolbar.addErrorAnalyzer":" ","toolbar.addNote":" (N)","toolbar.addDataReader":"  (Shift+R)","toolbar.addSpeechSynthesizer":"  (Shift+N)","toolbar.addNarratorTextGenerator":"   (Shift+G)","toolbar.addAudioTranscriber":"  (Shift+B)","toolbar.addYouTubeTitleGenerator":"  YouTube (Shift+T)","toolbar.addMusicIdeaGenerator":" .  (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube  (Shift+Y)","toolbar.addImageEditor":" ","toolbar.saveCanvas":"  (Ctrl+S)","toolbar.saveProject":"  (Ctrl+Shift+S)","toolbar.loadCanvas":" (Ctrl+O)","toolbar.clearCanvas":" ","toolbar.group.general":"","toolbar.group.scripting":"","toolbar.group.prompting":"  ","toolbar.group.characters":"","toolbar.group.ai":" ","toolbar.group.file":"","toolbar.group.images":"","toolbar.group.audio":"","toolbar.group.youtube":"YouTube","toolbar.group.canvas":" ","toolbar.expand":" ","toolbar.collapse":" ","toolbar.toggleHeaders":" ","hotkeys.file.title":"","hotkeys.file.save":"  (Ctrl+S)","hotkeys.file.saveProject":"  (Ctrl+Shift+S)","hotkeys.file.load":" (Ctrl+O)","hotkeys.tools.title":"","hotkeys.tools.edit":"","hotkeys.tools.cutter":"","hotkeys.tools.selection":"","hotkeys.tools.reroute":"","hotkeys.tools.zoom":"","hotkeys.tools.group":" (G)","hotkeys.tools.deleteGroup":" ","hotkeys.tools.closeNode":" ","hotkeys.tools.toggleLineStyle":" ","hotkeys.tools.snapToGrid":"  ","hotkeys.tools.selectAll":" ","hotkeys.tools.deselectAll":" ","hotkeys.tools.duplicate":" ( )","hotkeys.windows.title":"","hotkeys.windows.search":" (F)","hotkeys.windows.quickAdd":"  ()","hotkeys.windows.catalog":"","hotkeys.createNode.title":" ","hotkeys.hide":"  ","help.title":" ","hotkeys.show":"  ","search.placeholder":" ...","search.noResults":"  .","search.node.text_input.title":" ","search.node.text_input.description":"     . (T)","search.node.prompt_processor.title":" ","search.node.prompt_processor.description":"      . (P)","search.node.prompt_analyzer.title":" ","search.node.prompt_analyzer.description":"     . (A)","search.node.character_analyzer.title":" ","search.node.character_analyzer.description":"     .","search.node.character_generator.title":" ","search.node.character_generator.description":"    . (Shift+C)","search.node.image_generator.title":" ","search.node.image_generator.description":"    . (O)","search.node.image_preview.title":" ","search.node.image_preview.description":"   . (I)","search.node.character_card.title":" ","search.node.character_card.description":" ,    . (Ctrl+Shift+C)","search.node.gemini_chat.title":" Gemini","search.node.gemini_chat.description":"   Gemini AI. (G)","search.node.translator.title":"","search.node.translator.description":"    . (L)","search.node.script_generator.title":" ","search.node.script_generator.description":"    . (Shift+S)","search.node.script_analyzer.title":" ","search.node.script_analyzer.description":"     . (Shift+D)","search.node.script_prompt_modifier.title":" ","search.node.script_prompt_modifier.description":"  (Shift+F)","search.node.error_analyzer.title":" ","search.node.error_analyzer.description":"     .","search.node.note.title":"","search.node.note.description":"   . (N)","search.node.reroute_dot.title":" ","search.node.reroute_dot.description":"     .","search.node.data_reader.title":" ","search.node.data_reader.description":"     . (Shift+R)","search.node.speech_synthesizer.title":" ","search.node.speech_synthesizer.description":"   . (Shift+N)","search.node.idea_generator.title":" ","search.node.idea_generator.description":"      . (Shift+A)","search.node.narrator_text_generator.title":"  ","search.node.narrator_text_generator.description":"   . (Shift+G)","search.node.audio_transcriber.title":" ","search.node.audio_transcriber.description":" /  . (Shift+B)","search.node.youtube_title_generator.title":"  YouTube","search.node.youtube_title_generator.description":"    . (Shift+T)","search.node.music_idea_generator.title":" . ","search.node.music_idea_generator.description":"      . (Shift+M)","search.node.youtube_analytics":"YouTube ","search.node.youtube_analytics.description":"       . (Shift+Y)","search.node.image_editor":" ","search.node.image_editor.description":"     (Inpainting, Outpainting).","search.group.input":"","search.group.process":"","search.group.scripting":"","search.group.character":"","search.group.images":"","search.group.ai":"","search.group.audio":"","search.group.youtube":"YouTube","contextMenu.tools":"","contextMenu.assignSlot":"  {index}","contextMenu.addNodeFromSlot":" {node} ({index})","connectionMenu.title":" ","quickAddMenu.title":" ","contextMenu.paste":" (Ctrl+V)","node.content.simpleActions":" ","node.content.smartConcept":"-","tooltip.model.flash":"Gemini Flash: , ,  .","tooltip.model.pro":"Gemini Pro:  ,  , .","tooltip.lang.ru":"   .","tooltip.lang.en":"   .","tooltip.lang.es":"   .","tooltip.lang.de":"   .","tooltip.lang.uz":"   .","tooltip.lang.fr":"   .","tooltip.lang.it":"   .","tooltip.lang.pt":"   .","tooltip.lang.zh":"   .","node.action.locateInStack":"  ","help.tabs.hotkeys":"  ","help.tabs.links":" ","help.category.socials":" ","help.category.stable":"Google AI Studio (Stable)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":" / Netlify","help.category.github":"GitHub ","help.link.youtube":"YouTube ","help.link.telegram_channel":"Telegram ","help.link.telegram_chat":"Telegram ","help.sub.news":"  ","help.sub.discussion":"","help.sub.stable":" ","help.sub.alpha":" ","languages.ru":"","languages.en":"English","languages.es":"Espaol","languages.fr":"Franais","languages.de":"Deutsch","languages.it":"Italiano","languages.pt":"Portugus","languages.zh":"","languages.ja":"","languages.ko":"","languages.uz":"Ozbek","youtube_analytics.mode.analytics":"","youtube_analytics.mode.planner":"","planner.activeChannels":" ","planner.noChannels":" .   .","planner.addTask":" ","planner.taskPlaceholder":"   ...","planner.noTasks":"    .","youtube_analytics.goal":"","youtube_analytics.suggestion":"","youtube_analytics.longViews":" ()","youtube_analytics.shortsViews":" (Shorts)","youtube_analytics.videoViews":" ","youtube_analytics.monthlyViewsSum":"   ()","youtube_analytics.subs":".","youtube_analytics.views_short":".","youtube_analytics.vids_short":"","youtube_analytics.monetization":"","youtube_analytics.currentSubs":" .","youtube_analytics.accept":"","planner.dayProgress":" {current}","planner.totalDays":" {total}","youtube_analytics.videos_wk":" ()","youtube_analytics.vids_wk":"/","youtube_analytics.vids_mo":"/","youtube_analytics.subs_short":"."},N1={"node.title.text_input":" ","node.title.prompt_processor":" ","node.title.prompt_analyzer":" ","node.title.character_analyzer":" ","node.title.character_generator":" ","node.title.image_generator":" ","node.title.image_preview":" ","node.title.character_card":" ","node.title.gemini_chat":" Gemini","node.title.translator":"","node.title.script_generator":" ","node.title.script_analyzer":" ","node.title.script_prompt_modifier":" ","node.title.error_analyzer":" ","node.title.note":"","node.title.reroute_dot":" ","node.title.data_reader":" ","node.title.speech_synthesizer":" ","node.title.idea_generator":" ","node.title.narrator_text_generator":"  ","node.title.audio_transcriber":" ","node.title.youtube_title_generator":"  YouTube","node.title.music_idea_generator":"  ","node.title.youtube_analytics":"YouTube ","node.title.image_editor":" ","node.help.text_input":"     . (T)","node.help.prompt_processor":"      . (P)","node.help.prompt_analyzer":"     . (A)","node.help.character_analyzer":"     .","node.help.character_generator":"    . (Shift+C)","node.help.image_generator":"    . (O)","node.help.image_preview":"   . (I)","node.help.character_card":" ,    . (Ctrl+Shift+C)","node.help.gemini_chat":"   Gemini AI. (G)","node.help.translator":"    . (L)","node.help.script_generator":"    . (Shift+S)","node.help.script_analyzer":"     . (Shift+D)","node.help.script_prompt_modifier":"  (Shift+F)","node.help.error_analyzer":"     .","node.help.note":"   . (N)","node.help.reroute_dot":"     .","node.help.data_reader":"     . (Shift+R)","node.help.speech_synthesizer":"   . (Shift+N)","node.help.idea_generator":"      . (Shift+A)","node.help.narrator_text_generator":"   . (Shift+G)","node.help.audio_transcriber":" /  . (Shift+B)","node.help.youtube_title_generator":"    . (Shift+T)","node.help.music_idea_generator":"      . (Shift+M)","node.help.youtube_analytics":"       . (Shift+Y)","node.help.image_editor":"     (Inpainting, Outpainting).","node.action.help":"","node.action.expand":"","node.action.collapse":" (H)","node.action.expandAll":" ","node.action.collapseAll":" ","node.action.expandAllScenes":"  ","node.action.collapseAllScenes":"  ","node.action.expandAllFrames":"  ","node.action.collapseAllFrames":"  ","node.action.expandPanel":" ","node.action.collapsePanel":" ","node.action.togglePanel":" ","node.action.collapseScene":" ","node.action.expandScene":" ","node.action.collapseFrame":" ","node.action.expandFrame":" ","node.action.collapseCharacter":" ","node.action.expandCharacter":" ","node.action.clear":"","node.action.clearTooltip":"  .","node.action.clearChat":" ","node.action.paste":"","node.action.copy":"","node.action.duplicateWithContent":" ( )","node.action.duplicateEmpty":" ()","node.action.cutConnections":" ","node.action.close":"","node.action.executeChain":" ","node.action.executeFullChain":"  ","node.action.processChainForward":"  ","node.action.executeChainTitle":"   .","node.action.addCharacter":" ","node.action.addScene":" ","node.action.addFrame":" ","node.action.addFirstFrame":"  ","node.action.deleteItem":"","node.action.moveUp":"","node.action.moveDown":"","node.action.saveImage":" ","node.action.loadImage":" ","node.action.saveCharacter":"  ","node.action.loadCharacter":"  ","node.action.readData":" ","node.action.refreshData":" ","node.action.stop":"","node.action.stopping":"...","node.action.embedCharacter":" ","node.action.downloadFinalPrompts":" ","node.action.rename":"","node.action.index":"","node.action.improveConcept":" ","node.action.improveConceptTooltip":"    .","node.action.downloadJson":" JSON","node.action.downloadSRT":" SRT","node.action.markPrimary":" ","node.input.default":"","node.output.default":"","node.output.allCharacters":" ","node.output.primaryCharacter":" ","node.content.action":"","node.content.actionPlaceholder":" ...","node.content.allScriptParts":"  ","node.content.allScriptAnalyzerData":" ","node.content.allNarratorData":"  ","node.content.analyzeCharacters":" ","node.content.analyzeFromScene":" :","node.content.analyzeUpToScene":"","node.content.endPlaceholder":"","node.content.generateFromFrame":"  :","node.content.generateUpToFrame":" ","node.content.analyzeFromFrame":"  :","node.content.processFromFrame":"  :","node.content.processFromScene":"  :","node.content.analyzePrompt":" ","node.content.analyzeScript":" ","node.content.analyzing":"...","node.content.applyAliases":" ","node.content.applyAliasesTooltip":"    ().","node.content.character":"","node.content.characterIndex":"","node.content.characterPlaceholder":" ...","node.content.character_plural":"","node.content.characters":"","node.content.charactersSynced":" ","node.content.noCharactersConnected":"  .","node.content.appearance":"","node.content.personality":"","node.content.characterType":"","node.content.characterTypeShort":"","node.content.characterType.simple":"","node.content.characterType.anthro":" ()","node.content.characterType.chibi":" ()","node.content.characterType.key_item":" ","node.content.style":"","node.content.style.none":"","node.content.style.simple":"","node.content.style.realistic":"/","node.content.style.3d_cartoon":"3D ","node.content.style.3d_realistic":"3D ","node.content.style.2d_animation":"2D ","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":"","node.content.chatPlaceholder":" ...","node.content.clothing":"","node.content.clothingPlaceholder":" ...","node.content.connectedPlaceholder":"","node.content.dataPlaceholder":"  ...","node.content.readData":" ","node.content.reading":"...","node.content.description":"","node.content.sceneDescription":" ","node.content.duration":"","node.content.enhancePrompt":" ","node.content.enhancedPromptHere":"   ...","node.content.enhancing":"...","node.content.environment":"","node.content.environmentPlaceholder":" ...","node.content.environmentPrompt":"  ","node.content.compositionAndBlocking":"  ","node.content.executingChain":" ...","node.content.imagePrompt":" ","node.content.finalPrompt":" ","node.content.finalPrompt_plural":" ","node.content.fixErrors":" ","node.content.fixingErrors":"...","node.content.frame":"","node.content.frame_plural":"","node.content.frames":" ","node.content.frames_analyzed":" : {count}","node.content.framesPerScene":"  ","node.content.minFrames":"","node.content.maxFrames":"","node.content.numberOfCharactersShort":".","node.content.fullDescription":" ","node.content.generateCharacters":" ","node.content.generateFinalPrompts":"  ","node.content.generatingProgress":" {current}  {total}","node.content.generateImage":" ","node.content.generateScript":" ","node.content.generateSpeech":" ","node.content.generateText":" ","node.content.generateSSML":" SSML","node.content.generateStyle":" ","node.content.generating":"...","node.content.improving":"...","node.content.generatedAudio":" ","node.content.imagePromptPlaceholder":"   ...","node.content.modificationPromptPlaceholder":"  ...","node.content.narrator":"","node.content.narratorEnabled":" ","node.content.narratorEnabledInfo":"  .","node.content.narratorMode":" ","node.content.narratorMode.normal":" / ","node.content.narratorMode.dual":" ","node.content.narratorMode.first_person":" ","node.content.role":"","node.content.role.narrator":"","node.content.role.announcer":"","node.content.role.first_person":" ","node.content.role.dual_narrator":" ","node.content.role.dual_announcer":" ","node.content.scene":"","node.content.scene_plural":"","node.content.scenes":"","node.content.scenes_generated":" : {count}","node.content.sceneContext":" ","node.content.sceneContextPlaceholder":", , ...","node.content.scriptPromptPlaceholder":"  ...","node.content.seconds":"","node.content.stylePlaceholder":" ...","node.content.stylePromptPlaceholder":"   ...","node.content.styleOverride":" ","node.content.summary":"","node.content.targetLanguage":" ","node.content.textToSynthesize":"  ...","node.content.translate":"","node.content.translatePlaceholder":"  ...","node.content.translatedTextPlaceholder":"  ...","node.content.translating":"...","node.content.useExistingCharacters":" ","node.content.useExistingCharactersInfo":"      .","node.content.createKeyItem":" /","node.content.createSecondaryChars":" ","node.content.createKeyItems":" ","node.content.createKeyItemInfo":"      .","node.content.noCharacters":" ","node.content.noCharactersInfo":" .","node.content.videoPrompt":"  ","node.content.videoPrompts":" ","node.content.voice":"","node.content.previewVoice":" ","node.content.voicePreviewText":",   .","node.content.inputScripts":" ","node.content.inputFrames":" ","node.content.outputScript":" ","node.content.requestCategories":" ","node.content.generateIdea":" ","node.content.requestNewCategories":" ","node.content.category.action":"","node.content.category.place":"","node.content.category.obstacle":"","node.content.generatedIdea":" ","node.content.storyFormat":" ","node.content.theme":"","node.content.parameters":"","node.content.advancedMode":" ","node.content.numberOfScenes":" ","node.content.numberOfScenes.auto":"","node.content.detailedPlot":" ","node.content.detailedPlotInfo":" .","node.content.includeSubscribeScene":" ","node.content.includeSubscribeSceneInfo":" .","node.content.genre":"","node.content.genre2":" 2","node.content.breakIntoParagraphs":"  ","node.content.copyVideoPrompt":"  ","node.content.generateVideoPrompt":"  ","node.content.model":"","node.content.processWholeScene":"  ","node.content.processWholeSceneInfo":"        .","node.content.batchProcessing":" ","node.content.batchProcessingInfo":"      .","node.content.extendedAnalysis":" ","node.content.extendedAnalysisInfo":"    .","node.content.professionalStoryboard":" ","node.content.professionalStoryboardInfo":"    .","node.content.generateStartEndFrames":" / ","node.content.autoIndexCharacters":"- ","node.content.autoIndexCharactersInfo":"    .","node.content.imageToText":"  ","node.content.extracting":"...","node.content.extractedText":" ","node.content.activePromptStack":"  ","node.content.noCharactersAnalyzed":"  .","node.content.promptsGeneratedPlaceholder":"   .","node.content.noCharactersInScript":"   .","node.content.noInputScenes":"  .   .","node.content.status":"","node.content.status.ready":"","node.content.status.paused":" ","node.content.status.generating":"","node.content.status.total":": {generated} / {total}","node.content.status.batch":": {current}  {total}","node.content.status.time":": {current} / {total}","node.content.refreshing":"...","node.content.totalFrames":" : {count}","node.content.uploadAudio":" /","node.content.noAudioLoaded":" ","node.content.audioLoaded":" ","node.content.transcriptionPlaceholder":"  ...","node.content.transcribe":"","node.content.transcribing":"...","node.content.convertingVideo":" ...","node.content.recommendedFrames":" ","node.content.shotType":"","node.content.shotType.ws":"WS ()","node.content.shotType.ms":"MS ()","node.content.shotType.cu":"CU ()","node.content.shotType.ecu":"ECU ()","node.content.shotType.ls":"LS ()","node.content.characterDetail":" ","node.content.noCharDesc":"  ","node.content.includeGeneralCharDesc":"  ","node.content.includeFullCharDesc":"  ","node.content.safeGeneration":" ","node.content.shotFilter":" ","node.content.shotFilter.all":"","node.content.shotFilter.wideOnly":" ","instruction.desc.shot_filter_all":"    (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"    (WS, MS, LS).   .","node.content.anthroEnabled":" ","node.content.subscribeEnhancement":"  ","node.content.thinkingEnabled":" ","node.content.scenelessMode":"  ","instruction.desc.sceneless_mode":"  .     .","instruction.sceneless_mode":"  ","node.content.microActionBreakdown":"-","node.content.microActionBreakdownInfo":"     (, , ).","node.content.commercialSafe":"  ","instruction.desc.commercial_safe":"    .","node.content.findStack":"  ...","node.content.spm_stack.priming":"1.   ","node.content.spm_stack.physics":"2.   ","node.content.spm_stack.hierarchy":"3.  ","node.content.spm_stack.construction":"4.   ","node.content.suffix":""},k1={"genre.general":"","genre.comedy":"","genre.drama":"","genre.action":"","genre.scifi":" ","genre.fantasy":"","genre.horror":"","genre.thriller":"","genre.childrens_animation":"   ","genre.shorts_story":"   ","genre.scientific_historical":"- ","character_generator.promptPlaceholder":'   , : " ,   ,    "',"idea_generator.randomTheme":"  ","idea_generator.randomCombination":" ","idea_generator.themePlaceholder":", , ,  ","idea_generator.initialMessage":'  ()   "{buttonName}",  .',"idea_generator.ideaPlaceholder":"   ...","idea_generator.format.general":"","idea_generator.format.childrens":"","idea_generator.format.adventure":"","idea_generator.format.fantasy":" / ","idea_generator.format.detective":"","idea_generator.format.scifi":" ","idea_generator.format.horror":"","idea_generator.format.historical":"","gender.male":"","gender.female":"","node.content.autoDownload":"-  ","node.content.downloadSelected":" ","node.content.intonation":"","intonation.standard":"","intonation.cheerful":"","intonation.angry":"","intonation.sad":"","intonation.excited":"","intonation.announcer":"","intonation.whispering":"","node.content.sceneMode":" ","node.content.connectNarratorData":' "  "   .',"node.content.sceneModeActive":"  .    .","speech_synthesizer.mode.simple":"","speech_synthesizer.mode.scene":"","speech_synthesizer.multiSpeaker":" ","speech_synthesizer.speaker1Name":"  1","speech_synthesizer.speaker2Name":"  2","speech_synthesizer.multiSpeakerHint":"        (, Man: ..., Woman: ...).","speech_synthesizer.ssmlHint":"  SSML-  .","youtube_analytics.authorName":" ","youtube_analytics.videoTitle":" ","youtube_analytics.views":"","youtube_analytics.addToChannel":"  ","youtube_analytics.noIncomingData":"  .","youtube_analytics.videoAdded":" !","youtube_analytics.dragDrop":"   ","youtube_analytics.thumbnailUpdated":" ","youtube_analytics.statsTrend":" ","youtube_analytics.currentChannel":" ","youtube_analytics.growth":"","youtube_analytics.allChannels":" ","youtube_analytics.saveDisk":". ","youtube_analytics.saveCatalog":". ","youtube_analytics.loadDisk":". ","youtube_analytics.analyzing":"...","youtube_analytics.askAI":" ","youtube_analytics.clickForAdvice":' " "  .',"youtube_analytics.dailyNotes":" ","youtube_analytics.logDailyStats":" ","youtube_analytics.subscribers":"","youtube_analytics.totalViews":" ","youtube_analytics.updateStats":"","youtube_analytics.history":"","youtube_analytics.noHistory":"  .","youtube_analytics.noNotes":" .","youtube_analytics.noVideos":" .","youtube_analytics.loadedFromDisk":"  ","youtube_analytics.loadFailed":" ","youtube_analytics.savedToDisk":"  ","youtube_title_generator.mode.title":" ","youtube_title_generator.mode.channel":"  ","youtube_title_generator.ideaPlaceholder":"    ...","youtube_title_generator.channelIdeaPlaceholder":"    ...","youtube_title_generator.title":"","youtube_title_generator.description":"","youtube_title_generator.tags":"","youtube_title_generator.channelName":" ","youtube_title_generator.channelDescription":" ","youtube_title_generator.channelKeywords":" ","youtube_title_generator.channelHandle":" (@)","music_idea_generator.mode.lyrics":" ","music_idea_generator.mode.music_prompt":" ","music_idea_generator.ideaPlaceholder":"    ...","music_idea_generator.songTitle":" ","music_idea_generator.songTitlePlaceholder":"...","music_idea_generator.lyricsPlaceholder":"   ...","music_idea_generator.musicPromptPlaceholder":"     ...","chat.mode.general":"","chat.mode.script":" ","chat.mode.prompt":" ","chat.mode.youtube":"YouTube ","youtube_analytics.goalPlaceholder":". 1000 ","youtube_analytics.videoDescriptionPlaceholder":" ...","youtube_analytics.contextPlaceholder":"    ..."},A1={"catalog.title":"","catalog.tabs.groups":"","catalog.tabs.library":" ","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.analysis":"","catalog.tabs.final_prompts":" ","catalog.tabs.youtube":"YouTube","catalog.tabs.music":" ","catalog.empty.title":" ","catalog.empty.description":" ,    ,    .","catalog.loadFromFile":"    ","catalog.card.addToCanvas":"  ","catalog.card.rename":"","catalog.card.save":"  ","catalog.card.delete":"","library.loadFromFile":"  ","library.empty.title":" ","library.empty.description":"    ,  .","library.emptyPrompt":" ","library.actions.newFolder":" ","library.actions.newPrompt":" ","library.actions.copy":"  ","library.actions.edit":"","group.rename":" ","group.saveToCatalog":"  ","group.saveToDisk":"  ","group.ungroup":" (Shift+  )","group.button.create":" ({count})"},I1={"dialog.rename.title":"","dialog.rename.group.title":" ","dialog.rename.catalog.title":"  ","dialog.rename.label":" ","dialog.rename.confirm":"","dialog.rename.cancel":"","dialog.promptEdit.title":" ","dialog.promptEdit.nameLabel":"","dialog.promptEdit.contentLabel":"","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.reset.title":" ","dialog.reset.message":" ,        ?     .","dialog.exit.title":" ?","dialog.exit.message":" ?     ,      .","dialog.settings.title":"","dialog.settings.apiKeyLabel":"API  Gemini","dialog.settings.apiKeyPlaceholder":"  API  ","dialog.settings.getApiKeyLink":" API   Google AI Studio","dialog.settings.useFreeKey":"  () ","dialog.settings.save":"","dialog.settings.close":"","dialog.apiKey.title":" API ","dialog.apiKey.description":"    API  Gemini.   .      .","dialog.apiKey.keyExists":"API     .","dialog.apiKey.clear":" ","dialog.apiKey.save":" ","dialog.apiKey.update":" ","dialog.apiKey.useFreeKey":"   ( )","dialog.permission.title":"   ","dialog.permission.description":'        ""  .         .',"dialog.permission.decline":"","dialog.permission.allow":"","alert.groupSaved":' "{groupTitle}"   !',"toast.groupSavedToDisk":' "{groupTitle}"   !',"alert.confirmDelete":" ,       ?","alert.invalidCatalogFile":"    .","alert.loadCatalogFailed":"    ","alert.confirmLoadProject":"      (, , ).  ?","dialog.confirmDelete.title":" ","dialog.confirmDelete.message":' ,    "{itemName}"?    .',"dialog.confirmDelete.folderMessage":' ,     "{itemName}"    ?    .',"dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmClear.title":" ","dialog.confirmClear.message":" ,      ?    .","toast.copied":"  ","toast.pasted":"!","toast.cleared":"","toast.resetComplete":"  ","toast.projectSaved":"   ","toast.canvasSaved":"   ","toast.saveFailed":"   ","toast.connectionsCut":" ","toast.charSaved":"   ","toast.charLoaded":" ","toast.videoPasted":"   ","toast.savedToCatalog":"  ","toast.apiKeySaved":"API   ","toast.apiKeyCleared":"API  ","toast.projectLoaded":"  ","alert.batchMismatch":":  {scene}   (: {expected}, : {got}).    ."},P1={"instruction.desc.safe_gen":' :     -.  : "teenager", "intimate", "erotic", "sexy".  : "young person", "young adult", "artistic atmosphere", "cinematic lighting".',"instruction.desc.layered_no_style":": 1. [  ( ->  ->  )] -> 2. [:  +   ] -> 3. [].        ."},R1={"instruction.sg_inputs":" ","instruction.desc.sg_inputs":": /,  .","instruction.core_director":"VFX ","instruction.desc.core_director":"  .    .  ,   .  ,   : , , .","instruction.sg_thinking":" ","instruction.desc.sg_thinking":"    .  ?  ?  ?","instruction.sg_improve_input":" ","instruction.desc.sg_improve_input":"   .     ,   (, , ),       .","instruction.sg_anti_compression":"-","instruction.desc.sg_anti_compression":'  .     .     "",     .     .',"instruction.sg_exposition":" ","instruction.desc.sg_exposition":":    2-3         ( ,  ).","instruction.sg_delayed_reveal":"","instruction.desc.sg_delayed_reveal":'   .   "- ", " ", " ".   .',"instruction.sg_metaphor":" ","instruction.desc.sg_metaphor":'   ("").  : " ,    ".',"instruction.sg_pacing":" ","instruction.desc.sg_pacing":':     3-5 .  "",  ",  , ,   ".',"instruction.sg_subtext":"","instruction.desc.sg_subtext":"   .","instruction.desc.sg_frame_estimation":" : 5-9  (), 10-15 (), 16-25 ().   .","instruction.rule_visuals":" ","instruction.desc.rule_visuals":" ,   .  ''  '',    .","instruction.sg_visual_dna":"  ","instruction.desc.sg_visual_dna":"         .","instruction.rule_flow":"","instruction.desc.rule_flow":",    ,    .","instruction.rule_atmosphere":"","instruction.desc.rule_atmosphere":" , , , , .         (  ).","instruction.sg_visual_style":" ","instruction.desc.sg_visual_style":"    '{style}'.","instruction.char_detailed_style":" ","instruction.desc.char_detailed_style":"  .","instruction.sg_genre":" ","instruction.desc.sg_genre":": {genre}","instruction.char_smart_concept":"-","instruction.desc.char_smart_concept":"  .","instruction.char_no_dupes":" ","instruction.desc.char_no_dupes":"   . :  .","instruction.create_main_chars":" ","instruction.desc.create_main_chars":"     .","instruction.create_secondary_chars":" ","instruction.desc.create_secondary_chars":"      .","instruction.create_key_items":" ","instruction.desc.create_key_items":"    .","instruction.sg_anthro":"","instruction.desc.sg_anthro":"   .","instruction.sg_no_chars":" ","instruction.desc.sg_no_chars":" .","instruction.sg_detailed_plot":" ","instruction.desc.sg_detailed_plot":" .","instruction.sg_subscribe":" ","instruction.desc.sg_subscribe":" .","instruction.char_gray_bg":"","instruction.desc.char_gray_bg":"    .","instruction.char_no_new":" ","instruction.desc.char_no_new":"  .","instruction.sg_new_chars":" ","instruction.desc.sg_new_chars":"  .","instruction.sg_living_world":" ","instruction.desc.sg_living_world_simple":"     .","instruction.desc.sg_living_world_anthro":"     .","instruction.sg_simple_actions":" ","instruction.desc.sg_simple_actions":"  .","instruction.commercial_safe":"  ","instruction.desc.commercial_safe":"    ."},M1={"instruction.inputs_data":" ","instruction.desc.inputs_data":":  ,  ,  .","instruction.ana_role":" ","instruction.desc.ana_role":"  .     -   .        ,          .      .","instruction.ana_cinema":"","instruction.desc.ana_cinema":".   (Wide Shot, Close-up)   (Side Profile, Rear View).","instruction.ana_cinema_wide":" ()","instruction.desc.ana_cinema_wide":". : Wide Shot, Long Shot, Dutch Angle. : Aerial, Worm's Eye.   .","instruction.ana_anthro_logic":"-","instruction.desc.ana_anthro_logic":'      (, "Anthropomorphic Fox")    .',"instruction.ana_subscribe_logic":" ","instruction.desc.ana_subscribe_logic":"   ,   :       3D .","instruction.rule_hierarchy":"  ","instruction.desc.rule_hierarchy":": 1.  . 2.    +   (, ). 3. . 4. .   ,      .","instruction.rule_living_world":" ","instruction.desc.rule_living_world":" ,  .","instruction.desc.rule_living_world_anthro":"      ( ).","instruction.rule_persistence":"","instruction.desc.rule_persistence":"  :        .","instruction.rule_mandatory_bg":"  ","instruction.desc.rule_mandatory_bg":":    ,   . 1.  (/). 2.  (, , ). 3.  (/)  .        .","instruction.desc.rule_mandatory_bg_wide":"   .        ,  ,      .","instruction.shot_filter_wide":"  ","instruction.desc.shot_filter_wide":' :    "  ",           (. " ,  ").   (CU/ECU)  .',"instruction.storyboard_rules":" ","instruction.desc.storyboard_rules":"  (WS/CU)   (, , , , ).  .","instruction.storyboard_rules_wide":"  ()","instruction.desc.storyboard_rules_wide":"  ,   : ,  ,  , .  .","instruction.tech_directives":"","instruction.desc.tech_directives":" .      (WS, MS, CU).","instruction.tech_directives_wide":" ()","instruction.desc.tech_directives_wide":" .  : WS, MS, LS.  CU/ECU.","instruction.use_aliases":"","instruction.desc.use_aliases":"  Entity-N (  ).     .","instruction.character_array_integrity":" ","instruction.desc.character_array_integrity":":  `characters`    Entity-N,    .","instruction.action_phase_breakdown":" ","instruction.desc.action_phase_breakdown":':     1 . " " = 3  ( ,  ,  ).   .',"instruction.desc.action_phase_breakdown_wide":" ,    .  /    ,   .","instruction.batch_processing":" ","instruction.desc.batch_processing":"    .","instruction.ana_prompt_lang":" ","instruction.desc.ana_prompt_lang":"   .","instruction.extended_visuals":"- ()","instruction.desc.extended_visuals":"  .        3-5  .  .  -.","instruction.extended_visuals_wide":" ()","instruction.desc.extended_visuals_wide":"         .     .   .","instruction.desc.target_lang":"  .","instruction.rule_isolation":" ","instruction.desc.rule_isolation":":       .          .","instruction.sensory_saturation":"-","instruction.desc.sensory_saturation":'  .  " "  "        ".',"instruction.ana_no_pov":" POV","instruction.desc.ana_no_pov":':        ("POV").      (- ,    ..).',"instruction.desc.static_frame_logic":'    ("", "").   . ",   ", ",  ".',"instruction.desc.anatomical_posing":'  .  "" : "  ,   ,   ".',"instruction.desc.motion_dynamics":": Image Prompt = 100% . Video Prompt =    (, , ).","instruction.desc.anatomical_strictness":":        .    :   [],   [].   3- .","instruction.desc.prop_consistency":' :     ("", "").   .  ("  ", "  ")   .',"instruction.desc.subject_hierarchy":' :      ,   : "-1  ,  .   ".      .',"instruction.static_frame_logic":" ","instruction.anatomical_posing":" ","instruction.anatomical_strictness":" ","instruction.prop_consistency":" ","instruction.subject_hierarchy":" ","instruction.motion_dynamics":" ","instruction.entity_limit":" ","instruction.desc.entity_limit":"    3  (Entity)   .    ."},j1={"instruction.inputs":" ","instruction.desc.inputs":" :  ,   ,     .","instruction.role":": Technical Director","instruction.desc.role":"        -.             .      .","instruction.layered":":  ","instruction.desc.layered":": [] -> [ ] -> [Entity-1:    + ] -> [/ ] -> [].    .","instruction.desc.layered_no_char":": [ ] -> [-1 + /] -> [-2 + /].    .","instruction.visuals":": ","instruction.desc.visuals":"  :  , ,  8k,  ,  .","instruction.process_whole_scene":" ","instruction.desc.process_whole_scene":"          .","instruction.video":"-","instruction.desc.video":": [] ( . ) []. Dynamics: []. Camera: [].    .","instruction.stateless":": Stateless","instruction.desc.stateless":'   .   . :        ( ->  -> ).    ""  "  ".',"instruction.rule_static":": ","instruction.desc.rule_static":"   .     .","instruction.atmosphere_fix":" ","instruction.desc.atmosphere_fix":"       .","instruction.subject_focus":" ","instruction.desc.subject_focus":':   T-Pose   ,    .      (, , ),     "  ".',"instruction.always_env":" -","instruction.desc.always_env":':  "  "      .   ,        .   .',"instruction.pm_anthro":"-","instruction.desc.pm_anthro":':  "anthropomorphic"      .   /.',"instruction.pm_subscribe":" ","instruction.desc.pm_subscribe":'   "SUBSCRIBE"  "LIKE" (, , 3D)   .',"instruction.strict_char_index":" ","instruction.desc.strict_char_index":"      Character-N,   .","instruction.no_names":":  ","instruction.desc.no_names":":  .  [Entity-N].        (., [Entity-1]),   .","instruction.general_char_desc":" ","instruction.desc.general_char_desc":"        .","instruction.full_char_desc":" ","instruction.desc.full_char_desc":"       .","instruction.formatting":"","instruction.desc.formatting":"    (, , ).  ,    ,    .","instruction.anatomical_strictness":" ","instruction.desc.anatomical_strictness":' : "     .        ."',"instruction.img_vid_consistency":" ->","instruction.desc.img_vid_consistency":"Image Prompt = /. Video Prompt =  .    ,    (:  -> ).","instruction.desc.prop_enhancement":':      (, " " -> "  ").   /.',"instruction.no_pov":":  POV","instruction.desc.no_pov":'      (POV).    (  ).  "  ", "   ".'},L1={"instruction.music_role":" ","instruction.desc.music_role":" -   .","instruction.music_input":" ","instruction.desc.music_input":"  ,  .","instruction.music_creative":" ","instruction.desc.music_creative":"   ,   .    .","instruction.music_lyrics":" ","instruction.desc.music_lyrics":"  /  .","instruction.music_verse_count":" ","instruction.desc.music_verse_count":"    .","instruction.music_prompt_rule":"AI  ","instruction.desc.music_prompt_rule":"   Suno/Udio (BPM, , ).  1000 .","instruction.music_format":"JSON ","instruction.desc.music_format":"  JSON  ."},D1={"instruction.yt_role":"YouTube ","instruction.desc.yt_role":"  SEO, CTR   .","instruction.yt_input":" ","instruction.desc.yt_input":"    .","instruction.yt_title_mode":" ","instruction.desc.yt_title_mode":"     .","instruction.yt_channel_mode":" ","instruction.desc.yt_channel_mode":" ,   .","instruction.yt_format":"JSON ","instruction.desc.yt_format":"  JSON  .","instruction.yt_hashtags":" ","instruction.desc.yt_hashtags":" #    .","instruction.yt_thumbnail":" ","instruction.desc.yt_thumbnail":"     ."},O1={"instruction.narrator_role_story":" ","instruction.desc.narrator_role_story":",    .","instruction.narrator_role_news":" ","instruction.desc.narrator_role_news":",    .","instruction.narrator_role_fps":": 1- ","instruction.desc.narrator_role_fps":"    .","instruction.narrator_input":" ","instruction.desc.narrator_input":"    .","instruction.narrator_ssml":"SSML ","instruction.desc.narrator_ssml":" ,     .","instruction.narrator_format":"JSON ","instruction.desc.narrator_format":"  JSON   ."},F1={...P1,...R1,...M1,...j1,...L1,...D1,...O1},z1={...T1,...E1,...N1,...k1,...A1,...I1,...F1},G1={"app.title":"Modificador de Guiones","app.description":"Crea, refina y genera guiones visualmente con la API de Gemini.","app.slogan":"Conecta ideas para crear una obra maestra","app.subtitle":"Visualiza tus Guiones","app.error.title":"Notificacin","app.error.copy":"Copiar Error","app.error.copied":"Copiado!","error.quotaExceeded":"Has alcanzado tu lmite de uso. Por favor, verifica la cuota de tu clave API o intntalo de nuevo ms tarde.","error.apiKeyMissing":"Clave API no encontrada. Por favor, configura tu clave API de Gemini en los ajustes.","error.freeKeyNotAvailable":"La clave API gratuita/de desarrollo no est disponible en este entorno. Por favor, proporciona tu propia clave.","error.fileReadError":"Error al leer el archivo.","error.videoConversionError":"Error al convertir vdeo a audio.","error.unsupportedFile":"Tipo de archivo no soportado.","error.promptModifierFile":"Este archivo pertenece a otra aplicacin (Prompt Modifier). Por favor, brelo en esa aplicacin.","error.invalidFileType":"Tipo de archivo invlido. Por favor, carga un archivo de Proyecto o Lienzo de Script Modifier.","welcome.iAmDeveloper":"Soy Desarrollador","welcome.letsGo":"Vamos!","welcome.resume":"Continuar","welcome.reload":"Recargar","welcome.reloadTitle":"Reiniciar y Recargar?","welcome.reloadMessage":"Esto borrar todo el lienzo y recargar la aplicacin. Los datos no guardados se perdern. Ests seguro?","welcome.confirmReload":"Reiniciar y Recargar","dialog.welcome.title":"Modificador de Guiones","dialog.welcome.heading":"Bienvenido a","dialog.welcome.intro1":"Bienvenido a Script Modifier: tu espacio de trabajo visual para crear historias con Gemini.","dialog.welcome.intro2":"Para comenzar, selecciona tu idioma e introduce tu clave API de Gemini.","dialog.welcome.apiKeyExplanation":"Tu clave API se almacena localmente en tu navegador. No la enviamos a ningn servidor que no sea la API de Google Gemini."},U1={"toolbar.edit":"Editar (V)","toolbar.cutter":"Cortar Conexin (C)","toolbar.selection":"Seleccin (S)","toolbar.reroute":"Punto de Ruta (R)","toolbar.zoom":"Zoom (Z)","toolbar.snapToGrid":"Ajustar a la Cuadrcula (Shift+W)","toolbar.resetZoom":"Restablecer Zoom","toolbar.lineStyleSpaghetti":"Lneas Espagueti (Shift+E)","toolbar.lineStyleOrthogonal":"Lneas Ortogonales (Shift+E)","toolbar.addNode":"Aadir Nodo (F)","toolbar.catalog":"Catlogo (Ctrl+Espacio)","toolbar.settings":"Ajustes","toolbar.resetToDefault":"Restablecer por Defecto","toolbar.closeProject":"Cerrar Proyecto / Limpiar","toolbar.enterFullscreen":"Pantalla Completa","toolbar.exitFullscreen":"Salir de Pantalla Completa","toolbar.home":"Inicio","toolbar.addTextInput":"Entrada de Texto (T)","toolbar.addPromptAnalyzer":"Analizador de Prompt (A)","toolbar.addCharacterAnalyzer":"Analizador de Personaje","toolbar.addCharacterGenerator":"Generador de Personajes (Shift+C)","toolbar.addImageGenerator":"Generador de Imgenes (O)","toolbar.addImagePreview":"Vista Previa de Imagen (I)","toolbar.addCharacterCard":"Ficha de Personaje (Ctrl+Shift+C)","toolbar.addPromptProcessor":"Procesador de Prompt (P)","toolbar.addGeminiChat":"Chat Gemini (G)","toolbar.addTranslator":"Traductor (L)","toolbar.addIdeaGenerator":"Generador de Ideas (Shift+A)","toolbar.addScriptGenerator":"Generador de Guiones (Shift+S)","toolbar.addScriptAnalyzer":"Analizador de Guiones (Shift+D)","toolbar.addScriptPromptModifier":"Finalizador de Prompts (Shift+F)","toolbar.addErrorAnalyzer":"Analizador de Errores","toolbar.addNote":"Nota (N)","toolbar.addDataReader":"Lector de Datos (Shift+R)","toolbar.addSpeechSynthesizer":"Sintetizador de Voz (Shift+N)","toolbar.addNarratorTextGenerator":"Generador de Texto Narrador (Shift+G)","toolbar.addAudioTranscriber":"Transcriptor de Audio (Shift+B)","toolbar.addYouTubeTitleGenerator":"Generador de Ttulos YouTube (Shift+T)","toolbar.addMusicIdeaGenerator":"Generador de Ideas Musicales (Shift+M)","toolbar.addYouTubeAnalytics":"Analticas de YouTube (Shift+Y)","toolbar.saveCanvas":"Guardar Lienzo (Ctrl+S)","toolbar.saveProject":"Guardar Proyecto (Ctrl+Shift+S)","toolbar.loadCanvas":"Cargar Lienzo (Ctrl+O)","toolbar.clearCanvas":"Limpiar Lienzo","toolbar.group.general":"General","toolbar.group.scripting":"Guiones","toolbar.group.prompting":"Prompts y Anlisis","toolbar.group.characters":"Personajes","toolbar.group.ai":"Herramientas IA","toolbar.group.file":"Archivo","toolbar.group.images":"Imgenes","toolbar.group.audio":"Audio","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"Controles del Lienzo","toolbar.expand":"Expandir Panel","toolbar.collapse":"Contraer Panel","toolbar.toggleHeaders":"Alternar Encabezados","hotkeys.file.title":"Archivo","hotkeys.file.save":"Guardar Lienzo (Ctrl+S)","hotkeys.file.saveProject":"Guardar Proyecto (Ctrl+Shift+S)","hotkeys.file.load":"Cargar Lienzo (Ctrl+O)","hotkeys.tools.title":"Herramientas","hotkeys.tools.edit":"Editar","hotkeys.tools.cutter":"Cortar","hotkeys.tools.selection":"Seleccin","hotkeys.tools.reroute":"Punto de Ruta","hotkeys.tools.zoom":"Zoom","hotkeys.tools.group":"Agrupar (G)","hotkeys.tools.deleteGroup":"Eliminar grupo con nodos","hotkeys.tools.closeNode":"Cerrar Nodo","hotkeys.tools.toggleLineStyle":"Cambiar Estilo de Lnea","hotkeys.tools.snapToGrid":"Ajustar a Cuadrcula","hotkeys.tools.selectAll":"Seleccionar Todos","hotkeys.tools.deselectAll":"Deseleccionar Todos","hotkeys.tools.duplicate":"Duplicar con Contenido","hotkeys.windows.title":"Ventanas","hotkeys.windows.search":"Buscar Nodos (F)","hotkeys.windows.quickAdd":"Aadir Rpido (Espacio)","hotkeys.windows.catalog":"Catlogo","hotkeys.createNode.title":"Crear Nodo","hotkeys.hide":"Ocultar Atajos","help.title":"Atajos de Teclado","hotkeys.show":"Mostrar Atajos","search.placeholder":"Buscar un nodo...","search.noResults":"No se encontraron nodos.","search.node.text_input.title":"Entrada de Texto","search.node.text_input.description":"Un cuadro de texto simple para tus ideas. (T)","search.node.prompt_processor.title":"Procesador de Prompt","search.node.prompt_processor.description":"Mejora y combina prompts con IA. (P)","search.node.prompt_analyzer.title":"Analizador de Prompt","search.node.prompt_analyzer.description":"Divide un prompt en personaje y entorno. (A)","search.node.character_analyzer.title":"Analizador de Personaje","search.node.character_analyzer.description":"Divide una descripcin en personaje y ropa.","search.node.character_generator.title":"Generador de Personajes","search.node.character_generator.description":"Crea personajes detallados a partir de una idea. (Shift+C)","search.node.image_generator.title":"Generador de Imgenes","search.node.image_generator.description":"Crea una imagen a partir de un texto. (O)","search.node.image_preview.title":"Vista Previa de Imagen","search.node.image_preview.description":"Muestra una imagen desde un archivo. (I)","search.node.character_card.title":"Ficha de Personaje","search.node.character_card.description":"Almacena imagen, nombre y prompt del personaje. (Ctrl+Shift+C)","search.node.gemini_chat.title":"Chat Gemini","search.node.gemini_chat.description":"Conversacin directa con Gemini AI. (G)","search.node.translator.title":"Traductor","search.node.translator.description":"Traduce texto al idioma seleccionado. (L)","search.node.script_generator.title":"Generador de Guiones","search.node.script_generator.description":"Convierte una idea en escenas de guion. (Shift+S)","search.node.script_analyzer.title":"Analizador de Guiones","search.node.script_analyzer.description":"Divide un guion en cuadros y prompts de imagen. (Shift+D)","search.node.script_prompt_modifier.title":"Finalizador de Prompts","search.node.script_prompt_modifier.description":"Finaliza los prompts del anlisis para generar imgenes. (Shift+F)","search.node.error_analyzer.title":"Analizador de Errores","search.node.error_analyzer.description":"Revisa y corrige gramtica y ortografa.","search.node.note.title":"Nota","search.node.note.description":"Un rea de texto simple para tus notas. (N)","search.node.reroute_dot.title":"Punto de Ruta","search.node.reroute_dot.description":"Punto para redirigir y dividir conexiones.","search.node.data_reader.title":"Lector de Datos","search.node.data_reader.description":"Muestra texto sin procesar de una conexin.","search.node.speech_synthesizer.title":"Sintetizador de Voz","search.node.speech_synthesizer.description":"Convierte texto a voz. (Shift+N)","search.node.idea_generator.title":"Generador de Ideas","search.node.idea_generator.description":"Generador de ideas (Categoras -> Idea).","search.node.narrator_text_generator.title":"Generador de Texto Narrador","search.node.narrator_text_generator.description":"Genera texto para un narrador o locutor. (Shift+G)","search.node.audio_transcriber.title":"Transcriptor de Audio","search.node.audio_transcriber.description":"Convierte archivos de audio/video a texto. (Shift+B)","search.node.youtube_title_generator.title":"Generador de Ttulos YouTube","search.node.youtube_title_generator.description":"Genera ttulos, descripciones y etiquetas atractivas para YouTube.","search.node.music_idea_generator.title":"Generador de Ideas Musicales","search.node.music_idea_generator.description":"Genera letras de canciones o prompts musicales. (Shift+M)","search.node.youtube_analytics":"Analticas de YouTube","search.node.youtube_analytics.description":"Analiza estadsticas del canal y ofrece consejos de crecimiento.","search.node.image_editor.title":"Editor de Imgenes","search.node.image_editor.description":"Edita imgenes usando IA (inpainting, outpainting).","search.group.input":"Entradas","search.group.process":"Procesamiento y Anlisis","search.group.scripting":"Herramientas de Guion","search.group.character":"Herramientas de Personaje","search.group.images":"Herramientas de Imagen","search.group.ai":"Herramientas IA","search.group.audio":"Herramientas de Audio","search.group.youtube":"Herramientas YouTube","contextMenu.tools":"Herramientas","contextMenu.assignSlot":"Asignar Ranura {index}","contextMenu.addNodeFromSlot":"Aadir {node} ({index})","connectionMenu.title":"Aadir Nodo","quickAddMenu.title":"Aadir Rpido","contextMenu.paste":"Pegar (Ctrl+V)","node.content.simpleActions":"Acciones Simples","node.content.smartConcept":"Smart Concept","tooltip.model.flash":"Gemini Flash: Rpido, eficiente, para borradores.","tooltip.model.pro":"Gemini Pro: Alta inteligencia, razonamiento complejo, detallado.","tooltip.lang.ru":"Generar guion en Ruso.","tooltip.lang.en":"Generar guion en Ingls.","tooltip.lang.es":"Generar guion en Espaol.","tooltip.lang.de":"Generar guion en Alemn.","tooltip.lang.uz":"Generar guion en Uzbeko.","tooltip.lang.fr":"Generar guion en Francs.","tooltip.lang.it":"Generar guion en Italiano.","tooltip.lang.pt":"Generar guion en Portugus.","tooltip.lang.zh":"Generar guion en Chino.","node.action.locateInStack":"Localizar en Pila","help.tabs.hotkeys":"Ayuda y Atajos","help.tabs.links":"Otras Apps y Enlaces","help.category.socials":"Redes Sociales","help.category.stable":"Google AI Studio (Estable)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":"Web / Netlify","help.category.github":"Repositorios GitHub","help.link.youtube":"Canal de YouTube","help.link.telegram_channel":"Canal de Telegram","help.link.telegram_chat":"Chat de Telegram","help.sub.news":"Noticias y Actualizaciones","help.sub.discussion":"Discusin","help.sub.stable":"Versin Estable","help.sub.alpha":"Versin Alpha","languages.ru":"Ruso","languages.en":"Ingls","languages.es":"Espaol","languages.fr":"Francs","languages.de":"Alemn","languages.it":"Italiano","languages.pt":"Portugus","languages.zh":"Chino","languages.ja":"Japons","languages.ko":"Coreano","languages.uz":"Uzbeko"},H1={"node.title.text_input":"Entrada de Texto","node.title.prompt_processor":"Procesador de Prompt","node.title.prompt_analyzer":"Analizador de Prompt","node.title.character_analyzer":"Analizador de Personaje","node.title.character_generator":"Generador de Personajes","node.title.image_generator":"Generador de Imgenes","node.title.image_preview":"Vista Previa de Imagen","node.title.character_card":"Ficha de Personaje","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Traductor","node.title.script_generator":"Generador de Guiones","node.title.script_analyzer":"Analizador de Guiones","node.title.script_prompt_modifier":"Finalizador de Prompts","node.title.error_analyzer":"Analizador de Errores","node.title.note":"Nota","node.title.reroute_dot":"Punto de Ruta","node.title.data_reader":"Lector de Datos","node.title.speech_synthesizer":"Sintetizador de Voz","node.title.idea_generator":"Generador de Ideas","node.title.narrator_text_generator":"Generador de Texto Narrador","node.title.audio_transcriber":"Transcriptor de Audio","node.title.youtube_title_generator":"Generador de Ttulos YouTube","node.title.music_idea_generator":"Generador de Ideas Musicales","node.title.youtube_analytics":"Analticas de YouTube","node.title.image_editor":"Editor de Imgenes","node.help.text_input":"Introduce ideas bsicas, palabras clave o descripciones aqu. Se pueden conectar mltiples nodos de texto a un procesador.","node.help.prompt_processor":"Toma texto de otros nodos y usa IA para combinarlos en un prompt nico, detallado y artstico.","node.help.prompt_analyzer":"Analiza el texto entrante y lo divide en cuatro partes: entorno, personaje, accin y estilo.","node.help.character_analyzer":"Analiza la descripcin de un personaje y la divide en apariencia fsica y vestimenta.","node.help.character_generator":"Toma un prompt y genera una o ms descripciones detalladas de personajes.","node.help.image_generator":"Genera una imagen a partir de un texto usando la API de Gemini.","node.help.image_preview":"Muestra una imagen desde un archivo. Arrastra y suelta un archivo de imagen en el nodo o el lienzo.","node.help.character_card":"Almacena la imagen, nombre y prompt de un personaje. Permite generar, guardar y cargar imgenes.","node.help.gemini_chat":"Nodo para conversar directamente con Gemini. Mantiene el historial del chat.","node.help.translator":"Traduce el texto entrante al idioma seleccionado.","node.help.script_generator":"Toma un prompt y genera una serie de escenas para un guion.","node.help.script_analyzer":"Analiza la estructura del guion, dividindolo en personajes y cuadros con descripciones detalladas.","node.help.script_prompt_modifier":"Toma datos analizados del guion y sintetiza prompts finales y artsticos para cada cuadro.","node.help.error_analyzer":"Revisa y corrige la ortografa y gramtica del texto.","node.help.note":"Un rea de texto simple para tus notas. No se conecta a otros nodos.","node.help.reroute_dot":"Un punto para redirigir y ramificar conexiones. El tipo de salida coincide con el de entrada.","node.help.data_reader":"Muestra datos de texto sin procesar de un nodo conectado. til para depuracin.","node.help.speech_synthesizer":"Convierte texto a voz usando una voz seleccionada.","node.help.idea_generator":"Genera categoras (Accin, Lugar, Obstculo) y las combina en una idea de historia.","node.help.narrator_text_generator":"Genera texto para un narrador o locutor basado en un prompt y estilo.","node.help.audio_transcriber":"Sube un archivo de audio o video y convierte su audio a texto.","node.help.youtube_title_generator":"Genera ttulos, descripciones y etiquetas atractivas para YouTube.","node.help.music_idea_generator":"Genera letras de canciones o prompts descriptivos para msica IA.","node.help.youtube_analytics":"Rastrea estadsticas diarias de canales de YouTube y ofrece consejos de crecimiento con IA.","node.help.image_editor":"Edita imgenes usando IA (inpainting, outpainting).","node.action.help":"Ayuda sobre este nodo","node.action.expand":"Expandir","node.action.collapse":"Contraer (H)","node.action.expandAll":"Expandir Todo","node.action.collapseAll":"Contraer Todo","node.action.expandAllScenes":"Expandir Todas las Escenas","node.action.collapseAllScenes":"Contraer Todas las Escenas","node.action.expandAllFrames":"Expandir Todos los Cuadros","node.action.collapseAllFrames":"Contraer Todos los Cuadros","node.action.expandPanel":"Expandir Panel","node.action.collapsePanel":"Contraer Panel","node.action.togglePanel":"Alternar Panel","node.action.collapseScene":"Contraer Escena","node.action.expandScene":"Expandir Escena","node.action.collapseFrame":"Contraer Cuadro","node.action.expandFrame":"Expandir Cuadro","node.action.collapseCharacter":"Contraer Personaje","node.action.expandCharacter":"Expandir Personaje","node.action.clear":"Limpiar contenido","node.action.clearTooltip":"Limpiar campo de entrada.","node.action.clearChat":"Limpiar y Recargar Chat","node.action.paste":"Pegar del Portapapeles","node.action.copy":"Copiar Valor","node.action.duplicateWithContent":"Duplicar con Contenido","node.action.duplicateEmpty":"Duplicar Vaco","node.action.cutConnections":"Cortar Conexiones","node.action.close":"Cerrar Nodo","node.action.executeChain":"Ejecutar Cadena","node.action.executeFullChain":"Ejecutar Cadena Completa","node.action.processChainForward":"Procesar Cadena Adelante","node.action.executeChainTitle":"Ejecutar todos los nodos conectados.","node.action.addCharacter":"Aadir Personaje","node.action.addScene":"Aadir Escena","node.action.addFrame":"Aadir Cuadro","node.action.addFirstFrame":"Aadir Primer Cuadro","node.action.deleteItem":"eliminar","node.action.moveUp":"Mover Arriba","node.action.moveDown":"Mover Abajo","node.action.saveImage":"Guardar Imagen","node.action.loadImage":"Cargar Imagen","node.action.saveCharacter":"Guardar Personaje","node.action.loadCharacter":"Cargar Personaje","node.action.readData":"Leer Datos","node.action.refreshData":"Refrescar Datos","node.action.stop":"Detener","node.action.stopping":"Deteniendo...","node.action.embedCharacter":"Incrustar Personaje (Desconectar y copiar datos)","node.action.downloadFinalPrompts":"Descargar Prompts Finales","node.action.rename":"Renombrar Nodo","node.action.index":"Indexar","node.action.improveConcept":"Mejorar Concepto","node.action.improveConceptTooltip":"Enriquecer, expandir y aadir detalles visuales para generacin de imgenes.","node.action.downloadJson":"Descargar JSON","node.action.downloadSRT":"Descargar SRT","node.action.markPrimary":"Marcar como Principal","node.input.default":"Entrada","node.output.default":"Salida","node.output.allCharacters":"Todos los Personajes","node.output.primaryCharacter":"Personaje Principal","node.content.action":"Accin","node.content.actionPlaceholder":"Prompt de accin...","node.content.allScriptParts":"Todas las Partes del Guion","node.content.allScriptAnalyzerData":"Datos del analizador","node.content.allNarratorData":"Todos los Datos del Narrador","node.content.analyzeCharacters":"Analizar Personajes","node.content.analyzeFromScene":"Analizar desde:","node.content.analyzeUpToScene":"hasta","node.content.endPlaceholder":"fin","node.content.generateFromFrame":"Generar desde cuadro:","node.content.generateUpToFrame":"hasta cuadro","node.content.analyzeFromFrame":"Finalizar desde cuadro:","node.content.processFromFrame":"Procesar desde cuadro:","node.content.processFromScene":"Procesar desde escena:","node.content.analyzePrompt":"Analizar Prompt","node.content.analyzeScript":"Analizar Guion","node.content.analyzing":"Analizando...","node.content.applyAliases":"Aplicar Alias","node.content.applyAliasesTooltip":'Reemplazar nombres de personajes con los alias definidos en "ndice".',"node.content.character":"Personaje","node.content.characterIndex":"ndice","node.content.characterPlaceholder":"Prompt de personaje...","node.content.character_plural":"personajes","node.content.characters":"Personajes","node.content.charactersSynced":"Personajes Sincronizados","node.content.noCharactersConnected":"Sin personajes conectados.","node.content.appearance":"Apariencia","node.content.personality":"Personalidad","node.content.characterType":"Tipo","node.content.characterTypeShort":"Tipo","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Antropomrfico (Animales)","node.content.characterType.chibi":"Chibi (Lindo)","node.content.characterType.key_item":"Objeto Clave","node.content.style":"Estilo","node.content.style.none":"Ninguno","node.content.style.simple":"Simple","node.content.style.realistic":"Realista/Cinemtico","node.content.style.3d_cartoon":"Dibujo 3D","node.content.style.3d_realistic":"3D Realista","node.content.style.2d_animation":"Animacin 2D","node.content.style.anime":"Estilo Anime","node.content.style.comics":"Cmics","node.content.style.custom":"Especial","node.content.chatPlaceholder":"Escribe un mensaje...","node.content.clothing":"Ropa","node.content.clothingPlaceholder":"Prompt de ropa...","node.content.connectedPlaceholder":"Conectado desde otro nodo","node.content.dataPlaceholder":"Los datos del nodo conectado aparecern aqu...","node.content.readData":"Leer Datos","node.content.reading":"Leyendo...","node.content.description":"Descripcin","node.content.sceneDescription":"Descripcin de Escena","node.content.duration":"Duracin","node.content.enhancePrompt":"Generar Prompt","node.content.enhancedPromptHere":"El prompt mejorado aparecer aqu...","node.content.enhancing":"Mejorando...","node.content.environment":"Entorno","node.content.environmentPlaceholder":"Prompt de entorno...","node.content.environmentPrompt":"Entorno, Decoracin y Fondo","node.content.compositionAndBlocking":"Composicin y Accin","node.content.executingChain":"Ejecutando Cadena...","node.content.imagePrompt":"Prompt de Imagen","node.content.finalPrompt":"Prompt Final","node.content.finalPrompt_plural":"Prompts Finales","node.content.fixErrors":"Corregir Errores","node.content.fixingErrors":"Corrigiendo...","node.content.frame":"Cuadro","node.content.frame_plural":"cuadros","node.content.frames":"Cuadros de Salida","node.content.frames_analyzed":"Cuadros Analizados: {count}","node.content.framesPerScene":"Cuadros por Escena","node.content.minFrames":"Mn","node.content.maxFrames":"Mx","node.content.numberOfCharactersShort":"Cant.","node.content.fullDescription":"Descripcin Completa","node.content.generateCharacters":"Generar Personajes","node.content.generateFinalPrompts":"Generar Prompts Finales","node.content.generatingProgress":"Generando prompt {current} de {total}","node.content.generateImage":"Generar Imagen","node.content.generateScript":"Generar Guion","node.content.generateSpeech":"Generar Voz","node.content.generateText":"Generar Texto","node.content.generateSSML":"Generar SSML","node.content.generateStyle":"Generar Estilo","node.content.generating":"Generando...","node.content.improving":"Mejorando...","node.content.generatedAudio":"Audio generado","node.content.imagePromptPlaceholder":"Introduce un prompt para generar imagen...","node.content.modificationPromptPlaceholder":"Solicitud de modificacin...","node.content.narrator":"Narrador","node.content.narratorEnabled":"Habilitar Narrador","node.content.narratorEnabledInfo":"Aade texto de voz en off para describir la escena o pensamientos.","node.content.narratorMode":"Modo Narrador","node.content.narratorMode.normal":"Normal / Voz en off","node.content.narratorMode.dual":"Dos Narradores","node.content.narratorMode.first_person":"Primera Persona","node.content.role":"Rol","node.content.role.narrator":"Narrador","node.content.role.announcer":"Locutor","node.content.role.first_person":"Primera Persona","node.content.role.dual_narrator":"Dos Narradores","node.content.role.dual_announcer":"Dos Locutores","node.content.scene":"Escena","node.content.scene_plural":"escenas","node.content.scenes":"Escenas","node.content.scenes_generated":"Escenas Generadas: {count}","node.content.sceneContext":"Contexto de Escena","node.content.sceneContextPlaceholder":"Estado de nimo, descripcin general del entorno...","node.content.scriptPromptPlaceholder":"Introduce una idea o concepto de historia...","node.content.seconds":"seg","node.content.stylePlaceholder":"Prompt de estilo...","node.content.stylePromptPlaceholder":"Introduce el prompt de estilo aqu...","node.content.styleOverride":"Anular Estilo","node.content.summary":"Resumen","node.content.targetLanguage":"Idioma Destino","node.content.textToSynthesize":"Texto a sintetizar...","node.content.translate":"Traducir","node.content.translatePlaceholder":"Texto para traducir...","node.content.translatedTextPlaceholder":"El texto traducido aparecer aqu...","node.content.translating":"Traduciendo...","node.content.useExistingCharacters":"Usar personajes existentes","node.content.useExistingCharactersInfo":"Usar datos de personajes conectados en lugar de generar nuevos.","node.content.createKeyItem":"Crear Secundarios/Objetos","node.content.createSecondaryChars":"Personajes Secundarios","node.content.createKeyItems":"Objetos Clave","node.content.createKeyItemInfo":"Permite a la IA crear personajes secundarios u objetos si la historia lo requiere.","node.content.noCharacters":"Sin personajes","node.content.noCharactersInfo":"El guion se centrar en eventos y atmsfera (estilo documental).","node.content.videoPrompt":"Dinmicas y Movimiento","node.content.videoPrompts":"Prompts de Video","node.content.voice":"Voz","node.content.previewVoice":"Probar Voz","node.content.voicePreviewText":"Hola, esta es una prueba de voz.","node.content.inputScripts":"Escenas de Entrada","node.content.inputFrames":"Cuadros de Entrada","node.content.outputScript":"Escenas de Salida","node.content.requestCategories":"Pedir Categoras","node.content.generateIdea":"Generar Idea","node.content.requestNewCategories":"Pedir Nuevas Categoras","node.content.category.action":"Accin","node.content.category.place":"Lugar","node.content.category.obstacle":"Obstculo","node.content.generatedIdea":"Idea Generada","node.content.storyFormat":"Formato de Historia","node.content.theme":"Tema","node.content.parameters":"Parmetros","node.content.advancedMode":"Modo Avanzado","node.content.numberOfScenes":"Nmero de escenas","node.content.numberOfScenes.auto":"Auto","node.content.detailedPlot":"Trama Detallada","node.content.detailedPlotInfo":"Habilita descripciones detalladas de acciones y giros.","node.content.includeSubscribeScene":"Escena de Suscripcin","node.content.includeSubscribeSceneInfo":"Integra una escena rompiendo la cuarta pared pidiendo suscribirse.","node.content.genre":"Gnero","node.content.genre2":"Gnero 2","node.content.breakIntoParagraphs":"Dividir en prrafos","node.content.copyVideoPrompt":"Copiar prompt de video","node.content.generateVideoPrompt":"Generar prompt de video","node.content.model":"Modelo","node.content.processWholeScene":"Procesar escena completa","node.content.processWholeSceneInfo":"Procesa todos los cuadros de una escena en una sola llamada para mayor consistencia.","node.content.batchProcessing":"Procesamiento por Lotes","node.content.batchProcessingInfo":"Procesar todas las escenas seleccionadas en una ventana de contexto.","node.content.extendedAnalysis":"Anlisis Extendido","node.content.extendedAnalysisInfo":"Divide escenas en planos detallados para mejor ritmo.","node.content.professionalStoryboard":"Storyboard de Director","node.content.professionalStoryboardInfo":"Anlisis de escenas basado en reglas de lenguaje cinematogrfico.","node.content.generateStartEndFrames":"Generar Cuadros Inicio/Fin","node.content.autoIndexCharacters":"Auto-indexar Personajes","node.content.autoIndexCharactersInfo":"Reemplaza automticamente los nombres con sus alias en los resultados.","node.content.imageToText":"Imagen a Texto","node.content.extracting":"Extrayendo...","node.content.extractedText":"Texto Extrado","node.content.activePromptStack":"Pila de Prompts Activa","node.content.noCharactersAnalyzed":"No se encontraron personajes analizados.","node.content.promptsGeneratedPlaceholder":"Los prompts generados aparecern aqu.","node.content.noCharactersInScript":"No hay personajes en el guion.","node.content.noInputScenes":"Sin datos de entrada. Conecta un Generador de Guiones.","node.content.status":"Estado","node.content.status.ready":"Listo","node.content.status.paused":"Pausado","node.content.status.generating":"Generando","node.content.status.total":"Total: {generated} / {total}","node.content.status.batch":"Procesando: {current} de {total}","node.content.status.time":"Tiempo: {current}s / {total}s","node.content.refreshing":"Actualizando...","node.content.totalFrames":"Total Cuadros: {count}","node.content.uploadAudio":"Subir Audio/Video","node.content.noAudioLoaded":"Sin audio","node.content.audioLoaded":"Audio cargado","node.content.transcriptionPlaceholder":"La transcripcin aparecer aqu...","node.content.transcribe":"Transcribir","node.content.transcribing":"Transcribiendo...","node.content.convertingVideo":"Convirtiendo video...","node.content.recommendedFrames":"Cuadros Estimados","node.content.shotType":"Tipo de Plano","node.content.shotType.ws":"WS (Amplio)","node.content.shotType.ms":"MS (Medio)","node.content.shotType.cu":"CU (Primer Plano)","node.content.shotType.ecu":"ECU (Extremo)","node.content.shotType.ls":"LS (Largo)","node.content.characterDetail":"Detalle de Personajes","node.content.noCharDesc":"Sin descripciones de personaje","node.content.includeGeneralCharDesc":"Descripcin visual general","node.content.includeFullCharDesc":"Descripcin visual detallada","node.content.safeGeneration":"Generacin Segura","node.content.shotFilter":"Filtro de Planos","node.content.shotFilter.all":"Todos","node.content.shotFilter.wideOnly":"Solo Amplios","instruction.desc.shot_filter_all":"Permitir todos los tipos de plano (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Restringir a planos amplios (WS, MS, LS). Primeros planos prohibidos.","node.content.anthroEnabled":"Animales Antropomrficos","node.content.subscribeEnhancement":"Mejorar CTA Suscripcin","node.content.thinkingEnabled":"Modo Pensamiento","node.content.scenelessMode":"Escenas sin guion","instruction.desc.sceneless_mode":"Desactiva el motor narrativo. Genera lista de escenas directamente desde el concepto.","instruction.sceneless_mode":"Modo Lista de Escenas","node.content.microActionBreakdown":"Micro-Acciones","node.content.microActionBreakdownInfo":"Descompone acciones complejas en fases (Preparao, Accin, Reaccin).","node.content.commercialSafe":"Seguro Comercial","instruction.desc.commercial_safe":"Evita estrictamente marcas registradas (Disney, Pixar, etc.) y nombres de personajes con derechos de autor.","node.content.findStack":"Buscar en pila...","node.content.spm_stack.priming":"1. Preparacin y Contexto","node.content.spm_stack.physics":"2. Fsica y Lgica","node.content.spm_stack.hierarchy":"3. Jerarqua del Sujeto","node.content.spm_stack.construction":"4. Construccin y Formato"},B1={"genre.general":"General","genre.comedy":"Comedia","genre.drama":"Drama","genre.action":"Accin","genre.scifi":"Ciencia Ficcin","genre.fantasy":"Fantasa","genre.horror":"Terror","genre.thriller":"Suspense","genre.childrens_animation":"Animacin infantil","genre.shorts_story":"Historias cortas (Shorts)","genre.scientific_historical":"Narrativa Cientfico-Histrica","character_generator.promptPlaceholder":'Introduce una idea, ej: "valiente caballero, guardin del bosque antiguo"',"idea_generator.randomTheme":"Obtener tema aleatorio","idea_generator.randomCombination":"Combinacin aleatoria","idea_generator.themePlaceholder":"ej. Espacio, Cocina, Bosque Encantado","idea_generator.initialMessage":'Introduce un tema (opcional) y pulsa "{buttonName}" para comenzar.',"idea_generator.ideaPlaceholder":"La idea generada aparecer aqu...","idea_generator.format.general":"General","idea_generator.format.childrens":"Infantil","idea_generator.format.adventure":"Aventura","idea_generator.format.fantasy":"Fantasa / Magia","idea_generator.format.detective":"Detective","idea_generator.format.scifi":"Ciencia Ficcin","idea_generator.format.horror":"Terror","idea_generator.format.historical":"Histrico","gender.male":"Masculino","gender.female":"Femenino","node.content.autoDownload":"Descarga automtica al generar","node.content.downloadSelected":"Descargar Seleccionados","node.content.intonation":"Entonacin","intonation.standard":"Estndar","intonation.cheerful":"Alegre","intonation.angry":"Enojado","intonation.sad":"Triste","intonation.excited":"Emocionado","intonation.announcer":"Locutor","intonation.whispering":"Susurrando","node.content.sceneMode":"Modo Escena","node.content.connectNarratorData":'Conecta "Todos los Datos del Narrador" desde un Generador de Guiones.',"node.content.sceneModeActive":"Modo Escena activo. Datos recibidos por conexin.","speech_synthesizer.mode.simple":"Simple","speech_synthesizer.mode.scene":"Escena","speech_synthesizer.multiSpeaker":"Dos Locutores","speech_synthesizer.speaker1Name":"Nombre Locutor 1","speech_synthesizer.speaker2Name":"Nombre Locutor 2","speech_synthesizer.multiSpeakerHint":'Los nombres deben coincidir con los del texto (ej. "Hombre: ...", "Mujer: ...").',"speech_synthesizer.ssmlHint":"La entonacin se controla mediante etiquetas SSML en el texto.","youtube_analytics.authorName":"Nombre del Autor","youtube_analytics.videoTitle":"Ttulo del Video","youtube_analytics.views":"Vistas","youtube_analytics.addToChannel":"Aadir al Canal","youtube_analytics.noIncomingData":"Sin datos entrantes.","youtube_analytics.videoAdded":"Video aadido!","youtube_analytics.dragDrop":"Arrastra captura de fila aqu","youtube_analytics.thumbnailUpdated":"Miniatura actualizada","youtube_analytics.statsTrend":"Tendencia de Estadsticas","youtube_analytics.currentChannel":"Canal Actual","youtube_analytics.growth":"Crecimiento","youtube_analytics.allChannels":"Todos los Canales","youtube_analytics.saveDisk":"Guardar Disco","youtube_analytics.saveCatalog":"Guardar Catlogo","youtube_analytics.loadDisk":"Cargar Disco","youtube_analytics.analyzing":"Analizando...","youtube_analytics.askAI":"Preguntar a IA","youtube_analytics.clickForAdvice":'Clic en "Preguntar a IA" para consejos.',"youtube_analytics.dailyNotes":"Notas Diarias","youtube_analytics.logDailyStats":"Registrar Estadsticas","youtube_analytics.subscribers":"Suscriptores","youtube_analytics.totalViews":"Vistas Totales","youtube_analytics.updateStats":"Actualizar","youtube_analytics.history":"Historial","youtube_analytics.noHistory":"Sin historial.","youtube_analytics.noNotes":"Sin notas.","youtube_analytics.noVideos":"Sin videos.","youtube_analytics.loadedFromDisk":"Cargado desde disco","youtube_analytics.loadFailed":"Fallo al cargar","youtube_analytics.savedToDisk":"Guardado en disco","youtube_title_generator.mode.title":"Ttulo de Video","youtube_title_generator.mode.channel":"Info de Canal","youtube_title_generator.ideaPlaceholder":"Introduce idea o tema del video...","youtube_title_generator.channelIdeaPlaceholder":"Introduce tema o nicho del canal...","youtube_title_generator.title":"Ttulo","youtube_title_generator.description":"Descripcin","youtube_title_generator.tags":"Etiquetas","youtube_title_generator.channelName":"Nombre del Canal","youtube_title_generator.channelDescription":"Descripcin del Canal","youtube_title_generator.channelKeywords":"Palabras Clave","youtube_title_generator.channelHandle":"Handle (@)","music_idea_generator.mode.lyrics":"Letras","music_idea_generator.mode.music_prompt":"Prompt Musical","music_idea_generator.ideaPlaceholder":"Introduce tema o estado de nimo...","music_idea_generator.songTitle":"Ttulo de Cancin","music_idea_generator.songTitlePlaceholder":"Ttulo...","music_idea_generator.lyricsPlaceholder":"La letra aparecer aqu...","music_idea_generator.musicPromptPlaceholder":"El prompt musical IA aparecer aqu...","chat.mode.general":"General","chat.mode.script":"Experto en Guiones","chat.mode.prompt":"Experto en Prompts","chat.mode.youtube":"Experto en YouTube"},V1={"catalog.title":"Catlogo","catalog.tabs.groups":"Grupos","catalog.tabs.library":"Biblioteca de Prompts","catalog.tabs.characters":"Personajes","catalog.tabs.scripts":"Guiones","catalog.tabs.analysis":"Anlisis","catalog.tabs.final_prompts":"Prompts Finales","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"Ideas Musicales","catalog.empty.title":"El catlogo est vaco","catalog.empty.description":"Guarda un elemento para verlo aqu, o imprtalo desde un archivo.","catalog.loadFromFile":"Aadir al Catlogo desde Archivo","catalog.card.addToCanvas":"Aadir al Lienzo","catalog.card.rename":"Renombrar","catalog.card.save":"Guardar en Disco","catalog.card.delete":"Eliminar","library.loadFromFile":"Cargar desde Archivo","library.empty.title":"La carpeta est vaca","library.empty.description":"Crea una nueva carpeta o prompt para comenzar.","library.emptyPrompt":"Sin contenido","library.actions.newFolder":"Nueva Carpeta","library.actions.newPrompt":"Nuevo Prompt","library.actions.copy":"Copiar al Portapapeles","library.actions.edit":"Editar Prompt","group.rename":"Renombrar Grupo","group.saveToCatalog":"Guardar en Catlogo","group.saveToDisk":"Guardar en Disco","group.ungroup":"Desagrupar (Shift+Clic para eliminar contenido)","group.button.create":"Agrupar ({count})"},$1={"dialog.rename.title":"Renombrar Elemento","dialog.rename.group.title":"Renombrar Grupo","dialog.rename.catalog.title":"Renombrar Elemento del Catlogo","dialog.rename.label":"Nuevo nombre","dialog.rename.confirm":"Renombrar","dialog.rename.cancel":"Cancelar","dialog.promptEdit.title":"Editar Prompt","dialog.promptEdit.nameLabel":"Nombre del Prompt","dialog.promptEdit.contentLabel":"Contenido","dialog.promptEdit.confirm":"Guardar","dialog.promptEdit.cancel":"Cancelar","dialog.reset.title":"Restablecer Lienzo","dialog.reset.message":"Ests seguro de querer restablecer el lienzo a su estado predeterminado? Esto borrar todo el trabajo actual.","dialog.exit.title":"Cerrar Proyecto?","dialog.exit.message":"Ests seguro? Todos los datos no guardados se perdern y volvers a la pantalla de bienvenida.","dialog.settings.title":"Ajustes","dialog.settings.apiKeyLabel":"Clave API de Gemini","dialog.settings.apiKeyPlaceholder":"Introduce tu clave API aqu","dialog.settings.getApiKeyLink":"Obtener clave API en Google AI Studio","dialog.settings.useFreeKey":"Usar clave API gratuita (limitada)","dialog.settings.save":"Guardar","dialog.settings.close":"Cerrar","dialog.apiKey.title":"Ajustes de Clave API","dialog.apiKey.description":"Para usar esta aplicacin, necesitas una clave API de Gemini. Por favor, introdcela abajo. Se almacenar localmente en tu navegador.","dialog.apiKey.keyExists":"Ya hay una clave API guardada en tu navegador.","dialog.apiKey.clear":"Borrar Clave","dialog.apiKey.save":"Guardar Clave","dialog.apiKey.update":"Actualizar Clave","dialog.apiKey.useFreeKey":"Usar clave gratuita (para desarrollo)","dialog.permission.title":"Acceso al Portapapeles","dialog.permission.description":'Esta aplicacin solicita acceso al portapapeles para habilitar la funcin "Pegar" en los nodos. Solo leeremos tu portapapeles cuando uses explcitamente esta funcin.',"dialog.permission.decline":"Rechazar","dialog.permission.allow":"Permitir","alert.groupSaved":'Grupo "{groupTitle}" guardado en el catlogo!',"toast.groupSavedToDisk":'Grupo "{groupTitle}" guardado en disco!',"alert.confirmDelete":"Ests seguro de que deseas eliminar este elemento del catlogo?","alert.invalidCatalogFile":"Archivo de catlogo invlido o corrupto.","alert.loadCatalogFailed":"Fallo al cargar elemento del catlogo","alert.confirmLoadProject":"Cargar un proyecto reemplazar todos los datos actuales (pestaas, catlogo, ajustes). Ests seguro?","dialog.confirmDelete.title":"Confirmar Eliminacin","dialog.confirmDelete.message":'Ests seguro de que deseas eliminar "{itemName}"? Esta accin no se puede deshacer.',"dialog.confirmDelete.folderMessage":'Ests seguro de que deseas eliminar la carpeta "{itemName}" y todo su contenido? Esta accin no se puede deshacer.',"dialog.confirmDelete.confirm":"Eliminar","dialog.confirmDelete.cancel":"Cancelar","dialog.confirmClear.title":"Confirmar Limpieza de Lienzo","dialog.confirmClear.message":"Ests seguro de que deseas eliminar todo del lienzo? Esta accin no se puede deshacer.","toast.copied":"Copiado al portapapeles","toast.pasted":"Pegado!","toast.cleared":"Limpiado","toast.resetComplete":"Restablecido por defecto","toast.projectSaved":"Proyecto guardado en disco","toast.canvasSaved":"Lienzo guardado en disco!","toast.saveFailed":"Fallo al guardar proyecto","toast.connectionsCut":"Conexiones cortadas","toast.charSaved":"Personaje guardado en disco","toast.charLoaded":"Personaje cargado","toast.videoPasted":"Video aadido desde portapapeles","toast.savedToCatalog":"Guardado en Catlogo","toast.apiKeySaved":"Clave API guardada con xito","toast.apiKeyCleared":"Clave API eliminada","toast.projectLoaded":"Proyecto cargado con xito","alert.batchMismatch":"Advertencia: Discrepancia de cuadros en Escena {scene} (Esperado: {expected}, Obtenido: {got}). Mapeo aproximado."},W1={"instruction.desc.safe_gen":"RESTRICCIN DE SEGURIDAD CRTICA: Evita estrictamente palabras que activen filtros de seguridad de IA. Reemplaza trminos como 'adolescente', 'ntimo' o 'revelador' con alternativas artsticas como 'joven', 'composicin artstica' o 'estilizado'.","instruction.desc.layered_no_style":"Estructura: 1. [Fondo Global (Cielo -> Horizonte -> Plano Medio)] -> 2. [Jerarqua del Sujeto (Personaje Completo -> Postura -> Micro-Accin)] -> 3. [Cmara]. NUNCA describas una accin sin describir primero al personaje completo."},Y1={"instruction.sg_inputs":"Datos de Entrada","instruction.desc.sg_inputs":"Fuente: Concepto/Idea, Perfiles de Personaje.","instruction.core_director":"Director Principal","instruction.desc.core_director":"Eres un Director de Cine Visionario y Guionista. Piensa en lentes, movimiento y composicin. Cada palabra es un comando cinematogrfico.","instruction.sg_thinking":"Analizar","instruction.desc.sg_thinking":"Razonar antes de escribir. Analizar causalidad y lgica. Eliminar clichs.","instruction.sg_improve_input":"Doctor de Guion","instruction.desc.sg_improve_input":"Mejorar concepto inicial, arreglar agujeros de trama y agudizar conflicto.","instruction.sg_exposition":"Exposicin","instruction.desc.sg_exposition":"Mostrar el estado del mundo a travs de historia ambiental y detalles.","instruction.sg_delayed_reveal":"Revelacin","instruction.desc.sg_delayed_reveal":"Intro gradual de hroe: entorno -> detalles -> silueta -> cara.","instruction.sg_metaphor":"Metfora","instruction.desc.sg_metaphor":"Usar smbolos visuales (objetos rotos, clima) para estados internos.","instruction.sg_pacing":"Ritmo","instruction.desc.sg_pacing":"Control de ritmo: equilibrar tomas contemplativas con edicin dinmica.","instruction.sg_subtext":"Subtexto","instruction.desc.sg_subtext":"Crear tensin entre dilogo y accin. Personajes rara vez dicen la verdad directamente.","instruction.desc.sg_frame_estimation":"Clculo recomendado de planos.","instruction.rule_visuals":"Visuales Primero","instruction.desc.rule_visuals":"Muestra, No Cuentes. En lugar de decir 'Estaba triste', describe 'Se desplom en la silla'. Foco en iluminacin, composicin, movimiento.","instruction.sg_visual_dna":"ADN Visual","instruction.desc.sg_visual_dna":"Sintetiza prompts de personajes y parmetros de estilo en una gua tcnica LookDev (Iluminacin, Lentes, Render) separada de la trama.","instruction.rule_flow":"Flujo Continuo","instruction.desc.rule_flow":"Lgica de Match Cut: Usa formas, colores o sonidos para transiciones fluidas entre escenas.","instruction.rule_atmosphere":"Atmsfera","instruction.desc.rule_atmosphere":"Describe detalles tctiles: olor a lluvia, zumbido de nen, textura de polvo. Haz el mundo real.","instruction.sg_visual_style":"Estilo Visual","instruction.desc.sg_visual_style":"Solicitud: Generar una descripcin de estilo visual detallada basada en '{style}'.","instruction.char_detailed_style":"Detalle Estilizado","instruction.desc.char_detailed_style":"Integra el estilo visual global en el prompt tcnico de cada personaje para consistencia visual mxima.","instruction.sg_genre":"Contexto de Gnero","instruction.desc.sg_genre":"Contexto: {genre}","instruction.char_smart_concept":"Concepto Inteligente","instruction.desc.char_smart_concept":"IA elige: Cuerpo Completo para Personajes / Relleno de Cuadro para Objetos.","instruction.char_no_dupes":"Sin Duplicados","instruction.desc.char_no_dupes":"CRTICO: NO regeneres personajes a menos que se requiera CAMBIO DE VESTUARIO. En ese caso, crea un duplicado con la nueva ropa.","instruction.create_secondary_chars":"Personajes Secundarios","instruction.desc.create_secondary_chars":"PUEDES generar nuevos personajes secundarios si la trama lo requiere. Cambios de vestuario permitidos.","instruction.create_key_items":"Objetos Clave","instruction.desc.create_key_items":"Creacin obligatoria de 'Fichas de Personaje' para objetos que aparecen en >2 cuadros o mltiples escenas.","instruction.char_secondary_ok":"Nuevos Permitidos","instruction.desc.char_secondary_ok":"PUEDES generar nuevos personajes secundarios u objetos clave. SI CAMBIA ROPA: Crea una nueva ficha para el personaje principal con el nuevo prompt de ropa.","instruction.sg_anthro":"Anthro","instruction.desc.sg_anthro":"Los personajes deben ser animales Antropomrficos.","instruction.sg_no_chars":"Sin Personajes","instruction.desc.sg_no_chars":"Estilo documental / Sin personajes nombrados.","instruction.sg_detailed_plot":"Trama Detallada","instruction.desc.sg_detailed_plot":"Proporcionar descripciones altamente detalladas de acciones y trama.","instruction.sg_subscribe":"Escena Suscripcin","instruction.desc.sg_subscribe":"Incluir una escena rompiendo la 4 pared pidiendo suscribirse.","instruction.char_gray_bg":"Concepto Visual","instruction.desc.char_gray_bg":"Para cada prompt visual de personaje, SIEMPRE aade: ', full body character concept on a gray background'.","instruction.char_no_new":"Sin Nuevos","instruction.desc.char_no_new":"NO crees nuevos personajes u objetos. Usa SOLO los Personajes Existentes proporcionados.","instruction.sg_new_chars":"Nuevos Personajes","instruction.desc.sg_new_chars":"Generar nuevos personajes basados en el prompt.","instruction.sg_living_world":"Mundo Vivo","instruction.desc.sg_living_world_simple":"Los extras de fondo son personas normales.","instruction.desc.sg_living_world_anthro":"Los extras de fondo son animales antropomrficos.","instruction.sg_simple_actions":"Acciones Simples","instruction.desc.sg_simple_actions":"Evitar fsica compleja/acrobacias. Preferir poses estables y renderizables.","instruction.commercial_safe":"Seguro Comercial","instruction.desc.commercial_safe":"Evita estrictamente marcas registradas (Disney, Pixar, etc.) y nombres de personajes con derechos de autor."},q1={"instruction.ana_role":"Rol de Analizador","instruction.desc.ana_role":"Eres un Director de Cine y Director de Fotografa de clase mundial. Escribes instrucciones para la generacin de imgenes y video por IA. Cada cuadro debe describirse repetidamente y en detalle, independientemente del anterior, manteniendo el contexto de los cuadros anteriores. No utilices abreviaturas ni recursos literarios.","instruction.ana_cinema":"Cinematografa","instruction.desc.ana_cinema":"Trminos profesionales: Wide Shot, Close-up, Dutch Angle, Bokeh para encuadre e iluminacin.","instruction.ana_cinema_wide":"Cinematografa (Amplia)","instruction.desc.ana_cinema_wide":"Trminos profesionales: Wide Shot, Long Shot, Dutch Angle para encuadre. Evitar Close-up.","instruction.ana_anthro_logic":"Lgica Anthro","instruction.desc.ana_anthro_logic":'Describir explcitamente personajes como Animales Antropomrficos (ej., "Anthropomorphic Fox") en cada descripcin.',"instruction.ana_subscribe_logic":"CTA Suscripcin","instruction.desc.ana_subscribe_logic":"Si la escena pide Suscribirse, aadir acciones visuales: personajes con carteles o interactuando con texto 3D.","instruction.rule_hierarchy":"Algoritmo Maestro de Encuadre","instruction.desc.rule_hierarchy":"Orden estricto: 1. Global (Ubicacin/Clima/nimo/Actividad). 2. Postura (Tumbado/De pie en objeto). 3. Interaccin con Objeto (Color/Material/Textura). 4. Accin.","instruction.rule_living_world":"Mundo Vivo","instruction.desc.rule_living_world":"Si es lugar pblico, describe extras/siluetas de fondo consistentes con el contexto del mundo.","instruction.desc.rule_living_world_anthro":"Los extras de fondo deben ser animales antropomrficos (NO humanos).","instruction.rule_persistence":"Persistencia","instruction.desc.rule_persistence":"PERSISTENCIA CRONOLGICA DE ESCENA: Mantener un estado global persistente para toda la escena. Cada cuadro es parte de un espacio fsico nico. Rastrea la posicin exacta, pose y estado de cada personaje y objeto. Si el Personaje A est en el Cuadro 1 pero la cmara corta al Personaje B en el Cuadro 2, el Personaje A debe seguir existiendo lgicamente en su ltima posicin.","instruction.rule_mandatory_bg":"Fondo Global Obligatorio","instruction.desc.rule_mandatory_bg":"PROHIBIDO dejar el fondo vaco o decir solo 'fondo borroso'. Describe siempre la ubicacin y la iluminacin completamente, incluso para tomas macro.","instruction.desc.rule_mandatory_bg_wide":"PROHIBIDO dejar el fondo vaco. Como usas SOLO PLANOS AMPLIOS, debes proporcionar detalles completos de geografa, horizonte y clima en cada cuadro.","instruction.shot_filter_wide":"Solo Planos Amplios","instruction.desc.shot_filter_wide":"FILTRO ESTRICTO: Usar SOLO Planos Amplios (WS), Largos (LS) y Medios (MS). Primeros Planos (CU/ECU) prohibidos.","instruction.storyboard_rules":"Variedad de Planos","instruction.desc.storyboard_rules":"Alternar entre planos WS/LS (Ancho), MS (Medio) y CU/ECU (Primer Plano) para ritmo dinmico y enfoque emocional.","instruction.storyboard_rules_wide":"Variedad de Planos (Solo Amplios)","instruction.desc.storyboard_rules_wide":"Usar solo planos Amplios, Largos y Establecimiento. Variar ngulo. NO Primeros Planos.","instruction.tech_directives":"Control de Cmara","instruction.desc.tech_directives":"Terminologa tcnica estricta. Para tipos de plano usar SOLO abreviaturas (WS, MS, CU).","instruction.tech_directives_wide":"Control de Cmara (Amplio)","instruction.desc.tech_directives_wide":"Terminologa tcnica estricta. Usar SOLO abreviaturas (WS, MS, LS). NO CU/ECU.","instruction.use_aliases":"Usar Alias","instruction.desc.use_aliases":"Usar formato Character-N en arrays.","instruction.action_phase_breakdown":"Micro-Acciones","instruction.desc.action_phase_breakdown":"Descomponer acciones complejas en fases de preparacin, inicio, pice y reaccin.","instruction.desc.action_phase_breakdown_wide":"Descomponer fases, pero MANTENIENDO PLANO AMPLIO. Mostrar impacto por postura corporal, no zoom.","instruction.batch_processing":"Procesamiento por Lotes","instruction.desc.batch_processing":"Analizar todas las escenas proporcionadas como una secuencia continua para mantener consistencia narrativa y visual.","instruction.ana_prompt_lang":"Idioma de Prompt","instruction.desc.ana_prompt_lang":"Prompts de imagen y video estrictamente en ingls para mejor compatibilidad.","instruction.extended_visuals":"Desglose Visual Extendido","instruction.desc.extended_visuals":"Descompone escenas en secuencias cortas y expresivas (Wide, MS, CU, Detalle). Foco en ritmo cinemtico y emocin.","instruction.extended_visuals_wide":"Desglose Visual Extendido (Amplio)","instruction.desc.extended_visuals_wide":"Descompone escenas en secuencias usando estrictamente planos Amplios/Medios. Foco en geografa y atmsfera. Sin Primeros Planos.","instruction.desc.target_lang":"El anlisis de cuadros y descripciones se generarn en este idioma.","instruction.rule_isolation":"Cero Contexto","instruction.desc.rule_isolation":"CRTICO: El generador de imgenes NO SABE sobre el cuadro anterior. DEBES volver a describir el entorno y el clima en cada cuadro.","instruction.sensory_saturation":"Anti-Brevedad","instruction.desc.sensory_saturation":'PROHIBIDO ser breve. En lugar de "Manos agarrando", escribe "Manos sucias con nudillos blancos agarrando fuertemente el vidrio fro".',"instruction.ana_no_pov":"No POV","instruction.desc.ana_no_pov":'NEGATIVO CRTICO: PROHIBICIN ESTRICTA de tomas "POV" o de "Primera Persona". La cmara DEBE ser externa.',"instruction.desc.static_frame_logic":'PROHIBICIN ESTRICTA de verbos de movimiento ("caminar", "balancearse"). Describe un momento CONGELADO. "Espuma congelada en el aire", "Hojas inclinadas por el viento".',"instruction.desc.anatomical_posing":'Describe GEOMETRA corporal. En lugar de "descansando", escribe: "Acostado supino, brazos a los lados, cabeza inclinada hacia atrs".',"instruction.desc.motion_dynamics":"SEPARACIN: Image Prompt = 100% Esttico. Video Prompt = Movimiento y Tiempo (respiracin, olas, viento).","instruction.desc.anatomical_strictness":'RIGGING: Evita "Brazos detrs de la cabeza Y sosteniendo bebida". Fuerza descripcin separada: Brazo Izquierdo [estado], Brazo Derecho [estado].',"instruction.desc.prop_consistency":'BLOQUEO DE OBJETOS: Prohibido usar sustantivos genricos ("espada", "telfono"). Debe especificar atributos visuales ("espada de hierro oxidada", "telfono de plstico negro") y repetirlos.',"instruction.desc.subject_hierarchy":'Incluso para Primeros Planos, describe: 1. Personaje Completo/Postura. 2. Interaccin con Entorno. 3. El Detalle. Ejemplo: "Parado en una tabla de surf blanca dentro de una ola -> Primer plano de cara mojada".',"instruction.inputs_data":"Entradas","instruction.desc.inputs_data":"Datos fuente: Resumen del guion, Perfiles de personajes, Textos de escenas."},K1={"instruction.inputs":"Entradas","instruction.desc.inputs":"Fuente de Datos: Cuadros del guion, Visuales de personajes, Estilo de escena, Contexto Global.","instruction.role":"Rol: Artista de Entornos Principal","instruction.desc.role":"Eres un experto Artista de Entornos e Ingeniero de Prompts. Sintetiza las entradas en una descripcin visual definitiva.","instruction.layered":"Algoritmo: Flujo Unificado","instruction.desc.layered":"Genera un bloque NICO y continuo de texto. Estructura: [Estilo] -> [DISEO MAESTRO DEL SET] -> [Visuales] + [POSE Y ACCIN] -> [Cmara].","instruction.desc.layered_no_char":"Estructura: [DISEO MAESTRO] -> [ndice] + [POSE Y ACCIN]. Omite la apariencia del personaje, manteniendo solo ndices y acciones.","instruction.visuals":"Estilo: Saturacin","instruction.desc.visuals":"Usa descriptores visuales ricos: iluminacin volumtrica, claroscuro, texturas 8k, profundidad de campo.","instruction.process_whole_scene":"Lote de Escena","instruction.desc.process_whole_scene":"Analizar la escena completa a la vez para consistencia.","instruction.video":"Video","instruction.desc.video":"Prompt de Video: [ndice] (Desc Visual Detallada) [Accin] en un bloque. Dinmicas: [Movimiento Entorno]. Cmara: [Movimientos]. SIN NOMBRES.","instruction.stateless":"Regla: Sin Estado","instruction.desc.stateless":"Trata cada cuadro como independiente. Redescribe completamente el entorno incluso si estaba en el cuadro anterior. OBLIGATORIO: Redescribe completamente la accin de CADA personaje desde cero (Postura -> Extremidades -> Cara).","instruction.rule_static":"Regla: Esttico","instruction.desc.rule_static":"Describe solo el momento congelado. Sin transies narrativas.","instruction.atmosphere_fix":"Ancla Atmosfrica","instruction.desc.atmosphere_fix":"Describe el estado de nimo como propiedades fsicas del aire y la luz.","instruction.subject_focus":"Jerarqua de Contexto","instruction.desc.subject_focus":"CRTICO: Incluso para Primeros Planos, describe 1. Personaje Completo. 2. Pose. 3. Detalle. La IA necesita el contexto corporal completo para renderizar partes correctamente.","instruction.always_env":"DISEO DE SET OBLIGATORIO","instruction.desc.always_env":"CRTICO: Usa el 'Contexto Global de Escena' como la VERDAD ABSOLUTA para el fondo. DEBES inyectar los detalles especficos de muebles, iluminacin y texturas del contexto en la capa de entorno de CADA prompt. No inventes fondos genricos.","instruction.pm_anthro":"Detalle Anthro","instruction.desc.pm_anthro":'OBLIGATORIO: Palabra "anthropomorphic" antes de especie en Imagen Y Video. Texturas/anatoma mejoradas.',"instruction.pm_subscribe":"Texto Legible","instruction.desc.pm_subscribe":'Asegurar que texto como "SUBSCRIBE" sea legible e integrado (nen, letreros, 3D) en el prompt final.',"instruction.strict_char_index":"Personajes","instruction.desc.strict_char_index":"Mapear estrictamente Alias de personajes (Character-N) a cada dato de cuadro.","instruction.no_names":"CRTICO: SIN NOMBRES","instruction.desc.no_names":'CRTICO: PROHIBICIN ABSOLUTA DE NOMBRES. Usa ESTRICTAMENTE el ID de ndice (Character-N). Prohibido "Character-1 (Nombre)". Salida SOLO "[Character-1]".',"instruction.general_char_desc":"Detalle General","instruction.desc.general_char_desc":"Resumir e incorporar una versin CONCISA y GENERAL del prompt visual del perfil del personaje.","instruction.full_char_desc":"Detalle Completo","instruction.desc.full_char_desc":"Incorporar el prompt visual COMPLETO y DETALLADO del perfil del personaje exactamente como est escrito.","instruction.formatting":"Formato","instruction.desc.formatting":"Habilita ENCABEZADOS explcitos (Entorno, Interaccin, Tcnico) y saltos de lnea. salo si prefieres estructura en lugar de texto plano.","instruction.anatomical_strictness":"Lgica Anatmica","instruction.desc.anatomical_strictness":'RIGGING: Previene "Brazos detrs de la cabeza Y sosteniendo bebida". Fuerza descripcin separada: Brazo Izquierdo [estado], Brazo Derecho [estado]. Elimina extremidades extra.',"instruction.img_vid_consistency":"Flujo Img->Vid","instruction.desc.img_vid_consistency":"Image Prompt = Cuadro Inicial (Esttico). Video Prompt = Accin/Movimiento (Evolucin). Asegura que el video evolucione naturalmente desde la imagen esttica.","instruction.desc.prop_enhancement":'MATERIALIDAD: Amplifica descripciones de objetos (ej. "tabla roja" -> "fibra de vidrio roja brillante"). Preserva colores/tipos especificados.',"instruction.no_pov":"CRTICO: NO POV","instruction.desc.no_pov":'PROHIBICIN ESTRICTA de ngulos POV/Primera Persona. La cmara DEBE ser externa (Tercera Persona). No usar "visto a travs de los ojos".'},J1={"instruction.music_role":"Rol de Productor Musical","instruction.desc.music_role":"Definicin del rol de Compositor y Letrista experto.","instruction.music_input":"Datos de Entrada","instruction.desc.music_input":"El tema o idea proporcionada por el usuario.","instruction.music_creative":"Libertad Creativa","instruction.desc.music_creative":"Fuerza a la IA a interpretar el ambiente metafricamente, no literalmente. Evita salidas genricas.","instruction.music_lyrics":"Estructura de Letra","instruction.desc.music_lyrics":"Genera estructura de Verso/Estribillo adecuada al gnero.","instruction.music_prompt_rule":"Prompt Musical IA","instruction.desc.music_prompt_rule":"Etiquetas tcnicas para Suno/Udio (BPM, Instrumentos, Vocales). Mx 1000 caracteres.","instruction.music_format":"Salida JSON","instruction.desc.music_format":"Estructura JSON estricta para integracin."},X1={"instruction.yt_role":"Estratega de YouTube","instruction.desc.yt_role":"Experto en SEO, CTR y Psicologa Viral.","instruction.yt_input":"Datos de Entrada","instruction.desc.yt_input":"El tema o nicho proporcionado.","instruction.yt_title_mode":"Metadatos de Video","instruction.desc.yt_title_mode":"Optimiza Ttulos/Desc/Etiquetas para mximos clics.","instruction.yt_channel_mode":"Branding de Canal","instruction.desc.yt_channel_mode":"Crea Nombre, Bio y Handle consistentes.","instruction.yt_format":"Salida JSON","instruction.desc.yt_format":"Estructura JSON estricta para integracin."},Z1={...W1,...Y1,...q1,...K1,...J1,...X1},Q1={...G1,...U1,...H1,...B1,...V1,...$1,...Z1},eb={"app.title":"Ssenariy Modifikatori","app.description":"Gemini API yordamida ssenariylarni vizual tarzda yarating, takomillashtiring va generatsiya qiling.","app.slogan":"Goyalarni boglab, shoh asar yarating","app.subtitle":"Ssenariylaringizni Vizualizatsiya Qiling","app.error.title":"Bildirishnoma","app.error.copy":"Xatoni nusxalash","app.error.copied":"Nusxalandi!","error.quotaExceeded":"Foydalanish limitiga yetdingiz. Iltimos, API kalitingiz kvotasini tekshiring yoki keyinroq urinib koring.","error.apiKeyMissing":"API kaliti topilmadi. Iltimos, sozlamalarda Gemini API kalitingizni kiriting.","error.freeKeyNotAvailable":"Bepul/ishlab chiquvchi API kaliti ushbu muhitda mavjud emas. Iltimos, oz kalitingizni taqdim eting.","error.fileReadError":"Faylni oqishda xatolik.","error.videoConversionError":"Videoni audioga aylantirib bolmadi.","error.unsupportedFile":"Qollab-quvvatlanmaydigan fayl turi.","error.promptModifierFile":"Ushbu fayl boshqa dasturga tegishli (Prompt Modifier). Iltimos, uni tegishli ilovada oching.","error.invalidFileType":"Notogri fayl turi. Iltimos, Script Modifier loyihasi yoki kanvas faylini yuklang.","welcome.iAmDeveloper":"Men dasturchiman","welcome.letsGo":"Kettik!","welcome.resume":"Davom ettirish","welcome.reload":"Qayta yuklash","welcome.reloadTitle":"Qayta yuklansinmi?","welcome.reloadMessage":"Bu butun kanvasni tozalaydi va ilovani qayta yuklaydi. Saqlanmagan ma'lumotlar yo'qoladi. Ishonchingiz komilmi?","welcome.confirmReload":"Qayta yuklash","dialog.welcome.title":"Ssenariy Modifikatori","dialog.welcome.heading":"Xush kelibsiz","dialog.welcome.intro1":"Ssenariy Modifikatoriga xush kelibsiz  bu Gemini bilan hikoyalar yaratish uchun vizual ish maydoningiz.","dialog.welcome.intro2":"Boshlash uchun tilingizni tanlang va Gemini API kalitingizni kiriting.","dialog.welcome.apiKeyExplanation":"Sizning API kalitingiz brauzeringizda lokal saqlanadi. Biz uni Google Gemini API dan boshqa hech qanday serverga yubormaymiz."},tb={"toolbar.edit":"Tahrirlash (V)","toolbar.cutter":"Ulanishni Kesish (C)","toolbar.selection":"Tanlash (S)","toolbar.reroute":"Yonalish nuqtasi (R)","toolbar.zoom":"Mashtab (Z)","toolbar.snapToGrid":"Torga yopishtirish (Shift+W)","toolbar.resetZoom":"Mashtabni tiklash","toolbar.lineStyleSpaghetti":"Spaghetti chiziqlar (Shift+E)","toolbar.lineStyleOrthogonal":"Togri burchakli chiziqlar (Shift+E)","toolbar.addNode":"Tugun qoshish (F)","toolbar.catalog":"Katalog (Ctrl+Space)","toolbar.settings":"Sozlamalar","toolbar.resetToDefault":"Asl holatga qaytarish","toolbar.closeProject":"Loyihani yopish / Tozalash","toolbar.enterFullscreen":"Toliq Ekran","toolbar.exitFullscreen":"Toliq Ekrandan Chiqish","toolbar.home":"Bosh sahifa","toolbar.addTextInput":"Matn kiritish (T)","toolbar.addPromptAnalyzer":"Prompt Tahlilchisi (A)","toolbar.addCharacterAnalyzer":"Personaj Tahlilchisi","toolbar.addCharacterGenerator":"Personaj Generatori (Shift+C)","toolbar.addImageGenerator":"Rasm Generatori (O)","toolbar.addImagePreview":"Rasmni Korish (I)","toolbar.addCharacterCard":"Personaj Kartasi (Ctrl+Shift+C)","toolbar.addPromptProcessor":"Prompt Protsessori (P)","toolbar.addGeminiChat":"Gemini Chat (G)","toolbar.addTranslator":"Tarjimon (L)","toolbar.addIdeaGenerator":"Goya Generatori (Shift+A)","toolbar.addScriptGenerator":"Ssenariy Generatori (Shift+S)","toolbar.addScriptAnalyzer":"Ssenariy Tahlilchisi (Shift+D)","toolbar.addScriptPromptModifier":"Prompt Finalizatori (Shift+F)","toolbar.addErrorAnalyzer":"Xatolar Tahlilchisi","toolbar.addNote":"Eslatma (N)","toolbar.addDataReader":"Malumot Oquvchi (Shift+R)","toolbar.addSpeechSynthesizer":"Nutq Sintezatori (Shift+N)","toolbar.addNarratorTextGenerator":"Hikoyachi Matni Generatori (Shift+G)","toolbar.addAudioTranscriber":"Audio Transkriber (Shift+B)","toolbar.addYouTubeTitleGenerator":"YouTube Sarlavha Generatori (Shift+T)","toolbar.addMusicIdeaGenerator":"Musiqa Goyasi Generatori (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube Analitika (Shift+Y)","toolbar.saveCanvas":"Kanvasni Saqlash (Ctrl+S)","toolbar.saveProject":"Loyihani Saqlash (Ctrl+Shift+S)","toolbar.loadCanvas":"Yuklash (Ctrl+O)","toolbar.clearCanvas":"Kanvasni Tozalash","toolbar.group.general":"Umumiy","toolbar.group.scripting":"Ssenariy","toolbar.group.prompting":"Prompt va Tahlil","toolbar.group.characters":"Personajlar","toolbar.group.ai":"AI Vositalari","toolbar.group.file":"Fayl","toolbar.group.images":"Rasmlar","toolbar.group.audio":"Audio","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"Kanvas Boshqaruvi","toolbar.expand":"Panelni yoyish","toolbar.collapse":"Panelni yigish","toolbar.toggleHeaders":"Sarlavhalarni almashtirish","hotkeys.file.title":"Fayl","hotkeys.file.save":"Saqlash (Ctrl+S)","hotkeys.file.saveProject":"Loyihani Saqlash (Ctrl+Shift+S)","hotkeys.file.load":"Yuklash (Ctrl+O)","hotkeys.tools.title":"Asboblar","hotkeys.tools.edit":"Tahrirlash","hotkeys.tools.cutter":"Kesuvchi","hotkeys.tools.selection":"Tanlash","hotkeys.tools.reroute":"Yonalish nuqtasi","hotkeys.tools.zoom":"Mashtab","hotkeys.tools.group":"Guruhlash (G)","hotkeys.tools.deleteGroup":"Guruhni ochirish","hotkeys.tools.closeNode":"Tugunni yopish","hotkeys.tools.toggleLineStyle":"Chiziq uslubini ozgartirish","hotkeys.tools.snapToGrid":"Torga yopishtirish","hotkeys.tools.selectAll":"Hammasini tanlash","hotkeys.tools.deselectAll":"Tanlovni bekor qilish","hotkeys.tools.duplicate":"Nusxalash (tarkibi bilan)","hotkeys.windows.title":"Oynalar","hotkeys.windows.search":"Qidiruv (F)","hotkeys.windows.quickAdd":"Tezkor qo'shish (Space)","hotkeys.windows.catalog":"Katalog","hotkeys.createNode.title":"Tugun yaratish","hotkeys.hide":"Tugmalarni yashirish","help.title":"Tugmalar birikmasi","hotkeys.show":"Tugmalarni korsatish","search.placeholder":"Tugunni qidirish...","search.noResults":"Tugunlar topilmadi.","search.node.text_input.title":"Matn Kiritish","search.node.text_input.description":"Goyalaringiz uchun oddiy matn maydoni. (T)","search.node.prompt_processor.title":"Prompt Protsessori","search.node.prompt_processor.description":"AI yordamida promptlarni birlashtiradi va yaxshilaydi. (P)","search.node.prompt_analyzer.title":"Prompt Tahlilchisi","search.node.prompt_analyzer.description":"Promptni personaj va muhitga ajratadi. (A)","search.node.character_analyzer.title":"Personaj Tahlilchisi","search.node.character_analyzer.description":"Tavsifni personaj va kiyimga ajratadi.","search.node.character_generator.title":"Personaj Generatori","search.node.character_generator.description":"Goyadan batafsil personajlar yaratadi. (Shift+C)","search.node.image_generator.title":"Rasm Generatori","search.node.image_generator.description":"Matndan rasm yaratadi. (O)","search.node.image_preview.title":"Rasmni Korish","search.node.image_preview.description":"Fayldan rasmni korsatadi. (I)","search.node.character_card.title":"Personaj Kartasi","search.node.character_card.description":"Personaj rasmi, nomi va promptini saqlaydi. (Ctrl+Shift+C)","search.node.gemini_chat.title":"Gemini Chat","search.node.gemini_chat.description":"Gemini AI bilan togridan-togri suhbat. (G)","search.node.translator.title":"Tarjimon","search.node.translator.description":"Matnni tanlangan tilga tarjima qiladi. (L)","search.node.script_generator.title":"Ssenariy Generatori","search.node.script_generator.description":"Hikoya goyasini ssenariy sahnalariga aylantiradi. (Shift+S)","search.node.script_analyzer.title":"Ssenariy Tahlilchisi","search.node.script_analyzer.description":"Ssenariyni kadrlar va rasm promptlariga ajratadi. (Shift+D)","search.node.script_prompt_modifier.title":"Prompt Finalizatori","search.node.script_prompt_modifier.description":"Tahlil qilingan malumotlardan yakuniy promptlarni yaratadi. (Shift+F)","search.node.error_analyzer.title":"Xatolar Tahlilchisi","search.node.error_analyzer.description":"Matndagi imlo va grammatik xatolarni tekshiradi.","search.node.note.title":"Eslatma","search.node.note.description":"Eslatmalar uchun oddiy matn maydoni. (N)","search.node.reroute_dot.title":"Yonalish nuqtasi","search.node.reroute_dot.description":"Ulanishlarni qayta yonaltirish va tarmoqlash uchun nuqta.","search.node.data_reader.title":"Malumot Oquvchi","search.node.data_reader.description":"Ulanishdan kelayotgan xom malumotlarni korsatadi.","search.node.speech_synthesizer.title":"Nutq Sintezatori","search.node.speech_synthesizer.description":"Matnni nutqqa aylantiradi. (Shift+N)","search.node.idea_generator.title":"Goya Generatori","search.node.idea_generator.description":"Goyalar generatori.","search.node.narrator_text_generator.title":"Hikoyachi Matni Generatori","search.node.narrator_text_generator.description":"Hikoyachi yoki diktor uchun matn yaratadi. (Shift+G)","search.node.audio_transcriber.title":"Audio Transkriber","search.node.audio_transcriber.description":"Audio/video fayllarni matnga aylantiradi. (Shift+B)","search.node.youtube_title_generator.title":"YouTube Sarlavha Generatori","search.node.youtube_title_generator.description":"YouTube videolari uchun sarlavha, tavsif va teglarni yaratadi.","search.node.music_idea_generator.title":"Musiqa Goyasi Generatori","search.node.music_idea_generator.description":"Qoshiq matni yoki musiqa promptini yaratadi. (Shift+M)","search.node.youtube_analytics":"YouTube Analitika","search.node.image_editor.title":"Rasm Tahrirchisi","search.node.image_editor.description":"AI yordamida rasmlarni tahrirlash (Inpainting, Outpainting).","search.group.input":"Kiritish","search.group.process":"Qayta ishlash","search.group.scripting":"Ssenariy Asboblari","search.group.character":"Personaj Asboblari","search.group.images":"Rasm Asboblari","search.group.ai":"AI Asboblari","search.group.audio":"Audio Asboblari","search.group.youtube":"YouTube Asboblari","contextMenu.tools":"Asboblar","contextMenu.assignSlot":"{index}-slotni tayinlash","contextMenu.addNodeFromSlot":"{node} qoshish ({index})","connectionMenu.title":"Tugun qoshish","quickAddMenu.title":"Tezkor qoshish","contextMenu.paste":"Joylashtirish (Ctrl+V)","node.content.simpleActions":"Oddiy harakatlar","node.content.smartConcept":"Aqlli Konsept","tooltip.model.flash":"Gemini Flash: Tez, samarali, qoralamalar uchun.","tooltip.model.pro":"Gemini Pro: Yuqori intellekt, murakkab fikrlash, batafsil.","tooltip.lang.ru":"Ssenariyni rus tilida yaratish.","tooltip.lang.en":"Ssenariyni ingliz tilida yaratish.","tooltip.lang.es":"Ssenariyni ispan tilida yaratish.","tooltip.lang.de":"Ssenariyni nemis tilida yaratish.","tooltip.lang.uz":"Ssenariyni ozbek tilida yaratish.","tooltip.lang.fr":"Ssenariyni fransuz tilida yaratish.","tooltip.lang.it":"Ssenariyni italyan tilida yaratish.","tooltip.lang.pt":"Ssenariyni portugal tilida yaratish.","tooltip.lang.zh":"Ssenariyni xitoy tilida yaratish.","node.action.locateInStack":"Stekda topish","help.tabs.hotkeys":"Yordam va Tugmalar","help.tabs.links":"Boshqa Ilovalar va Havolalar","help.category.socials":"Ijtimoiy Tarmoqlar","help.category.stable":"Google AI Studio (Barqaror)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":"Veb / Netlify","help.category.github":"GitHub Repozitoriylari","help.link.youtube":"YouTube Kanal","help.link.telegram_channel":"Telegram Kanal","help.link.telegram_chat":"Telegram Chat","help.sub.news":"Yangiliklar va Yangilanishlar","help.sub.discussion":"Muhokama","help.sub.stable":"Barqaror Versiya","help.sub.alpha":"Alpha Versiya","imageViewer.title":"Rasmni Korish","languages.ru":"Ruscha","languages.en":"Inglizcha","languages.es":"Ispancha","languages.fr":"Fransuzcha","languages.de":"Nemischa","languages.it":"Italyancha","languages.pt":"Portugalcha","languages.zh":"Xitoycha","languages.ja":"Yaponcha","languages.ko":"Koreyscha","languages.uz":"Ozbekcha"},nb={"node.title.text_input":"Matn Kiritish","node.title.prompt_processor":"Prompt Protsessori","node.title.prompt_analyzer":"Prompt Tahlilchisi","node.title.character_analyzer":"Personaj Tahlilchisi","node.title.character_generator":"Personaj Generatori","node.title.image_generator":"Rasm Generatori","node.title.image_preview":"Rasmni Korish","node.title.character_card":"Personaj Kartasi","node.title.gemini_chat":"Gemini Chat","node.title.translator":"Tarjimon","node.title.script_generator":"Ssenariy Generatori","node.title.script_analyzer":"Ssenariy Tahlilchisi","node.title.script_prompt_modifier":"Prompt Finalizatori","node.title.error_analyzer":"Xatolar Tahlilchisi","node.title.note":"Eslatma","node.title.reroute_dot":"Yonalish nuqtasi","node.title.data_reader":"Malumot Oquvchi","node.title.speech_synthesizer":"Nutq Sintezatori","node.title.idea_generator":"Goya Generatori","node.title.narrator_text_generator":"Hikoyachi Matni Generatori","node.title.audio_transcriber":"Audio Transkriber","node.title.youtube_title_generator":"YouTube Sarlavha Generatori","node.title.music_idea_generator":"Musiqa Goyasi Generatori","node.title.youtube_analytics":"YouTube Analitika","node.title.image_editor":"Rasm Tahrirchisi","node.help.text_input":"Bu yerga asosiy goyalar, kalit sozlar yoki tavsiflarni kiriting.","node.help.prompt_processor":"Boshqa tugunlardan matn oladi va ularni AI yordamida bitta batafsil promptga aylantiradi.","node.help.prompt_analyzer":"Kiruvchi matnni tahlil qiladi va uni tort qismga ajratadi: muhit, personaj, harakat va uslub.","node.help.character_analyzer":"Personaj tavsifini tahlil qiladi va uni tashqi korinish hamda kiyimga ajratadi.","node.help.character_generator":"Prompt oladi va bir yoki bir nechta batafsil personaj tavsiflarini yaratadi.","node.help.image_generator":"Matnli prompt asosida Gemini API yordamida rasm yaratadi.","node.help.image_preview":"Rasmni korsatish uchun oddiy tugun. Rasm faylini sudrab tashlang.","node.help.character_card":"Personaj rasmi, nomi va promptini saqlaydi. Rasmlarni yaratish, saqlash va yuklash imkonini beradi.","node.help.gemini_chat":"Gemini AI bilan togridan-togri suhbatlashish uchun tugun.","node.help.translator":"Kiruvchi matnni tanlangan tilga tarjima qiladi.","node.help.script_generator":"Prompt oladi va ssenariy uchun sahnalar seriyasini yaratadi.","node.help.script_analyzer":"Ssenariy tuzilishini tahlil qiladi, uni personajlar va kadrlarga ajratadi.","node.help.script_prompt_modifier":"Tahlil qilingan ssenariy malumotlarini oladi va rasm yaratish uchun yakuniy promptlarni shakllantiradi.","node.help.error_analyzer":"Matndagi imlo va grammatik xatolarni tekshiradi va tuzatadi.","node.help.note":"Eslatmalar uchun oddiy matn maydoni. Boshqa tugunlarga ulanmaydi.","node.help.reroute_dot":"Ulanishlarni qayta yonaltirish va tarmoqlash uchun nuqta.","node.help.data_reader":"Ulangan tugundan kelayotgan xom malumotlarni korsatadi.","node.help.speech_synthesizer":"Matnni tanlangan ovoz yordamida nutqqa aylantiradi.","node.help.idea_generator":"Goyalarni yaratish uchun ikki bosqichli tugun (Kategoriyalar va Goya).","node.help.narrator_text_generator":"Hikoyachi yoki diktor uchun matn yaratadi.","node.help.audio_transcriber":"Audio yoki video faylni yuklaydi va uni matnga aylantiradi.","node.help.youtube_title_generator":"YouTube videolari uchun sarlavha, tavsif va teglarni yaratadi.","node.help.music_idea_generator":"Qoshiq matni yoki musiqa promptini yaratadi.","node.help.youtube_analytics":"YouTube kanali statistikasini kuzatadi va AI maslahatlarini beradi.","node.help.image_editor":"AI yordamida rasmlarni tahrirlang (Inpainting, Outpainting).","node.action.help":"Yordam","node.action.rename":"Nomini ozgartirish","node.action.expand":"Yoyish","node.action.collapse":"Yigish (H)","node.action.expandAll":"Hammasini yoyish","node.action.collapseAll":"Hammasini yigish","node.action.expandAllScenes":"Barcha sahnalarni yoyish","node.action.collapseAllScenes":"Barcha sahnalarni yigish","node.action.expandAllFrames":"Barcha kadrlarni yoyish","node.action.collapseAllFrames":"Barcha kadrlarni yigish","node.action.expandPanel":"Panelni yoyish","node.action.collapsePanel":"Panelni yigish","node.action.togglePanel":"Panelni ochish/yopish","node.action.collapseScene":"Sahnani yigish","node.action.expandScene":"Sahnani yoyish","node.action.collapseFrame":"Kadrni yigish","node.action.expandFrame":"Kadrni yoyish","node.action.collapseCharacter":"Personajni yigish","node.action.expandCharacter":"Personajni yoyish","node.action.clear":"Tozalash","node.action.clearTooltip":"Kiritish maydonini tozalash.","node.action.clearChat":"Chatni tozalash","node.action.paste":"Buferdan joylashtirish","node.action.copy":"Nusxalash","node.action.duplicateWithContent":"Nusxalash (tarkibi bilan)","node.action.duplicateEmpty":"Bosh nusxa olish","node.action.cutConnections":"Ulanishlarni uzish","node.action.close":"Yopish","node.action.executeChain":"Zanjirni ishga tushirish","node.action.executeFullChain":"Toliq zanjirni bajarish","node.action.processChainForward":"Zanjirni oldinga ishlash","node.action.executeChainTitle":"Ushbu chiqishga olib keladigan barcha ulangan tugunlarni bajarish.","node.action.addCharacter":"Personaj qoshish","node.action.addScene":"Sahna qoshish","node.action.addFrame":"Kadr qoshish","node.action.addFirstFrame":"Birinchi kadrni qoshish","node.action.deleteItem":"ochirish","node.action.moveUp":"Yuqoriga","node.action.moveDown":"Pastga","node.action.saveImage":"Rasmni saqlash","node.action.loadImage":"Rasmni yuklash","node.action.saveCharacter":"Personajni saqlash","node.action.loadCharacter":"Personajni yuklash","node.action.readData":"Malumotni oqish","node.action.refreshData":"Yangilash","node.action.stop":"Toxtatish","node.action.stopping":"Toxtatilmoqda...","node.action.embedCharacter":"Personajni singdirish (ajratish va nusxalash)","node.action.downloadFinalPrompts":"Yakuniy promptlarni yuklab olish","node.action.index":"Indekslash","node.action.improveConcept":"Konsepsiyani yaxshilash","node.action.improveConceptTooltip":"Rasmlarni yaratish uchun boyitish, kengaytirish va vizual tafsilotlarni qo'shish.","node.action.downloadJson":"JSON yuklab olish","node.action.downloadSRT":"SRT yuklab olish","node.action.markPrimary":"Asosiy Personaj sifatida belgilash","node.input.default":"Kirish","node.output.default":"Chiqish","node.output.allCharacters":"Barcha Personajlar","node.output.primaryCharacter":"Asosiy Personaj","node.content.action":"Harakat","node.content.actionPlaceholder":"Harakat prompti...","node.content.allScriptParts":"Barcha ssenariy qismlari","node.content.allScriptAnalyzerData":"Tahlilchi malumotlari","node.content.allNarratorData":"Barcha hikoyachi malumotlari","node.content.analyzeCharacters":"Personajlarni tahlil qilish","node.content.analyzeFromScene":"Sahnadan tahlil qilish:","node.content.analyzeUpToScene":"gacha","node.content.endPlaceholder":"oxiri","node.content.generateFromFrame":"Kadrdan generatsiya:","node.content.generateUpToFrame":"kadrgacha","node.content.analyzeFromFrame":"Kadrdan finalizatsiya:","node.content.processFromFrame":"Kadrdan qayta ishlash:","node.content.processFromScene":"Sahnadan qayta ishlash:","node.content.analyzePrompt":"Promptni tahlil qilish","node.content.analyzeScript":"Ssenariyni tahlil qilish","node.content.analyzing":"Tahlil qilinmoqda...","node.content.applyAliases":"Taxalluslarni qollash","node.content.applyAliasesTooltip":"Barcha tavsiflarda personaj ismlarini ularning taxalluslari bilan almashtirish.","node.content.character":"Personaj","node.content.characterIndex":"Indeks","node.content.characterPlaceholder":"Personaj prompti...","node.content.character_plural":"personajlar","node.content.characters":"Personajlar","node.content.charactersSynced":"Personajlar sinxronlandi","node.content.noCharactersConnected":"Personajlar ulanmagan.","node.content.appearance":"Tashqi korinish","node.content.personality":"Shaxsiyat","node.content.characterType":"Tur","node.content.characterTypeShort":"Tur","node.content.characterType.simple":"Oddiy","node.content.characterType.anthro":"Antropomorfik (Hayvonlar)","node.content.characterType.chibi":"Chibi (Yoqimli)","node.content.characterType.key_item":"Asosiy buyum/obyekt","node.content.style":"Uslub","node.content.style.none":"Yoq","node.content.style.simple":"Oddiy","node.content.style.realistic":"Realistik/Kinematografik","node.content.style.3d_cartoon":"3D Multfilm","node.content.style.3d_realistic":"Realistik 3D","node.content.style.2d_animation":"2D Animatsiya","node.content.style.anime":"Anime","node.content.style.comics":"Komiks","node.content.style.custom":"Maxsus","node.content.chatPlaceholder":"Xabar yozing...","node.content.clothing":"Kiyim","node.content.clothingPlaceholder":"Kiyim prompti...","node.content.connectedPlaceholder":"Boshqa tugundan ulangan","node.content.dataPlaceholder":"Malumotlar bu yerda paydo boladi...","node.content.readData":"Malumotni oqish","node.content.reading":"Oqilmoqda...","node.content.description":"Tavsif","node.content.sceneDescription":"Sahna Tavsifi","node.content.duration":"Davomiylik","node.content.enhancePrompt":"Prompt yaratish","node.content.enhancedPromptHere":"Yaxshilangan prompt bu yerda paydo boladi...","node.content.enhancing":"Yaxshilanmoqda...","node.content.environment":"Muhit","node.content.environmentPlaceholder":"Muhit prompti...","node.content.environmentPrompt":"Muhit, Dekoratsiya va Fon","node.content.compositionAndBlocking":"Kompozitsiya va Harakat","node.content.executingChain":"Zanjir bajarilmoqda...","node.content.imagePrompt":"Rasm Prompti","node.content.finalPrompt":"Yakuniy Prompt","node.content.finalPrompt_plural":"Yakuniy Promptlar","node.content.fixErrors":"Xatolarni tuzatish","node.content.fixingErrors":"Tuzatilmoqda...","node.content.frame":"Kadr","node.content.frame_plural":"kadrlar","node.content.frames":"Chiqish Kadrlari","node.content.frames_analyzed":"Tahlil qilingan kadrlar: {count}","node.content.framesPerScene":"Sahna uchun kadrlar","node.content.minFrames":"Min","node.content.maxFrames":"Maks","node.content.numberOfCharactersShort":"Soni","node.content.fullDescription":"Toliq Tavsif","node.content.generateCharacters":"Personajlarni yaratish","node.content.generateFinalPrompts":"Yakuniy promptlarni yaratish","node.content.generatingProgress":"Prompt generatsiyasi {current} / {total}","node.content.generateImage":"Rasm yaratish","node.content.generateScript":"Ssenariy yaratish","node.content.generateSpeech":"Nutq yaratish","node.content.generateText":"Matn yaratish","node.content.generateSSML":"SSML yaratish","node.content.generateStyle":"Uslub yaratish","node.content.generating":"Yaratilmoqda...","node.content.improving":"Yaxshilanmoqda...","node.content.generatedAudio":"Yaratilgan audio","node.content.imagePromptPlaceholder":"Rasm uchun prompt kiriting...","node.content.modificationPromptPlaceholder":"Ozgartirish uchun sorov...","node.content.narrator":"Hikoyachi","node.content.narratorEnabled":"Hikoyachini yoqish","node.content.narratorEnabledInfo":"Sahna yoki ichki fikrlarni tasvirlash uchun ovozli matn qoshadi.","node.content.narratorMode":"Hikoyachi Rejimi","node.content.narratorMode.normal":"Normal / Ovozli","node.content.narratorMode.dual":"Ikki Hikoyachi","node.content.narratorMode.first_person":"Birinchi shaxsdan","node.content.role":"Rol","node.content.role.narrator":"Hikoyachi","node.content.role.announcer":"Diktor","node.content.role.first_person":"Birinchi shaxs","node.content.role.dual_narrator":"Ikki Hikoyachi","node.content.role.dual_announcer":"Ikki Diktor","node.content.scene":"Sahna","node.content.scene_plural":"sahnalar","node.content.scenes":"Sahnalar","node.content.scenes_generated":"Sahnalar yaratildi: {count}","node.content.sceneContext":"Sahna Konteksti","node.content.sceneContextPlaceholder":"Umumiy joylashuv, yoritish, kayfiyat...","node.content.scriptPromptPlaceholder":"Hikoya goyasini kiriting...","node.content.seconds":"sek","node.content.stylePlaceholder":"Uslub prompti...","node.content.stylePromptPlaceholder":"Uslub promptini bu yerga kiriting...","node.content.styleOverride":"Uslubni ozgartirish (Override)","node.content.summary":"Xulosa","node.content.targetLanguage":"Maqsadli til","node.content.textToSynthesize":"Sintez uchun matn...","node.content.translate":"Tarjima qilish","node.content.translatePlaceholder":"Tarjima uchun matn...","node.content.translatedTextPlaceholder":"Tarjima qilingan matn bu yerda paydo boladi...","node.content.translating":"Tarjima qilinmoqda...","node.content.useExistingCharacters":"Mavjud personajlardan foydalanish","node.content.useExistingCharactersInfo":"Model noldan yaratish orniga ulangan personaj malumotlaridan foydalanadi.","node.content.createKeyItem":"Ikkinchi darajali va buyumlar","node.content.createSecondaryChars":"Ikkinchi darajali personajlar","node.content.createKeyItems":"Asosiy buyumlar","node.content.createKeyItemInfo":"Agar syujet talab qilsa, ikkinchi darajali personajlar yoki buyumlar yaratishga ruxsat beradi. Agar ochirilgan bolsa, faqat asosiy (kiruvchi) personajlar ishlatiladi.","node.content.noCharacters":"Personajlarsiz","node.content.noCharactersInfo":"Ssenariy voqealar va atmosferaga qaratilgan boladi (hujjatli uslub).","node.content.videoPrompt":"Dinamika va Harakat","node.content.videoPrompts":"Video Promptlar","node.content.voice":"Ovoz","node.action.previewVoice":"Ovozni tinglash","node.content.voicePreviewText":"Salom, bu ovoz namunasi.","node.content.inputScripts":"Kiruvchi Sahnalar","node.content.inputFrames":"Kiruvchi Kadrlar","node.content.outputScript":"Chiquvchi Sahnalar","node.content.requestCategories":"Kategoriyalarni sorash","node.content.generateIdea":"Goya yaratish","node.content.requestNewCategories":"Yangi kategoriyalar sorash","node.content.category.action":"Harakat","node.content.category.place":"Joy","node.content.category.obstacle":"Tosiq","node.content.generatedIdea":"Yaratilgan Goya","node.content.storyFormat":"Hikoya Formati","node.content.theme":"Mavzu","node.content.parameters":"Parametrlar","node.content.advancedMode":"Kengaytirilgan rejim","node.content.numberOfScenes":"Sahnalar soni","node.content.numberOfScenes.auto":"Avto","node.content.detailedPlot":"Batafsil syujet","node.content.detailedPlotInfo":"Harakatlar va syujet burilishlarining batafsil tavsifini yoqadi.","node.content.includeSubscribeScene":"Obuna bolish sahnasi","node.content.includeSubscribeSceneInfo":"Obuna bolish yoki layk bosishni sorovchi sahnani qoshadi.","node.content.genre":"Janr","node.content.genre2":"Janr 2","node.content.breakIntoParagraphs":"Abzaslarga bolish","node.content.copyVideoPrompt":"Video promptni nusxalash","node.content.generateVideoPrompt":"Video prompt yaratish","node.content.model":"Model","node.content.processWholeScene":"Toliq sahnani ishlash","node.content.processWholeSceneInfo":"Sahnaning barcha kadrlarini bir vaqtda qayta ishlaydi. Izchillikni oshiradi.","node.content.batchProcessing":"Paket qayta ishlash","node.content.batchProcessingInfo":"Barcha tanlangan sahnalarni bitta kontekst oynasida qayta ishlash.","node.content.extendedAnalysis":"Kengaytirilgan tahlil","node.content.extendedAnalysisInfo":"Sahnalarni batafsil rejalarga (umumiy, orta, yaqin) ajratadi.","node.content.professionalStoryboard":"Rejissyorlik Raskadrovkasi","node.content.professionalStoryboardInfo":"Sahnalarni kinotil qoidalari asosida tahlil qilish.","node.content.generateStartEndFrames":"Boshlangich va yakuniy kadrlarni yaratish","node.content.autoIndexCharacters":"Avto-indekslash","node.content.autoIndexCharactersInfo":"Tahlil natijalarida personaj ismlarini avtomatik ravishda taxalluslar bilan almashtiradi.","node.content.imageToText":"Rasmdan matnga","node.content.extracting":"Ajratib olinmoqda...","node.content.extractedText":"Ajratib olingan matn","node.content.activePromptStack":"Faol Prompt Steki","node.content.noCharactersAnalyzed":"Tahlil qilingan personajlar yoq.","node.content.promptsGeneratedPlaceholder":"Yaratilgan promptlar bu yerda paydo boladi.","node.content.noCharactersInScript":"Ssenariyda personajlar yoq.","node.content.noInputScenes":"Kiruvchi malumot yoq. Ssenariy Generatorini ulang.","node.content.status":"Holat","node.content.status.ready":"Tayyor","node.content.status.paused":"Toxtatildi","node.content.status.generating":"Generatsiya","node.content.status.total":"Jami: {generated} / {total}","node.content.status.batch":"Ishlanmoqda: {current} / {total}","node.content.status.time":"Vaqt: {current}s / {total}s","node.content.refreshing":"Yangilanmoqda...","node.content.totalFrames":"Jami kadrlar: {count}","node.content.uploadAudio":"Audio/Video yuklash","node.content.noAudioLoaded":"Audio yuklanmagan","node.content.audioLoaded":"Audio yuklandi","node.content.transcriptionPlaceholder":"Transkripsiya bu yerda paydo boladi...","node.content.transcribe":"Transkripsiya","node.content.transcribing":"Transkripsiya qilinmoqda...","node.content.convertingVideo":"Video konvertatsiya qilinmoqda...","node.content.recommendedFrames":"Kadrlar Tavsiyasi","node.content.shotType":"Kadr turi","node.content.shotType.ws":"WS (Keng)","node.content.shotType.ms":"MS (Orta)","node.content.shotType.cu":"CU (Yaqin)","node.content.shotType.ecu":"ECU (Juda Yaqin)","node.content.shotType.ls":"LS (Uzoq)","node.content.characterDetail":"Personaj tafsilotlari","node.content.noCharDesc":"Personaj tavsifisiz","node.content.includeGeneralCharDesc":"Umumiy vizual tavsif","node.content.includeFullCharDesc":"Batafsil vizual tavsif","node.content.safeGeneration":"Xavfsiz Generatsiya","node.content.shotFilter":"Kadr Filtri","node.content.shotFilter.all":"Barcha kadrlar","node.content.shotFilter.wideOnly":"Faqat keng","instruction.desc.shot_filter_all":"Barcha kadr turlariga ruxsat (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Faqat keng kadrlarga ruxsat (WS, MS, LS). Yaqin kadrlar taqiqlanadi.","node.content.anthroEnabled":"Antropomorfik Hayvonlar","node.content.subscribeEnhancement":"Obuna chaqirig'ini kuchaytirish","node.content.thinkingEnabled":"Fikrlash Rejimi","node.content.scenelessMode":"Ssenariysiz sahnalar","instruction.desc.sceneless_mode":"Hikoya motorini o'chirish. Konsepsiya ro'yxatidan to'g'ridan-to'g'ri sahnalarni yaratish.","instruction.sceneless_mode":"Sahnalar Ro'yxati Rejimi","node.content.microActionBreakdown":"Mikro-harakatlar","node.content.microActionBreakdownInfo":"Murakkab harakatlarni fazolarga ajratadi (Tayyorgarlik, Harakat, Reaksiya).","node.content.commercialSafe":"Tijorat uchun xavfsiz","instruction.desc.commercial_safe":"Mashhur savdo belgilari (Disney, Pixar) dan qat'iy qochadi va ularni umumiy tavsiflar bilan almashtiradi.","node.content.findStack":"Stekni topish...","node.content.spm_stack.priming":"1. Prayming va Kontekst","node.content.spm_stack.physics":"2. Fizika va Mantiq","node.content.spm_stack.hierarchy":"3. Subyekt Ierarxiyasi","node.content.spm_stack.construction":"4. Qurilish va Format"},ob={"genre.general":"Umumiy","genre.comedy":"Komediya","genre.drama":"Drama","genre.action":"Jangari","genre.scifi":"Ilmiy fantastika","genre.fantasy":"Fantastika","genre.horror":"Qorqinchli","genre.thriller":"Triller","genre.childrens_animation":"Bolalar uchun animatsiya","genre.shorts_story":"Shorts uchun qisqa hikoyalar","genre.scientific_historical":"Ilmiy-tarixiy hikoya","character_generator.promptPlaceholder":'Personajlar uchun goya kiriting, masalan: "qadimgi ormon qoriqchisi, sehrli qilichni himoya qiluvchi jasur ritsar"',"idea_generator.randomTheme":"Tasodifiy mavzu olish","idea_generator.randomCombination":"Tasodifiy kombinatsiya","idea_generator.themePlaceholder":"masalan, Kosmos, Oshxona, Sehrli Ormon","idea_generator.initialMessage":'Mavzuni kiriting (ixtiyoriy) va boshlash uchun "{buttonName}" tugmasini bosing.',"idea_generator.ideaPlaceholder":"Yaratilgan goya bu yerda paydo boladi...","idea_generator.format.general":"Umumiy","idea_generator.format.childrens":"Bolalar","idea_generator.format.adventure":"Sarguzasht","idea_generator.format.fantasy":"Fantastika / Sehr","idea_generator.format.detective":"Detektiv","idea_generator.format.scifi":"Ilmiy Fantastika","idea_generator.format.horror":"Qorqinchli","idea_generator.format.historical":"Tarixiy","gender.male":"Erkak","gender.female":"Ayol","node.content.autoDownload":"Yaratilganda avtomatik yuklash","node.content.downloadSelected":"Tanlanganlarni yuklash","node.content.intonation":"Intonatsiya","intonation.standard":"Standart","intonation.cheerful":"Xursand","intonation.angry":"Gazabli","intonation.sad":"Gamgin","intonation.excited":"Hayajonlangan","intonation.announcer":"Diktor","intonation.whispering":"Shivirlab","node.content.sceneMode":"Sahna Rejimi","node.content.connectNarratorData":'Ssenariy Generatoridan "Barcha hikoyachi malumotlari"ni ulang.',"node.content.sceneModeActive":"Sahna Rejimi faol. Malumotlar ulanishdan olinmoqda.","speech_synthesizer.mode.simple":"Oddiy","speech_synthesizer.mode.scene":"Sahnavor","speech_synthesizer.multiSpeaker":"Ikki Diktor","speech_synthesizer.speaker1Name":"Diktor 1 Ismi","speech_synthesizer.speaker2Name":"Diktor 2 Ismi","speech_synthesizer.multiSpeakerHint":'Diktor ismlari matndagi ismlarga mos kelishi kerak (masalan, "Erkak: ...", "Ayol: ...").',"speech_synthesizer.ssmlHint":"Intonatsiya matndagi SSML teglari orqali boshqariladi.","youtube_analytics.authorName":"Muallif Ismi","youtube_analytics.videoTitle":"Video Sarlavhasi","youtube_analytics.views":"Korishlar","youtube_analytics.addToChannel":"Kanalga qoshish","youtube_analytics.noIncomingData":"Kiruvchi malumot yoq.","youtube_analytics.videoAdded":"Video qoshildi!","youtube_analytics.dragDrop":"Qator skrinshotini bu yerga tashlang","youtube_analytics.thumbnailUpdated":"Eskiz yangilandi","youtube_analytics.statsTrend":"Statistika Trendlari","youtube_analytics.currentChannel":"Joriy Kanal","youtube_analytics.growth":"Osish","youtube_analytics.allChannels":"Barcha Kanallar","youtube_analytics.saveDisk":"Diskka saqlash","youtube_analytics.saveCatalog":"Katalogga saqlash","youtube_analytics.loadDisk":"Diskdan yuklash","youtube_analytics.analyzing":"Tahlil qilinmoqda...","youtube_analytics.askAI":"AIdan sorash","youtube_analytics.clickForAdvice":"Maslahat olish uchun bosing.","youtube_analytics.dailyNotes":"Kunlik Eslatmalar","youtube_analytics.logDailyStats":"Kunlik Statistika","youtube_analytics.subscribers":"Obunachilar","youtube_analytics.totalViews":"Jami Korishlar","youtube_analytics.updateStats":"Yangilash","youtube_analytics.history":"Tarix","youtube_analytics.noHistory":"Tarix hali yoq.","youtube_analytics.noNotes":"Eslatmalar yoq.","youtube_analytics.noVideos":"Videolar yoq.","youtube_analytics.loadedFromDisk":"Diskdan yuklandi","youtube_analytics.loadFailed":"Yuklashda xatolik","youtube_analytics.savedToDisk":"Diskka saqlandi","youtube_title_generator.mode.title":"Video Sarlavhasi","youtube_title_generator.mode.channel":"Kanal Info","youtube_title_generator.ideaPlaceholder":"Video goyasi yoki mavzusini kiriting...","youtube_title_generator.channelIdeaPlaceholder":"Kanal mavzusi yoki yonalishini kiriting...","youtube_title_generator.title":"Sarlavha","youtube_title_generator.description":"Tavsif","youtube_title_generator.tags":"Teglar","youtube_title_generator.channelName":"Kanal Nomi","youtube_title_generator.channelDescription":"Kanal Tavsifi","youtube_title_generator.channelKeywords":"Kalit sozlar","youtube_title_generator.channelHandle":"Handle (@)","music_idea_generator.mode.lyrics":"Qoshiq matni","music_idea_generator.mode.music_prompt":"Musiqa Prompti","music_idea_generator.ideaPlaceholder":"Qoshiq mavzusi yoki kayfiyatini kiriting...","music_idea_generator.songTitle":"Qoshiq Nomi","music_idea_generator.songTitlePlaceholder":"Nom...","music_idea_generator.lyricsPlaceholder":"Qoshiq matni bu yerda paydo boladi...","music_idea_generator.musicPromptPlaceholder":"AI musiqa prompti bu yerda paydo boladi...","chat.mode.general":"Umumiy","chat.mode.script":"Ssenariy Eksperti","chat.mode.prompt":"Prompt Eksperti","chat.mode.youtube":"YouTube Eksperti"},rb={"catalog.title":"Katalog","catalog.tabs.groups":"Guruhlar","catalog.tabs.library":"Prompt Kutubxonasi","catalog.tabs.characters":"Personajlar","catalog.tabs.scripts":"Ssenariylar","catalog.tabs.analysis":"Tahlil","catalog.tabs.final_prompts":"Yakuniy Promptlar","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"Musiqa G'oyalari","catalog.empty.title":"Katalog bosh","catalog.empty.description":"Elementni bu yerda korish uchun saqlang yoki fayldan import qiling.","catalog.loadFromFile":"Katalogga fayldan qoshish","catalog.card.addToCanvas":"Kanvasga qoshish","catalog.card.rename":"Nomini ozgartirish","catalog.card.save":"Diskka saqlash","catalog.card.delete":"Ochirish","library.loadFromFile":"Fayldan yuklash","library.empty.title":"Papka bosh","library.empty.description":"Boshlash uchun yangi papka yoki prompt yarating.","library.emptyPrompt":"Tarkib yoq","library.actions.newFolder":"Yangi Papka","library.actions.newPrompt":"Yangi Prompt","library.actions.copy":"Buferga nusxalash","library.actions.edit":"Tahrirlash","group.rename":"Guruh nomini ozgartirish","group.saveToCatalog":"Katalogga saqlash","group.saveToDisk":"Diskka saqlash","group.ungroup":"Guruhni buzish (Tarkibni ochirish uchun Shift+Bosish)","group.button.create":"Guruhlash ({count})"},ab={"dialog.rename.title":"Nomni ozgartirish","dialog.rename.group.title":"Guruh nomini ozgartirish","dialog.rename.catalog.title":"Katalog elementini qayta nomlash","dialog.rename.label":"Yangi nom","dialog.rename.confirm":"Ozgartirish","dialog.rename.cancel":"Bekor qilish","dialog.promptEdit.title":"Promptni Tahrirlash","dialog.promptEdit.nameLabel":"Prompt Nomi","dialog.promptEdit.contentLabel":"Tarkib","dialog.promptEdit.confirm":"Saqlash","dialog.promptEdit.cancel":"Bekor qilish","dialog.reset.title":"Kanvasni tiklash","dialog.reset.message":"Kanvasni asl holatiga qaytarishni xohlaysizmi? Bu barcha joriy ishlarni ochirib yuboradi.","dialog.exit.title":"Loyihani yopish?","dialog.exit.message":"Ishonchingiz komilmi? Saqlanmagan malumotlar yoqoladi va siz xush kelibsiz ekraniga qaytasiz.","dialog.settings.title":"Sozlamalar","dialog.settings.apiKeyLabel":"Gemini API Kaliti","dialog.settings.apiKeyPlaceholder":"API kalitingizni bu yerga kiriting","dialog.settings.getApiKeyLink":"Google AI Studio dan API kalit olish","dialog.settings.useFreeKey":"Bepul (cheklangan) kalitdan foydalanish","dialog.settings.save":"Saqlash","dialog.settings.close":"Yopish","dialog.apiKey.title":"API Kalit Sozlamalari","dialog.apiKey.description":"Ilovadan foydalanish uchun Gemini API kaliti kerak. Iltimos, quyida kiriting. U brauzeringizda lokal saqlanadi.","dialog.apiKey.keyExists":"API kalit allaqachon brauzerda saqlangan.","dialog.apiKey.clear":"Kalitni tozalash","dialog.apiKey.save":"Kalitni saqlash","dialog.apiKey.update":"Kalitni yangilash","dialog.apiKey.useFreeKey":"Bepul kalitdan foydalanish (ishlab chiqish uchun)","dialog.permission.title":"Buferga kirish ruxsati","dialog.permission.description":'Ilova tugunlarda "Joylashtirish" funksiyasi ishlashi uchun buferga kirishni soramoqda. Biz faqat siz ushbu funksiyani ishlatganingizda buferni oqiymiz.',"dialog.permission.decline":"Rad etish","dialog.permission.allow":"Ruxsat berish","alert.groupSaved":'"{groupTitle}" guruhi katalogga saqlandi!',"toast.groupSavedToDisk":'"{groupTitle}" guruhi diskka saqlandi!',"alert.confirmDelete":"Ushbu elementni katalogdan ochirishni xohlaysizmi?","alert.invalidCatalogFile":"Notogri yoki buzilgan katalog fayli.","alert.loadCatalogFailed":"Katalog elementini yuklab bolmadi","alert.confirmLoadProject":"Loyiha yuklansa, barcha joriy malumotlar (tablar, katalog, sozlamalar) almashtiriladi. Ishonchingiz komilmi?","dialog.confirmDelete.title":"Ochirishni tasdiqlash","dialog.confirmDelete.message":'Haqiqatan ham "{itemName}" ni ochirmoqchimisiz? Bu amalni bekor qilib bolmaydi.',"dialog.confirmDelete.folderMessage":'Haqiqatan ham "{itemName}" papkasini va uning barcha tarkibini ochirmoqchimisiz? Bu amalni bekor qilib bolmaydi.',"dialog.confirmDelete.confirm":"Ochirish","dialog.confirmDelete.cancel":"Bekor qilish","dialog.confirmClear.title":"Kanvasni tozalashni tasdiqlash","dialog.confirmClear.message":"Kanvasdagi hamma narsani ochirishni xohlaysizmi? Bu amalni bekor qilib bolmaydi.","toast.copied":"Buferga nusxalandi","toast.pasted":"Joylashtirildi!","toast.cleared":"Tozalandi","toast.resetComplete":"Asl holatga qaytarildi","toast.projectSaved":"Loyiha diskka saqlandi","toast.canvasSaved":"Kanvas diskka saqlandi","toast.saveFailed":"Loyihani saqlab bolmadi","toast.connectionsCut":"Ulanishlar uzildi","toast.charSaved":"Personaj diskka saqlandi","toast.charLoaded":"Personaj yuklandi","toast.videoPasted":"Video buferdan qoshildi","toast.savedToCatalog":"Katalogga saqlandi","toast.apiKeySaved":"API kalit muvaffaqiyatli saqlandi","toast.apiKeyCleared":"API kalit ochirildi","toast.projectLoaded":"Loyiha muvaffaqiyatli yuklandi","alert.batchMismatch":"Ogohlantirish: {scene}-sahna kadrlar sonida nomuvofiqlik (Kutilgan: {expected}, Olingan: {got})."},ib={"instruction.inputs":"Kirishlar","instruction.desc.inputs":"Manba malumotlari: Ssenariy kadrlari, Personaj vizuallari, Uslub tarifi.","instruction.inputs_data":"Kirishlar","instruction.desc.inputs_data":"Manba malumotlari: Ssenariy xulosasi, Personaj profillari, Sahna matnlari.","instruction.role":"Rol: Bosh Muhit Rassomi","instruction.desc.role":"Siz ekspert Bosh Muhit Rassomi va Prompt Muhandisisiz. Kirish malumotlarini aniq vizual tavsifga aylantiring.","instruction.no_names":"MUHIM: ISMLAR YOQ","instruction.desc.no_names":"MUHIM: Yakuniy promptda HECH QACHON personaj ismlarini ishlatmang. FAQAT vizual tavsiflar yoki Taxallus IDlaridan (Character-1) foydalaning.","instruction.always_env":"MUHIM: DOIM MUHIT","instruction.desc.always_env":"MUHIM: DOIMO muhitni toliq tasvirlang. Hatto yaqin planlar (Close-Up) uchun ham fon teksturasi, yoritish yoki bokehni tasvirlang. Hech qachon joylashuvni aniqlanmagan holda qoldirmang.","instruction.layered":"Algoritm: Qatlamlar","instruction.desc.layered":"Tuzilishi: [Uslub] -> [Dunyo] -> [Batafsil Muhit/Fon Obyektlari] -> [Integratsiyalashgan Obyektlar (Indeks + Vizual + Harakat)] -> [Kamera]. Tavsif va harakatni ajratmang.","instruction.desc.layered_no_style":"Tuzilishi: [Dunyo] -> [Batafsil Muhit/Fon Obyektlari] -> [Integratsiyalashgan Obyektlar (Indeks + Vizual + Harakat)] -> [Kamera]. Tavsif va harakatni ajratmang.","instruction.visuals":"Uslub: Toyinganlik","instruction.desc.visuals":"Boy vizual tavsiflardan foydalaning: hajmli yoritish, kyiaroskuro, 8k teksturalar, maydon chuqurligi.","instruction.stateless":"Qoida: Holatsiz","instruction.desc.stateless":"Har bir kadrni mustaqil deb hisoblang. Muhitni oldingi kadrda bolgan bolsa ham qaytadan toliq tasvirlang.","instruction.formatting":"Formatlash","instruction.desc.formatting":"Chiqishni oqish oson abzaslarga boling.","instruction.video":"Video","instruction.desc.video":"Video Prompt Tuzilishi: [Indeks] [Vizual] [Harakat] ketma-ket. Dynamics: [Muhit]. Camera: [Kamera]. ISMLARSIZ.","instruction.process_whole_scene":"Paket Sahna","instruction.desc.process_whole_scene":"Butun sahnani bir vaqtda tahlil qilish, izchillik uchun.","instruction.strict_char_index":"Personajlar","instruction.desc.strict_char_index":"Personaj Taxalluslarini (Character-N) har bir kadr malumotiga qatiy moslang.","instruction.rule_hierarchy":"Ierarxiya","instruction.desc.rule_hierarchy":"Tavsif tuzilishi: [Batafsil Muhit] -> [Obyekt Konteksti] -> [Aniq Harakat]. Avval kontekstni ornating.","instruction.rule_persistence":"Doimiylik","instruction.desc.rule_persistence":"Jismoniy holatni kuzating. Agar personaj 1-kadrda otirgan bolsa, aksini aytilmaguncha 2-kadrda ham otiradi.","instruction.rule_mandatory_bg":"Majburiy Fon","instruction.desc.rule_mandatory_bg":"DOIMO fon/muhitni tasvirlang, hatto yaqin planlar uchun ham. Hech qachon 'fon korinmaydi' deb yozmang. Xira bokeh/teksturani tasvirlang.","instruction.rule_living_world":"Tirik Dunyo","instruction.desc.rule_living_world":"Agar jamoat joyi bolsa, dunyo kontekstiga mos keladigan fon massovkasi/siluetlarni tasvirlang.","instruction.core_director":"Bosh Rejissyor","instruction.desc.core_director":"Siz vizyoner kino rejissyori va ssenariynavissiz. Kitob uchun emas, ekran uchun yozing. Vizualga etibor qarating.","instruction.rule_visuals":"Avval Vizual","instruction.desc.rule_visuals":"Korsating, aytib bermang. 'U xafa edi' deyish orniga, 'U stulga chokdi' deb tasvirlang. Yoritish, kompozitsiya, harakat.","instruction.rule_flow":"Uzluksiz Oqim","instruction.desc.rule_flow":"N+1-sahna N-sahnadan vizual va mantiqiy ravishda kelib chiqishi kerak. Uzuk sakrashlardan qoching.","instruction.rule_atmosphere":"Atmosfera","instruction.desc.rule_atmosphere":"Har bir sahnani sensorli tafsilotlar bilan boyiting (yoruglik, teksturalar, ob-havo, tovushlar).","instruction.batch_processing":"Paket Qayta Ishlash","instruction.desc.batch_processing":"Barcha taqdim etilgan sahnalarni hikoya va vizual izchillikni saqlash uchun uzluksiz ketma-ketlik sifatida tahlil qiling.","instruction.char_gray_bg":"Vizual Konsept","instruction.desc.char_gray_bg":"Har bir personaj vizual prompti uchun DOIMO qoshing: ', full body character concept on a gray background'.","instruction.char_secondary_ok":"Yangi Personajlar Ruxsat","instruction.desc.char_secondary_ok":"Agar syujet talab qilsa, yangi personajlar yaratish mumkin. KIYIM ALMASHTIRISH: Agar personaj kiyimini o'zgartirsa, yangi prompt bilan yangi karta yarating.","instruction.char_no_new":"Yangi Personajlar Yoq","instruction.desc.char_no_new":"Yangi personajlar yoki buyumlar YARATMANG. FAQAT taqdim etilgan Mavjud Personajlardan foydalaning.","instruction.char_no_dupes":"Dublikatlar Yoq","instruction.desc.char_no_dupes":"Dublikatlar taqiqlanadi. ISTISNO: Kiyim o'zgarishi. Bunday holda yangi kiyim bilan dublikat yarating.","instruction.sg_visual_style":"Vizual Uslub","instruction.desc.sg_visual_style":"Sorov: '{style}' asosida batafsil vizual uslub tavsifini yarating.","instruction.sg_genre":"Janr Konteksti","instruction.desc.sg_genre":"Kontekst: {genre}","instruction.sg_new_chars":"Yangi Personajlar","instruction.desc.sg_new_chars":"Prompt asosida yangi personajlarni yarating.","instruction.sg_anthro":"Antro","instruction.desc.sg_anthro":"Personajlar insoniy xususiyatlarga ega hayvonlar bolishi kerak.","instruction.sg_no_chars":"Personajlarsiz","instruction.desc.sg_no_chars":"Hujjatli uslub / Ismli personajlar yoq.","instruction.sg_detailed_plot":"Batafsil Syujet","instruction.desc.sg_detailed_plot":"Harakatlar va syujetning juda batafsil tavsiflarini taqdim eting.","instruction.sg_subscribe":"Obuna Sahnasi","instruction.desc.sg_subscribe":"Tomoshabindan obuna bolishni sorovchi sahnani (tortinchi devorni buzish) kiriting.","instruction.sg_inputs":"Kirish Malumotlari","instruction.desc.sg_inputs":"Manba: Goya/Konsepsiya, Personaj Profillari.","instruction.sg_thinking":"Tahlil","instruction.desc.sg_thinking":"Yozishdan oldin fikrlash. Kausalitet va mantiqni tahlil qilish. Klishelarni yoq qilish.","instruction.sg_improve_input":"Ssenariy Doktori","instruction.desc.sg_improve_input":"Boshlangich konsepsiyani kuchaytirish, syujet teshiklarini yopish va konfliktni keskinlashtirish.","instruction.sg_exposition":"Ekspozitsiya","instruction.desc.sg_exposition":"Dunyo holatini atrof-muhit tarixi va tafsilotlari orqali korsatish.","instruction.char_smart_concept":"Aqlli Konsept","instruction.desc.char_smart_concept":"AI tanlaydi: Personajlar uchun Toliq Boy / Obyektlar uchun Kadrni Toldirish.","instruction.sg_delayed_reveal":"Oshkor Qilish","instruction.desc.sg_delayed_reveal":"Qahramonni bosqichma-bosqich tanishtirish: muhit -> detal harakatlar -> siluet -> yuzni korsatish.","instruction.sg_metaphor":"Metafora","instruction.desc.sg_metaphor":"Personajning ichki holatini ifodalash uchun vizual ramzlardan (singan buyumlar, ob-havo) foydalanish.","instruction.sg_pacing":"Surat (Pacing)","instruction.desc.sg_pacing":"Ritm nazorati: sokin kadrlarni dinamik montaj bilan muvozanatlash.","instruction.sg_subtext":"Subtekst","instruction.desc.sg_subtext":"Dialog va harakat ortasida taranglik yaratish. Personajlar kamdan-kam hollarda haqiqatni togridan-togri aytadilar.","instruction.storyboard_rules":"Kadrlar Xilma-xilligi","instruction.desc.storyboard_rules":"Dinamik ritm va hissiy fokus uchun WS/LS (Keng), MS (Orta) va CU/ECU (Yaqin) planlarni almashtirib turish.","instruction.storyboard_rules_wide":"Kadrlar Xilma-xilligi (Faqat Keng)","instruction.desc.storyboard_rules_wide":"Faqat Keng, Uzoq va Umumiy planlardan foydalaning. Rakursni ozgartiring (Past/Yuqori/Aeronavt). Yaqin planlar YOQ.","instruction.tech_directives":"Kamera Nazorati","instruction.desc.tech_directives":"Qatiy texnik terminologiya. Plan turlari uchun FAQAT qisqartmalardan foydalaning (WS, MS, CU).","instruction.ana_role":"Tahlilchi Roli","instruction.desc.ana_role":"Siz dunyo darajasidagi Kinorejissyor va Operator. Ssenariyni vizual ijro uchun tahlil qilyapsiz.","instruction.ana_cinema":"Kinematografiya","instruction.desc.ana_cinema":"Kadr va yoritish uchun professional atamalar: Wide Shot, Close-up, Dutch Angle, Bokeh.","instruction.ana_prompt_lang":"Prompt Tili","instruction.desc.ana_prompt_lang":"Rasm va video promptlar moslik uchun qatiy ingliz tilida bolishi kerak.","instruction.desc.target_lang":"Kadr tahlili va tavsiflari ushbu tilda yaratiladi.","instruction.extended_visuals":"Kengaytirilgan Vizual Tahlil","instruction.desc.extended_visuals":"Sahnalarni qisqa, ifodali ketma-ketliklarga (Keng, MS, CU, Detal) ajratadi. Kinematografik ritm va hissiyotga urgu beradi.","instruction.general_char_desc":"Umumiy Tafsilot","instruction.desc.general_char_desc":"Personaj profilidagi vizual promptning QISQA, UMUMIY versiyasini umumlashtirish va kiritish.","instruction.full_char_desc":"Toliq Tafsilot","instruction.desc.full_char_desc":"Personaj profilidagi TOLIQ va BATAFSIL vizual promptni aynan yozilganidek kiritish.","instruction.sg_visual_dna":"Vizual DNK","instruction.desc.sg_visual_dna":"Personaj promptlari va uslub parametrlarini texnik LookDev qollanmasiga (Yoritish, Linzalar, Render uslubi) birlashtiradi.","instruction.char_detailed_style":"Stilizatsiyalangan Tafsilot","instruction.desc.char_detailed_style":"Global vizual uslubni har bir personajning texnik generatsiya promptiga integratsiya qiladi.","instruction.desc.safe_gen":"XAVFSIZLIK CHEKLOVI: AI xavfsizlik filtrlarini ishga tushiruvchi sozlardan qatiy saqlaning. 'osmir', 'intim' yoki 'ochiq' kabi atamalarni 'yosh inson', 'badiiy kompozitsiya' yoki 'stilize qilingan' kabi badiiy muqobillar bilan almashtiring.","instruction.ana_anthro_logic":"Antro Mantiq","instruction.desc.ana_anthro_logic":'Har bir kadr tavsifida personajlarni Antropomorfik Hayvonlar (masalan, "Anthropomorphic Fox") sifatida aniq tasvirlang.',"instruction.ana_subscribe_logic":"Obuna Chaqiruvi","instruction.desc.ana_subscribe_logic":"Agar sahna Obuna bolishni sorasa, vizual harakatlar qoshing: personajlar belgi ushlab turadi yoki 3D matn bilan ozaro tasir qiladi.","instruction.pm_anthro":"Antro Tafsilot","instruction.desc.pm_anthro":'MAJBURIY: Rasm VA Videoda tur oldidan "anthropomorphic" sozi. Kuchaytirilgan teksturalar/anatomiya.',"instruction.pm_subscribe":"Oqiladigan Matn","instruction.desc.pm_subscribe":'"SUBSCRIBE" yoki "LIKE" matnining yakuniy rasmda oqilishi va integratsiya qilinishini (neon, belgilar, 3D) taminlang.',"instruction.shot_filter_wide":"Faqat Keng Planlar","instruction.desc.shot_filter_wide":"QATIY FILTR: FAQAT Keng (WS), Uzoq (LS) va Orta (MS) planlardan foydalaning. Yaqin planlar (CU/ECU) taqiqlanadi.","instruction.rule_static":"Qoida: Statik","instruction.desc.rule_static":"Faqat muzlatilgan lahzani tasvirlang. Hikoya otishlari yoq.","instruction.atmosphere_fix":"Atmosfera Langari","instruction.desc.atmosphere_fix":"Kayfiyatni havo va yoruglikning jismoniy xususiyatlari sifatida tasvirlang.","instruction.subject_focus":"Kontekst Ierarxiyasi","instruction.desc.subject_focus":"MUHIM: Hatto Yaqin planlar uchun ham tasvirlang: 1. Toliq Personaj. 2. Poza. 3. Detal. AI qismlarni togri renderlashi uchun toliq tana kontekstiga muhtoj.","instruction.rule_isolation":"Nol Kontekst","instruction.desc.rule_isolation":"MUHIM: Rasm generatori oldingi kadr haqida BILMAYDI. Siz har bir kadrda muhit va ob-havoni qaytadan toliq tasvirlashingiz SHART.","instruction.sensory_saturation":"Anti-Qisqa","instruction.desc.sensory_saturation":'Qisqa yozish TAQIQLANADI. "Qollar ushladi" orniga "Oqargan bogimlar bilan iflos qollar sovuq oynani mahkam ushladi" deb yozing.'},sb={...eb,...tb,...nb,...ob,...rb,...ab,...ib},lb={"app.title":"Script Modifier","app.description":"Erstellen, verfeinern und generieren Sie Drehbcher visuell mit der Gemini API.","app.slogan":"Verbinde Ideen, um ein Meisterwerk zu schaffen","app.subtitle":"Visualisieren Sie Ihre Skripte","app.error.title":"Benachrichtigung","app.error.copy":"Fehler kopieren","app.error.copied":"Kopiert!","error.quotaExceeded":"Sie haben Ihr Nutzungslimit erreicht. Bitte berprfen Sie Ihr API-Schlssel-Kontingent oder versuchen Sie es spter erneut.","error.apiKeyMissing":"API-Schlssel nicht gefunden. Bitte geben Sie Ihren Gemini API-Schlssel in den Einstellungen ein.","error.freeKeyNotAvailable":"Kostenloser/Entwickler-API-Schlssel ist in dieser Umgebung nicht verfgbar. Bitte geben Sie Ihren eigenen Schlssel ein.","error.fileReadError":"Fehler beim Lesen der Datei.","error.videoConversionError":"Video konnte nicht in Audio umgewandelt werden.","error.unsupportedFile":"Nicht untersttzter Dateityp.","error.promptModifierFile":"Diese Datei gehrt zu einer anderen Anwendung (Prompt Modifier). Bitte ffnen Sie sie dort.","error.invalidFileType":"Ungltiger Dateityp. Bitte laden Sie eine Script Modifier Projekt- oder Canvas-Datei.","welcome.iAmDeveloper":"Ich bin Entwickler","welcome.letsGo":"Los geht's!","welcome.resume":"Fortsetzen","welcome.reload":"Neu laden","welcome.reloadTitle":"Zurcksetzen & Neu laden?","welcome.reloadMessage":"Dies lscht den gesamten Canvas und ldt die Anwendung neu. Nicht gespeicherte Daten gehen verloren. Sind Sie sicher?","welcome.confirmReload":"Zurcksetzen & Neu laden","dialog.welcome.title":"Script Modifier","dialog.welcome.heading":"Willkommen im","dialog.welcome.intro1":"Willkommen beim Script Modifier  Ihrem visuellen Arbeitsbereich zum Erstellen von Geschichten mit Gemini.","dialog.welcome.intro2":"Whlen Sie zum Starten Ihre Sprache und geben Sie Ihren Gemini API-Schlssel ein.","dialog.welcome.apiKeyExplanation":"Ihr API-Schlssel wird lokal in Ihrem Browser gespeichert. Wir senden ihn an keinen anderen Server als die Google Gemini API."},cb={"toolbar.edit":"Bearbeiten (V)","toolbar.cutter":"Verbindung trennen (C)","toolbar.selection":"Auswahl (S)","toolbar.reroute":"Umlenkpunkt (R)","toolbar.zoom":"Zoom (Z)","toolbar.snapToGrid":"Am Raster ausrichten (Shift+W)","toolbar.resetZoom":"Zoom zurcksetzen","toolbar.lineStyleSpaghetti":"Spaghetti-Linien (Shift+E)","toolbar.lineStyleOrthogonal":"Orthogonale Linien (Shift+E)","toolbar.addNode":"Knoten hinzufgen (F)","toolbar.catalog":"Katalog (Strg+Leertaste)","toolbar.settings":"Einstellungen","toolbar.resetToDefault":"Auf Standard zurcksetzen","toolbar.closeProject":"Projekt schlieen / Leeren","toolbar.enterFullscreen":"Vollbild","toolbar.exitFullscreen":"Vollbild beenden","toolbar.home":"Startseite","toolbar.addTextInput":"Texteingabe (T)","toolbar.addPromptAnalyzer":"Prompt-Analysator (A)","toolbar.addCharacterAnalyzer":"Charakter-Analysator","toolbar.addCharacterGenerator":"Charakter-Generator (Shift+C)","toolbar.addImageGenerator":"Bild-Generator (O)","toolbar.addImagePreview":"Bild-Vorschau (I)","toolbar.addCharacterCard":"Charakterkarte (Strg+Shift+C)","toolbar.addPromptProcessor":"Prompt-Prozessor (P)","toolbar.addGeminiChat":"Gemini Chat (G)","toolbar.addTranslator":"bersetzer (L)","toolbar.addIdeaGenerator":"Ideen-Generator (Shift+A)","toolbar.addScriptGenerator":"Drehbuch-Generator (Shift+S)","toolbar.addScriptAnalyzer":"Drehbuch-Analysator (Shift+D)","toolbar.addScriptPromptModifier":"Prompt-Finalisierer (Shift+F)","toolbar.addErrorAnalyzer":"Fehler-Analysator","toolbar.addNote":"Notiz (N)","toolbar.addDataReader":"Daten-Leser (Shift+R)","toolbar.addSpeechSynthesizer":"Sprachsynthesizer (Shift+N)","toolbar.addNarratorTextGenerator":"Erzhlertext-Generator (Shift+G)","toolbar.addAudioTranscriber":"Audio-Transkribierer (Shift+B)","toolbar.addYouTubeTitleGenerator":"YouTube Titel-Generator (Shift+T)","toolbar.addMusicIdeaGenerator":"Musikideen-Generator (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube Analytics (Shift+Y)","toolbar.saveCanvas":"Canvas speichern (Strg+S)","toolbar.saveProject":"Projekt speichern (Strg+Shift+S)","toolbar.loadCanvas":"Laden (Strg+O)","toolbar.clearCanvas":"Canvas leeren","toolbar.group.general":"Allgemein","toolbar.group.scripting":"Drehbuch","toolbar.group.prompting":"Prompts & Analyse","toolbar.group.characters":"Charaktere","toolbar.group.ai":"KI-Tools","toolbar.group.file":"Datei","toolbar.group.images":"Bilder","toolbar.group.audio":"Audio","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"Canvas-Steuerung","toolbar.expand":"Panel erweitern","toolbar.collapse":"Panel einklappen","toolbar.toggleHeaders":"Kopfzeilen umschalten","hotkeys.file.title":"Datei","hotkeys.file.save":"Canvas speichern (Strg+S)","hotkeys.file.saveProject":"Projekt speichern (Strg+Shift+S)","hotkeys.file.load":"Laden (Strg+O)","hotkeys.tools.title":"Werkzeuge","hotkeys.tools.edit":"Bearbeiten","hotkeys.tools.cutter":"Cutter","hotkeys.tools.selection":"Auswahl","hotkeys.tools.reroute":"Umlenkpunkt","hotkeys.tools.zoom":"Zoom","hotkeys.tools.group":"Gruppieren (G)","hotkeys.tools.deleteGroup":"Gruppe lschen","hotkeys.tools.closeNode":"Knoten schlieen","hotkeys.tools.toggleLineStyle":"Linienstil umschalten","hotkeys.tools.snapToGrid":"Am Raster ausrichten","hotkeys.tools.selectAll":"Alles auswhlen","hotkeys.tools.deselectAll":"Auswahl aufheben","hotkeys.tools.duplicate":"Duplizieren (mit Inhalt)","hotkeys.windows.title":"Fenster","hotkeys.windows.search":"Suche (F)","hotkeys.windows.quickAdd":"Schnell hinzufgen (Leertaste)","hotkeys.windows.catalog":"Katalog","hotkeys.createNode.title":"Knoten erstellen","hotkeys.hide":"Hotkeys ausblenden","help.title":"Tastenkrzel","hotkeys.show":"Hotkeys anzeigen","search.placeholder":"Knoten suchen...","search.noResults":"Keine Knoten gefunden.","search.node.text_input.title":"Texteingabe","search.node.text_input.description":"Ein einfaches Textfeld fr Ihre Ideen. (T)","search.node.prompt_processor.title":"Prompt-Prozessor","search.node.prompt_processor.description":"Verbessert und kombiniert Prompts mit KI. (P)","search.node.prompt_analyzer.title":"Prompt-Analysator","search.node.prompt_analyzer.description":"Teilt einen Prompt in Umgebung, Charakter und Aktion auf. (A)","search.node.character_analyzer.title":"Charakter-Analysator","search.node.character_analyzer.description":"Teilt eine Beschreibung in Charakter & Kleidung auf.","search.node.character_generator.title":"Charakter-Generator","search.node.character_generator.description":"Erstellt detaillierte Charaktere aus einer Idee. (Shift+C)","search.node.image_generator.title":"Bild-Generator","search.node.image_generator.description":"Erstellt ein Bild aus einem Text-Prompt. (O)","search.node.image_preview.title":"Bild-Vorschau","search.node.image_preview.description":"Zeigt ein Bild aus einer Datei an. (I)","search.node.character_card.title":"Charakterkarte","search.node.character_card.description":"Speichert Bild, Name und Prompt eines Charakters. (Strg+Shift+C)","search.node.gemini_chat.title":"Gemini Chat","search.node.gemini_chat.description":"Direkte Unterhaltung mit Gemini KI. (G)","search.node.translator.title":"bersetzer","search.node.translator.description":"bersetzt Text in eine gewhlte Sprache. (L)","search.node.script_generator.title":"Drehbuch-Generator","search.node.script_generator.description":"Wandelt eine Idee in Drehbuch-Szenen um. (Shift+S)","search.node.script_analyzer.title":"Drehbuch-Analysator","search.node.script_analyzer.description":"Zerlegt ein Skript in Frames und Bild-Prompts. (Shift+D)","search.node.script_prompt_modifier.title":"Prompt-Finalisierer","search.node.script_prompt_modifier.description":"Finalisiert Prompts aus der Analyse fr die Bildgenerierung. (Shift+F)","search.node.error_analyzer.title":"Fehler-Analysator","search.node.error_analyzer.description":"Prft und korrigiert Rechtschreibung und Grammatik.","search.node.note.title":"Notiz","search.node.note.description":"Ein einfaches Textfeld fr Notizen. (N)","search.node.reroute_dot.title":"Umlenkpunkt","search.node.reroute_dot.description":"Ein Punkt zum Umleiten und Verzweigen von Verbindungen.","search.node.data_reader.title":"Daten-Leser","search.node.data_reader.description":"Zeigt Rohdaten eines verbundenen Knotens an.","search.node.speech_synthesizer.title":"Sprachsynthesizer","search.node.speech_synthesizer.description":"Wandelt Text in Sprache um. (Shift+N)","search.node.idea_generator.title":"Ideen-Generator","search.node.idea_generator.description":"Generiert Kategorien und kombiniert sie zu einer Idee.","search.node.narrator_text_generator.title":"Erzhlertext-Generator","search.node.narrator_text_generator.description":"Generiert Text fr Erzhler oder Sprecher. (Shift+G)","search.node.audio_transcriber.title":"Audio-Transkribierer","search.node.audio_transcriber.description":"Wandelt Audio-/Videodateien in Text um. (Shift+B)","search.node.youtube_title_generator.title":"YouTube Titel-Generator","search.node.youtube_title_generator.description":"Generiert ansprechende Titel, Beschreibungen und Tags fr YouTube.","search.node.music_idea_generator.title":"Musikideen-Generator","search.node.music_idea_generator.description":"Generiert Songtexte oder Musik-Prompts. (Shift+M)","search.node.youtube_analytics":"YouTube Analytics","search.node.youtube_analytics.description":"Analysiert Kanalstatistiken und gibt Wachstumstipps.","search.node.image_editor.title":"Bild-Editor","search.node.image_editor.description":"Bearbeiten Sie Bilder mit KI (Inpainting, Outpainting).","search.group.input":"Eingabe","search.group.process":"Verarbeitung","search.group.scripting":"Skripting","search.group.character":"Charaktere","search.group.images":"Bilder","search.group.ai":"KI-Tools","search.group.audio":"Audio","search.group.youtube":"YouTube","contextMenu.tools":"Werkzeuge","contextMenu.assignSlot":"Slot {index} zuweisen","contextMenu.addNodeFromSlot":"{node} hinzufgen ({index})","connectionMenu.title":"Knoten hinzufgen","quickAddMenu.title":"Schnell hinzufgen","contextMenu.paste":"Einfgen (Strg+V)","node.content.simpleActions":"Einfache Aktionen","node.content.smartConcept":"Smart Concept","tooltip.model.flash":"Gemini Flash: Schnell, effizient, gut fr Entwrfe.","tooltip.model.pro":"Gemini Pro: Hohe Intelligenz, komplexes Denken, detailliert.","tooltip.lang.ru":"Skript auf Russisch generieren.","tooltip.lang.en":"Skript auf Englisch generieren.","tooltip.lang.es":"Skript auf Spanisch generieren.","tooltip.lang.de":"Skript auf Deutsch generieren.","tooltip.lang.uz":"Skript auf Usbekisch generieren.","tooltip.lang.fr":"Skript auf Franzsisch generieren.","tooltip.lang.it":"Skript auf Italienisch generieren.","tooltip.lang.pt":"Skript auf Portugiesisch generieren.","tooltip.lang.zh":"Skript auf Chinesisch generieren.","node.action.locateInStack":"Im Stapel finden","help.tabs.hotkeys":"Hilfe & Hotkeys","help.tabs.links":"Andere Apps & Links","help.category.socials":"Soziale Medien","help.category.stable":"Google AI Studio (Stabil)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":"Web / Netlify","help.category.github":"GitHub Repositories","help.link.youtube":"YouTube Kanal","help.link.telegram_channel":"Telegram Kanal","help.link.telegram_chat":"Telegram Chat","help.sub.news":"Neuigkeiten & Updates","help.sub.discussion":"Diskussion","help.sub.stable":"Stabile Version","help.sub.alpha":"Alpha Version","languages.ru":"Russisch","languages.en":"Englisch","languages.es":"Spanisch","languages.fr":"Franzsisch","languages.de":"Deutsch","languages.it":"Italienisch","languages.pt":"Portugiesisch","languages.zh":"Chinesisch","languages.ja":"Japanisch","languages.ko":"Koreanisch","languages.uz":"Usbekisch"},db={"node.title.text_input":"Texteingabe","node.title.prompt_processor":"Prompt-Prozessor","node.title.prompt_analyzer":"Prompt-Analysator","node.title.character_analyzer":"Charakter-Analysator","node.title.character_generator":"Charakter-Generator","node.title.image_generator":"Bild-Generator","node.title.image_preview":"Bild-Vorschau","node.title.character_card":"Charakterkarte","node.title.gemini_chat":"Gemini Chat","node.title.translator":"bersetzer","node.title.script_generator":"Drehbuch-Generator","node.title.script_analyzer":"Drehbuch-Analysator","node.title.script_prompt_modifier":"Prompt-Finalisierer","node.title.error_analyzer":"Fehler-Analysator","node.title.note":"Notiz","node.title.reroute_dot":"Umlenkpunkt","node.title.data_reader":"Daten-Leser","node.title.speech_synthesizer":"Sprachsynthesizer","node.title.idea_generator":"Ideen-Generator","node.title.narrator_text_generator":"Erzhlertext-Generator","node.title.audio_transcriber":"Audio-Transkribierer","node.title.youtube_title_generator":"YouTube Titel-Generator","node.title.music_idea_generator":"Musikideen-Generator","node.title.youtube_analytics":"YouTube Analytics","node.title.image_editor":"Bild-Editor","node.help.text_input":"Geben Sie hier grundlegende Ideen oder Schlsselwrter ein.","node.help.prompt_processor":"Kombiniert Texte aus anderen Knoten zu einem detaillierten Prompt.","node.help.prompt_analyzer":"Teilt einen Prompt in Umgebung, Charakter, Aktion und Stil auf.","node.help.character_analyzer":"Analysiert eine Charakterbeschreibung in Aussehen und Kleidung.","node.help.character_generator":"Erstellt detaillierte Charaktere aus einer Idee.","node.help.image_generator":"Generiert ein Bild aus einem Text-Prompt mit der Gemini API.","node.help.image_preview":"Zeigt ein Bild an. Ziehen Sie eine Datei darauf.","node.help.character_card":"Speichert Bild, Name und Prompt eines Charakters.","node.help.gemini_chat":"Direkte Unterhaltung mit Gemini KI.","node.help.translator":"bersetzt eingehenden Text in die gewhlte Sprache.","node.help.script_generator":"Erzeugt Drehbuch-Szenen aus einem Prompt.","node.help.script_analyzer":"Zerlegt ein Skript in Frames und Bild-Prompts.","node.help.script_prompt_modifier":"Erstellt finale knstlerische Prompts fr jeden Frame.","node.help.error_analyzer":"Prft und korrigiert Rechtschreibung und Grammatik.","node.help.note":"Ein einfaches Textfeld fr Notizen.","node.help.reroute_dot":"Ein Punkt zum Umleiten von Verbindungen.","node.help.data_reader":"Zeigt Rohdaten eines verbundenen Knotens an.","node.help.speech_synthesizer":"Wandelt Text in Sprache um.","node.help.idea_generator":"Generiert Kategorien und kombiniert sie zu einer Idee.","node.help.narrator_text_generator":"Generiert Text fr Erzhler oder Sprecher.","node.help.audio_transcriber":"Wandelt Audio-/Videodateien in Text um.","node.help.youtube_title_generator":"Generiert Titel, Beschreibungen und Tags fr YouTube.","node.help.music_idea_generator":"Generiert Songtexte oder Musik-Prompts.","node.help.youtube_analytics":"Analysiert Kanalstatistiken und gibt Wachstumstipps.","node.help.image_editor":"Bearbeiten Sie Bilder mit KI (Inpainting, Outpainting).","node.action.help":"Hilfe","node.action.expand":"Erweitern","node.action.collapse":"Einklappen (H)","node.action.expandAll":"Alles erweitern","node.action.collapseAll":"Alles einklappen","node.action.expandAllScenes":"Alle Szenen erweitern","node.action.collapseAllScenes":"Alle Szenen einklappen","node.action.expandAllFrames":"Alle Frames erweitern","node.action.collapseAllFrames":"Alle Frames einklappen","node.action.expandPanel":"Panel erweitern","node.action.collapsePanel":"Panel einklappen","node.action.togglePanel":"Umschalten","node.action.collapseScene":"Szene einklappen","node.action.expandScene":"Szene erweitern","node.action.collapseFrame":"Frame einklappen","node.action.expandFrame":"Frame erweitern","node.action.collapseCharacter":"Charakter einklappen","node.action.expandCharacter":"Charakter erweitern","node.action.clear":"Leeren","node.action.clearTooltip":"Eingabefeld leeren.","node.action.clearChat":"Chat leeren & neu laden","node.action.paste":"Einfgen","node.action.copy":"Kopieren","node.action.duplicateWithContent":"Duplizieren (Inhalt)","node.action.duplicateEmpty":"Duplizieren (Leer)","node.action.cutConnections":"Verbindungen trennen","node.action.close":"Schlieen","node.action.executeChain":"Kette ausfhren","node.action.executeFullChain":"Volle Kette ausfhren","node.action.processChainForward":"Kette vorwrts verarbeiten","node.action.executeChainTitle":"Alle verbundenen Knoten ausfhren.","node.action.addCharacter":"Charakter hinzufgen","node.action.addScene":"Szene hinzufgen","node.action.addFrame":"Frame hinzufgen","node.action.addFirstFrame":"Ersten Frame hinzufgen","node.action.deleteItem":"Lschen","node.action.moveUp":"Nach oben","node.action.moveDown":"Nach unten","node.action.saveImage":"Bild speichern","node.action.loadImage":"Bild laden","node.action.saveCharacter":"Charakter speichern","node.action.loadCharacter":"Charakter laden","node.action.readData":"Daten lesen","node.action.refreshData":"Daten aktualisieren","node.action.stop":"Stopp","node.action.stopping":"Stoppe...","node.action.embedCharacter":"Charakter einbetten","node.action.downloadFinalPrompts":"Prompts herunterladen","node.action.rename":"Umbenennen","node.action.index":"Indexieren","node.action.improveConcept":"Konzept verbessern","node.action.improveConceptTooltip":"Erweitern und visuelle Details hinzufgen.","node.action.downloadJson":"JSON herunterladen","node.action.downloadSRT":"SRT herunterladen","node.action.markPrimary":"Als Hauptcharakter markieren","node.input.default":"Eingang","node.output.default":"Ausgang","node.output.allCharacters":"Alle Charaktere","node.output.primaryCharacter":"Hauptcharakter","node.content.action":"Aktion","node.content.actionPlaceholder":"Aktions-Prompt...","node.content.allScriptParts":"Alle Skriptteile","node.content.allScriptAnalyzerData":"Daten vom Analysator","node.content.allNarratorData":"Alle Erzhlerdaten","node.content.analyzeCharacters":"Charaktere analysieren","node.content.analyzeFromScene":"Analysieren ab:","node.content.analyzeUpToScene":"bis","node.content.endPlaceholder":"Ende","node.content.generateFromFrame":"Generieren ab Frame:","node.content.generateUpToFrame":"bis Frame","node.content.analyzeFromFrame":"Finalisieren ab Frame:","node.content.processFromFrame":"Verarbeiten ab Frame:","node.content.processFromScene":"Verarbeiten ab Szene:","node.content.analyzePrompt":"Prompt analysieren","node.content.analyzeScript":"Skript analysieren","node.content.analyzing":"Analysiere...","node.content.applyAliases":"Aliase anwenden","node.content.applyAliasesTooltip":"Ersetzt Charakternamen durch Aliase (Index).","node.content.character":"Charakter","node.content.characterIndex":"Index","node.content.characterPlaceholder":"Charakter-Prompt...","node.content.character_plural":"Charaktere","node.content.characters":"Charaktere","node.content.charactersSynced":"Charaktere synchronisiert","node.content.noCharactersConnected":"Keine Charaktere verbunden.","node.content.appearance":"Aussehen","node.content.personality":"Persnlichkeit","node.content.characterType":"Typ","node.content.characterTypeShort":"Typ","node.content.characterType.simple":"Einfach","node.content.characterType.anthro":"Anthro (Tiere)","node.content.characterType.chibi":"Chibi (Niedlich)","node.content.characterType.key_item":"Schlsselobjekt","node.content.style":"Stil","node.content.style.none":"Keiner","node.content.style.simple":"Einfach","node.content.style.realistic":"Realistisch/Kino","node.content.style.3d_cartoon":"3D Cartoon","node.content.style.3d_realistic":"3D Realistisch","node.content.style.2d_animation":"2D Animation","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Spezial","node.content.chatPlaceholder":"Nachricht eingeben...","node.content.clothing":"Kleidung","node.content.clothingPlaceholder":"Kleidungs-Prompt...","node.content.connectedPlaceholder":"Verbunden","node.content.dataPlaceholder":"Daten erscheinen hier...","node.content.readData":"Daten lesen","node.content.reading":"Lese...","node.content.description":"Beschreibung","node.content.sceneDescription":"Szenenbeschreibung","node.content.duration":"Dauer","node.content.enhancePrompt":"Prompt generieren","node.content.enhancedPromptHere":"Verbesserter Prompt erscheint hier...","node.content.enhancing":"Verbessere...","node.content.environment":"Umgebung","node.content.environmentPlaceholder":"Umgebungs-Prompt...","node.content.environmentPrompt":"Umgebung & Hintergrund","node.content.compositionAndBlocking":"Komposition & Aktion","node.content.executingChain":"Kette luft...","node.content.imagePrompt":"Bild-Prompt","node.content.finalPrompt":"Finaler Prompt","node.content.finalPrompt_plural":"Finale Prompts","node.content.fixErrors":"Fehler beheben","node.content.fixingErrors":"Korrigiere...","node.content.frame":"Frame","node.content.frame_plural":"Frames","node.content.frames":"Ausgabe-Frames","node.content.frames_analyzed":"Frames analysiert: {count}","node.content.framesPerScene":"Frames pro Szene","node.content.minFrames":"Min","node.content.maxFrames":"Max","node.content.numberOfCharactersShort":"Anz.","node.content.fullDescription":"Vollstndige Beschreibung","node.content.generateCharacters":"Charaktere generieren","node.content.generateFinalPrompts":"Finale Prompts generieren","node.content.generatingProgress":"Generiere {current} von {total}","node.content.generateImage":"Bild generieren","node.content.generateScript":"Skript generieren","node.content.generateSpeech":"Sprache generieren","node.content.generateText":"Text generieren","node.content.generateSSML":"SSML generieren","node.content.generateStyle":"Stil generieren","node.content.generating":"Generiere...","node.content.improving":"Verbessere...","node.content.generatedAudio":"Generiertes Audio","node.content.imagePromptPlaceholder":"Prompt fr Bild eingeben...","node.content.modificationPromptPlaceholder":"nderungswunsch...","node.content.narrator":"Erzhler","node.content.narratorEnabled":"Erzhler aktivieren","node.content.narratorEnabledInfo":"Fgt Voiceover-Text hinzu.","node.content.narratorMode":"Erzhler-Modus","node.content.narratorMode.normal":"Normal / Voiceover","node.content.narratorMode.dual":"Zwei Erzhler","node.content.narratorMode.first_person":"Erste Person","node.content.role":"Rolle","node.content.role.narrator":"Erzhler","node.content.role.announcer":"Ansager","node.content.role.first_person":"Erste Person","node.content.role.dual_narrator":"Zwei Erzhler","node.content.role.dual_announcer":"Zwei Ansager","node.content.scene":"Szene","node.content.scene_plural":"Szenen","node.content.scenes":"Szenen","node.content.scenes_generated":"Szenen generiert: {count}","node.content.sceneContext":"Szenen-Kontext","node.content.sceneContextPlaceholder":"Stimmung, Umgebung, Licht...","node.content.scriptPromptPlaceholder":"Story-Idee eingeben...","node.content.seconds":"Sek","node.content.stylePlaceholder":"Stil-Prompt...","node.content.stylePromptPlaceholder":"Stil-Prompt hier eingeben...","node.content.styleOverride":"Stil berschreiben","node.content.summary":"Zusammenfassung","node.content.targetLanguage":"Zielsprache","node.content.textToSynthesize":"Text zum Synthetisieren...","node.content.translate":"bersetzen","node.content.translatePlaceholder":"Text zum bersetzen...","node.content.translatedTextPlaceholder":"bersetzung erscheint hier...","node.content.translating":"bersetze...","node.content.useExistingCharacters":"Vorh. Charaktere nutzen","node.content.useExistingCharactersInfo":"Nutzt verbundene Charakterdaten statt neue zu generieren.","node.content.createKeyItem":"Sekundr/Items erstellen","node.content.createSecondaryChars":"Nebencharaktere","node.content.createKeyItems":"Schlsselobjekte","node.content.createKeyItemInfo":"Erlaubt KI, Nebencharaktere oder Items zu erstellen.","node.content.noCharacters":"Keine Charaktere","node.content.noCharactersInfo":"Fokus auf Ereignisse und Atmosphre (Doku-Stil).","node.content.videoPrompt":"Dynamik & Bewegung","node.content.videoPrompts":"Video Prompts","node.content.voice":"Stimme","node.content.previewVoice":"Stimme testen","node.content.voicePreviewText":"Hallo, dies ist ein Stimmtest.","node.content.inputScripts":"Eingabe-Szenen","node.content.inputFrames":"Eingabe-Frames","node.content.outputScript":"Ausgabe-Szenen","node.content.requestCategories":"Kategorien anfordern","node.content.generateIdea":"Idee generieren","node.content.requestNewCategories":"Neue Kategorien","node.content.category.action":"Aktion","node.content.category.place":"Ort","node.content.category.obstacle":"Hindernis","node.content.generatedIdea":"Generierte Idee","node.content.storyFormat":"Story-Format","node.content.theme":"Thema","node.content.parameters":"Parameter","node.content.advancedMode":"Erweiterter Modus","node.content.numberOfScenes":"Anzahl der Szenen","node.content.numberOfScenes.auto":"Auto","node.content.detailedPlot":"Detaillierter Plot","node.content.detailedPlotInfo":"Aktiviert detaillierte Beschreibungen.","node.content.includeSubscribeScene":"Abo-Aufruf Szene","node.content.includeSubscribeSceneInfo":"Fgt eine Szene hinzu, die zum Abonnieren auffordert.","node.content.genre":"Genre","node.content.genre2":"Genre 2","node.content.breakIntoParagraphs":"Abstze","node.content.copyVideoPrompt":"Video-Prompt kopieren","node.content.generateVideoPrompt":"Video-Prompt generieren","node.content.model":"Modell","node.content.processWholeScene":"Ganze Szene verarbeiten","node.content.processWholeSceneInfo":"Verarbeitet alle Frames einer Szene auf einmal fr Konsistenz.","node.content.batchProcessing":"Stapelverarbeitung","node.content.batchProcessingInfo":"Alle gewhlten Szenen in einem Kontext verarbeiten.","node.content.extendedAnalysis":"Erweiterte Analyse","node.content.extendedAnalysisInfo":"Unterteilt Szenen in detaillierte Shots.","node.content.professionalStoryboard":"Regie-Storyboard","node.content.professionalStoryboardInfo":"Analyse nach filmischen Regeln.","node.content.generateStartEndFrames":"Start/End-Frames generieren","node.content.autoIndexCharacters":"Charaktere auto-indexieren","node.content.autoIndexCharactersInfo":"Ersetzt Namen automatisch durch Aliase.","node.content.imageToText":"Bild zu Text","node.content.extracting":"Extrahiere...","node.content.extractedText":"Extrahierter Text","node.content.activePromptStack":"Aktiver Prompt-Stapel","node.content.noCharactersAnalyzed":"Keine Charaktere analysiert.","node.content.promptsGeneratedPlaceholder":"Generierte Prompts erscheinen hier.","node.content.noCharactersInScript":"Keine Charaktere im Skript.","node.content.noInputScenes":"Keine Eingabedaten. Bitte Skript-Generator verbinden.","node.content.status":"Status","node.content.status.ready":"Bereit","node.content.status.paused":"Pausiert","node.content.status.generating":"Generiere","node.content.status.total":"Gesamt: {generated} / {total}","node.content.status.batch":"Verarbeite: {current} von {total}","node.content.status.time":"Zeit: {current}s / {total}s","node.content.refreshing":"Aktualisiere...","node.content.totalFrames":"Gesamt Frames: {count}","node.content.uploadAudio":"Audio/Video hochladen","node.content.noAudioLoaded":"Kein Audio","node.content.audioLoaded":"Audio geladen","node.content.transcriptionPlaceholder":"Transkription erscheint hier...","node.content.transcribe":"Transkribieren","node.content.transcribing":"Transkribiere...","node.content.convertingVideo":"Konvertiere Video...","node.content.recommendedFrames":"Geschtzte Frames","node.content.shotType":"Einstellung","node.content.shotType.ws":"WS (Totale)","node.content.shotType.ms":"MS (Halbnah)","node.content.shotType.cu":"CU (Nah)","node.content.shotType.ecu":"ECU (Detail)","node.content.shotType.ls":"LS (Halbtotale)","node.content.characterDetail":"Charakterdetails","node.content.noCharDesc":"Keine Charakterbeschreibung","node.content.includeGeneralCharDesc":"Allgemeine visuelle Beschreibung","node.content.includeFullCharDesc":"Detaillierte visuelle Beschreibung","node.content.safeGeneration":"Sichere Generierung","node.content.shotFilter":"Shot-Filter","node.content.shotFilter.all":"Alle","node.content.shotFilter.wideOnly":"Nur Weitwinkel","instruction.desc.shot_filter_all":"Alle Einstellungsgren erlaubt (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Nur weite Einstellungen (WS, MS, LS). Keine Nahaufnahmen.","node.content.anthroEnabled":"Anthropomorphe Tiere","node.content.subscribeEnhancement":"Abo-Aufruf verstrken","node.content.thinkingEnabled":"Denkmodus","node.content.scenelessMode":"Szenen ohne Skript","instruction.desc.sceneless_mode":"Deaktiviert die Narrative Engine. Generiert Szenen direkt aus dem Konzept.","instruction.sceneless_mode":"Szenenlisten-Modus","node.content.microActionBreakdown":"Mikro-Aktionen","node.content.microActionBreakdownInfo":"Zerlegt komplexe Aktionen in Phasen (Vorbereitung, Aktion, Reaktion).","node.content.commercialSafe":"Kommerziell sicher","instruction.desc.commercial_safe":"Vermeidet strikt Marken (Disney, Pixar) und ersetzt sie durch generische Beschreibungen.","node.content.findStack":"Im Stapel suchen...","node.content.spm_stack.priming":"1. Priming & Kontext","node.content.spm_stack.physics":"2. Physik & Logik","node.content.spm_stack.hierarchy":"3. Subjekt-Hierarchie","node.content.spm_stack.construction":"4. Konstruktion & Format"},ub={"genre.general":"Allgemein","genre.comedy":"Komdie","genre.drama":"Drama","genre.action":"Action","genre.scifi":"Science-Fiction","genre.fantasy":"Fantasy","genre.horror":"Horror","genre.thriller":"Thriller","genre.childrens_animation":"Kinderanimation","genre.shorts_story":"Kurzgeschichten (Shorts)","genre.scientific_historical":"Wissenschaftlich-Historisch","character_generator.promptPlaceholder":'Idee eingeben, z.B.: "tapferer Ritter, Wchter des alten Waldes"',"idea_generator.randomTheme":"Zuflliges Thema","idea_generator.randomCombination":"Zufllige Kombination","idea_generator.themePlaceholder":"z.B. Weltraum, Kche, Zauberwald","idea_generator.initialMessage":'Thema eingeben (optional) und "{buttonName}" klicken.',"idea_generator.ideaPlaceholder":"Generierte Idee erscheint hier...","idea_generator.format.general":"Allgemein","idea_generator.format.childrens":"Kinder","idea_generator.format.adventure":"Abenteuer","idea_generator.format.fantasy":"Fantasy / Magie","idea_generator.format.detective":"Detektiv","idea_generator.format.scifi":"Sci-Fi","idea_generator.format.horror":"Horror","idea_generator.format.historical":"Historisch","gender.male":"Mnnlich","gender.female":"Weiblich","node.content.autoDownload":"Auto-Download bei Generierung","node.content.downloadSelected":"Ausgewhlte herunterladen","node.content.intonation":"Betonung","intonation.standard":"Standard","intonation.cheerful":"Frhlich","intonation.angry":"Wtend","intonation.sad":"Traurig","intonation.excited":"Aufgeregt","intonation.announcer":"Ansager","intonation.whispering":"Flsternd","node.content.sceneMode":"Szenen-Modus","node.content.connectNarratorData":'Verbinde "Alle Erzhlerdaten" vom Skript-Generator.',"node.content.sceneModeActive":"Szenen-Modus aktiv. Daten aus Verbindung.","speech_synthesizer.mode.simple":"Einfach","speech_synthesizer.mode.scene":"Szene","speech_synthesizer.multiSpeaker":"Zwei Sprecher","speech_synthesizer.speaker1Name":"Name Sprecher 1","speech_synthesizer.speaker2Name":"Name Sprecher 2","speech_synthesizer.multiSpeakerHint":'Namen mssen mit Text bereinstimmen (z.B. "Mann: ...").',"speech_synthesizer.ssmlHint":"Betonung wird durch SSML im Text gesteuert.","youtube_analytics.authorName":"Autor Name","youtube_analytics.videoTitle":"Video Titel","youtube_analytics.views":"Aufrufe","youtube_analytics.addToChannel":"Zu Kanal hinzufgen","youtube_analytics.noIncomingData":"Keine eingehenden Daten.","youtube_analytics.videoAdded":"Video hinzugefgt!","youtube_analytics.dragDrop":"Screenshot hier ablegen","youtube_analytics.thumbnailUpdated":"Thumbnail aktualisiert","youtube_analytics.statsTrend":"Statistik-Trend","youtube_analytics.currentChannel":"Aktueller Kanal","youtube_analytics.growth":"Wachstum","youtube_analytics.allChannels":"Alle Kanle","youtube_analytics.saveDisk":"Auf Datentrger speichern","youtube_analytics.saveCatalog":"Im Katalog speichern","youtube_analytics.loadDisk":"Von Datentrger laden","youtube_analytics.analyzing":"Analysiere...","youtube_analytics.askAI":"KI fragen","youtube_analytics.clickForAdvice":'Klicken Sie auf "KI fragen".',"youtube_analytics.dailyNotes":"Tgliche Notizen","youtube_analytics.logDailyStats":"Statistik loggen","youtube_analytics.subscribers":"Abonnenten","youtube_analytics.totalViews":"Gesamtansichten","youtube_analytics.updateStats":"Aktualisieren","youtube_analytics.history":"Verlauf","youtube_analytics.noHistory":"Kein Verlauf.","youtube_analytics.noNotes":"Keine Notizen.","youtube_analytics.noVideos":"Keine Videos.","youtube_analytics.loadedFromDisk":"Geladen","youtube_analytics.loadFailed":"Ladefehler","youtube_analytics.savedToDisk":"Gespeichert","youtube_title_generator.mode.title":"Video-Titel","youtube_title_generator.mode.channel":"Kanal-Info","youtube_title_generator.ideaPlaceholder":"Video-Idee eingeben...","youtube_title_generator.channelIdeaPlaceholder":"Kanal-Thema eingeben...","youtube_title_generator.title":"Titel","youtube_title_generator.description":"Beschreibung","youtube_title_generator.tags":"Tags","youtube_title_generator.channelName":"Kanalname","youtube_title_generator.channelDescription":"Kanalbeschreibung","youtube_title_generator.channelKeywords":"Keywords","youtube_title_generator.channelHandle":"Handle (@)","music_idea_generator.mode.lyrics":"Songtext","music_idea_generator.mode.music_prompt":"Musik-Prompt","music_idea_generator.ideaPlaceholder":"Songthema oder Stimmung...","music_idea_generator.songTitle":"Songtitel","music_idea_generator.songTitlePlaceholder":"Titel...","music_idea_generator.lyricsPlaceholder":"Songtext erscheint hier...","music_idea_generator.musicPromptPlaceholder":"KI Musik-Prompt erscheint hier...","chat.mode.general":"Allgemein","chat.mode.script":"Skript-Experte","chat.mode.prompt":"Prompt-Experte","chat.mode.youtube":"YouTube-Experte"},pb={"catalog.title":"Katalog","catalog.tabs.groups":"Gruppen","catalog.tabs.library":"Prompt-Bibliothek","catalog.tabs.characters":"Charaktere","catalog.tabs.scripts":"Skripte","catalog.tabs.analysis":"Analysen","catalog.tabs.final_prompts":"Finale Prompts","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"Musik-Ideen","catalog.empty.title":"Katalog ist leer","catalog.empty.description":"Speichern Sie ein Element oder importieren Sie es.","catalog.loadFromFile":"Aus Datei laden","catalog.card.addToCanvas":"Zum Canvas hinzufgen","catalog.card.rename":"Umbenennen","catalog.card.save":"Auf Datentrger speichern","catalog.card.delete":"Lschen","library.loadFromFile":"Aus Datei laden","library.empty.title":"Ordner ist leer","library.empty.description":"Erstellen Sie einen Ordner oder Prompt.","library.emptyPrompt":"Kein Inhalt","library.actions.newFolder":"Neuer Ordner","library.actions.newPrompt":"Neuer Prompt","library.actions.copy":"In Zwischenablage kopieren","library.actions.edit":"Prompt bearbeiten","group.rename":"Gruppe umbenennen","group.saveToCatalog":"In Katalog speichern","group.saveToDisk":"Auf Datentrger speichern","group.ungroup":"Gruppierung aufheben (Shift+Klick zum Lschen)","group.button.create":"Gruppieren ({count})"},hb={"dialog.rename.title":"Umbenennen","dialog.rename.group.title":"Gruppe umbenennen","dialog.rename.catalog.title":"Katalogelement umbenennen","dialog.rename.label":"Neuer Name","dialog.rename.confirm":"Umbenennen","dialog.rename.cancel":"Abbrechen","dialog.promptEdit.title":"Prompt bearbeiten","dialog.promptEdit.nameLabel":"Name","dialog.promptEdit.contentLabel":"Inhalt","dialog.promptEdit.confirm":"Speichern","dialog.promptEdit.cancel":"Abbrechen","dialog.reset.title":"Canvas zurcksetzen","dialog.reset.message":"Mchten Sie den Canvas wirklich zurcksetzen? Alle nicht gespeicherten Arbeiten gehen verloren.","dialog.exit.title":"Projekt schlieen?","dialog.exit.message":"Sind Sie sicher? Nicht gespeicherte Daten gehen verloren.","dialog.settings.title":"Einstellungen","dialog.settings.apiKeyLabel":"Gemini API-Schlssel","dialog.settings.apiKeyPlaceholder":"Geben Sie Ihren Schlssel hier ein","dialog.settings.getApiKeyLink":"API-Schlssel von Google AI Studio erhalten","dialog.settings.useFreeKey":"Kostenlosen (limitierten) Schlssel nutzen","dialog.settings.save":"Speichern","dialog.settings.close":"Schlieen","dialog.apiKey.title":"API-Schlssel Einstellungen","dialog.apiKey.description":"Fr diese Anwendung wird ein Gemini API-Schlssel bentigt. Er wird lokal gespeichert.","dialog.apiKey.keyExists":"Ein API-Schlssel ist bereits gespeichert.","dialog.apiKey.clear":"Schlssel lschen","dialog.apiKey.save":"Schlssel speichern","dialog.apiKey.update":"Schlssel aktualisieren","dialog.apiKey.useFreeKey":"Kostenlosen Schlssel nutzen (Entwicklung)","dialog.permission.title":"Zugriff auf Zwischenablage","dialog.permission.description":'Diese Anwendung bentigt Zugriff auf die Zwischenablage fr die "Einfgen"-Funktion in Knoten.',"dialog.permission.decline":"Ablehnen","dialog.permission.allow":"Erlauben","alert.groupSaved":'Gruppe "{groupTitle}" im Katalog gespeichert!',"toast.groupSavedToDisk":'Gruppe "{groupTitle}" auf Datentrger gespeichert!',"alert.confirmDelete":"Mchten Sie dieses Element wirklich lschen?","alert.invalidCatalogFile":"Ungltige Katalogdatei.","alert.loadCatalogFailed":"Fehler beim Laden des Katalogelements","alert.confirmLoadProject":"Das Laden eines Projekts ersetzt alle aktuellen Daten. Sind Sie sicher?","dialog.confirmDelete.title":"Lschen besttigen","dialog.confirmDelete.message":'Sind Sie sicher, dass Sie "{itemName}" lschen mchten? Dies kann nicht rckgngig gemacht werden.',"dialog.confirmDelete.folderMessage":'Mchten Sie den Ordner "{itemName}" und seinen Inhalt wirklich lschen?',"dialog.confirmDelete.confirm":"Lschen","dialog.confirmDelete.cancel":"Abbrechen","dialog.confirmClear.title":"Canvas leeren besttigen","dialog.confirmClear.message":"Mchten Sie wirklich alles vom Canvas lschen?","toast.copied":"In Zwischenablage kopiert","toast.pasted":"Eingefgt!","toast.cleared":"Geleert","toast.resetComplete":"Zurckgesetzt","toast.projectSaved":"Projekt gespeichert","toast.canvasSaved":"Canvas auf Datentrger gespeichert","toast.saveFailed":"Speichern fehlgeschlagen","toast.connectionsCut":"Verbindungen getrennt","toast.charSaved":"Charakter gespeichert","toast.charLoaded":"Charakter geladen","toast.videoPasted":"Video aus Zwischenablage","toast.savedToCatalog":"In Katalog gespeichert","toast.apiKeySaved":"API-Schlssel gespeichert","toast.apiKeyCleared":"API-Schlssel gelscht","toast.projectLoaded":"Projekt geladen","alert.batchMismatch":"Warnung: Frame-Anzahl-Fehlanpassung in Szene {scene}."},mb={"instruction.desc.safe_gen":"KRITISCHE SICHERHEIT: Vermeiden Sie strikt Wrter, die KI-Sicherheitsfilter auslsen. Ersetzen Sie Begriffe wie 'teenager', 'intimate' oder 'revealing' durch knstlerische Alternativen wie 'young person', 'artistic composition' oder 'stylized'.","instruction.desc.layered_no_style":"Struktur: 1. [Globaler Hintergrund] -> 2. [Subjekt-Hierarchie] -> 3. [Kamera]. NIEMALS eine Aktion beschreiben, ohne zuerst den Charakter vollstndig zu beschreiben."},gb={"instruction.sg_inputs":"Eingabedaten","instruction.desc.sg_inputs":"Quelle: Konzept/Idee, Charakterprofile.","instruction.core_director":"Regisseur","instruction.desc.core_director":"Sie sind ein visionrer Filmregisseur. Denken Sie in Objektiven, Bewegung und Komposition.","instruction.sg_thinking":"Analysieren","instruction.desc.sg_thinking":"Logik und Kausalitt analysieren. Klischees eliminieren.","instruction.sg_improve_input":"Skript-Doktor","instruction.desc.sg_improve_input":"Konzept verbessern, Plotholes flicken, Konflikte schrfen.","instruction.sg_exposition":"Exposition","instruction.desc.sg_exposition":"Weltstatus durch Umgebungsdetails zeigen.","instruction.sg_delayed_reveal":"Enthllung","instruction.desc.sg_delayed_reveal":"Graduelle Einfhrung: Umgebung -> Detail -> Silhouette -> Gesicht.","instruction.sg_metaphor":"Metapher","instruction.desc.sg_metaphor":"Visuelle Symbole fr interne Zustnde.","instruction.sg_pacing":"Pacing","instruction.desc.sg_pacing":"Rhythmuskontrolle: Balance zwischen Ruhe und Dynamik.","instruction.sg_subtext":"Subtext","instruction.desc.sg_subtext":"Spannung zwischen Dialog und Aktion.","instruction.desc.sg_frame_estimation":"Geschtzte Anzahl der Einstellungen.","instruction.rule_visuals":"Visuals First","instruction.desc.rule_visuals":"Zeigen, nicht sagen. Fokus auf Licht, Komposition, Bewegung.","instruction.sg_visual_dna":"Visuelle DNA","instruction.desc.sg_visual_dna":"Technischer LookDev-Leitfaden (Licht, Linsen, Render-Stil).","instruction.rule_flow":"Nahtloser Fluss","instruction.desc.rule_flow":"Match Cut Logik: Formen/Farben fr bergnge nutzen.","instruction.rule_atmosphere":"Atmosphre","instruction.desc.rule_atmosphere":"Taktile Details: Geruch, Neon-Summen, Staub.","instruction.sg_visual_style":"Visueller Stil","instruction.desc.sg_visual_style":"Anfrage: Detaillierte Stilbeschreibung basierend auf '{style}'.","instruction.char_detailed_style":"Stilisierte Details","instruction.desc.char_detailed_style":"Integriert den globalen Stil in jeden Charakter-Prompt.","instruction.sg_genre":"Genre Kontext","instruction.desc.sg_genre":"Kontext: {genre}","instruction.char_smart_concept":"Smart Concept","instruction.desc.char_smart_concept":"KI whlt: Ganzkrper fr Charaktere / Fllend fr Objekte.","instruction.char_no_dupes":"Keine Duplikate","instruction.desc.char_no_dupes":"KRITISCH: Charaktere NICHT neu generieren, auer bei KOSTMWECHSEL.","instruction.create_secondary_chars":"Nebencharaktere","instruction.desc.create_secondary_chars":"Erlaubt Erstellung neuer Nebencharaktere bei Bedarf.","instruction.create_key_items":"Schlsselobjekte","instruction.desc.create_key_items":"Erstellung von 'Charakterkarten' fr wichtige Objekte.","instruction.char_secondary_ok":"Neue erlaubt","instruction.desc.char_secondary_ok":"Neue Charaktere oder Items erlaubt. Bei Outfit-Wechsel neue Karte erstellen.","instruction.sg_anthro":"Anthro","instruction.desc.sg_anthro":"Charaktere mssen anthropomorphe Tiere sein.","instruction.sg_no_chars":"Keine Charaktere","instruction.desc.sg_no_chars":"Doku-Stil / Keine benannten Charaktere.","instruction.sg_detailed_plot":"Detaillierter Plot","instruction.desc.sg_detailed_plot":"Sehr detaillierte Beschreibungen von Aktionen.","instruction.sg_subscribe":"Abo-Szene","instruction.desc.sg_subscribe":"Szene mit 4. Wand-Bruch zum Abonnieren.","instruction.char_gray_bg":"Visuelles Konzept","instruction.desc.char_gray_bg":"Fr jeden visuellen Prompt IMMER anhngen: ', full body character concept on a gray background'.","instruction.char_no_new":"Keine Neuen","instruction.desc.char_no_new":"KEINE neuen Charaktere erstellen. Nur existierende nutzen.","instruction.sg_new_chars":"Neue Charaktere","instruction.desc.sg_new_chars":"Generiere neue Charaktere basierend auf Prompt.","instruction.sg_living_world":"Lebendige Welt","instruction.desc.sg_living_world_simple":"Hintergrund-Statisten sind normale Menschen.","instruction.desc.sg_living_world_anthro":"Hintergrund-Statisten sind anthropomorphe Tiere.","instruction.sg_simple_actions":"Einfache Aktionen","instruction.desc.sg_simple_actions":"Vermeide komplexe Physik/Akrobatik. Bevorzuge stabile Posen.","instruction.commercial_safe":"Kommerziell Sicher","instruction.desc.commercial_safe":"Vermeidet strikt Marken (Disney, Pixar) und ersetzt sie durch generische Beschreibungen."},fb={"instruction.ana_role":"Analysator Rolle","instruction.desc.ana_role":"Sie sind ein Weltklasse-Regisseur. Schreiben Sie technische Anweisungen fr KI-Bild/Video-Generierung. Jeder Frame muss unabhngig und detailliert beschrieben werden.","instruction.ana_cinema":"Kinematographie","instruction.desc.ana_cinema":"Profi-Begriffe: Wide Shot, Close-up, Dutch Angle, Bokeh.","instruction.ana_cinema_wide":"Kinematographie (Weit)","instruction.desc.ana_cinema_wide":"Profi-Begriffe: Wide Shot, Long Shot. KEINE Nahaufnahmen.","instruction.ana_anthro_logic":"Anthro Logik","instruction.desc.ana_anthro_logic":"Charaktere explizit als anthropomorphe Tiere beschreiben.","instruction.ana_subscribe_logic":"Abo-Aufruf","instruction.desc.ana_subscribe_logic":'Visuelle Aktionen fr "Abonnieren": Schilder halten, 3D-Text.',"instruction.rule_hierarchy":"Master Framing Algorithmus","instruction.desc.rule_hierarchy":"Strikte Reihenfolge: 1. Global (Ort/Wetter). 2. Subjekt-Pose. 3. Objekt-Interaktion. 4. Aktion.","instruction.rule_living_world":"Lebendige Welt","instruction.desc.rule_living_world":"Hintergrund-Statisten passend zur Welt beschreiben.","instruction.desc.rule_living_world_anthro":"Hintergrund-Statisten mssen anthropomorphe Tiere sein.","instruction.rule_persistence":"Persistenz","instruction.desc.rule_persistence":"Chronologische Konsistenz der Szene wahren. Objekte und Positionen ber Frames hinweg verfolgen.","instruction.rule_mandatory_bg":"Pflicht-Hintergrund","instruction.desc.rule_mandatory_bg":"VERBOTEN, den Hintergrund leer zu lassen. Ort und Licht immer voll beschreiben.","instruction.desc.rule_mandatory_bg_wide":"VERBOTEN, den Hintergrund leer zu lassen. Bei Weitwinkel immer Geographie und Horizont beschreiben.","instruction.shot_filter_wide":"Nur Weitwinkel","instruction.desc.shot_filter_wide":"STRIKTER FILTER: Nur Wide (WS), Long (LS) und Medium (MS). Close-ups verboten.","instruction.storyboard_rules":"Shot-Vielfalt","instruction.desc.storyboard_rules":"Wechseln zwischen WS/LS, MS und CU/ECU fr Dynamik.","instruction.storyboard_rules_wide":"Shot-Vielfalt (Weit)","instruction.desc.storyboard_rules_wide":"Nur Weit, Lang und Establishing. Winkel variieren. KEINE Close-ups.","instruction.tech_directives":"Kamera-Kontrolle","instruction.desc.tech_directives":"Strikte Terminologie. Nur Abkrzungen (WS, MS, CU).","instruction.tech_directives_wide":"Kamera-Kontrolle (Weit)","instruction.desc.tech_directives_wide":"Strikte Terminologie. Nur WS, MS, LS. Kein CU/ECU.","instruction.use_aliases":"Aliase nutzen","instruction.desc.use_aliases":"Nutze Character-N Format.","instruction.action_phase_breakdown":"Mikro-Aktionen","instruction.desc.action_phase_breakdown":"Komplexe Aktionen in Phasen zerlegen (Vorbereitung, Start, Hhepunkt, Reaktion).","instruction.desc.action_phase_breakdown_wide":"Phasen zerlegen, aber KAMERA WEIT HALTEN. Wirkung durch Krperhaltung zeigen.","instruction.batch_processing":"Stapelverarbeitung","instruction.desc.batch_processing":"Alle Szenen als kontinuierliche Sequenz analysieren.","instruction.ana_prompt_lang":"Prompt-Sprache","instruction.desc.ana_prompt_lang":"Prompts strikt auf Englisch fr beste Kompatibilitt.","instruction.extended_visuals":"Erweiterte Visualisierung","instruction.desc.extended_visuals":"Zerlegt Szenen in expressive Sequenzen (Wide, MS, CU, Detail).","instruction.extended_visuals_wide":"Erweiterte Visualisierung (Weit)","instruction.desc.extended_visuals_wide":"Zerlegt Szenen in Sequenzen aus Weit/Mittel-Shots. Fokus auf Geographie.","instruction.desc.target_lang":"Analysesprache.","instruction.rule_isolation":"Null Kontext","instruction.desc.rule_isolation":"KRITISCH: Der Bildgenerator kennt den vorherigen Frame NICHT. Umgebung in jedem Frame neu beschreiben.","instruction.sensory_saturation":"Anti-Krze","instruction.desc.sensory_saturation":"VERBOTEN kurz zu sein. Beschreibe Texturen, Licht und physisches Gewicht.","instruction.ana_no_pov":"Kein POV","instruction.desc.ana_no_pov":'KRITISCHES NEGATIV: STRIKTES VERBOT von "POV" oder "First-Person"-Aufnahmen. Die Kamera MUSS extern sein.',"instruction.desc.static_frame_logic":'STRIKTES VERBOT von Bewegungsverben ("laufen"). Beschreibe einen EINGEFRORENEN Moment.',"instruction.desc.anatomical_posing":'Beschreibe Krper-GEOMETRIE. Statt "ausruhen" schreibe "Rckenlage, Arme seitlich".',"instruction.desc.motion_dynamics":"TRENNUNG: Image Prompt = 100% Statisch. Video Prompt = Bewegung & Zeit.","instruction.desc.anatomical_strictness":'RIGGING: "Arme hinter Kopf UND hlt Getrnk" verboten. Separat beschreiben: Linker Arm [Zustand], Rechter Arm [Zustand].',"instruction.desc.prop_consistency":'OBJEKT-LOCK: Keine generischen Nomen ("Schwert"). Visuelle Attribute ("rostiges Eisenschwert") mssen genannt und wiederholt werden.',"instruction.desc.subject_hierarchy":"Auch bei Close-ups: 1. Voller Charakter/Pose. 2. Interaktion mit Umgebung. 3. Detail.","instruction.inputs_data":"Eingaben","instruction.desc.inputs_data":"Quelldaten: Zusammenfassung, Profile, Szenentexte."},yb={"instruction.inputs":"Eingaben","instruction.desc.inputs":"Datenquelle: Analysator-Frames, Visuelle Profile, Szenenstil.","instruction.role":"Rolle: Lead Environment Artist","instruction.desc.role":"Sie sind Experte fr Prompt-Engineering. Synthetisieren Sie Eingaben zu einer definitiven visuellen Beschreibung.","instruction.layered":"Algorithmus: Einheitlicher Fluss","instruction.desc.layered":"Generiert einen EINZIGEN nahtlosen Textblock. Struktur: [Stil] -> [MASTER SET DESIGN] -> [Visuals] + [POSE & AKTION] -> [Kamera].","instruction.desc.layered_no_char":"Struktur: [MASTER SET DESIGN] -> [Aktion]. Lsst Aussehen weg, behlt nur Indizes und Aktionen.","instruction.visuals":"Stil: Sttigung","instruction.desc.visuals":"Nutze reiche visuelle Deskriptoren: volumetrisches Licht, 8k Texturen, Tiefenschrfe.","instruction.process_whole_scene":"Szenen-Stapel","instruction.desc.process_whole_scene":"Ganze Szene auf einmal analysieren fr Konsistenz.","instruction.video":"Video","instruction.desc.video":"Video Prompt: [Index] (Detail Visuell) [Aktion]. Dynamik: [Umgebung]. Kamera: [Bewegung]. KEINE NAMEN.","instruction.stateless":"Regel: Zustandslos","instruction.desc.stateless":"Jeder Frame ist unabhngig. Umgebung voll neu beschreiben. Aktion jedes Charakters von Grund auf neu beschreiben.","instruction.rule_static":"Regel: Statisch","instruction.desc.rule_static":"Beschreibe nur den eingefrorenen Moment. Keine bergnge.","instruction.atmosphere_fix":"Atmosphrischer Anker","instruction.desc.atmosphere_fix":"Beschreibe Stimmung als physikalische Eigenschaft von Luft und Licht.","instruction.subject_focus":"Kontext-Hierarchie","instruction.desc.subject_focus":"KRITISCH: Auch bei Close-ups: 1. Voller Charakter. 2. Pose. 3. Detail. Die KI braucht den Krperkontext.","instruction.always_env":"OBLIGATORISCHES SET-DESIGN","instruction.desc.always_env":'KRITISCH: Nutzen Sie den bereitgestellten "Szenen-Kontext" als ABSOLUTE WAHRHEIT fr den Hintergrund. Sie MSSEN die spezifischen Mbel, Beleuchtung und Texturen in die Umgebungsebene JEDES Prompts einfgen. Erfinden Sie keine generischen Hintergrnde.',"instruction.pm_anthro":"Anthro Detail","instruction.desc.pm_anthro":'PFLICHT: Wort "anthropomorphic" vor Spezies in Bild UND Video. Verbesserte Texturen/Anatomie.',"instruction.pm_subscribe":"Lesbarer Text","instruction.desc.pm_subscribe":'Sicherstellen, dass Text wie "SUBSCRIBE" lesbar und integriert ist (Neon, Schilder).',"instruction.strict_char_index":"Charaktere","instruction.desc.strict_char_index":"Charakter-Aliase (Character-N) strikt den Frame-Daten zuordnen.","instruction.no_names":"KRITISCH: KEINE NAMEN","instruction.desc.no_names":"KRITISCH: ABSOLUTES NAMENSVERBOT. Nur Index ID in eckigen Klammern `[Character-N]` nutzen.","instruction.general_char_desc":"Allgemeines Detail","instruction.desc.general_char_desc":"Eine PRGNANTE, ALLGEMEINE Version des visuellen Prompts integrieren.","instruction.full_char_desc":"Volles Detail","instruction.desc.full_char_desc":"Den VOLLSTNDIGEN visuellen Prompt des Profils exakt integrieren.","instruction.formatting":"Formatierung","instruction.desc.formatting":"Aktiviert explizite BERSCHRIFTEN und Zeilenumbrche fr Struktur.","instruction.anatomical_strictness":"Anatomie-Logik","instruction.desc.anatomical_strictness":'RIGGING: Verhindert "Arme hinter Kopf UND hlt Getrnk". Erzwingt separate Beschreibung.',"instruction.img_vid_consistency":"Img->Vid Fluss","instruction.desc.img_vid_consistency":"Image Prompt = Start/Statisch. Video Prompt = Aktion/Entwicklung. Video muss natrlich aus dem Bild entstehen.","instruction.desc.prop_enhancement":'MATERIALITT: Verstrkt Objektbeschreibungen (z.B. "rotes Brett" -> "glnzendes rotes Fiberglas").',"instruction.no_pov":"KRITISCH: KEIN POV","instruction.desc.no_pov":"STRIKTES VERBOT von POV-Winkeln. Kamera MUSS extern sein (Dritte Person)."},xb={"instruction.music_role":"Musikproduzenten-Rolle","instruction.desc.music_role":"Experten-Komponist und Texter.","instruction.music_input":"Eingabedaten","instruction.desc.music_input":"Thema oder Idee vom Benutzer.","instruction.music_creative":"Kreative Freiheit","instruction.desc.music_creative":"Zwingt KI, Stimmung metaphorisch zu interpretieren, nicht wrtlich.","instruction.music_lyrics":"Textstruktur","instruction.desc.music_lyrics":"Generiert Strophe/Refrain Struktur passend zum Genre.","instruction.music_prompt_rule":"KI Musik-Prompt","instruction.desc.music_prompt_rule":"Technische Tags fr Suno/Udio (BPM, Instrumente, Vocals). Max 1000 Zeichen.","instruction.music_format":"JSON Ausgabe","instruction.desc.music_format":"Strikte JSON-Struktur fr Integration."},vb={"instruction.yt_role":"YouTube-Stratege","instruction.desc.yt_role":"Experte fr SEO, CTR und virale Psychologie.","instruction.yt_input":"Eingabedaten","instruction.desc.yt_input":"Das Thema oder die Nische.","instruction.yt_title_mode":"Video-Metadaten","instruction.desc.yt_title_mode":"Optimiert Titel/Beschreibung/Tags fr maximale Klicks.","instruction.yt_channel_mode":"Kanal-Branding","instruction.desc.yt_channel_mode":"Erstellt konsistenten Namen, Bio und Handle.","instruction.yt_format":"JSON Ausgabe","instruction.desc.yt_format":"Strikte JSON-Struktur fr Integration."},bb={...mb,...gb,...fb,...yb,...xb,...vb},wb={...lb,...cb,...db,...ub,...pb,...hb,...bb},_b={"app.title":"Script Modifier","app.description":"Crez, affinez et gnrez visuellement des scnarios avec l'API Gemini.","app.slogan":"Connectez vos ides pour crer un chef-d'uvre","app.subtitle":"Visualisez vos scnarios","app.error.title":"Notification","app.error.copy":"Copier l'erreur","app.error.copied":"Copi !","error.quotaExceeded":"Vous avez atteint votre limite d'utilisation. Veuillez vrifier le quota de votre cl API ou ressayez plus tard.","error.apiKeyMissing":"Cl API introuvable. Veuillez dfinir votre cl API Gemini dans les paramtres.","error.freeKeyNotAvailable":"La cl API gratuite/dveloppement n'est pas disponible dans cet environnement. Veuillez fournir votre propre cl.","error.fileReadError":"Erreur lors de la lecture du fichier.","error.videoConversionError":"chec de la conversion de la vido en audio.","error.unsupportedFile":"Type de fichier non pris en charge.","error.promptModifierFile":"Ce fichier appartient  une autre application (Prompt Modifier). Veuillez l'ouvrir dans cette application.","error.invalidFileType":"Type de fichier invalide. Veuillez charger un fichier de projet ou de canevas Script Modifier.","welcome.iAmDeveloper":"Je suis dveloppeur","welcome.letsGo":"C'est parti !","welcome.resume":"Reprendre","welcome.reload":"Recharger","welcome.reloadTitle":"Rinitialiser et recharger ?","welcome.reloadMessage":"Cela effacera tout le canevas et rechargera l'application. Les donnes non sauvegardes seront perdues. tes-vous sr ?","welcome.confirmReload":"Rinitialiser et recharger","dialog.welcome.title":"Script Modifier","dialog.welcome.heading":"Bienvenue dans","dialog.welcome.intro1":"Bienvenue dans Script Modifier - votre espace de travail visuel pour crer des histoires avec Gemini.","dialog.welcome.intro2":"Pour commencer, veuillez slectionner votre langue et saisir votre cl API Gemini.","dialog.welcome.apiKeyExplanation":"Votre cl API est stocke localement dans votre navigateur. Nous ne l'envoyons  aucun serveur autre que l'API Google Gemini."},Cb={"toolbar.edit":"diter (V)","toolbar.cutter":"Couper la connexion (C)","toolbar.selection":"Outil de slection (S)","toolbar.reroute":"Point de dviation (R)","toolbar.zoom":"Zoom (Z)","toolbar.snapToGrid":"Aligner sur la grille (Shift+W)","toolbar.resetZoom":"Rinitialiser le zoom","toolbar.lineStyleSpaghetti":"Lignes Spaghetti (Shift+E)","toolbar.lineStyleOrthogonal":"Lignes Orthogonales (Shift+E)","toolbar.addNode":"Ajouter un nud (F)","toolbar.catalog":"Catalogue (Ctrl+Espace)","toolbar.settings":"Paramtres","toolbar.resetToDefault":"Rtablir par dfaut","toolbar.closeProject":"Fermer le projet / Effacer","toolbar.enterFullscreen":"Plein cran","toolbar.exitFullscreen":"Quitter le plein cran","toolbar.home":"Accueil","toolbar.addTextInput":"Entre de texte (T)","toolbar.addPromptAnalyzer":"Analyseur de Prompt (A)","toolbar.addCharacterAnalyzer":"Analyseur de Personnage","toolbar.addCharacterGenerator":"Gnrateur de Personnages (Shift+C)","toolbar.addImageGenerator":"Gnrateur d'Images (O)","toolbar.addImagePreview":"Aperu d'Image (I)","toolbar.addCharacterCard":"Fiche Personnage (Ctrl+Shift+C)","toolbar.addPromptProcessor":"Processeur de Prompt (P)","toolbar.addGeminiChat":"Gemini Chat (G)","toolbar.addTranslator":"Traducteur (L)","toolbar.addIdeaGenerator":"Gnrateur d'Ides (Shift+A)","toolbar.addScriptGenerator":"Gnrateur de Scnario (Shift+S)","toolbar.addScriptAnalyzer":"Analyseur de Scnario (Shift+D)","toolbar.addScriptPromptModifier":"Finaliseur de Prompt (Shift+F)","toolbar.addErrorAnalyzer":"Analyseur d'Erreurs","toolbar.addNote":"Note (N)","toolbar.addDataReader":"Lecteur de Donnes (Shift+R)","toolbar.addSpeechSynthesizer":"Synthtiseur Vocal (Shift+N)","toolbar.addNarratorTextGenerator":"Gnrateur de Texte Narrateur (Shift+G)","toolbar.addAudioTranscriber":"Transcripteur Audio (Shift+B)","toolbar.addYouTubeTitleGenerator":"Gnrateur de Titres YouTube (Shift+T)","toolbar.addMusicIdeaGenerator":"Gnrateur d'Ides Musicales (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube Analytics (Shift+Y)","toolbar.saveCanvas":"Sauvegarder le canevas (Ctrl+S)","toolbar.saveProject":"Sauvegarder le projet (Ctrl+Shift+S)","toolbar.loadCanvas":"Charger (Ctrl+O)","toolbar.clearCanvas":"Effacer le canevas","toolbar.group.general":"Gnral","toolbar.group.scripting":"Scnarisation","toolbar.group.prompting":"Prompts & Analyse","toolbar.group.characters":"Personnages","toolbar.group.ai":"Outils IA","toolbar.group.file":"Fichier","toolbar.group.images":"Images","toolbar.group.audio":"Audio","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"Contrles du canevas","toolbar.expand":"Dvelopper le panneau","toolbar.collapse":"Rduire le panneau","toolbar.toggleHeaders":"Basculer les en-ttes","hotkeys.file.title":"Fichier","hotkeys.file.save":"Sauvegarder le canevas (Ctrl+S)","hotkeys.file.saveProject":"Sauvegarder le projet (Ctrl+Shift+S)","hotkeys.file.load":"Charger le canevas (Ctrl+O)","hotkeys.tools.title":"Outils","hotkeys.tools.edit":"diter","hotkeys.tools.cutter":"Couper","hotkeys.tools.selection":"Slection","hotkeys.tools.reroute":"Dviation","hotkeys.tools.zoom":"Zoom","hotkeys.tools.group":"Grouper (G)","hotkeys.tools.deleteGroup":"Supprimer le groupe","hotkeys.tools.closeNode":"Fermer le nud","hotkeys.tools.toggleLineStyle":"Basculer le style de ligne","hotkeys.tools.snapToGrid":"Aligner sur la grille","hotkeys.tools.selectAll":"Tout slectionner","hotkeys.tools.deselectAll":"Tout dslectionner","hotkeys.tools.duplicate":"Dupliquer avec contenu","hotkeys.windows.title":"Fentres","hotkeys.windows.search":"Rechercher (F)","hotkeys.windows.quickAdd":"Ajout rapide (Espace)","hotkeys.windows.catalog":"Catalogue","hotkeys.createNode.title":"Crer un nud","hotkeys.hide":"Masquer les raccourcis","help.title":"Raccourcis clavier","hotkeys.show":"Afficher les raccourcis","search.placeholder":"Rechercher un nud...","search.noResults":"Aucun nud trouv.","search.node.text_input.title":"Entre de Texte","search.node.text_input.description":"Une zone de texte simple pour vos ides. (T)","search.node.prompt_processor.title":"Processeur de Prompt","search.node.prompt_processor.description":"Amliore et combine des prompts avec l'IA. (P)","search.node.prompt_analyzer.title":"Analyseur de Prompt","search.node.prompt_analyzer.description":"Divise un prompt en personnage et environnement. (A)","search.node.character_analyzer.title":"Analyseur de Personnage","search.node.character_analyzer.description":"Divise une description en personnage et vtements.","search.node.character_generator.title":"Gnrateur de Personnages","search.node.character_generator.description":"Cre des personnages dtaills  partir d'une ide. (Shift+C)","search.node.image_generator.title":"Gnrateur d'Images","search.node.image_generator.description":"Cre une image  partir d'un texte. (O)","search.node.image_preview.title":"Aperu d'Image","search.node.image_preview.description":"Affiche une image depuis un fichier. (I)","search.node.character_card.title":"Fiche Personnage","search.node.character_card.description":"Stocke l'image, le nom et le prompt d'un personnage. (Ctrl+Shift+C)","search.node.gemini_chat.title":"Gemini Chat","search.node.gemini_chat.description":"Discussion directe avec Gemini AI. (G)","search.node.translator.title":"Traducteur","search.node.translator.description":"Traduit le texte vers une langue slectionne. (L)","search.node.script_generator.title":"Gnrateur de Scnario","search.node.script_generator.description":"Transforme une ide en scnes de scnario. (Shift+S)","search.node.script_analyzer.title":"Analyseur de Scnario","search.node.script_analyzer.description":"Dcoupe un scnario en plans et prompts d'image. (Shift+D)","search.node.script_prompt_modifier.title":"Finaliseur de Prompt","search.node.script_prompt_modifier.description":"Finalise les prompts de l'analyse pour la gnration d'images. (Shift+F)","search.node.error_analyzer.title":"Analyseur d'Erreurs","search.node.error_analyzer.description":"Vrifie et corrige la grammaire et l'orthographe.","search.node.note.title":"Note","search.node.note.description":"Une zone de texte simple pour vos notes. (N)","search.node.reroute_dot.title":"Point de dviation","search.node.reroute_dot.description":"Un point pour rediriger et diviser les connexions.","search.node.data_reader.title":"Lecteur de Donnes","search.node.data_reader.description":"Affiche le texte brut d'une connexion.","search.node.speech_synthesizer.title":"Synthtiseur Vocal","search.node.speech_synthesizer.description":"Convertit le texte en parole. (Shift+N)","search.node.idea_generator.title":"Gnrateur d'Ides","search.node.idea_generator.description":"Gnre des catgories et les combine en une ide.","search.node.narrator_text_generator.title":"Gnrateur de Texte Narrateur","search.node.narrator_text_generator.description":"Gnre du texte pour un narrateur ou un annonceur. (Shift+G)","search.node.audio_transcriber.title":"Transcripteur Audio","search.node.audio_transcriber.description":"Convertit des fichiers audio/vido en texte. (Shift+B)","search.node.youtube_title_generator.title":"Gnrateur de Titres YouTube","search.node.youtube_title_generator.description":"Gnre des titres, descriptions et tags accrocheurs.","search.node.music_idea_generator.title":"Gnrateur d'Ides Musicales","search.node.music_idea_generator.description":"Gnre des paroles ou des prompts musicaux. (Shift+M)","search.node.youtube_analytics":"YouTube Analytics","search.node.youtube_analytics.description":"Analyse les stats de la chane et donne des conseils de croissance.","search.node.image_editor.title":"diteur d'Image","search.node.image_editor.description":"ditez des images avec l'IA (Inpainting, Outpainting).","search.group.input":"Entre","search.group.process":"Traitement & Analyse","search.group.scripting":"Scnarisation","search.group.character":"Outils Personnage","search.group.images":"Outils Image","search.group.ai":"Outils IA","search.group.audio":"Outils Audio","search.group.youtube":"Outils YouTube","contextMenu.tools":"Outils","contextMenu.assignSlot":"Assigner l'emplacement {index}","contextMenu.addNodeFromSlot":"Ajouter {node} ({index})","connectionMenu.title":"Ajouter un Nud","quickAddMenu.title":"Ajout Rapide","contextMenu.paste":"Coller (Ctrl+V)","node.content.simpleActions":"Actions Simples","node.content.smartConcept":"Smart Concept","tooltip.model.flash":"Gemini Flash: Rapide, efficace, bon pour les brouillons.","tooltip.model.pro":"Gemini Pro: Haute intelligence, raisonnement complexe, dtaill.","tooltip.lang.ru":"Gnrer le scnario en Russe.","tooltip.lang.en":"Gnrer le scnario en Anglais.","tooltip.lang.es":"Gnrer le scnario en Espagnol.","tooltip.lang.de":"Gnrer le scnario en Allemand.","tooltip.lang.uz":"Gnrer le scnario en Ouzbek.","tooltip.lang.fr":"Gnrer le scnario en Franais.","tooltip.lang.it":"Gnrer le scnario en Italien.","tooltip.lang.pt":"Gnrer le scnario en Portugais.","tooltip.lang.zh":"Gnrer le scnario en Chinois.","node.action.locateInStack":"Localiser dans la pile","help.tabs.hotkeys":"Aide & Raccourcis","help.tabs.links":"Autres Apps & Liens","help.category.socials":"Rseaux Sociaux","help.category.stable":"Google AI Studio (Stable)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":"Web / Netlify","help.category.github":"Dpts GitHub","help.link.youtube":"Chane YouTube","help.link.telegram_channel":"Chane Telegram","help.link.telegram_chat":"Chat Telegram","help.sub.news":"Nouvelles & Mises  jour","help.sub.discussion":"Discussion","help.sub.stable":"Version Stable","help.sub.alpha":"Version Alpha","languages.ru":"Russe","languages.en":"Anglais","languages.es":"Espagnol","languages.fr":"Franais","languages.de":"Allemand","languages.it":"Italien","languages.pt":"Portugais","languages.zh":"Chinois","languages.ja":"Japonais","languages.ko":"Coren","languages.uz":"Ouzbek"},Sb={"node.title.text_input":"Entre de Texte","node.title.prompt_processor":"Processeur de Prompt","node.title.prompt_analyzer":"Analyseur de Prompt","node.title.character_analyzer":"Analyseur de Personnage","node.title.character_generator":"Gnrateur de Personnages","node.title.image_generator":"Gnrateur d'Images","node.title.image_preview":"Aperu d'Image","node.title.character_card":"Fiche Personnage","node.title.gemini_chat":"Gemini Chat","node.title.translator":"Traducteur","node.title.script_generator":"Gnrateur de Scnario","node.title.script_analyzer":"Analyseur de Scnario","node.title.script_prompt_modifier":"Finaliseur de Prompt","node.title.error_analyzer":"Analyseur d'Erreurs","node.title.note":"Note","node.title.reroute_dot":"Point de dviation","node.title.data_reader":"Lecteur de Donnes","node.title.speech_synthesizer":"Synthtiseur Vocal","node.title.idea_generator":"Gnrateur d'Ides","node.title.narrator_text_generator":"Gnrateur de Texte Narrateur","node.title.audio_transcriber":"Transcripteur Audio","node.title.youtube_title_generator":"Gnrateur de Titres YouTube","node.title.music_idea_generator":"Gnrateur d'Ides Musicales","node.title.youtube_analytics":"YouTube Analytics","node.title.image_editor":"diteur d'Image","node.help.text_input":"Entrez des ides de base ou des descriptions ici.","node.help.prompt_processor":"Combine le texte d'autres nuds en un prompt dtaill.","node.help.prompt_analyzer":"Divise un prompt en environnement, personnage, action et style.","node.help.character_analyzer":"Divise une description de personnage en physique et vtements.","node.help.character_generator":"Cre des descriptions dtailles de personnages  partir d'une ide.","node.help.image_generator":"Gnre une image  partir d'un texte avec l'API Gemini.","node.help.image_preview":"Affiche une image. Glissez-dposez un fichier dessus.","node.help.character_card":"Stocke l'image, le nom et le prompt d'un personnage.","node.help.gemini_chat":"Conversation directe avec Gemini AI.","node.help.translator":"Traduit le texte entrant dans la langue slectionne.","node.help.script_generator":"Gnre des scnes de scnario  partir d'un prompt.","node.help.script_analyzer":"Dcoupe un scnario en plans et prompts d'image.","node.help.script_prompt_modifier":"Cre des prompts artistiques finaux pour chaque plan.","node.help.error_analyzer":"Vrifie et corrige l'orthographe et la grammaire.","node.help.note":"Une zone de texte simple pour vos notes.","node.help.reroute_dot":"Un point pour rediriger les connexions.","node.help.data_reader":"Affiche les donnes brutes d'un nud connect.","node.help.speech_synthesizer":"Convertit le texte en parole.","node.help.idea_generator":"Gnre des catgories et les combine en une ide.","node.help.narrator_text_generator":"Gnre du texte pour un narrateur ou annonceur.","node.help.audio_transcriber":"Convertit des fichiers audio/vido en texte.","node.help.youtube_title_generator":"Gnre des titres, descriptions et tags pour YouTube.","node.help.music_idea_generator":"Gnre des paroles ou des prompts musicaux.","node.help.youtube_analytics":"Analyse les stats de la chane et donne des conseils.","node.help.image_editor":"ditez des images avec l'IA (Inpainting, Outpainting).","node.action.help":"Aide","node.action.expand":"Dvelopper","node.action.collapse":"Rduire (H)","node.action.expandAll":"Tout dvelopper","node.action.collapseAll":"Tout rduire","node.action.expandAllScenes":"Dvelopper toutes les scnes","node.action.collapseAllScenes":"Rduire toutes les scnes","node.action.expandAllFrames":"Dvelopper tous les plans","node.action.collapseAllFrames":"Rduire tous les plans","node.action.expandPanel":"Dvelopper le panneau","node.action.collapsePanel":"Rduire le panneau","node.action.togglePanel":"Basculer le panneau","node.action.collapseScene":"Rduire la scne","node.action.expandScene":"Dvelopper la scne","node.action.collapseFrame":"Rduire le plan","node.action.expandFrame":"Dvelopper le plan","node.action.collapseCharacter":"Rduire le personnage","node.action.expandCharacter":"Dvelopper le personnage","node.action.clear":"Effacer","node.action.clearTooltip":"Effacer le champ.","node.action.clearChat":"Effacer le chat","node.action.paste":"Coller","node.action.copy":"Copier","node.action.duplicateWithContent":"Dupliquer (Contenu)","node.action.duplicateEmpty":"Dupliquer (Vide)","node.action.cutConnections":"Couper les connexions","node.action.close":"Fermer","node.action.executeChain":"Excuter la chane","node.action.executeFullChain":"Excuter toute la chane","node.action.processChainForward":"Traiter la chane vers l'avant","node.action.executeChainTitle":"Excuter tous les nuds connects.","node.action.addCharacter":"Ajouter un personnage","node.action.addScene":"Ajouter une scne","node.action.addFrame":"Ajouter un plan","node.action.addFirstFrame":"Ajouter le premier plan","node.action.deleteItem":"Supprimer","node.action.moveUp":"Monter","node.action.moveDown":"Descendre","node.action.saveImage":"Sauvegarder l'image","node.action.loadImage":"Charger une image","node.action.saveCharacter":"Sauvegarder le personnage","node.action.loadCharacter":"Charger un personnage","node.action.readData":"Lire les donnes","node.action.refreshData":"Actualiser les donnes","node.action.stop":"Arrter","node.action.stopping":"Arrt...","node.action.embedCharacter":"Intgrer le personnage","node.action.downloadFinalPrompts":"Tlcharger les prompts","node.action.rename":"Renommer","node.action.index":"Indexer","node.action.improveConcept":"Amliorer le concept","node.action.improveConceptTooltip":"Enrichir et ajouter des dtails visuels.","node.action.downloadJson":"Tlcharger JSON","node.action.downloadSRT":"Tlcharger SRT","node.action.markPrimary":"Marquer comme Principal","node.input.default":"Entre","node.output.default":"Sortie","node.output.allCharacters":"Tous les Personnages","node.output.primaryCharacter":"Personnage Principal","node.content.action":"Action","node.content.actionPlaceholder":"Prompt d'action...","node.content.allScriptParts":"Toutes les parties du scnario","node.content.allScriptAnalyzerData":"Donnes de l'analyseur","node.content.allNarratorData":"Toutes les donnes du narrateur","node.content.analyzeCharacters":"Analyser les personnages","node.content.analyzeFromScene":"Analyser de:","node.content.analyzeUpToScene":"","node.content.endPlaceholder":"fin","node.content.generateFromFrame":"Gnrer depuis le plan:","node.content.generateUpToFrame":"jusqu'au plan","node.content.analyzeFromFrame":"Finaliser depuis le plan:","node.content.processFromFrame":"Traiter depuis le plan:","node.content.processFromScene":"Traiter depuis la scne:","node.content.analyzePrompt":"Analyser le prompt","node.content.analyzeScript":"Analyser le scnario","node.content.analyzing":"Analyse...","node.content.applyAliases":"Appliquer les alias","node.content.applyAliasesTooltip":"Remplace les noms par des alias (Index).","node.content.character":"Personnage","node.content.characterIndex":"Index","node.content.characterPlaceholder":"Prompt du personnage...","node.content.character_plural":"personnages","node.content.characters":"Personnages","node.content.charactersSynced":"Personnages synchroniss","node.content.noCharactersConnected":"Aucun personnage connect.","node.content.appearance":"Apparence","node.content.personality":"Personnalit","node.content.characterType":"Type","node.content.characterTypeShort":"Type","node.content.characterType.simple":"Simple","node.content.characterType.anthro":"Anthro (Animaux)","node.content.characterType.chibi":"Chibi (Mignon)","node.content.characterType.key_item":"Objet Cl","node.content.style":"Style","node.content.style.none":"Aucun","node.content.style.simple":"Simple","node.content.style.realistic":"Raliste/Cinma","node.content.style.3d_cartoon":"Cartoon 3D","node.content.style.3d_realistic":"3D Raliste","node.content.style.2d_animation":"Animation 2D","node.content.style.anime":"Anime","node.content.style.comics":"Comics","node.content.style.custom":"Spcial","node.content.chatPlaceholder":"Tapez un message...","node.content.clothing":"Vtements","node.content.clothingPlaceholder":"Prompt des vtements...","node.content.connectedPlaceholder":"Connect","node.content.dataPlaceholder":"Les donnes apparatront ici...","node.content.readData":"Lire les donnes","node.content.reading":"Lecture...","node.content.description":"Description","node.content.sceneDescription":"Description de la scne","node.content.duration":"Dure","node.content.enhancePrompt":"Gnrer le prompt","node.content.enhancedPromptHere":"Le prompt amlior apparatra ici...","node.content.enhancing":"Amlioration...","node.content.environment":"Environnement","node.content.environmentPlaceholder":"Prompt de l'environnement...","node.content.environmentPrompt":"Environnement & Arrire-plan","node.content.compositionAndBlocking":"Composition & Action","node.content.executingChain":"Chane en cours...","node.content.imagePrompt":"Prompt Image","node.content.finalPrompt":"Prompt Final","node.content.finalPrompt_plural":"Prompts Finaux","node.content.fixErrors":"Corriger les erreurs","node.content.fixingErrors":"Correction...","node.content.frame":"Plan","node.content.frame_plural":"plans","node.content.frames":"Plans de sortie","node.content.frames_analyzed":"Plans analyss : {count}","node.content.framesPerScene":"Plans par scne","node.content.minFrames":"Min","node.content.maxFrames":"Max","node.content.numberOfCharactersShort":"Qt","node.content.fullDescription":"Description complte","node.content.generateCharacters":"Gnrer les personnages","node.content.generateFinalPrompts":"Gnrer prompts finaux","node.content.generatingProgress":"Gnration {current} sur {total}","node.content.generateImage":"Gnrer l'image","node.content.generateScript":"Gnrer le scnario","node.content.generateSpeech":"Gnrer la parole","node.content.generateText":"Gnrer le texte","node.content.generateSSML":"Gnrer SSML","node.content.generateStyle":"Gnrer le style","node.content.generating":"Gnration...","node.content.improving":"Amlioration...","node.content.generatedAudio":"Audio gnr","node.content.imagePromptPlaceholder":"Entrez un prompt pour l'image...","node.content.modificationPromptPlaceholder":"Demande de modification...","node.content.narrator":"Narrateur","node.content.narratorEnabled":"Activer le narrateur","node.content.narratorEnabledInfo":"Ajoute un texte de voix off.","node.content.narratorMode":"Mode Narrateur","node.content.narratorMode.normal":"Normal / Voix off","node.content.narratorMode.dual":"Deux Narrateurs","node.content.narratorMode.first_person":"Premire Personne","node.content.role":"Rle","node.content.role.narrator":"Narrateur","node.content.role.announcer":"Annonceur","node.content.role.first_person":"Premire Personne","node.content.role.dual_narrator":"Deux Narrateurs","node.content.role.dual_announcer":"Deux Annonceurs","node.content.scene":"Scne","node.content.scene_plural":"scnes","node.content.scenes":"Scnes","node.content.scenes_generated":"Scnes gnres : {count}","node.content.sceneContext":"Contexte de la scne","node.content.sceneContextPlaceholder":"Ambiance, environnement, lumire...","node.content.scriptPromptPlaceholder":"Entrez une ide d'histoire...","node.content.seconds":"sec","node.content.stylePlaceholder":"Prompt de style...","node.content.stylePromptPlaceholder":"Entrez le prompt de style ici...","node.content.styleOverride":"Remplacer le style","node.content.summary":"Rsum","node.content.targetLanguage":"Langue Cible","node.content.textToSynthesize":"Texte  synthtiser...","node.content.translate":"Traduire","node.content.translatePlaceholder":"Texte  traduire...","node.content.translatedTextPlaceholder":"Le texte traduit apparatra ici...","node.content.translating":"Traduction...","node.content.useExistingCharacters":"Utiliser persos existants","node.content.useExistingCharactersInfo":"Utilise les donnes des personnages connects.","node.content.createKeyItem":"Crer Secondaire/Objets","node.content.createSecondaryChars":"Personnages Secondaires","node.content.createKeyItems":"Objets Cls","node.content.createKeyItemInfo":"Permet  l'IA de crer des personnages secondaires ou des objets.","node.content.noCharacters":"Sans Personnages","node.content.noCharactersInfo":"Focus sur les vnements et l'atmosphre (style documentaire).","node.content.videoPrompt":"Dynamique & Mouvement","node.content.videoPrompts":"Prompts Vido","node.content.voice":"Voix","node.content.previewVoice":"Tester la voix","node.content.voicePreviewText":"Bonjour, ceci est un test de voix.","node.content.inputScripts":"Scnes d'entre","node.content.inputFrames":"Plans d'entre","node.content.outputScript":"Scnes de sortie","node.content.requestCategories":"Demander des catgories","node.content.generateIdea":"Gnrer l'ide","node.content.requestNewCategories":"Nouvelles catgories","node.content.category.action":"Action","node.content.category.place":"Lieu","node.content.category.obstacle":"Obstacle","node.content.generatedIdea":"Ide Gnre","node.content.storyFormat":"Format de l'histoire","node.content.theme":"Thme","node.content.parameters":"Paramtres","node.content.advancedMode":"Mode Avanc","node.content.numberOfScenes":"Nombre de scnes","node.content.numberOfScenes.auto":"Auto","node.content.detailedPlot":"Intrigue Dtaille","node.content.detailedPlotInfo":"Active les descriptions dtailles.","node.content.includeSubscribeScene":"Scne d'abonnement","node.content.includeSubscribeSceneInfo":"Ajoute une scne demandant de s'abonner.","node.content.genre":"Genre","node.content.genre2":"Genre 2","node.content.breakIntoParagraphs":"Paragraphes","node.content.copyVideoPrompt":"Copier le prompt vido","node.content.generateVideoPrompt":"Gnrer prompt vido","node.content.model":"Modle","node.content.processWholeScene":"Traiter toute la scne","node.content.processWholeSceneInfo":"Traite tous les plans d'une scne en une fois pour la cohrence.","node.content.batchProcessing":"Traitement par lots","node.content.batchProcessingInfo":"Traiter toutes les scnes slectionnes dans une seule fentre contextuelle.","node.content.extendedAnalysis":"Analyse tendue","node.content.extendedAnalysisInfo":"Divise les scnes en plans dtaills.","node.content.professionalStoryboard":"Storyboard Ralisateur","node.content.professionalStoryboardInfo":"Analyse selon les rgles du langage cinmatographique.","node.content.generateStartEndFrames":"Gnrer plans dbut/fin","node.content.autoIndexCharacters":"Auto-indexer Personnages","node.content.autoIndexCharactersInfo":"Remplace automatiquement les noms par des alias.","node.content.imageToText":"Image vers Texte","node.content.extracting":"Extraction...","node.content.extractedText":"Texte Extrait","node.content.activePromptStack":"Pile de Prompts Active","node.content.noCharactersAnalyzed":"Aucun personnage analys.","node.content.promptsGeneratedPlaceholder":"Les prompts gnrs apparatront ici.","node.content.noCharactersInScript":"Pas de personnages dans le script.","node.content.noInputScenes":"Aucune donne. Connectez un Gnrateur de Scnario.","node.content.status":"Statut","node.content.status.ready":"Prt","node.content.status.paused":"En pause","node.content.status.generating":"Gnration","node.content.status.total":"Total : {generated} / {total}","node.content.status.batch":"Traitement : {current} sur {total}","node.content.status.time":"Temps : {current}s / {total}s","node.content.refreshing":"Actualisation...","node.content.totalFrames":"Total Plans : {count}","node.content.uploadAudio":"Uploader Audio/Vido","node.content.noAudioLoaded":"Aucun audio","node.content.audioLoaded":"Audio charg","node.content.transcriptionPlaceholder":"La transcription apparatra ici...","node.content.transcribe":"Transcrire","node.content.transcribing":"Transcription...","node.content.convertingVideo":"Conversion vido...","node.content.recommendedFrames":"Plans Estims","node.content.shotType":"Plan","node.content.shotType.ws":"WS (Large)","node.content.shotType.ms":"MS (Moyen)","node.content.shotType.cu":"CU (Gros Plan)","node.content.shotType.ecu":"ECU (Trs Gros Plan)","node.content.shotType.ls":"LS (Plan d'ensemble)","node.content.characterDetail":"Dtails du personnage","node.content.noCharDesc":"Pas de description de personnage","node.content.includeGeneralCharDesc":"Description visuelle gnrale","node.content.includeFullCharDesc":"Description visuelle dtaille","node.content.safeGeneration":"Gnration Sre","node.content.shotFilter":"Filtre de Plan","node.content.shotFilter.all":"Tous","node.content.shotFilter.wideOnly":"Large Uniquement","instruction.desc.shot_filter_all":"Autoriser tous les types de plans (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Restreindre aux plans larges (WS, MS, LS). Gros plans interdits.","node.content.anthroEnabled":"Animaux Anthropomorphes","node.content.subscribeEnhancement":"Renforcer Appel Abonnement","node.content.thinkingEnabled":"Mode Rflexion","node.content.scenelessMode":"Scnes sans script","instruction.desc.sceneless_mode":"Dsactiver le moteur narratif. Gnrer les scnes directement depuis le concept.","instruction.sceneless_mode":"Mode Liste de Scnes","node.content.microActionBreakdown":"Micro-Actions","node.content.microActionBreakdownInfo":"Dcompose les actions complexes en phases (Prparation, Action, Raction).","node.content.commercialSafe":"Sr pour le Commerce","instruction.desc.commercial_safe":"vite strictement les marques dposes (Disney, Pixar) et les remplace par des descriptions gnriques.","node.content.findStack":"Trouver dans la pile...","node.content.spm_stack.priming":"1. Amorage et Contexte","node.content.spm_stack.physics":"2. Physique et Logique","node.content.spm_stack.hierarchy":"3. Hirarchie du Sujet","node.content.spm_stack.construction":"4. Construction et Format"},Tb={"genre.general":"Gnral","genre.comedy":"Comdie","genre.drama":"Drame","genre.action":"Action","genre.scifi":"Science-Fiction","genre.fantasy":"Fantaisie","genre.horror":"Horreur","genre.thriller":"Thriller","genre.childrens_animation":"Animation pour enfants","genre.shorts_story":"Histoires courtes (Shorts)","genre.scientific_historical":"Scientifique-Historique","character_generator.promptPlaceholder":'Entrez une ide, ex: "chevalier courageux, gardien de la fort ancienne"',"idea_generator.randomTheme":"Thme alatoire","idea_generator.randomCombination":"Combinaison alatoire","idea_generator.themePlaceholder":"ex. Espace, Cuisine, Fort Enchante","idea_generator.initialMessage":'Entrez un thme (optionnel) et cliquez sur "{buttonName}".',"idea_generator.ideaPlaceholder":"L'ide gnre apparatra ici...","idea_generator.format.general":"Gnral","idea_generator.format.childrens":"Enfants","idea_generator.format.adventure":"Aventure","idea_generator.format.fantasy":"Fantaisie / Magie","idea_generator.format.detective":"Dtective","idea_generator.format.scifi":"Sci-Fi","idea_generator.format.horror":"Horreur","idea_generator.format.historical":"Historique","gender.male":"Homme","gender.female":"Femme","node.content.autoDownload":"Tlchargement auto  la gnration","node.content.downloadSelected":"Tlcharger la slection","node.content.intonation":"Intonation","intonation.standard":"Standard","intonation.cheerful":"Joyeux","intonation.angry":"En colre","intonation.sad":"Triste","intonation.excited":"Excit","intonation.announcer":"Annonceur","intonation.whispering":"Chuchotement","node.content.sceneMode":"Mode Scne","node.content.connectNarratorData":'Connectez "Toutes les donnes du narrateur" depuis un Gnrateur de Scnario.',"node.content.sceneModeActive":"Mode Scne actif. Donnes reues.","speech_synthesizer.mode.simple":"Simple","speech_synthesizer.mode.scene":"Scne","speech_synthesizer.multiSpeaker":"Deux Locuteurs","speech_synthesizer.speaker1Name":"Nom Locuteur 1","speech_synthesizer.speaker2Name":"Nom Locuteur 2","speech_synthesizer.multiSpeakerHint":'Les noms doivent correspondre  ceux du texte (ex. "Homme: ...", "Femme: ...").',"speech_synthesizer.ssmlHint":"L'intonation est contrle par des balises SSML dans le texte.","youtube_analytics.authorName":"Nom de l'auteur","youtube_analytics.videoTitle":"Titre de la vido","youtube_analytics.views":"Vues","youtube_analytics.addToChannel":"Ajouter  la chane","youtube_analytics.noIncomingData":"Pas de donnes entrantes.","youtube_analytics.videoAdded":"Vido ajoute !","youtube_analytics.dragDrop":"Dposez une capture d'cran ici","youtube_analytics.thumbnailUpdated":"Miniature mise  jour","youtube_analytics.statsTrend":"Tendance Statistique","youtube_analytics.currentChannel":"Chane Actuelle","youtube_analytics.growth":"Croissance","youtube_analytics.allChannels":"Toutes les chanes","youtube_analytics.saveDisk":"Sauver sur Disque","youtube_analytics.saveCatalog":"Sauver au Catalogue","youtube_analytics.loadDisk":"Charger du Disque","youtube_analytics.analyzing":"Analyse...","youtube_analytics.askAI":"Demander  l'IA","youtube_analytics.clickForAdvice":`Cliquez sur "Demander  l'IA".`,"youtube_analytics.dailyNotes":"Notes Quotidiennes","youtube_analytics.logDailyStats":"Enreg. Stats","youtube_analytics.subscribers":"Abonns","youtube_analytics.totalViews":"Vues Totales","youtube_analytics.updateStats":"Mettre  jour","youtube_analytics.history":"Historique","youtube_analytics.noHistory":"Aucun historique.","youtube_analytics.noNotes":"Aucune note.","youtube_analytics.noVideos":"Aucune vido.","youtube_analytics.loadedFromDisk":"Charg","youtube_analytics.loadFailed":"chec du chargement","youtube_analytics.savedToDisk":"Sauvegard","youtube_title_generator.mode.title":"Titre Vido","youtube_title_generator.mode.channel":"Info Chane","youtube_title_generator.ideaPlaceholder":"Entrez une ide de vido...","youtube_title_generator.channelIdeaPlaceholder":"Entrez un thme de chane...","youtube_title_generator.title":"Titre","youtube_title_generator.description":"Description","youtube_title_generator.tags":"Tags","youtube_title_generator.channelName":"Nom de la Chane","youtube_title_generator.channelDescription":"Description de la Chane","youtube_title_generator.channelKeywords":"Mots-cls","youtube_title_generator.channelHandle":"Identifiant (@)","music_idea_generator.mode.lyrics":"Paroles","music_idea_generator.mode.music_prompt":"Prompt Musical","music_idea_generator.ideaPlaceholder":"Entrez un thme ou une humeur...","music_idea_generator.songTitle":"Titre de la Chanson","music_idea_generator.songTitlePlaceholder":"Titre...","music_idea_generator.lyricsPlaceholder":"Les paroles apparatront ici...","music_idea_generator.musicPromptPlaceholder":"Le prompt musical IA apparatra ici...","chat.mode.general":"Gnral","chat.mode.script":"Expert Scnario","chat.mode.prompt":"Expert Prompt","chat.mode.youtube":"Expert YouTube"},Eb={"catalog.title":"Catalogue","catalog.tabs.groups":"Groupes","catalog.tabs.library":"Bibliothque de Prompts","catalog.tabs.characters":"Personnages","catalog.tabs.scripts":"Scnarios","catalog.tabs.analysis":"Analyses","catalog.tabs.final_prompts":"Prompts Finaux","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"Ides Musicales","catalog.empty.title":"Le catalogue est vide","catalog.empty.description":"Sauvegardez un lment pour le voir ici, ou importez-en un.","catalog.loadFromFile":"Charger depuis un fichier","catalog.card.addToCanvas":"Ajouter au canevas","catalog.card.rename":"Renommer","catalog.card.save":"Sauvegarder sur disque","catalog.card.delete":"Supprimer","library.loadFromFile":"Charger depuis un fichier","library.empty.title":"Le dossier est vide","library.empty.description":"Crez un nouveau dossier ou prompt.","library.emptyPrompt":"Pas de contenu","library.actions.newFolder":"Nouveau Dossier","library.actions.newPrompt":"Nouveau Prompt","library.actions.copy":"Copier dans le presse-papiers","library.actions.edit":"diter le Prompt","group.rename":"Renommer le groupe","group.saveToCatalog":"Sauvegarder dans le catalogue","group.saveToDisk":"Sauvegarder sur disque","group.ungroup":"Dissocier (Shift+Clic pour supprimer)","group.button.create":"Grouper ({count})"},Nb={"dialog.rename.title":"Renommer","dialog.rename.group.title":"Renommer le Groupe","dialog.rename.catalog.title":"Renommer l'lment","dialog.rename.label":"Nouveau nom","dialog.rename.confirm":"Renommer","dialog.rename.cancel":"Annuler","dialog.promptEdit.title":"diter le Prompt","dialog.promptEdit.nameLabel":"Nom","dialog.promptEdit.contentLabel":"Contenu","dialog.promptEdit.confirm":"Sauvegarder","dialog.promptEdit.cancel":"Annuler","dialog.reset.title":"Rinitialiser le canevas","dialog.reset.message":"tes-vous sr de vouloir rinitialiser le canevas ? Tout travail non sauvegard sera perdu.","dialog.exit.title":"Fermer le projet ?","dialog.exit.message":"tes-vous sr ? Les donnes non sauvegardes seront perdues.","dialog.settings.title":"Paramtres","dialog.settings.apiKeyLabel":"Cl API Gemini","dialog.settings.apiKeyPlaceholder":"Entrez votre cl ici","dialog.settings.getApiKeyLink":"Obtenir une cl API sur Google AI Studio","dialog.settings.useFreeKey":"Utiliser la cl gratuite (limite)","dialog.settings.save":"Sauvegarder","dialog.settings.close":"Fermer","dialog.apiKey.title":"Paramtres de la Cl API","dialog.apiKey.description":"Une cl API Gemini est requise. Elle sera stocke localement.","dialog.apiKey.keyExists":"Une cl API est dj enregistre.","dialog.apiKey.clear":"Effacer la cl","dialog.apiKey.save":"Sauvegarder la cl","dialog.apiKey.update":"Mettre  jour la cl","dialog.apiKey.useFreeKey":"Utiliser la cl gratuite (Dev)","dialog.permission.title":"Accs au presse-papiers","dialog.permission.description":`Cette application ncessite l'accs au presse-papiers pour la fonction "Coller".`,"dialog.permission.decline":"Refuser","dialog.permission.allow":"Autoriser","alert.groupSaved":'Groupe "{groupTitle}" sauvegard dans le catalogue !',"toast.groupSavedToDisk":'Groupe "{groupTitle}" sauvegard sur disque !',"alert.confirmDelete":"Voulez-vous vraiment supprimer cet lment ?","alert.invalidCatalogFile":"Fichier de catalogue invalide.","alert.loadCatalogFailed":"chec du chargement de l'lment","alert.confirmLoadProject":"Le chargement d'un projet remplacera toutes les donnes actuelles. tes-vous sr ?","dialog.confirmDelete.title":"Confirmer la suppression","dialog.confirmDelete.message":'tes-vous sr de vouloir supprimer "{itemName}" ? Cette action est irrversible.',"dialog.confirmDelete.folderMessage":'tes-vous sr de vouloir supprimer le dossier "{itemName}" et son contenu ?',"dialog.confirmDelete.confirm":"Supprimer","dialog.confirmDelete.cancel":"Annuler","dialog.confirmClear.title":"Confirmer l'effacement","dialog.confirmClear.message":"Voulez-vous vraiment tout supprimer du canevas ?","toast.copied":"Copi dans le presse-papiers","toast.pasted":"Coll !","toast.cleared":"Effac","toast.resetComplete":"Rinitialis","toast.projectSaved":"Projet sauvegard","toast.canvasSaved":"Canevas sauvegard sur disque","toast.saveFailed":"chec de la sauvegarde","toast.connectionsCut":"Connexions coupes","toast.charSaved":"Personnage sauvegard","toast.charLoaded":"Personnage charg","toast.videoPasted":"Vido colle depuis le presse-papiers","toast.savedToCatalog":"Sauvegard dans le catalogue","toast.apiKeySaved":"Cl API sauvegarde","toast.apiKeyCleared":"Cl API efface","toast.projectLoaded":"Projet charg","alert.batchMismatch":"Attention : Inadquation du nombre de plans dans la scne {scene}."},kb={"instruction.desc.safe_gen":"SCURIT CRITIQUE : vitez strictement les mots dclenchant les filtres de scurit IA. Remplacez des termes comme 'adolescent', 'intime' ou 'rvlateur' par des alternatives artistiques comme 'jeune personne', 'composition artistique' ou 'stylis'.","instruction.desc.layered_no_style":"Structure : 1. [Arrire-plan Global] -> 2. [Hirarchie du Sujet] -> 3. [Camra]. NE JAMAIS dcrire une action sans d'abord dcrire le personnage complet."},Ab={"instruction.sg_inputs":"Donnes d'entre","instruction.desc.sg_inputs":"Source : Concept/Ide, Profils de Personnages.","instruction.core_director":"Ralisateur","instruction.desc.core_director":"Vous tes un Ralisateur Visionnaire. Pensez en objectifs, mouvement et composition.","instruction.sg_thinking":"Analyser","instruction.desc.sg_thinking":"Raisonner avant d'crire. Analyser la causalit et la logique. liminer les clichs.","instruction.sg_improve_input":"Docteur de Script","instruction.desc.sg_improve_input":"Amliorer le concept initial, corriger les incohrences, affiner le conflit.","instruction.sg_exposition":"Exposition","instruction.desc.sg_exposition":"Montrer l'tat du monde  travers l'histoire environnementale et les dtails.","instruction.sg_delayed_reveal":"Rvlation","instruction.desc.sg_delayed_reveal":"Intro progressive : environnement -> dtails -> silhouette -> visage.","instruction.sg_metaphor":"Mtaphore","instruction.desc.sg_metaphor":"Utiliser des symboles visuels pour les tats internes.","instruction.sg_pacing":"Rythme","instruction.desc.sg_pacing":"Contrle du rythme : quilibrer les plans contemplatifs et le montage dynamique.","instruction.sg_subtext":"Sous-texte","instruction.desc.sg_subtext":"Tension entre dialogue et action.","instruction.desc.sg_frame_estimation":"Calcul recommand du nombre de plans.","instruction.rule_visuals":"Visuels d'abord","instruction.desc.rule_visuals":"Montrez, ne dites pas. Focus sur la lumire, la composition, le mouvement.","instruction.sg_visual_dna":"ADN Visuel","instruction.desc.sg_visual_dna":"Guide technique LookDev (Lumire, Objectifs, Style de rendu).","instruction.rule_flow":"Flux continu","instruction.desc.rule_flow":"Logique Match Cut : Utiliser formes/couleurs pour les transitions.","instruction.rule_atmosphere":"Atmosphre","instruction.desc.rule_atmosphere":"Dtails tactiles : odeur de pluie, bourdonnement non, poussire.","instruction.sg_visual_style":"Style Visuel","instruction.desc.sg_visual_style":"Demande : Description dtaille du style base sur '{style}'.","instruction.char_detailed_style":"Dtail Stylis","instruction.desc.char_detailed_style":"Intgre le style global dans chaque prompt de personnage.","instruction.sg_genre":"Contexte de Genre","instruction.desc.sg_genre":"Contexte : {genre}","instruction.char_smart_concept":"Smart Concept","instruction.desc.char_smart_concept":"IA choisit : Corps complet pour Persos / Remplissage pour Objets.","instruction.char_no_dupes":"Pas de Doublons","instruction.desc.char_no_dupes":"CRITIQUE : NE PAS rgnrer les personnages sauf CHANGEMENT DE COSTUME.","instruction.create_secondary_chars":"Personnages Secondaires","instruction.desc.create_secondary_chars":"Autorise la cration de personnages secondaires si ncessaire.","instruction.create_key_items":"Objets Cls","instruction.desc.create_key_items":"Cration de 'Cartes Personnage' pour les objets importants.","instruction.char_secondary_ok":"Nouveaux autoriss","instruction.desc.char_secondary_ok":"Nouveaux personnages ou objets autoriss. En cas de changement de tenue, crer une nouvelle carte.","instruction.sg_anthro":"Anthro","instruction.desc.sg_anthro":"Les personnages doivent tre des animaux anthropomorphes.","instruction.sg_no_chars":"Pas de Personnages","instruction.desc.sg_no_chars":"Style documentaire / Pas de personnages nomms.","instruction.sg_detailed_plot":"Intrigue Dtaille","instruction.desc.sg_detailed_plot":"Descriptions trs dtailles des actions.","instruction.sg_subscribe":"Scne Abonnement","instruction.desc.sg_subscribe":"Inclure une scne brisant le 4me mur pour s'abonner.","instruction.char_gray_bg":"Concept Visuel","instruction.desc.char_gray_bg":"Pour chaque prompt visuel, TOUJOURS ajouter : ', full body character concept on a gray background'.","instruction.char_no_new":"Pas de Nouveaux","instruction.desc.char_no_new":"NE PAS crer de nouveaux personnages. Utiliser seulement les existants.","instruction.sg_new_chars":"Nouveaux Personnages","instruction.desc.sg_new_chars":"Gnrer de nouveaux personnages bass sur le prompt.","instruction.sg_living_world":"Monde Vivant","instruction.desc.sg_living_world_simple":"Les figurants sont des humains normaux.","instruction.desc.sg_living_world_anthro":"Les figurants sont des animaux anthropomorphes.","instruction.sg_simple_actions":"Actions Simples","instruction.desc.sg_simple_actions":"viter la physique complexe. Prfrer des poses stables.","instruction.commercial_safe":"Scurit Commerciale","instruction.desc.commercial_safe":"vite strictement les marques dposes (Disney, Pixar) et les remplace par des descriptions gnriques."},Ib={"instruction.ana_role":"Rle Analyseur","instruction.desc.ana_role":"Vous tes un Ralisateur de classe mondiale. crivez des instructions techniques pour la gnration d'images/vidos par IA. Chaque plan doit tre dcrit indpendamment et en dtail.","instruction.ana_cinema":"Cinmatographie","instruction.desc.ana_cinema":"Termes pro : Wide Shot, Close-up, Dutch Angle, Bokeh.","instruction.ana_cinema_wide":"Cinmatographie (Large)","instruction.desc.ana_cinema_wide":"Termes pro : Wide Shot, Long Shot. PAS de Gros Plans.","instruction.ana_anthro_logic":"Logique Anthro","instruction.desc.ana_anthro_logic":"Dcrire explicitement les personnages comme Animaux Anthropomorphes.","instruction.ana_subscribe_logic":"Appel Abonnement","instruction.desc.ana_subscribe_logic":`Actions visuelles pour "S'abonner" : tenir des panneaux, texte 3D.`,"instruction.rule_hierarchy":"Algorithme de Cadrage","instruction.desc.rule_hierarchy":"Ordre strict : 1. Global (Lieu/Mto). 2. Posture Sujet. 3. Interaction Objet. 4. Action.","instruction.rule_living_world":"Monde Vivant","instruction.desc.rule_living_world":"Dcrire les figurants en cohrence avec le monde.","instruction.desc.rule_living_world_anthro":"Les figurants doivent tre des animaux anthropomorphes.","instruction.rule_persistence":"Persistance","instruction.desc.rule_persistence":"Maintenir la cohrence chronologique de la scne. Suivre les objets et positions entre les plans.","instruction.rule_mandatory_bg":"Fond Obligatoire","instruction.desc.rule_mandatory_bg":"INTERDIT de laisser le fond vide. Toujours dcrire le lieu et la lumire.","instruction.desc.rule_mandatory_bg_wide":"INTERDIT de laisser le fond vide. En plan large, toujours dcrire la gographie et l'horizon.","instruction.shot_filter_wide":"Plans Larges Uniquement","instruction.desc.shot_filter_wide":"FILTRE STRICT : Seulement Wide (WS), Long (LS) et Medium (MS). Gros plans interdits.","instruction.storyboard_rules":"Varit de Plans","instruction.desc.storyboard_rules":"Alterner WS/LS, MS et CU/ECU pour le dynamisme.","instruction.storyboard_rules_wide":"Varit de Plans (Large)","instruction.desc.storyboard_rules_wide":"Seulement Wide, Long et Establishing. Varier l'angle. PAS de Gros plans.","instruction.tech_directives":"Contrle Camra","instruction.desc.tech_directives":"Terminologie stricte. Seulement abrviations (WS, MS, CU).","instruction.tech_directives_wide":"Contrle Camra (Large)","instruction.desc.tech_directives_wide":"Terminologie stricte. Seulement WS, MS, LS. Pas de CU/ECU.","instruction.use_aliases":"Utiliser Alias","instruction.desc.use_aliases":"Utiliser le format Character-N.","instruction.action_phase_breakdown":"Micro-Actions","instruction.desc.action_phase_breakdown":"Dcomposer les actions complexes en phases (Prparation, Dbut, Sommet, Raction).","instruction.desc.action_phase_breakdown_wide":"Dcomposer les phases, mais GARDER LA CAMRA LARGE. Montrer l'impact par la posture.","instruction.batch_processing":"Traitement par Lots","instruction.desc.batch_processing":"Analyser toutes les scnes comme une squence continue.","instruction.ana_prompt_lang":"Langue des Prompts","instruction.desc.ana_prompt_lang":"Prompts strictement en Anglais pour la compatibilit.","instruction.extended_visuals":"Visualisation tendue","instruction.desc.extended_visuals":"Dcompose les scnes en squences expressives (Wide, MS, CU, Dtail).","instruction.extended_visuals_wide":"Visualisation tendue (Large)","instruction.desc.extended_visuals_wide":"Dcompose les scnes en squences de plans Larges/Moyens. Focus sur la gographie.","instruction.desc.target_lang":"Langue d'analyse.","instruction.rule_isolation":"Zro Contexte","instruction.desc.rule_isolation":"CRITIQUE : Le gnrateur d'image NE CONNAT PAS le plan prcdent. Re-dcrire l'environnement  chaque plan.","instruction.sensory_saturation":"Anti-Brivet","instruction.desc.sensory_saturation":"INTERDIT d'tre bref. Dcrire textures, lumire et poids physique.","instruction.ana_no_pov":"Pas de POV","instruction.desc.ana_no_pov":'NGATIF CRITIQUE : INTERDICTION STRICTE des plans "POV" ou "Premire Personne". La camra DOIT tre externe.',"instruction.desc.static_frame_logic":'INTERDICTION STRICTE des verbes de mouvement ("marcher"). Dcrire un moment FIG.',"instruction.desc.anatomical_posing":'Dcrire la GOMTRIE du corps. Au lieu de "se reposer", crire "couch sur le dos, bras sur les cts".',"instruction.desc.motion_dynamics":"SPARATION : Image Prompt = 100% Statique. Video Prompt = Mouvement & Temps.","instruction.desc.anatomical_strictness":'RIGGING : "Bras derrire la tte ET tient un verre" interdit. Dcrire sparment : Bras Gauche [tat], Bras Droit [tat].',"instruction.desc.prop_consistency":'VERROUILLAGE OBJET : Pas de noms gnriques ("pe"). Attributs visuels ("pe en fer rouill") obligatoires.',"instruction.desc.subject_hierarchy":"Mme pour les Gros plans : 1. Personnage Complet/Posture. 2. Interaction avec Environnement. 3. Dtail.","instruction.inputs_data":"Entres","instruction.desc.inputs_data":"Donnes source : Rsum, Profils, Textes de scnes."},Pb={"instruction.inputs":"Entres","instruction.desc.inputs":"Source : Plans de l'analyseur, Profils visuels, Style de scne.","instruction.role":"Rle : Lead Environment Artist","instruction.desc.role":"Expert en Prompt Engineering. Synthtisez les entres en une description visuelle dfinitive.","instruction.layered":"Algorithme : Flux Unifi","instruction.desc.layered":"Gnre un SEUL bloc de texte fluide. Structure : [Style] -> [DESIGN DCOR MATRE] -> [Visuels] + [POSE & ACTION] -> [Camra].","instruction.desc.layered_no_char":"Structure : [DESIGN DCOR MATRE] -> [Index] + [POSE & ACTION]. Omet l'apparence, garde seulement indices et actions.","instruction.visuals":"Style : Saturation","instruction.desc.visuals":"Utiliser des descripteurs riches : lumire volumtrique, textures 8k, profondeur de champ.","instruction.process_whole_scene":"Lot de Scne","instruction.desc.process_whole_scene":"Analyser toute la scne d'un coup pour la cohrence.","instruction.video":"Vido","instruction.desc.video":"Video Prompt : [Index] (Dtail Visuel) [Action]. Dynamique : [Env]. Camra : [Mouvement]. PAS DE NOMS.","instruction.stateless":"Rgle : Sans tat","instruction.desc.stateless":"Chaque plan est indpendant. Re-dcrire l'environnement. Re-dcrire l'action de chaque personnage depuis zro.","instruction.rule_static":"Rgle : Statique","instruction.desc.rule_static":"Dcrire seulement le moment fig. Pas de transitions.","instruction.atmosphere_fix":"Ancre Atmosphrique","instruction.desc.atmosphere_fix":"Dcrire l'humeur comme proprit physique de l'air et de la lumire.","instruction.subject_focus":"Hirarchie Contexte","instruction.desc.subject_focus":"CRITIQUE : Mme pour Gros plans : 1. Perso Complet. 2. Pose. 3. Dtail. L'IA a besoin du contexte corporel.","instruction.always_env":"DESIGN DCOR OBLIGATOIRE","instruction.desc.always_env":"CRITIQUE : Utilisez le 'Contexte Global de la Scne' fourni comme la VRIT ABSOLUE pour l'arrire-plan. Vous DEVEZ injecter les dtails spcifiques des meubles, de l'clairage et des textures du contexte dans la couche d'environnement de CHAQUE prompt. N'inventez pas d'arrire-plans gnriques.","instruction.pm_anthro":"Dtail Anthro","instruction.desc.pm_anthro":`OBLIGATOIRE : Mot "anthropomorphic" avant l'espce dans Image ET Vido. Textures/anatomie amliores.`,"instruction.pm_subscribe":"Texte Lisible","instruction.desc.pm_subscribe":`S'assurer que le texte comme "SUBSCRIBE" est lisible et intgr (non, panneaux).`,"instruction.strict_char_index":"Personnages","instruction.desc.strict_char_index":"Mapper strictement les alias (Character-N) aux donnes du plan.","instruction.no_names":"CRITIQUE : PAS DE NOMS","instruction.desc.no_names":"CRITIQUE : INTERDICTION ABSOLUE DES NOMS. Utiliser seulement l'ID d'Index entre crochets `[Character-N]`.","instruction.general_char_desc":"Dtail Gnral","instruction.desc.general_char_desc":"Intgrer une version CONCISE et GNRALE du prompt visuel.","instruction.full_char_desc":"Dtail Complet","instruction.desc.full_char_desc":"Intgrer le prompt visuel COMPLET du profil exactement tel quel.","instruction.formatting":"Formatage","instruction.desc.formatting":"Active les EN-TTES explicites et sauts de ligne pour la structure.","instruction.anatomical_strictness":"Logique Anatomie","instruction.desc.anatomical_strictness":'RIGGING : Empche "Bras derrire la tte ET tient un verre". Force la description spare.',"instruction.img_vid_consistency":"Flux Img->Vid","instruction.desc.img_vid_consistency":"Image Prompt = Dpart/Statique. Video Prompt = Action/volution. La vido doit dcouler naturellement de l'image.","instruction.desc.prop_enhancement":`MATRIALIT : Amplifie les descriptions d'objets (ex. "planche rouge" -> "fibre de verre rouge brillante").`,"instruction.no_pov":"CRITIQUE : PAS DE POV","instruction.desc.no_pov":"INTERDICTION STRICTE des angles POV. La camra DOIT tre externe (Troisime Personne)."},Rb={"instruction.music_role":"Rle Producteur Musique","instruction.desc.music_role":"Compositeur expert et parolier.","instruction.music_input":"Donnes d'entre","instruction.desc.music_input":"Thme ou ide de l'utilisateur.","instruction.music_creative":"Libert Crative","instruction.desc.music_creative":"Force l'IA  interprter l'ambiance mtaphoriquement, pas littralement.","instruction.music_lyrics":"Structure Paroles","instruction.desc.music_lyrics":"Gnre une structure Couplet/Refrain adapte au genre.","instruction.music_prompt_rule":"Prompt Musique IA","instruction.desc.music_prompt_rule":"Tags techniques pour Suno/Udio (BPM, Instruments, Voix). Max 1000 caractres.","instruction.music_format":"Sortie JSON","instruction.desc.music_format":"Structure JSON stricte pour l'intgration."},Mb={"instruction.yt_role":"Stratge YouTube","instruction.desc.yt_role":"Expert en SEO, CTR et psychologie virale.","instruction.yt_input":"Donnes d'entre","instruction.desc.yt_input":"Le sujet ou la niche.","instruction.yt_title_mode":"Mtadonnes Vido","instruction.desc.yt_title_mode":"Optimise Titres/Desc/Tags pour un maximum de clics.","instruction.yt_channel_mode":"Branding Chane","instruction.desc.yt_channel_mode":"Cre Nom, Bio et Identifiant cohrents.","instruction.yt_format":"Sortie JSON","instruction.desc.yt_format":"Structure JSON stricte pour l'intgration."},jb={...kb,...Ab,...Ib,...Pb,...Rb,...Mb},Lb={..._b,...Cb,...Sb,...Tb,...Eb,...Nb,...jb},Db={"app.title":"Script Modifier","app.description":"Crea, affina e genera visivamente sceneggiature con l'API Gemini.","app.slogan":"Connetti le idee per creare un capolavoro","app.subtitle":"Visualizza le tue sceneggiature","app.error.title":"Notifica","app.error.copy":"Copia errore","app.error.copied":"Copiato!","error.quotaExceeded":"Hai raggiunto il limite di utilizzo. Controlla la quota della tua chiave API o riprova pi tardi.","error.apiKeyMissing":"Chiave API non trovata. Imposta la tua chiave API Gemini nelle impostazioni.","error.freeKeyNotAvailable":"La chiave API gratuita/sviluppo non  disponibile in questo ambiente. Fornisci la tua chiave.","error.fileReadError":"Errore durante la lettura del file.","error.videoConversionError":"Impossibile convertire il video in audio.","error.unsupportedFile":"Tipo di file non supportato.","error.promptModifierFile":"Questo file appartiene a un'altra applicazione (Prompt Modifier). Aprilo in quell'applicazione.","error.invalidFileType":"Tipo di file non valido. Carica un file Progetto o Canvas di Script Modifier.","welcome.iAmDeveloper":"Sono uno sviluppatore","welcome.letsGo":"Andiamo!","welcome.resume":"Riprendi","welcome.reload":"Ricarica","welcome.reloadTitle":"Reimpostare e ricaricare?","welcome.reloadMessage":"Questo canceller l'intero canvas e ricaricher l'applicazione. I dati non salvati andranno persi. Sei sicuro?","welcome.confirmReload":"Reimposta e Ricarica","dialog.welcome.title":"Script Modifier","dialog.welcome.heading":"Benvenuto in","dialog.welcome.intro1":"Benvenuto in Script Modifier, il tuo spazio di lavoro visivo per creare storie con Gemini.","dialog.welcome.intro2":"Per iniziare, seleziona la tua lingua e inserisci la tua chiave API Gemini.","dialog.welcome.apiKeyExplanation":"La tua chiave API  archiviata localmente nel tuo browser. Non la inviamo a nessun server diverso dall'API di Google Gemini."},Ob={"toolbar.edit":"Modifica (V)","toolbar.cutter":"Taglia connessione (C)","toolbar.selection":"Selezione (S)","toolbar.reroute":"Punto di deviazione (R)","toolbar.zoom":"Zoom (Z)","toolbar.snapToGrid":"Aggancia alla griglia (Shift+W)","toolbar.resetZoom":"Reimposta Zoom","toolbar.lineStyleSpaghetti":"Linee Spaghetti (Shift+E)","toolbar.lineStyleOrthogonal":"Linee Ortogonali (Shift+E)","toolbar.addNode":"Aggiungi nodo (F)","toolbar.catalog":"Catalogo (Ctrl+Spazio)","toolbar.settings":"Impostazioni","toolbar.resetToDefault":"Ripristina predefiniti","toolbar.closeProject":"Chiudi progetto / Pulisci","toolbar.enterFullscreen":"Schermo intero","toolbar.exitFullscreen":"Esci da schermo intero","toolbar.home":"Home","toolbar.addTextInput":"Input Testo (T)","toolbar.addPromptAnalyzer":"Analizzatore Prompt (A)","toolbar.addCharacterAnalyzer":"Analizzatore Personaggio","toolbar.addCharacterGenerator":"Generatore Personaggi (Shift+C)","toolbar.addImageGenerator":"Generatore Immagini (O)","toolbar.addImagePreview":"Anteprima Immagine (I)","toolbar.addCharacterCard":"Scheda Personaggio (Ctrl+Shift+C)","toolbar.addPromptProcessor":"Processore Prompt (P)","toolbar.addGeminiChat":"Chat Gemini (G)","toolbar.addTranslator":"Traduttore (L)","toolbar.addIdeaGenerator":"Generatore Idee (Shift+A)","toolbar.addScriptGenerator":"Generatore Sceneggiatura (Shift+S)","toolbar.addScriptAnalyzer":"Analizzatore Sceneggiatura (Shift+D)","toolbar.addScriptPromptModifier":"Finalizzatore Prompt (Shift+F)","toolbar.addErrorAnalyzer":"Analizzatore Errori","toolbar.addNote":"Nota (N)","toolbar.addDataReader":"Lettore Dati (Shift+R)","toolbar.addSpeechSynthesizer":"Sintetizzatore Vocale (Shift+N)","toolbar.addNarratorTextGenerator":"Generatore Testo Narratore (Shift+G)","toolbar.addAudioTranscriber":"Transcrittore Audio (Shift+B)","toolbar.addYouTubeTitleGenerator":"Generatore Titoli YouTube (Shift+T)","toolbar.addMusicIdeaGenerator":"Generatore Idee Musicali (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube Analytics (Shift+Y)","toolbar.saveCanvas":"Salva Canvas (Ctrl+S)","toolbar.saveProject":"Salva Progetto (Ctrl+Shift+S)","toolbar.loadCanvas":"Carica (Ctrl+O)","toolbar.clearCanvas":"Pulisci Canvas","toolbar.group.general":"Generale","toolbar.group.scripting":"Sceneggiatura","toolbar.group.prompting":"Prompt & Analisi","toolbar.group.characters":"Personaggi","toolbar.group.ai":"Strumenti AI","toolbar.group.file":"File","toolbar.group.images":"Immagini","toolbar.group.audio":"Audio","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"Controlli Canvas","toolbar.expand":"Espandi pannello","toolbar.collapse":"Comprimi pannello","toolbar.toggleHeaders":"Mostra/Nascondi intestazioni","hotkeys.file.title":"File","hotkeys.file.save":"Salva Canvas (Ctrl+S)","hotkeys.file.saveProject":"Salva Progetto (Ctrl+Shift+S)","hotkeys.file.load":"Carica Canvas (Ctrl+O)","hotkeys.tools.title":"Strumenti","hotkeys.tools.edit":"Modifica","hotkeys.tools.cutter":"Taglierina","hotkeys.tools.selection":"Selezione","hotkeys.tools.reroute":"Deviazione","hotkeys.tools.zoom":"Zoom","hotkeys.tools.group":"Raggruppa (G)","hotkeys.tools.deleteGroup":"Elimina gruppo","hotkeys.tools.closeNode":"Chiudi nodo","hotkeys.tools.toggleLineStyle":"Cambia stile linea","hotkeys.tools.snapToGrid":"Aggancia alla griglia","hotkeys.tools.selectAll":"Seleziona tutto","hotkeys.tools.deselectAll":"Deseleziona tutto","hotkeys.tools.duplicate":"Duplica con contenuto","hotkeys.windows.title":"Finestre","hotkeys.windows.search":"Cerca (F)","hotkeys.windows.quickAdd":"Aggiunta rapida (Spazio)","hotkeys.windows.catalog":"Catalogo","hotkeys.createNode.title":"Crea nodo","hotkeys.hide":"Nascondi scorciatoie","help.title":"Scorciatoie da tastiera","hotkeys.show":"Mostra scorciatoie","search.placeholder":"Cerca un nodo...","search.noResults":"Nessun nodo trovato.","search.node.text_input.title":"Input Testo","search.node.text_input.description":"Una semplice casella di testo per le tue idee. (T)","search.node.prompt_processor.title":"Processore Prompt","search.node.prompt_processor.description":"Migliora e combina i prompt con l'IA. (P)","search.node.prompt_analyzer.title":"Analizzatore Prompt","search.node.prompt_analyzer.description":"Divide un prompt in ambiente, personaggio, azione e stile. (A)","search.node.character_analyzer.title":"Analizzatore Personaggio","search.node.character_analyzer.description":"Divide una descrizione in aspetto fisico e abbigliamento.","search.node.character_generator.title":"Generatore Personaggi","search.node.character_generator.description":"Crea personaggi dettagliati da un'idea. (Shift+C)","search.node.image_generator.title":"Generatore Immagini","search.node.image_generator.description":"Crea un'immagine da un prompt di testo. (O)","search.node.image_preview.title":"Anteprima Immagine","search.node.image_preview.description":"Visualizza un'immagine da file. (I)","search.node.character_card.title":"Scheda Personaggio","search.node.character_card.description":"Memorizza immagine, nome e prompt di un personaggio. (Ctrl+Shift+C)","search.node.gemini_chat.title":"Chat Gemini","search.node.gemini_chat.description":"Conversazione diretta con Gemini AI. (G)","search.node.translator.title":"Traduttore","search.node.translator.description":"Traduce il testo nella lingua selezionata. (L)","search.node.script_generator.title":"Generatore Sceneggiatura","search.node.script_generator.description":"Trasforma un'idea in scene di una sceneggiatura. (Shift+S)","search.node.script_analyzer.title":"Analizzatore Sceneggiatura","search.node.script_analyzer.description":"Scompone una sceneggiatura in inquadrature e prompt immagine. (Shift+D)","search.node.script_prompt_modifier.title":"Finalizzatore Prompt","search.node.script_prompt_modifier.description":"Finalizza i prompt dall'analisi per la generazione di immagini. (Shift+F)","search.node.error_analyzer.title":"Analizzatore Errori","search.node.error_analyzer.description":"Controlla e corregge ortografia e grammatica.","search.node.note.title":"Nota","search.node.note.description":"Una semplice area di testo per appunti. (N)","search.node.reroute_dot.title":"Punto di Deviazione","search.node.reroute_dot.description":"Un punto per reindirizzare le connessioni.","search.node.data_reader.title":"Lettore Dati","search.node.data_reader.description":"Mostra i dati grezzi da un nodo connesso.","search.node.speech_synthesizer.title":"Sintetizzatore Vocale","search.node.speech_synthesizer.description":"Converte testo in voce. (Shift+N)","search.node.idea_generator.title":"Generatore Idee","search.node.idea_generator.description":"Genera categorie e le combina in un'idea.","search.node.narrator_text_generator.title":"Generatore Testo Narratore","search.node.narrator_text_generator.description":"Genera testo per un narratore o annunciatore.","search.node.audio_transcriber.title":"Transcrittore Audio","search.node.audio_transcriber.description":"Converte file audio/video in testo.","search.node.youtube_title_generator.title":"Generatore Titoli YouTube","search.node.youtube_title_generator.description":"Genera titoli, descrizioni e tag per YouTube.","search.node.music_idea_generator.title":"Generatore Idee Musicali","search.node.music_idea_generator.description":"Genera testi di canzoni o prompt musicali.","search.node.youtube_analytics":"YouTube Analytics","search.node.youtube_analytics.description":"Analizza le statistiche del canale e fornisce consigli.","search.node.image_editor":"Editor Immagini","search.node.image_editor.description":"Modifica le immagini con l'IA (Inpainting, Outpainting).","search.group.input":"Input","search.group.process":"Elaborazione & Analisi","search.group.scripting":"Strumenti Sceneggiatura","search.group.character":"Strumenti Personaggio","search.group.images":"Strumenti Immagine","search.group.ai":"Strumenti IA","search.group.audio":"Strumenti Audio","search.group.youtube":"Strumenti YouTube","contextMenu.tools":"Strumenti","contextMenu.assignSlot":"Assegna Slot {index}","contextMenu.addNodeFromSlot":"Aggiungi {node} ({index})","connectionMenu.title":"Aggiungi Nodo","quickAddMenu.title":"Aggiunta Rapida","contextMenu.paste":"Incolla (Ctrl+V)","node.content.simpleActions":"Azioni Semplici","node.content.smartConcept":"Smart Concept","tooltip.model.flash":"Gemini Flash: Veloce, efficiente, buono per bozze.","tooltip.model.pro":"Gemini Pro: Alta intelligenza, ragionamento complesso, dettagliato.","tooltip.lang.ru":"Genera sceneggiatura in Russo.","tooltip.lang.en":"Genera sceneggiatura in Inglese.","tooltip.lang.es":"Genera sceneggiatura in Spagnolo.","tooltip.lang.de":"Genera sceneggiatura in Tedesco.","tooltip.lang.uz":"Genera sceneggiatura in Uzbeco.","tooltip.lang.fr":"Genera sceneggiatura in Francese.","tooltip.lang.it":"Genera sceneggiatura in Italiano.","tooltip.lang.pt":"Genera sceneggiatura in Portoghese.","tooltip.lang.zh":"Genera sceneggiatura in Cinese.","node.action.locateInStack":"Trova nello stack","help.tabs.hotkeys":"Aiuto & Scorciatoie","help.tabs.links":"Altre App & Link","help.category.socials":"Social","help.category.stable":"Google AI Studio (Stabile)","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":"Web / Netlify","help.category.github":"Repository GitHub","help.link.youtube":"Canale YouTube","help.link.telegram_channel":"Canale Telegram","help.link.telegram_chat":"Chat Telegram","help.sub.news":"Notizie & Aggiornamenti","help.sub.discussion":"Discussione","help.sub.stable":"Versione Stabile","help.sub.alpha":"Versione Alpha","languages.ru":"Russo","languages.en":"Inglese","languages.es":"Spagnolo","languages.fr":"Francese","languages.de":"Tedesco","languages.it":"Italiano","languages.pt":"Portoghese","languages.zh":"Cinese","languages.ja":"Giapponese","languages.ko":"Coreano","languages.uz":"Uzbeco"},Fb={"node.title.text_input":"Input Testo","node.title.prompt_processor":"Processore Prompt","node.title.prompt_analyzer":"Analizzatore Prompt","node.title.character_analyzer":"Analizzatore Personaggio","node.title.character_generator":"Generatore Personaggi","node.title.image_generator":"Generatore Immagini","node.title.image_preview":"Anteprima Immagine","node.title.character_card":"Scheda Personaggio","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Traduttore","node.title.script_generator":"Generatore Sceneggiatura","node.title.script_analyzer":"Analizzatore Sceneggiatura","node.title.script_prompt_modifier":"Finalizzatore Prompt","node.title.error_analyzer":"Analizzatore Errori","node.title.note":"Nota","node.title.reroute_dot":"Punto di Deviazione","node.title.data_reader":"Lettore Dati","node.title.speech_synthesizer":"Sintetizzatore Vocale","node.title.idea_generator":"Generatore Idee","node.title.narrator_text_generator":"Generatore Testo Narratore","node.title.audio_transcriber":"Transcrittore Audio","node.title.youtube_title_generator":"Generatore Titoli YouTube","node.title.music_idea_generator":"Generatore Idee Musicali","node.title.youtube_analytics":"YouTube Analytics","node.title.image_editor":"Editor Immagini","node.help.text_input":"Inserisci qui idee di base, parole chiave o descrizioni.","node.help.prompt_processor":"Combina testo da altri nodi in un prompt dettagliato.","node.help.prompt_analyzer":"Divide un prompt in ambiente, personaggio, azione e stile.","node.help.character_analyzer":"Analizza una descrizione di un personaggio dividendola in aspetto e abbigliamento.","node.help.character_generator":"Crea descrizioni dettagliate di personaggi da un'idea.","node.help.image_generator":"Genera un'immagine da un testo usando l'API Gemini.","node.help.image_preview":"Visualizza un'immagine. Trascina un file immagine sul nodo.","node.help.character_card":"Memorizza immagine, nome e prompt di un personaggio.","node.help.gemini_chat":"Conversazione diretta con Gemini AI.","node.help.translator":"Traduce il testo in ingresso nella lingua selezionata.","node.help.script_generator":"Genera scene di una sceneggiatura da un prompt.","node.help.script_analyzer":"Scompone una sceneggiatura in inquadrature e prompt immagine.","node.help.script_prompt_modifier":"Crea prompt artistici finali per ogni inquadratura.","node.help.error_analyzer":"Controlla e corregge ortografia e grammatica.","node.help.note":"Una semplice area di testo per le tue note.","node.help.reroute_dot":"Un punto per reindirizzare le connessioni.","node.help.data_reader":"Mostra i dati grezzi da un nodo connesso.","node.help.speech_synthesizer":"Converte il testo in parlato.","node.help.idea_generator":"Genera categorie e le combina in un'idea.","node.help.narrator_text_generator":"Genera testo per un narratore o annunciatore.","node.help.audio_transcriber":"Converte file audio/video in testo.","node.help.youtube_title_generator":"Genera titoli, descrizioni e tag per YouTube.","node.help.music_idea_generator":"Genera testi di canzoni o prompt musicali.","node.help.youtube_analytics":"Analizza le statistiche del canale e fornisce consigli.","node.help.image_editor":"Modifica le immagini con l'IA (Inpainting, Outpainting).","node.action.help":"Aiuto","node.action.expand":"Espandi","node.action.collapse":"Comprimi (H)","node.action.expandAll":"Espandi tutto","node.action.collapseAll":"Comprimi tutto","node.action.expandAllScenes":"Espandi tutte le scene","node.action.collapseAllScenes":"Comprimi tutte le scene","node.action.expandAllFrames":"Espandi tutte le inquadrature","node.action.collapseAllFrames":"Comprimi tutte le inquadrature","node.action.expandPanel":"Espandi pannello","node.action.collapsePanel":"Comprimi pannello","node.action.togglePanel":"Mostra/Nascondi pannello","node.action.collapseScene":"Comprimi scena","node.action.expandScene":"Espandi scena","node.action.collapseFrame":"Comprimi inquadratura","node.action.expandFrame":"Espandi inquadratura","node.action.collapseCharacter":"Comprimi personaggio","node.action.expandCharacter":"Espandi personaggio","node.action.clear":"Pulisci","node.action.clearTooltip":"Pulisci il campo di input.","node.action.clearChat":"Pulisci chat","node.action.paste":"Incolla","node.action.copy":"Copia","node.action.duplicateWithContent":"Duplica (Contenuto)","node.action.duplicateEmpty":"Duplica (Vuoto)","node.action.cutConnections":"Taglia connessioni","node.action.close":"Chiudi","node.action.executeChain":"Esegui catena","node.action.executeFullChain":"Esegui catena completa","node.action.processChainForward":"Elabora catena in avanti","node.action.executeChainTitle":"Esegui tutti i nodi connessi.","node.action.addCharacter":"Aggiungi personaggio","node.action.addScene":"Aggiungi scena","node.action.addFrame":"Aggiungi inquadratura","node.action.addFirstFrame":"Aggiungi prima inquadratura","node.action.deleteItem":"Elimina","node.action.moveUp":"Sposta su","node.action.moveDown":"Sposta gi","node.action.saveImage":"Salva immagine","node.action.loadImage":"Carica immagine","node.action.saveCharacter":"Salva personaggio","node.action.loadCharacter":"Carica personaggio","node.action.readData":"Leggi dati","node.action.refreshData":"Aggiorna dati","node.action.stop":"Stop","node.action.stopping":"Arresto...","node.action.embedCharacter":"Incorpora personaggio","node.action.downloadFinalPrompts":"Scarica prompt","node.action.rename":"Rinomina","node.action.index":"Indicizza","node.action.improveConcept":"Migliora concetto","node.action.improveConceptTooltip":"Arricchisci e aggiungi dettagli visivi.","node.action.downloadJson":"Scarica JSON","node.action.downloadSRT":"Scarica SRT","node.action.markPrimary":"Segna come Primario","node.input.default":"Input","node.output.default":"Output","node.output.allCharacters":"Tutti i Personaggi","node.output.primaryCharacter":"Personaggio Principale","node.content.action":"Azione","node.content.actionPlaceholder":"Prompt azione...","node.content.allScriptParts":"Tutte le parti della sceneggiatura","node.content.allScriptAnalyzerData":"Dati dall'analizzatore","node.content.allNarratorData":"Tutti i dati narratore","node.content.analyzeCharacters":"Analizza personaggi","node.content.analyzeFromScene":"Analizza da:","node.content.analyzeUpToScene":"a","node.content.endPlaceholder":"fine","node.content.generateFromFrame":"Genera dal frame:","node.content.generateUpToFrame":"fino al frame","node.content.analyzeFromFrame":"Finalizza dal frame:","node.content.processFromFrame":"Elabora dal frame:","node.content.processFromScene":"Elabora dalla scena:","node.content.analyzePrompt":"Analizza prompt","node.content.analyzeScript":"Analizza sceneggiatura","node.content.analyzing":"Analisi...","node.content.applyAliases":"Applica alias","node.content.applyAliasesTooltip":"Sostituisce i nomi con gli alias (Indice).","node.content.character":"Personaggio","node.content.characterIndex":"Indice","node.content.characterPlaceholder":"Prompt personaggio...","node.content.character_plural":"personaggi","node.content.characters":"Personaggi","node.content.charactersSynced":"Personaggi sincronizzati","node.content.noCharactersConnected":"Nessun personaggio connesso.","node.content.appearance":"Aspetto","node.content.personality":"Personalit","node.content.characterType":"Tipo","node.content.characterTypeShort":"Tipo","node.content.characterType.simple":"Semplice","node.content.characterType.anthro":"Anthro (Animali)","node.content.characterType.chibi":"Chibi (Carino)","node.content.characterType.key_item":"Oggetto Chiave","node.content.style":"Stile","node.content.style.none":"Nessuno","node.content.style.simple":"Semplice","node.content.style.realistic":"Realistico/Cinema","node.content.style.3d_cartoon":"Cartoon 3D","node.content.style.3d_realistic":"Realistico 3D","node.content.style.2d_animation":"Animazione 2D","node.content.style.anime":"Anime","node.content.style.comics":"Fumetti","node.content.style.custom":"Speciale","node.content.chatPlaceholder":"Scrivi un messaggio...","node.content.clothing":"Abbigliamento","node.content.clothingPlaceholder":"Prompt abbigliamento...","node.content.connectedPlaceholder":"Connesso","node.content.dataPlaceholder":"I dati appariranno qui...","node.content.readData":"Leggi dati","node.content.reading":"Lettura...","node.content.description":"Descrizione","node.content.sceneDescription":"Descrizione scena","node.content.duration":"Durata","node.content.enhancePrompt":"Genera prompt","node.content.enhancedPromptHere":"Il prompt migliorato apparir qui...","node.content.enhancing":"Miglioramento...","node.content.environment":"Ambiente","node.content.environmentPlaceholder":"Prompt ambiente...","node.content.environmentPrompt":"Ambiente & Sfondo","node.content.compositionAndBlocking":"Composizione & Azione","node.content.executingChain":"Esecuzione catena...","node.content.imagePrompt":"Prompt Immagine","node.content.finalPrompt":"Prompt Finale","node.content.finalPrompt_plural":"Prompt Finali","node.content.fixErrors":"Correggi errori","node.content.fixingErrors":"Correzione...","node.content.frame":"Frame","node.content.frame_plural":"Frame","node.content.frames":"Frame di uscita","node.content.frames_analyzed":"Frame analizzati: {count}","node.content.framesPerScene":"Frame per scena","node.content.minFrames":"Min","node.content.maxFrames":"Max","node.content.numberOfCharactersShort":"Qt","node.content.fullDescription":"Descrizione completa","node.content.generateCharacters":"Genera personaggi","node.content.generateFinalPrompts":"Genera prompt finali","node.content.generatingProgress":"Generazione {current} di {total}","node.content.generateImage":"Genera immagine","node.content.generateScript":"Genera sceneggiatura","node.content.generateSpeech":"Genera voce","node.content.generateText":"Genera testo","node.content.generateSSML":"Genera SSML","node.content.generateStyle":"Genera stile","node.content.generating":"Generazione...","node.content.improving":"Miglioramento...","node.content.generatedAudio":"Audio generato","node.content.imagePromptPlaceholder":"Inserisci prompt per immagine...","node.content.modificationPromptPlaceholder":"Richiesta di modifica...","node.content.narrator":"Narratore","node.content.narratorEnabled":"Abilita narratore","node.content.narratorEnabledInfo":"Aggiunge testo voiceover.","node.content.narratorMode":"Modalit Narratore","node.content.narratorMode.normal":"Normale / Voiceover","node.content.narratorMode.dual":"Due Narratori","node.content.narratorMode.first_person":"Prima Persona","node.content.role":"Ruolo","node.content.role.narrator":"Narratore","node.content.role.announcer":"Annunciatore","node.content.role.first_person":"Prima Persona","node.content.role.dual_narrator":"Due Narratori","node.content.role.dual_announcer":"Due Annunciatori","node.content.scene":"Scena","node.content.scene_plural":"scene","node.content.scenes":"Scene","node.content.scenes_generated":"Scene Generate: {count}","node.content.sceneContext":"Contesto Scena","node.content.sceneContextPlaceholder":"Umore, ambiente, luce...","node.content.scriptPromptPlaceholder":"Inserisci idea storia...","node.content.seconds":"sec","node.content.stylePlaceholder":"Prompt stile...","node.content.stylePromptPlaceholder":"Inserisci prompt stile qui...","node.content.styleOverride":"Sovrascrivi Stile","node.content.summary":"Riassunto","node.content.targetLanguage":"Lingua Destinazione","node.content.textToSynthesize":"Testo da sintetizzare...","node.content.translate":"Traduci","node.content.translatePlaceholder":"Testo da tradurre...","node.content.translatedTextPlaceholder":"Il testo tradotto apparir qui...","node.content.translating":"Traduzione...","node.content.useExistingCharacters":"Usa personaggi esistenti","node.content.useExistingCharactersInfo":"Usa dati dei personaggi connessi invece di generarne di nuovi.","node.content.createKeyItem":"Crea Secondari/Oggetti","node.content.createSecondaryChars":"Personaggi Secondari","node.content.createKeyItems":"Oggetti Chiave","node.content.createKeyItemInfo":"Permette all'IA di creare personaggi secondari o oggetti.","node.content.noCharacters":"Nessun Personaggio","node.content.noCharactersInfo":"La sceneggiatura si concentrer su eventi e atmosfera (stile documentario).","node.content.videoPrompt":"Dinamica & Movimento","node.content.videoPrompts":"Prompt Video","node.content.voice":"Voce","node.content.previewVoice":"Prova Voce","node.content.voicePreviewText":"Ciao, questa  una prova vocale.","node.content.inputScripts":"Scene Input","node.content.inputFrames":"Frame Input","node.content.outputScript":"Scene Output","node.content.requestCategories":"Richiedi Categorie","node.content.generateIdea":"Genera Idea","node.content.requestNewCategories":"Richiedi Nuove Categorie","node.content.category.action":"Azione","node.content.category.place":"Luogo","node.content.category.obstacle":"Ostacolo","node.content.generatedIdea":"Idea Generata","node.content.storyFormat":"Formato Storia","node.content.theme":"Tema","node.content.parameters":"Parametri","node.content.advancedMode":"Modalit Avanzata","node.content.numberOfScenes":"Numero di scene","node.content.numberOfScenes.auto":"Auto","node.content.detailedPlot":"Trama Dettagliata","node.content.detailedPlotInfo":"Abilita descrizioni dettagliate di azioni e trama.","node.content.includeSubscribeScene":"Scena Iscrizione","node.content.includeSubscribeSceneInfo":"Integra una scena che rompe la quarta parete chiedendo di iscriversi.","node.content.genre":"Genere","node.content.genre2":"Genere 2","node.content.breakIntoParagraphs":"Dividi in paragrafi","node.content.copyVideoPrompt":"Copia prompt video","node.content.generateVideoPrompt":"Genera prompt video","node.content.model":"Modello","node.content.processWholeScene":"Elabora intera scena","node.content.processWholeSceneInfo":"Elabora tutti i frame di una scena in una volta sola per coerenza.","node.content.batchProcessing":"Elaborazione Batch","node.content.batchProcessingInfo":"Elabora tutte le scene selezionate in un unico contesto.","node.content.extendedAnalysis":"Analisi Estesa","node.content.extendedAnalysisInfo":"Divide le scene in inquadrature dettagliate.","node.content.professionalStoryboard":"Storyboard Regista","node.content.professionalStoryboardInfo":"Analisi scene basata su regole linguaggio cinematografico.","node.content.generateStartEndFrames":"Genera Frame Inizio/Fine","node.content.autoIndexCharacters":"Indicizza Auto Personaggi","node.content.autoIndexCharactersInfo":"Sostituisce automaticamente i nomi con gli alias.","node.content.imageToText":"Immagine a Testo","node.content.extracting":"Estrazione...","node.content.extractedText":"Testo Estratto","node.content.activePromptStack":"Stack Prompt Attivo","node.content.noCharactersAnalyzed":"Nessun personaggio analizzato.","node.content.promptsGeneratedPlaceholder":"I prompt generati appariranno qui.","node.content.noCharactersInScript":"Nessun personaggio nella sceneggiatura.","node.content.noInputScenes":"Nessun dato in ingresso. Connetti un Generatore Sceneggiatura.","node.content.status":"Stato","node.content.status.ready":"Pronto","node.content.status.paused":"In pausa","node.content.status.generating":"Generazione","node.content.status.total":"Totale: {generated} / {total}","node.content.status.batch":"Elaborazione: {current} di {total}","node.content.status.time":"Tempo: {current}s / {total}s","node.content.refreshing":"Aggiornamento...","node.content.totalFrames":"Totale Frame: {count}","node.content.uploadAudio":"Carica Audio/Video","node.content.noAudioLoaded":"Nessun audio","node.content.audioLoaded":"Audio caricato","node.content.transcriptionPlaceholder":"La trascrizione apparir qui...","node.content.transcribe":"Trascrivi","node.content.transcribing":"Trascrizione...","node.content.convertingVideo":"Conversione video...","node.content.recommendedFrames":"Frame Stimati","node.content.shotType":"Tipo Inquadratura","node.content.shotType.ws":"WS (Campo Largo)","node.content.shotType.ms":"MS (Campo Medio)","node.content.shotType.cu":"CU (Primo Piano)","node.content.shotType.ecu":"ECU (Primissimo Piano)","node.content.shotType.ls":"LS (Campo Lungo)","node.content.characterDetail":"Dettagli Personaggio","node.content.noCharDesc":"Nessuna descrizione personaggio","node.content.includeGeneralCharDesc":"Descrizione visiva generale","node.content.includeFullCharDesc":"Descrizione visiva dettagliata","node.content.safeGeneration":"Generazione Sicura","node.content.shotFilter":"Filtro Inquadrature","node.content.shotFilter.all":"Tutte","node.content.shotFilter.wideOnly":"Solo Larghe","instruction.desc.shot_filter_all":"Consenti tutti i tipi di inquadratura (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Restringi a inquadrature larghe (WS, MS, LS). Primi piani vietati.","node.content.anthroEnabled":"Animali Antropomorfi","node.content.subscribeEnhancement":"Migliora CTA Iscrizione","node.content.thinkingEnabled":"Modalit Pensiero","node.content.scenelessMode":"Scene senza copione","instruction.desc.sceneless_mode":"Disabilita motore narrativo. Genera scene direttamente dal concetto.","instruction.sceneless_mode":"Modalit Lista Scene","node.content.microActionBreakdown":"Micro-Azioni","node.content.microActionBreakdownInfo":"Scompone azioni complesse in fasi (Preparazione, Azione, Reazione).","node.content.commercialSafe":"Commercial Safe","instruction.desc.commercial_safe":"Evita rigorosamente marchi registrati (Disney, Pixar, ecc.) e nomi di personaggi protetti da copyright.","node.content.findStack":"Trova nello stack...","node.content.spm_stack.priming":"1. Priming & Contesto","node.content.spm_stack.physics":"2. Fisica & Logica","node.content.spm_stack.hierarchy":"3. Gerarchia Soggetto","node.content.spm_stack.construction":"4. Costruzione & Formato"},zb={"genre.general":"Generale","genre.comedy":"Commedia","genre.drama":"Drammatico","genre.action":"Azione","genre.scifi":"Fantascienza","genre.fantasy":"Fantasy","genre.horror":"Horror","genre.thriller":"Thriller","genre.childrens_animation":"Animazione per bambini","genre.shorts_story":"Storie brevi (Shorts)","genre.scientific_historical":"Scientifico-Storico","character_generator.promptPlaceholder":'Inserisci idea, es: "cavaliere coraggioso, guardiano della foresta antica"',"idea_generator.randomTheme":"Tema casuale","idea_generator.randomCombination":"Combinazione casuale","idea_generator.themePlaceholder":"es. Spazio, Cucina, Foresta Incantata","idea_generator.initialMessage":'Inserisci un tema (opzionale) e clicca "{buttonName}".',"idea_generator.ideaPlaceholder":"L'idea generata apparir qui...","idea_generator.format.general":"Generale","idea_generator.format.childrens":"Bambini","idea_generator.format.adventure":"Avventura","idea_generator.format.fantasy":"Fantasy / Magia","idea_generator.format.detective":"Detective","idea_generator.format.scifi":"Fantascienza","idea_generator.format.horror":"Horror","idea_generator.format.historical":"Storico","gender.male":"Maschio","gender.female":"Femmina","node.content.autoDownload":"Download automatico alla generazione","node.content.downloadSelected":"Scarica selezionati","node.content.intonation":"Intonazione","intonation.standard":"Standard","intonation.cheerful":"Allegro","intonation.angry":"Arrabbiato","intonation.sad":"Triste","intonation.excited":"Eccitato","intonation.announcer":"Annunciatore","intonation.whispering":"Sussurrato","node.content.sceneMode":"Modalit Scena","node.content.connectNarratorData":'Connetti "Tutti i dati narratore" da un Generatore Sceneggiatura.',"node.content.sceneModeActive":"Modalit Scena attiva. Dati ricevuti.","speech_synthesizer.mode.simple":"Semplice","speech_synthesizer.mode.scene":"Scena","speech_synthesizer.multiSpeaker":"Due Speaker","speech_synthesizer.speaker1Name":"Nome Speaker 1","speech_synthesizer.speaker2Name":"Nome Speaker 2","speech_synthesizer.multiSpeakerHint":'I nomi devono corrispondere a quelli nel testo (es. "Uomo: ...", "Donna: ...").',"speech_synthesizer.ssmlHint":"L'intonazione  controllata da tag SSML nel testo.","youtube_analytics.authorName":"Nome Autore","youtube_analytics.videoTitle":"Titolo Video","youtube_analytics.views":"Visualizzazioni","youtube_analytics.addToChannel":"Aggiungi al canale","youtube_analytics.noIncomingData":"Nessun dato in arrivo.","youtube_analytics.videoAdded":"Video aggiunto!","youtube_analytics.dragDrop":"Trascina qui lo screenshot","youtube_analytics.thumbnailUpdated":"Miniatura aggiornata","youtube_analytics.statsTrend":"Trend Statistiche","youtube_analytics.currentChannel":"Canale Corrente","youtube_analytics.growth":"Crescita","youtube_analytics.allChannels":"Tutti i Canali","youtube_analytics.saveDisk":"Salva su Disco","youtube_analytics.saveCatalog":"Salva in Catalogo","youtube_analytics.loadDisk":"Carica da Disco","youtube_analytics.analyzing":"Analisi...","youtube_analytics.askAI":"Chiedi all'IA","youtube_analytics.clickForAdvice":`Clicca "Chiedi all'IA".`,"youtube_analytics.dailyNotes":"Note Giornaliere","youtube_analytics.logDailyStats":"Log Statistiche","youtube_analytics.subscribers":"Iscritti","youtube_analytics.totalViews":"Vis. Totali","youtube_analytics.updateStats":"Aggiorna","youtube_analytics.history":"Cronologia","youtube_analytics.noHistory":"Nessuna cronologia.","youtube_analytics.noNotes":"Nessuna nota.","youtube_analytics.noVideos":"Nessun video.","youtube_analytics.loadedFromDisk":"Caricato","youtube_analytics.loadFailed":"Caricamento fallito","youtube_analytics.savedToDisk":"Salvato","youtube_title_generator.mode.title":"Titolo Video","youtube_title_generator.mode.channel":"Info Canale","youtube_title_generator.ideaPlaceholder":"Inserisci idea video...","youtube_title_generator.channelIdeaPlaceholder":"Inserisci tema canale...","youtube_title_generator.title":"Titolo","youtube_title_generator.description":"Descrizione","youtube_title_generator.tags":"Tag","youtube_title_generator.channelName":"Nome Canale","youtube_title_generator.channelDescription":"Descrizione Canale","youtube_title_generator.channelKeywords":"Parole chiave","youtube_title_generator.channelHandle":"Handle (@)","music_idea_generator.mode.lyrics":"Testo Canzone","music_idea_generator.mode.music_prompt":"Prompt Musicale","music_idea_generator.ideaPlaceholder":"Inserisci tema o umore...","music_idea_generator.songTitle":"Titolo Canzone","music_idea_generator.songTitlePlaceholder":"Titolo...","music_idea_generator.lyricsPlaceholder":"Il testo apparir qui...","music_idea_generator.musicPromptPlaceholder":"Il prompt musicale IA apparir qui...","chat.mode.general":"Generale","chat.mode.script":"Esperto Sceneggiatura","chat.mode.prompt":"Esperto Prompt","chat.mode.youtube":"Esperto YouTube"},Gb={"catalog.title":"Catalogo","catalog.tabs.groups":"Gruppi","catalog.tabs.library":"Libreria Prompt","catalog.tabs.characters":"Personaggi","catalog.tabs.scripts":"Sceneggiature","catalog.tabs.analysis":"Analisi","catalog.tabs.final_prompts":"Prompt Finali","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"Idee Musicali","catalog.empty.title":"Il catalogo  vuoto","catalog.empty.description":"Salva un elemento per vederlo qui, o importane uno.","catalog.loadFromFile":"Carica da file","catalog.card.addToCanvas":"Aggiungi al Canvas","catalog.card.rename":"Rinomina","catalog.card.save":"Salva su disco","catalog.card.delete":"Elimina","library.loadFromFile":"Carica da file","library.empty.title":"Cartella vuota","library.empty.description":"Crea una nuova cartella o un prompt.","library.emptyPrompt":"Nessun contenuto","library.actions.newFolder":"Nuova Cartella","library.actions.newPrompt":"Nuovo Prompt","library.actions.copy":"Copia negli appunti","library.actions.edit":"Modifica Prompt","group.rename":"Rinomina gruppo","group.saveToCatalog":"Salva nel catalogo","group.saveToDisk":"Salva su disco","group.ungroup":"Separa (Shift+Click per eliminare)","group.button.create":"Raggruppa ({count})"},Ub={"dialog.rename.title":"Rinomina","dialog.rename.group.title":"Rinomina Gruppo","dialog.rename.catalog.title":"Rinomina Elemento Catalogo","dialog.rename.label":"Nuovo nome","dialog.rename.confirm":"Rinomina","dialog.rename.cancel":"Annulla","dialog.promptEdit.title":"Modifica Prompt","dialog.promptEdit.nameLabel":"Nome","dialog.promptEdit.contentLabel":"Contenuto","dialog.promptEdit.confirm":"Salva","dialog.promptEdit.cancel":"Annulla","dialog.reset.title":"Reimposta Canvas","dialog.reset.message":"Sei sicuro di voler reimpostare il canvas? Tutto il lavoro non salvato andr perso.","dialog.exit.title":"Chiudere Progetto?","dialog.exit.message":"Sei sicuro? I dati non salvati andranno persi.","dialog.settings.title":"Impostazioni","dialog.settings.apiKeyLabel":"Chiave API Gemini","dialog.settings.apiKeyPlaceholder":"Inserisci qui la tua chiave","dialog.settings.getApiKeyLink":"Ottieni chiave API da Google AI Studio","dialog.settings.useFreeKey":"Usa chiave gratuita (limitata)","dialog.settings.save":"Salva","dialog.settings.close":"Chiudi","dialog.apiKey.title":"Impostazioni Chiave API","dialog.apiKey.description":" richiesta una chiave API Gemini. Sar salvata localmente.","dialog.apiKey.keyExists":"Una chiave API  gi salvata.","dialog.apiKey.clear":"Elimina chiave","dialog.apiKey.save":"Salva chiave","dialog.apiKey.update":"Aggiorna chiave","dialog.apiKey.useFreeKey":"Usa chiave gratuita (Sviluppo)","dialog.permission.title":"Accesso Appunti","dialog.permission.description":`Questa applicazione richiede l'accesso agli appunti per la funzione "Incolla".`,"dialog.permission.decline":"Rifiuta","dialog.permission.allow":"Consenti","alert.groupSaved":'Gruppo "{groupTitle}" salvato nel catalogo!',"toast.groupSavedToDisk":'Gruppo "{groupTitle}" salvato su disco!',"alert.confirmDelete":"Vuoi davvero eliminare questo elemento?","alert.invalidCatalogFile":"File catalogo non valido.","alert.loadCatalogFailed":"Caricamento elemento fallito","alert.confirmLoadProject":"Caricare un progetto sostituir tutti i dati attuali. Sei sicuro?","dialog.confirmDelete.title":"Conferma eliminazione","dialog.confirmDelete.message":'Sei sicuro di voler eliminare "{itemName}"? Azione irreversibile.',"dialog.confirmDelete.folderMessage":'Sei sicuro di voler eliminare la cartella "{itemName}" e il suo contenuto?',"dialog.confirmDelete.confirm":"Elimina","dialog.confirmDelete.cancel":"Annulla","dialog.confirmClear.title":"Conferma pulizia","dialog.confirmClear.message":"Vuoi davvero cancellare tutto dal canvas?","toast.copied":"Copiato negli appunti","toast.pasted":"Incollato!","toast.cleared":"Pulito","toast.resetComplete":"Reimpostato","toast.projectSaved":"Progetto salvato","toast.canvasSaved":"Canvas salvato su disco","toast.saveFailed":"Salvataggio fallito","toast.connectionsCut":"Connessioni tagliate","toast.charSaved":"Personaggio salvato","toast.charLoaded":"Personaggio caricato","toast.videoPasted":"Video incollato dagli appunti","toast.savedToCatalog":"Salvato nel catalogo","toast.apiKeySaved":"Chiave API salvata","toast.apiKeyCleared":"Chiave API eliminata","toast.projectLoaded":"Progetto caricato","alert.batchMismatch":"Attenzione: Discrepanza numero frame nella scena {scene}."},Hb={"instruction.desc.safe_gen":"SICUREZZA CRITICA: Evita rigorosamente parole che attivano i filtri di sicurezza IA. Sostituisci termini come 'adolescente', 'intimo' o 'rivelatore' con alternative artistiche come 'giovane persona', 'composizione artistica' o 'stilizzato'.","instruction.desc.layered_no_style":"Struttura: 1. [Sfondo Globale (Cielo -> Orizzonte -> Piano Medio)] -> 2. [Gerarchia Soggetto (Personaggio Completo -> Posa -> Micro-Azione)] -> 3. [Camera]. NON descrivere MAI un'azione senza prima descrivere il personaggio completo."},Bb={"instruction.sg_inputs":"Dati Input","instruction.desc.sg_inputs":"Fonte: Concetto/Idea, Profili Personaggi.","instruction.core_director":"Regista","instruction.desc.core_director":"Sei un Regista Visionario. Pensa in obiettivi, movimento e composizione.","instruction.sg_thinking":"Analizzare","instruction.desc.sg_thinking":"Ragionare prima di scrivere. Analizzare causalit e logica. Eliminare i clich.","instruction.sg_improve_input":"Script Doctor","instruction.desc.sg_improve_input":"Migliorare concetto iniziale, correggere buchi trama, affinare conflitto.","instruction.sg_exposition":"Esposizione","instruction.desc.sg_exposition":"Mostrare lo stato del mondo attraverso storia ambientale e dettagli.","instruction.sg_delayed_reveal":"Rivelazione","instruction.desc.sg_delayed_reveal":"Intro graduale: ambiente -> dettagli -> silhouette -> viso.","instruction.sg_metaphor":"Metafora","instruction.desc.sg_metaphor":"Usare simboli visivi per stati interni.","instruction.sg_pacing":"Ritmo","instruction.desc.sg_pacing":"Controllo ritmo: bilanciare inquadrature contemplative e montaggio dinamico.","instruction.sg_subtext":"Sottotesto","instruction.desc.sg_subtext":"Tensione tra dialogo e azione.","instruction.desc.sg_frame_estimation":"Calcolo raccomandato numero inquadrature.","instruction.rule_visuals":"Visual Prima","instruction.desc.rule_visuals":"Mostra, non dire. Focus su luce, composizione, movimento.","instruction.sg_visual_dna":"DNA Visivo","instruction.desc.sg_visual_dna":"Guida tecnica LookDev (Luci, Lenti, Stile render).","instruction.rule_flow":"Flusso Continuo","instruction.desc.rule_flow":"Logica Match Cut: Usare forme/colori per le transizioni.","instruction.rule_atmosphere":"Atmosfera","instruction.desc.rule_atmosphere":"Dettagli tattili: odore pioggia, ronzio neon, polvere.","instruction.sg_visual_style":"Stile Visivo","instruction.desc.sg_visual_style":"Richiesta: Descrizione dettagliata dello stile basata su '{style}'.","instruction.char_detailed_style":"Dettaglio Stilizzato","instruction.desc.char_detailed_style":"Integra lo stile globale in ogni prompt personaggio.","instruction.sg_genre":"Contesto Genere","instruction.desc.sg_genre":"Contesto: {genre}","instruction.char_smart_concept":"Smart Concept","instruction.desc.char_smart_concept":"IA sceglie: Corpo intero per Personaggi / Riempimento per Oggetti.","instruction.char_no_dupes":"No Duplicati","instruction.desc.char_no_dupes":"CRITICO: NON rigenerare personaggi a meno che non ci sia CAMBIO COSTUME.","instruction.create_secondary_chars":"Personaggi Secondari","instruction.desc.create_secondary_chars":"Permette creazione di personaggi secondari se necessario.","instruction.create_key_items":"Oggetti Chiave","instruction.desc.create_key_items":"Creazione obbligatoria di 'Schede Personaggio' per oggetti importanti.","instruction.char_secondary_ok":"Nuovi permessi","instruction.desc.char_secondary_ok":"Nuovi personaggi o oggetti permessi. Se cambia abito, crea nuova scheda.","instruction.sg_anthro":"Anthro","instruction.desc.sg_anthro":"I personaggi devono essere animali antropomorfi.","instruction.sg_no_chars":"No Personaggi","instruction.desc.sg_no_chars":"Stile documentario / Nessun personaggio nominato.","instruction.sg_detailed_plot":"Trama Dettagliata","instruction.desc.sg_detailed_plot":"Descrizioni molto dettagliate delle azioni.","instruction.sg_subscribe":"Scena Iscrizione","instruction.desc.sg_subscribe":"Includere scena che rompe la quarta parete per iscrizione.","instruction.char_gray_bg":"Concetto Visivo","instruction.desc.char_gray_bg":"Per ogni prompt visivo, AGGIUNGI SEMPRE: ', full body character concept on a gray background'.","instruction.char_no_new":"Niente Nuovi","instruction.desc.char_no_new":"NON creare nuovi personaggi. Usa solo quelli esistenti.","instruction.sg_new_chars":"Nuovi Personaggi","instruction.desc.sg_new_chars":"Genera nuovi personaggi basati sul prompt.","instruction.sg_living_world":"Mondo Vivo","instruction.desc.sg_living_world_simple":"Le comparse sono umani normali.","instruction.desc.sg_living_world_anthro":"Le comparse sono animali antropomorfi.","instruction.sg_simple_actions":"Azioni Semplici","instruction.desc.sg_simple_actions":"Evitare fisica complessa. Preferire pose stabili.","instruction.commercial_safe":"Sicurezza Commerciale","instruction.desc.commercial_safe":"Evita rigorosamente marchi registrati (Disney, Pixar) e li sostituisce con descrizioni generiche."},Vb={"instruction.ana_role":"Ruolo Analizzatore","instruction.desc.ana_role":"Sei un Regista di classe mondiale. Scrivi istruzioni tecniche per generazione IA. Ogni frame deve essere descritto indipendentemente e in dettaglio.","instruction.ana_cinema":"Cinematografia","instruction.desc.ana_cinema":"Termini pro: Wide Shot, Close-up, Dutch Angle, Bokeh.","instruction.ana_cinema_wide":"Cinematografia (Larga)","instruction.desc.ana_cinema_wide":"Termini pro: Wide Shot, Long Shot. NO Primi Piani.","instruction.ana_anthro_logic":"Logica Anthro","instruction.desc.ana_anthro_logic":"Descrivere esplicitamente i personaggi come Animali Antropomorfi.","instruction.ana_subscribe_logic":"Appello Iscrizione","instruction.desc.ana_subscribe_logic":'Azioni visive per "Iscriviti": cartelli, testo 3D.',"instruction.rule_hierarchy":"Algoritmo Inquadratura","instruction.desc.rule_hierarchy":"Ordine rigoroso: 1. Globale (Luogo/Meteo). 2. Postura Soggetto. 3. Interazione Oggetto. 4. Azione.","instruction.rule_living_world":"Mondo Vivo","instruction.desc.rule_living_world":"Descrivere comparse coerenti con il mondo.","instruction.desc.rule_living_world_anthro":"Le comparse devono essere animali antropomorfi.","instruction.rule_persistence":"Persistenza","instruction.desc.rule_persistence":"Mantenere coerenza cronologica della scena. Tracciare oggetti e posizioni tra i frame.","instruction.rule_mandatory_bg":"Sfondo Obbligatorio","instruction.desc.rule_mandatory_bg":"VIETATO lasciare sfondo vuoto. Descrivere sempre luogo e luce.","instruction.desc.rule_mandatory_bg_wide":"VIETATO lasciare sfondo vuoto. In campo largo, descrivere sempre geografia e orizzonte.","instruction.shot_filter_wide":"Solo Campi Larghi","instruction.desc.shot_filter_wide":"FILTRO RIGOROSO: Solo Wide (WS), Long (LS) e Medium (MS). Primi piani vietati.","instruction.storyboard_rules":"Variet Inquadrature","instruction.desc.storyboard_rules":"Alternare WS/LS, MS e CU/ECU per dinamismo.","instruction.storyboard_rules_wide":"Variet Inquadrature (Larga)","instruction.desc.storyboard_rules_wide":"Solo Wide, Long e Establishing. Variare angolo. NO Primi piani.","instruction.tech_directives":"Controllo Camera","instruction.desc.tech_directives":"Terminologia rigorosa. Solo abbreviazioni (WS, MS, CU).","instruction.tech_directives_wide":"Controllo Camera (Larga)","instruction.desc.tech_directives_wide":"Terminologia rigorosa. Solo WS, MS, LS. No CU/ECU.","instruction.use_aliases":"Usa Alias","instruction.desc.use_aliases":"Usa formato Character-N.","instruction.action_phase_breakdown":"Micro-Azioni","instruction.desc.action_phase_breakdown":"Scomporre azioni complesse in fasi (Preparazione, Inizio, Apice, Reazione).","instruction.desc.action_phase_breakdown_wide":"Scomporre fasi, ma MANTENERE CAMERA LARGA. Mostrare impatto tramite postura.","instruction.batch_processing":"Elaborazione Batch","instruction.desc.batch_processing":"Analizzare tutte le scene come sequenza continua.","instruction.ana_prompt_lang":"Lingua Prompt","instruction.desc.ana_prompt_lang":"Prompt rigorosamente in Inglese per compatibilit.","instruction.extended_visuals":"Visualizzazione Estesa","instruction.desc.extended_visuals":"Scompone scene in sequenze espressive (Wide, MS, CU, Dettaglio).","instruction.extended_visuals_wide":"Visualizzazione Estesa (Larga)","instruction.desc.extended_visuals_wide":"Scompone scene in sequenze di piani Larghi/Medi. Focus su geografia.","instruction.desc.target_lang":"Lingua di analisi.","instruction.rule_isolation":"Zero Contesto","instruction.desc.rule_isolation":"CRITICO: Il generatore NON CONOSCE il frame precedente. Ri-descrivere l'ambiente a ogni frame.","instruction.sensory_saturation":"Anti-Brevit","instruction.desc.sensory_saturation":"VIETATO essere brevi. Descrivere texture, luce e peso fisico.","instruction.ana_no_pov":"No POV","instruction.desc.ana_no_pov":'NEGATIVO CRITICO: DIVIETO RIGOROSO di inquadrature "POV" o "Prima Persona". La telecamera DEVE essere esterna.',"instruction.desc.static_frame_logic":'DIVIETO ASSOLUTO verbi di movimento ("camminare"). Descrivere un momento CONGELATO.',"instruction.desc.anatomical_posing":'Descrivere GEOMETRIA corpo. Invece di "riposare", scrivere "supino, braccia ai lati".',"instruction.desc.motion_dynamics":"SEPARAZIONE: Image Prompt = 100% Statico. Video Prompt = Movimento & Tempo.","instruction.desc.anatomical_strictness":'RIGGING: "Braccia dietro testa E tiene bicchiere" vietato. Descrivere separatamente: Braccio SX [stato], Braccio DX [stato].',"instruction.desc.prop_consistency":'BLOCCO OGGETTO: No nomi generici ("spada"). Attributi visivi ("spada ferro arrugginito") obbligatori.',"instruction.desc.subject_hierarchy":"Anche per Primi piani: 1. Personaggio Completo/Postura. 2. Interazione con Ambiente. 3. Dettaglio.","instruction.inputs_data":"Input","instruction.desc.inputs_data":"Dati fonte: Riassunto, Profili, Testi scene."},$b={"instruction.inputs":"Input","instruction.desc.inputs":"Fonte: Frame analizzatore, Profili visivi, Stile scena.","instruction.role":"Ruolo: Lead Environment Artist","instruction.desc.role":"Esperto Prompt Engineering. Sintetizza gli input in una descrizione visiva definitiva.","instruction.layered":"Algoritmo: Flusso Unificato","instruction.desc.layered":"Genera UN SOLO blocco di testo fluido. Struttura: [Stile] -> [DESIGN SET MASTER] -> [Visivi] + [POSA & AZIONE] -> [Camera].","instruction.desc.layered_no_char":"Struttura: [DESIGN SET MASTER] -> [Indice] + [POSA & AZIONE]. Omette aspetto, tiene solo indici e azioni.","instruction.visuals":"Stile: Saturazione","instruction.desc.visuals":"Usa descrittori ricchi: luce volumetrica, texture 8k, profondit di campo.","instruction.process_whole_scene":"Batch Scena","instruction.desc.process_whole_scene":"Analizzare intera scena insieme per coerenza.","instruction.video":"Video","instruction.desc.video":"Video Prompt: [Indice] (Dettaglio Visivo) [Azione]. Dinamica: [Ambiente]. Camera: [Movimento]. NO NOMI.","instruction.stateless":"Regola: Senza Stato","instruction.desc.stateless":"Ogni frame  indipendente. Ri-descrivere ambiente. Ri-descrivere azione da zero.","instruction.rule_static":"Regola: Statico","instruction.desc.rule_static":"Descrivere solo momento congelato. No transizioni.","instruction.atmosphere_fix":"Ancora Atmosferica","instruction.desc.atmosphere_fix":"Descrivere umore come propriet fisiche di aria e luce.","instruction.subject_focus":"Gerarchia Contesto","instruction.desc.subject_focus":"CRITICO: Anche per Primi piani: 1. Pers. Completo. 2. Posa. 3. Dettaglio. L'IA necessita contesto corporeo.","instruction.always_env":"DESIGN SET OBBLIGATORIO","instruction.desc.always_env":"CRITICO: Usa il 'Contesto Scena Globale' fornito come la VERIT ASSOLUTA per lo sfondo. DEVI iniettare i dettagli specifici di mobili, illuminazione e texture dal contesto nel livello ambiente di OGNI prompt. Non allucinare sfondi generici.","instruction.pm_anthro":"Dettaglio Anthro","instruction.desc.pm_anthro":'OBBLIGATORIO: Parola "anthropomorphic" prima della specie in Immagine E Video. Texture/anatomia migliorate.',"instruction.pm_subscribe":"Testo Leggibile","instruction.desc.pm_subscribe":'Assicurare che testo come "SUBSCRIBE" sia leggibile e integrato (neon, cartelli).',"instruction.strict_char_index":"Personaggi","instruction.desc.strict_char_index":"Mappare rigorosamente Alias (Character-N) ai dati frame.","instruction.no_names":"CRITICO: NO NOMI","instruction.desc.no_names":"CRITICO: DIVIETO ASSOLUTO NOMI. Usare SOLO ID Indice in parentesi quadre `[Character-N]`.","instruction.general_char_desc":"Dettaglio Generale","instruction.desc.general_char_desc":"Integrare versione CONCISA e GENERALE del prompt visivo.","instruction.full_char_desc":"Dettaglio Completo","instruction.desc.full_char_desc":"Integrare prompt visivo COMPLETO del profilo esattamente com'.","instruction.formatting":"Formattazione","instruction.desc.formatting":"Attiva INTESTAZIONI esplicite e a capo per struttura.","instruction.anatomical_strictness":"Logica Anatomia","instruction.desc.anatomical_strictness":'RIGGING: Previene "Braccia dietro testa E tiene bicchiere". Forza descrizione separata.',"instruction.img_vid_consistency":"Flusso Img->Vid","instruction.desc.img_vid_consistency":"Image Prompt = Start/Statico. Video Prompt = Azione/Evoluzione. Il video deve evolvere dall'immagine.","instruction.desc.prop_enhancement":'MATERIALIT: Amplifica descrizioni oggetti (es. "tavola rossa" -> "fiberglass rosso lucido").',"instruction.no_pov":"CRITICO: NO POV","instruction.desc.no_pov":"DIVIETO RIGOROSO angoli POV. Camera DEVE essere esterna (Terza Persona)."},Wb={"instruction.music_role":"Ruolo Produttore","instruction.desc.music_role":"Compositore esperto e paroliere.","instruction.music_input":"Dati Input","instruction.desc.music_input":"Tema o idea dell'utente.","instruction.music_creative":"Libert Creativa","instruction.desc.music_creative":"Forza l'IA a interpretare l'atmosfera metaforicamente, non letteralmente.","instruction.music_lyrics":"Struttura Testo","instruction.desc.music_lyrics":"Genera struttura Strofa/Ritornello adatta al genere.","instruction.music_prompt_rule":"Prompt Musicale IA","instruction.desc.music_prompt_rule":"Tag tecnici per Suno/Udio (BPM, Strumenti, Voci). Max 1000 caratteri.","instruction.music_format":"Output JSON","instruction.desc.music_format":"Struttura JSON rigorosa per integrazione."},Yb={"instruction.yt_role":"Stratega YouTube","instruction.desc.yt_role":"Esperto SEO, CTR e psicologia virale.","instruction.yt_input":"Dati Input","instruction.desc.yt_input":"Argomento o nicchia fornita.","instruction.yt_title_mode":"Metadati Video","instruction.desc.yt_title_mode":"Ottimizza Titoli/Desc/Tag per massimi click.","instruction.yt_channel_mode":"Branding Canale","instruction.desc.yt_channel_mode":"Crea Nome, Bio e Handle coerenti.","instruction.yt_format":"Output JSON","instruction.desc.yt_format":"Struttura JSON rigorosa per integrazione."},qb={...Hb,...Bb,...Vb,...$b,...Wb,...Yb},Kb={...Db,...Ob,...Fb,...zb,...Gb,...Ub,...qb},Jb={"app.title":"Script Modifier","app.description":"Crie, refine e gere roteiros visualmente com a API Gemini.","app.slogan":"Conecte ideias para criar uma obra-prima","app.subtitle":"Visualize seus Roteiros","app.error.title":"Notificao","app.error.copy":"Copiar Erro","app.error.copied":"Copiado!","error.quotaExceeded":"Voc atingiu seu limite de uso. Verifique a cota da sua chave API ou tente novamente mais tarde.","error.apiKeyMissing":"Chave API no encontrada. Por favor, defina sua chave API Gemini nas configuraes.","error.freeKeyNotAvailable":"A chave API gratuita/de desenvolvimento no est disponvel neste ambiente. Por favor, fornea sua prpria chave.","error.fileReadError":"Erro ao ler o arquivo.","error.videoConversionError":"Falha ao converter vdeo para udio.","error.unsupportedFile":"Tipo de arquivo no suportado.","error.promptModifierFile":"Este arquivo pertence a outra aplicao (Prompt Modifier). Por favor, abra-o nessa aplicao.","error.invalidFileType":"Tipo de arquivo invlido. Por favor, carregue um arquivo de Projeto ou Canvas do Script Modifier.","welcome.iAmDeveloper":"Sou Desenvolvedor","welcome.letsGo":"Vamos l!","welcome.resume":"Continuar","welcome.reload":"Recarregar","welcome.reloadTitle":"Redefinir e Recarregar?","welcome.reloadMessage":"Isso limpar todo o canvas e recarregar a aplicao. Dados no salvos sero perdidos. Tem certeza?","welcome.confirmReload":"Redefinir e Recarregar","dialog.welcome.title":"Script Modifier","dialog.welcome.heading":"Bem-vindo ao","dialog.welcome.intro1":"Bem-vindo ao Script Modifier - seu espao de trabalho visual para criar histrias com o Gemini.","dialog.welcome.intro2":"Para comear, selecione seu idioma e insira sua chave API Gemini.","dialog.welcome.apiKeyExplanation":"Sua chave API  armazenada localmente no seu navegador. No a enviamos para nenhum servidor alm da API do Google Gemini."},Xb={"toolbar.edit":"Editar (V)","toolbar.cutter":"Cortar Conexo (C)","toolbar.selection":"Seleo (S)","toolbar.reroute":"Ponto de Roteamento (R)","toolbar.zoom":"Zoom (Z)","toolbar.snapToGrid":"Alinhar  Grade (Shift+W)","toolbar.resetZoom":"Redefinir Zoom","toolbar.lineStyleSpaghetti":"Linhas Spaghetti (Shift+E)","toolbar.lineStyleOrthogonal":"Linhas Ortogonais (Shift+E)","toolbar.addNode":"Adicionar N (F)","toolbar.catalog":"Catlogo (Ctrl+Espao)","toolbar.settings":"Configuraes","toolbar.resetToDefault":"Restaurar Padro","toolbar.closeProject":"Fechar Projeto / Limpar","toolbar.enterFullscreen":"Tela Cheia","toolbar.exitFullscreen":"Sair da Tela Cheia","toolbar.home":"Incio","toolbar.addTextInput":"Entrada de Texto (T)","toolbar.addPromptAnalyzer":"Analisador de Prompt (A)","toolbar.addCharacterAnalyzer":"Analisador de Personagem","toolbar.addCharacterGenerator":"Gerador de Personagens (Shift+C)","toolbar.addImageGenerator":"Gerador de Imagens (O)","toolbar.addImagePreview":"Pr-visualizao de Imagem (I)","toolbar.addCharacterCard":"Carto de Personagem (Ctrl+Shift+C)","toolbar.addPromptProcessor":"Processador de Prompt (P)","toolbar.addGeminiChat":"Chat Gemini (G)","toolbar.addTranslator":"Tradutor (L)","toolbar.addIdeaGenerator":"Gerador de Ideias (Shift+A)","toolbar.addScriptGenerator":"Gerador de Roteiro (Shift+S)","toolbar.addScriptAnalyzer":"Analisador de Roteiro (Shift+D)","toolbar.addScriptPromptModifier":"Finalizador de Prompt (Shift+F)","toolbar.addErrorAnalyzer":"Analisador de Erros","toolbar.addNote":"Nota (N)","toolbar.addDataReader":"Leitor de Dados (Shift+R)","toolbar.addSpeechSynthesizer":"Sintetizador de Voz (Shift+N)","toolbar.addNarratorTextGenerator":"Gerador de Texto Narrador (Shift+G)","toolbar.addAudioTranscriber":"Transcritor de udio (Shift+B)","toolbar.addYouTubeTitleGenerator":"Gerador de Ttulos YouTube (Shift+T)","toolbar.addMusicIdeaGenerator":"Gerador de Ideias Musicais (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube Analytics (Shift+Y)","toolbar.saveCanvas":"Salvar Canvas (Ctrl+S)","toolbar.saveProject":"Salvar Projeto (Ctrl+Shift+S)","toolbar.loadCanvas":"Carregar (Ctrl+O)","toolbar.clearCanvas":"Limpar Canvas","toolbar.group.general":"Geral","toolbar.group.scripting":"Roteiro","toolbar.group.prompting":"Prompts e Anlise","toolbar.group.characters":"Personagens","toolbar.group.ai":"Ferramentas IA","toolbar.group.file":"Arquivo","toolbar.group.images":"Imagens","toolbar.group.audio":"udio","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"Controles do Canvas","toolbar.expand":"Expandir Painel","toolbar.collapse":"Recolher Painel","toolbar.toggleHeaders":"Alternar Cabealhos","hotkeys.file.title":"Arquivo","hotkeys.file.save":"Salvar Canvas (Ctrl+S)","hotkeys.file.saveProject":"Salvar Projeto (Ctrl+Shift+S)","hotkeys.file.load":"Carregar Canvas (Ctrl+O)","hotkeys.tools.title":"Ferramentas","hotkeys.tools.edit":"Editar","hotkeys.tools.cutter":"Cortar","hotkeys.tools.selection":"Seleo","hotkeys.tools.reroute":"Roteamento","hotkeys.tools.zoom":"Zoom","hotkeys.tools.group":"Agrupar (G)","hotkeys.tools.deleteGroup":"Excluir grupo","hotkeys.tools.closeNode":"Fechar N","hotkeys.tools.toggleLineStyle":"Alternar Estilo de Linha","hotkeys.tools.snapToGrid":"Alinhar  Grade","hotkeys.tools.selectAll":"Selecionar Tudo","hotkeys.tools.deselectAll":"Desmarcar Tudo","hotkeys.tools.duplicate":"Duplicar com Contedo","hotkeys.windows.title":"Janelas","hotkeys.windows.search":"Buscar Ns (F)","hotkeys.windows.quickAdd":"Adio Rpida (Espao)","hotkeys.windows.catalog":"Catlogo","hotkeys.createNode.title":"Criar N","hotkeys.hide":"Ocultar Atalhos","help.title":"Atalhos de Teclado","hotkeys.show":"Mostrar Atalhos","search.placeholder":"Buscar um n...","search.noResults":"Nenhum n encontrado.","search.node.text_input.title":"Entrada de Texto","search.node.text_input.description":"Uma caixa de texto simples para suas ideias. (T)","search.node.prompt_processor.title":"Processador de Prompt","search.node.prompt_processor.description":"Melhora e combina prompts com IA. (P)","search.node.prompt_analyzer.title":"Analisador de Prompt","search.node.prompt_analyzer.description":"Divide um prompt em ambiente, personagem, ao e estilo. (A)","search.node.character_analyzer.title":"Analisador de Personagem","search.node.character_analyzer.description":"Divide uma descrio em personagem e roupas.","search.node.character_generator.title":"Gerador de Personagens","search.node.character_generator.description":"Cria personagens detalhados a partir de uma ideia. (Shift+C)","search.node.image_generator.title":"Gerador de Imagens","search.node.image_generator.description":"Cria uma imagem a partir de texto. (O)","search.node.image_preview.title":"Pr-visualizao de Imagem","search.node.image_preview.description":"Exibe uma imagem de um arquivo. (I)","search.node.character_card.title":"Carto de Personagem","search.node.character_card.description":"Armazena imagem, nome e prompt de um personagem. (Ctrl+Shift+C)","search.node.gemini_chat.title":"Chat Gemini","search.node.gemini_chat.description":"Conversa direta com Gemini AI. (G)","search.node.translator.title":"Tradutor","search.node.translator.description":"Traduz o texto de entrada para o idioma selecionado. (L)","search.node.script_generator.title":"Gerador de Roteiro","search.node.script_generator.description":"Converte uma ideia em cenas de roteiro. (Shift+S)","search.node.script_analyzer.title":"Analisador de Roteiro","search.node.script_analyzer.description":"Divide um roteiro em quadros e prompts de imagem. (Shift+D)","search.node.script_prompt_modifier.title":"Finalizador de Prompt","search.node.script_prompt_modifier.description":"Finaliza os prompts da anlise para gerao de imagens. (Shift+F)","search.node.error_analyzer.title":"Analisador de Erros","search.node.error_analyzer.description":"Verifica e corrige ortografia e gramtica.","search.node.note.title":"Nota","search.node.note.description":"Uma rea de texto simples para anotaes. (N)","search.node.reroute_dot.title":"Ponto de Roteamento","search.node.reroute_dot.description":"Um ponto para redirecionar conexes.","search.node.data_reader.title":"Leitor de Dados","search.node.data_reader.description":"Exibe dados brutos de um n conectado.","search.node.speech_synthesizer.title":"Sintetizador de Voz","search.node.speech_synthesizer.description":"Converte texto em fala. (Shift+N)","search.node.idea_generator.title":"Gerador de Ideias","search.node.idea_generator.description":"Gera categorias e as combina em uma ideia.","search.node.narrator_text_generator.title":"Gerador de Texto Narrador","search.node.narrator_text_generator.description":"Gera texto para narrador ou locutor. (Shift+G)","search.node.audio_transcriber.title":"Transcritor de udio","search.node.audio_transcriber.description":"Converte arquivos de udio/vdeo em texto. (Shift+B)","search.node.youtube_title_generator.title":"Gerador de Ttulos YouTube","search.node.youtube_title_generator.description":"Gera ttulos, descries e tags para YouTube.","search.node.music_idea_generator.title":"Gerador de Ideias Musicais","search.node.music_idea_generator.description":"Gera letras ou prompts musicais. (Shift+M)","search.node.youtube_analytics":"YouTube Analytics","search.node.youtube_analytics.description":"Analisa estatsticas do canal e oferece dicas.","search.node.image_editor.title":"Editor de Imagem","search.node.image_editor.description":"Edite imagens com IA (Inpainting, Outpainting).","node.action.help":"Ajuda","node.action.expand":"Expandir","node.action.collapse":"Recolher (H)","node.action.expandAll":"Expandir Tudo","node.action.collapseAll":"Recolher Tudo","node.action.expandAllScenes":"Expandir Todas as Cenas","node.action.collapseAllScenes":"Recolher Todas as Cenas","node.action.expandAllFrames":"Expandir Todos os Quadros","node.action.collapseAllFrames":"Recolher Todos os Quadros","node.action.expandPanel":"Expandir Painel","node.action.collapsePanel":"Recolher Painel","node.action.togglePanel":"Alternar Painel","node.action.collapseScene":"Recolher Cena","node.action.expandScene":"Expandir Cena","node.action.collapseFrame":"Recolher Quadro","node.action.expandFrame":"Expandir Quadro","node.action.collapseCharacter":"Recolher Personagem","node.action.expandCharacter":"Expandir Personagem","node.action.clear":"Limpar","node.action.clearTooltip":"Limpar campo de entrada.","node.action.clearChat":"Limpar Chat","node.action.paste":"Colar","node.action.copy":"Copiar","node.action.duplicateWithContent":"Duplicar (Contedo)","node.action.duplicateEmpty":"Duplicar (Vazio)","node.action.cutConnections":"Cortar Conexes","node.action.close":"Fechar","node.action.executeChain":"Executar Cadeia","node.action.executeFullChain":"Executar Cadeia Completa","node.action.processChainForward":"Processar Cadeia Adiante","node.action.executeChainTitle":"Executar todos os ns conectados.","node.action.addCharacter":"Adicionar Personagem","node.action.addScene":"Adicionar Cena","node.action.addFrame":"Adicionar Quadro","node.action.addFirstFrame":"Adicionar Primeiro Quadro","node.action.deleteItem":"Excluir","node.action.moveUp":"Mover para Cima","node.action.moveDown":"Mover para Baixo","node.action.saveImage":"Salvar Imagem","node.action.loadImage":"Carregar Imagem","node.action.saveCharacter":"Salvar Personagem","node.action.loadCharacter":"Carregar Personagem","node.action.readData":"Ler Dados","node.action.refreshData":"Atualizar Dados","node.action.stop":"Parar","node.action.stopping":"Parando...","node.action.embedCharacter":"Incorporar Personagem","node.action.downloadFinalPrompts":"Baixar Prompts","node.action.rename":"Renomear","node.action.index":"Indexar","node.action.improveConcept":"Melhorar Conceito","node.action.improveConceptTooltip":"Enriquecer e adicionar detalhes visuais.","node.action.downloadJson":"Baixar JSON","node.action.downloadSRT":"Baixar SRT","node.action.markPrimary":"Marcar como Principal","node.input.default":"Entrada","node.output.default":"Sada","node.output.allCharacters":"Todos os Personagens","node.output.primaryCharacter":"Personagem Principal","node.content.action":"Ao","node.content.actionPlaceholder":"Prompt de ao...","node.content.allScriptParts":"Todas as partes do roteiro","node.content.allScriptAnalyzerData":"Dados do analisador","node.content.allNarratorData":"Todos os dados do narrador","node.content.analyzeCharacters":"Analisar personagens","node.content.analyzeFromScene":"Analisar de:","node.content.analyzeUpToScene":"at","node.content.endPlaceholder":"fim","node.content.generateFromFrame":"Gerar do quadro:","node.content.generateUpToFrame":"at o quadro","node.content.analyzeFromFrame":"Finalizar do quadro:","node.content.processFromFrame":"Processar do quadro:","node.content.processFromScene":"Processar da cena:","node.content.analyzePrompt":"Analisar prompt","node.content.analyzeScript":"Analisar roteiro","node.content.analyzing":"Analisando...","node.content.applyAliases":"Aplicar Alias","node.content.applyAliasesTooltip":"Substitui nomes por alias (ndice).","node.content.character":"Personagem","node.content.characterIndex":"ndice","node.content.characterPlaceholder":"Prompt do personagem...","node.content.character_plural":"personagens","node.content.characters":"Personagens","node.content.charactersSynced":"Personagens sincronizados","node.content.noCharactersConnected":"Nenhum personagem conectado.","node.content.appearance":"Aparncia","node.content.personality":"Personalidade","node.content.characterType":"Tipo","node.content.characterTypeShort":"Tipo","node.content.characterType.simple":"Simples","node.content.characterType.anthro":"Anthro (Animais)","node.content.characterType.chibi":"Chibi (Fofo)","node.content.characterType.key_item":"Item Chave","node.content.style":"Estilo","node.content.style.none":"Nenhum","node.content.style.simple":"Simples","node.content.style.realistic":"Realista/Cinema","node.content.style.3d_cartoon":"Cartoon 3D","node.content.style.3d_realistic":"3D Realista","node.content.style.2d_animation":"Animao 2D","node.content.style.anime":"Anime","node.content.style.comics":"Quadrinhos","node.content.style.custom":"Especial","node.content.chatPlaceholder":"Digite uma mensagem...","node.content.clothing":"Roupas","node.content.clothingPlaceholder":"Prompt de roupas...","node.content.connectedPlaceholder":"Conectado","node.content.dataPlaceholder":"Dados aparecero aqui...","node.content.readData":"Ler Dados","node.content.reading":"Lendo...","node.content.description":"Descrio","node.content.sceneDescription":"Descrio da Cena","node.content.duration":"Durao","node.content.enhancePrompt":"Gerar Prompt","node.content.enhancedPromptHere":"Prompt melhorado aparecer aqui...","node.content.enhancing":"Melhorando...","node.content.environment":"Ambiente","node.content.environmentPlaceholder":"Prompt do ambiente...","node.content.environmentPrompt":"Ambiente & Fundo","node.content.compositionAndBlocking":"Composio & Ao","node.content.executingChain":"Executando cadeia...","node.content.imagePrompt":"Prompt de Imagem","node.content.finalPrompt":"Prompt Final","node.content.finalPrompt_plural":"Prompts Finais","node.content.fixErrors":"Corrigir Erros","node.content.fixingErrors":"Corrigindo...","node.content.frame":"Quadro","node.content.frame_plural":"Quadros","node.content.frames":"Quadros de Sada","node.content.frames_analyzed":"Quadros analisados: {count}","node.content.framesPerScene":"Quadros por Cena","node.content.minFrames":"Mn","node.content.maxFrames":"Mx","node.content.numberOfCharactersShort":"Qtd","node.content.fullDescription":"Descrio Completa","node.content.generateCharacters":"Gerar Personagens","node.content.generateFinalPrompts":"Gerar Prompts Finais","node.content.generatingProgress":"Gerando {current} de {total}","node.content.generateImage":"Gerar Imagem","node.content.generateScript":"Gerar Roteiro","node.content.generateSpeech":"Gerar Fala","node.content.generateText":"Gerar Texto","node.content.generateSSML":"Gerar SSML","node.content.generateStyle":"Gerar Estilo","node.content.generating":"Gerando...","node.content.improving":"Melhorando...","node.content.generatedAudio":"udio gerado","node.content.imagePromptPlaceholder":"Insira prompt para imagem...","node.content.modificationPromptPlaceholder":"Solicitao de modificao...","node.content.narrator":"Narrador","node.content.narratorEnabled":"Habilitar Narrador","node.content.narratorEnabledInfo":"Adiciona texto de locuo.","node.content.narratorMode":"Modo Narrador","node.content.narratorMode.normal":"Normal / Locuo","node.content.narratorMode.dual":"Dois Narradores","node.content.narratorMode.first_person":"Primeira Pessoa","node.content.role":"Papel","node.content.role.narrator":"Narrador","node.content.role.announcer":"Locutor","node.content.role.first_person":"Primeira Pessoa","node.content.role.dual_narrator":"Dois Narradores","node.content.role.dual_announcer":"Dois Locutores","node.content.scene":"Cena","node.content.scene_plural":"cenas","node.content.scenes":"Cenas","node.content.scenes_generated":"Cenas geradas: {count}","node.content.sceneContext":"Contexto da Cena","node.content.sceneContextPlaceholder":"Humor, ambiente, luz...","node.content.scriptPromptPlaceholder":"Insira ideia da histria...","node.content.seconds":"seg","node.content.stylePlaceholder":"Prompt de estilo...","node.content.stylePromptPlaceholder":"Insira prompt de estilo aqui...","node.content.styleOverride":"Substituir Estilo","node.content.summary":"Resumo","node.content.targetLanguage":"Idioma Alvo","node.content.textToSynthesize":"Texto para sintetizar...","node.content.translate":"Traduzir","node.content.translatePlaceholder":"Texto para traduzir...","node.content.translatedTextPlaceholder":"Traduo aparecer aqui...","node.content.translating":"Traduzindo...","node.content.useExistingCharacters":"Usar personagens existentes","node.content.useExistingCharactersInfo":"Usa dados de personagens conectados em vez de gerar novos.","node.content.createKeyItem":"Criar Secundrios/Itens","node.content.createSecondaryChars":"Personagens Secundrios","node.content.createKeyItems":"Itens Chave","node.content.createKeyItemInfo":"Permite  IA criar personagens secundrios ou itens.","node.content.noCharacters":"Sem Personagens","node.content.noCharactersInfo":"Foco em eventos e atmosfera (estilo documentrio).","node.content.videoPrompt":"Dinmica & Movimento","node.content.videoPrompts":"Prompts de Vdeo","node.content.voice":"Voz","node.content.previewVoice":"Testar Voz","node.content.voicePreviewText":"Ol, esta  uma prova de voz.","node.content.inputScripts":"Cenas de Entrada","node.content.inputFrames":"Quadros de Entrada","node.content.outputScript":"Cenas de Sada","node.content.requestCategories":"Pedir Categorias","node.content.generateIdea":"Gerar Ideia","node.content.requestNewCategories":"Novas Categorias","node.content.category.action":"Ao","node.content.category.place":"Lugar","node.content.category.obstacle":"Obstculo","node.content.generatedIdea":"Ideia Gerada","node.content.storyFormat":"Formato da Histria","node.content.theme":"Tema","node.content.parameters":"Parmetros","node.content.advancedMode":"Modo Avanado","node.content.numberOfScenes":"Nmero de Cenas","node.content.numberOfScenes.auto":"Auto","node.content.detailedPlot":"Enredo Detalhado","node.content.detailedPlotInfo":"Habilita descries detalhadas.","node.content.includeSubscribeScene":"Cena de Inscrio","node.content.includeSubscribeSceneInfo":"Adiciona uma cena pedindo para se inscrever.","node.content.genre":"Gnero","node.content.genre2":"Gnero 2","node.content.breakIntoParagraphs":"Pargrafos","node.content.copyVideoPrompt":"Copiar prompt de vdeo","node.content.generateVideoPrompt":"Gerar prompt de vdeo","node.content.model":"Modelo","node.content.processWholeScene":"Processar cena inteira","node.content.processWholeSceneInfo":"Processa todos os quadros de uma cena de uma vez para consistncia.","node.content.batchProcessing":"Processamento em Lote","node.content.batchProcessingInfo":"Processar todas as cenas selecionadas em um contexto.","node.content.extendedAnalysis":"Anlise Estendida","node.content.extendedAnalysisInfo":"Divide cenas em planos detalhados.","node.content.professionalStoryboard":"Storyboard de Diretor","node.content.professionalStoryboardInfo":"Anlise baseada em regras cinematogrficas.","node.content.generateStartEndFrames":"Gerar Quadros Incio/Fim","node.content.autoIndexCharacters":"Auto-indexar Personagens","node.content.autoIndexCharactersInfo":"Substitui nomes automaticamente por alias.","node.content.imageToText":"Imagem para Texto","node.content.extracting":"Extraindo...","node.content.extractedText":"Texto Extrado","node.content.activePromptStack":"Pilha de Prompts Ativa","node.content.noCharactersAnalyzed":"Nenhum personagem analisado.","node.content.promptsGeneratedPlaceholder":"Prompts gerados aparecero aqui.","node.content.noCharactersInScript":"Sem personagens no roteiro.","node.content.noInputScenes":"Sem dados de entrada. Conecte um Gerador de Roteiro.","node.content.status":"Status","node.content.status.ready":"Pronto","node.content.status.paused":"Pausado","node.content.status.generating":"Gerando","node.content.status.total":"Total: {generated} / {total}","node.content.status.batch":"Processando: {current} de {total}","node.content.status.time":"Tempo: {current}s / {total}s","node.content.refreshing":"Atualizando...","node.content.totalFrames":"Total Quadros: {count}","node.content.uploadAudio":"Enviar udio/Vdeo","node.content.noAudioLoaded":"Sem udio","node.content.audioLoaded":"udio Carregado","node.content.transcriptionPlaceholder":"A transcrio aparecer aqui...","node.content.transcribe":"Transcrever","node.content.transcribing":"Transcrevendo...","node.content.convertingVideo":"Convertendo vdeo...","node.content.recommendedFrames":"Quadros Estimados","node.content.shotType":"Plano","node.content.shotType.ws":"WS (Plano Aberto)","node.content.shotType.ms":"MS (Plano Mdio)","node.content.shotType.cu":"CU (Close)","node.content.shotType.ecu":"ECU (Detalhe)","node.content.shotType.ls":"LS (Plano Geral)","node.content.characterDetail":"Detalhes do Personagem","node.content.noCharDesc":"Sem descrio de personagem","node.content.includeGeneralCharDesc":"Descrio visual geral","node.content.includeFullCharDesc":"Descrio visual detalhada","node.content.safeGeneration":"Gerao Segura","node.content.shotFilter":"Filtro de Planos","node.content.shotFilter.all":"Todos","node.content.shotFilter.wideOnly":"Apenas Abertos","instruction.desc.shot_filter_all":"Permitir todos os tipos de plano (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Restringir a planos abertos (WS, MS, LS). Sem closes.","node.content.anthroEnabled":"Animais Antropomrficos","node.content.subscribeEnhancement":"Melhorar Chamada de Inscrio","node.content.thinkingEnabled":"Modo Pensamento","node.content.scenelessMode":"Cenas sem roteiro","instruction.desc.sceneless_mode":"Desativar motor narrativo. Gerar cenas diretamente do conceito.","instruction.sceneless_mode":"Modo Lista de Cenas","node.content.microActionBreakdown":"Micro-Aes","node.content.microActionBreakdownInfo":"Decompe aes complexas em fases (Preparao, Ao, Reao).","node.content.commercialSafe":"Comercialmente Seguro","instruction.desc.commercial_safe":"Evita estritamente marcas registradas (Disney, Pixar) e as substitui por descries genricas.","node.content.findStack":"Buscar na pilha...","node.content.spm_stack.priming":"1. Preparao e Contexto","node.content.spm_stack.physics":"2. Fsica e Lgica","node.content.spm_stack.hierarchy":"3. Hierarquia do Sujeito","node.content.spm_stack.construction":"4. Construo e Formato"},Zb={"node.title.text_input":"Entrada de Texto","node.title.prompt_processor":"Processador de Prompt","node.title.prompt_analyzer":"Analisador de Prompt","node.title.character_analyzer":"Analisador de Personagem","node.title.character_generator":"Gerador de Personagens","node.title.image_generator":"Gerador de Imagens","node.title.image_preview":"Pr-visualizao de Imagem","node.title.character_card":"Carto de Personagem","node.title.gemini_chat":"Chat Gemini","node.title.translator":"Tradutor","node.title.script_generator":"Gerador de Roteiro","node.title.script_analyzer":"Analisador de Roteiro","node.title.script_prompt_modifier":"Finalizador de Prompt","node.title.error_analyzer":"Analisador de Erros","node.title.note":"Nota","node.title.reroute_dot":"Ponto de Roteamento","node.title.data_reader":"Leitor de Dados","node.title.speech_synthesizer":"Sintetizador de Voz","node.title.idea_generator":"Gerador de Ideias","node.title.narrator_text_generator":"Gerador de Texto Narrador","node.title.audio_transcriber":"Transcritor de udio","node.title.youtube_title_generator":"Gerador de Ttulos YouTube","node.title.music_idea_generator":"Gerador de Ideias Musicais","node.title.youtube_analytics":"YouTube Analytics","node.title.image_editor":"Editor de Imagem","node.help.text_input":"Insira ideias bsicas ou descries aqui.","node.help.prompt_processor":"Combina texto de outros ns em um prompt detalhado.","node.help.prompt_analyzer":"Divide um prompt em ambiente, personagem, ao e estilo.","node.help.character_analyzer":"Analisa a descrio de um personagem dividindo em aparncia e roupas.","node.help.character_generator":"Cria descries detalhadas de personagens a partir de uma ideia.","node.help.image_generator":"Gera uma imagem a partir de texto usando a API Gemini.","node.help.image_preview":"Exibe uma imagem. Arraste e solte um arquivo.","node.help.character_card":"Armazena imagem, nome e prompt de um personagem.","node.help.gemini_chat":"Conversa direta com Gemini AI.","node.help.translator":"Traduz o texto de entrada para o idioma selecionado.","node.help.script_generator":"Gera cenas de roteiro a partir de um prompt.","node.help.script_analyzer":"Analisa a estrutura do roteiro, dividindo em quadros e prompts.","node.help.script_prompt_modifier":"Cria prompts artsticos finais para cada quadro.","node.help.error_analyzer":"Verifica e corrige ortografia e gramtica.","node.help.note":"Uma rea de texto simples para anotaes.","node.help.reroute_dot":"Um ponto para redirecionar conexes.","node.help.data_reader":"Exibe dados brutos de um n conectado.","node.help.speech_synthesizer":"Converte texto em fala.","node.help.idea_generator":"Gera categorias e as combina em uma ideia.","node.help.narrator_text_generator":"Gera texto para narrador ou locutor.","node.help.audio_transcriber":"Converte arquivos de udio/vdeo em texto.","node.help.youtube_title_generator":"Gera ttulos, descries e tags para YouTube.","node.help.music_idea_generator":"Gera letras ou prompts musicais.","node.help.youtube_analytics":"Analisa estatsticas do canal e oferece dicas.","node.help.image_editor":"Edite imagens com IA (Inpainting, Outpainting).","node.action.help":"Ajuda","node.action.expand":"Expandir","node.action.collapse":"Recolher (H)","node.action.expandAll":"Expandir Tudo","node.action.collapseAll":"Recolher Tudo","node.action.expandAllScenes":"Expandir Todas as Cenas","node.action.collapseAllScenes":"Recolher Todas as Cenas","node.action.expandAllFrames":"Expandir Todos os Quadros","node.action.collapseAllFrames":"Recolher Todos os Quadros","node.action.expandPanel":"Expandir Painel","node.action.collapsePanel":"Recolher Painel","node.action.togglePanel":"Alternar Painel","node.action.collapseScene":"Recolher Cena","node.action.expandScene":"Expandir Cena","node.action.collapseFrame":"Recolher Quadro","node.action.expandFrame":"Expandir Quadro","node.action.collapseCharacter":"Recolher Personagem","node.action.expandCharacter":"Expandir Personagem","node.action.clear":"Limpar","node.action.clearTooltip":"Limpar campo de entrada.","node.action.clearChat":"Limpar Chat","node.action.paste":"Colar","node.action.copy":"Copiar","node.action.duplicateWithContent":"Duplicar (Contedo)","node.action.duplicateEmpty":"Duplicar (Vazio)","node.action.cutConnections":"Cortar Conexes","node.action.close":"Fechar","node.action.executeChain":"Executar Cadeia","node.action.executeFullChain":"Executar Cadeia Completa","node.action.processChainForward":"Processar Cadeia Adiante","node.action.executeChainTitle":"Executar todos os ns conectados.","node.action.addCharacter":"Adicionar Personagem","node.action.addScene":"Adicionar Cena","node.action.addFrame":"Adicionar Quadro","node.action.addFirstFrame":"Adicionar Primeiro Quadro","node.action.deleteItem":"Excluir","node.action.moveUp":"Mover para Cima","node.action.moveDown":"Mover para Baixo","node.action.saveImage":"Salvar Imagem","node.action.loadImage":"Carregar Imagem","node.action.saveCharacter":"Salvar Personagem","node.action.loadCharacter":"Carregar Personagem","node.action.readData":"Ler Dados","node.action.refreshData":"Atualizar Dados","node.action.stop":"Parar","node.action.stopping":"Parando...","node.action.embedCharacter":"Incorporar Personagem","node.action.downloadFinalPrompts":"Baixar Prompts","node.action.rename":"Renomear","node.action.index":"Indexar","node.action.improveConcept":"Melhorar Conceito","node.action.improveConceptTooltip":"Enriquecer e adicionar detalhes visuais.","node.action.downloadJson":"Baixar JSON","node.action.downloadSRT":"Baixar SRT","node.action.markPrimary":"Marcar como Principal","node.input.default":"Entrada","node.output.default":"Sada","node.output.allCharacters":"Todos os Personagens","node.output.primaryCharacter":"Personagem Principal","node.content.action":"Ao","node.content.actionPlaceholder":"Prompt de ao...","node.content.allScriptParts":"Todas as partes do roteiro","node.content.allScriptAnalyzerData":"Dados do analisador","node.content.allNarratorData":"Todos os dados do narrador","node.content.analyzeCharacters":"Analisar personagens","node.content.analyzeFromScene":"Analisar de:","node.content.analyzeUpToScene":"at","node.content.endPlaceholder":"fim","node.content.generateFromFrame":"Gerar do quadro:","node.content.generateUpToFrame":"at o quadro","node.content.analyzeFromFrame":"Finalizar do quadro:","node.content.processFromFrame":"Processar do quadro:","node.content.processFromScene":"Processar da cena:","node.content.analyzePrompt":"Analisar prompt","node.content.analyzeScript":"Analisar roteiro","node.content.analyzing":"Analisando...","node.content.applyAliases":"Aplicar Alias","node.content.applyAliasesTooltip":"Substitui nomes por alias (ndice).","node.content.character":"Personagem","node.content.characterIndex":"ndice","node.content.characterPlaceholder":"Prompt do personagem...","node.content.character_plural":"personagens","node.content.characters":"Personagens","node.content.charactersSynced":"Personagens sincronizados","node.content.noCharactersConnected":"Nenhum personagem conectado.","node.content.appearance":"Aparncia","node.content.personality":"Personalidade","node.content.characterType":"Tipo","node.content.characterTypeShort":"Tipo","node.content.characterType.simple":"Simples","node.content.characterType.anthro":"Anthro (Animais)","node.content.characterType.chibi":"Chibi (Fofo)","node.content.characterType.key_item":"Item Chave","node.content.style":"Estilo","node.content.style.none":"Nenhum","node.content.style.simple":"Simples","node.content.style.realistic":"Realista/Cinema","node.content.style.3d_cartoon":"Cartoon 3D","node.content.style.3d_realistic":"3D Realista","node.content.style.2d_animation":"Animao 2D","node.content.style.anime":"Anime","node.content.style.comics":"Quadrinhos","node.content.style.custom":"Especial","node.content.chatPlaceholder":"Digite uma mensagem...","node.content.clothing":"Roupas","node.content.clothingPlaceholder":"Prompt de roupas...","node.content.connectedPlaceholder":"Conectado","node.content.dataPlaceholder":"Dados aparecero aqui...","node.content.readData":"Ler Dados","node.content.reading":"Lendo...","node.content.description":"Descrio","node.content.sceneDescription":"Descrio da Cena","node.content.duration":"Durao","node.content.enhancePrompt":"Gerar Prompt","node.content.enhancedPromptHere":"Prompt melhorado aparecer aqui...","node.content.enhancing":"Melhorando...","node.content.environment":"Ambiente","node.content.environmentPlaceholder":"Prompt do ambiente...","node.content.environmentPrompt":"Ambiente & Fundo","node.content.compositionAndBlocking":"Composio & Ao","node.content.executingChain":"Executando cadeia...","node.content.imagePrompt":"Prompt de Imagem","node.content.finalPrompt":"Prompt Final","node.content.finalPrompt_plural":"Prompts Finais","node.content.fixErrors":"Corrigir Erros","node.content.fixingErrors":"Corrigindo...","node.content.frame":"Quadro","node.content.frame_plural":"Quadros","node.content.frames":"Quadros de Sada","node.content.frames_analyzed":"Quadros analisados: {count}","node.content.framesPerScene":"Quadros por Cena","node.content.minFrames":"Mn","node.content.maxFrames":"Mx","node.content.numberOfCharactersShort":"Qtd","node.content.fullDescription":"Descrio Completa","node.content.generateCharacters":"Gerar Personagens","node.content.generateFinalPrompts":"Gerar Prompts Finais","node.content.generatingProgress":"Gerando {current} de {total}","node.content.generateImage":"Gerar Imagem","node.content.generateScript":"Gerar Roteiro","node.content.generateSpeech":"Gerar Fala","node.content.generateText":"Gerar Texto","node.content.generateSSML":"Gerar SSML","node.content.generateStyle":"Gerar Estilo","node.content.generating":"Gerando...","node.content.improving":"Melhorando...","node.content.generatedAudio":"udio gerado","node.content.imagePromptPlaceholder":"Insira prompt para imagem...","node.content.modificationPromptPlaceholder":"Solicitao de modificao...","node.content.narrator":"Narrador","node.content.narratorEnabled":"Habilitar Narrador","node.content.narratorEnabledInfo":"Adiciona texto de locuo.","node.content.narratorMode":"Modo Narrador","node.content.narratorMode.normal":"Normal / Locuo","node.content.narratorMode.dual":"Dois Narradores","node.content.narratorMode.first_person":"Primeira Pessoa","node.content.role":"Papel","node.content.role.narrator":"Narrador","node.content.role.announcer":"Locutor","node.content.role.first_person":"Primeira Pessoa","node.content.role.dual_narrator":"Dois Narradores","node.content.role.dual_announcer":"Dois Locutores","node.content.scene":"Cena","node.content.scene_plural":"cenas","node.content.scenes":"Cenas","node.content.scenes_generated":"Cenas geradas: {count}","node.content.sceneContext":"Contexto da Cena","node.content.sceneContextPlaceholder":"Humor, ambiente, luz...","node.content.scriptPromptPlaceholder":"Insira ideia da histria...","node.content.seconds":"seg","node.content.stylePlaceholder":"Prompt de estilo...","node.content.stylePromptPlaceholder":"Insira prompt de estilo aqui...","node.content.styleOverride":"Substituir Estilo","node.content.summary":"Resumo","node.content.targetLanguage":"Idioma Alvo","node.content.textToSynthesize":"Texto para sintetizar...","node.content.translate":"Traduzir","node.content.translatePlaceholder":"Texto para traduzir...","node.content.translatedTextPlaceholder":"Traduo aparecer aqui...","node.content.translating":"Traduzindo...","node.content.useExistingCharacters":"Usar personagens existentes","node.content.useExistingCharactersInfo":"Usa dados de personagens conectados em vez de gerar novos.","node.content.createKeyItem":"Criar Secundrios/Itens","node.content.createSecondaryChars":"Personagens Secundrios","node.content.createKeyItems":"Itens Chave","node.content.createKeyItemInfo":"Permite  IA criar personagens secundrios ou itens.","node.content.noCharacters":"Sem Personagens","node.content.noCharactersInfo":"Foco em eventos e atmosfera (estilo documentrio).","node.content.videoPrompt":"Dinmica & Movimento","node.content.videoPrompts":"Prompts de Vdeo","node.content.voice":"Voz","node.content.previewVoice":"Testar Voz","node.content.voicePreviewText":"Ol, esta  uma prova de voz.","node.content.inputScripts":"Cenas de Entrada","node.content.inputFrames":"Quadros de Entrada","node.content.outputScript":"Cenas de Sada","node.content.requestCategories":"Pedir Categorias","node.content.generateIdea":"Gerar Ideia","node.content.requestNewCategories":"Novas Categorias","node.content.category.action":"Ao","node.content.category.place":"Lugar","node.content.category.obstacle":"Obstculo","node.content.generatedIdea":"Ideia Gerada","node.content.storyFormat":"Formato da Histria","node.content.theme":"Tema","node.content.parameters":"Parmetros","node.content.advancedMode":"Modo Avanado","node.content.numberOfScenes":"Nmero de Cenas","node.content.numberOfScenes.auto":"Auto","node.content.detailedPlot":"Enredo Detalhado","node.content.detailedPlotInfo":"Habilita descries detalhadas.","node.content.includeSubscribeScene":"Cena de Inscrio","node.content.includeSubscribeSceneInfo":"Adiciona uma cena pedindo para se inscrever.","node.content.genre":"Gnero","node.content.genre2":"Gnero 2","node.content.breakIntoParagraphs":"Pargrafos","node.content.copyVideoPrompt":"Copiar prompt de vdeo","node.content.generateVideoPrompt":"Gerar prompt de vdeo","node.content.model":"Modelo","node.content.processWholeScene":"Processar cena inteira","node.content.processWholeSceneInfo":"Processa todos os quadros de uma cena de uma vez para consistncia.","node.content.batchProcessing":"Processamento em Lote","node.content.batchProcessingInfo":"Processar todas as cenas selecionadas em um contexto.","node.content.extendedAnalysis":"Anlise Estendida","node.content.extendedAnalysisInfo":"Divide cenas em planos detalhados.","node.content.professionalStoryboard":"Storyboard de Diretor","node.content.professionalStoryboardInfo":"Anlise baseada em regras cinematogrficas.","node.content.generateStartEndFrames":"Gerar Quadros Incio/Fim","node.content.autoIndexCharacters":"Auto-indexar Personagens","node.content.autoIndexCharactersInfo":"Substitui nomes automaticamente por alias.","node.content.imageToText":"Imagem para Texto","node.content.extracting":"Extraindo...","node.content.extractedText":"Texto Extrado","node.content.activePromptStack":"Pilha de Prompts Ativa","node.content.noCharactersAnalyzed":"Nenhum personagem analisado.","node.content.promptsGeneratedPlaceholder":"Prompts gerados aparecero aqui.","node.content.noCharactersInScript":"Sem personagens no roteiro.","node.content.noInputScenes":"Sem dados de entrada. Conecte um Gerador de Roteiro.","node.content.status":"Status","node.content.status.ready":"Pronto","node.content.status.paused":"Pausado","node.content.status.generating":"Gerando","node.content.status.total":"Total: {generated} / {total}","node.content.status.batch":"Processando: {current} de {total}","node.content.status.time":"Tempo: {current}s / {total}s","node.content.refreshing":"Atualizando...","node.content.totalFrames":"Total Quadros: {count}","node.content.uploadAudio":"Enviar udio/Vdeo","node.content.noAudioLoaded":"Sem udio","node.content.audioLoaded":"udio Carregado","node.content.transcriptionPlaceholder":"A transcrio aparecer aqui...","node.content.transcribe":"Transcrever","node.content.transcribing":"Transcrevendo...","node.content.convertingVideo":"Convertendo vdeo...","node.content.recommendedFrames":"Quadros Estimados","node.content.shotType":"Plano","node.content.shotType.ws":"WS (Plano Aberto)","node.content.shotType.ms":"MS (Plano Mdio)","node.content.shotType.cu":"CU (Close)","node.content.shotType.ecu":"ECU (Detalhe)","node.content.shotType.ls":"LS (Plano Geral)","node.content.characterDetail":"Detalhes do Personagem","node.content.noCharDesc":"Sem descrio de personagem","node.content.includeGeneralCharDesc":"Descrio visual geral","node.content.includeFullCharDesc":"Descrio visual detalhada","node.content.safeGeneration":"Gerao Segura","node.content.shotFilter":"Filtro de Planos","node.content.shotFilter.all":"Todos","node.content.shotFilter.wideOnly":"Apenas Abertos","instruction.desc.shot_filter_all":"Permitir todos os tipos de plano (WS, MS, CU, ECU, LS).","instruction.desc.shot_filter_wide":"Restringir a planos abertos (WS, MS, LS). Sem closes.","node.content.anthroEnabled":"Animais Antropomrficos","node.content.subscribeEnhancement":"Melhorar Chamada de Inscrio","node.content.thinkingEnabled":"Modo Pensamento","node.content.scenelessMode":"Cenas sem roteiro","instruction.desc.sceneless_mode":"Desativar motor narrativo. Gerar cenas diretamente do conceito.","instruction.sceneless_mode":"Modo Lista de Cenas","node.content.microActionBreakdown":"Micro-Aes","node.content.microActionBreakdownInfo":"Decompe aes complexas em fases (Preparao, Ao, Reao).","node.content.commercialSafe":"Comercialmente Seguro","instruction.desc.commercial_safe":"Evita estritamente marcas registradas (Disney, Pixar) e as substitui por descries genricas.","node.content.findStack":"Buscar na pilha...","node.content.spm_stack.priming":"1. Preparao e Contexto","node.content.spm_stack.physics":"2. Fsica e Lgica","node.content.spm_stack.hierarchy":"3. Hierarquia do Sujeito","node.content.spm_stack.construction":"4. Construo e Formato"},Qb={"genre.general":"Geral","genre.comedy":"Comdia","genre.drama":"Drama","genre.action":"Ao","genre.scifi":"Fico Cientfica","genre.fantasy":"Fantasia","genre.horror":"Terror","genre.thriller":"Suspense","genre.childrens_animation":"Animao Infantil","genre.shorts_story":"Histrias Curtas (Shorts)","genre.scientific_historical":"Cientfico-Histrico","character_generator.promptPlaceholder":'Insira uma ideia, ex: "cavaleiro corajoso, guardio da floresta antiga"',"idea_generator.randomTheme":"Tema Aleatrio","idea_generator.randomCombination":"Combinao Aleatria","idea_generator.themePlaceholder":"ex. Espao, Cozinha, Floresta Encantada","idea_generator.initialMessage":'Insira um tema (opcional) e clique em "{buttonName}".',"idea_generator.ideaPlaceholder":"A ideia gerada aparecer aqui...","idea_generator.format.general":"Geral","idea_generator.format.childrens":"Infantil","idea_generator.format.adventure":"Aventura","idea_generator.format.fantasy":"Fantasia / Magia","idea_generator.format.detective":"Detetive","idea_generator.format.scifi":"Fico Cientfica","idea_generator.format.horror":"Terror","idea_generator.format.historical":"Histrico","gender.male":"Masculino","gender.female":"Feminino","node.content.autoDownload":"Download automtico ao gerar","node.content.downloadSelected":"Baixar Selecionados","node.content.intonation":"Entonao","intonation.standard":"Padro","intonation.cheerful":"Alegre","intonation.angry":"Zangado","intonation.sad":"Triste","intonation.excited":"Animado","intonation.announcer":"Locutor","intonation.whispering":"Sussurrando","node.content.sceneMode":"Modo Cena","node.content.connectNarratorData":'Conecte "Todos os dados do narrador" de um Gerador de Roteiro.',"node.content.sceneModeActive":"Modo Cena ativo. Dados recebidos da conexo.","speech_synthesizer.mode.simple":"Simples","speech_synthesizer.mode.scene":"Cena","speech_synthesizer.multiSpeaker":"Dois Locutores","speech_synthesizer.speaker1Name":"Nome Locutor 1","speech_synthesizer.speaker2Name":"Nome Locutor 2","speech_synthesizer.multiSpeakerHint":'Os nomes devem corresponder aos do texto (ex. "Homem: ...", "Mulher: ...").',"speech_synthesizer.ssmlHint":"A entonao  controlada por tags SSML no texto.","youtube_analytics.authorName":"Nome do Autor","youtube_analytics.videoTitle":"Ttulo do Vdeo","youtube_analytics.views":"Visualizaes","youtube_analytics.addToChannel":"Adicionar ao Canal","youtube_analytics.noIncomingData":"Sem dados de entrada.","youtube_analytics.videoAdded":"Vdeo adicionado!","youtube_analytics.dragDrop":"Arraste a captura de tela aqui","youtube_analytics.thumbnailUpdated":"Miniatura atualizada","youtube_analytics.statsTrend":"Tendncia de Estatsticas","youtube_analytics.currentChannel":"Canal Atual","youtube_analytics.growth":"Crescimento","youtube_analytics.allChannels":"Todos os Canais","youtube_analytics.saveDisk":"Salvar no Disco","youtube_analytics.saveCatalog":"Salvar no Catlogo","youtube_analytics.loadDisk":"Carregar do Disco","youtube_analytics.analyzing":"Analisando...","youtube_analytics.askAI":"Perguntar  IA","youtube_analytics.clickForAdvice":'Clique em "Perguntar  IA".',"youtube_analytics.dailyNotes":"Notas Dirias","youtube_analytics.logDailyStats":"Registrar Stats","youtube_analytics.subscribers":"Inscritos","youtube_analytics.totalViews":"Vis. Totais","youtube_analytics.updateStats":"Atualizar","youtube_analytics.history":"Histrico","youtube_analytics.noHistory":"Sem histrico.","youtube_analytics.noNotes":"Sem notas.","youtube_analytics.noVideos":"Sem vdeos.","youtube_analytics.loadedFromDisk":"Carregado","youtube_analytics.loadFailed":"Falha ao carregar","youtube_analytics.savedToDisk":"Salvo","youtube_title_generator.mode.title":"Ttulo de Vdeo","youtube_title_generator.mode.channel":"Info do Canal","youtube_title_generator.ideaPlaceholder":"Insira ideia de vdeo...","youtube_title_generator.channelIdeaPlaceholder":"Insira tema do canal...","youtube_title_generator.title":"Ttulo","youtube_title_generator.description":"Descrio","youtube_title_generator.tags":"Tags","youtube_title_generator.channelName":"Nome do Canal","youtube_title_generator.channelDescription":"Descrio do Canal","youtube_title_generator.channelKeywords":"Palavras-chave","youtube_title_generator.channelHandle":"Identificador (@)","music_idea_generator.mode.lyrics":"Letra","music_idea_generator.mode.music_prompt":"Prompt Musical","music_idea_generator.ideaPlaceholder":"Insira tema ou humor...","music_idea_generator.songTitle":"Ttulo da Cano","music_idea_generator.songTitlePlaceholder":"Ttulo...","music_idea_generator.lyricsPlaceholder":"A letra aparecer aqui...","music_idea_generator.musicPromptPlaceholder":"O prompt musical IA aparecer aqui...","chat.mode.general":"Geral","chat.mode.script":"Especialista em Roteiro","chat.mode.prompt":"Especialista em Prompt","chat.mode.youtube":"Especialista em YouTube"},ew={"catalog.title":"Catlogo","catalog.tabs.groups":"Grupos","catalog.tabs.library":"Biblioteca de Prompts","catalog.tabs.characters":"Personagens","catalog.tabs.scripts":"Roteiros","catalog.tabs.analysis":"Anlises","catalog.tabs.final_prompts":"Prompts Finais","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"Ideias Musicais","catalog.empty.title":"O catlogo est vazio","catalog.empty.description":"Salve um item para v-lo aqui ou importe de um arquivo.","catalog.loadFromFile":"Carregar de arquivo","catalog.card.addToCanvas":"Adicionar ao Canvas","catalog.card.rename":"Renomear","catalog.card.save":"Salvar no disco","catalog.card.delete":"Excluir","library.loadFromFile":"Carregar de arquivo","library.empty.title":"Pasta vazia","library.empty.description":"Crie uma nova pasta ou prompt.","library.emptyPrompt":"Sem contedo","library.actions.newFolder":"Nova Pasta","library.actions.newPrompt":"Novo Prompt","library.actions.copy":"Copiar para rea de transferncia","library.actions.edit":"Editar Prompt","group.rename":"Renomear Grupo","group.saveToCatalog":"Salvar no Catlogo","group.saveToDisk":"Salvar no Disco","group.ungroup":"Desagrupar (Shift+Clique para excluir)","group.button.create":"Agrupar ({count})"},tw={"dialog.rename.title":"Renomear","dialog.rename.group.title":"Renomear Grupo","dialog.rename.catalog.title":"Renomear Item do Catlogo","dialog.rename.label":"Novo nome","dialog.rename.confirm":"Renomear","dialog.rename.cancel":"Cancelar","dialog.promptEdit.title":"Editar Prompt","dialog.promptEdit.nameLabel":"Nome","dialog.promptEdit.contentLabel":"Contedo","dialog.promptEdit.confirm":"Salvar","dialog.promptEdit.cancel":"Cancelar","dialog.reset.title":"Redefinir Canvas","dialog.reset.message":"Tem certeza que deseja redefinir o canvas? Todo o trabalho no salvo ser perdido.","dialog.exit.title":"Fechar Projeto?","dialog.exit.message":"Tem certeza? Dados no salvos sero perdidos.","dialog.settings.title":"Configuraes","dialog.settings.apiKeyLabel":"Chave API Gemini","dialog.settings.apiKeyPlaceholder":"Insira sua chave aqui","dialog.settings.getApiKeyLink":"Obter chave API no Google AI Studio","dialog.settings.useFreeKey":"Usar chave gratuita (limitada)","dialog.settings.save":"Salvar","dialog.settings.close":"Fechar","dialog.apiKey.title":"Configuraes de Chave API","dialog.apiKey.description":" necessria uma chave API Gemini. Ela ser salva localmente.","dialog.apiKey.keyExists":"Uma chave API j est salva.","dialog.apiKey.clear":"Excluir chave","dialog.apiKey.save":"Salvar chave","dialog.apiKey.update":"Atualizar chave","dialog.apiKey.useFreeKey":"Usar chave gratuita (Desenvolvimento)","dialog.permission.title":"Acesso  rea de Transferncia","dialog.permission.description":'Esta aplicao requer acesso  rea de transferncia para a funo "Colar".',"dialog.permission.decline":"Recusar","dialog.permission.allow":"Permitir","alert.groupSaved":'Grupo "{groupTitle}" salvo no catlogo!',"toast.groupSavedToDisk":'Grupo "{groupTitle}" salvo no disco!',"alert.confirmDelete":"Tem certeza que deseja excluir este item?","alert.invalidCatalogFile":"Arquivo de catlogo invlido.","alert.loadCatalogFailed":"Falha ao carregar item do catlogo","alert.confirmLoadProject":"Carregar um projeto substituir todos os dados atuais. Tem certeza?","dialog.confirmDelete.title":"Confirmar Excluso","dialog.confirmDelete.message":'Tem certeza que deseja excluir "{itemName}"? Isso no pode ser desfeito.',"dialog.confirmDelete.folderMessage":'Tem certeza que deseja excluir a pasta "{itemName}" e seu contedo?',"dialog.confirmDelete.confirm":"Excluir","dialog.confirmDelete.cancel":"Cancelar","dialog.confirmClear.title":"Confirmar Limpeza","dialog.confirmClear.message":"Deseja realmente apagar tudo do canvas?","toast.copied":"Copiado para rea de transferncia","toast.pasted":"Colado!","toast.cleared":"Limpo","toast.resetComplete":"Redefinido","toast.projectSaved":"Projeto salvo","toast.canvasSaved":"Canvas salvo no disco","toast.saveFailed":"Falha ao salvar","toast.connectionsCut":"Conexes cortadas","toast.charSaved":"Personagem salvo","toast.charLoaded":"Personagem carregado","toast.videoPasted":"Vdeo colado da rea de transferncia","toast.savedToCatalog":"Salvo no catlogo","toast.apiKeySaved":"Chave API salva","toast.apiKeyCleared":"Chave API excluda","toast.projectLoaded":"Projeto carregado","alert.batchMismatch":"Aviso: Contagem de quadros incompatvel na cena {scene}."},nw={"instruction.desc.safe_gen":"SEGURANA CRTICA: Evite estritamente palavras que acionem filtros de segurana de IA. Substitua termos como 'adolescente', 'ntimo' ou 'revelador' por alternativas artsticas como 'jovem', 'composio artstica' ou 'estilizado'.","instruction.desc.layered_no_style":"Estrutura: 1. [Fundo Global] -> 2. [Hierarquia do Sujeito] -> 3. [Cmera]. NUNCA descreva uma ao sem antes descrever o personagem completo."},ow={"instruction.sg_inputs":"Dados de Entrada","instruction.desc.sg_inputs":"Fonte: Conceito/Ideia, Perfis de Personagem.","instruction.core_director":"Diretor","instruction.desc.core_director":"Voc  um Diretor de Cinema Visionrio. Pense em lentes, movimento e composio.","instruction.sg_thinking":"Analisar","instruction.desc.sg_thinking":"Raciocinar antes de escrever. Analisar causalidade e lgica. Eliminar clichs.","instruction.sg_improve_input":"Doutor de Roteiro","instruction.desc.sg_improve_input":"Melhorar conceito inicial, corrigir furos na trama, afiar conflito.","instruction.sg_exposition":"Exposio","instruction.desc.sg_exposition":"Mostrar o estado do mundo atravs de histria ambiental e detalhes.","instruction.sg_delayed_reveal":"Revelao","instruction.desc.sg_delayed_reveal":"Introduo gradual: ambiente -> detalhes -> silhueta -> rosto.","instruction.sg_metaphor":"Metfora","instruction.desc.sg_metaphor":"Usar smbolos visuais para estados internos.","instruction.sg_pacing":"Ritmo","instruction.desc.sg_pacing":"Controle de ritmo: equilibrar tomadas contemplativas com edio dinmica.","instruction.sg_subtext":"Subtexto","instruction.desc.sg_subtext":"Tenso entre dilogo e ao.","instruction.desc.sg_frame_estimation":"Estimativa recomendada de quadros.","instruction.rule_visuals":"Visuais Primeiro","instruction.desc.rule_visuals":"Mostre, no conte. Foco em luz, composio, movimento.","instruction.sg_visual_dna":"DNA Visual","instruction.desc.sg_visual_dna":"Guia tcnico LookDev (Luz, Lentes, Estilo de render).","instruction.rule_flow":"Fluxo Contnuo","instruction.desc.rule_flow":"Lgica Match Cut: Usar formas/cores para transies.","instruction.rule_atmosphere":"Atmosfera","instruction.desc.rule_atmosphere":"Detalhes tteis: cheiro de chuva, zumbido neon, poeira.","instruction.sg_visual_style":"Estilo Visual","instruction.desc.sg_visual_style":"Pedido: Descrio detalhada do estilo baseada em '{style}'.","instruction.char_detailed_style":"Detalhe Estilizado","instruction.desc.char_detailed_style":"Integra o estilo global em cada prompt de personagem.","instruction.sg_genre":"Contexto de Gnero","instruction.desc.sg_genre":"Contexto: {genre}","instruction.char_smart_concept":"Conceito Inteligente","instruction.desc.char_smart_concept":"IA escolhe: Corpo Inteiro para Personagens / Preenchimento para Objetos.","instruction.char_no_dupes":"Sem Duplicatas","instruction.desc.char_no_dupes":"CRTICO: NO regenerar personagens exceto MUDANA DE TRAJE.","instruction.create_secondary_chars":"Personagens Secundrios","instruction.desc.create_secondary_chars":"Permite criao de personagens secundrios se necessrio.","instruction.create_key_items":"Itens Chave","instruction.desc.create_key_items":"Criao obrigatria de 'Cartes de Personagem' para objetos importantes.","instruction.char_secondary_ok":"Novos permitidos","instruction.desc.char_secondary_ok":"Novos personagens ou itens permitidos. Se mudar roupa, criar novo carto.","instruction.sg_anthro":"Anthro","instruction.desc.sg_anthro":"Personagens devem ser animais antropomrficos.","instruction.sg_no_chars":"Sem Personagens","instruction.desc.sg_no_chars":"Estilo documentrio / Sem personagens nomeados.","instruction.sg_detailed_plot":"Enredo Detalhado","instruction.desc.sg_detailed_plot":"Descries muito detalhadas das aes.","instruction.sg_subscribe":"Cena Inscrio","instruction.desc.sg_subscribe":"Incluir cena quebrando a 4 parede para se inscrever.","instruction.char_gray_bg":"Conceito Visual","instruction.desc.char_gray_bg":"Para cada prompt visual, SEMPRE adicionar: ', full body character concept on a gray background'.","instruction.char_no_new":"Sem Novos","instruction.desc.char_no_new":"NO crie novos personagens. Use apenas os existentes.","instruction.sg_new_chars":"Novos Personagens","instruction.desc.sg_new_chars":"Gerar novos personagens baseados no prompt.","instruction.sg_living_world":"Mundo Vivo","instruction.desc.sg_living_world_simple":"Figurantes so humanos normais.","instruction.desc.sg_living_world_anthro":"Figurantes so animais antropomrficos.","instruction.sg_simple_actions":"Aes Simples","instruction.desc.sg_simple_actions":"Evitar fsica complexa. Preferir poses estveis.","instruction.commercial_safe":"Comercialmente Seguro","instruction.desc.commercial_safe":"Evita estritamente marcas registradas (Disney, Pixar) e as substitui por descries genricas."},rw={"instruction.ana_role":"Papel Analisador","instruction.desc.ana_role":"Voc  um Diretor de Cinema de classe mundial. Escreva instrues tcnicas para gerao de imagem/vdeo por IA.","instruction.ana_cinema":"Cinematografia","instruction.desc.ana_cinema":"Termos pro: Wide Shot, Close-up, Dutch Angle, Bokeh.","instruction.ana_cinema_wide":"Cinematografia (Aberta)","instruction.desc.ana_cinema_wide":"Termos pro: Wide Shot, Long Shot. SEM Close-ups.","instruction.ana_anthro_logic":"Lgica Anthro","instruction.desc.ana_anthro_logic":"Descrever explicitamente personagens como Animais Antropomrficos.","instruction.ana_subscribe_logic":"Chamada Inscrio","instruction.desc.ana_subscribe_logic":'Aes visuais para "Inscrever-se": segurar placas, texto 3D.',"instruction.rule_hierarchy":"Algoritmo de Enquadramento","instruction.desc.rule_hierarchy":"Ordem estrita: 1. Global (Local/Clima). 2. Postura Sujeito. 3. Interao Objeto. 4. Ao.","instruction.rule_living_world":"Mundo Vivo","instruction.desc.rule_living_world":"Descrever figurantes consistentes com o mundo.","instruction.desc.rule_living_world_anthro":"Figurantes devem ser animais antropomrficos.","instruction.rule_persistence":"Persistncia","instruction.desc.rule_persistence":"Manter consistncia cronolgica da cena. Rastrear objetos e posies.","instruction.rule_mandatory_bg":"Fundo Obrigatrio","instruction.desc.rule_mandatory_bg":"PROIBIDO deixar fundo vazio. Sempre descrever local e luz.","instruction.desc.rule_mandatory_bg_wide":"PROIBIDO deixar fundo vazio. Em plano aberto, sempre descrever geografia e horizonte.","instruction.shot_filter_wide":"Apenas Planos Abertos","instruction.desc.shot_filter_wide":"FILTRO ESTRITO: Apenas Wide (WS), Long (LS) e Medium (MS). Close-ups proibidos.","instruction.storyboard_rules":"Variedade de Planos","instruction.desc.storyboard_rules":"Alternar WS/LS, MS e CU/ECU para dinamismo.","instruction.storyboard_rules_wide":"Variedade de Planos (Aberta)","instruction.desc.storyboard_rules_wide":"Apenas Wide, Long e Establishing. Variar ngulo. SEM Close-ups.","instruction.tech_directives":"Controle Cmera","instruction.desc.tech_directives":"Terminologia estrita. Apenas abreviaes (WS, MS, CU).","instruction.tech_directives_wide":"Controle Cmera (Aberta)","instruction.desc.tech_directives_wide":"Terminologia estrita. Apenas WS, MS, LS. Sem CU/ECU.","instruction.use_aliases":"Usar Alias","instruction.desc.use_aliases":"Usar formato Character-N.","instruction.action_phase_breakdown":"Micro-Aes","instruction.desc.action_phase_breakdown":"Decompor aes complexas em fases (Preparao, Incio, pice, Reao).","instruction.desc.action_phase_breakdown_wide":"Decompor fases, mas MANTER CMERA ABERTA. Mostrar impacto pela postura.","instruction.batch_processing":"Processamento em Lote","instruction.desc.batch_processing":"Analisar todas as cenas como sequncia contnua.","instruction.ana_prompt_lang":"Idioma de Prompt","instruction.desc.ana_prompt_lang":"Prompts estritamente em Ingls para compatibilidade.","instruction.extended_visuals":"Visualizao Estendida","instruction.desc.extended_visuals":"Decompe cenas em sequncias expressivas (Wide, MS, CU, Detalhe).","instruction.extended_visuals_wide":"Visualizao Estendida (Aberta)","instruction.desc.extended_visuals_wide":"Decompe cenas em sequncias de planos Abertos/Mdios. Foco na geografia.","instruction.desc.target_lang":"Idioma de anlise.","instruction.rule_isolation":"Zero Contexto","instruction.desc.rule_isolation":"CRTICO: O gerador de imagem NO SABE sobre o quadro anterior. Re-descrever ambiente.","instruction.sensory_saturation":"Anti-Brevidade","instruction.desc.sensory_saturation":"PROIBIDO ser breve. Descrever texturas, luz e peso fsico.","instruction.ana_no_pov":"Sem POV","instruction.desc.ana_no_pov":'NEGATIVO CRTICO: PROIBIO ESTRITA de planos "POV" ou "Primeira Pessoa". A cmera DEVE ser externa.',"instruction.desc.static_frame_logic":'PROIBIO ESTRITA de verbos de movimento ("andar"). Descreva um momento CONGELADO.',"instruction.desc.anatomical_posing":'Descreva GEOMETRIA corporal. Em vez de "descansando", escreva "deitado de costas, braos ao lado".',"instruction.desc.motion_dynamics":"SEPARAO: Image Prompt = 100% Esttico. Video Prompt = Movimento & Tempo.","instruction.desc.anatomical_strictness":'RIGGING: "Braos atrs da cabea E segurando copo" proibido. Descrever separadamente: Brao ESQ [estado], Brao DIR [estado].',"instruction.desc.prop_consistency":'BLOQUEIO OBJETO: Sem nomes genricos ("espada"). Atributos visuais ("espada ferro enferrujado") obrigatrios.',"instruction.desc.subject_hierarchy":"Mesmo para Close-ups: 1. Personagem Completo. 2. Interao com Ambiente. 3. Detalhe.","instruction.inputs_data":"Entradas","instruction.desc.inputs_data":"Dados fonte: Resumo, Perfis, Textos de cenas."},aw={"instruction.inputs":"Entradas","instruction.desc.inputs":"Fonte: Quadros do analisador, Perfis visuais, Estilo de cena.","instruction.role":"Papel: Artista de Ambiente Lder","instruction.desc.role":"Especialista em Engenharia de Prompt. Sintetize as entradas em uma descrio visual definitiva.","instruction.layered":"Algoritmo: Fluxo Unificado","instruction.desc.layered":"Gera UM S bloco de texto fluido. Estrutura: [Estilo] -> [DESIGN DE CENRIO MESTRE] -> [Visuais] + [POSE & AO] -> [Cmera].","instruction.desc.layered_no_char":"Estrutura: [DESIGN DE CENRIO MESTRE] -> [Ao]. Omite aparncia, mantm apenas ndices e aes.","instruction.visuals":"Estilo: Saturao","instruction.desc.visuals":"Usa descritores ricos: luz volumtrica, texturas 8k, profundidade de campo.","instruction.process_whole_scene":"Lote de Cena","instruction.desc.process_whole_scene":"Analisar cena inteira de uma vez para consistncia.","instruction.video":"Vdeo","instruction.desc.video":"Video Prompt: [ndice] (Desc Visual Detalhada) [Ao]. Dinmica: [Amb]. Cmera: [Movimento]. SEM NOMES.","instruction.stateless":"Regra: Sem Estado","instruction.desc.stateless":"Cada quadro  independente. Re-descrever ambiente. Re-descrever ao de cada personagem do zero.","instruction.rule_static":"Regra: Esttico","instruction.desc.rule_static":"Descrever apenas o momento congelado. Sem transies.","instruction.atmosphere_fix":"ncora Atmosfrica","instruction.desc.atmosphere_fix":"Descrever humor como propriedades fsicas do ar e luz.","instruction.subject_focus":"Hierarquia Contexto","instruction.desc.subject_focus":"CRTICO: Mesmo para Close-ups: 1. Perso Completo. 2. Pose. 3. Detalhe. A IA precisa do contexto corporal.","instruction.always_env":"DESIGN DE CENRIO OBRIGATRIO","instruction.desc.always_env":"CRTICO: Use o 'Contexto Global de Cena' fornecido como a VERDADE ABSOLUTA para o fundo. Voc DEVE injetar os detalhes especficos de mveis, iluminao e texturas do contexto na camada de ambiente de CADA prompt. No alucine fundos genricos.","instruction.pm_anthro":"Detalhe Anthro","instruction.desc.pm_anthro":'OBRIGATRIO: Palavra "anthropomorphic" antes da espcie em Imagem E Vdeo. Texturas/anatomia melhoradas.',"instruction.pm_subscribe":"Texto Legvel","instruction.desc.pm_subscribe":'Garantir que texto como "SUBSCRIBE" seja legvel e integrado (neon, placas).',"instruction.strict_char_index":"Personagens","instruction.desc.strict_char_index":"Mapear estritamente Alias (Character-N) aos dados do quadro.","instruction.no_names":"CRTICO: SEM NOMES","instruction.desc.no_names":"CRTICO: PROIBIO ABSOLUTA DE NOMES. Usar APENAS ID de ndice entre colchetes `[Character-N]`.","instruction.general_char_desc":"Detalhe Geral","instruction.desc.general_char_desc":"Incorporar uma verso CONCISA e GERAL do prompt visual.","instruction.full_char_desc":"Detalhe Completo","instruction.desc.full_char_desc":"Incorporar o prompt visual COMPLETO e DETALHADO do perfil exatamente como est.","instruction.formatting":"Formatao","instruction.desc.formatting":"Ativa CABEALHOS explcitos e quebras de linha para estrutura.","instruction.anatomical_strictness":"Lgica Anatomia","instruction.desc.anatomical_strictness":'RIGGING: Previne "Braos atrs da cabea E segurando copo". Fora descrio separada.',"instruction.img_vid_consistency":"Fluxo Img->Vid","instruction.desc.img_vid_consistency":"Image Prompt = Incio/Esttico. Video Prompt = Ao/Evoluo. O vdeo deve evoluir naturalmente da imagem.","instruction.desc.prop_enhancement":'MATERIALIDADE: Amplifica descries de objetos (ex. "tbua vermelha" -> "fibra de vidro vermelha brilhante").',"instruction.no_pov":"CRTICO: SEM POV","instruction.desc.no_pov":"PROIBIO ESTRITA de ngulos POV. A cmera DEVE ser externa (Terceira Pessoa)."},iw={"instruction.music_role":"Papel Produtor Musical","instruction.desc.music_role":"Compositor expert e letrista.","instruction.music_input":"Dados de Entrada","instruction.desc.music_input":"Tema ou ideia do usurio.","instruction.music_creative":"Liberdade Criativa","instruction.desc.music_creative":"Fora a IA a interpretar o clima metaforicamente, no literalmente.","instruction.music_lyrics":"Estrutura Letra","instruction.desc.music_lyrics":"Gera estrutura Verso/Refro adequada ao gnero.","instruction.music_prompt_rule":"Prompt Msica IA","instruction.desc.music_prompt_rule":"Tags tcnicas para Suno/Udio (BPM, Instrumentos, Vocais). Mx 1000 caracteres.","instruction.music_format":"Sada JSON","instruction.desc.music_format":"Estrutura JSON estrita para integrao."},sw={"instruction.yt_role":"Estrategista YouTube","instruction.desc.yt_role":"Expert em SEO, CTR e psicologia viral.","instruction.yt_input":"Dados de Entrada","instruction.desc.yt_input":"O tpico ou nicho fornecido.","instruction.yt_title_mode":"Metadados Vdeo","instruction.desc.yt_title_mode":"Otimiza Ttulos/Desc/Tags para mximo de cliques.","instruction.yt_channel_mode":"Branding Canal","instruction.desc.yt_channel_mode":"Cria Nome, Bio e Identificador consistentes.","instruction.yt_format":"Sada JSON","instruction.desc.yt_format":"Estrutura JSON estrita para integrao."},lw={...nw,...ow,...rw,...aw,...iw,...sw},cw={...Jb,...Xb,...Zb,...Qb,...ew,...tw,...lw},dw={"app.title":"","app.description":" Gemini API ","app.slogan":"","app.subtitle":"","app.error.title":"","app.error.copy":"","app.error.copied":"","error.quotaExceeded":" API ","error.apiKeyMissing":" API  Gemini API ","error.freeKeyNotAvailable":"/ API ","error.fileReadError":"","error.videoConversionError":"","error.unsupportedFile":"","error.promptModifierFile":" (Prompt Modifier)","error.invalidFileType":" Script Modifier ","welcome.iAmDeveloper":"","welcome.letsGo":"","welcome.resume":"","welcome.reload":"","welcome.reloadTitle":"","welcome.reloadMessage":"","welcome.confirmReload":"","dialog.welcome.title":"","dialog.welcome.heading":"","dialog.welcome.intro1":" Script Modifier -  Gemini ","dialog.welcome.intro2":" Gemini API ","dialog.welcome.apiKeyExplanation":" API  Google Gemini API "},uw={"toolbar.edit":" (V)","toolbar.cutter":" (C)","toolbar.selection":" (S)","toolbar.reroute":" (R)","toolbar.zoom":" (Z)","toolbar.snapToGrid":" (Shift+W)","toolbar.resetZoom":"","toolbar.lineStyleSpaghetti":" (Shift+E)","toolbar.lineStyleOrthogonal":" (Shift+E)","toolbar.addNode":" (F)","toolbar.catalog":" (Ctrl+Space)","toolbar.settings":"","toolbar.resetToDefault":"","toolbar.closeProject":" / ","toolbar.enterFullscreen":"","toolbar.exitFullscreen":"","toolbar.home":"","toolbar.addTextInput":" (T)","toolbar.addPromptAnalyzer":" (A)","toolbar.addCharacterAnalyzer":"","toolbar.addCharacterGenerator":" (Shift+C)","toolbar.addImageGenerator":" (O)","toolbar.addImagePreview":" (I)","toolbar.addCharacterCard":" (Ctrl+Shift+C)","toolbar.addPromptProcessor":" (P)","toolbar.addGeminiChat":"Gemini  (G)","toolbar.addTranslator":" (L)","toolbar.addIdeaGenerator":" (Shift+A)","toolbar.addScriptGenerator":" (Shift+S)","toolbar.addScriptAnalyzer":" (Shift+D)","toolbar.addScriptPromptModifier":" (Shift+F)","toolbar.addErrorAnalyzer":"","toolbar.addNote":" (N)","toolbar.addDataReader":" (Shift+R)","toolbar.addSpeechSynthesizer":" (Shift+N)","toolbar.addNarratorTextGenerator":" (Shift+G)","toolbar.addAudioTranscriber":" (Shift+B)","toolbar.addYouTubeTitleGenerator":"YouTube  (Shift+T)","toolbar.addMusicIdeaGenerator":" (Shift+M)","toolbar.addYouTubeAnalytics":"YouTube  (Shift+Y)","toolbar.saveCanvas":" (Ctrl+S)","toolbar.saveProject":" (Ctrl+Shift+S)","toolbar.loadCanvas":" (Ctrl+O)","toolbar.clearCanvas":"","toolbar.group.general":"","toolbar.group.scripting":"","toolbar.group.prompting":"","toolbar.group.characters":"","toolbar.group.ai":"AI ","toolbar.group.file":"","toolbar.group.images":"","toolbar.group.audio":"","toolbar.group.youtube":"YouTube","toolbar.group.canvas":"","toolbar.expand":"","toolbar.collapse":"","toolbar.toggleHeaders":"","hotkeys.file.title":"","hotkeys.file.save":" (Ctrl+S)","hotkeys.file.saveProject":" (Ctrl+Shift+S)","hotkeys.file.load":" (Ctrl+O)","hotkeys.tools.title":"","hotkeys.tools.edit":"","hotkeys.tools.cutter":"","hotkeys.tools.selection":"","hotkeys.tools.reroute":"","hotkeys.tools.zoom":"","hotkeys.tools.group":" (G)","hotkeys.tools.deleteGroup":"","hotkeys.tools.closeNode":"","hotkeys.tools.toggleLineStyle":"","hotkeys.tools.snapToGrid":"","hotkeys.tools.selectAll":"","hotkeys.tools.deselectAll":"","hotkeys.tools.duplicate":"","hotkeys.windows.title":"","hotkeys.windows.search":" (F)","hotkeys.windows.quickAdd":" ()","hotkeys.windows.catalog":"","hotkeys.createNode.title":"","hotkeys.hide":"","help.title":" & ","hotkeys.show":"","search.placeholder":"...","search.noResults":"","search.node.text_input.title":"","search.node.text_input.description":"(T)","search.node.prompt_processor.title":"","search.node.prompt_processor.description":" AI (P)","search.node.prompt_analyzer.title":"","search.node.prompt_analyzer.description":"(A)","search.node.character_analyzer.title":"","search.node.character_analyzer.description":"","search.node.character_generator.title":"","search.node.character_generator.description":"(Shift+C)","search.node.image_generator.title":"","search.node.image_generator.description":"(O)","search.node.image_preview.title":"","search.node.image_preview.description":"(I)","search.node.character_card.title":"","search.node.character_card.description":"(Ctrl+Shift+C)","search.node.gemini_chat.title":"Gemini ","search.node.gemini_chat.description":" Gemini AI (G)","search.node.translator.title":"","search.node.translator.description":"(L)","search.node.script_generator.title":"","search.node.script_generator.description":"(Shift+S)","search.node.script_analyzer.title":"","search.node.script_analyzer.description":"(Shift+D)","search.node.script_prompt_modifier.title":"","search.node.script_prompt_modifier.description":"(Shift+F)","search.node.error_analyzer.title":"","search.node.error_analyzer.description":"","search.node.note.title":"","search.node.note.description":"(N)","search.node.reroute_dot.title":"","search.node.reroute_dot.description":"","search.node.data_reader.title":"","search.node.data_reader.description":"","search.node.speech_synthesizer.title":"","search.node.speech_synthesizer.description":"(Shift+N)","search.node.idea_generator.title":"","search.node.idea_generator.description":"","search.node.narrator_text_generator.title":"","search.node.narrator_text_generator.description":"(Shift+G)","search.node.audio_transcriber.title":"","search.node.audio_transcriber.description":"/(Shift+B)","search.node.youtube_title_generator.title":"YouTube ","search.node.youtube_title_generator.description":"","search.node.music_idea_generator.title":"","search.node.music_idea_generator.description":"(Shift+M)","search.node.youtube_analytics.description":"","search.node.image_editor.title":"","search.node.image_editor.description":" AI ","search.group.input":"","search.group.process":"","search.group.scripting":"","search.group.character":"","search.group.images":"","search.group.ai":"AI ","search.group.audio":"","search.group.youtube":"YouTube ","contextMenu.tools":"","contextMenu.assignSlot":" {index}","contextMenu.addNodeFromSlot":" {node} ({index})","connectionMenu.title":"","quickAddMenu.title":"","contextMenu.paste":" (Ctrl+V)","node.content.simpleActions":"","node.content.smartConcept":"","tooltip.model.flash":"Gemini Flash","tooltip.model.pro":"Gemini Pro","tooltip.lang.ru":"","tooltip.lang.en":"","tooltip.lang.es":"","tooltip.lang.de":"","tooltip.lang.uz":"","tooltip.lang.fr":"","tooltip.lang.it":"","tooltip.lang.pt":"","tooltip.lang.zh":"","node.action.locateInStack":"","help.tabs.hotkeys":"","help.tabs.links":"","help.category.socials":"","help.category.stable":"Google AI Studio ()","help.category.alpha":"Google AI Studio (Alpha)","help.category.web":" / Netlify","help.category.github":"GitHub ","help.link.youtube":"YouTube ","help.link.telegram_channel":"Telegram ","help.link.telegram_chat":"Telegram ","help.sub.news":"","help.sub.discussion":"","help.sub.stable":"","help.sub.alpha":"Alpha ","languages.ru":"","languages.en":"","languages.es":"","languages.fr":"","languages.de":"","languages.it":"","languages.pt":"","languages.zh":"","languages.ja":"","languages.ko":"","languages.uz":""},pw={"node.title.text_input":"","node.title.prompt_processor":"","node.title.prompt_analyzer":"","node.title.character_analyzer":"","node.title.character_generator":"","node.title.image_generator":"","node.title.image_preview":"","node.title.character_card":"","node.title.gemini_chat":"Gemini ","node.title.translator":"","node.title.script_generator":"","node.title.script_analyzer":"","node.title.script_prompt_modifier":"","node.title.error_analyzer":"","node.title.note":"","node.title.reroute_dot":"","node.title.data_reader":"","node.title.speech_synthesizer":"","node.title.idea_generator":"","node.title.narrator_text_generator":"","node.title.audio_transcriber":"","node.title.youtube_title_generator":"YouTube ","node.title.music_idea_generator":"","node.title.youtube_analytics":"YouTube ","node.title.image_editor":"","node.help.text_input":"","node.help.prompt_processor":"","node.help.prompt_analyzer":"","node.help.character_analyzer":"","node.help.character_generator":"","node.help.image_generator":" Gemini API ","node.help.image_preview":"","node.help.character_card":"","node.help.gemini_chat":" Gemini AI ","node.help.translator":"","node.help.script_generator":"","node.help.script_analyzer":"","node.help.script_prompt_modifier":"","node.help.error_analyzer":"","node.help.note":"","node.help.reroute_dot":"","node.help.data_reader":"","node.help.speech_synthesizer":"","node.help.idea_generator":"","node.help.narrator_text_generator":"","node.help.audio_transcriber":"/","node.help.youtube_title_generator":" YouTube ","node.help.music_idea_generator":"","node.help.youtube_analytics":"","node.help.image_editor":" AI ","node.action.help":"","node.action.expand":"","node.action.collapse":" (H)","node.action.expandAll":"","node.action.collapseAll":"","node.action.expandAllScenes":"","node.action.collapseAllScenes":"","node.action.expandAllFrames":"","node.action.collapseAllFrames":"","node.action.expandPanel":"","node.action.collapsePanel":"","node.action.togglePanel":"","node.action.collapseScene":"","node.action.expandScene":"","node.action.collapseFrame":"","node.action.expandFrame":"","node.action.collapseCharacter":"","node.action.expandCharacter":"","node.action.clear":"","node.action.clearTooltip":"","node.action.clearChat":"","node.action.paste":"","node.action.copy":"","node.action.duplicateWithContent":"","node.action.duplicateEmpty":"","node.action.cutConnections":"","node.action.close":"","node.action.executeChain":"","node.action.executeFullChain":"","node.action.processChainForward":"","node.action.executeChainTitle":"","node.action.addCharacter":"","node.action.addScene":"","node.action.addFrame":"","node.action.addFirstFrame":"","node.action.deleteItem":"","node.action.moveUp":"","node.action.moveDown":"","node.action.saveImage":"","node.action.loadImage":"","node.action.saveCharacter":"","node.action.loadCharacter":"","node.action.readData":"","node.action.refreshData":"","node.action.stop":"","node.action.stopping":"...","node.action.embedCharacter":"","node.action.downloadFinalPrompts":"","node.action.rename":"","node.action.index":"","node.action.improveConcept":"","node.action.improveConceptTooltip":"","node.action.downloadJson":" JSON","node.action.downloadSRT":" SRT","node.action.markPrimary":"","node.input.default":"","node.output.default":"","node.output.allCharacters":"","node.output.primaryCharacter":"","node.content.action":"","node.content.actionPlaceholder":"...","node.content.allScriptParts":"","node.content.allScriptAnalyzerData":"","node.content.allNarratorData":"","node.content.analyzeCharacters":"","node.content.analyzeFromScene":"","node.content.analyzeUpToScene":"","node.content.endPlaceholder":"","node.content.generateFromFrame":"","node.content.generateUpToFrame":"","node.content.analyzeFromFrame":"","node.content.processFromFrame":"","node.content.processFromScene":"","node.content.analyzePrompt":"","node.content.analyzeScript":"","node.content.analyzing":"...","node.content.applyAliases":"","node.content.applyAliasesTooltip":"","node.content.character":"","node.content.characterIndex":"","node.content.characterPlaceholder":"...","node.content.character_plural":"","node.content.characters":"","node.content.charactersSynced":"","node.content.noCharactersConnected":"","node.content.appearance":"","node.content.personality":"","node.content.characterType":"","node.content.characterTypeShort":"","node.content.characterType.simple":"","node.content.characterType.anthro":"Anthro ()","node.content.characterType.chibi":"Q ()","node.content.characterType.key_item":"","node.content.style":"","node.content.style.none":"","node.content.style.simple":"","node.content.style.realistic":"/","node.content.style.3d_cartoon":"3D ","node.content.style.3d_realistic":"3D ","node.content.style.2d_animation":"2D ","node.content.style.anime":"","node.content.style.comics":"","node.content.style.custom":"","node.content.chatPlaceholder":"...","node.content.clothing":"","node.content.clothingPlaceholder":"...","node.content.connectedPlaceholder":"","node.content.dataPlaceholder":"...","node.content.readData":"","node.content.reading":"...","node.content.description":"","node.content.sceneDescription":"","node.content.duration":"","node.content.enhancePrompt":"","node.content.enhancedPromptHere":"...","node.content.enhancing":"...","node.content.environment":"","node.content.environmentPlaceholder":"...","node.content.environmentPrompt":"","node.content.compositionAndBlocking":"","node.content.executingChain":"...","node.content.imagePrompt":"","node.content.finalPrompt":"","node.content.finalPrompt_plural":"","node.content.fixErrors":"","node.content.fixingErrors":"...","node.content.frame":"","node.content.frame_plural":"","node.content.frames":"","node.content.frames_analyzed":"{count}","node.content.framesPerScene":"","node.content.minFrames":"","node.content.maxFrames":"","node.content.numberOfCharactersShort":"","node.content.fullDescription":"","node.content.generateCharacters":"","node.content.generateFinalPrompts":"","node.content.generatingProgress":" {current} / {total}","node.content.generateImage":"","node.content.generateScript":"","node.content.generateSpeech":"","node.content.generateText":"","node.content.generateSSML":" SSML","node.content.generateStyle":"","node.content.generating":"...","node.content.improving":"...","node.content.generatedAudio":"","node.content.imagePromptPlaceholder":"...","node.content.modificationPromptPlaceholder":"...","node.content.narrator":"","node.content.narratorEnabled":"","node.content.narratorEnabledInfo":"","node.content.narratorMode":"","node.content.narratorMode.normal":" / ","node.content.narratorMode.dual":"","node.content.narratorMode.first_person":"","node.content.role":"","node.content.role.narrator":"","node.content.role.announcer":"","node.content.role.first_person":"","node.content.role.dual_narrator":"","node.content.role.dual_announcer":"","node.content.scene":"","node.content.scene_plural":"","node.content.scenes":"","node.content.scenes_generated":": {count}","node.content.sceneContext":"","node.content.sceneContextPlaceholder":"...","node.content.scriptPromptPlaceholder":"...","node.content.seconds":"","node.content.stylePlaceholder":"...","node.content.stylePromptPlaceholder":"...","node.content.styleOverride":"","node.content.summary":"","node.content.targetLanguage":"","node.content.textToSynthesize":"...","node.content.translate":"","node.content.translatePlaceholder":"...","node.content.translatedTextPlaceholder":"...","node.content.translating":"...","node.content.useExistingCharacters":"","node.content.useExistingCharactersInfo":"","node.content.createKeyItem":"/","node.content.createSecondaryChars":"","node.content.createKeyItems":"","node.content.createKeyItemInfo":" AI ","node.content.noCharacters":"","node.content.noCharactersInfo":"","node.content.videoPrompt":"","node.content.videoPrompts":"","node.content.voice":"","node.content.previewVoice":"","node.content.voicePreviewText":"","node.content.inputScripts":"","node.content.inputFrames":"","node.content.outputScript":"","node.content.requestCategories":"","node.content.generateIdea":"","node.content.requestNewCategories":"","node.content.category.action":"","node.content.category.place":"","node.content.category.obstacle":"","node.content.generatedIdea":"","node.content.storyFormat":"","node.content.theme":"","node.content.parameters":"","node.content.advancedMode":"","node.content.numberOfScenes":"","node.content.numberOfScenes.auto":"","node.content.detailedPlot":"","node.content.detailedPlotInfo":"","node.content.includeSubscribeScene":"","node.content.includeSubscribeSceneInfo":"","node.content.genre":"","node.content.genre2":" 2","node.content.breakIntoParagraphs":"","node.content.copyVideoPrompt":"","node.content.generateVideoPrompt":"","node.content.model":"","node.content.processWholeScene":"","node.content.processWholeSceneInfo":"","node.content.batchProcessing":"","node.content.batchProcessingInfo":"","node.content.extendedAnalysis":"","node.content.extendedAnalysisInfo":"","node.content.professionalStoryboard":"","node.content.professionalStoryboardInfo":"","node.content.generateStartEndFrames":"/","node.content.autoIndexCharacters":"","node.content.autoIndexCharactersInfo":"","node.content.imageToText":"","node.content.extracting":"...","node.content.extractedText":"","node.content.activePromptStack":"","node.content.noCharactersAnalyzed":"","node.content.promptsGeneratedPlaceholder":"","node.content.noCharactersInScript":"","node.content.noInputScenes":"","node.content.status":"","node.content.status.ready":"","node.content.status.paused":"","node.content.status.generating":"","node.content.status.total":"{generated} / {total}","node.content.status.batch":"{current} / {total}","node.content.status.time":"{current} / {total}","node.content.refreshing":"...","node.content.totalFrames":"{count}","node.content.uploadAudio":"/","node.content.noAudioLoaded":"","node.content.audioLoaded":"","node.content.transcriptionPlaceholder":"...","node.content.transcribe":"","node.content.transcribing":"...","node.content.convertingVideo":"...","node.content.recommendedFrames":"","node.content.shotType":"","node.content.shotType.ws":"WS ()","node.content.shotType.ms":"MS ()","node.content.shotType.cu":"CU ()","node.content.shotType.ecu":"ECU ()","node.content.shotType.ls":"LS ()","node.content.characterDetail":"","node.content.noCharDesc":"","node.content.includeGeneralCharDesc":"","node.content.includeFullCharDesc":"","node.content.safeGeneration":"","node.content.shotFilter":"","node.content.shotFilter.all":"","node.content.shotFilter.wideOnly":"","instruction.desc.shot_filter_all":" (WS, MS, CU, ECU, LS)","instruction.desc.shot_filter_wide":" (WS, MS, LS)","node.content.anthroEnabled":"","node.content.subscribeEnhancement":"","node.content.thinkingEnabled":"","node.content.scenelessMode":"","instruction.desc.sceneless_mode":"","instruction.sceneless_mode":"","node.content.microActionBreakdown":"","node.content.microActionBreakdownInfo":"","node.content.commercialSafe":"","instruction.desc.commercial_safe":"","node.content.findStack":"...","node.content.spm_stack.priming":"1. ","node.content.spm_stack.physics":"2. ","node.content.spm_stack.hierarchy":"3. ","node.content.spm_stack.construction":"4. "},hw={"genre.general":"","genre.comedy":"","genre.drama":"","genre.action":"","genre.scifi":"","genre.fantasy":"","genre.horror":"","genre.thriller":"","genre.childrens_animation":"","genre.shorts_story":" (Shorts)","genre.scientific_historical":"","character_generator.promptPlaceholder":"","idea_generator.randomTheme":"","idea_generator.randomCombination":"","idea_generator.themePlaceholder":"","idea_generator.initialMessage":"{buttonName}","idea_generator.ideaPlaceholder":"...","idea_generator.format.general":"","idea_generator.format.childrens":"","idea_generator.format.adventure":"","idea_generator.format.fantasy":" / ","idea_generator.format.detective":"","idea_generator.format.scifi":"","idea_generator.format.horror":"","idea_generator.format.historical":"","gender.male":"","gender.female":"","node.content.autoDownload":"","node.content.downloadSelected":"","node.content.intonation":"","intonation.standard":"","intonation.cheerful":"","intonation.angry":"","intonation.sad":"","intonation.excited":"","intonation.announcer":"","intonation.whispering":"","node.content.sceneMode":"","node.content.connectNarratorData":"","node.content.sceneModeActive":"","speech_synthesizer.mode.simple":"","speech_synthesizer.mode.scene":"","speech_synthesizer.multiSpeaker":"","speech_synthesizer.speaker1Name":" 1 ","speech_synthesizer.speaker2Name":" 2 ","speech_synthesizer.multiSpeakerHint":"......","speech_synthesizer.ssmlHint":" SSML ","youtube_analytics.authorName":"","youtube_analytics.videoTitle":"","youtube_analytics.views":"","youtube_analytics.addToChannel":"","youtube_analytics.noIncomingData":"","youtube_analytics.videoAdded":"","youtube_analytics.dragDrop":"","youtube_analytics.thumbnailUpdated":"","youtube_analytics.statsTrend":"","youtube_analytics.currentChannel":"","youtube_analytics.growth":"","youtube_analytics.allChannels":"","youtube_analytics.saveDisk":"","youtube_analytics.saveCatalog":"","youtube_analytics.loadDisk":"","youtube_analytics.analyzing":"...","youtube_analytics.askAI":" AI","youtube_analytics.clickForAdvice":" AI","youtube_analytics.dailyNotes":"","youtube_analytics.logDailyStats":"","youtube_analytics.subscribers":"","youtube_analytics.totalViews":"","youtube_analytics.updateStats":"","youtube_analytics.history":"","youtube_analytics.noHistory":"","youtube_analytics.noNotes":"","youtube_analytics.noVideos":"","youtube_analytics.loadedFromDisk":"","youtube_analytics.loadFailed":"","youtube_analytics.savedToDisk":"","youtube_title_generator.mode.title":"","youtube_title_generator.mode.channel":"","youtube_title_generator.ideaPlaceholder":"...","youtube_title_generator.channelIdeaPlaceholder":"...","youtube_title_generator.title":"","youtube_title_generator.description":"","youtube_title_generator.tags":"","youtube_title_generator.channelName":"","youtube_title_generator.channelDescription":"","youtube_title_generator.channelKeywords":"","youtube_title_generator.channelHandle":" (@)","music_idea_generator.mode.lyrics":"","music_idea_generator.mode.music_prompt":"","music_idea_generator.ideaPlaceholder":"...","music_idea_generator.songTitle":"","music_idea_generator.songTitlePlaceholder":"...","music_idea_generator.lyricsPlaceholder":"...","music_idea_generator.musicPromptPlaceholder":"AI ...","chat.mode.general":"","chat.mode.script":"","chat.mode.prompt":"","chat.mode.youtube":"YouTube "},mw={"catalog.title":"","catalog.tabs.groups":"","catalog.tabs.library":"","catalog.tabs.characters":"","catalog.tabs.scripts":"","catalog.tabs.analysis":"","catalog.tabs.final_prompts":"","catalog.tabs.youtube":"YouTube","catalog.tabs.music":"","catalog.empty.title":"","catalog.empty.description":"","catalog.loadFromFile":"","catalog.card.addToCanvas":"","catalog.card.rename":"","catalog.card.save":"","catalog.card.delete":"","library.loadFromFile":"","library.empty.title":"","library.empty.description":"","library.emptyPrompt":"","library.actions.newFolder":"","library.actions.newPrompt":"","library.actions.copy":"","library.actions.edit":"","group.rename":"","group.saveToCatalog":"","group.saveToDisk":"","group.ungroup":" (Shift+)","group.button.create":" ({count})"},gw={"dialog.rename.title":"","dialog.rename.group.title":"","dialog.rename.catalog.title":"","dialog.rename.label":"","dialog.rename.confirm":"","dialog.rename.cancel":"","dialog.promptEdit.title":"","dialog.promptEdit.nameLabel":"","dialog.promptEdit.contentLabel":"","dialog.promptEdit.confirm":"","dialog.promptEdit.cancel":"","dialog.reset.title":"","dialog.reset.message":"","dialog.exit.title":"","dialog.exit.message":"","dialog.settings.title":"","dialog.settings.apiKeyLabel":"Gemini API ","dialog.settings.apiKeyPlaceholder":"","dialog.settings.getApiKeyLink":" Google AI Studio  API ","dialog.settings.useFreeKey":" () ","dialog.settings.save":"","dialog.settings.close":"","dialog.apiKey.title":"API ","dialog.apiKey.description":" Gemini API ","dialog.apiKey.keyExists":"API ","dialog.apiKey.clear":"","dialog.apiKey.save":"","dialog.apiKey.update":"","dialog.apiKey.useFreeKey":" ()","dialog.permission.title":"","dialog.permission.description":"","dialog.permission.decline":"","dialog.permission.allow":"","alert.groupSaved":' "{groupTitle}" ',"toast.groupSavedToDisk":' "{groupTitle}" ',"alert.confirmDelete":"","alert.invalidCatalogFile":"","alert.loadCatalogFailed":"","alert.confirmLoadProject":"","dialog.confirmDelete.title":"","dialog.confirmDelete.message":' "{itemName}" ',"dialog.confirmDelete.folderMessage":' "{itemName}" ',"dialog.confirmDelete.confirm":"","dialog.confirmDelete.cancel":"","dialog.confirmClear.title":"","dialog.confirmClear.message":"","toast.copied":"","toast.pasted":"","toast.cleared":"","toast.resetComplete":"","toast.projectSaved":"","toast.canvasSaved":"","toast.saveFailed":"","toast.connectionsCut":"","toast.charSaved":"","toast.charLoaded":"","toast.videoPasted":"","toast.savedToCatalog":"","toast.apiKeySaved":"API ","toast.apiKeyCleared":"API ","toast.projectLoaded":"","alert.batchMismatch":" {scene} "},fw={"instruction.desc.safe_gen":" AI  'teenager', 'intimate'  'revealing'  'young person', 'artistic composition'  'stylized' ","instruction.desc.layered_no_style":"1. [ ( ->  -> )] -> 2. [ ( ->  -> )] -> 3. []"},yw={"instruction.sg_inputs":"","instruction.desc.sg_inputs":"/","instruction.core_director":"","instruction.desc.core_director":"","instruction.sg_thinking":"","instruction.desc.sg_thinking":"","instruction.sg_improve_input":"","instruction.desc.sg_improve_input":"","instruction.sg_exposition":"","instruction.desc.sg_exposition":"","instruction.sg_delayed_reveal":"","instruction.desc.sg_delayed_reveal":" ->  ->  -> ","instruction.sg_metaphor":"","instruction.desc.sg_metaphor":"","instruction.sg_pacing":"","instruction.desc.sg_pacing":"","instruction.sg_subtext":"","instruction.desc.sg_subtext":"","instruction.desc.sg_frame_estimation":"","instruction.rule_visuals":"","instruction.desc.rule_visuals":" '' ''","instruction.sg_visual_dna":" DNA","instruction.desc.sg_visual_dna":" LookDev ","instruction.rule_flow":"","instruction.desc.rule_flow":"","instruction.rule_atmosphere":"","instruction.desc.rule_atmosphere":"","instruction.sg_visual_style":"","instruction.desc.sg_visual_style":" '{style}' ","instruction.char_detailed_style":"","instruction.desc.char_detailed_style":"","instruction.sg_genre":"","instruction.desc.sg_genre":"{genre}","instruction.char_smart_concept":"","instruction.desc.char_smart_concept":"AI  / ","instruction.char_no_dupes":"","instruction.desc.char_no_dupes":"","instruction.create_secondary_chars":"","instruction.desc.create_secondary_chars":"","instruction.create_key_items":"","instruction.desc.create_key_items":" >2  ''","instruction.char_secondary_ok":"","instruction.desc.char_secondary_ok":"","instruction.sg_anthro":"Anthro","instruction.desc.sg_anthro":"","instruction.sg_no_chars":"","instruction.desc.sg_no_chars":" / ","instruction.sg_detailed_plot":"","instruction.desc.sg_detailed_plot":"","instruction.sg_subscribe":"","instruction.desc.sg_subscribe":"","instruction.char_gray_bg":"","instruction.desc.char_gray_bg":"', full body character concept on a gray background'","instruction.char_no_new":"","instruction.desc.char_no_new":"","instruction.sg_new_chars":"","instruction.desc.sg_new_chars":"","instruction.sg_living_world":"","instruction.desc.sg_living_world_simple":"","instruction.desc.sg_living_world_anthro":"","instruction.sg_simple_actions":"","instruction.desc.sg_simple_actions":"/","instruction.commercial_safe":"","instruction.desc.commercial_safe":" (Disney, Pixar ) "},xw={"instruction.ana_role":"","instruction.desc.ana_role":" AI ","instruction.ana_cinema":"","instruction.desc.ana_cinema":"Wide Shot, Close-up, Dutch Angle, Bokeh","instruction.ana_cinema_wide":" ()","instruction.desc.ana_cinema_wide":"Wide Shot, Long Shot. ","instruction.ana_anthro_logic":"Anthro ","instruction.desc.ana_anthro_logic":"","instruction.ana_subscribe_logic":"","instruction.desc.ana_subscribe_logic":" 3D ","instruction.rule_hierarchy":"","instruction.desc.rule_hierarchy":"1.  (/)2. 3. 4. ","instruction.rule_living_world":"","instruction.desc.rule_living_world":"","instruction.desc.rule_living_world_anthro":" ()","instruction.rule_persistence":"","instruction.desc.rule_persistence":"","instruction.rule_mandatory_bg":"","instruction.desc.rule_mandatory_bg":"","instruction.desc.rule_mandatory_bg_wide":"","instruction.shot_filter_wide":"","instruction.desc.shot_filter_wide":" Wide, Long,  Medium  Close-up (CU/ECU)","instruction.storyboard_rules":"","instruction.desc.storyboard_rules":" WS/LS, MS  CU/ECU ","instruction.storyboard_rules_wide":" ()","instruction.desc.storyboard_rules_wide":" Wide, Long  Establishing","instruction.tech_directives":"","instruction.desc.tech_directives":" (WS, MS, CU)","instruction.tech_directives_wide":" ()","instruction.desc.tech_directives_wide":" WS, MS, LS CU/ECU","instruction.use_aliases":"","instruction.desc.use_aliases":" Character-N ","instruction.action_phase_breakdown":"","instruction.desc.action_phase_breakdown":"","instruction.desc.action_phase_breakdown_wide":"","instruction.batch_processing":"","instruction.desc.batch_processing":"","instruction.ana_prompt_lang":"","instruction.desc.ana_prompt_lang":"","instruction.extended_visuals":"","instruction.desc.extended_visuals":" (Wide, MS, CU, Detail)","instruction.extended_visuals_wide":" ()","instruction.desc.extended_visuals_wide":"/","instruction.desc.target_lang":"","instruction.rule_isolation":"","instruction.desc.rule_isolation":"","instruction.sensory_saturation":"","instruction.desc.sensory_saturation":"","instruction.ana_no_pov":" POV","instruction.desc.ana_no_pov":' "POV"  ""  (, )',"instruction.desc.static_frame_logic":' ("walking")',"instruction.desc.anatomical_posing":"","instruction.desc.motion_dynamics":"Image Prompt = 100% Video Prompt = ","instruction.desc.anatomical_strictness":' "" [] []',"instruction.desc.prop_consistency":' ("") ("") ',"instruction.desc.subject_hierarchy":"1. /2. 3. ","instruction.inputs_data":"","instruction.desc.inputs_data":""},vw={"instruction.inputs":"","instruction.desc.inputs":"","instruction.role":"","instruction.desc.role":"","instruction.layered":"","instruction.desc.layered":"[] -> [] -> [] + [] -> []","instruction.desc.layered_no_char":"[] -> []","instruction.visuals":"","instruction.desc.visuals":"8k ","instruction.process_whole_scene":"","instruction.desc.process_whole_scene":"","instruction.video":"","instruction.desc.video":"[] () [][][]","instruction.stateless":"","instruction.desc.stateless":"","instruction.rule_static":"","instruction.desc.rule_static":"","instruction.atmosphere_fix":"","instruction.desc.atmosphere_fix":"","instruction.subject_focus":"","instruction.desc.subject_focus":"1. 2. 3. AI ","instruction.always_env":"","instruction.desc.always_env":"","instruction.pm_anthro":"Anthro ","instruction.desc.pm_anthro":' "anthropomorphic" /',"instruction.pm_subscribe":"","instruction.desc.pm_subscribe":' "SUBSCRIBE"  ()',"instruction.strict_char_index":"","instruction.desc.strict_char_index":" (Character-N) ","instruction.no_names":"","instruction.desc.no_names":" ID `[Character-N]`","instruction.general_char_desc":"","instruction.desc.general_char_desc":"","instruction.full_char_desc":"","instruction.desc.full_char_desc":"","instruction.formatting":"","instruction.desc.formatting":"","instruction.anatomical_strictness":"","instruction.desc.anatomical_strictness":' ""',"instruction.img_vid_consistency":"->","instruction.desc.img_vid_consistency":"Image Prompt = /Video Prompt = /","instruction.desc.prop_enhancement":' ( "" -> "")',"instruction.no_pov":" POV","instruction.desc.no_pov":" POV  ()"},bw={"instruction.music_role":"","instruction.desc.music_role":"","instruction.music_input":"","instruction.desc.music_input":"","instruction.music_creative":"","instruction.desc.music_creative":" AI ","instruction.music_lyrics":"","instruction.desc.music_lyrics":"/","instruction.music_prompt_rule":"AI ","instruction.desc.music_prompt_rule":"Suno/Udio  (BPM, , ) 1000 ","instruction.music_format":"JSON ","instruction.desc.music_format":" JSON "},ww={"instruction.yt_role":"YouTube ","instruction.desc.yt_role":"SEO, CTR ","instruction.yt_input":"","instruction.desc.yt_input":"","instruction.yt_title_mode":"","instruction.desc.yt_title_mode":"//","instruction.yt_channel_mode":"","instruction.desc.yt_channel_mode":"","instruction.yt_format":"JSON ","instruction.desc.yt_format":" JSON "},_w={...fw,...yw,...xw,...vw,...bw,...ww},Cw={...dw,...uw,...pw,...hw,...mw,...gw,..._w},Ad={en:S1,ru:z1,es:Q1,uz:sb,de:wb,fr:Lb,it:Kb,pt:cw,zh:Cw,sys:{}},zl=[{code:"en",name:"English",englishName:"English",label:"EN"},{code:"ru",name:"",englishName:"Russian",label:"RU"},{code:"es",name:"Espaol",englishName:"Spanish",label:"ES"},{code:"de",name:"Deutsch",englishName:"German",label:"DE"},{code:"fr",name:"Franais",englishName:"French",label:"FR"},{code:"it",name:"Italiano",englishName:"Italian",label:"IT"},{code:"pt",name:"Portugus",englishName:"Portuguese",label:"PT"},{code:"uz",name:"Ozbek",englishName:"Uzbek",label:"UZ"},{code:"zh",name:"",englishName:"Chinese",label:"ZH"},{code:"sys",name:"System (Keys)",englishName:"System",label:"SYS"}],Sw=Object.keys(Ad),Of=x.createContext(void 0),Ht=()=>{const e=x.useContext(Of);if(e===void 0)throw new Error("useLanguage must be used within a LanguageProvider");return e},Tw=(e,t,n)=>{if(e==="sys")return t;const r=Ad[e],a=Ad.en;let i=(r==null?void 0:r[t])||a[t]||t;return n&&typeof i=="string"&&Object.keys(n).forEach(s=>{i=i.replace(`{${s}}`,String(n[s]))}),i},Ti=(e,t)=>{const n={[S.SCRIPT_GENERATOR]:680,[S.SCRIPT_ANALYZER]:680,[S.SCRIPT_PROMPT_MODIFIER]:680,[S.CHARACTER_GENERATOR]:460,[S.CHARACTER_ANALYZER]:460,[S.CHARACTER_CARD]:460,[S.TEXT_INPUT]:460,[S.PROMPT_PROCESSOR]:460,[S.PROMPT_ANALYZER]:460,[S.IMAGE_GENERATOR]:400,[S.IMAGE_PREVIEW]:300,[S.GEMINI_CHAT]:400,[S.TRANSLATOR]:380,[S.ERROR_ANALYZER]:380,[S.NOTE]:440,[S.DATA_READER]:380,[S.SPEECH_SYNTHESIZER]:680,[S.NARRATOR_TEXT_GENERATOR]:680,[S.IDEA_GENERATOR]:680,[S.AUDIO_TRANSCRIBER]:400,[S.YOUTUBE_TITLE_GENERATOR]:680,[S.MUSIC_IDEA_GENERATOR]:680,[S.YOUTUBE_ANALYTICS]:1200,[S.IMAGE_EDITOR]:800,[S.REROUTE_DOT]:60},r={[S.SCRIPT_GENERATOR]:800,[S.SCRIPT_ANALYZER]:800,[S.SCRIPT_PROMPT_MODIFIER]:800,[S.CHARACTER_GENERATOR]:1e3,[S.CHARACTER_ANALYZER]:500,[S.CHARACTER_CARD]:1e3,[S.TEXT_INPUT]:280,[S.PROMPT_PROCESSOR]:280,[S.PROMPT_ANALYZER]:1e3,[S.IMAGE_GENERATOR]:520,[S.IMAGE_PREVIEW]:340,[S.GEMINI_CHAT]:640,[S.TRANSLATOR]:640,[S.ERROR_ANALYZER]:280,[S.NOTE]:640,[S.DATA_READER]:280,[S.SPEECH_SYNTHESIZER]:800,[S.NARRATOR_TEXT_GENERATOR]:800,[S.IDEA_GENERATOR]:800,[S.AUDIO_TRANSCRIBER]:480,[S.YOUTUBE_TITLE_GENERATOR]:800,[S.MUSIC_IDEA_GENERATOR]:800,[S.YOUTUBE_ANALYTICS]:800,[S.IMAGE_EDITOR]:600,[S.REROUTE_DOT]:40};let a="";return e===S.MUSIC_IDEA_GENERATOR?a=JSON.stringify({generateLyrics:!0,verseCount:2,idea:"",targetLanguages:{ru:!0,en:!1},generatedLyrics:{},generatedMusicPrompts:{},generatedTitles:{},model:"gemini-3-flash-preview"}):e===S.YOUTUBE_TITLE_GENERATOR?a=JSON.stringify({mode:"title",idea:"",targetLanguages:{ru:!0,en:!1},generatedTitleOutputs:{},generatedChannelOutputs:{}}):e===S.YOUTUBE_ANALYTICS?a=JSON.stringify({channels:[{id:"default",name:"Main Channel",videos:[],stats:[]}],activeChannelId:"default"}):e===S.SCRIPT_GENERATOR&&(a=JSON.stringify({prompt:"",scenes:[],detailedCharacters:[]})),{width:n[e]||200,height:r[e]||150,title:t(`node.title.${e.toLowerCase()}`),value:a}},Ew=(e,t)=>{const[n,r]=x.useState(e),a=x.useRef(t),i=x.useCallback((y,v,C,w,b)=>{a.current+=1;const f=`node-${a.current}-${Date.now()}`,T=Ti(y,C),I={id:f,type:y,position:v,title:b||T.title,value:w||T.value,width:T.width,height:T.height};return r(E=>[...E,I]),f},[]),s=x.useCallback(y=>{r(v=>v.filter(C=>C.id!==y))},[]),l=x.useCallback((y,v)=>{r(C=>C.map(w=>w.id===y?{...w,value:v}:w))},[]),c=x.useCallback(async y=>{const v=n.find(C=>C.id===y);if(v){let C=v.value;if(v.type===S.SCRIPT_PROMPT_MODIFIER)try{const w=JSON.parse(v.value),b={type:"script-prompt-modifier-data",finalPrompts:w.finalPrompts||[],videoPrompts:w.videoPrompts||[],sceneContexts:w.sceneContexts||{},usedCharacters:w.usedCharacters||[],visualStyle:w.styleOverride||w.generatedStyle||w.visualStyle||"",title:v.title};C=JSON.stringify(b,null,2)}catch(w){console.error("Failed to parse script prompt modifier data for copy",w)}else if(v.type===S.SCRIPT_GENERATOR)try{const w=JSON.parse(v.value),b={type:"script-generator-data",scenes:w.scenes||[],detailedCharacters:w.detailedCharacters||[],prompt:w.prompt||"",summary:w.summary||"",generatedStyle:w.generatedStyle||"",title:v.title};C=JSON.stringify(b,null,2)}catch(w){console.error("Failed to parse script generator data for copy",w)}else if(v.type===S.SCRIPT_ANALYZER)try{const w=JSON.parse(v.value),b={type:"script-analyzer-data",scenes:w.scenes||[],characters:w.characters||[],visualStyle:w.visualStyle||w.generatedStyle||"",title:v.title};C=JSON.stringify(b,null,2)}catch(w){console.error("Failed to parse script analyzer data for copy",w)}else if(v.type===S.CHARACTER_CARD)try{const w=JSON.parse(v.value),b=Array.isArray(w)?w.map(f=>{const T={},I=["1:1","16:9","9:16"],E=f.imageSources||f.thumbnails||{};return I.forEach(R=>{let N=E[R];R==="1:1"&&!N&&(N=f.image),N?T[R]=N.startsWith("data:image")?N:`data:image/png;base64,${N}`:T[R]=null}),{type:"character-card",nodeTitle:v.title,name:f.name,index:f.index,image:T["1:1"]||null,selectedRatio:f.selectedRatio||"1:1",prompt:f.prompt,fullDescription:f.fullDescription,imageSources:T,additionalPrompt:f.additionalPrompt,targetLanguage:f.targetLanguage,isOutput:f.isOutput,isActive:f.isActive,isDescriptionCollapsed:f.isDescriptionCollapsed,isImageCollapsed:f.isImageCollapsed,isPromptCollapsed:f.isPromptCollapsed}}):[];C=JSON.stringify(b,null,2)}catch(w){console.error("Failed to parse character card data for copy",w)}await navigator.clipboard.writeText(C)}},[n]),d=x.useCallback(async y=>{try{const v=await navigator.clipboard.readText();r(C=>C.map(w=>w.id===y?{...w,value:v}:w))}catch(v){console.error(v)}},[]),h=x.useCallback(y=>{r(v=>v.map(C=>C.id===y?{...C,isCollapsed:!C.isCollapsed}:C))},[]),g=x.useCallback(y=>{const v=n.find(b=>b.id===y);if(!v)return"";a.current+=1;const C=`node-${a.current}-${Date.now()}`,w={...v,id:C,position:{x:v.position.x+50,y:v.position.y+50}};return r(b=>[...b,w]),C},[n]),m=x.useCallback((y,v)=>{const C=n.find(T=>T.id===y);if(!C)return"";a.current+=1;const w=`node-${a.current}-${Date.now()}`,b=Ti(C.type,v),f={...C,id:w,position:{x:C.position.x+50,y:C.position.y+50},value:b.value,title:C.title};return r(T=>[...T,f]),w},[n]),_=x.useCallback(y=>{r(v=>v.map(C=>C.id===y?{...C,areOutputHandlesHidden:!C.areOutputHandlesHidden}:C))},[]);return{nodes:n,setNodes:r,nodeIdCounter:a,handleAddNode:i,handleDeleteNode:s,handleValueChange:l,handleCopyNodeValue:c,handlePasteNodeValue:d,handleToggleNodeCollapse:h,handleDuplicateNode:g,handleDuplicateNodeEmpty:m,handleToggleNodeOutputVisibility:_}},Nw=e=>{const[t,n]=x.useState(()=>e.map((s,l)=>({...s,id:s.id||`initial-conn-${Date.now()}-${l}`}))),r=x.useCallback(s=>{n(l=>{if(l.some(d=>d.fromNodeId===s.fromNodeId&&d.toNodeId===s.toNodeId&&d.fromHandleId===s.fromHandleId))return l;const c={...s,id:`conn-${Date.now()}-${Math.random().toString(36).substr(2,9)}`};return[...l,c]})},[]),a=x.useCallback(s=>{n(l=>l.filter(c=>c.fromNodeId!==s&&c.toNodeId!==s))},[]),i=x.useCallback(s=>{n(l=>l.filter(c=>c.id!==s))},[]);return{connections:t,setConnections:n,addConnection:r,removeConnectionsByNodeId:a,removeConnectionById:i}},kw=(e={scale:1,translate:{x:0,y:0}})=>{const[t,n]=x.useState(e),[r,a]=x.useState(null),[i,s]=x.useState({x:0,y:0}),[l,c]=x.useState({x:0,y:0}),d=x.useCallback((b,f)=>{const T=Math.max(.2,Math.min(b,2)),I=(f.x-t.translate.x)/t.scale,E=(f.y-t.translate.y)/t.scale,R=f.x-I*T,N=f.y-E*T;n({scale:T,translate:{x:R,y:N}})},[t.scale,t.translate.x,t.translate.y,n]),h=x.useCallback(b=>{b.preventDefault();const f=1.1,T=b.deltaY<0?t.scale*f:t.scale/f;d(T,{x:b.clientX,y:b.clientY})},[t.scale,d]),g=x.useCallback(b=>{a({startPoint:{x:b.clientX,y:b.clientY},startTranslate:t.translate})},[t.translate]),m=x.useCallback(()=>a(null),[]),_=x.useCallback(b=>{if(!r||r.initialDistance)return;const f=b.clientX-r.startPoint.x,T=b.clientY-r.startPoint.y;n(I=>({...I,translate:{x:r.startTranslate.x+f,y:r.startTranslate.y+T}}))},[r,n]),y=x.useCallback(b=>{const f={x:(b.clientX-t.translate.x)/t.scale,y:(b.clientY-t.translate.y)/t.scale};s(f),c({x:b.clientX,y:b.clientY})},[t]),v=x.useCallback(b=>{if(b.preventDefault(),b.touches.length===1)a({startPoint:{x:b.touches[0].clientX,y:b.touches[0].clientY},startTranslate:t.translate});else if(b.touches.length===2){const f=Math.hypot(b.touches[0].clientX-b.touches[1].clientX,b.touches[0].clientY-b.touches[1].clientY),T={x:(b.touches[0].clientX+b.touches[1].clientX)/2,y:(b.touches[0].clientY+b.touches[1].clientY)/2};a({startPoint:T,startTranslate:t.translate,initialDistance:f,initialScale:t.scale})}},[t.translate,t.scale]),C=x.useCallback(b=>{if(b.preventDefault(),!!r){if(b.touches.length===1&&r.initialDistance===void 0){const f=b.touches[0].clientX-r.startPoint.x,T=b.touches[0].clientY-r.startPoint.y;n(I=>({...I,translate:{x:r.startTranslate.x+f,y:r.startTranslate.y+T}}))}else if(b.touches.length===2&&r.initialDistance!==void 0&&r.initialScale!==void 0){const f=Math.hypot(b.touches[0].clientX-b.touches[1].clientX,b.touches[0].clientY-b.touches[1].clientY),T={x:(b.touches[0].clientX+b.touches[1].clientX)/2,y:(b.touches[0].clientY+b.touches[1].clientY)/2},I=f/r.initialDistance*r.initialScale,E=Math.max(.2,Math.min(I,2)),R=(r.startPoint.x-r.startTranslate.x)/r.initialScale,N=(r.startPoint.y-r.startTranslate.y)/r.initialScale,A=T.x-R*E,k=T.y-N*E;n({scale:E,translate:{x:A,y:k}})}}},[r,n]),w=x.useCallback(b=>{b.touches.length===1?a({startPoint:{x:b.touches[0].clientX,y:b.touches[0].clientY},startTranslate:t.translate}):a(null)},[t.translate]);return{viewTransform:t,setViewTransform:n,isPanning:r,pointerPosition:i,clientPointerPosition:l,handleWheel:h,startPanning:g,stopPanning:m,pan:_,updatePointerPosition:y,setZoom:d,handleCanvasTouchStart:v,handleCanvasTouchMove:C,handleCanvasTouchEnd:w}},Aw=({nodes:e,connections:t,groups:n,viewTransform:r,nodeIdCounter:a,setNodes:i,setConnections:s,setGroups:l,setViewTransform:c,activeTabName:d,onLoadProject:h,addToast:g,setGlobalError:m,onAddNode:_,handleAddGroupFromTemplate:y})=>{const v=x.useRef(null),{t:C}=Ht(),w=x.useCallback(()=>{try{const I={type:"script-modifier-canvas",nodes:e,connections:t,groups:n,viewTransform:r,nodeIdCounter:a.current},E=JSON.stringify(I,null,2),R=new Blob([E],{type:"application/json"}),N=URL.createObjectURL(R),A=document.createElement("a"),k=new Date,P=k.getFullYear(),M=String(k.getMonth()+1).padStart(2,"0"),H=String(k.getDate()).padStart(2,"0"),W=String(k.getHours()).padStart(2,"0"),O=String(k.getMinutes()).padStart(2,"0"),U=String(k.getSeconds()).padStart(2,"0"),z=`${P}-${M}-${H}_${W}-${O}-${U}`,L=d.replace(/ /g,"_").replace(/[^a-zA-Z0-9_.-]/g,"");return A.href=N,A.download=`Script_Modifier_Canvas_${L}_${z}.SMC`,A.click(),URL.revokeObjectURL(N),A.remove(),g(C("toast.canvasSaved"),"success"),null}catch(I){return console.error("Failed to save canvas:",I),"Could not save canvas state."}},[e,t,n,r,a,d,g,C]),b=x.useCallback(()=>{var I;(I=v.current)==null||I.click()},[]),f=x.useCallback(I=>{var E,R;try{if(!I)throw new Error("File content is empty.");let N;try{N=JSON.parse(I)}catch{throw new Error("Invalid JSON format.")}if(N.type==="prompt-modifier-canvas"||N.type==="prompt-modifier-project"){m(C("error.promptModifierFile"));return}if(N.type==="script-modifier-project"){if(h){h(N);return}return}if((N.type==="scriptModifierGroup"||N.type==="group")&&y){const P={x:(-r.translate.x+window.innerWidth/2)/r.scale,y:(-r.translate.y+window.innerHeight/2)/r.scale};y(N,P),g(C("toast.pasted"),"success");return}if(N.type&&_){const P={x:(-r.translate.x+window.innerWidth/2)/r.scale,y:(-r.translate.y+window.innerHeight/2)/r.scale};let M=null,H=N;switch(N.type){case"script-generator-data":M=S.SCRIPT_GENERATOR,H={scenes:N.scenes};break;case"script-analyzer-data":M=S.SCRIPT_ANALYZER,H={scenes:N.scenes};break;case"script-prompt-modifier-data":M=S.SCRIPT_PROMPT_MODIFIER,H={finalPrompts:N.finalPrompts};break;case"youtube-title-data":M=S.YOUTUBE_TITLE_GENERATOR;break;case"youtube-analytics-data":M=S.YOUTUBE_ANALYTICS;break;case"music-idea-data":M=S.MUSIC_IDEA_GENERATOR;break;case"character-generator-data":M=S.CHARACTER_GENERATOR,H={characters:N.characters};break;case"character-card":M=S.CHARACTER_CARD;break}if(M){_(M,P,JSON.stringify(H),N.title),g(C("toast.pasted"),"success");return}}const A=N.type==="script-modifier-canvas",k=!N.type&&Array.isArray(N.nodes)&&Array.isArray(N.connections);if(!A&&!k)throw new Error(C("error.invalidFileType"));if(Array.isArray(N.nodes)&&Array.isArray(N.connections)&&((E=N.viewTransform)!=null&&E.scale)&&((R=N.viewTransform)!=null&&R.translate)&&typeof N.nodeIdCounter=="number"){i(N.nodes);const P=N.connections.map((M,H)=>({...M,id:M.id||`loaded-conn-${Date.now()}-${H}`}));s(P),l(N.groups||[]),c(N.viewTransform),a.current=N.nodeIdCounter,g(C("toast.canvasLoaded"),"success")}else throw new Error(C("error.invalidFileType"))}catch(N){N.message===C("error.invalidFileType")||N.message===C("error.promptModifierFile")?m(N.message):m(`${C("error.fileReadError")}: ${N.message}`)}},[a,s,l,i,c,h,g,m,C,y,r,_]),T=x.useCallback(I=>{var N;const E=(N=I.target.files)==null?void 0:N[0];if(!E)return;const R=new FileReader;R.onload=A=>{var P;const k=(P=A.target)==null?void 0:P.result;k&&f(k),I.target&&(I.target.value="")},R.readAsText(E)},[f]);return{fileInputRef:v,handleSaveCanvas:w,handleLoadCanvas:b,handleFileChange:T,loadStateFromFileContent:f}},Iw=e=>{const[t,n]=x.useState(e),r=x.useRef(0),a=x.useCallback((s,l)=>{if(s.length===0)return;let c=1/0,d=1/0,h=-1/0,g=-1/0;s.forEach(v=>{c=Math.min(c,v.position.x),d=Math.min(d,v.position.y),h=Math.max(h,v.position.x+v.width);const C=v.isCollapsed?40:v.height;g=Math.max(g,v.position.y+C)});const m=30,_=70;r.current++;const y={id:`group-${r.current}-${Date.now()}`,title:l||`Group ${r.current}`,position:{x:c-m,y:d-_},width:h-c+m*2,height:g-d+_+m,nodeIds:s.map(v=>v.id)};n(v=>[...v,y])},[]),i=x.useCallback(s=>{n(l=>l.filter(c=>c.id!==s))},[]);return{groups:t,setGroups:n,addGroup:a,removeGroup:i}},sa=420,Go={"1:1":1,"16:9":2,"9:16":3},Ua=(e,t)=>{switch(e.type){case S.TEXT_INPUT:case S.PROMPT_PROCESSOR:case S.TRANSLATOR:case S.PROMPT_ANALYZER:case S.CHARACTER_ANALYZER:case S.CHARACTER_GENERATOR:case S.SCRIPT_GENERATOR:case S.SCRIPT_ANALYZER:case S.SCRIPT_PROMPT_MODIFIER:case S.ERROR_ANALYZER:case S.CHARACTER_CARD:case S.NARRATOR_TEXT_GENERATOR:case S.IDEA_GENERATOR:case S.AUDIO_TRANSCRIBER:case S.YOUTUBE_TITLE_GENERATOR:case S.MUSIC_IDEA_GENERATOR:case S.YOUTUBE_ANALYTICS:return"text";case S.IMAGE_GENERATOR:return"image";case S.REROUTE_DOT:try{return JSON.parse(e.value||"{}").type||null}catch{return null}default:return null}},Jr=(e,t)=>{switch(e.type){case S.PROMPT_PROCESSOR:case S.TRANSLATOR:case S.PROMPT_ANALYZER:case S.CHARACTER_ANALYZER:case S.CHARACTER_GENERATOR:case S.IMAGE_GENERATOR:case S.SCRIPT_GENERATOR:case S.SCRIPT_ANALYZER:case S.SCRIPT_PROMPT_MODIFIER:case S.ERROR_ANALYZER:case S.DATA_READER:case S.SPEECH_SYNTHESIZER:case S.NARRATOR_TEXT_GENERATOR:case S.YOUTUBE_TITLE_GENERATOR:case S.MUSIC_IDEA_GENERATOR:case S.YOUTUBE_ANALYTICS:return"text";case S.IMAGE_PREVIEW:return"image";case S.REROUTE_DOT:return null;default:return null}},In=20,Bs=40,Eh=(e,t)=>e.map(n=>{const r=t.filter(y=>n.nodeIds.includes(y.id));if(r.length===0)return n;const a=30,i=70;let s=1/0,l=1/0,c=-1/0,d=-1/0;r.forEach(y=>{s=Math.min(s,y.position.x),l=Math.min(l,y.position.y),c=Math.max(c,y.position.x+y.width);const v=y.isCollapsed?Bs:y.height;d=Math.max(d,y.position.y+v)});const h=s-a,g=l-i,m=c-s+a*2,_=d-l+i+a;return n.position.x===h&&n.position.y===g&&n.width===m&&n.height===_?n:{...n,position:{x:h,y:g},width:m,height:_}}),Pw=({nodes:e,setNodes:t,groups:n,setGroups:r,addConnection:a,connections:i,setConnections:s,viewTransform:l,updatePointerPosition:c,pan:d,isPanning:h,startPanning:g,stopPanning:m,isSnapToGrid:_,onAddNode:y,removeConnectionsByNodeId:v,setZoom:C,triggerClearSelections:w,t:b,clientPointerPosition:f,clientPointerPositionRef:T,handleExtractNodeFromGroup:I,isQuickAddOpen:E,handleCloseAddNodeMenus:R,openRadialMenu:N,onConnectionReleased:A})=>{const[k,P]=x.useState("edit"),[M,H]=x.useState(null),[W,O]=x.useState(null),[U,z]=x.useState(null),[L,D]=x.useState(null),[G,q]=x.useState(null),[ie,te]=x.useState([]),[ye,ue]=x.useState(null),[$,ee]=x.useState(null),[Te,le]=x.useState(!1),[J,ge]=x.useState(!1),[ae,ce]=x.useState(!1),[B,X]=x.useState(!1),[F,Y]=x.useState(null),[K,V]=x.useState(null),oe=x.useRef(e);x.useEffect(()=>{oe.current=e},[e]);const de=x.useCallback(()=>{le(!1),ge(!1),ce(!1),X(!1),ee(null),V(null)},[]);x.useEffect(()=>{const pe=Ee=>{const Fe=Ee.target;Fe.tagName==="INPUT"||Fe.tagName==="TEXTAREA"||(Ee.key==="Shift"&&!Ee.repeat&&le(!0),Ee.key==="Control"&&!Ee.repeat&&ge(!0),Ee.key==="Alt"&&!Ee.repeat&&ce(!0),Ee.code==="KeyZ"&&!Ee.repeat&&X(!0))},Se=Ee=>{Ee.key==="Shift"&&(le(!1),$&&ee(null)),Ee.key==="Control"&&ge(!1),Ee.key==="Alt"&&(ce(!1),V(null)),Ee.code==="KeyZ"&&X(!1)};return window.addEventListener("keydown",pe),window.addEventListener("keyup",Se),window.addEventListener("blur",de),()=>{window.removeEventListener("keydown",pe),window.removeEventListener("keyup",Se),window.removeEventListener("blur",de)}},[$,de]);const Z=B?"zoom":k==="edit"?J&&ae?"reroute":J?"cutter":Te?"selection":"edit":k;x.useEffect(()=>{if(U&&G){const pe=e.find(Se=>Se.id===G);if(pe&&pe.id!==U.fromNodeId){if(pe.type===S.SCRIPT_PROMPT_MODIFIER){const Ee=Jr(pe);if(U.fromType===Ee){Y({nodeId:pe.id});return}}if(pe.type===S.REROUTE_DOT){i.some(Fe=>Fe.toNodeId===G)||Y({nodeId:pe.id});return}const Se=Jr(pe);if(U.fromType&&U.fromType===Se){Y({nodeId:pe.id,handleId:void 0});return}}}Y(null)},[U,G,e,i]);const Q=x.useCallback(()=>{te([]),w()},[w]),j=x.useCallback((pe,Se,Ee,Fe)=>{if(E&&R(),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),Z!=="edit"&&Z!=="selection"&&Z!=="reroute")return;const be=ie.includes(pe);let _e=[...ie];Fe||k==="selection"?be?_e=_e.filter(It=>It!==pe):_e.push(pe):be||(_e=[pe],w()),te(_e);const Ue=_e.includes(pe)?_e:[pe],We=new Map,gt=(Se-l.translate.x)/l.scale,Et=(Ee-l.translate.y)/l.scale;e.forEach(It=>{Ue.includes(It.id)&&We.set(It.id,{x:gt-It.position.x,y:Et-It.position.y})}),H({type:"node",id:pe,offsets:We})},[E,R,Z,ie,k,w,l,e]),fe=x.useCallback((pe,Se)=>{if(pe.altKey){pe.preventDefault(),pe.stopPropagation(),I(Se);return}pe.preventDefault(),pe.stopPropagation(),j(Se,pe.clientX,pe.clientY,pe.shiftKey)},[j,I]),Pe=x.useCallback((pe,Se)=>{if(pe.stopPropagation(),pe.touches.length===1){const Ee=pe.touches[0];j(Se,Ee.clientX,Ee.clientY,!1)}},[j]),je=x.useCallback((pe,Se)=>{if(Z!=="edit"&&Z!=="selection"&&Z!=="reroute")return;pe.preventDefault(),pe.stopPropagation();const Ee=n.find(Ue=>Ue.id===Se);if(!Ee)return;const Fe=new Map,be=(pe.clientX-l.translate.x)/l.scale,_e=(pe.clientY-l.translate.y)/l.scale;Fe.set(Se,{x:be-Ee.position.x,y:_e-Ee.position.y}),e.forEach(Ue=>{Ee.nodeIds.includes(Ue.id)&&Fe.set(Ue.id,{x:be-Ue.position.x,y:_e-Ue.position.y})}),H({type:"group",id:Se,offsets:Fe})},[e,n,l,Z]),ke=x.useCallback((pe,Se)=>{if(pe.touches.length!==1)return;pe.stopPropagation();const Ee=pe.touches[0];if(Z!=="edit"&&Z!=="selection"&&Z!=="reroute")return;const Fe=n.find(We=>We.id===Se);if(!Fe)return;const be=new Map,_e=(Ee.clientX-l.translate.x)/l.scale,Ue=(Ee.clientY-l.translate.y)/l.scale;be.set(Se,{x:_e-Fe.position.x,y:Ue-Fe.position.y}),e.forEach(We=>{Fe.nodeIds.includes(We.id)&&be.set(We.id,{x:_e-We.position.x,y:Ue-We.position.y})}),H({type:"group",id:Se,offsets:be})},[e,n,l,Z]),$e=x.useCallback((pe,Se)=>{if(Z!=="edit"&&Z!=="selection"&&Z!=="reroute")return;pe.preventDefault(),pe.stopPropagation(),document.activeElement instanceof HTMLElement&&document.activeElement.blur();const Ee=e.find(Fe=>Fe.id===Se);Ee&&O({nodeId:Se,startPosition:{x:pe.clientX,y:pe.clientY},startSize:{width:Ee.width,height:Ee.height}})},[e,Z]),ze=x.useCallback((pe,Se)=>{if(pe.touches.length!==1)return;pe.stopPropagation();const Ee=pe.touches[0];if(Z!=="edit"&&Z!=="selection"&&Z!=="reroute")return;const Fe=e.find(be=>be.id===Se);Fe&&O({nodeId:Se,startPosition:{x:Ee.clientX,y:Ee.clientY},startSize:{width:Fe.width,height:Fe.height}})},[e,Z]),nt=x.useCallback((pe,Se,Ee)=>{if(Z!=="edit"&&Z!=="reroute")return;const Fe=e.find(Ue=>Ue.id===pe);if(!Fe)return;const be=Ua(Fe),_e={x:(Ee.left+Ee.width/2-l.translate.x)/l.scale,y:(Ee.top+Ee.height/2-l.translate.y)/l.scale};z({fromNodeId:pe,fromPoint:_e,fromHandleId:Se,fromType:be})},[Z,l,e]),at=x.useCallback((pe,Se,Ee)=>{pe.preventDefault(),pe.stopPropagation(),nt(Se,Ee,pe.currentTarget.getBoundingClientRect())},[nt]),xe=x.useCallback((pe,Se,Ee)=>{pe.touches.length===1&&(pe.stopPropagation(),nt(Se,Ee,pe.currentTarget.getBoundingClientRect()))},[nt]),he=x.useCallback(pe=>{v(pe)},[v]),Ge=x.useCallback(pe=>({x:(pe.clientX-l.translate.x)/l.scale,y:(pe.clientY-l.translate.y)/l.scale}),[l.scale,l.translate.x,l.translate.y]),me=x.useCallback(pe=>{if(E&&R(),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),pe.target!==pe.currentTarget)return;if(pe.currentTarget.focus(),Z==="zoom"){pe.preventDefault(),pe.stopPropagation(),D({startX:pe.clientX,startScale:l.scale,pivot:{x:pe.clientX,y:pe.clientY}});return}const Se=Ge(pe);if(Z==="selection"){pe.preventDefault(),pe.stopPropagation();const Ee=Se;ee({start:Ee,end:Ee}),!pe.shiftKey&&k!=="selection"&&(te([]),w())}else(Z==="edit"||Z==="cutter"||Z==="reroute")&&(pe.preventDefault(),pe.stopPropagation(),g(pe),te([]),w())},[E,R,k,Te,Z,Ge,g,w,l.scale]),Oe=x.useCallback((pe,Se)=>{const Ee=Math.min(pe.x,Se.x),Fe=Math.min(pe.y,Se.y),be=Math.abs(pe.x-Se.x),_e=Math.abs(pe.y-Se.y);return{x:Ee,y:Fe,width:be,height:_e}},[]),De=(pe,Se)=>pe.x<Se.x+Se.width&&pe.x+pe.width>Se.x&&pe.y<Se.y+Se.height&&pe.y+pe.height>Se.y,Ce=x.useCallback(pe=>{if(c(pe),L){const Se=pe.clientX-L.startX,Ee=Math.pow(1.005,Se),Fe=L.startScale*Ee,be=L.pivot;C(Fe,be);return}if(h){d(pe);return}if($){const Se=Ge(pe);ee(Ee=>Ee?{...Ee,end:Se}:null);return}if(M){const Se=(pe.clientX-l.translate.x)/l.scale,Ee=(pe.clientY-l.translate.y)/l.scale;if(M.type==="node"){t(Ue=>{const We=Ue.map(gt=>{const Et=M.offsets.get(gt.id);if(Et){let It=Se-Et.x,Mt=Ee-Et.y;return _&&(It=Math.round(It/In)*In,Mt=Math.round(Mt/In)*In),{...gt,position:{x:It,y:Mt}}}return gt});return r(gt=>Eh(gt,We)),We});const Fe=M.id,be=e.find(Ue=>Ue.id===Fe),_e=M.offsets.get(Fe);if(be&&_e){const Ue={x:Se-_e.x,y:Ee-_e.y},We=be.isCollapsed?Bs:be.height,gt={x:Ue.x+be.width/2,y:Ue.y+We/2};if(ae){const Be=n.find(Je=>Je.nodeIds.includes(Fe));if(Be&&(gt.x<Be.position.x||gt.x>Be.position.x+Be.width||gt.y<Be.position.y||gt.y>Be.position.y+Be.height)){V(Fe),ue(null);return}}V(null);let Et=null;const It=be.width,Mt=We,xt=It*.05,Ft=Mt*.05,cn=Ue.x+xt,Bt=Ue.x+It-xt,en=Ue.y+Ft,ve=Ue.y+Mt-Ft;for(const Be of n){if(Be.nodeIds.includes(Fe))continue;const Je=Be.position.x,it=Be.position.x+Be.width,ct=Be.position.y,jt=Be.position.y+Be.height;if(cn<it&&Bt>Je&&en<jt&&ve>ct){Et=Be.id;break}}ue(Et)}}else if(M.type==="group"){const Fe=M.offsets.get(M.id);if(Fe){let be=Se-Fe.x,_e=Ee-Fe.y;_&&(be=Math.round(be/In)*In,_e=Math.round(_e/In)*In),r(Ue=>Ue.map(We=>We.id===M.id?{...We,position:{x:be,y:_e}}:We))}t(be=>be.map(_e=>{const Ue=M.offsets.get(_e.id);if(Ue){let We=Se-Ue.x,gt=Ee-Ue.y;return _&&(We=Math.round(We/In)*In,gt=Math.round(gt/In)*In),{..._e,position:{x:We,y:gt}}}return _e}))}}else if(W){const{nodeId:Se,startPosition:Ee,startSize:Fe}=W,be=e.find(Mt=>Mt.id===Se);if(!be)return;let _e=200,Ue=150;switch(be.type){case S.TEXT_INPUT:_e=460,Ue=280;break;case S.PROMPT_PROCESSOR:_e=460,Ue=280;break;case S.PROMPT_ANALYZER:_e=460,Ue=1e3;break;case S.CHARACTER_ANALYZER:_e=460,Ue=500;break;case S.CHARACTER_GENERATOR:_e=680,Ue=800;break;case S.IMAGE_GENERATOR:_e=400,Ue=520;break;case S.IMAGE_PREVIEW:_e=300,Ue=340;break;case S.CHARACTER_CARD:_e=460,Ue=1e3;break;case S.GEMINI_CHAT:_e=400,Ue=640;break;case S.TRANSLATOR:_e=380,Ue=640;break;case S.SCRIPT_GENERATOR:_e=680,Ue=800;break;case S.SCRIPT_ANALYZER:_e=680,Ue=800;break;case S.SCRIPT_PROMPT_MODIFIER:_e=680,Ue=800;break;case S.ERROR_ANALYZER:_e=380,Ue=280;break;case S.DATA_READER:_e=380,Ue=280;break;case S.NOTE:_e=440,Ue=640;break;case S.SPEECH_SYNTHESIZER:_e=680,Ue=800;break;case S.NARRATOR_TEXT_GENERATOR:_e=680,Ue=800;break;case S.IDEA_GENERATOR:_e=680,Ue=800;break;case S.REROUTE_DOT:_e=60,Ue=40;break;case S.AUDIO_TRANSCRIBER:_e=400,Ue=480;break;case S.YOUTUBE_TITLE_GENERATOR:_e=680,Ue=800;break;case S.YOUTUBE_ANALYTICS:_e=680,Ue=800;break;default:_e=200,Ue=150}const We=(pe.clientX-Ee.x)/l.scale,gt=(pe.clientY-Ee.y)/l.scale;let Et=Math.max(_e,Fe.width+We),It=Math.max(Ue,Fe.height+gt);_&&(Et=Math.round(Et/In)*In,It=Math.round(It/In)*In),t(Mt=>{const xt=Mt.map(Ft=>Ft.id===Se?{...Ft,width:Et,height:It}:Ft);return r(Ft=>Eh(Ft,xt)),xt})}},[M,W,l,d,c,t,r,e,n,$,Ge,_,C,h,L,ae]),Qe=x.useCallback(pe=>{if(L&&D(null),$){const Se=Oe($.start,$.end);if(Se.width>5||Se.height>5){const Ee=e.filter(Fe=>{const be=Fe.isCollapsed?Bs:Fe.height,_e={x:Fe.position.x,y:Fe.position.y,width:Fe.width,height:be};return De(_e,Se)}).map(Fe=>Fe.id);"shiftKey"in pe&&pe.shiftKey?te(Fe=>Array.from(new Set([...Fe,...Ee]))):te(Ee)}ee(null)}if(U)if(F){let Se={...F};const Ee=e.find(be=>be.id===F.nodeId);if(Ee&&Ee.type===S.SCRIPT_GENERATOR){const be=Ee.position.y*l.scale+l.translate.y,_e=95*l.scale,Ue=330*l.scale,We=f.y-be,gt=(_e+Ue)/2;We<gt?Se.handleId="prompt":Se.handleId="characters"}if(Ee&&Ee.type===S.SCRIPT_ANALYZER&&(Se.handleId=void 0),Ee&&Ee.type===S.SCRIPT_PROMPT_MODIFIER){const be=Ee.position.y*l.scale+l.translate.y,_e=Ee.height*l.scale;f.y-be<_e/2?Se.handleId="all-script-analyzer-data":Se.handleId="style"}let Fe=!0;if(Ee&&Ee.type===S.REROUTE_DOT&&(i.some(be=>be.toNodeId===Ee.id)?Fe=!1:t(be=>be.map(_e=>_e.id===Ee.id?{..._e,value:JSON.stringify({type:U.fromType})}:_e))),Fe){const be=e.find(_e=>_e.id===U.fromNodeId);if(be){const _e={x:U.fromPoint.x-be.position.x,y:U.fromPoint.y-be.position.y};a({fromNodeId:U.fromNodeId,toNodeId:Se.nodeId,fromHandleId:U.fromHandleId,toHandleId:Se.handleId,fromPointOffset:_e},be)}}}else{let Se,Ee;"clientX"in pe?(Se=pe.clientX,Ee=pe.clientY):"changedTouches"in pe&&pe.changedTouches.length>0&&(Se=pe.changedTouches[0].clientX,Ee=pe.changedTouches[0].clientY),Se!==void 0&&Ee!==void 0&&A(U,{x:Se,y:Ee})}K?(I(K),V(null)):(M||W)&&r(Se=>{let Ee=Se;const Fe=new Set;if(M&&ye){const be=Array.from(M.offsets.keys()),_e=new Set(be);Se.forEach(We=>{We.nodeIds.some(gt=>_e.has(gt))&&Fe.add(We.id)}),Fe.add(ye),Ee=Se.map(We=>({...We,nodeIds:We.nodeIds.filter(gt=>!_e.has(gt))}));const Ue=Ee.find(We=>We.id===ye);Ue&&(Ue.nodeIds=[...new Set([...Ue.nodeIds,...be])])}else{if(M){const be=Array.from(M.offsets.keys());Se.forEach(_e=>{_e.nodeIds.some(Ue=>be.includes(Ue))&&Fe.add(_e.id)})}if(W){const be=W.nodeId,_e=Se.find(Ue=>Ue.nodeIds.includes(be));_e&&Fe.add(_e.id)}}if(Fe.size>0){let be=[...Ee];return Fe.forEach(_e=>{const Ue=be.findIndex(Et=>Et.id===_e);if(Ue===-1)return;const We=be[Ue],gt=oe.current.filter(Et=>We.nodeIds.includes(Et.id));if(gt.length>0){let Mt=1/0,xt=1/0,Ft=-1/0,cn=-1/0;gt.forEach(en=>{Mt=Math.min(Mt,en.position.x),xt=Math.min(xt,en.position.y),Ft=Math.max(Ft,en.position.x+en.width);const ve=en.isCollapsed?Bs:en.height;cn=Math.max(cn,en.position.y+ve)});const Bt={...We,position:{x:Mt-30,y:xt-70},width:Ft-Mt+30*2,height:cn-xt+70+30};be[Ue]=Bt}else be=be.filter(Et=>Et.id!==_e)}),be}return Ee}),H(null),O(null),z(null),m(),ue(null)},[L,$,Oe,e,U,F,l,f.y,a,t,K,I,M,W,r,n,ye,m,te,i,A]);return x.useEffect(()=>{const pe=be=>Ce(be),Se=be=>Qe(be),Ee=be=>Ce(be.touches[0]),Fe=be=>Qe(be.changedTouches[0]);return(M||W||U||h||L||$)&&(window.addEventListener("mousemove",pe),window.addEventListener("mouseup",Se),window.addEventListener("touchmove",Ee),window.addEventListener("touchend",Fe)),()=>{window.removeEventListener("mousemove",pe),window.removeEventListener("mouseup",Se),window.removeEventListener("touchmove",Ee),window.removeEventListener("touchend",Fe)}},[M,W,U,h,Ce,Qe,L,$]),{activeTool:k,effectiveTool:Z,setActiveTool:P,draggingInfo:M,resizingInfo:W,connectingInfo:U,dollyZoomingInfo:L,hoveredNodeId:G,setHoveredNodeId:q,selectedNodeIds:ie,setSelectedNodeIds:te,deselectAllNodes:Q,handleNodeMouseDown:fe,handleGroupMouseDown:je,handleNodeResizeMouseDown:$e,handleStartConnection:at,handleNodeClick:he,hoveredGroupIdForDrop:ye,handleCanvasMouseDown:me,selectionRect:$,connectionTarget:F,isAltDown:ae,extractionTarget:K,handleNodeTouchStart:Pe,handleGroupTouchStart:ke,handleNodeResizeTouchStart:ze,handleStartConnectionTouchStart:xe}},Rw=()=>{const[e,t]=x.useState(!1),[n,r]=x.useState(!1),[a,i]=x.useState({x:0,y:0}),[s,l]=x.useState(!1),[c,d]=x.useState(!1),[h,g]=x.useState({x:0,y:0}),[m,_]=x.useState(!1),[y,v]=x.useState({x:0,y:0}),[C,w]=x.useState(!1),[b,f]=x.useState(!1),[T,I]=x.useState(null),E=x.useCallback(z=>{d(!0),g(z)},[]),R=x.useCallback(()=>{d(!1)},[]),N=x.useCallback(z=>{_(!0),v(z)},[]),A=x.useCallback(()=>{_(!1)},[]),k=x.useCallback(()=>{w(z=>!z)},[]),P=x.useCallback(()=>{f(z=>!z)},[]),M=x.useCallback(z=>{t(!0),i(z)},[]),H=x.useCallback(z=>{r(!0),i(z)},[]),W=x.useCallback(()=>{t(!1),b||r(!1),R(),C||A()},[R,A,C,b]),O=x.useCallback(()=>l(z=>!z),[]),U=x.useCallback(()=>l(!1),[]);return{isQuickSearchOpen:e,isQuickAddOpen:n,quickAddPosition:a,openQuickSearchMenu:M,openQuickAddMenu:H,handleCloseAddNodeMenus:W,isCatalogOpen:s,handleToggleCatalog:O,handleCloseCatalog:U,isRadialMenuOpen:c,radialMenuPosition:h,openRadialMenu:E,closeRadialMenu:R,isContextMenuOpen:m,contextMenuPosition:y,openContextMenu:N,closeContextMenu:A,isContextMenuPinned:C,toggleContextMenuPin:k,isQuickAddPinned:b,toggleQuickAddPin:P,connectionMenu:T,setConnectionMenu:I}},Nh="group-catalog-items",kh=[{id:"default-base-script-chain-1",type:Ze.GROUP,name:"Base Script Chain",parentId:null,category:"GROUP",nodes:[{id:"node-2-1761968471575",type:S.SCRIPT_GENERATOR,position:{x:0,y:0},value:'{"prompt":"","targetLanguage":"en","characterType":"simple","useExistingCharacters":false,"narratorEnabled":true,"narratorMode":"normal","summary":"","detailedCharacters":[],"scenes":[],"uiState":{"isSummaryCollapsed":false,"collapsedCharacters":[],"collapsedScenes":[]}}',title:" ",width:700,height:800},{id:"node-3-1761968527117",type:S.SCRIPT_ANALYZER,position:{x:780,y:0},value:'{"characters":[],"scenes":[],"targetLanguage":"en"}',title:" ",width:680,height:800},{id:"node-4-1761968532886",type:S.SCRIPT_PROMPT_MODIFIER,position:{x:1540,y:0},value:'{"finalPrompts":[],"targetLanguage":"en","startFrameNumber":null,"styleOverride":""}',title:" ",width:680,height:800}],connections:[{fromNodeId:"node-2-1761968471575",toNodeId:"node-3-1761968527117",fromHandleId:"all-script-parts",id:"conn-1761968530829-ctj2uh91t"},{fromNodeId:"node-3-1761968527117",toNodeId:"node-4-1761968532886",fromHandleId:"all-script-analyzer-data",toHandleId:"all-script-analyzer-data",id:"conn-1761968536068-rm7n9lqr1"}]}],Ah=e=>{switch(e){case Ze.GROUP:return"groups";case Ze.CHARACTERS:return"characters";case Ze.SCRIPT:return"scripts";case Ze.ANALYSIS:return"analysis";case Ze.FINAL_PROMPTS:return"final_prompts";case Ze.YOUTUBE:return"youtube";case Ze.MUSIC:return"music";default:return"groups"}},Mw=e=>{const[t,n]=x.useState(()=>{try{const N=localStorage.getItem(Nh);return N?JSON.parse(N):kh}catch(N){return console.error("Failed to load group catalog from storage",N),kh}}),[r,a]=x.useState([null]),[i,s]=x.useState(Ze.GROUP),l=x.useRef(null),c=r[r.length-1],d=N=>{try{localStorage.setItem(Nh,JSON.stringify(N))}catch(A){console.error("Failed to save group catalog to storage",A)}},h=x.useMemo(()=>{let N=t.filter(A=>A.parentId===c);return i&&(N=N.filter(A=>A.type===Ze.FOLDER?!A.category||A.category===i:A.type===i)),N.sort((A,k)=>A.type===k.type?A.name.localeCompare(k.name):A.type===Ze.FOLDER?-1:1)},[t,c,i]),g=x.useMemo(()=>{const N=[];let A=c;for(;A;){const k=t.find(P=>P.id===A&&P.type===Ze.FOLDER);if(k)N.push({id:k.id,name:k.name}),A=k.parentId;else break}return[{id:null,name:e("catalog.title")},...N.reverse()]},[c,t,e]),m=x.useCallback(N=>{const A=r.findIndex(k=>k===N);A>-1?a(k=>k.slice(0,A+1)):a(k=>[...k,N])},[r]),_=x.useCallback(()=>{a(N=>N.length>1?N.slice(0,-1):N)},[]),y=x.useCallback(N=>{if(N!==Ze.FOLDER)return;const A={id:`cat-item-${Date.now()}`,type:N,name:e("library.actions.newFolder"),parentId:c,category:i||void 0};n(k=>{const P=[...k,A];return d(P),P})},[c,e,i]),v=x.useCallback((N,A,k)=>{const P=A.filter(D=>N.nodeIds.includes(D.id));if(P.length===0)return;const M=new Set(P.map(D=>D.id)),H=k.filter(D=>M.has(D.fromNodeId)&&M.has(D.toNodeId)),W=JSON.parse(JSON.stringify(P)),O=JSON.parse(JSON.stringify(H)),U=Math.min(...W.map(D=>D.position.x)),z=Math.min(...W.map(D=>D.position.y));W.forEach(D=>{D.position.x-=U,D.position.y-=z});const L={id:`catalog-item-${Date.now()}`,type:Ze.GROUP,name:N.title,parentId:c,category:Ze.GROUP,nodes:W,connections:O};n(D=>{const G=[...D,L];return d(G),G})},[c]),C=x.useCallback((N,A,k)=>{const P={id:`catalog-item-${Date.now()}`,type:N,name:A,parentId:c,category:N,data:k};n(M=>{const H=[...M,P];return d(H),H})},[c]),w=x.useCallback((N,A)=>{!A||!A.trim()||n(k=>{const P=k.map(M=>M.id===N?{...M,name:A.trim()}:M);return d(P),P})},[]),b=x.useCallback(N=>{n(A=>{const k=new Set([N]),P=A.find(H=>H.id===N);if((P==null?void 0:P.type)===Ze.FOLDER){const H=[N];for(;H.length>0;){const W=H.shift();for(const O of A)O.parentId===W&&(k.add(O.id),O.type===Ze.FOLDER&&H.push(O.id))}}const M=A.filter(H=>!k.has(H.id));return d(M),M})},[]),f=x.useCallback(N=>{const A=t.find(q=>q.id===N);if(!A)return;let k;if(A.type===Ze.FOLDER){const q=ie=>{const te=t.find(ue=>ue.id===ie);if(!te)return null;const ye=t.filter(ue=>ue.parentId===ie);return{name:te.name,type:"folder",category:te.category,children:ye.map(ue=>ue.type===Ze.FOLDER?q(ue.id):{...ue,id:void 0,parentId:void 0,type:ue.type===Ze.GROUP?"scriptModifierGroup":ue.type})}};k=q(N)}else k={...A,id:void 0,parentId:void 0,type:A.type===Ze.GROUP?"scriptModifierGroup":A.type};const P=Ah(A.category||A.type),H=JSON.stringify({appName:"Script_modifier",catalogContext:P,root:k},null,2),W=new Blob([H],{type:"application/json"}),O=URL.createObjectURL(W),U=document.createElement("a");U.href=O;const L=new Date().toISOString().split("T")[0],D=A.name.replace(/[^a-z0-9-\s-_]/gi,"").trim().replace(/\s+/g,"_"),G=`Catalog_${P}_${D}_${L}.json`;U.download=G,U.click(),URL.revokeObjectURL(O),U.remove()},[t]),T=x.useCallback(N=>{var P;const A=(P=N.target.files)==null?void 0:P[0];if(!A)return;const k=new FileReader;k.onload=M=>{var H;try{const W=(H=M.target)==null?void 0:H.result,O=JSON.parse(W);if(O.appName!=="Script_modifier")throw new Error("File does not belong to Script Modifier application.");const U=Ah(i);if(O.catalogContext&&O.catalogContext!==U)throw new Error(`File belongs to '${O.catalogContext}' tab, but you are currently in '${U}'.`);const z=O.root;if(!z)throw new Error("Invalid file structure: 'root' object missing.");const L=[],D=(G,q)=>{const ie=`cat-item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(!G.name||!G.type)return;let te;const ye=String(G.type).toLowerCase();if(ye==="folder")te=Ze.FOLDER;else if(G.type==="scriptModifierGroup"||ye==="group")te=Ze.GROUP;else{const ee=Object.values(Ze).find(Te=>Te===G.type);if(ee)te=ee;else{const Te=G.type.toUpperCase(),le=Object.values(Ze).find(J=>J===Te);if(le)te=le;else return}}const ue=G.category||i||void 0,$={id:ie,type:te,name:G.name,parentId:q,category:ue,nodes:G.nodes,connections:G.connections,data:G.data};L.push($),te===Ze.FOLDER&&Array.isArray(G.children)&&G.children.forEach(ee=>D(ee,ie))};D(z,c),n(G=>{const q=[...G,...L];return d(q),q})}catch(W){alert(`${e("alert.loadCatalogFailed")}: ${W.message}`)}finally{N.target&&(N.target.value="")}},k.readAsText(A)},[e,c,i]),I=x.useCallback(()=>{var N;(N=l.current)==null||N.click()},[]),E=x.useCallback((N,A)=>{n(k=>{const P=k.find(H=>H.id===N);if(!P||P.parentId===A)return k;if(P.type===Ze.FOLDER){let H=A;for(;H;){if(H===N)return k;const W=k.find(O=>O.id===H);H=W?W.parentId:null}}const M=k.map(H=>H.id===N?{...H,parentId:A}:H);return d(M),M})},[]),R=x.useCallback(N=>{n(N),d(N)},[]);return{catalogItems:t,currentCatalogItems:h,catalogPath:g,navigateCatalogBack:_,navigateCatalogToFolder:m,createCatalogItem:y,saveGroupToCatalog:v,saveGenericItemToCatalog:C,renameCatalogItem:w,deleteCatalogItem:b,saveCatalogItemToDisk:f,catalogFileInputRef:l,handleCatalogFileChange:T,triggerLoadFromFile:I,moveCatalogItem:E,activeCategory:i,setActiveCategory:s,importCatalog:R}},jw=e=>{const[t,n]=x.useState(null),[r,a]=x.useState(!1),[i,s]=x.useState(!1);x.useEffect(()=>{let d;return(async()=>{try{d=await navigator.permissions.query({name:e}),n(d.state),d.state==="prompt"&&!i&&a(!0),d.onchange=()=>{n(d.state),d.state!=="prompt"&&a(!1)}}catch(g){console.warn(`Permission API for '${e}' not supported.`,g),n("granted")}})(),()=>{d&&(d.onchange=null)}},[e,i]);const l=x.useCallback(async()=>{try{await navigator.clipboard.readText()}catch(d){d instanceof DOMException&&d.name==="NotAllowedError"&&n("denied"),console.error("Clipboard read failed:",d)}finally{a(!1)}},[]),c=x.useCallback(()=>{a(!1),s(!0)},[]);return{showDialog:r,requestPermission:l,declinePermission:c}},Ih="prompt-library-items",Ph="root",Rh=[{id:"folder-1",type:$t.FOLDER,name:"Basic Prompts",parentId:null},{id:"prompt-1",type:$t.PROMPT,name:"Fill background",parentId:"folder-1",content:"Fill the white background with the surroundings"},{id:"prompt-2",type:$t.PROMPT,name:"Remove all watermarks",parentId:"folder-1",content:"Remove all watermarks, logos, text overlays, and advertisement banners from the image. Restore the original background naturally, blending colors and textures smoothly. Keep all other visual elements unchanged and realistic."},{id:"prompt-3",type:$t.PROMPT,name:"Character concept",parentId:"folder-1",content:"Create a character concept based on the provided image. The character is standing full-length against a gray background."}],Lw=e=>{const[t,n]=x.useState(()=>{try{const I=localStorage.getItem(Ih);return I?JSON.parse(I):Rh}catch(I){return console.error("Failed to load prompt library from storage",I),Rh}}),[r,a]=x.useState([null]),i=x.useRef(null),s=r[r.length-1],l=I=>{try{localStorage.setItem(Ih,JSON.stringify(I))}catch(E){console.error("Failed to save prompt library to storage",E)}},c=x.useMemo(()=>t.filter(I=>I.parentId===s).sort((I,E)=>I.type===E.type?I.name.localeCompare(E.name):I.type===$t.FOLDER?-1:1),[t,s]),d=x.useMemo(()=>{const I=[];let E=s;for(;E;){const R=t.find(N=>N.id===E);if(R)I.push(R),E=R.parentId;else break}return[{id:Ph,type:$t.FOLDER,name:e("catalog.tabs.library"),parentId:null},...I.reverse()]},[s,t,e]),h=x.useCallback(I=>{const E=I===Ph?null:I,R=r.findIndex(N=>N===E);R>-1?a(N=>N.slice(0,R+1)):a(N=>[...N,E])},[r]),g=x.useCallback(()=>{a(I=>I.length>1?I.slice(0,-1):I)},[]),m=x.useCallback(I=>{const E=I===$t.FOLDER?e("library.actions.newFolder"):e("library.actions.newPrompt"),R={id:`lib-item-${Date.now()}`,type:I,name:E,parentId:s,content:I===$t.PROMPT?"":void 0};n(N=>{const A=[...N,R];return l(A),A})},[s,e]),_=x.useCallback((I,E)=>{n(R=>{const N=R.map(A=>A.id===I?{...A,...E}:A);return l(N),N})},[]),y=x.useCallback(I=>{n(E=>{const R=new Set([I]),N=[I];for(;N.length>0;){const k=N.shift();for(const P of E)P.parentId===k&&(R.add(P.id),P.type===$t.FOLDER&&N.push(P.id))}const A=E.filter(k=>!R.has(k.id));return l(A),A})},[]),v=x.useCallback(I=>{let E,R,N;if(I.type===$t.PROMPT)E=I.content||"",R=`${I.name.replace(/ /g,"_")}.txt`,N="text/plain";else{const M=H=>{const W=t.find(U=>U.id===H);if(!W)return null;const O=t.filter(U=>U.parentId===H);return{name:W.name,type:"folder",children:O.map(U=>U.type===$t.FOLDER?M(U.id):{name:U.name,type:"prompt",content:U.content||""})}};E=JSON.stringify(M(I.id),null,2),R=`${I.name.replace(/ /g,"_")}_library_export.json`,N="application/json"}const A=new Blob([E],{type:N}),k=URL.createObjectURL(A),P=document.createElement("a");P.href=k,P.download=R,P.click(),URL.revokeObjectURL(k),P.remove()},[t]),C=x.useCallback(I=>{try{if(!I)throw new Error("File content is empty.");const E=JSON.parse(I);if(E.type!=="folder"||!E.name||!Array.isArray(E.children))throw new Error(e("alert.invalidCatalogFile"));const R=[],N=(A,k)=>{const P=`lib-item-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(!A.name||!A.type)return;const M=A.type==="folder"?$t.FOLDER:$t.PROMPT,H={id:P,type:M,name:A.name,parentId:k,content:M===$t.PROMPT?A.content||"":void 0};R.push(H),M===$t.FOLDER&&Array.isArray(A.children)&&A.children.forEach(W=>N(W,P))};N(E,s),n(A=>{const k=[...A,...R];return l(k),k})}catch(E){alert(`${e("alert.loadCatalogFailed")}: ${E.message}`)}},[s,n,e]),w=x.useCallback(I=>{var N;const E=(N=I.target.files)==null?void 0:N[0];if(!E)return;const R=new FileReader;R.onload=A=>{var P;const k=(P=A.target)==null?void 0:P.result;C(k),I.target&&(I.target.value="")},R.onerror=()=>{alert("Error reading the selected file.")},R.readAsText(E)},[C]),b=x.useCallback(()=>{var I;(I=i.current)==null||I.click()},[]),f=x.useCallback((I,E)=>{n(R=>{const N=R.find(k=>k.id===I);if(!N||N.parentId===E)return R;if(N.type===$t.FOLDER){let k=E;for(;k;){if(k===I)return R;const P=R.find(M=>M.id===k);k=P?P.parentId:null}}const A=R.map(k=>k.id===I?{...k,parentId:E}:k);return l(A),A})},[]),T=x.useCallback(I=>{n(I),l(I)},[]);return{libraryItems:t,currentLibraryItems:c,currentPath:d,navigateBack:g,navigateToFolder:h,createLibraryItem:m,updateLibraryItem:_,deleteLibraryItem:y,saveLibraryItemToDisk:v,libraryFileInputRef:i,handleLibraryFileChange:w,triggerLoadLibraryFromFile:b,moveLibraryItem:f,importLibrary:T}},Dw=({t:e,setGroups:t,renameCatalogItem:n,updateLibraryItem:r,libraryItems:a,deleteLibraryItem:i,setNodes:s,setConnections:l,nodeIdCounter:c,geminiContext:d,currentCatalogItems:h,deleteCatalogItem:g,saveDataToCatalog:m})=>{const[_,y]=x.useState(null),[v,C]=x.useState(null),[w,b]=x.useState(null),[f,T]=x.useState(!1),[I,E]=x.useState([]),R=x.useCallback((D,G="info",q)=>{const ie=Date.now()+Math.random(),te=q?I:I.slice(-4);E([...te,{id:ie,message:D,type:G,position:q}])},[I]),N=x.useCallback(D=>{E(G=>G.filter(q=>q.id!==D))},[]),A=x.useCallback(()=>{d.error&&navigator.clipboard.writeText(d.error).then(()=>{T(!0)})},[d.error]),k=x.useCallback((D,G)=>{y({type:"group",id:D,currentTitle:G})},[]),P=x.useCallback((D,G)=>{const q=h.find(ie=>ie.id===D);q&&y({type:"catalog",id:D,currentTitle:q.name})},[h]),M=x.useCallback((D,G)=>{y({type:"library",id:D,currentTitle:G})},[]),H=x.useCallback((D,G)=>{y({type:"node",id:D,currentTitle:G})},[]),W=D=>{if(!_||!D||!D.trim()){y(null);return}if(_.type==="catalog"&&_.id.startsWith("save-node:")){const G=_.id.split(":");G.length===3&&m&&m(G[1],G[2],D.trim())}else _.type==="group"?t(G=>G.map(q=>q.id===_.id?{...q,title:D.trim()}:q)):_.type==="catalog"?n(_.id,D.trim()):_.type==="library"?r(_.id,{name:D.trim()}):_.type==="node"&&s(G=>G.map(q=>q.id===_.id?{...q,title:D.trim()}:q));y(null)},O=(D,G)=>{v&&r(v.id,{name:D.trim(),content:G}),C(null)},U=x.useCallback(D=>{const G=h.find(q=>q.id===D);G&&b({title:e("dialog.confirmDelete.title"),message:e("dialog.confirmDelete.message",{itemName:G.name}),onConfirm:()=>g(D)})},[h,e,g]),z=x.useCallback(D=>{const G=a.find(ie=>ie.id===D);if(!G)return;const q=G.type===$t.FOLDER?e("dialog.confirmDelete.folderMessage",{itemName:G.name}):e("dialog.confirmDelete.message",{itemName:G.name});b({title:e("dialog.confirmDelete.title"),message:q,onConfirm:()=>i(D)})},[a,i,e]),L=x.useCallback(()=>{b({title:e("dialog.confirmClear.title"),message:e("dialog.confirmClear.message"),onConfirm:()=>{s([]),l([]),t([]),c.current=0}})},[e,s,l,t,c]);return{renameInfo:_,setRenameInfo:y,promptEditInfo:v,setPromptEditInfo:C,confirmInfo:w,setConfirmInfo:b,isErrorCopied:f,handleCopyError:A,toasts:I,addToast:R,removeToast:N,handleRenameGroup:k,handleRenameCatalogItem:P,handleRenameLibraryItem:M,handleRenameNode:H,confirmRename:W,confirmPromptEdit:O,handleDeleteCatalogItem:U,handleDeleteLibraryItem:z,handleClearCanvas:L}},Ow=({isQuickSearchOpen:e,handleToggleCatalog:t,openQuickSearchMenu:n,openQuickAddMenu:r,clientPointerPosition:a,clientPointerPositionRef:i,onAddNode:s,handleCloseAddNodeMenus:l,loadStateFromFileContent:c,activeTool:d,setActiveTool:h,isSnapToGrid:g,setIsSnapToGrid:m,lineStyle:_,setLineStyle:y,selectedNodeIds:v,copyNodeValue:C,geminiContext:w,addCharacterCardFromFile:b,addImagePreviewNodeFromFile:f,viewTransform:T,nodes:I,handlePasteFromClipboard:E,handleAddGroupFromTemplate:R,catalogItems:N,handleToggleNodeCollapse:A,handleNodeDoubleClick:k,deleteNodeAndConnections:P,setSelectedNodeIds:M,handleGroupSelection:H,handleDuplicateNode:W,handleDuplicateNodeEmpty:O,t:U,contextMenuSlots:z,handleValueChange:L,handleSaveProject:D,handleLoadProject:G,addToast:q})=>{const[ie,te]=x.useState(!1),ye=x.useCallback(le=>{const J=i.current;if(!J)return;const ge={x:(J.x-T.translate.x)/T.scale,y:(J.y-T.translate.y)/T.scale};s(le,ge,void 0),l()},[i,s,l,T]),ue=le=>{le.target===le.currentTarget&&r({x:le.clientX,y:le.clientY})},$=x.useCallback(le=>{le.preventDefault(),le.stopPropagation();const J=Array.from(le.dataTransfer.types);(J.includes("Files")||J.includes("application/prompt-modifier-drag-item"))&&te(!0)},[]),ee=x.useCallback(le=>{le.preventDefault(),le.stopPropagation(),te(!1)},[]),Te=x.useCallback(async le=>{var ce;le.preventDefault(),le.stopPropagation(),te(!1);const J={x:(le.clientX-T.translate.x)/T.scale,y:(le.clientY-T.translate.y)/T.scale},ge=le.dataTransfer.getData("application/prompt-modifier-drag-item");if(ge)try{const{type:B,itemId:X}=JSON.parse(ge),F=N.find(de=>de.id===X);if(!F)return;if(B==="catalog-group"){F.nodes&&F.connections&&R({name:F.name,nodes:F.nodes,connections:F.connections},J);return}const Y=F.data;if(!Y)return;let K=null,V=Y,oe;if(Y.title&&(oe=Y.title),Y.type==="script-generator-data")K=S.SCRIPT_GENERATOR,V={scenes:Y.scenes};else if(Y.type==="script-analyzer-data")K=S.SCRIPT_ANALYZER,V={scenes:Y.scenes};else if(Y.type==="script-prompt-modifier-data")K=S.SCRIPT_PROMPT_MODIFIER,V={finalPrompts:Y.finalPrompts,sceneContexts:Y.sceneContexts||{}};else if(Y.type==="youtube-title-data")K=S.YOUTUBE_TITLE_GENERATOR,V=Y;else if(Y.type==="youtube-analytics-data")K=S.YOUTUBE_ANALYTICS,V=Y;else if(Y.type==="music-idea-data")K=S.MUSIC_IDEA_GENERATOR,V=Y;else if(Y.type==="character-generator-data")K=S.CHARACTER_GENERATOR,V={characters:Y.characters};else if(Y.type==="character-card")K=S.CHARACTER_CARD,V={...Y,id:Y.id||`char-card-${Date.now()}`,index:Y.index||Y.alias||"Character-1"},delete V.alias,oe||(oe=Y.nodeTitle||Y.name);else if(Y.messages&&Array.isArray(Y.messages))K=S.GEMINI_CHAT,V=Y;else if(Y.type==="gemini-chat-data")K=S.GEMINI_CHAT,V=Y;else switch(B){case"catalog-data-characters":K=S.CHARACTER_GENERATOR,Array.isArray(Y)?V={characters:Y}:Y.name&&(K=S.CHARACTER_CARD,V={...Y,id:Y.id||`char-card-${Date.now()}`,index:Y.index||Y.alias||"Character-1"},delete V.alias);break;case"catalog-data-script":K=S.SCRIPT_GENERATOR,V={scenes:Y};break;case"catalog-data-analysis":K=S.SCRIPT_ANALYZER,V={scenes:Y};break;case"catalog-data-final_prompts":K=S.SCRIPT_PROMPT_MODIFIER,V={finalPrompts:Y};break;case"catalog-data-youtube":K=S.YOUTUBE_TITLE_GENERATOR,V=Y;break;case"catalog-data-music":K=S.MUSIC_IDEA_GENERATOR,V=Y;break}K&&s(K,J,JSON.stringify(V),oe)}catch(B){console.error("Failed to handle catalog drop:",B)}const ae=(ce=le.dataTransfer.files)==null?void 0:ce[0];if(ae){if(ae.type.startsWith("image/")&&!ae.name.endsWith(".json")){const B={...J,x:J.x-150,y:J.y-170};f(ae,B);return}if(ae.type.startsWith("audio/")||ae.type.startsWith("video/")){const B=new FileReader;B.onload=X=>{var K;const F=((K=X.target)==null?void 0:K.result).split(",")[1],Y=JSON.stringify({audioBase64:F,mimeType:ae.type,fileName:ae.name,transcription:"",segments:[]});s(S.AUDIO_TRANSCRIBER,J,Y)},B.onerror=()=>{q(U("error.fileReadError"),"info")},B.readAsDataURL(ae);return}if(ae.type==="application/json"||ae.name.endsWith(".json")||ae.name.endsWith(".SMC")||ae.name.endsWith(".SMP")||ae.name.endsWith(".CHAR")){const B=await ae.text();let X;try{X=JSON.parse(B)}catch{w.setError("Error loading file: Invalid JSON format.");return}if(X&&(X.type==="prompt-modifier-canvas"||X.type==="prompt-modifier-project")){w.setError(U("error.promptModifierFile"));return}if(X&&X.type==="script-modifier-project"){G(X);return}if(X&&(X.type==="group"||X.type==="scriptModifierGroup")){R(X,J);return}if(X&&(X.type==="character-card"||Array.isArray(X)&&X.length>0&&X[0].type==="character-card")){const F={...J,x:J.x-220,y:J.y-400};b(X,F);return}if(X){let F=null,Y=X;const K=X.title;if(X.type)switch(X.type){case"script-generator-data":F=S.SCRIPT_GENERATOR,Y={scenes:X.scenes};break;case"script-analyzer-data":F=S.SCRIPT_ANALYZER,Y={scenes:X.scenes};break;case"script-prompt-modifier-data":F=S.SCRIPT_PROMPT_MODIFIER,Y={finalPrompts:X.finalPrompts,sceneContexts:X.sceneContexts||{}};break;case"youtube-title-data":F=S.YOUTUBE_TITLE_GENERATOR;break;case"youtube-analytics-data":F=S.YOUTUBE_ANALYTICS;break;case"music-idea-data":F=S.MUSIC_IDEA_GENERATOR;break;case"character-generator-data":F=S.CHARACTER_GENERATOR,Y={characters:X.characters};break;case"gemini-chat-data":F=S.GEMINI_CHAT;break}if(F||X.messages&&Array.isArray(X.messages)&&(F=S.GEMINI_CHAT),F){s(F,J,JSON.stringify(Y),K);return}}try{c(B)}catch{}}}},[c,w,b,T,f,R,N,s,G,U]);return x.useEffect(()=>{const le=async J=>{var B;const ge=J.target;if(ge.tagName==="INPUT"||ge.tagName==="TEXTAREA")return;J.preventDefault();const ce=(B=J.clipboardData)==null?void 0:B.getData("text");if(ce)try{const X=JSON.parse(ce),F=i.current,Y=F?{x:(F.x-T.translate.x)/T.scale,y:(F.y-T.translate.y)/T.scale}:{x:0,y:0};if(Array.isArray(X)&&X.length>0&&X[0].type==="character-card"){b(X,Y),q(U("toast.pasted"),"success",i.current);return}if(X.messages&&Array.isArray(X.messages)){s(S.GEMINI_CHAT,Y,ce),q(U("toast.pasted"),"success",i.current);return}}catch{}await E()};return window.addEventListener("paste",le),()=>window.removeEventListener("paste",le)},[E,b,T,i,U,q,s]),x.useEffect(()=>{const le=J=>{var X;const ge=J.target,ae=ge.tagName==="INPUT"||ge.tagName==="TEXTAREA";if(J.code==="Escape"&&ae&&((X=document.activeElement)==null||X.blur()),J.ctrlKey||J.metaKey){if(J.code==="KeyC"&&!ae&&v.length>0){J.preventDefault();const F=v[v.length-1];C(F),q(U("toast.copied"),"success",i.current);return}if(J.code==="KeyD"&&!ae&&v.length>0){J.preventDefault();const F=[];v.forEach(Y=>{const K=W(Y);K&&F.push(K)}),M(F);return}if(J.code==="KeyA"){if(ae)return;J.preventDefault();const F=I.map(Y=>Y.id);M(F);return}if(J.shiftKey&&J.code==="KeyC"){J.preventDefault(),ye(S.CHARACTER_CARD);return}if(J.shiftKey&&J.code==="KeyS"&&!ae){J.preventDefault(),D();return}}if(J.code==="KeyF"&&!J.shiftKey&&!J.ctrlKey&&!J.metaKey&&!J.altKey&&!ae){J.preventDefault(),n(i.current);return}if(J.code==="Space"&&!J.ctrlKey&&!J.metaKey&&!J.altKey&&!J.isComposing&&!ae){J.preventDefault(),r(i.current);return}if(ae||J.repeat)return;if(J.key>="1"&&J.key<="8"&&!J.shiftKey&&!J.ctrlKey&&!J.altKey&&!J.metaKey){const F=parseInt(J.key)-1;if(z&&z[F]){J.preventDefault(),ye(z[F]);return}}if(J.code==="KeyD"&&!J.ctrlKey&&!J.metaKey&&!J.altKey&&!J.shiftKey){if(v.length>0){J.preventDefault();const F=[];v.forEach(Y=>{const K=O(Y);K&&F.push(K)}),M(F)}return}if(J.altKey&&J.code==="KeyA"){J.preventDefault(),M([]);return}if(J.shiftKey&&J.code==="KeyE"){J.preventDefault(),y(F=>F==="orthogonal"?"spaghetti":"orthogonal");return}if(J.shiftKey&&J.code==="KeyW"){J.preventDefault(),m(F=>!F);return}if((J.code==="Delete"||J.code==="KeyX")&&v.length>0){J.preventDefault(),v.forEach(F=>P(F)),M([]);return}if(J.code==="KeyG"&&!J.shiftKey&&!J.ctrlKey&&!J.altKey&&!J.metaKey){J.preventDefault(),v.length>1?H():ye(S.GEMINI_CHAT);return}if(J.code==="KeyH"&&!J.shiftKey&&!J.ctrlKey&&!J.altKey&&!J.metaKey){J.preventDefault(),v.forEach(A);return}const ce=J.code;switch(ce){case"KeyV":case"KeyC":case"KeyS":case"KeyR":!J.shiftKey&&!J.ctrlKey&&!J.altKey&&(J.preventDefault(),ce==="KeyV"&&h("edit"),ce==="KeyC"&&h("cutter"),ce==="KeyS"&&h("selection"),ce==="KeyR"&&h("reroute"));break}let B=null;if(J.shiftKey&&!J.ctrlKey&&!J.metaKey&&!J.altKey)switch(ce){case"KeyA":B=S.IDEA_GENERATOR;break;case"KeyC":B=S.CHARACTER_GENERATOR;break;case"KeyS":B=S.SCRIPT_GENERATOR;break;case"KeyD":B=S.SCRIPT_ANALYZER;break;case"KeyF":B=S.SCRIPT_PROMPT_MODIFIER;break;case"KeyR":B=S.DATA_READER;break;case"KeyG":B=S.NARRATOR_TEXT_GENERATOR;break;case"KeyN":B=S.SPEECH_SYNTHESIZER;break;case"KeyB":B=S.AUDIO_TRANSCRIBER;break;case"KeyT":B=S.YOUTUBE_TITLE_GENERATOR;break;case"KeyY":B=S.YOUTUBE_ANALYTICS;break;case"KeyM":B=S.MUSIC_IDEA_GENERATOR;break}else if(!J.shiftKey&&!J.ctrlKey&&!J.metaKey&&!J.altKey)switch(ce){case"KeyT":B=S.TEXT_INPUT;break;case"KeyA":B=S.PROMPT_ANALYZER;break;case"KeyP":B=S.PROMPT_PROCESSOR;break;case"KeyL":B=S.TRANSLATOR;break;case"KeyN":B=S.NOTE;break;case"KeyO":B=S.IMAGE_GENERATOR;break;case"KeyI":B=S.IMAGE_PREVIEW;break}B&&(J.preventDefault(),ye(B))};return window.addEventListener("keydown",le),()=>window.removeEventListener("keydown",le)},[H,h,ye,v,P,M,A,C,m,y,e,t,I,w,W,O,k,U,z,D,q,i,n,r]),{isDraggingOverCanvas:ie,handleCanvasDoubleClick:ue,handleDragOver:$,handleDragLeave:ee,handleDrop:Te}};var Fw={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let zw,Gw;function Uw(){return{geminiUrl:zw,vertexUrl:Gw}}function Hw(e,t,n,r){var a,i;if(!(e!=null&&e.baseUrl)){const s=Uw();return t?(a=s.vertexUrl)!==null&&a!==void 0?a:n:(i=s.geminiUrl)!==null&&i!==void 0?i:r}return e.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tr{}function Ye(e,t){const n=/\{([^}]+)\}/g;return e.replace(n,(r,a)=>{if(Object.prototype.hasOwnProperty.call(t,a)){const i=t[a];return i!=null?String(i):""}else throw new Error(`Key '${a}' not found in valueMap.`)})}function p(e,t,n){for(let i=0;i<t.length-1;i++){const s=t[i];if(s.endsWith("[]")){const l=s.slice(0,-2);if(!(l in e))if(Array.isArray(n))e[l]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(e[l])){const c=e[l];if(Array.isArray(n))for(let d=0;d<c.length;d++){const h=c[d];p(h,t.slice(i+1),n[d])}else for(const d of c)p(d,t.slice(i+1),n)}return}else if(s.endsWith("[0]")){const l=s.slice(0,-3);l in e||(e[l]=[{}]);const c=e[l];p(c[0],t.slice(i+1),n);return}(!e[s]||typeof e[s]!="object")&&(e[s]={}),e=e[s]}const r=t[t.length-1],a=e[r];if(a!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===a)return;if(typeof a=="object"&&typeof n=="object"&&a!==null&&n!==null)Object.assign(a,n);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(e,n):e[r]=n}function u(e,t,n=void 0){try{if(t.length===1&&t[0]==="_self")return e;for(let r=0;r<t.length;r++){if(typeof e!="object"||e===null)return n;const a=t[r];if(a.endsWith("[]")){const i=a.slice(0,-2);if(i in e){const s=e[i];return Array.isArray(s)?s.map(l=>u(l,t.slice(r+1),n)):n}else return n}else e=e[a]}return e}catch(r){if(r instanceof TypeError)return n;throw r}}function Bw(e,t){for(const[n,r]of Object.entries(t)){const a=n.split("."),i=r.split("."),s=new Set;let l=-1;for(let c=0;c<a.length;c++)if(a[c]==="*"){l=c;break}if(l!==-1&&i.length>l)for(let c=l;c<i.length;c++){const d=i[c];d!=="*"&&!d.endsWith("[]")&&!d.endsWith("[0]")&&s.add(d)}Id(e,a,i,0,s)}}function Id(e,t,n,r,a){if(r>=t.length||typeof e!="object"||e===null)return;const i=t[r];if(i.endsWith("[]")){const s=i.slice(0,-2),l=e;if(s in l&&Array.isArray(l[s]))for(const c of l[s])Id(c,t,n,r+1,a)}else if(i==="*"){if(typeof e=="object"&&e!==null&&!Array.isArray(e)){const s=e,l=Object.keys(s).filter(d=>!d.startsWith("_")&&!a.has(d)),c={};for(const d of l)c[d]=s[d];for(const[d,h]of Object.entries(c)){const g=[];for(const m of n.slice(r))m==="*"?g.push(d):g.push(m);p(s,g,h)}for(const d of l)delete s[d]}}else{const s=e;i in s&&Id(s[i],t,n,r+1,a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Gu(e){if(typeof e!="string")throw new Error("fromImageBytes must be a string");return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Vw(e){const t={},n=u(e,["operationName"]);n!=null&&p(t,["operationName"],n);const r=u(e,["resourceName"]);return r!=null&&p(t,["_url","resourceName"],r),t}function $w(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["response","generateVideoResponse"]);return s!=null&&p(t,["response"],Yw(s)),t}function Ww(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["response"]);return s!=null&&p(t,["response"],qw(s)),t}function Yw(e){const t={},n=u(e,["generatedSamples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Kw(s))),p(t,["generatedVideos"],i)}const r=u(e,["raiMediaFilteredCount"]);r!=null&&p(t,["raiMediaFilteredCount"],r);const a=u(e,["raiMediaFilteredReasons"]);return a!=null&&p(t,["raiMediaFilteredReasons"],a),t}function qw(e){const t={},n=u(e,["videos"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>Jw(s))),p(t,["generatedVideos"],i)}const r=u(e,["raiMediaFilteredCount"]);r!=null&&p(t,["raiMediaFilteredCount"],r);const a=u(e,["raiMediaFilteredReasons"]);return a!=null&&p(t,["raiMediaFilteredReasons"],a),t}function Kw(e){const t={},n=u(e,["video"]);return n!=null&&p(t,["video"],n_(n)),t}function Jw(e){const t={},n=u(e,["_self"]);return n!=null&&p(t,["video"],o_(n)),t}function Xw(e){const t={},n=u(e,["operationName"]);return n!=null&&p(t,["_url","operationName"],n),t}function Zw(e){const t={},n=u(e,["operationName"]);return n!=null&&p(t,["_url","operationName"],n),t}function Qw(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["response"]);return s!=null&&p(t,["response"],e_(s)),t}function e_(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["parent"]);r!=null&&p(t,["parent"],r);const a=u(e,["documentName"]);return a!=null&&p(t,["documentName"],a),t}function Ff(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["response"]);return s!=null&&p(t,["response"],t_(s)),t}function t_(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["parent"]);r!=null&&p(t,["parent"],r);const a=u(e,["documentName"]);return a!=null&&p(t,["documentName"],a),t}function n_(e){const t={},n=u(e,["uri"]);n!=null&&p(t,["uri"],n);const r=u(e,["encodedVideo"]);r!=null&&p(t,["videoBytes"],Gu(r));const a=u(e,["encoding"]);return a!=null&&p(t,["mimeType"],a),t}function o_(e){const t={},n=u(e,["gcsUri"]);n!=null&&p(t,["uri"],n);const r=u(e,["bytesBase64Encoded"]);r!=null&&p(t,["videoBytes"],Gu(r));const a=u(e,["mimeType"]);return a!=null&&p(t,["mimeType"],a),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Mh;(function(e){e.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",e.OUTCOME_OK="OUTCOME_OK",e.OUTCOME_FAILED="OUTCOME_FAILED",e.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Mh||(Mh={}));var jh;(function(e){e.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",e.PYTHON="PYTHON"})(jh||(jh={}));var Lh;(function(e){e.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",e.SILENT="SILENT",e.WHEN_IDLE="WHEN_IDLE",e.INTERRUPT="INTERRUPT"})(Lh||(Lh={}));var yt;(function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT",e.NULL="NULL"})(yt||(yt={}));var Dh;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(Dh||(Dh={}));var Oh;(function(e){e.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",e.SIMPLE_SEARCH="SIMPLE_SEARCH",e.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Oh||(Oh={}));var Fh;(function(e){e.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",e.NO_AUTH="NO_AUTH",e.API_KEY_AUTH="API_KEY_AUTH",e.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",e.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",e.OAUTH="OAUTH",e.OIDC_AUTH="OIDC_AUTH"})(Fh||(Fh={}));var zh;(function(e){e.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",e.HTTP_IN_QUERY="HTTP_IN_QUERY",e.HTTP_IN_HEADER="HTTP_IN_HEADER",e.HTTP_IN_PATH="HTTP_IN_PATH",e.HTTP_IN_BODY="HTTP_IN_BODY",e.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(zh||(zh={}));var Gh;(function(e){e.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",e.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",e.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",e.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(Gh||(Gh={}));var Uh;(function(e){e.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.MINIMAL="MINIMAL"})(Uh||(Uh={}));var Hh;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",e.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",e.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",e.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",e.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(Hh||(Hh={}));var Bh;(function(e){e.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",e.SEVERITY="SEVERITY",e.PROBABILITY="PROBABILITY"})(Bh||(Bh={}));var Vh;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE",e.OFF="OFF"})(Vh||(Vh={}));var $h;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.IMAGE_SAFETY="IMAGE_SAFETY",e.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",e.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",e.NO_IMAGE="NO_IMAGE",e.IMAGE_RECITATION="IMAGE_RECITATION",e.IMAGE_OTHER="IMAGE_OTHER"})($h||($h={}));var Wh;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(Wh||(Wh={}));var Yh;(function(e){e.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",e.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",e.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",e.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",e.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Yh||(Yh={}));var qh;(function(e){e.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",e.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",e.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",e.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",e.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(qh||(qh={}));var Kh;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.IMAGE_SAFETY="IMAGE_SAFETY",e.MODEL_ARMOR="MODEL_ARMOR",e.JAILBREAK="JAILBREAK"})(Kh||(Kh={}));var Jh;(function(e){e.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",e.ON_DEMAND="ON_DEMAND",e.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Jh||(Jh={}));var Vi;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.AUDIO="AUDIO"})(Vi||(Vi={}));var Xh;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Xh||(Xh={}));var Zh;(function(e){e.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",e.TUNING_MODE_FULL="TUNING_MODE_FULL",e.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Zh||(Zh={}));var Qh;(function(e){e.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",e.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",e.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",e.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",e.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",e.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",e.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Qh||(Qh={}));var Pd;(function(e){e.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",e.JOB_STATE_QUEUED="JOB_STATE_QUEUED",e.JOB_STATE_PENDING="JOB_STATE_PENDING",e.JOB_STATE_RUNNING="JOB_STATE_RUNNING",e.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",e.JOB_STATE_FAILED="JOB_STATE_FAILED",e.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",e.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",e.JOB_STATE_PAUSED="JOB_STATE_PAUSED",e.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",e.JOB_STATE_UPDATING="JOB_STATE_UPDATING",e.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Pd||(Pd={}));var em;(function(e){e.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",e.TUNING_TASK_I2V="TUNING_TASK_I2V",e.TUNING_TASK_T2V="TUNING_TASK_T2V",e.TUNING_TASK_R2V="TUNING_TASK_R2V"})(em||(em={}));var tm;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",e.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(tm||(tm={}));var nm;(function(e){e.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",e.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",e.BALANCED="BALANCED",e.PRIORITIZE_COST="PRIORITIZE_COST"})(nm||(nm={}));var om;(function(e){e.UNSPECIFIED="UNSPECIFIED",e.BLOCKING="BLOCKING",e.NON_BLOCKING="NON_BLOCKING"})(om||(om={}));var rm;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(rm||(rm={}));var am;(function(e){e.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",e.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(am||(am={}));var im;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE",e.VALIDATED="VALIDATED"})(im||(im={}));var sm;(function(e){e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(sm||(sm={}));var lm;(function(e){e.DONT_ALLOW="DONT_ALLOW",e.ALLOW_ADULT="ALLOW_ADULT",e.ALLOW_ALL="ALLOW_ALL"})(lm||(lm={}));var cm;(function(e){e.auto="auto",e.en="en",e.ja="ja",e.ko="ko",e.hi="hi",e.zh="zh",e.pt="pt",e.es="es"})(cm||(cm={}));var dm;(function(e){e.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",e.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",e.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",e.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",e.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(dm||(dm={}));var um;(function(e){e.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",e.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",e.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",e.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(um||(um={}));var pm;(function(e){e.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",e.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",e.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",e.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(pm||(pm={}));var hm;(function(e){e.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",e.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",e.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",e.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",e.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",e.EDIT_MODE_STYLE="EDIT_MODE_STYLE",e.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",e.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(hm||(hm={}));var mm;(function(e){e.FOREGROUND="FOREGROUND",e.BACKGROUND="BACKGROUND",e.PROMPT="PROMPT",e.SEMANTIC="SEMANTIC",e.INTERACTIVE="INTERACTIVE"})(mm||(mm={}));var gm;(function(e){e.ASSET="ASSET",e.STYLE="STYLE"})(gm||(gm={}));var fm;(function(e){e.INSERT="INSERT",e.REMOVE="REMOVE",e.REMOVE_STATIC="REMOVE_STATIC",e.OUTPAINT="OUTPAINT"})(fm||(fm={}));var ym;(function(e){e.OPTIMIZED="OPTIMIZED",e.LOSSLESS="LOSSLESS"})(ym||(ym={}));var xm;(function(e){e.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",e.PREFERENCE_TUNING="PREFERENCE_TUNING"})(xm||(xm={}));var vm;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.STATE_PENDING="STATE_PENDING",e.STATE_ACTIVE="STATE_ACTIVE",e.STATE_FAILED="STATE_FAILED"})(vm||(vm={}));var bm;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.PROCESSING="PROCESSING",e.ACTIVE="ACTIVE",e.FAILED="FAILED"})(bm||(bm={}));var wm;(function(e){e.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",e.UPLOADED="UPLOADED",e.GENERATED="GENERATED"})(wm||(wm={}));var _m;(function(e){e.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.RESPONSE_REJECTED="RESPONSE_REJECTED",e.NEED_MORE_INPUT="NEED_MORE_INPUT"})(_m||(_m={}));var Cm;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.DOCUMENT="DOCUMENT"})(Cm||(Cm={}));var Sm;(function(e){e.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",e.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",e.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(Sm||(Sm={}));var Tm;(function(e){e.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",e.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",e.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Tm||(Tm={}));var Em;(function(e){e.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",e.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",e.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Em||(Em={}));var Nm;(function(e){e.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",e.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",e.NO_INTERRUPTION="NO_INTERRUPTION"})(Nm||(Nm={}));var km;(function(e){e.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",e.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",e.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(km||(km={}));var Am;(function(e){e.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",e.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",e.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",e.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",e.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",e.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",e.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",e.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",e.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",e.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",e.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",e.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",e.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Am||(Am={}));var Im;(function(e){e.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",e.QUALITY="QUALITY",e.DIVERSITY="DIVERSITY",e.VOCALIZATION="VOCALIZATION"})(Im||(Im={}));var wa;(function(e){e.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",e.PLAY="PLAY",e.PAUSE="PAUSE",e.STOP="STOP",e.RESET_CONTEXT="RESET_CONTEXT"})(wa||(wa={}));class Rd{constructor(t){const n={};for(const r of t.headers.entries())n[r[0]]=r[1];this.headers=n,this.responseInternal=t}json(){return this.responseInternal.json()}}class li{get text(){var t,n,r,a,i,s,l,c;if(((a=(r=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",h=!1;const g=[];for(const m of(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)!==null&&c!==void 0?c:[]){for(const[_,y]of Object.entries(m))_!=="text"&&_!=="thought"&&_!=="thoughtSignature"&&(y!==null||y!==void 0)&&g.push(_);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;h=!0,d+=m.text}}return g.length>0&&console.warn(`there are non-text parts ${g} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?d:void 0}get data(){var t,n,r,a,i,s,l,c;if(((a=(r=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const h=[];for(const g of(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)!==null&&c!==void 0?c:[]){for(const[m,_]of Object.entries(g))m!=="inlineData"&&(_!==null||_!==void 0)&&h.push(m);g.inlineData&&typeof g.inlineData.data=="string"&&(d+=atob(g.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var t,n,r,a,i,s,l,c;if(((a=(r=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var t,n,r,a,i,s,l,c,d;if(((a=(r=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(g=>g.executableCode).map(g=>g.executableCode).filter(g=>g!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var t,n,r,a,i,s,l,c,d;if(((a=(r=(n=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(c=(l=(s=(i=this.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(g=>g.codeExecutionResult).map(g=>g.codeExecutionResult).filter(g=>g!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.output}}class Pm{}class Rm{}class r_{}class a_{}class i_{}class s_{}class Mm{}class jm{}class Lm{}class l_{}class fl{_fromAPIResponse({apiResponse:t,_isVertexAI:n}){const r=new fl;let a;const i=t;return n?a=Ww(i):a=$w(i),Object.assign(r,a),r}}class Dm{}class Om{}class Fm{}class zm{}class c_{}class d_{}class u_{}class Uu{_fromAPIResponse({apiResponse:t,_isVertexAI:n}){const r=new Uu,i=Qw(t);return Object.assign(r,i),r}}class p_{}class h_{}class m_{}class Gm{}class g_{get text(){var t,n,r;let a="",i=!1;const s=[];for(const l of(r=(n=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[c,d]of Object.entries(l))c!=="text"&&c!=="thought"&&d!==null&&s.push(c);if(typeof l.text=="string"){if(typeof l.thought=="boolean"&&l.thought)continue;i=!0,a+=l.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?a:void 0}get data(){var t,n,r;let a="";const i=[];for(const s of(r=(n=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[l,c]of Object.entries(s))l!=="inlineData"&&c!==null&&i.push(l);s.inlineData&&typeof s.inlineData.data=="string"&&(a+=atob(s.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),a.length>0?btoa(a):void 0}}class f_{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Hu{_fromAPIResponse({apiResponse:t,_isVertexAI:n}){const r=new Hu,i=Ff(t);return Object.assign(r,i),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Nt(e,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw new Error("invalid model parameter");if(e.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const n=t.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function zf(e,t){const n=Nt(e,t);return n?n.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:""}function Gf(e){return Array.isArray(e)?e.map(t=>yl(t)):[yl(e)]}function yl(e){if(typeof e=="object"&&e!==null)return e;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function Uf(e){const t=yl(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function Hf(e){const t=yl(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function Um(e){if(e==null)throw new Error("PartUnion is required");if(typeof e=="object")return e;if(typeof e=="string")return{text:e};throw new Error(`Unsupported part type: ${typeof e}`)}function Bf(e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(t=>Um(t)):[Um(e)]}function Md(e){return e!=null&&typeof e=="object"&&"parts"in e&&Array.isArray(e.parts)}function Hm(e){return e!=null&&typeof e=="object"&&"functionCall"in e}function Bm(e){return e!=null&&typeof e=="object"&&"functionResponse"in e}function Ln(e){if(e==null)throw new Error("ContentUnion is required");return Md(e)?e:{role:"user",parts:Bf(e)}}function Bu(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(n=>{const r=Ln(n);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(e.isVertexAI()){const n=Ln(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(t)?t.map(n=>Ln(n)):[Ln(t)]}function ho(e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("contents are required");if(!Array.isArray(e)){if(Hm(e)||Bm(e))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Ln(e)]}const t=[],n=[],r=Md(e[0]);for(const a of e){const i=Md(a);if(i!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(i)t.push(a);else{if(Hm(a)||Bm(a))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(a)}}return r||t.push({role:"user",parts:Bf(n)}),t}function y_(e,t){e.includes("null")&&(t.nullable=!0);const n=e.filter(r=>r!=="null");if(n.length===1)t.type=Object.values(yt).includes(n[0].toUpperCase())?n[0].toUpperCase():yt.TYPE_UNSPECIFIED;else{t.anyOf=[];for(const r of n)t.anyOf.push({type:Object.values(yt).includes(r.toUpperCase())?r.toUpperCase():yt.TYPE_UNSPECIFIED})}}function Aa(e){const t={},n=["items"],r=["anyOf"],a=["properties"];if(e.type&&e.anyOf)throw new Error("type and anyOf cannot be both populated.");const i=e.anyOf;i!=null&&i.length==2&&(i[0].type==="null"?(t.nullable=!0,e=i[1]):i[1].type==="null"&&(t.nullable=!0,e=i[0])),e.type instanceof Array&&y_(e.type,t);for(const[s,l]of Object.entries(e))if(l!=null)if(s=="type"){if(l==="null")throw new Error("type: null can not be the only possible type for the field.");if(l instanceof Array)continue;t.type=Object.values(yt).includes(l.toUpperCase())?l.toUpperCase():yt.TYPE_UNSPECIFIED}else if(n.includes(s))t[s]=Aa(l);else if(r.includes(s)){const c=[];for(const d of l){if(d.type=="null"){t.nullable=!0;continue}c.push(Aa(d))}t[s]=c}else if(a.includes(s)){const c={};for(const[d,h]of Object.entries(l))c[d]=Aa(h);t[s]=c}else{if(s==="additionalProperties")continue;t[s]=l}return t}function Vu(e){return Aa(e)}function $u(e){if(typeof e=="object")return e;if(typeof e=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error(`Unsupported speechConfig type: ${typeof e}`)}function Wu(e){if("multiSpeakerVoiceConfig"in e)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function Ha(e){if(e.functionDeclarations)for(const t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=Aa(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=Aa(t.response));return e}function Ba(e){if(e==null)throw new Error("tools is required");if(!Array.isArray(e))throw new Error("tools is required and must be an array of Tools");const t=[];for(const n of e)t.push(n);return t}function x_(e,t,n,r=1){const a=!t.startsWith(`${n}/`)&&t.split("/").length===r;return e.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${e.getProject()}/${t}`:t.startsWith(`${n}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:a?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`:t:a?`${n}/${t}`:t}function nr(e,t){if(typeof t!="string")throw new Error("name must be a string");return x_(e,t,"cachedContents")}function Vf(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function Ar(e){return Gu(e)}function v_(e){return e!=null&&typeof e=="object"&&"name"in e}function b_(e){return e!=null&&typeof e=="object"&&"video"in e}function w_(e){return e!=null&&typeof e=="object"&&"uri"in e}function $f(e){var t;let n;if(v_(e)&&(n=e.name),!(w_(e)&&(n=e.uri,n===void 0))&&!(b_(e)&&(n=(t=e.video)===null||t===void 0?void 0:t.uri,n===void 0))){if(typeof e=="string"&&(n=e),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const a=n.split("files/")[1].match(/[a-z0-9]+/);if(a===null)throw new Error(`Could not extract file name from URI ${n}`);n=a[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function Wf(e,t){let n;return e.isVertexAI()?n=t?"publishers/google/models":"models":n=t?"models":"tunedModels",n}function Yf(e){for(const t of["models","tunedModels","publisherModels"])if(__(e,t))return e[t];return[]}function __(e,t){return e!==null&&typeof e=="object"&&t in e}function C_(e,t={}){const n=e,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),t.behavior&&(r.behavior=t.behavior),{functionDeclarations:[r]}}function S_(e,t={}){const n=[],r=new Set;for(const a of e){const i=a.name;if(r.has(i))throw new Error(`Duplicate function name ${i} found in MCP tools. Please ensure function names are unique.`);r.add(i);const s=C_(a,t);s.functionDeclarations&&n.push(...s.functionDeclarations)}return{functionDeclarations:n}}function qf(e,t){let n;if(typeof t=="string")if(e.isVertexAI())if(t.startsWith("gs://"))n={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))n={format:"bigquery",bigqueryUri:t};else throw new Error(`Unsupported string source for Vertex AI: ${t}`);else if(t.startsWith("files/"))n={fileName:t};else throw new Error(`Unsupported string source for Gemini API: ${t}`);else if(Array.isArray(t)){if(e.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:t}}else n=t;const r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,a=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(e.isVertexAI()){if(a>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||a!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function T_(e){if(typeof e!="string")return e;const t=e;if(t.startsWith("gs://"))return{format:"jsonl",gcsUri:t};if(t.startsWith("bq://"))return{format:"bigquery",bigqueryUri:t};throw new Error(`Unsupported destination: ${t}`)}function Kf(e){if(typeof e!="object"||e===null)return{};const t=e,n=t.inlinedResponses;if(typeof n!="object"||n===null)return e;const a=n.inlinedResponses;if(!Array.isArray(a)||a.length===0)return e;let i=!1;for(const s of a){if(typeof s!="object"||s===null)continue;const c=s.response;if(typeof c!="object"||c===null)continue;if(c.embedding!==void 0){i=!0;break}}return i&&(t.inlinedEmbedContentResponses=t.inlinedResponses,delete t.inlinedResponses),e}function Va(e,t){const n=t;if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function Jf(e){const t=e;return t==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":t==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":t==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":t==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":t==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":t==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":t==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function E_(e){const t={},n=u(e,["responsesFile"]);n!=null&&p(t,["fileName"],n);const r=u(e,["inlinedResponses","inlinedResponses"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>iC(s))),p(t,["inlinedResponses"],i)}const a=u(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["inlinedEmbedContentResponses"],i)}return t}function N_(e){const t={},n=u(e,["predictionsFormat"]);n!=null&&p(t,["format"],n);const r=u(e,["gcsDestination","outputUriPrefix"]);r!=null&&p(t,["gcsUri"],r);const a=u(e,["bigqueryDestination","outputUri"]);return a!=null&&p(t,["bigqueryUri"],a),t}function k_(e){const t={},n=u(e,["format"]);n!=null&&p(t,["predictionsFormat"],n);const r=u(e,["gcsUri"]);r!=null&&p(t,["gcsDestination","outputUriPrefix"],r);const a=u(e,["bigqueryUri"]);if(a!=null&&p(t,["bigqueryDestination","outputUri"],a),u(e,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(u(e,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(u(e,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}function Vs(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata","displayName"]);r!=null&&p(t,["displayName"],r);const a=u(e,["metadata","state"]);a!=null&&p(t,["state"],Jf(a));const i=u(e,["metadata","createTime"]);i!=null&&p(t,["createTime"],i);const s=u(e,["metadata","endTime"]);s!=null&&p(t,["endTime"],s);const l=u(e,["metadata","updateTime"]);l!=null&&p(t,["updateTime"],l);const c=u(e,["metadata","model"]);c!=null&&p(t,["model"],c);const d=u(e,["metadata","output"]);return d!=null&&p(t,["dest"],E_(Kf(d))),t}function jd(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["displayName"]);r!=null&&p(t,["displayName"],r);const a=u(e,["state"]);a!=null&&p(t,["state"],Jf(a));const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["createTime"]);s!=null&&p(t,["createTime"],s);const l=u(e,["startTime"]);l!=null&&p(t,["startTime"],l);const c=u(e,["endTime"]);c!=null&&p(t,["endTime"],c);const d=u(e,["updateTime"]);d!=null&&p(t,["updateTime"],d);const h=u(e,["model"]);h!=null&&p(t,["model"],h);const g=u(e,["inputConfig"]);g!=null&&p(t,["src"],A_(g));const m=u(e,["outputConfig"]);m!=null&&p(t,["dest"],N_(Kf(m)));const _=u(e,["completionStats"]);return _!=null&&p(t,["completionStats"],_),t}function A_(e){const t={},n=u(e,["instancesFormat"]);n!=null&&p(t,["format"],n);const r=u(e,["gcsSource","uris"]);r!=null&&p(t,["gcsUri"],r);const a=u(e,["bigquerySource","inputUri"]);return a!=null&&p(t,["bigqueryUri"],a),t}function I_(e,t){const n={};if(u(t,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(u(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(u(t,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=u(t,["fileName"]);r!=null&&p(n,["fileName"],r);const a=u(t,["inlinedRequests"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>aC(e,s))),p(n,["requests","requests"],i)}return n}function P_(e){const t={},n=u(e,["format"]);n!=null&&p(t,["instancesFormat"],n);const r=u(e,["gcsUri"]);r!=null&&p(t,["gcsSource","uris"],r);const a=u(e,["bigqueryUri"]);if(a!=null&&p(t,["bigquerySource","inputUri"],a),u(e,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(u(e,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return t}function R_(e){const t={},n=u(e,["data"]);if(n!=null&&p(t,["data"],n),u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function M_(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Va(e,r)),n}function j_(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Va(e,r)),n}function L_(e){const t={},n=u(e,["content"]);n!=null&&p(t,["content"],n);const r=u(e,["citationMetadata"]);r!=null&&p(t,["citationMetadata"],D_(r));const a=u(e,["tokenCount"]);a!=null&&p(t,["tokenCount"],a);const i=u(e,["finishReason"]);i!=null&&p(t,["finishReason"],i);const s=u(e,["avgLogprobs"]);s!=null&&p(t,["avgLogprobs"],s);const l=u(e,["groundingMetadata"]);l!=null&&p(t,["groundingMetadata"],l);const c=u(e,["index"]);c!=null&&p(t,["index"],c);const d=u(e,["logprobsResult"]);d!=null&&p(t,["logprobsResult"],d);const h=u(e,["safetyRatings"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(_=>_)),p(t,["safetyRatings"],m)}const g=u(e,["urlContextMetadata"]);return g!=null&&p(t,["urlContextMetadata"],g),t}function D_(e){const t={},n=u(e,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),p(t,["citations"],r)}return t}function Xf(e){const t={},n=u(e,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(i=>hC(i))),p(t,["parts"],a)}const r=u(e,["role"]);return r!=null&&p(t,["role"],r),t}function O_(e,t){const n={},r=u(e,["displayName"]);if(t!==void 0&&r!=null&&p(t,["batch","displayName"],r),u(e,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function F_(e,t){const n={},r=u(e,["displayName"]);t!==void 0&&r!=null&&p(t,["displayName"],r);const a=u(e,["dest"]);return t!==void 0&&a!=null&&p(t,["outputConfig"],k_(T_(a))),n}function Vm(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["src"]);a!=null&&p(n,["batch","inputConfig"],I_(e,qf(e,a)));const i=u(t,["config"]);return i!=null&&O_(i,n),n}function z_(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["model"],Nt(e,r));const a=u(t,["src"]);a!=null&&p(n,["inputConfig"],P_(qf(e,a)));const i=u(t,["config"]);return i!=null&&F_(i,n),n}function G_(e,t){const n={},r=u(e,["displayName"]);return t!==void 0&&r!=null&&p(t,["batch","displayName"],r),n}function U_(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["src"]);a!=null&&p(n,["batch","inputConfig"],q_(e,a));const i=u(t,["config"]);return i!=null&&G_(i,n),n}function H_(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Va(e,r)),n}function B_(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Va(e,r)),n}function V_(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["name"]);r!=null&&p(t,["name"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);return i!=null&&p(t,["error"],i),t}function $_(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["name"]);r!=null&&p(t,["name"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);return i!=null&&p(t,["error"],i),t}function W_(e,t){const n={},r=u(t,["contents"]);if(r!=null){let i=Bu(e,r);Array.isArray(i)&&(i=i.map(s=>s)),p(n,["requests[]","request","content"],i)}const a=u(t,["config"]);return a!=null&&(p(n,["_self"],Y_(a,n)),Bw(n,{"requests[].*":"requests[].request.*"})),n}function Y_(e,t){const n={},r=u(e,["taskType"]);t!==void 0&&r!=null&&p(t,["requests[]","taskType"],r);const a=u(e,["title"]);t!==void 0&&a!=null&&p(t,["requests[]","title"],a);const i=u(e,["outputDimensionality"]);if(t!==void 0&&i!=null&&p(t,["requests[]","outputDimensionality"],i),u(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(u(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function q_(e,t){const n={},r=u(t,["fileName"]);r!=null&&p(n,["file_name"],r);const a=u(t,["inlinedRequests"]);return a!=null&&p(n,["requests"],W_(e,a)),n}function K_(e){const t={};if(u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=u(e,["fileUri"]);n!=null&&p(t,["fileUri"],n);const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function J_(e){const t={},n=u(e,["id"]);n!=null&&p(t,["id"],n);const r=u(e,["args"]);r!=null&&p(t,["args"],r);const a=u(e,["name"]);if(a!=null&&p(t,["name"],a),u(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function X_(e){const t={},n=u(e,["mode"]);n!=null&&p(t,["mode"],n);const r=u(e,["allowedFunctionNames"]);if(r!=null&&p(t,["allowedFunctionNames"],r),u(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function Z_(e,t,n){const r={},a=u(t,["systemInstruction"]);n!==void 0&&a!=null&&p(n,["systemInstruction"],Xf(Ln(a)));const i=u(t,["temperature"]);i!=null&&p(r,["temperature"],i);const s=u(t,["topP"]);s!=null&&p(r,["topP"],s);const l=u(t,["topK"]);l!=null&&p(r,["topK"],l);const c=u(t,["candidateCount"]);c!=null&&p(r,["candidateCount"],c);const d=u(t,["maxOutputTokens"]);d!=null&&p(r,["maxOutputTokens"],d);const h=u(t,["stopSequences"]);h!=null&&p(r,["stopSequences"],h);const g=u(t,["responseLogprobs"]);g!=null&&p(r,["responseLogprobs"],g);const m=u(t,["logprobs"]);m!=null&&p(r,["logprobs"],m);const _=u(t,["presencePenalty"]);_!=null&&p(r,["presencePenalty"],_);const y=u(t,["frequencyPenalty"]);y!=null&&p(r,["frequencyPenalty"],y);const v=u(t,["seed"]);v!=null&&p(r,["seed"],v);const C=u(t,["responseMimeType"]);C!=null&&p(r,["responseMimeType"],C);const w=u(t,["responseSchema"]);w!=null&&p(r,["responseSchema"],Vu(w));const b=u(t,["responseJsonSchema"]);if(b!=null&&p(r,["responseJsonSchema"],b),u(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(u(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const f=u(t,["safetySettings"]);if(n!==void 0&&f!=null){let H=f;Array.isArray(H)&&(H=H.map(W=>mC(W))),p(n,["safetySettings"],H)}const T=u(t,["tools"]);if(n!==void 0&&T!=null){let H=Ba(T);Array.isArray(H)&&(H=H.map(W=>fC(Ha(W)))),p(n,["tools"],H)}const I=u(t,["toolConfig"]);if(n!==void 0&&I!=null&&p(n,["toolConfig"],gC(I)),u(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const E=u(t,["cachedContent"]);n!==void 0&&E!=null&&p(n,["cachedContent"],nr(e,E));const R=u(t,["responseModalities"]);R!=null&&p(r,["responseModalities"],R);const N=u(t,["mediaResolution"]);N!=null&&p(r,["mediaResolution"],N);const A=u(t,["speechConfig"]);if(A!=null&&p(r,["speechConfig"],$u(A)),u(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const k=u(t,["thinkingConfig"]);k!=null&&p(r,["thinkingConfig"],k);const P=u(t,["imageConfig"]);P!=null&&p(r,["imageConfig"],rC(P));const M=u(t,["enableEnhancedCivicAnswers"]);return M!=null&&p(r,["enableEnhancedCivicAnswers"],M),r}function Q_(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>L_(d))),p(t,["candidates"],c)}const a=u(e,["modelVersion"]);a!=null&&p(t,["modelVersion"],a);const i=u(e,["promptFeedback"]);i!=null&&p(t,["promptFeedback"],i);const s=u(e,["responseId"]);s!=null&&p(t,["responseId"],s);const l=u(e,["usageMetadata"]);return l!=null&&p(t,["usageMetadata"],l),t}function eC(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Va(e,r)),n}function tC(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],Va(e,r)),n}function nC(e){const t={};if(u(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=u(e,["enableWidget"]);return n!=null&&p(t,["enableWidget"],n),t}function oC(e){const t={};if(u(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=u(e,["timeRangeFilter"]);return n!=null&&p(t,["timeRangeFilter"],n),t}function rC(e){const t={},n=u(e,["aspectRatio"]);n!=null&&p(t,["aspectRatio"],n);const r=u(e,["imageSize"]);if(r!=null&&p(t,["imageSize"],r),u(e,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(u(e,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function aC(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["request","model"],Nt(e,r));const a=u(t,["contents"]);if(a!=null){let l=ho(a);Array.isArray(l)&&(l=l.map(c=>Xf(c))),p(n,["request","contents"],l)}const i=u(t,["metadata"]);i!=null&&p(n,["metadata"],i);const s=u(t,["config"]);return s!=null&&p(n,["request","generationConfig"],Z_(e,s,u(n,["request"],{}))),n}function iC(e){const t={},n=u(e,["response"]);n!=null&&p(t,["response"],Q_(n));const r=u(e,["error"]);return r!=null&&p(t,["error"],r),t}function sC(e,t){const n={},r=u(e,["pageSize"]);t!==void 0&&r!=null&&p(t,["_query","pageSize"],r);const a=u(e,["pageToken"]);if(t!==void 0&&a!=null&&p(t,["_query","pageToken"],a),u(e,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function lC(e,t){const n={},r=u(e,["pageSize"]);t!==void 0&&r!=null&&p(t,["_query","pageSize"],r);const a=u(e,["pageToken"]);t!==void 0&&a!=null&&p(t,["_query","pageToken"],a);const i=u(e,["filter"]);return t!==void 0&&i!=null&&p(t,["_query","filter"],i),n}function cC(e){const t={},n=u(e,["config"]);return n!=null&&sC(n,t),t}function dC(e){const t={},n=u(e,["config"]);return n!=null&&lC(n,t),t}function uC(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["operations"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>Vs(s))),p(t,["batchJobs"],i)}return t}function pC(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["batchPredictionJobs"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>jd(s))),p(t,["batchJobs"],i)}return t}function hC(e){const t={},n=u(e,["mediaResolution"]);n!=null&&p(t,["mediaResolution"],n);const r=u(e,["codeExecutionResult"]);r!=null&&p(t,["codeExecutionResult"],r);const a=u(e,["executableCode"]);a!=null&&p(t,["executableCode"],a);const i=u(e,["fileData"]);i!=null&&p(t,["fileData"],K_(i));const s=u(e,["functionCall"]);s!=null&&p(t,["functionCall"],J_(s));const l=u(e,["functionResponse"]);l!=null&&p(t,["functionResponse"],l);const c=u(e,["inlineData"]);c!=null&&p(t,["inlineData"],R_(c));const d=u(e,["text"]);d!=null&&p(t,["text"],d);const h=u(e,["thought"]);h!=null&&p(t,["thought"],h);const g=u(e,["thoughtSignature"]);g!=null&&p(t,["thoughtSignature"],g);const m=u(e,["videoMetadata"]);return m!=null&&p(t,["videoMetadata"],m),t}function mC(e){const t={},n=u(e,["category"]);if(n!=null&&p(t,["category"],n),u(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=u(e,["threshold"]);return r!=null&&p(t,["threshold"],r),t}function gC(e){const t={},n=u(e,["functionCallingConfig"]);n!=null&&p(t,["functionCallingConfig"],X_(n));const r=u(e,["retrievalConfig"]);return r!=null&&p(t,["retrievalConfig"],r),t}function fC(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(g=>g)),p(t,["functionDeclarations"],h)}if(u(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=u(e,["googleSearchRetrieval"]);r!=null&&p(t,["googleSearchRetrieval"],r);const a=u(e,["computerUse"]);a!=null&&p(t,["computerUse"],a);const i=u(e,["fileSearch"]);i!=null&&p(t,["fileSearch"],i);const s=u(e,["codeExecution"]);if(s!=null&&p(t,["codeExecution"],s),u(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=u(e,["googleMaps"]);l!=null&&p(t,["googleMaps"],nC(l));const c=u(e,["googleSearch"]);c!=null&&p(t,["googleSearch"],oC(c));const d=u(e,["urlContext"]);return d!=null&&p(t,["urlContext"],d),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Zo;(function(e){e.PAGED_ITEM_BATCH_JOBS="batchJobs",e.PAGED_ITEM_MODELS="models",e.PAGED_ITEM_TUNING_JOBS="tuningJobs",e.PAGED_ITEM_FILES="files",e.PAGED_ITEM_CACHED_CONTENTS="cachedContents",e.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",e.PAGED_ITEM_DOCUMENTS="documents"})(Zo||(Zo={}));class Qr{constructor(t,n,r,a){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(t,r,a)}init(t,n,r){var a,i;this.nameInternal=t,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let s={config:{}};!r||Object.keys(r).length===0?s={config:{}}:typeof r=="object"?s=Object.assign({},r):s=r,s.config&&(s.config.pageToken=n.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(i=(a=s.config)===null||a===void 0?void 0:a.pageSize)!==null&&i!==void 0?i:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yC extends tr{constructor(t){super(),this.apiClient=t,this.list=async(n={})=>new Qr(Zo.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)}}createInlinedGenerateContentRequest(t){const n=Vm(this.apiClient,t),r=n._url,a=Ye("{model}:batchGenerateContent",r),l=n.batch.inputConfig.requests,c=l.requests,d=[];for(const h of c){const g=Object.assign({},h);if(g.systemInstruction){const m=g.systemInstruction;delete g.systemInstruction;const _=g.request;_.systemInstruction=m,g.request=_}d.push(g)}return l.requests=d,delete n.config,delete n._url,delete n._query,{path:a,body:n}}getGcsUri(t){if(typeof t=="string")return t.startsWith("gs://")?t:void 0;if(!Array.isArray(t)&&t.gcsUri&&t.gcsUri.length>0)return t.gcsUri[0]}getBigqueryUri(t){if(typeof t=="string")return t.startsWith("bq://")?t:void 0;if(!Array.isArray(t))return t.bigqueryUri}formatDestination(t,n){const r=n?Object.assign({},n):{},a=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${a}`),r.dest===void 0){const i=this.getGcsUri(t),s=this.getBigqueryUri(t);if(i)i.endsWith(".jsonl")?r.dest=`${i.slice(0,-6)}/dest`:r.dest=`${i}_dest_${a}`;else if(s)r.dest=`${s}_dest_${a}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=z_(this.apiClient,t);return l=Ye("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>jd(h))}else{const d=Vm(this.apiClient,t);return l=Ye("{model}:batchGenerateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>Vs(h))}}async createEmbeddingsInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=U_(this.apiClient,t);return i=Ye("{model}:asyncBatchEmbedContent",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>Vs(c))}}async get(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=tC(this.apiClient,t);return l=Ye("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>jd(h))}else{const d=eC(this.apiClient,t);return l=Ye("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>Vs(h))}}async cancel(t){var n,r,a,i;let s="",l={};if(this.apiClient.isVertexAI()){const c=j_(this.apiClient,t);s=Ye("batchPredictionJobs/{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}else{const c=M_(this.apiClient,t);s=Ye("batches/{name}:cancel",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=dC(t);return l=Ye("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=pC(h),m=new Gm;return Object.assign(m,g),m})}else{const d=cC(t);return l=Ye("batches",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=uC(h),m=new Gm;return Object.assign(m,g),m})}}async delete(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=B_(this.apiClient,t);return l=Ye("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>$_(h))}else{const d=H_(this.apiClient,t);return l=Ye("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>V_(h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function xC(e){const t={},n=u(e,["data"]);if(n!=null&&p(t,["data"],n),u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function $m(e){const t={},n=u(e,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(i=>UC(i))),p(t,["parts"],a)}const r=u(e,["role"]);return r!=null&&p(t,["role"],r),t}function vC(e,t){const n={},r=u(e,["ttl"]);t!==void 0&&r!=null&&p(t,["ttl"],r);const a=u(e,["expireTime"]);t!==void 0&&a!=null&&p(t,["expireTime"],a);const i=u(e,["displayName"]);t!==void 0&&i!=null&&p(t,["displayName"],i);const s=u(e,["contents"]);if(t!==void 0&&s!=null){let h=ho(s);Array.isArray(h)&&(h=h.map(g=>$m(g))),p(t,["contents"],h)}const l=u(e,["systemInstruction"]);t!==void 0&&l!=null&&p(t,["systemInstruction"],$m(Ln(l)));const c=u(e,["tools"]);if(t!==void 0&&c!=null){let h=c;Array.isArray(h)&&(h=h.map(g=>BC(g))),p(t,["tools"],h)}const d=u(e,["toolConfig"]);if(t!==void 0&&d!=null&&p(t,["toolConfig"],HC(d)),u(e,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function bC(e,t){const n={},r=u(e,["ttl"]);t!==void 0&&r!=null&&p(t,["ttl"],r);const a=u(e,["expireTime"]);t!==void 0&&a!=null&&p(t,["expireTime"],a);const i=u(e,["displayName"]);t!==void 0&&i!=null&&p(t,["displayName"],i);const s=u(e,["contents"]);if(t!==void 0&&s!=null){let g=ho(s);Array.isArray(g)&&(g=g.map(m=>m)),p(t,["contents"],g)}const l=u(e,["systemInstruction"]);t!==void 0&&l!=null&&p(t,["systemInstruction"],Ln(l));const c=u(e,["tools"]);if(t!==void 0&&c!=null){let g=c;Array.isArray(g)&&(g=g.map(m=>VC(m))),p(t,["tools"],g)}const d=u(e,["toolConfig"]);t!==void 0&&d!=null&&p(t,["toolConfig"],d);const h=u(e,["kmsKeyName"]);return t!==void 0&&h!=null&&p(t,["encryption_spec","kmsKeyName"],h),n}function wC(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["model"],zf(e,r));const a=u(t,["config"]);return a!=null&&vC(a,n),n}function _C(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["model"],zf(e,r));const a=u(t,["config"]);return a!=null&&bC(a,n),n}function CC(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],nr(e,r)),n}function SC(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],nr(e,r)),n}function TC(e){const t={},n=u(e,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function EC(e){const t={},n=u(e,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function NC(e){const t={};if(u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=u(e,["fileUri"]);n!=null&&p(t,["fileUri"],n);const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function kC(e){const t={},n=u(e,["id"]);n!=null&&p(t,["id"],n);const r=u(e,["args"]);r!=null&&p(t,["args"],r);const a=u(e,["name"]);if(a!=null&&p(t,["name"],a),u(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function AC(e){const t={},n=u(e,["mode"]);n!=null&&p(t,["mode"],n);const r=u(e,["allowedFunctionNames"]);if(r!=null&&p(t,["allowedFunctionNames"],r),u(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function IC(e){const t={};if(u(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=u(e,["description"]);n!=null&&p(t,["description"],n);const r=u(e,["name"]);r!=null&&p(t,["name"],r);const a=u(e,["parameters"]);a!=null&&p(t,["parameters"],a);const i=u(e,["parametersJsonSchema"]);i!=null&&p(t,["parametersJsonSchema"],i);const s=u(e,["response"]);s!=null&&p(t,["response"],s);const l=u(e,["responseJsonSchema"]);return l!=null&&p(t,["responseJsonSchema"],l),t}function PC(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],nr(e,r)),n}function RC(e,t){const n={},r=u(t,["name"]);return r!=null&&p(n,["_url","name"],nr(e,r)),n}function MC(e){const t={};if(u(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=u(e,["enableWidget"]);return n!=null&&p(t,["enableWidget"],n),t}function jC(e){const t={};if(u(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=u(e,["timeRangeFilter"]);return n!=null&&p(t,["timeRangeFilter"],n),t}function LC(e,t){const n={},r=u(e,["pageSize"]);t!==void 0&&r!=null&&p(t,["_query","pageSize"],r);const a=u(e,["pageToken"]);return t!==void 0&&a!=null&&p(t,["_query","pageToken"],a),n}function DC(e,t){const n={},r=u(e,["pageSize"]);t!==void 0&&r!=null&&p(t,["_query","pageSize"],r);const a=u(e,["pageToken"]);return t!==void 0&&a!=null&&p(t,["_query","pageToken"],a),n}function OC(e){const t={},n=u(e,["config"]);return n!=null&&LC(n,t),t}function FC(e){const t={},n=u(e,["config"]);return n!=null&&DC(n,t),t}function zC(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["cachedContents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["cachedContents"],i)}return t}function GC(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["cachedContents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["cachedContents"],i)}return t}function UC(e){const t={},n=u(e,["mediaResolution"]);n!=null&&p(t,["mediaResolution"],n);const r=u(e,["codeExecutionResult"]);r!=null&&p(t,["codeExecutionResult"],r);const a=u(e,["executableCode"]);a!=null&&p(t,["executableCode"],a);const i=u(e,["fileData"]);i!=null&&p(t,["fileData"],NC(i));const s=u(e,["functionCall"]);s!=null&&p(t,["functionCall"],kC(s));const l=u(e,["functionResponse"]);l!=null&&p(t,["functionResponse"],l);const c=u(e,["inlineData"]);c!=null&&p(t,["inlineData"],xC(c));const d=u(e,["text"]);d!=null&&p(t,["text"],d);const h=u(e,["thought"]);h!=null&&p(t,["thought"],h);const g=u(e,["thoughtSignature"]);g!=null&&p(t,["thoughtSignature"],g);const m=u(e,["videoMetadata"]);return m!=null&&p(t,["videoMetadata"],m),t}function HC(e){const t={},n=u(e,["functionCallingConfig"]);n!=null&&p(t,["functionCallingConfig"],AC(n));const r=u(e,["retrievalConfig"]);return r!=null&&p(t,["retrievalConfig"],r),t}function BC(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(g=>g)),p(t,["functionDeclarations"],h)}if(u(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=u(e,["googleSearchRetrieval"]);r!=null&&p(t,["googleSearchRetrieval"],r);const a=u(e,["computerUse"]);a!=null&&p(t,["computerUse"],a);const i=u(e,["fileSearch"]);i!=null&&p(t,["fileSearch"],i);const s=u(e,["codeExecution"]);if(s!=null&&p(t,["codeExecution"],s),u(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=u(e,["googleMaps"]);l!=null&&p(t,["googleMaps"],MC(l));const c=u(e,["googleSearch"]);c!=null&&p(t,["googleSearch"],jC(c));const d=u(e,["urlContext"]);return d!=null&&p(t,["urlContext"],d),t}function VC(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let g=n;Array.isArray(g)&&(g=g.map(m=>IC(m))),p(t,["functionDeclarations"],g)}const r=u(e,["retrieval"]);r!=null&&p(t,["retrieval"],r);const a=u(e,["googleSearchRetrieval"]);a!=null&&p(t,["googleSearchRetrieval"],a);const i=u(e,["computerUse"]);if(i!=null&&p(t,["computerUse"],i),u(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=u(e,["codeExecution"]);s!=null&&p(t,["codeExecution"],s);const l=u(e,["enterpriseWebSearch"]);l!=null&&p(t,["enterpriseWebSearch"],l);const c=u(e,["googleMaps"]);c!=null&&p(t,["googleMaps"],c);const d=u(e,["googleSearch"]);d!=null&&p(t,["googleSearch"],d);const h=u(e,["urlContext"]);return h!=null&&p(t,["urlContext"],h),t}function $C(e,t){const n={},r=u(e,["ttl"]);t!==void 0&&r!=null&&p(t,["ttl"],r);const a=u(e,["expireTime"]);return t!==void 0&&a!=null&&p(t,["expireTime"],a),n}function WC(e,t){const n={},r=u(e,["ttl"]);t!==void 0&&r!=null&&p(t,["ttl"],r);const a=u(e,["expireTime"]);return t!==void 0&&a!=null&&p(t,["expireTime"],a),n}function YC(e,t){const n={},r=u(t,["name"]);r!=null&&p(n,["_url","name"],nr(e,r));const a=u(t,["config"]);return a!=null&&$C(a,n),n}function qC(e,t){const n={},r=u(t,["name"]);r!=null&&p(n,["_url","name"],nr(e,r));const a=u(t,["config"]);return a!=null&&WC(a,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class KC extends tr{constructor(t){super(),this.apiClient=t,this.list=async(n={})=>new Qr(Zo.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(n),n)}async create(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=_C(this.apiClient,t);return l=Ye("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const d=wC(this.apiClient,t);return l=Ye("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async get(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=RC(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const d=PC(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async delete(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=SC(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=EC(h),m=new Fm;return Object.assign(m,g),m})}else{const d=CC(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=TC(h),m=new Fm;return Object.assign(m,g),m})}}async update(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=qC(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{const d=YC(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async listInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=FC(t);return l=Ye("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=GC(h),m=new zm;return Object.assign(m,g),m})}else{const d=OC(t);return l=Ye("cachedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=zC(h),m=new zm;return Object.assign(m,g),m})}}}function xl(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n}function Wm(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function mt(e){return this instanceof mt?(this.v=e,this):new mt(e)}function No(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),a,i=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",s),a[Symbol.asyncIterator]=function(){return this},a;function s(_){return function(y){return Promise.resolve(y).then(_,g)}}function l(_,y){r[_]&&(a[_]=function(v){return new Promise(function(C,w){i.push([_,v,C,w])>1||c(_,v)})},y&&(a[_]=y(a[_])))}function c(_,y){try{d(r[_](y))}catch(v){m(i[0][3],v)}}function d(_){_.value instanceof mt?Promise.resolve(_.value.v).then(h,g):m(i[0][2],_)}function h(_){c("next",_)}function g(_){c("throw",_)}function m(_,y){_(y),i.shift(),i.length&&c(i[0][0],i[0][1])}}function ko(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof Wm=="function"?Wm(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(i){n[i]=e[i]&&function(s){return new Promise(function(l,c){s=e[i](s),a(l,c,s.done,s.value)})}}function a(i,s,l,c){Promise.resolve(c).then(function(d){i({value:d,done:l})},s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function JC(e){var t;if(e.candidates==null||e.candidates.length===0)return!1;const n=(t=e.candidates[0])===null||t===void 0?void 0:t.content;return n===void 0?!1:Zf(n)}function Zf(e){if(e.parts===void 0||e.parts.length===0)return!1;for(const t of e.parts)if(t===void 0||Object.keys(t).length===0)return!1;return!0}function XC(e){if(e.length!==0){for(const t of e)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function Ym(e){if(e===void 0||e.length===0)return[];const t=[],n=e.length;let r=0;for(;r<n;)if(e[r].role==="user")t.push(e[r]),r++;else{const a=[];let i=!0;for(;r<n&&e[r].role==="model";)a.push(e[r]),i&&!Zf(e[r])&&(i=!1),r++;i?t.push(...a):t.pop()}return t}class ZC{constructor(t,n){this.modelsModule=t,this.apiClient=n}create(t){return new QC(this.apiClient,this.modelsModule,t.model,t.config,structuredClone(t.history))}}class QC{constructor(t,n,r,a={},i=[]){this.apiClient=t,this.modelsModule=n,this.model=r,this.config=a,this.history=i,this.sendPromise=Promise.resolve(),XC(i)}async sendMessage(t){var n;await this.sendPromise;const r=Ln(t.message),a=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=t.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var i,s,l;const c=await a,d=(s=(i=c.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content,h=c.automaticFunctionCallingHistory,g=this.getHistory(!0).length;let m=[];h!=null&&(m=(l=h.slice(g))!==null&&l!==void 0?l:[]);const _=d?[d]:[];this.recordHistory(r,_,m)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),a}async sendMessageStream(t){var n;await this.sendPromise;const r=Ln(t.message),a=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=t.config)!==null&&n!==void 0?n:this.config});this.sendPromise=a.then(()=>{}).catch(()=>{});const i=await a;return this.processStreamResponse(i,r)}getHistory(t=!1){const n=t?Ym(this.history):this.history;return structuredClone(n)}processStreamResponse(t,n){return No(this,arguments,function*(){var a,i,s,l,c,d;const h=[];try{for(var g=!0,m=ko(t),_;_=yield mt(m.next()),a=_.done,!a;g=!0){l=_.value,g=!1;const y=l;if(JC(y)){const v=(d=(c=y.candidates)===null||c===void 0?void 0:c[0])===null||d===void 0?void 0:d.content;v!==void 0&&h.push(v)}yield yield mt(y)}}catch(y){i={error:y}}finally{try{!g&&!a&&(s=m.return)&&(yield mt(s.call(m)))}finally{if(i)throw i.error}}this.recordHistory(n,h)})}recordHistory(t,n,r){let a=[];n.length>0&&n.every(i=>i.role!==void 0)?a=n:a.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...Ym(r)):this.history.push(t),this.history.push(...a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Gl extends Error{constructor(t){super(t.message),this.name="ApiError",this.status=t.status,Object.setPrototypeOf(this,Gl.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function eS(e){const t={},n=u(e,["file"]);return n!=null&&p(t,["file"],n),t}function tS(e){const t={},n=u(e,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function nS(e){const t={},n=u(e,["name"]);return n!=null&&p(t,["_url","file"],$f(n)),t}function oS(e){const t={},n=u(e,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function rS(e){const t={},n=u(e,["name"]);return n!=null&&p(t,["_url","file"],$f(n)),t}function aS(e,t){const n={},r=u(e,["pageSize"]);t!==void 0&&r!=null&&p(t,["_query","pageSize"],r);const a=u(e,["pageToken"]);return t!==void 0&&a!=null&&p(t,["_query","pageToken"],a),n}function iS(e){const t={},n=u(e,["config"]);return n!=null&&aS(n,t),t}function sS(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["files"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["files"],i)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class lS extends tr{constructor(t){super(),this.apiClient=t,this.list=async(n={})=>new Qr(Zo.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(n),n)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(n=>n)}async download(t){await this.apiClient.downloadFile(t)}async listInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=iS(t);return i=Ye("files",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),a.then(c=>{const d=sS(c),h=new p_;return Object.assign(h,d),h})}}async createInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=eS(t);return i=Ye("upload/v1beta/files",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=tS(c),h=new h_;return Object.assign(h,d),h})}}async get(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=rS(t);return i=Ye("files/{file}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=nS(t);return i=Ye("files/{file}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),a.then(c=>{const d=oS(c),h=new m_;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $s(e){const t={},n=u(e,["data"]);if(n!=null&&p(t,["data"],n),u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function cS(e){const t={},n=u(e,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(i=>TS(i))),p(t,["parts"],a)}const r=u(e,["role"]);return r!=null&&p(t,["role"],r),t}function dS(e){const t={};if(u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=u(e,["fileUri"]);n!=null&&p(t,["fileUri"],n);const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function uS(e){const t={},n=u(e,["id"]);n!=null&&p(t,["id"],n);const r=u(e,["args"]);r!=null&&p(t,["args"],r);const a=u(e,["name"]);if(a!=null&&p(t,["name"],a),u(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function pS(e){const t={};if(u(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=u(e,["description"]);n!=null&&p(t,["description"],n);const r=u(e,["name"]);r!=null&&p(t,["name"],r);const a=u(e,["parameters"]);a!=null&&p(t,["parameters"],a);const i=u(e,["parametersJsonSchema"]);i!=null&&p(t,["parametersJsonSchema"],i);const s=u(e,["response"]);s!=null&&p(t,["response"],s);const l=u(e,["responseJsonSchema"]);return l!=null&&p(t,["responseJsonSchema"],l),t}function hS(e){const t={},n=u(e,["modelSelectionConfig"]);n!=null&&p(t,["modelConfig"],n);const r=u(e,["responseJsonSchema"]);r!=null&&p(t,["responseJsonSchema"],r);const a=u(e,["audioTimestamp"]);a!=null&&p(t,["audioTimestamp"],a);const i=u(e,["candidateCount"]);i!=null&&p(t,["candidateCount"],i);const s=u(e,["enableAffectiveDialog"]);s!=null&&p(t,["enableAffectiveDialog"],s);const l=u(e,["frequencyPenalty"]);l!=null&&p(t,["frequencyPenalty"],l);const c=u(e,["logprobs"]);c!=null&&p(t,["logprobs"],c);const d=u(e,["maxOutputTokens"]);d!=null&&p(t,["maxOutputTokens"],d);const h=u(e,["mediaResolution"]);h!=null&&p(t,["mediaResolution"],h);const g=u(e,["presencePenalty"]);g!=null&&p(t,["presencePenalty"],g);const m=u(e,["responseLogprobs"]);m!=null&&p(t,["responseLogprobs"],m);const _=u(e,["responseMimeType"]);_!=null&&p(t,["responseMimeType"],_);const y=u(e,["responseModalities"]);y!=null&&p(t,["responseModalities"],y);const v=u(e,["responseSchema"]);v!=null&&p(t,["responseSchema"],v);const C=u(e,["routingConfig"]);C!=null&&p(t,["routingConfig"],C);const w=u(e,["seed"]);w!=null&&p(t,["seed"],w);const b=u(e,["speechConfig"]);b!=null&&p(t,["speechConfig"],b);const f=u(e,["stopSequences"]);f!=null&&p(t,["stopSequences"],f);const T=u(e,["temperature"]);T!=null&&p(t,["temperature"],T);const I=u(e,["thinkingConfig"]);I!=null&&p(t,["thinkingConfig"],I);const E=u(e,["topK"]);E!=null&&p(t,["topK"],E);const R=u(e,["topP"]);if(R!=null&&p(t,["topP"],R),u(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function mS(e){const t={};if(u(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=u(e,["enableWidget"]);return n!=null&&p(t,["enableWidget"],n),t}function gS(e){const t={};if(u(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=u(e,["timeRangeFilter"]);return n!=null&&p(t,["timeRangeFilter"],n),t}function fS(e,t){const n={},r=u(e,["generationConfig"]);t!==void 0&&r!=null&&p(t,["setup","generationConfig"],r);const a=u(e,["responseModalities"]);t!==void 0&&a!=null&&p(t,["setup","generationConfig","responseModalities"],a);const i=u(e,["temperature"]);t!==void 0&&i!=null&&p(t,["setup","generationConfig","temperature"],i);const s=u(e,["topP"]);t!==void 0&&s!=null&&p(t,["setup","generationConfig","topP"],s);const l=u(e,["topK"]);t!==void 0&&l!=null&&p(t,["setup","generationConfig","topK"],l);const c=u(e,["maxOutputTokens"]);t!==void 0&&c!=null&&p(t,["setup","generationConfig","maxOutputTokens"],c);const d=u(e,["mediaResolution"]);t!==void 0&&d!=null&&p(t,["setup","generationConfig","mediaResolution"],d);const h=u(e,["seed"]);t!==void 0&&h!=null&&p(t,["setup","generationConfig","seed"],h);const g=u(e,["speechConfig"]);t!==void 0&&g!=null&&p(t,["setup","generationConfig","speechConfig"],Wu(g));const m=u(e,["thinkingConfig"]);t!==void 0&&m!=null&&p(t,["setup","generationConfig","thinkingConfig"],m);const _=u(e,["enableAffectiveDialog"]);t!==void 0&&_!=null&&p(t,["setup","generationConfig","enableAffectiveDialog"],_);const y=u(e,["systemInstruction"]);t!==void 0&&y!=null&&p(t,["setup","systemInstruction"],cS(Ln(y)));const v=u(e,["tools"]);if(t!==void 0&&v!=null){let E=Ba(v);Array.isArray(E)&&(E=E.map(R=>NS(Ha(R)))),p(t,["setup","tools"],E)}const C=u(e,["sessionResumption"]);t!==void 0&&C!=null&&p(t,["setup","sessionResumption"],ES(C));const w=u(e,["inputAudioTranscription"]);t!==void 0&&w!=null&&p(t,["setup","inputAudioTranscription"],w);const b=u(e,["outputAudioTranscription"]);t!==void 0&&b!=null&&p(t,["setup","outputAudioTranscription"],b);const f=u(e,["realtimeInputConfig"]);t!==void 0&&f!=null&&p(t,["setup","realtimeInputConfig"],f);const T=u(e,["contextWindowCompression"]);t!==void 0&&T!=null&&p(t,["setup","contextWindowCompression"],T);const I=u(e,["proactivity"]);if(t!==void 0&&I!=null&&p(t,["setup","proactivity"],I),u(e,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function yS(e,t){const n={},r=u(e,["generationConfig"]);t!==void 0&&r!=null&&p(t,["setup","generationConfig"],hS(r));const a=u(e,["responseModalities"]);t!==void 0&&a!=null&&p(t,["setup","generationConfig","responseModalities"],a);const i=u(e,["temperature"]);t!==void 0&&i!=null&&p(t,["setup","generationConfig","temperature"],i);const s=u(e,["topP"]);t!==void 0&&s!=null&&p(t,["setup","generationConfig","topP"],s);const l=u(e,["topK"]);t!==void 0&&l!=null&&p(t,["setup","generationConfig","topK"],l);const c=u(e,["maxOutputTokens"]);t!==void 0&&c!=null&&p(t,["setup","generationConfig","maxOutputTokens"],c);const d=u(e,["mediaResolution"]);t!==void 0&&d!=null&&p(t,["setup","generationConfig","mediaResolution"],d);const h=u(e,["seed"]);t!==void 0&&h!=null&&p(t,["setup","generationConfig","seed"],h);const g=u(e,["speechConfig"]);t!==void 0&&g!=null&&p(t,["setup","generationConfig","speechConfig"],Wu(g));const m=u(e,["thinkingConfig"]);t!==void 0&&m!=null&&p(t,["setup","generationConfig","thinkingConfig"],m);const _=u(e,["enableAffectiveDialog"]);t!==void 0&&_!=null&&p(t,["setup","generationConfig","enableAffectiveDialog"],_);const y=u(e,["systemInstruction"]);t!==void 0&&y!=null&&p(t,["setup","systemInstruction"],Ln(y));const v=u(e,["tools"]);if(t!==void 0&&v!=null){let R=Ba(v);Array.isArray(R)&&(R=R.map(N=>kS(Ha(N)))),p(t,["setup","tools"],R)}const C=u(e,["sessionResumption"]);t!==void 0&&C!=null&&p(t,["setup","sessionResumption"],C);const w=u(e,["inputAudioTranscription"]);t!==void 0&&w!=null&&p(t,["setup","inputAudioTranscription"],w);const b=u(e,["outputAudioTranscription"]);t!==void 0&&b!=null&&p(t,["setup","outputAudioTranscription"],b);const f=u(e,["realtimeInputConfig"]);t!==void 0&&f!=null&&p(t,["setup","realtimeInputConfig"],f);const T=u(e,["contextWindowCompression"]);t!==void 0&&T!=null&&p(t,["setup","contextWindowCompression"],T);const I=u(e,["proactivity"]);t!==void 0&&I!=null&&p(t,["setup","proactivity"],I);const E=u(e,["explicitVadSignal"]);return t!==void 0&&E!=null&&p(t,["setup","explicitVadSignal"],E),n}function xS(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["setup","model"],Nt(e,r));const a=u(t,["config"]);return a!=null&&p(n,["config"],fS(a,n)),n}function vS(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["setup","model"],Nt(e,r));const a=u(t,["config"]);return a!=null&&p(n,["config"],yS(a,n)),n}function bS(e){const t={},n=u(e,["musicGenerationConfig"]);return n!=null&&p(t,["musicGenerationConfig"],n),t}function wS(e){const t={},n=u(e,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),p(t,["weightedPrompts"],r)}return t}function _S(e){const t={},n=u(e,["media"]);if(n!=null){let d=Gf(n);Array.isArray(d)&&(d=d.map(h=>$s(h))),p(t,["mediaChunks"],d)}const r=u(e,["audio"]);r!=null&&p(t,["audio"],$s(Hf(r)));const a=u(e,["audioStreamEnd"]);a!=null&&p(t,["audioStreamEnd"],a);const i=u(e,["video"]);i!=null&&p(t,["video"],$s(Uf(i)));const s=u(e,["text"]);s!=null&&p(t,["text"],s);const l=u(e,["activityStart"]);l!=null&&p(t,["activityStart"],l);const c=u(e,["activityEnd"]);return c!=null&&p(t,["activityEnd"],c),t}function CS(e){const t={},n=u(e,["media"]);if(n!=null){let d=Gf(n);Array.isArray(d)&&(d=d.map(h=>h)),p(t,["mediaChunks"],d)}const r=u(e,["audio"]);r!=null&&p(t,["audio"],Hf(r));const a=u(e,["audioStreamEnd"]);a!=null&&p(t,["audioStreamEnd"],a);const i=u(e,["video"]);i!=null&&p(t,["video"],Uf(i));const s=u(e,["text"]);s!=null&&p(t,["text"],s);const l=u(e,["activityStart"]);l!=null&&p(t,["activityStart"],l);const c=u(e,["activityEnd"]);return c!=null&&p(t,["activityEnd"],c),t}function SS(e){const t={},n=u(e,["setupComplete"]);n!=null&&p(t,["setupComplete"],n);const r=u(e,["serverContent"]);r!=null&&p(t,["serverContent"],r);const a=u(e,["toolCall"]);a!=null&&p(t,["toolCall"],a);const i=u(e,["toolCallCancellation"]);i!=null&&p(t,["toolCallCancellation"],i);const s=u(e,["usageMetadata"]);s!=null&&p(t,["usageMetadata"],AS(s));const l=u(e,["goAway"]);l!=null&&p(t,["goAway"],l);const c=u(e,["sessionResumptionUpdate"]);c!=null&&p(t,["sessionResumptionUpdate"],c);const d=u(e,["voiceActivityDetectionSignal"]);return d!=null&&p(t,["voiceActivityDetectionSignal"],d),t}function TS(e){const t={},n=u(e,["mediaResolution"]);n!=null&&p(t,["mediaResolution"],n);const r=u(e,["codeExecutionResult"]);r!=null&&p(t,["codeExecutionResult"],r);const a=u(e,["executableCode"]);a!=null&&p(t,["executableCode"],a);const i=u(e,["fileData"]);i!=null&&p(t,["fileData"],dS(i));const s=u(e,["functionCall"]);s!=null&&p(t,["functionCall"],uS(s));const l=u(e,["functionResponse"]);l!=null&&p(t,["functionResponse"],l);const c=u(e,["inlineData"]);c!=null&&p(t,["inlineData"],$s(c));const d=u(e,["text"]);d!=null&&p(t,["text"],d);const h=u(e,["thought"]);h!=null&&p(t,["thought"],h);const g=u(e,["thoughtSignature"]);g!=null&&p(t,["thoughtSignature"],g);const m=u(e,["videoMetadata"]);return m!=null&&p(t,["videoMetadata"],m),t}function ES(e){const t={},n=u(e,["handle"]);if(n!=null&&p(t,["handle"],n),u(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function NS(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(g=>g)),p(t,["functionDeclarations"],h)}if(u(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=u(e,["googleSearchRetrieval"]);r!=null&&p(t,["googleSearchRetrieval"],r);const a=u(e,["computerUse"]);a!=null&&p(t,["computerUse"],a);const i=u(e,["fileSearch"]);i!=null&&p(t,["fileSearch"],i);const s=u(e,["codeExecution"]);if(s!=null&&p(t,["codeExecution"],s),u(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=u(e,["googleMaps"]);l!=null&&p(t,["googleMaps"],mS(l));const c=u(e,["googleSearch"]);c!=null&&p(t,["googleSearch"],gS(c));const d=u(e,["urlContext"]);return d!=null&&p(t,["urlContext"],d),t}function kS(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let g=n;Array.isArray(g)&&(g=g.map(m=>pS(m))),p(t,["functionDeclarations"],g)}const r=u(e,["retrieval"]);r!=null&&p(t,["retrieval"],r);const a=u(e,["googleSearchRetrieval"]);a!=null&&p(t,["googleSearchRetrieval"],a);const i=u(e,["computerUse"]);if(i!=null&&p(t,["computerUse"],i),u(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=u(e,["codeExecution"]);s!=null&&p(t,["codeExecution"],s);const l=u(e,["enterpriseWebSearch"]);l!=null&&p(t,["enterpriseWebSearch"],l);const c=u(e,["googleMaps"]);c!=null&&p(t,["googleMaps"],c);const d=u(e,["googleSearch"]);d!=null&&p(t,["googleSearch"],d);const h=u(e,["urlContext"]);return h!=null&&p(t,["urlContext"],h),t}function AS(e){const t={},n=u(e,["promptTokenCount"]);n!=null&&p(t,["promptTokenCount"],n);const r=u(e,["cachedContentTokenCount"]);r!=null&&p(t,["cachedContentTokenCount"],r);const a=u(e,["candidatesTokenCount"]);a!=null&&p(t,["responseTokenCount"],a);const i=u(e,["toolUsePromptTokenCount"]);i!=null&&p(t,["toolUsePromptTokenCount"],i);const s=u(e,["thoughtsTokenCount"]);s!=null&&p(t,["thoughtsTokenCount"],s);const l=u(e,["totalTokenCount"]);l!=null&&p(t,["totalTokenCount"],l);const c=u(e,["promptTokensDetails"]);if(c!=null){let _=c;Array.isArray(_)&&(_=_.map(y=>y)),p(t,["promptTokensDetails"],_)}const d=u(e,["cacheTokensDetails"]);if(d!=null){let _=d;Array.isArray(_)&&(_=_.map(y=>y)),p(t,["cacheTokensDetails"],_)}const h=u(e,["candidatesTokensDetails"]);if(h!=null){let _=h;Array.isArray(_)&&(_=_.map(y=>y)),p(t,["responseTokensDetails"],_)}const g=u(e,["toolUsePromptTokensDetails"]);if(g!=null){let _=g;Array.isArray(_)&&(_=_.map(y=>y)),p(t,["toolUsePromptTokensDetails"],_)}const m=u(e,["trafficType"]);return m!=null&&p(t,["trafficType"],m),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function IS(e){const t={},n=u(e,["data"]);if(n!=null&&p(t,["data"],n),u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function PS(e){const t={},n=u(e,["content"]);n!=null&&p(t,["content"],n);const r=u(e,["citationMetadata"]);r!=null&&p(t,["citationMetadata"],RS(r));const a=u(e,["tokenCount"]);a!=null&&p(t,["tokenCount"],a);const i=u(e,["finishReason"]);i!=null&&p(t,["finishReason"],i);const s=u(e,["avgLogprobs"]);s!=null&&p(t,["avgLogprobs"],s);const l=u(e,["groundingMetadata"]);l!=null&&p(t,["groundingMetadata"],l);const c=u(e,["index"]);c!=null&&p(t,["index"],c);const d=u(e,["logprobsResult"]);d!=null&&p(t,["logprobsResult"],d);const h=u(e,["safetyRatings"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(_=>_)),p(t,["safetyRatings"],m)}const g=u(e,["urlContextMetadata"]);return g!=null&&p(t,["urlContextMetadata"],g),t}function RS(e){const t={},n=u(e,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>a)),p(t,["citations"],r)}return t}function MS(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["contents"]);if(a!=null){let i=ho(a);Array.isArray(i)&&(i=i.map(s=>s)),p(n,["contents"],i)}return n}function jS(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["tokensInfo"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),p(t,["tokensInfo"],a)}return t}function LS(e){const t={},n=u(e,["values"]);n!=null&&p(t,["values"],n);const r=u(e,["statistics"]);return r!=null&&p(t,["statistics"],DS(r)),t}function DS(e){const t={},n=u(e,["truncated"]);n!=null&&p(t,["truncated"],n);const r=u(e,["token_count"]);return r!=null&&p(t,["tokenCount"],r),t}function Ul(e){const t={},n=u(e,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(i=>$T(i))),p(t,["parts"],a)}const r=u(e,["role"]);return r!=null&&p(t,["role"],r),t}function OS(e){const t={},n=u(e,["controlType"]);n!=null&&p(t,["controlType"],n);const r=u(e,["enableControlImageComputation"]);return r!=null&&p(t,["computeControl"],r),t}function FS(e){const t={};if(u(e,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(u(e,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(u(e,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function zS(e,t){const n={},r=u(e,["systemInstruction"]);t!==void 0&&r!=null&&p(t,["systemInstruction"],Ln(r));const a=u(e,["tools"]);if(t!==void 0&&a!=null){let s=a;Array.isArray(s)&&(s=s.map(l=>ny(l))),p(t,["tools"],s)}const i=u(e,["generationConfig"]);return t!==void 0&&i!=null&&p(t,["generationConfig"],IT(i)),n}function GS(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["contents"]);if(a!=null){let s=ho(a);Array.isArray(s)&&(s=s.map(l=>Ul(l))),p(n,["contents"],s)}const i=u(t,["config"]);return i!=null&&FS(i),n}function US(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["contents"]);if(a!=null){let s=ho(a);Array.isArray(s)&&(s=s.map(l=>l)),p(n,["contents"],s)}const i=u(t,["config"]);return i!=null&&zS(i,n),n}function HS(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["totalTokens"]);r!=null&&p(t,["totalTokens"],r);const a=u(e,["cachedContentTokenCount"]);return a!=null&&p(t,["cachedContentTokenCount"],a),t}function BS(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["totalTokens"]);return r!=null&&p(t,["totalTokens"],r),t}function VS(e,t){const n={},r=u(t,["model"]);return r!=null&&p(n,["_url","name"],Nt(e,r)),n}function $S(e,t){const n={},r=u(t,["model"]);return r!=null&&p(n,["_url","name"],Nt(e,r)),n}function WS(e){const t={},n=u(e,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function YS(e){const t={},n=u(e,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}function qS(e,t){const n={},r=u(e,["outputGcsUri"]);t!==void 0&&r!=null&&p(t,["parameters","storageUri"],r);const a=u(e,["negativePrompt"]);t!==void 0&&a!=null&&p(t,["parameters","negativePrompt"],a);const i=u(e,["numberOfImages"]);t!==void 0&&i!=null&&p(t,["parameters","sampleCount"],i);const s=u(e,["aspectRatio"]);t!==void 0&&s!=null&&p(t,["parameters","aspectRatio"],s);const l=u(e,["guidanceScale"]);t!==void 0&&l!=null&&p(t,["parameters","guidanceScale"],l);const c=u(e,["seed"]);t!==void 0&&c!=null&&p(t,["parameters","seed"],c);const d=u(e,["safetyFilterLevel"]);t!==void 0&&d!=null&&p(t,["parameters","safetySetting"],d);const h=u(e,["personGeneration"]);t!==void 0&&h!=null&&p(t,["parameters","personGeneration"],h);const g=u(e,["includeSafetyAttributes"]);t!==void 0&&g!=null&&p(t,["parameters","includeSafetyAttributes"],g);const m=u(e,["includeRaiReason"]);t!==void 0&&m!=null&&p(t,["parameters","includeRaiReason"],m);const _=u(e,["language"]);t!==void 0&&_!=null&&p(t,["parameters","language"],_);const y=u(e,["outputMimeType"]);t!==void 0&&y!=null&&p(t,["parameters","outputOptions","mimeType"],y);const v=u(e,["outputCompressionQuality"]);t!==void 0&&v!=null&&p(t,["parameters","outputOptions","compressionQuality"],v);const C=u(e,["addWatermark"]);t!==void 0&&C!=null&&p(t,["parameters","addWatermark"],C);const w=u(e,["labels"]);t!==void 0&&w!=null&&p(t,["labels"],w);const b=u(e,["editMode"]);t!==void 0&&b!=null&&p(t,["parameters","editMode"],b);const f=u(e,["baseSteps"]);return t!==void 0&&f!=null&&p(t,["parameters","editConfig","baseSteps"],f),n}function KS(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["prompt"]);a!=null&&p(n,["instances[0]","prompt"],a);const i=u(t,["referenceImages"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>XT(c))),p(n,["instances[0]","referenceImages"],l)}const s=u(t,["config"]);return s!=null&&qS(s,n),n}function JS(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>Hl(i))),p(t,["generatedImages"],a)}return t}function XS(e,t){const n={},r=u(e,["taskType"]);t!==void 0&&r!=null&&p(t,["requests[]","taskType"],r);const a=u(e,["title"]);t!==void 0&&a!=null&&p(t,["requests[]","title"],a);const i=u(e,["outputDimensionality"]);if(t!==void 0&&i!=null&&p(t,["requests[]","outputDimensionality"],i),u(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(u(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function ZS(e,t){const n={},r=u(e,["taskType"]);t!==void 0&&r!=null&&p(t,["instances[]","task_type"],r);const a=u(e,["title"]);t!==void 0&&a!=null&&p(t,["instances[]","title"],a);const i=u(e,["outputDimensionality"]);t!==void 0&&i!=null&&p(t,["parameters","outputDimensionality"],i);const s=u(e,["mimeType"]);t!==void 0&&s!=null&&p(t,["instances[]","mimeType"],s);const l=u(e,["autoTruncate"]);return t!==void 0&&l!=null&&p(t,["parameters","autoTruncate"],l),n}function QS(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["contents"]);if(a!=null){let l=Bu(e,a);Array.isArray(l)&&(l=l.map(c=>c)),p(n,["requests[]","content"],l)}const i=u(t,["config"]);i!=null&&XS(i,n);const s=u(t,["model"]);return s!==void 0&&p(n,["requests[]","model"],Nt(e,s)),n}function eT(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["contents"]);if(a!=null){let s=Bu(e,a);Array.isArray(s)&&(s=s.map(l=>l)),p(n,["instances[]","content"],s)}const i=u(t,["config"]);return i!=null&&ZS(i,n),n}function tT(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["embeddings"],i)}const a=u(e,["metadata"]);return a!=null&&p(t,["metadata"],a),t}function nT(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["predictions[]","embeddings"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>LS(s))),p(t,["embeddings"],i)}const a=u(e,["metadata"]);return a!=null&&p(t,["metadata"],a),t}function oT(e){const t={},n=u(e,["endpoint"]);n!=null&&p(t,["name"],n);const r=u(e,["deployedModelId"]);return r!=null&&p(t,["deployedModelId"],r),t}function rT(e){const t={};if(u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=u(e,["fileUri"]);n!=null&&p(t,["fileUri"],n);const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function aT(e){const t={},n=u(e,["id"]);n!=null&&p(t,["id"],n);const r=u(e,["args"]);r!=null&&p(t,["args"],r);const a=u(e,["name"]);if(a!=null&&p(t,["name"],a),u(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function iT(e){const t={},n=u(e,["mode"]);n!=null&&p(t,["mode"],n);const r=u(e,["allowedFunctionNames"]);if(r!=null&&p(t,["allowedFunctionNames"],r),u(e,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function sT(e){const t={};if(u(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=u(e,["description"]);n!=null&&p(t,["description"],n);const r=u(e,["name"]);r!=null&&p(t,["name"],r);const a=u(e,["parameters"]);a!=null&&p(t,["parameters"],a);const i=u(e,["parametersJsonSchema"]);i!=null&&p(t,["parametersJsonSchema"],i);const s=u(e,["response"]);s!=null&&p(t,["response"],s);const l=u(e,["responseJsonSchema"]);return l!=null&&p(t,["responseJsonSchema"],l),t}function lT(e,t,n){const r={},a=u(t,["systemInstruction"]);n!==void 0&&a!=null&&p(n,["systemInstruction"],Ul(Ln(a)));const i=u(t,["temperature"]);i!=null&&p(r,["temperature"],i);const s=u(t,["topP"]);s!=null&&p(r,["topP"],s);const l=u(t,["topK"]);l!=null&&p(r,["topK"],l);const c=u(t,["candidateCount"]);c!=null&&p(r,["candidateCount"],c);const d=u(t,["maxOutputTokens"]);d!=null&&p(r,["maxOutputTokens"],d);const h=u(t,["stopSequences"]);h!=null&&p(r,["stopSequences"],h);const g=u(t,["responseLogprobs"]);g!=null&&p(r,["responseLogprobs"],g);const m=u(t,["logprobs"]);m!=null&&p(r,["logprobs"],m);const _=u(t,["presencePenalty"]);_!=null&&p(r,["presencePenalty"],_);const y=u(t,["frequencyPenalty"]);y!=null&&p(r,["frequencyPenalty"],y);const v=u(t,["seed"]);v!=null&&p(r,["seed"],v);const C=u(t,["responseMimeType"]);C!=null&&p(r,["responseMimeType"],C);const w=u(t,["responseSchema"]);w!=null&&p(r,["responseSchema"],Vu(w));const b=u(t,["responseJsonSchema"]);if(b!=null&&p(r,["responseJsonSchema"],b),u(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(u(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const f=u(t,["safetySettings"]);if(n!==void 0&&f!=null){let H=f;Array.isArray(H)&&(H=H.map(W=>ZT(W))),p(n,["safetySettings"],H)}const T=u(t,["tools"]);if(n!==void 0&&T!=null){let H=Ba(T);Array.isArray(H)&&(H=H.map(W=>aE(Ha(W)))),p(n,["tools"],H)}const I=u(t,["toolConfig"]);if(n!==void 0&&I!=null&&p(n,["toolConfig"],rE(I)),u(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const E=u(t,["cachedContent"]);n!==void 0&&E!=null&&p(n,["cachedContent"],nr(e,E));const R=u(t,["responseModalities"]);R!=null&&p(r,["responseModalities"],R);const N=u(t,["mediaResolution"]);N!=null&&p(r,["mediaResolution"],N);const A=u(t,["speechConfig"]);if(A!=null&&p(r,["speechConfig"],$u(A)),u(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const k=u(t,["thinkingConfig"]);k!=null&&p(r,["thinkingConfig"],k);const P=u(t,["imageConfig"]);P!=null&&p(r,["imageConfig"],LT(P));const M=u(t,["enableEnhancedCivicAnswers"]);return M!=null&&p(r,["enableEnhancedCivicAnswers"],M),r}function cT(e,t,n){const r={},a=u(t,["systemInstruction"]);n!==void 0&&a!=null&&p(n,["systemInstruction"],Ln(a));const i=u(t,["temperature"]);i!=null&&p(r,["temperature"],i);const s=u(t,["topP"]);s!=null&&p(r,["topP"],s);const l=u(t,["topK"]);l!=null&&p(r,["topK"],l);const c=u(t,["candidateCount"]);c!=null&&p(r,["candidateCount"],c);const d=u(t,["maxOutputTokens"]);d!=null&&p(r,["maxOutputTokens"],d);const h=u(t,["stopSequences"]);h!=null&&p(r,["stopSequences"],h);const g=u(t,["responseLogprobs"]);g!=null&&p(r,["responseLogprobs"],g);const m=u(t,["logprobs"]);m!=null&&p(r,["logprobs"],m);const _=u(t,["presencePenalty"]);_!=null&&p(r,["presencePenalty"],_);const y=u(t,["frequencyPenalty"]);y!=null&&p(r,["frequencyPenalty"],y);const v=u(t,["seed"]);v!=null&&p(r,["seed"],v);const C=u(t,["responseMimeType"]);C!=null&&p(r,["responseMimeType"],C);const w=u(t,["responseSchema"]);w!=null&&p(r,["responseSchema"],Vu(w));const b=u(t,["responseJsonSchema"]);b!=null&&p(r,["responseJsonSchema"],b);const f=u(t,["routingConfig"]);f!=null&&p(r,["routingConfig"],f);const T=u(t,["modelSelectionConfig"]);T!=null&&p(r,["modelConfig"],T);const I=u(t,["safetySettings"]);if(n!==void 0&&I!=null){let U=I;Array.isArray(U)&&(U=U.map(z=>z)),p(n,["safetySettings"],U)}const E=u(t,["tools"]);if(n!==void 0&&E!=null){let U=Ba(E);Array.isArray(U)&&(U=U.map(z=>ny(Ha(z)))),p(n,["tools"],U)}const R=u(t,["toolConfig"]);n!==void 0&&R!=null&&p(n,["toolConfig"],R);const N=u(t,["labels"]);n!==void 0&&N!=null&&p(n,["labels"],N);const A=u(t,["cachedContent"]);n!==void 0&&A!=null&&p(n,["cachedContent"],nr(e,A));const k=u(t,["responseModalities"]);k!=null&&p(r,["responseModalities"],k);const P=u(t,["mediaResolution"]);P!=null&&p(r,["mediaResolution"],P);const M=u(t,["speechConfig"]);M!=null&&p(r,["speechConfig"],$u(M));const H=u(t,["audioTimestamp"]);H!=null&&p(r,["audioTimestamp"],H);const W=u(t,["thinkingConfig"]);W!=null&&p(r,["thinkingConfig"],W);const O=u(t,["imageConfig"]);if(O!=null&&p(r,["imageConfig"],DT(O)),u(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return r}function qm(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["contents"]);if(a!=null){let s=ho(a);Array.isArray(s)&&(s=s.map(l=>Ul(l))),p(n,["contents"],s)}const i=u(t,["config"]);return i!=null&&p(n,["generationConfig"],lT(e,i,n)),n}function Km(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["contents"]);if(a!=null){let s=ho(a);Array.isArray(s)&&(s=s.map(l=>l)),p(n,["contents"],s)}const i=u(t,["config"]);return i!=null&&p(n,["generationConfig"],cT(e,i,n)),n}function Jm(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["candidates"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>PS(d))),p(t,["candidates"],c)}const a=u(e,["modelVersion"]);a!=null&&p(t,["modelVersion"],a);const i=u(e,["promptFeedback"]);i!=null&&p(t,["promptFeedback"],i);const s=u(e,["responseId"]);s!=null&&p(t,["responseId"],s);const l=u(e,["usageMetadata"]);return l!=null&&p(t,["usageMetadata"],l),t}function Xm(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["candidates"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(h=>h)),p(t,["candidates"],d)}const a=u(e,["createTime"]);a!=null&&p(t,["createTime"],a);const i=u(e,["modelVersion"]);i!=null&&p(t,["modelVersion"],i);const s=u(e,["promptFeedback"]);s!=null&&p(t,["promptFeedback"],s);const l=u(e,["responseId"]);l!=null&&p(t,["responseId"],l);const c=u(e,["usageMetadata"]);return c!=null&&p(t,["usageMetadata"],c),t}function dT(e,t){const n={};if(u(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(u(e,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=u(e,["numberOfImages"]);t!==void 0&&r!=null&&p(t,["parameters","sampleCount"],r);const a=u(e,["aspectRatio"]);t!==void 0&&a!=null&&p(t,["parameters","aspectRatio"],a);const i=u(e,["guidanceScale"]);if(t!==void 0&&i!=null&&p(t,["parameters","guidanceScale"],i),u(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=u(e,["safetyFilterLevel"]);t!==void 0&&s!=null&&p(t,["parameters","safetySetting"],s);const l=u(e,["personGeneration"]);t!==void 0&&l!=null&&p(t,["parameters","personGeneration"],l);const c=u(e,["includeSafetyAttributes"]);t!==void 0&&c!=null&&p(t,["parameters","includeSafetyAttributes"],c);const d=u(e,["includeRaiReason"]);t!==void 0&&d!=null&&p(t,["parameters","includeRaiReason"],d);const h=u(e,["language"]);t!==void 0&&h!=null&&p(t,["parameters","language"],h);const g=u(e,["outputMimeType"]);t!==void 0&&g!=null&&p(t,["parameters","outputOptions","mimeType"],g);const m=u(e,["outputCompressionQuality"]);if(t!==void 0&&m!=null&&p(t,["parameters","outputOptions","compressionQuality"],m),u(e,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(u(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const _=u(e,["imageSize"]);if(t!==void 0&&_!=null&&p(t,["parameters","sampleImageSize"],_),u(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function uT(e,t){const n={},r=u(e,["outputGcsUri"]);t!==void 0&&r!=null&&p(t,["parameters","storageUri"],r);const a=u(e,["negativePrompt"]);t!==void 0&&a!=null&&p(t,["parameters","negativePrompt"],a);const i=u(e,["numberOfImages"]);t!==void 0&&i!=null&&p(t,["parameters","sampleCount"],i);const s=u(e,["aspectRatio"]);t!==void 0&&s!=null&&p(t,["parameters","aspectRatio"],s);const l=u(e,["guidanceScale"]);t!==void 0&&l!=null&&p(t,["parameters","guidanceScale"],l);const c=u(e,["seed"]);t!==void 0&&c!=null&&p(t,["parameters","seed"],c);const d=u(e,["safetyFilterLevel"]);t!==void 0&&d!=null&&p(t,["parameters","safetySetting"],d);const h=u(e,["personGeneration"]);t!==void 0&&h!=null&&p(t,["parameters","personGeneration"],h);const g=u(e,["includeSafetyAttributes"]);t!==void 0&&g!=null&&p(t,["parameters","includeSafetyAttributes"],g);const m=u(e,["includeRaiReason"]);t!==void 0&&m!=null&&p(t,["parameters","includeRaiReason"],m);const _=u(e,["language"]);t!==void 0&&_!=null&&p(t,["parameters","language"],_);const y=u(e,["outputMimeType"]);t!==void 0&&y!=null&&p(t,["parameters","outputOptions","mimeType"],y);const v=u(e,["outputCompressionQuality"]);t!==void 0&&v!=null&&p(t,["parameters","outputOptions","compressionQuality"],v);const C=u(e,["addWatermark"]);t!==void 0&&C!=null&&p(t,["parameters","addWatermark"],C);const w=u(e,["labels"]);t!==void 0&&w!=null&&p(t,["labels"],w);const b=u(e,["imageSize"]);t!==void 0&&b!=null&&p(t,["parameters","sampleImageSize"],b);const f=u(e,["enhancePrompt"]);return t!==void 0&&f!=null&&p(t,["parameters","enhancePrompt"],f),n}function pT(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["prompt"]);a!=null&&p(n,["instances[0]","prompt"],a);const i=u(t,["config"]);return i!=null&&dT(i,n),n}function hT(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["prompt"]);a!=null&&p(n,["instances[0]","prompt"],a);const i=u(t,["config"]);return i!=null&&uT(i,n),n}function mT(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>ET(s))),p(t,["generatedImages"],i)}const a=u(e,["positivePromptSafetyAttributes"]);return a!=null&&p(t,["positivePromptSafetyAttributes"],ey(a)),t}function gT(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>Hl(s))),p(t,["generatedImages"],i)}const a=u(e,["positivePromptSafetyAttributes"]);return a!=null&&p(t,["positivePromptSafetyAttributes"],ty(a)),t}function fT(e,t){const n={},r=u(e,["numberOfVideos"]);if(t!==void 0&&r!=null&&p(t,["parameters","sampleCount"],r),u(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(u(e,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const a=u(e,["durationSeconds"]);if(t!==void 0&&a!=null&&p(t,["parameters","durationSeconds"],a),u(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const i=u(e,["aspectRatio"]);t!==void 0&&i!=null&&p(t,["parameters","aspectRatio"],i);const s=u(e,["resolution"]);t!==void 0&&s!=null&&p(t,["parameters","resolution"],s);const l=u(e,["personGeneration"]);if(t!==void 0&&l!=null&&p(t,["parameters","personGeneration"],l),u(e,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=u(e,["negativePrompt"]);t!==void 0&&c!=null&&p(t,["parameters","negativePrompt"],c);const d=u(e,["enhancePrompt"]);if(t!==void 0&&d!=null&&p(t,["parameters","enhancePrompt"],d),u(e,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const h=u(e,["lastFrame"]);t!==void 0&&h!=null&&p(t,["instances[0]","lastFrame"],Bl(h));const g=u(e,["referenceImages"]);if(t!==void 0&&g!=null){let m=g;Array.isArray(m)&&(m=m.map(_=>xE(_))),p(t,["instances[0]","referenceImages"],m)}if(u(e,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(u(e,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function yT(e,t){const n={},r=u(e,["numberOfVideos"]);t!==void 0&&r!=null&&p(t,["parameters","sampleCount"],r);const a=u(e,["outputGcsUri"]);t!==void 0&&a!=null&&p(t,["parameters","storageUri"],a);const i=u(e,["fps"]);t!==void 0&&i!=null&&p(t,["parameters","fps"],i);const s=u(e,["durationSeconds"]);t!==void 0&&s!=null&&p(t,["parameters","durationSeconds"],s);const l=u(e,["seed"]);t!==void 0&&l!=null&&p(t,["parameters","seed"],l);const c=u(e,["aspectRatio"]);t!==void 0&&c!=null&&p(t,["parameters","aspectRatio"],c);const d=u(e,["resolution"]);t!==void 0&&d!=null&&p(t,["parameters","resolution"],d);const h=u(e,["personGeneration"]);t!==void 0&&h!=null&&p(t,["parameters","personGeneration"],h);const g=u(e,["pubsubTopic"]);t!==void 0&&g!=null&&p(t,["parameters","pubsubTopic"],g);const m=u(e,["negativePrompt"]);t!==void 0&&m!=null&&p(t,["parameters","negativePrompt"],m);const _=u(e,["enhancePrompt"]);t!==void 0&&_!=null&&p(t,["parameters","enhancePrompt"],_);const y=u(e,["generateAudio"]);t!==void 0&&y!=null&&p(t,["parameters","generateAudio"],y);const v=u(e,["lastFrame"]);t!==void 0&&v!=null&&p(t,["instances[0]","lastFrame"],Io(v));const C=u(e,["referenceImages"]);if(t!==void 0&&C!=null){let f=C;Array.isArray(f)&&(f=f.map(T=>vE(T))),p(t,["instances[0]","referenceImages"],f)}const w=u(e,["mask"]);t!==void 0&&w!=null&&p(t,["instances[0]","mask"],yE(w));const b=u(e,["compressionQuality"]);return t!==void 0&&b!=null&&p(t,["parameters","compressionQuality"],b),n}function xT(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["response","generateVideoResponse"]);return s!=null&&p(t,["response"],_T(s)),t}function vT(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["response"]);return s!=null&&p(t,["response"],CT(s)),t}function bT(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["prompt"]);a!=null&&p(n,["instances[0]","prompt"],a);const i=u(t,["image"]);i!=null&&p(n,["instances[0]","image"],Bl(i));const s=u(t,["video"]);s!=null&&p(n,["instances[0]","video"],oy(s));const l=u(t,["source"]);l!=null&&ST(l,n);const c=u(t,["config"]);return c!=null&&fT(c,n),n}function wT(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["prompt"]);a!=null&&p(n,["instances[0]","prompt"],a);const i=u(t,["image"]);i!=null&&p(n,["instances[0]","image"],Io(i));const s=u(t,["video"]);s!=null&&p(n,["instances[0]","video"],ry(s));const l=u(t,["source"]);l!=null&&TT(l,n);const c=u(t,["config"]);return c!=null&&yT(c,n),n}function _T(e){const t={},n=u(e,["generatedSamples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>kT(s))),p(t,["generatedVideos"],i)}const r=u(e,["raiMediaFilteredCount"]);r!=null&&p(t,["raiMediaFilteredCount"],r);const a=u(e,["raiMediaFilteredReasons"]);return a!=null&&p(t,["raiMediaFilteredReasons"],a),t}function CT(e){const t={},n=u(e,["videos"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(s=>AT(s))),p(t,["generatedVideos"],i)}const r=u(e,["raiMediaFilteredCount"]);r!=null&&p(t,["raiMediaFilteredCount"],r);const a=u(e,["raiMediaFilteredReasons"]);return a!=null&&p(t,["raiMediaFilteredReasons"],a),t}function ST(e,t){const n={},r=u(e,["prompt"]);t!==void 0&&r!=null&&p(t,["instances[0]","prompt"],r);const a=u(e,["image"]);t!==void 0&&a!=null&&p(t,["instances[0]","image"],Bl(a));const i=u(e,["video"]);return t!==void 0&&i!=null&&p(t,["instances[0]","video"],oy(i)),n}function TT(e,t){const n={},r=u(e,["prompt"]);t!==void 0&&r!=null&&p(t,["instances[0]","prompt"],r);const a=u(e,["image"]);t!==void 0&&a!=null&&p(t,["instances[0]","image"],Io(a));const i=u(e,["video"]);return t!==void 0&&i!=null&&p(t,["instances[0]","video"],ry(i)),n}function ET(e){const t={},n=u(e,["_self"]);n!=null&&p(t,["image"],OT(n));const r=u(e,["raiFilteredReason"]);r!=null&&p(t,["raiFilteredReason"],r);const a=u(e,["_self"]);return a!=null&&p(t,["safetyAttributes"],ey(a)),t}function Hl(e){const t={},n=u(e,["_self"]);n!=null&&p(t,["image"],Qf(n));const r=u(e,["raiFilteredReason"]);r!=null&&p(t,["raiFilteredReason"],r);const a=u(e,["_self"]);a!=null&&p(t,["safetyAttributes"],ty(a));const i=u(e,["prompt"]);return i!=null&&p(t,["enhancedPrompt"],i),t}function NT(e){const t={},n=u(e,["_self"]);n!=null&&p(t,["mask"],Qf(n));const r=u(e,["labels"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),p(t,["labels"],a)}return t}function kT(e){const t={},n=u(e,["video"]);return n!=null&&p(t,["video"],gE(n)),t}function AT(e){const t={},n=u(e,["_self"]);return n!=null&&p(t,["video"],fE(n)),t}function IT(e){const t={},n=u(e,["modelSelectionConfig"]);n!=null&&p(t,["modelConfig"],n);const r=u(e,["responseJsonSchema"]);r!=null&&p(t,["responseJsonSchema"],r);const a=u(e,["audioTimestamp"]);a!=null&&p(t,["audioTimestamp"],a);const i=u(e,["candidateCount"]);i!=null&&p(t,["candidateCount"],i);const s=u(e,["enableAffectiveDialog"]);s!=null&&p(t,["enableAffectiveDialog"],s);const l=u(e,["frequencyPenalty"]);l!=null&&p(t,["frequencyPenalty"],l);const c=u(e,["logprobs"]);c!=null&&p(t,["logprobs"],c);const d=u(e,["maxOutputTokens"]);d!=null&&p(t,["maxOutputTokens"],d);const h=u(e,["mediaResolution"]);h!=null&&p(t,["mediaResolution"],h);const g=u(e,["presencePenalty"]);g!=null&&p(t,["presencePenalty"],g);const m=u(e,["responseLogprobs"]);m!=null&&p(t,["responseLogprobs"],m);const _=u(e,["responseMimeType"]);_!=null&&p(t,["responseMimeType"],_);const y=u(e,["responseModalities"]);y!=null&&p(t,["responseModalities"],y);const v=u(e,["responseSchema"]);v!=null&&p(t,["responseSchema"],v);const C=u(e,["routingConfig"]);C!=null&&p(t,["routingConfig"],C);const w=u(e,["seed"]);w!=null&&p(t,["seed"],w);const b=u(e,["speechConfig"]);b!=null&&p(t,["speechConfig"],b);const f=u(e,["stopSequences"]);f!=null&&p(t,["stopSequences"],f);const T=u(e,["temperature"]);T!=null&&p(t,["temperature"],T);const I=u(e,["thinkingConfig"]);I!=null&&p(t,["thinkingConfig"],I);const E=u(e,["topK"]);E!=null&&p(t,["topK"],E);const R=u(e,["topP"]);if(R!=null&&p(t,["topP"],R),u(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function PT(e,t){const n={},r=u(t,["model"]);return r!=null&&p(n,["_url","name"],Nt(e,r)),n}function RT(e,t){const n={},r=u(t,["model"]);return r!=null&&p(n,["_url","name"],Nt(e,r)),n}function MT(e){const t={};if(u(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=u(e,["enableWidget"]);return n!=null&&p(t,["enableWidget"],n),t}function jT(e){const t={};if(u(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=u(e,["timeRangeFilter"]);return n!=null&&p(t,["timeRangeFilter"],n),t}function LT(e){const t={},n=u(e,["aspectRatio"]);n!=null&&p(t,["aspectRatio"],n);const r=u(e,["imageSize"]);if(r!=null&&p(t,["imageSize"],r),u(e,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(u(e,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function DT(e){const t={},n=u(e,["aspectRatio"]);n!=null&&p(t,["aspectRatio"],n);const r=u(e,["imageSize"]);r!=null&&p(t,["imageSize"],r);const a=u(e,["outputMimeType"]);a!=null&&p(t,["imageOutputOptions","mimeType"],a);const i=u(e,["outputCompressionQuality"]);return i!=null&&p(t,["imageOutputOptions","compressionQuality"],i),t}function OT(e){const t={},n=u(e,["bytesBase64Encoded"]);n!=null&&p(t,["imageBytes"],Ar(n));const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function Qf(e){const t={},n=u(e,["gcsUri"]);n!=null&&p(t,["gcsUri"],n);const r=u(e,["bytesBase64Encoded"]);r!=null&&p(t,["imageBytes"],Ar(r));const a=u(e,["mimeType"]);return a!=null&&p(t,["mimeType"],a),t}function Bl(e){const t={};if(u(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=u(e,["imageBytes"]);n!=null&&p(t,["bytesBase64Encoded"],Ar(n));const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function Io(e){const t={},n=u(e,["gcsUri"]);n!=null&&p(t,["gcsUri"],n);const r=u(e,["imageBytes"]);r!=null&&p(t,["bytesBase64Encoded"],Ar(r));const a=u(e,["mimeType"]);return a!=null&&p(t,["mimeType"],a),t}function FT(e,t,n){const r={},a=u(t,["pageSize"]);n!==void 0&&a!=null&&p(n,["_query","pageSize"],a);const i=u(t,["pageToken"]);n!==void 0&&i!=null&&p(n,["_query","pageToken"],i);const s=u(t,["filter"]);n!==void 0&&s!=null&&p(n,["_query","filter"],s);const l=u(t,["queryBase"]);return n!==void 0&&l!=null&&p(n,["_url","models_url"],Wf(e,l)),r}function zT(e,t,n){const r={},a=u(t,["pageSize"]);n!==void 0&&a!=null&&p(n,["_query","pageSize"],a);const i=u(t,["pageToken"]);n!==void 0&&i!=null&&p(n,["_query","pageToken"],i);const s=u(t,["filter"]);n!==void 0&&s!=null&&p(n,["_query","filter"],s);const l=u(t,["queryBase"]);return n!==void 0&&l!=null&&p(n,["_url","models_url"],Wf(e,l)),r}function GT(e,t){const n={},r=u(t,["config"]);return r!=null&&FT(e,r,n),n}function UT(e,t){const n={},r=u(t,["config"]);return r!=null&&zT(e,r,n),n}function HT(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["_self"]);if(a!=null){let i=Yf(a);Array.isArray(i)&&(i=i.map(s=>Ld(s))),p(t,["models"],i)}return t}function BT(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["_self"]);if(a!=null){let i=Yf(a);Array.isArray(i)&&(i=i.map(s=>Dd(s))),p(t,["models"],i)}return t}function VT(e){const t={},n=u(e,["maskMode"]);n!=null&&p(t,["maskMode"],n);const r=u(e,["segmentationClasses"]);r!=null&&p(t,["maskClasses"],r);const a=u(e,["maskDilation"]);return a!=null&&p(t,["dilation"],a),t}function Ld(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["displayName"]);r!=null&&p(t,["displayName"],r);const a=u(e,["description"]);a!=null&&p(t,["description"],a);const i=u(e,["version"]);i!=null&&p(t,["version"],i);const s=u(e,["_self"]);s!=null&&p(t,["tunedModelInfo"],iE(s));const l=u(e,["inputTokenLimit"]);l!=null&&p(t,["inputTokenLimit"],l);const c=u(e,["outputTokenLimit"]);c!=null&&p(t,["outputTokenLimit"],c);const d=u(e,["supportedGenerationMethods"]);d!=null&&p(t,["supportedActions"],d);const h=u(e,["temperature"]);h!=null&&p(t,["temperature"],h);const g=u(e,["maxTemperature"]);g!=null&&p(t,["maxTemperature"],g);const m=u(e,["topP"]);m!=null&&p(t,["topP"],m);const _=u(e,["topK"]);_!=null&&p(t,["topK"],_);const y=u(e,["thinking"]);return y!=null&&p(t,["thinking"],y),t}function Dd(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["displayName"]);r!=null&&p(t,["displayName"],r);const a=u(e,["description"]);a!=null&&p(t,["description"],a);const i=u(e,["versionId"]);i!=null&&p(t,["version"],i);const s=u(e,["deployedModels"]);if(s!=null){let g=s;Array.isArray(g)&&(g=g.map(m=>oT(m))),p(t,["endpoints"],g)}const l=u(e,["labels"]);l!=null&&p(t,["labels"],l);const c=u(e,["_self"]);c!=null&&p(t,["tunedModelInfo"],sE(c));const d=u(e,["defaultCheckpointId"]);d!=null&&p(t,["defaultCheckpointId"],d);const h=u(e,["checkpoints"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(m=>m)),p(t,["checkpoints"],g)}return t}function $T(e){const t={},n=u(e,["mediaResolution"]);n!=null&&p(t,["mediaResolution"],n);const r=u(e,["codeExecutionResult"]);r!=null&&p(t,["codeExecutionResult"],r);const a=u(e,["executableCode"]);a!=null&&p(t,["executableCode"],a);const i=u(e,["fileData"]);i!=null&&p(t,["fileData"],rT(i));const s=u(e,["functionCall"]);s!=null&&p(t,["functionCall"],aT(s));const l=u(e,["functionResponse"]);l!=null&&p(t,["functionResponse"],l);const c=u(e,["inlineData"]);c!=null&&p(t,["inlineData"],IS(c));const d=u(e,["text"]);d!=null&&p(t,["text"],d);const h=u(e,["thought"]);h!=null&&p(t,["thought"],h);const g=u(e,["thoughtSignature"]);g!=null&&p(t,["thoughtSignature"],g);const m=u(e,["videoMetadata"]);return m!=null&&p(t,["videoMetadata"],m),t}function WT(e){const t={},n=u(e,["productImage"]);return n!=null&&p(t,["image"],Io(n)),t}function YT(e,t){const n={},r=u(e,["numberOfImages"]);t!==void 0&&r!=null&&p(t,["parameters","sampleCount"],r);const a=u(e,["baseSteps"]);t!==void 0&&a!=null&&p(t,["parameters","baseSteps"],a);const i=u(e,["outputGcsUri"]);t!==void 0&&i!=null&&p(t,["parameters","storageUri"],i);const s=u(e,["seed"]);t!==void 0&&s!=null&&p(t,["parameters","seed"],s);const l=u(e,["safetyFilterLevel"]);t!==void 0&&l!=null&&p(t,["parameters","safetySetting"],l);const c=u(e,["personGeneration"]);t!==void 0&&c!=null&&p(t,["parameters","personGeneration"],c);const d=u(e,["addWatermark"]);t!==void 0&&d!=null&&p(t,["parameters","addWatermark"],d);const h=u(e,["outputMimeType"]);t!==void 0&&h!=null&&p(t,["parameters","outputOptions","mimeType"],h);const g=u(e,["outputCompressionQuality"]);t!==void 0&&g!=null&&p(t,["parameters","outputOptions","compressionQuality"],g);const m=u(e,["enhancePrompt"]);t!==void 0&&m!=null&&p(t,["parameters","enhancePrompt"],m);const _=u(e,["labels"]);return t!==void 0&&_!=null&&p(t,["labels"],_),n}function qT(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["source"]);a!=null&&JT(a,n);const i=u(t,["config"]);return i!=null&&YT(i,n),n}function KT(e){const t={},n=u(e,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>Hl(a))),p(t,["generatedImages"],r)}return t}function JT(e,t){const n={},r=u(e,["prompt"]);t!==void 0&&r!=null&&p(t,["instances[0]","prompt"],r);const a=u(e,["personImage"]);t!==void 0&&a!=null&&p(t,["instances[0]","personImage","image"],Io(a));const i=u(e,["productImages"]);if(t!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>WT(l))),p(t,["instances[0]","productImages"],s)}return n}function XT(e){const t={},n=u(e,["referenceImage"]);n!=null&&p(t,["referenceImage"],Io(n));const r=u(e,["referenceId"]);r!=null&&p(t,["referenceId"],r);const a=u(e,["referenceType"]);a!=null&&p(t,["referenceType"],a);const i=u(e,["maskImageConfig"]);i!=null&&p(t,["maskImageConfig"],VT(i));const s=u(e,["controlImageConfig"]);s!=null&&p(t,["controlImageConfig"],OS(s));const l=u(e,["styleImageConfig"]);l!=null&&p(t,["styleImageConfig"],l);const c=u(e,["subjectImageConfig"]);return c!=null&&p(t,["subjectImageConfig"],c),t}function ey(e){const t={},n=u(e,["safetyAttributes","categories"]);n!=null&&p(t,["categories"],n);const r=u(e,["safetyAttributes","scores"]);r!=null&&p(t,["scores"],r);const a=u(e,["contentType"]);return a!=null&&p(t,["contentType"],a),t}function ty(e){const t={},n=u(e,["safetyAttributes","categories"]);n!=null&&p(t,["categories"],n);const r=u(e,["safetyAttributes","scores"]);r!=null&&p(t,["scores"],r);const a=u(e,["contentType"]);return a!=null&&p(t,["contentType"],a),t}function ZT(e){const t={},n=u(e,["category"]);if(n!=null&&p(t,["category"],n),u(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=u(e,["threshold"]);return r!=null&&p(t,["threshold"],r),t}function QT(e){const t={},n=u(e,["image"]);return n!=null&&p(t,["image"],Io(n)),t}function eE(e,t){const n={},r=u(e,["mode"]);t!==void 0&&r!=null&&p(t,["parameters","mode"],r);const a=u(e,["maxPredictions"]);t!==void 0&&a!=null&&p(t,["parameters","maxPredictions"],a);const i=u(e,["confidenceThreshold"]);t!==void 0&&i!=null&&p(t,["parameters","confidenceThreshold"],i);const s=u(e,["maskDilation"]);t!==void 0&&s!=null&&p(t,["parameters","maskDilation"],s);const l=u(e,["binaryColorThreshold"]);t!==void 0&&l!=null&&p(t,["parameters","binaryColorThreshold"],l);const c=u(e,["labels"]);return t!==void 0&&c!=null&&p(t,["labels"],c),n}function tE(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["source"]);a!=null&&oE(a,n);const i=u(t,["config"]);return i!=null&&eE(i,n),n}function nE(e){const t={},n=u(e,["predictions"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(a=>NT(a))),p(t,["generatedMasks"],r)}return t}function oE(e,t){const n={},r=u(e,["prompt"]);t!==void 0&&r!=null&&p(t,["instances[0]","prompt"],r);const a=u(e,["image"]);t!==void 0&&a!=null&&p(t,["instances[0]","image"],Io(a));const i=u(e,["scribbleImage"]);return t!==void 0&&i!=null&&p(t,["instances[0]","scribble"],QT(i)),n}function rE(e){const t={},n=u(e,["functionCallingConfig"]);n!=null&&p(t,["functionCallingConfig"],iT(n));const r=u(e,["retrievalConfig"]);return r!=null&&p(t,["retrievalConfig"],r),t}function aE(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(g=>g)),p(t,["functionDeclarations"],h)}if(u(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=u(e,["googleSearchRetrieval"]);r!=null&&p(t,["googleSearchRetrieval"],r);const a=u(e,["computerUse"]);a!=null&&p(t,["computerUse"],a);const i=u(e,["fileSearch"]);i!=null&&p(t,["fileSearch"],i);const s=u(e,["codeExecution"]);if(s!=null&&p(t,["codeExecution"],s),u(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=u(e,["googleMaps"]);l!=null&&p(t,["googleMaps"],MT(l));const c=u(e,["googleSearch"]);c!=null&&p(t,["googleSearch"],jT(c));const d=u(e,["urlContext"]);return d!=null&&p(t,["urlContext"],d),t}function ny(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let g=n;Array.isArray(g)&&(g=g.map(m=>sT(m))),p(t,["functionDeclarations"],g)}const r=u(e,["retrieval"]);r!=null&&p(t,["retrieval"],r);const a=u(e,["googleSearchRetrieval"]);a!=null&&p(t,["googleSearchRetrieval"],a);const i=u(e,["computerUse"]);if(i!=null&&p(t,["computerUse"],i),u(e,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=u(e,["codeExecution"]);s!=null&&p(t,["codeExecution"],s);const l=u(e,["enterpriseWebSearch"]);l!=null&&p(t,["enterpriseWebSearch"],l);const c=u(e,["googleMaps"]);c!=null&&p(t,["googleMaps"],c);const d=u(e,["googleSearch"]);d!=null&&p(t,["googleSearch"],d);const h=u(e,["urlContext"]);return h!=null&&p(t,["urlContext"],h),t}function iE(e){const t={},n=u(e,["baseModel"]);n!=null&&p(t,["baseModel"],n);const r=u(e,["createTime"]);r!=null&&p(t,["createTime"],r);const a=u(e,["updateTime"]);return a!=null&&p(t,["updateTime"],a),t}function sE(e){const t={},n=u(e,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&p(t,["baseModel"],n);const r=u(e,["createTime"]);r!=null&&p(t,["createTime"],r);const a=u(e,["updateTime"]);return a!=null&&p(t,["updateTime"],a),t}function lE(e,t){const n={},r=u(e,["displayName"]);t!==void 0&&r!=null&&p(t,["displayName"],r);const a=u(e,["description"]);t!==void 0&&a!=null&&p(t,["description"],a);const i=u(e,["defaultCheckpointId"]);return t!==void 0&&i!=null&&p(t,["defaultCheckpointId"],i),n}function cE(e,t){const n={},r=u(e,["displayName"]);t!==void 0&&r!=null&&p(t,["displayName"],r);const a=u(e,["description"]);t!==void 0&&a!=null&&p(t,["description"],a);const i=u(e,["defaultCheckpointId"]);return t!==void 0&&i!=null&&p(t,["defaultCheckpointId"],i),n}function dE(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","name"],Nt(e,r));const a=u(t,["config"]);return a!=null&&lE(a,n),n}function uE(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["config"]);return a!=null&&cE(a,n),n}function pE(e,t){const n={},r=u(e,["outputGcsUri"]);t!==void 0&&r!=null&&p(t,["parameters","storageUri"],r);const a=u(e,["safetyFilterLevel"]);t!==void 0&&a!=null&&p(t,["parameters","safetySetting"],a);const i=u(e,["personGeneration"]);t!==void 0&&i!=null&&p(t,["parameters","personGeneration"],i);const s=u(e,["includeRaiReason"]);t!==void 0&&s!=null&&p(t,["parameters","includeRaiReason"],s);const l=u(e,["outputMimeType"]);t!==void 0&&l!=null&&p(t,["parameters","outputOptions","mimeType"],l);const c=u(e,["outputCompressionQuality"]);t!==void 0&&c!=null&&p(t,["parameters","outputOptions","compressionQuality"],c);const d=u(e,["enhanceInputImage"]);t!==void 0&&d!=null&&p(t,["parameters","upscaleConfig","enhanceInputImage"],d);const h=u(e,["imagePreservationFactor"]);t!==void 0&&h!=null&&p(t,["parameters","upscaleConfig","imagePreservationFactor"],h);const g=u(e,["labels"]);t!==void 0&&g!=null&&p(t,["labels"],g);const m=u(e,["numberOfImages"]);t!==void 0&&m!=null&&p(t,["parameters","sampleCount"],m);const _=u(e,["mode"]);return t!==void 0&&_!=null&&p(t,["parameters","mode"],_),n}function hE(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["_url","model"],Nt(e,r));const a=u(t,["image"]);a!=null&&p(n,["instances[0]","image"],Io(a));const i=u(t,["upscaleFactor"]);i!=null&&p(n,["parameters","upscaleConfig","upscaleFactor"],i);const s=u(t,["config"]);return s!=null&&pE(s,n),n}function mE(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>Hl(i))),p(t,["generatedImages"],a)}return t}function gE(e){const t={},n=u(e,["uri"]);n!=null&&p(t,["uri"],n);const r=u(e,["encodedVideo"]);r!=null&&p(t,["videoBytes"],Ar(r));const a=u(e,["encoding"]);return a!=null&&p(t,["mimeType"],a),t}function fE(e){const t={},n=u(e,["gcsUri"]);n!=null&&p(t,["uri"],n);const r=u(e,["bytesBase64Encoded"]);r!=null&&p(t,["videoBytes"],Ar(r));const a=u(e,["mimeType"]);return a!=null&&p(t,["mimeType"],a),t}function yE(e){const t={},n=u(e,["image"]);n!=null&&p(t,["_self"],Io(n));const r=u(e,["maskMode"]);return r!=null&&p(t,["maskMode"],r),t}function xE(e){const t={},n=u(e,["image"]);n!=null&&p(t,["image"],Bl(n));const r=u(e,["referenceType"]);return r!=null&&p(t,["referenceType"],r),t}function vE(e){const t={},n=u(e,["image"]);n!=null&&p(t,["image"],Io(n));const r=u(e,["referenceType"]);return r!=null&&p(t,["referenceType"],r),t}function oy(e){const t={},n=u(e,["uri"]);n!=null&&p(t,["uri"],n);const r=u(e,["videoBytes"]);r!=null&&p(t,["encodedVideo"],Ar(r));const a=u(e,["mimeType"]);return a!=null&&p(t,["encoding"],a),t}function ry(e){const t={},n=u(e,["uri"]);n!=null&&p(t,["gcsUri"],n);const r=u(e,["videoBytes"]);r!=null&&p(t,["bytesBase64Encoded"],Ar(r));const a=u(e,["mimeType"]);return a!=null&&p(t,["mimeType"],a),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function bE(e,t){const n={},r=u(e,["displayName"]);return t!==void 0&&r!=null&&p(t,["displayName"],r),n}function wE(e){const t={},n=u(e,["config"]);return n!=null&&bE(n,t),t}function _E(e,t){const n={},r=u(e,["force"]);return t!==void 0&&r!=null&&p(t,["_query","force"],r),n}function CE(e){const t={},n=u(e,["name"]);n!=null&&p(t,["_url","name"],n);const r=u(e,["config"]);return r!=null&&_E(r,t),t}function SE(e){const t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],n),t}function TE(e,t){const n={},r=u(e,["customMetadata"]);if(t!==void 0&&r!=null){let i=r;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["customMetadata"],i)}const a=u(e,["chunkingConfig"]);return t!==void 0&&a!=null&&p(t,["chunkingConfig"],a),n}function EE(e){const t={},n=u(e,["name"]);n!=null&&p(t,["name"],n);const r=u(e,["metadata"]);r!=null&&p(t,["metadata"],r);const a=u(e,["done"]);a!=null&&p(t,["done"],a);const i=u(e,["error"]);i!=null&&p(t,["error"],i);const s=u(e,["response"]);return s!=null&&p(t,["response"],kE(s)),t}function NE(e){const t={},n=u(e,["fileSearchStoreName"]);n!=null&&p(t,["_url","file_search_store_name"],n);const r=u(e,["fileName"]);r!=null&&p(t,["fileName"],r);const a=u(e,["config"]);return a!=null&&TE(a,t),t}function kE(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["parent"]);r!=null&&p(t,["parent"],r);const a=u(e,["documentName"]);return a!=null&&p(t,["documentName"],a),t}function AE(e,t){const n={},r=u(e,["pageSize"]);t!==void 0&&r!=null&&p(t,["_query","pageSize"],r);const a=u(e,["pageToken"]);return t!==void 0&&a!=null&&p(t,["_query","pageToken"],a),n}function IE(e){const t={},n=u(e,["config"]);return n!=null&&AE(n,t),t}function PE(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["fileSearchStores"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["fileSearchStores"],i)}return t}function ay(e,t){const n={},r=u(e,["mimeType"]);t!==void 0&&r!=null&&p(t,["mimeType"],r);const a=u(e,["displayName"]);t!==void 0&&a!=null&&p(t,["displayName"],a);const i=u(e,["customMetadata"]);if(t!==void 0&&i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),p(t,["customMetadata"],l)}const s=u(e,["chunkingConfig"]);return t!==void 0&&s!=null&&p(t,["chunkingConfig"],s),n}function RE(e){const t={},n=u(e,["fileSearchStoreName"]);n!=null&&p(t,["_url","file_search_store_name"],n);const r=u(e,["config"]);return r!=null&&ay(r,t),t}function ME(e){const t={},n=u(e,["sdkHttpResponse"]);return n!=null&&p(t,["sdkHttpResponse"],n),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const jE="Content-Type",LE="X-Server-Timeout",DE="User-Agent",Od="x-goog-api-client",OE="1.34.0",FE=`google-genai-sdk/${OE}`,zE="v1beta1",GE="v1beta";class UE{constructor(t){var n,r;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const a={};this.clientOptions.vertexai?(a.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:zE,a.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(a.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:GE,a.baseUrl="https://generativelanguage.googleapis.com/"),a.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=a,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(a,t.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const t=new Headers;return await this.clientOptions.auth.addAuthHeaders(t),t}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&r.push(t.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),n=new URL(t);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,n,r){const a=[this.getRequestUrlInternal(n)];return r&&a.push(this.getBaseResourcePath()),t!==""&&a.push(t),new URL(`${a.join("/")}`)}shouldPrependVertexProjectPath(t){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let n=this.clientOptions.httpOptions;t.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const r=this.shouldPrependVertexProjectPath(t),a=this.constructUrl(t.path,n,r);if(t.queryParams)for(const[s,l]of Object.entries(t.queryParams))a.searchParams.append(s,String(l));let i={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else i.body=t.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,n,a.toString(),t.abortSignal),this.unaryApiCall(a,i,t.httpMethod)}patchHttpOptions(t,n){const r=JSON.parse(JSON.stringify(t));for(const[a,i]of Object.entries(n))typeof i=="object"?r[a]=Object.assign(Object.assign({},r[a]),i):i!==void 0&&(r[a]=i);return r}async requestStream(t){let n=this.clientOptions.httpOptions;t.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const r=this.shouldPrependVertexProjectPath(t),a=this.constructUrl(t.path,n,r);(!a.searchParams.has("alt")||a.searchParams.get("alt")!=="sse")&&a.searchParams.set("alt","sse");let i={};return i.body=t.body,i=await this.includeExtraHttpOptionsToRequestInit(i,n,a.toString(),t.abortSignal),this.streamApiCall(a,i,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,n,r,a){if(n&&n.timeout||a){const i=new AbortController,s=i.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const l=setTimeout(()=>i.abort(),n.timeout);l&&typeof l.unref=="function"&&l.unref()}a&&a.addEventListener("abort",()=>{i.abort()}),t.signal=s}return n&&n.extraBody!==null&&HE(t,n.extraBody),t.headers=await this.getHeadersInternal(n,r),t}async unaryApiCall(t,n,r){return this.apiCall(t.toString(),Object.assign(Object.assign({},n),{method:r})).then(async a=>(await Zm(a),new Rd(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}async streamApiCall(t,n,r){return this.apiCall(t.toString(),Object.assign(Object.assign({},n),{method:r})).then(async a=>(await Zm(a),this.processStreamResponse(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}processStreamResponse(t){return No(this,arguments,function*(){var r;const a=(r=t==null?void 0:t.body)===null||r===void 0?void 0:r.getReader(),i=new TextDecoder("utf-8");if(!a)throw new Error("Response body is empty");try{let s="";const l="data:",c=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:d,value:h}=yield mt(a.read());if(d){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const g=i.decode(h,{stream:!0});try{const y=JSON.parse(g);if("error"in y){const v=JSON.parse(JSON.stringify(y.error)),C=v.status,w=v.code,b=`got status: ${C}. ${JSON.stringify(y)}`;if(w>=400&&w<600)throw new Gl({message:b,status:w})}}catch(y){if(y.name==="ApiError")throw y}s+=g;let m=-1,_=0;for(;;){m=-1,_=0;for(const C of c){const w=s.indexOf(C);w!==-1&&(m===-1||w<m)&&(m=w,_=C.length)}if(m===-1)break;const y=s.substring(0,m);s=s.substring(m+_);const v=y.trim();if(v.startsWith(l)){const C=v.substring(l.length).trim();try{const w=new Response(C,{headers:t==null?void 0:t.headers,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText});yield yield mt(new Rd(w))}catch(w){throw new Error(`exception parsing stream chunk ${C}. ${w}`)}}}}}finally{a.releaseLock()}})}async apiCall(t,n){return fetch(t,n).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const t={},n=FE+" "+this.clientOptions.userAgentExtra;return t[DE]=n,t[Od]=n,t[jE]="application/json",t}async getHeadersInternal(t,n){const r=new Headers;if(t&&t.headers){for(const[a,i]of Object.entries(t.headers))r.append(a,i);t.timeout&&t.timeout>0&&r.append(LE,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,n),r}getFileName(t){var n;let r="";return typeof t=="string"&&(r=t.replace(/[/\\]+$/,""),r=(n=r.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),r}async uploadFile(t,n){var r;const a={};n!=null&&(a.mimeType=n.mimeType,a.name=n.name,a.displayName=n.displayName),a.name&&!a.name.startsWith("files/")&&(a.name=`files/${a.name}`);const i=this.clientOptions.uploader,s=await i.stat(t);a.sizeBytes=String(s.size);const l=(r=n==null?void 0:n.mimeType)!==null&&r!==void 0?r:s.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");a.mimeType=l;const c={file:a},d=this.getFileName(t),h=Ye("upload/v1beta/files",c._url),g=await this.fetchUploadUrl(h,a.sizeBytes,a.mimeType,d,c,n==null?void 0:n.httpOptions);return i.upload(t,g,this)}async uploadFileToFileSearchStore(t,n,r){var a;const i=this.clientOptions.uploader,s=await i.stat(n),l=String(s.size),c=(a=r==null?void 0:r.mimeType)!==null&&a!==void 0?a:s.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const d=`upload/v1beta/${t}:uploadToFileSearchStore`,h=this.getFileName(n),g={};r!=null&&ay(r,g);const m=await this.fetchUploadUrl(d,l,c,h,g,r==null?void 0:r.httpOptions);return i.uploadToFileSearchStore(n,m,this)}async downloadFile(t){await this.clientOptions.downloader.download(t,this)}async fetchUploadUrl(t,n,r,a,i,s){var l;let c={};s?c=s:c={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${r}`},a?{"X-Goog-Upload-File-Name":a}:{})};const d=await this.request({path:t,body:JSON.stringify(i),httpMethod:"POST",httpOptions:c});if(!d||!(d!=null&&d.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const h=(l=d==null?void 0:d.headers)===null||l===void 0?void 0:l["x-goog-upload-url"];if(h===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return h}}async function Zm(e){var t;if(e===void 0)throw new Error("response is undefined");if(!e.ok){const n=e.status;let r;!((t=e.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?r=await e.json():r={error:{message:await e.text(),code:e.status,status:e.statusText}};const a=JSON.stringify(r);throw n>=400&&n<600?new Gl({message:a,status:n}):new Error(a)}}function HE(e,t){if(!t||Object.keys(t).length===0)return;if(e.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof e.body=="string"&&e.body.length>0)try{const i=JSON.parse(e.body);if(typeof i=="object"&&i!==null&&!Array.isArray(i))n=i;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(i,s){const l=Object.assign({},i);for(const c in s)if(Object.prototype.hasOwnProperty.call(s,c)){const d=s[c],h=l[c];d&&typeof d=="object"&&!Array.isArray(d)&&h&&typeof h=="object"&&!Array.isArray(h)?l[c]=r(h,d):(h&&d&&typeof h!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${c}". Original type: ${typeof h}, New type: ${typeof d}. Overwriting.`),l[c]=d)}return l}const a=r(n,t);e.body=JSON.stringify(a)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const BE="mcp_used/unknown";let VE=!1;function iy(e){for(const t of e)if($E(t)||typeof t=="object"&&"inputSchema"in t)return!0;return VE}function sy(e){var t;const n=(t=e[Od])!==null&&t!==void 0?t:"";e[Od]=(n+` ${BE}`).trimStart()}function $E(e){return e!==null&&typeof e=="object"&&e instanceof Yu}function WE(e){return No(this,arguments,function*(n,r=100){let a,i=0;for(;i<r;){const s=yield mt(n.listTools({cursor:a}));for(const l of s.tools)yield yield mt(l),i++;if(!s.nextCursor)break;a=s.nextCursor}})}class Yu{constructor(t=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=t,this.config=n}static create(t,n){return new Yu(t,n)}async initialize(){var t,n,r,a;if(this.mcpTools.length>0)return;const i={},s=[];for(const h of this.mcpClients)try{for(var l=!0,c=(n=void 0,ko(WE(h))),d;d=await c.next(),t=d.done,!t;l=!0){a=d.value,l=!1;const g=a;s.push(g);const m=g.name;if(i[m])throw new Error(`Duplicate function name ${m} found in MCP tools. Please ensure function names are unique.`);i[m]=h}}catch(g){n={error:g}}finally{try{!l&&!t&&(r=c.return)&&await r.call(c)}finally{if(n)throw n.error}}this.mcpTools=s,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),S_(this.mcpTools,this.config)}async callTool(t){await this.initialize();const n=[];for(const r of t)if(r.name in this.functionNameToMcpClient){const a=this.functionNameToMcpClient[r.name];let i;this.config.timeout&&(i={timeout:this.config.timeout});const s=await a.callTool({name:r.name,arguments:r.args},void 0,i);n.push({functionResponse:{name:r.name,response:s.isError?{error:s}:s}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function YE(e,t,n){const r=new f_;let a;n.data instanceof Blob?a=JSON.parse(await n.data.text()):a=JSON.parse(n.data),Object.assign(r,a),t(r)}class qE{constructor(t,n,r){this.apiClient=t,this.auth=n,this.webSocketFactory=r}async connect(t){var n,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const a=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),s=XE(this.apiClient.getDefaultHeaders()),l=this.apiClient.getApiKey(),c=`${a}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${l}`;let d=()=>{};const h=new Promise(f=>{d=f}),g=t.callbacks,m=function(){d({})},_=this.apiClient,y={onopen:m,onmessage:f=>{YE(_,g.onmessage,f)},onerror:(n=g==null?void 0:g.onerror)!==null&&n!==void 0?n:function(f){},onclose:(r=g==null?void 0:g.onclose)!==null&&r!==void 0?r:function(f){}},v=this.webSocketFactory.create(c,JE(s),y);v.connect(),await h;const b={setup:{model:Nt(this.apiClient,t.model)}};return v.send(JSON.stringify(b)),new KE(v,this.apiClient)}}class KE{constructor(t,n){this.conn=t,this.apiClient=n}async setWeightedPrompts(t){if(!t.weightedPrompts||Object.keys(t.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=wS(t);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(t){t.musicGenerationConfig||(t.musicGenerationConfig={});const n=bS(t);this.conn.send(JSON.stringify(n))}sendPlaybackControl(t){const n={playbackControl:t};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(wa.PLAY)}pause(){this.sendPlaybackControl(wa.PAUSE)}stop(){this.sendPlaybackControl(wa.STOP)}resetContext(){this.sendPlaybackControl(wa.RESET_CONTEXT)}close(){this.conn.close()}}function JE(e){const t={};return e.forEach((n,r)=>{t[r]=n}),t}function XE(e){const t=new Headers;for(const[n,r]of Object.entries(e))t.append(n,r);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ZE="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function QE(e,t,n){const r=new g_;let a;n.data instanceof Blob?a=await n.data.text():n.data instanceof ArrayBuffer?a=new TextDecoder().decode(n.data):a=n.data;const i=JSON.parse(a);if(e.isVertexAI()){const s=SS(i);Object.assign(r,s)}else Object.assign(r,i);t(r)}class eN{constructor(t,n,r){this.apiClient=t,this.auth=n,this.webSocketFactory=r,this.music=new qE(this.apiClient,this.auth,this.webSocketFactory)}async connect(t){var n,r,a,i,s,l;if(t.config&&t.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const c=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let h;const g=this.apiClient.getHeaders();t.config&&t.config.tools&&iy(t.config.tools)&&sy(g);const m=rN(g);if(this.apiClient.isVertexAI())h=`${c}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m,h);else{const A=this.apiClient.getApiKey();let k="BidiGenerateContent",P="key";A!=null&&A.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),k="BidiGenerateContentConstrained",P="access_token"),h=`${c}/ws/google.ai.generativelanguage.${d}.GenerativeService.${k}?${P}=${A}`}let _=()=>{};const y=new Promise(A=>{_=A}),v=t.callbacks,C=function(){var A;(A=v==null?void 0:v.onopen)===null||A===void 0||A.call(v),_({})},w=this.apiClient,b={onopen:C,onmessage:A=>{QE(w,v.onmessage,A)},onerror:(n=v==null?void 0:v.onerror)!==null&&n!==void 0?n:function(A){},onclose:(r=v==null?void 0:v.onclose)!==null&&r!==void 0?r:function(A){}},f=this.webSocketFactory.create(h,oN(m),b);f.connect(),await y;let T=Nt(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&T.startsWith("publishers/")){const A=this.apiClient.getProject(),k=this.apiClient.getLocation();T=`projects/${A}/locations/${k}/`+T}let I={};this.apiClient.isVertexAI()&&((a=t.config)===null||a===void 0?void 0:a.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[Vi.AUDIO]}:t.config.responseModalities=[Vi.AUDIO]),!((i=t.config)===null||i===void 0)&&i.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const E=(l=(s=t.config)===null||s===void 0?void 0:s.tools)!==null&&l!==void 0?l:[],R=[];for(const A of E)if(this.isCallableTool(A)){const k=A;R.push(await k.tool())}else R.push(A);R.length>0&&(t.config.tools=R);const N={model:T,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?I=vS(this.apiClient,N):I=xS(this.apiClient,N),delete I.config,f.send(JSON.stringify(I)),new nN(f,this.apiClient)}isCallableTool(t){return"callTool"in t&&typeof t.callTool=="function"}}const tN={turnComplete:!0};class nN{constructor(t,n){this.conn=t,this.apiClient=n}tLiveClientContent(t,n){if(n.turns!==null&&n.turns!==void 0){let r=[];try{r=ho(n.turns),t.isVertexAI()||(r=r.map(a=>Ul(a)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:r,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(t,n){let r=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?r=n.functionResponses:r=[n.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const i of r){if(typeof i!="object"||i===null||!("name"in i)||!("response"in i))throw new Error(`Could not parse function response, type '${typeof i}'.`);if(!t.isVertexAI()&&!("id"in i))throw new Error(ZE)}return{toolResponse:{functionResponses:r}}}sendClientContent(t){t=Object.assign(Object.assign({},tN),t);const n=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(n))}sendRealtimeInput(t){let n={};this.apiClient.isVertexAI()?n={realtimeInput:CS(t)}:n={realtimeInput:_S(t)},this.conn.send(JSON.stringify(n))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function oN(e){const t={};return e.forEach((n,r)=>{t[r]=n}),t}function rN(e){const t=new Headers;for(const[n,r]of Object.entries(e))t.append(n,r);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Qm=10;function eg(e){var t,n,r;if(!((t=e==null?void 0:e.automaticFunctionCalling)===null||t===void 0)&&t.disable)return!0;let a=!1;for(const s of(n=e==null?void 0:e.tools)!==null&&n!==void 0?n:[])if(Ia(s)){a=!0;break}if(!a)return!0;const i=(r=e==null?void 0:e.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return i&&(i<0||!Number.isInteger(i))||i==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",i),!0):!1}function Ia(e){return"callTool"in e&&typeof e.callTool=="function"}function aN(e){var t,n,r;return(r=(n=(t=e.config)===null||t===void 0?void 0:t.tools)===null||n===void 0?void 0:n.some(a=>Ia(a)))!==null&&r!==void 0?r:!1}function tg(e){var t;const n=[];return!((t=e==null?void 0:e.config)===null||t===void 0)&&t.tools&&e.config.tools.forEach((r,a)=>{if(Ia(r))return;const i=r;i.functionDeclarations&&i.functionDeclarations.length>0&&n.push(a)}),n}function ng(e){var t;return!(!((t=e==null?void 0:e.automaticFunctionCalling)===null||t===void 0)&&t.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class iN extends tr{constructor(t){super(),this.apiClient=t,this.generateContent=async n=>{var r,a,i,s,l;const c=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!aN(n)||eg(n.config))return await this.generateContentInternal(c);const d=tg(n);if(d.length>0){const v=d.map(C=>`tools[${C}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${v}.`)}let h,g;const m=ho(c.contents),_=(i=(a=(r=c.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls)!==null&&i!==void 0?i:Qm;let y=0;for(;y<_&&(h=await this.generateContentInternal(c),!(!h.functionCalls||h.functionCalls.length===0));){const v=h.candidates[0].content,C=[];for(const w of(l=(s=n.config)===null||s===void 0?void 0:s.tools)!==null&&l!==void 0?l:[])if(Ia(w)){const f=await w.callTool(h.functionCalls);C.push(...f)}y++,g={role:"user",parts:C},c.contents=ho(c.contents),c.contents.push(v),c.contents.push(g),ng(c.config)&&(m.push(v),m.push(g))}return ng(c.config)&&(h.automaticFunctionCallingHistory=m),h},this.generateContentStream=async n=>{var r,a,i,s,l;if(this.maybeMoveToResponseJsonSchem(n),eg(n.config)){const g=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(g)}const c=tg(n);if(c.length>0){const g=c.map(m=>`tools[${m}]`).join(", ");throw new Error(`Incompatible tools found at ${g}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const d=(i=(a=(r=n==null?void 0:n.config)===null||r===void 0?void 0:r.toolConfig)===null||a===void 0?void 0:a.functionCallingConfig)===null||i===void 0?void 0:i.streamFunctionCallArguments,h=(l=(s=n==null?void 0:n.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||l===void 0?void 0:l.disable;if(d&&!h)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(r=>{var a;let i;const s=[];if(r!=null&&r.generatedImages)for(const c of r.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((a=c==null?void 0:c.safetyAttributes)===null||a===void 0?void 0:a.contentType)==="Positive Prompt"?i=c==null?void 0:c.safetyAttributes:s.push(c);let l;return i?l={generatedImages:s,positivePromptSafetyAttributes:i,sdkHttpResponse:r.sdkHttpResponse}:l={generatedImages:s,sdkHttpResponse:r.sdkHttpResponse},l}),this.list=async n=>{var r;const s={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((r=s.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new Qr(Zo.PAGED_ITEM_MODELS,l=>this.listInternal(l),await this.listInternal(s),s)},this.editImage=async n=>{const r={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(r.referenceImages=n.referenceImages.map(a=>a.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async n=>{let r={numberOfImages:1,mode:"upscale"};n.config&&(r=Object.assign(Object.assign({},r),n.config));const a={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:r};return await this.upscaleImageInternal(a)},this.generateVideos=async n=>{var r,a,i,s,l,c;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=n.video)===null||r===void 0)&&r.uri&&(!((a=n.video)===null||a===void 0)&&a.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((s=(i=n.source)===null||i===void 0?void 0:i.video)===null||s===void 0)&&s.uri&&(!((c=(l=n.source)===null||l===void 0?void 0:l.video)===null||c===void 0)&&c.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(t){t.config&&t.config.responseSchema&&(t.config.responseJsonSchema||Object.keys(t.config.responseSchema).includes("$schema")&&(t.config.responseJsonSchema=t.config.responseSchema,delete t.config.responseSchema))}async processParamsMaybeAddMcpUsage(t){var n,r,a;const i=(n=t.config)===null||n===void 0?void 0:n.tools;if(!i)return t;const s=await Promise.all(i.map(async c=>Ia(c)?await c.tool():c)),l={model:t.model,contents:t.contents,config:Object.assign(Object.assign({},t.config),{tools:s})};if(l.config.tools=s,t.config&&t.config.tools&&iy(t.config.tools)){const c=(a=(r=t.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&a!==void 0?a:{};let d=Object.assign({},c);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),sy(d),l.config.httpOptions=Object.assign(Object.assign({},t.config.httpOptions),{headers:d})}return l}async initAfcToolsMap(t){var n,r,a;const i=new Map;for(const s of(r=(n=t.config)===null||n===void 0?void 0:n.tools)!==null&&r!==void 0?r:[])if(Ia(s)){const l=s,c=await l.tool();for(const d of(a=c.functionDeclarations)!==null&&a!==void 0?a:[]){if(!d.name)throw new Error("Function declaration name is required.");if(i.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);i.set(d.name,l)}}return i}async processAfcStream(t){var n,r,a;const i=(a=(r=(n=t.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&a!==void 0?a:Qm;let s=!1,l=0;const c=await this.initAfcToolsMap(t);return function(d,h,g){return No(this,arguments,function*(){for(var m,_,y,v,C,w;l<i;){s&&(l++,s=!1);const I=yield mt(d.processParamsMaybeAddMcpUsage(g)),E=yield mt(d.generateContentStreamInternal(I)),R=[],N=[];try{for(var b=!0,f=(_=void 0,ko(E)),T;T=yield mt(f.next()),m=T.done,!m;b=!0){v=T.value,b=!1;const A=v;if(yield yield mt(A),A.candidates&&(!((C=A.candidates[0])===null||C===void 0)&&C.content)){N.push(A.candidates[0].content);for(const k of(w=A.candidates[0].content.parts)!==null&&w!==void 0?w:[])if(l<i&&k.functionCall){if(!k.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(k.functionCall.name)){const P=yield mt(h.get(k.functionCall.name).callTool([k.functionCall]));R.push(...P)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${k.functionCall.name}`)}}}}catch(A){_={error:A}}finally{try{!b&&!m&&(y=f.return)&&(yield mt(y.call(f)))}finally{if(_)throw _.error}}if(R.length>0){s=!0;const A=new li;A.candidates=[{content:{role:"user",parts:R}}],yield yield mt(A);const k=[];k.push(...N),k.push({role:"user",parts:R});const P=ho(g.contents).concat(k);g.contents=P}else break}})}(this,c,t)}async generateContentInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Km(this.apiClient,t);return l=Ye("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=Xm(h),m=new li;return Object.assign(m,g),m})}else{const d=qm(this.apiClient,t);return l=Ye("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=Jm(h),m=new li;return Object.assign(m,g),m})}}async generateContentStreamInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Km(this.apiClient,t);return l=Ye("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(g){return No(this,arguments,function*(){var m,_,y,v;try{for(var C=!0,w=ko(g),b;b=yield mt(w.next()),m=b.done,!m;C=!0){v=b.value,C=!1;const f=v,T=Xm(yield mt(f.json()));T.sdkHttpResponse={headers:f.headers};const I=new li;Object.assign(I,T),yield yield mt(I)}}catch(f){_={error:f}}finally{try{!C&&!m&&(y=w.return)&&(yield mt(y.call(w)))}finally{if(_)throw _.error}}})})}else{const d=qm(this.apiClient,t);return l=Ye("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}),s.then(function(g){return No(this,arguments,function*(){var m,_,y,v;try{for(var C=!0,w=ko(g),b;b=yield mt(w.next()),m=b.done,!m;C=!0){v=b.value,C=!1;const f=v,T=Jm(yield mt(f.json()));T.sdkHttpResponse={headers:f.headers};const I=new li;Object.assign(I,T),yield yield mt(I)}}catch(f){_={error:f}}finally{try{!C&&!m&&(y=w.return)&&(yield mt(y.call(w)))}finally{if(_)throw _.error}}})})}}async embedContent(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=eT(this.apiClient,t);return l=Ye("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=nT(h),m=new Pm;return Object.assign(m,g),m})}else{const d=QS(this.apiClient,t);return l=Ye("{model}:batchEmbedContents",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=tT(h),m=new Pm;return Object.assign(m,g),m})}}async generateImagesInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=hT(this.apiClient,t);return l=Ye("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=gT(h),m=new Rm;return Object.assign(m,g),m})}else{const d=pT(this.apiClient,t);return l=Ye("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=mT(h),m=new Rm;return Object.assign(m,g),m})}}async editImageInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=KS(this.apiClient,t);return i=Ye("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),a.then(c=>{const d=JS(c),h=new r_;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=hE(this.apiClient,t);return i=Ye("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),a.then(c=>{const d=mE(c),h=new a_;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=qT(this.apiClient,t);return i=Ye("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=KT(c),h=new i_;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=tE(this.apiClient,t);return i=Ye("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=nE(c),h=new s_;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=RT(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Dd(h))}else{const d=PT(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>Ld(h))}}async listInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=UT(this.apiClient,t);return l=Ye("{models_url}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=BT(h),m=new Mm;return Object.assign(m,g),m})}else{const d=GT(this.apiClient,t);return l=Ye("{models_url}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=HT(h),m=new Mm;return Object.assign(m,g),m})}}async update(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=uE(this.apiClient,t);return l=Ye("{model}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Dd(h))}else{const d=dE(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>Ld(h))}}async delete(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=$S(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=YS(h),m=new jm;return Object.assign(m,g),m})}else{const d=VS(this.apiClient,t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=WS(h),m=new jm;return Object.assign(m,g),m})}}async countTokens(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=US(this.apiClient,t);return l=Ye("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=BS(h),m=new Lm;return Object.assign(m,g),m})}else{const d=GS(this.apiClient,t);return l=Ye("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=HS(h),m=new Lm;return Object.assign(m,g),m})}}async computeTokens(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=MS(this.apiClient,t);return i=Ye("{model}:computeTokens",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),a.then(c=>{const d=jS(c),h=new l_;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=wT(this.apiClient,t);return l=Ye("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>{const g=vT(h),m=new fl;return Object.assign(m,g),m})}else{const d=bT(this.apiClient,t);return l=Ye("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s.then(h=>{const g=xT(h),m=new fl;return Object.assign(m,g),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class sN extends tr{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){const n=t.operation,r=t.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=n.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:a,config:{httpOptions:i}});return n._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async get(t){const n=t.operation,r=t.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=n.name.split("/operations/")[0];let i;r&&"httpOptions"in r&&(i=r.httpOptions);const s=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:a,config:{httpOptions:i}});return n._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async getVideosOperationInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Zw(t);return l=Ye("{operationName}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s}else{const d=Xw(t);return l=Ye("{operationName}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),s}}async fetchPredictVideosOperationInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=Vw(t);return i=Ye("{resourceName}:fetchPredictOperation",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function lN(e){const t={},n=u(e,["data"]);if(n!=null&&p(t,["data"],n),u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function cN(e){const t={},n=u(e,["parts"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(i=>xN(i))),p(t,["parts"],a)}const r=u(e,["role"]);return r!=null&&p(t,["role"],r),t}function dN(e,t,n){const r={},a=u(t,["expireTime"]);n!==void 0&&a!=null&&p(n,["expireTime"],a);const i=u(t,["newSessionExpireTime"]);n!==void 0&&i!=null&&p(n,["newSessionExpireTime"],i);const s=u(t,["uses"]);n!==void 0&&s!=null&&p(n,["uses"],s);const l=u(t,["liveConnectConstraints"]);n!==void 0&&l!=null&&p(n,["bidiGenerateContentSetup"],yN(e,l));const c=u(t,["lockAdditionalFields"]);return n!==void 0&&c!=null&&p(n,["fieldMask"],c),r}function uN(e,t){const n={},r=u(t,["config"]);return r!=null&&p(n,["config"],dN(e,r,n)),n}function pN(e){const t={};if(u(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=u(e,["fileUri"]);n!=null&&p(t,["fileUri"],n);const r=u(e,["mimeType"]);return r!=null&&p(t,["mimeType"],r),t}function hN(e){const t={},n=u(e,["id"]);n!=null&&p(t,["id"],n);const r=u(e,["args"]);r!=null&&p(t,["args"],r);const a=u(e,["name"]);if(a!=null&&p(t,["name"],a),u(e,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(u(e,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function mN(e){const t={};if(u(e,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=u(e,["enableWidget"]);return n!=null&&p(t,["enableWidget"],n),t}function gN(e){const t={};if(u(e,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(u(e,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=u(e,["timeRangeFilter"]);return n!=null&&p(t,["timeRangeFilter"],n),t}function fN(e,t){const n={},r=u(e,["generationConfig"]);t!==void 0&&r!=null&&p(t,["setup","generationConfig"],r);const a=u(e,["responseModalities"]);t!==void 0&&a!=null&&p(t,["setup","generationConfig","responseModalities"],a);const i=u(e,["temperature"]);t!==void 0&&i!=null&&p(t,["setup","generationConfig","temperature"],i);const s=u(e,["topP"]);t!==void 0&&s!=null&&p(t,["setup","generationConfig","topP"],s);const l=u(e,["topK"]);t!==void 0&&l!=null&&p(t,["setup","generationConfig","topK"],l);const c=u(e,["maxOutputTokens"]);t!==void 0&&c!=null&&p(t,["setup","generationConfig","maxOutputTokens"],c);const d=u(e,["mediaResolution"]);t!==void 0&&d!=null&&p(t,["setup","generationConfig","mediaResolution"],d);const h=u(e,["seed"]);t!==void 0&&h!=null&&p(t,["setup","generationConfig","seed"],h);const g=u(e,["speechConfig"]);t!==void 0&&g!=null&&p(t,["setup","generationConfig","speechConfig"],Wu(g));const m=u(e,["thinkingConfig"]);t!==void 0&&m!=null&&p(t,["setup","generationConfig","thinkingConfig"],m);const _=u(e,["enableAffectiveDialog"]);t!==void 0&&_!=null&&p(t,["setup","generationConfig","enableAffectiveDialog"],_);const y=u(e,["systemInstruction"]);t!==void 0&&y!=null&&p(t,["setup","systemInstruction"],cN(Ln(y)));const v=u(e,["tools"]);if(t!==void 0&&v!=null){let E=Ba(v);Array.isArray(E)&&(E=E.map(R=>bN(Ha(R)))),p(t,["setup","tools"],E)}const C=u(e,["sessionResumption"]);t!==void 0&&C!=null&&p(t,["setup","sessionResumption"],vN(C));const w=u(e,["inputAudioTranscription"]);t!==void 0&&w!=null&&p(t,["setup","inputAudioTranscription"],w);const b=u(e,["outputAudioTranscription"]);t!==void 0&&b!=null&&p(t,["setup","outputAudioTranscription"],b);const f=u(e,["realtimeInputConfig"]);t!==void 0&&f!=null&&p(t,["setup","realtimeInputConfig"],f);const T=u(e,["contextWindowCompression"]);t!==void 0&&T!=null&&p(t,["setup","contextWindowCompression"],T);const I=u(e,["proactivity"]);if(t!==void 0&&I!=null&&p(t,["setup","proactivity"],I),u(e,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function yN(e,t){const n={},r=u(t,["model"]);r!=null&&p(n,["setup","model"],Nt(e,r));const a=u(t,["config"]);return a!=null&&p(n,["config"],fN(a,n)),n}function xN(e){const t={},n=u(e,["mediaResolution"]);n!=null&&p(t,["mediaResolution"],n);const r=u(e,["codeExecutionResult"]);r!=null&&p(t,["codeExecutionResult"],r);const a=u(e,["executableCode"]);a!=null&&p(t,["executableCode"],a);const i=u(e,["fileData"]);i!=null&&p(t,["fileData"],pN(i));const s=u(e,["functionCall"]);s!=null&&p(t,["functionCall"],hN(s));const l=u(e,["functionResponse"]);l!=null&&p(t,["functionResponse"],l);const c=u(e,["inlineData"]);c!=null&&p(t,["inlineData"],lN(c));const d=u(e,["text"]);d!=null&&p(t,["text"],d);const h=u(e,["thought"]);h!=null&&p(t,["thought"],h);const g=u(e,["thoughtSignature"]);g!=null&&p(t,["thoughtSignature"],g);const m=u(e,["videoMetadata"]);return m!=null&&p(t,["videoMetadata"],m),t}function vN(e){const t={},n=u(e,["handle"]);if(n!=null&&p(t,["handle"],n),u(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function bN(e){const t={},n=u(e,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(g=>g)),p(t,["functionDeclarations"],h)}if(u(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=u(e,["googleSearchRetrieval"]);r!=null&&p(t,["googleSearchRetrieval"],r);const a=u(e,["computerUse"]);a!=null&&p(t,["computerUse"],a);const i=u(e,["fileSearch"]);i!=null&&p(t,["fileSearch"],i);const s=u(e,["codeExecution"]);if(s!=null&&p(t,["codeExecution"],s),u(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=u(e,["googleMaps"]);l!=null&&p(t,["googleMaps"],mN(l));const c=u(e,["googleSearch"]);c!=null&&p(t,["googleSearch"],gN(c));const d=u(e,["urlContext"]);return d!=null&&p(t,["urlContext"],d),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wN(e){const t=[];for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const r=e[n];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const a=Object.keys(r).map(i=>`${n}.${i}`);t.push(...a)}else t.push(n)}return t.join(",")}function _N(e,t){let n=null;const r=e.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const i=r.setup;typeof i=="object"&&i!==null?(e.bidiGenerateContentSetup=i,n=i):delete e.bidiGenerateContentSetup}else r!==void 0&&delete e.bidiGenerateContentSetup;const a=e.fieldMask;if(n){const i=wN(n);if(Array.isArray(t==null?void 0:t.lockAdditionalFields)&&(t==null?void 0:t.lockAdditionalFields.length)===0)i?e.fieldMask=i:delete e.fieldMask;else if(t!=null&&t.lockAdditionalFields&&t.lockAdditionalFields.length>0&&a!==null&&Array.isArray(a)&&a.length>0){const s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let l=[];a.length>0&&(l=a.map(d=>s.includes(d)?`generationConfig.${d}`:d));const c=[];i&&c.push(i),l.length>0&&c.push(...l),c.length>0?e.fieldMask=c.join(","):delete e.fieldMask}else delete e.fieldMask}else a!==null&&Array.isArray(a)&&a.length>0?e.fieldMask=a.join(","):delete e.fieldMask;return e}class CN extends tr{constructor(t){super(),this.apiClient=t}async create(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const l=uN(this.apiClient,t);i=Ye("auth_tokens",l._url),s=l._query,delete l.config,delete l._url,delete l._query;const c=_N(l,t.config);return a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>d)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function SN(e,t){const n={},r=u(e,["force"]);return t!==void 0&&r!=null&&p(t,["_query","force"],r),n}function TN(e){const t={},n=u(e,["name"]);n!=null&&p(t,["_url","name"],n);const r=u(e,["config"]);return r!=null&&SN(r,t),t}function EN(e){const t={},n=u(e,["name"]);return n!=null&&p(t,["_url","name"],n),t}function NN(e,t){const n={},r=u(e,["pageSize"]);t!==void 0&&r!=null&&p(t,["_query","pageSize"],r);const a=u(e,["pageToken"]);return t!==void 0&&a!=null&&p(t,["_query","pageToken"],a),n}function kN(e){const t={},n=u(e,["parent"]);n!=null&&p(t,["_url","parent"],n);const r=u(e,["config"]);return r!=null&&NN(r,t),t}function AN(e){const t={},n=u(e,["sdkHttpResponse"]);n!=null&&p(t,["sdkHttpResponse"],n);const r=u(e,["nextPageToken"]);r!=null&&p(t,["nextPageToken"],r);const a=u(e,["documents"]);if(a!=null){let i=a;Array.isArray(i)&&(i=i.map(s=>s)),p(t,["documents"],i)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class IN extends tr{constructor(t){super(),this.apiClient=t,this.list=async n=>new Qr(Zo.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:n.parent,config:r.config}),await this.listInternal(n),n)}async get(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=EN(t);return i=Ye("{name}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var n,r;let a="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=TN(t);a=Ye("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:a,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=kN(t);return i=Ye("{parent}/documents",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=AN(c),h=new c_;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class PN extends tr{constructor(t,n=new IN(t)){super(),this.apiClient=t,this.documents=n,this.list=async(r={})=>new Qr(Zo.PAGED_ITEM_FILE_SEARCH_STORES,a=>this.listInternal(a),await this.listInternal(r),r)}async uploadToFileSearchStore(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(t.fileSearchStoreName,t.file,t.config)}async create(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=wE(t);return i=Ye("fileSearchStores",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async get(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=SE(t);return i=Ye("{name}",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(t){var n,r;let a="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=CE(t);a=Ye("{name}",s._url),i=s._query,delete s._url,delete s._query,await this.apiClient.request({path:a,queryParams:i,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=IE(t);return i=Ye("fileSearchStores",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=PE(c),h=new d_;return Object.assign(h,d),h})}}async uploadToFileSearchStoreInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=RE(t);return i=Ye("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=ME(c),h=new u_;return Object.assign(h,d),h})}}async importFile(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=NE(t);return i=Ye("{file_search_store_name}:importFile",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),a.then(c=>{const d=EE(c),h=new Uu;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let ly=function(){const{crypto:e}=globalThis;if(e!=null&&e.randomUUID)return ly=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^n()&15>>+r/4).toString(16))};const RN=()=>ly();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Fd(e){return typeof e=="object"&&e!==null&&("name"in e&&e.name==="AbortError"||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const zd=e=>{if(e instanceof Error)return e;if(typeof e=="object"&&e!==null){try{if(Object.prototype.toString.call(e)==="[object Error]"){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class fo extends Error{}class Hn extends fo{constructor(t,n,r,a){super(`${Hn.makeMessage(t,n,r)}`),this.status=t,this.headers=a,this.error=n}static makeMessage(t,n,r){const a=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return t&&a?`${t} ${a}`:t?`${t} status code (no body)`:a||"(no status code or body)"}static generate(t,n,r,a){if(!t||!a)return new Vl({message:r,cause:zd(n)});const i=n;return t===400?new dy(t,i,r,a):t===401?new uy(t,i,r,a):t===403?new py(t,i,r,a):t===404?new hy(t,i,r,a):t===409?new my(t,i,r,a):t===422?new gy(t,i,r,a):t===429?new fy(t,i,r,a):t>=500?new yy(t,i,r,a):new Hn(t,i,r,a)}}class Gd extends Hn{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class Vl extends Hn{constructor({message:t,cause:n}){super(void 0,void 0,t||"Connection error.",void 0),n&&(this.cause=n)}}class cy extends Vl{constructor({message:t}={}){super({message:t??"Request timed out."})}}class dy extends Hn{}class uy extends Hn{}class py extends Hn{}class hy extends Hn{}class my extends Hn{}class gy extends Hn{}class fy extends Hn{}class yy extends Hn{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const MN=/^[a-z][a-z0-9+.-]*:/i,jN=e=>MN.test(e);let Ud=e=>(Ud=Array.isArray,Ud(e));const LN=Ud;let DN=LN;const og=DN;function ON(e){if(!e)return!0;for(const t in e)return!1;return!0}function FN(e,t){return Object.prototype.hasOwnProperty.call(e,t)}const zN=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new fo(`${e} must be an integer`);if(t<0)throw new fo(`${e} must be a positive integer`);return t},GN=e=>{try{return JSON.parse(e)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const UN=e=>new Promise(t=>setTimeout(t,e));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const la="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function HN(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const BN=()=>{var e,t,n,r,a;const i=HN();if(i==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":la,"X-Stainless-OS":ag(Deno.build.os),"X-Stainless-Arch":rg(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(e=Deno.version)===null||e===void 0?void 0:e.deno)!==null&&t!==void 0?t:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":la,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(i==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":la,"X-Stainless-OS":ag((n=globalThis.process.platform)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Arch":rg((r=globalThis.process.arch)!==null&&r!==void 0?r:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(a=globalThis.process.version)!==null&&a!==void 0?a:"unknown"};const s=VN();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":la,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":la,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function VN(){if(typeof navigator>"u"||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const r=n.exec(navigator.userAgent);if(r){const a=r[1]||0,i=r[2]||0,s=r[3]||0;return{browser:t,version:`${a}.${i}.${s}`}}}return null}const rg=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",ag=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown");let bs;const $N=()=>bs??(bs=BN());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function WN(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function xy(...e){const t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function YN(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return xy({start(){},async pull(n){const{done:r,value:a}=await t.next();r?n.close():n.enqueue(a)},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}function vy(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const n=await t.read();return n!=null&&n.done&&t.releaseLock(),n}catch(n){throw t.releaseLock(),n}},async return(){const n=t.cancel();return t.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function qN(e){var t,n;if(e===null||typeof e!="object")return;if(e[Symbol.asyncIterator]){await((n=(t=e[Symbol.asyncIterator]()).return)===null||n===void 0?void 0:n.call(t));return}const r=e.getReader(),a=r.cancel();r.releaseLock(),await a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const KN=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const by=()=>{var e;if(typeof File>"u"){const{process:t}=globalThis,n=typeof((e=t==null?void 0:t.versions)===null||e===void 0?void 0:e.node)=="string"&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Ic(e,t,n){return by(),new File(e,t??"unknown_file",n)}function JN(e){return(typeof e=="object"&&e!==null&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const XN=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const wy=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",ZN=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&wy(e),QN=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function";async function ek(e,t,n){if(by(),e=await e,ZN(e))return e instanceof File?e:Ic([await e.arrayBuffer()],e.name);if(QN(e)){const a=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),Ic(await Hd(a),t,n)}const r=await Hd(e);if(t||(t=JN(e)),!(n!=null&&n.type)){const a=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof a=="string"&&(n=Object.assign(Object.assign({},n),{type:a}))}return Ic(r,t,n)}async function Hd(e){var t,n,r,a,i;let s=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)s.push(e);else if(wy(e))s.push(e instanceof Blob?e:await e.arrayBuffer());else if(XN(e))try{for(var l=!0,c=ko(e),d;d=await c.next(),t=d.done,!t;l=!0){a=d.value,l=!1;const h=a;s.push(...await Hd(h))}}catch(h){n={error:h}}finally{try{!l&&!t&&(r=c.return)&&await r.call(c)}finally{if(n)throw n.error}}else{const h=(i=e==null?void 0:e.constructor)===null||i===void 0?void 0:i.name;throw new Error(`Unexpected data type: ${typeof e}${h?`; constructor: ${h}`:""}${tk(e)}`)}return s}function tk(e){return typeof e!="object"||e===null?"":`; props: [${Object.getOwnPropertyNames(e).map(n=>`"${n}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _y{constructor(t){this._client=t}}_y._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Cy(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const ig=Object.freeze(Object.create(null)),nk=(e=Cy)=>function(n,...r){if(n.length===1)return n[0];let a=!1;const i=[],s=n.reduce((h,g,m)=>{var _,y,v;/[?#]/.test(g)&&(a=!0);const C=r[m];let w=(a?encodeURIComponent:e)(""+C);return m!==r.length&&(C==null||typeof C=="object"&&C.toString===((v=Object.getPrototypeOf((y=Object.getPrototypeOf((_=C.hasOwnProperty)!==null&&_!==void 0?_:ig))!==null&&y!==void 0?y:ig))===null||v===void 0?void 0:v.toString))&&(w=C+"",i.push({start:h.length+g.length,length:w.length,error:`Value of type ${Object.prototype.toString.call(C).slice(8,-1)} is not a valid path parameter`})),h+g+(m===r.length?"":w)},""),l=s.split(/[?#]/,1)[0],c=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let d;for(;(d=c.exec(l))!==null;)i.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(i.sort((h,g)=>h.start-g.start),i.length>0){let h=0;const g=i.reduce((m,_)=>{const y=" ".repeat(_.start-h),v="^".repeat(_.length);return h=_.start+_.length,m+y+v},"");throw new fo(`Path parameters result in path with invalid segments:
${i.map(m=>m.error).join(`
`)}
${s}
${g}`)}return s},ws=nk(Cy);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Sy extends _y{create(t,n){var r;const{api_version:a=this._client.apiVersion}=t,i=xl(t,["api_version"]);if("model"in i&&"agent_config"in i)throw new fo("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in i&&"generation_config"in i)throw new fo("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(ws`/${a}/interactions`,Object.assign(Object.assign({body:i},n),{stream:(r=t.stream)!==null&&r!==void 0?r:!1}))}delete(t,n={},r){const{api_version:a=this._client.apiVersion}=n??{};return this._client.delete(ws`/${a}/interactions/${t}`,r)}cancel(t,n={},r){const{api_version:a=this._client.apiVersion}=n??{};return this._client.post(ws`/${a}/interactions/${t}/cancel`,r)}get(t,n={},r){var a;const i=n??{},{api_version:s=this._client.apiVersion}=i,l=xl(i,["api_version"]);return this._client.get(ws`/${s}/interactions/${t}`,Object.assign(Object.assign({query:l},r),{stream:(a=n==null?void 0:n.stream)!==null&&a!==void 0?a:!1}))}}Sy._key=Object.freeze(["interactions"]);class Ty extends Sy{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ok(e){let t=0;for(const a of e)t+=a.length;const n=new Uint8Array(t);let r=0;for(const a of e)n.set(a,r),r+=a.length;return n}let _s;function qu(e){let t;return(_s??(t=new globalThis.TextEncoder,_s=t.encode.bind(t)))(e)}let Cs;function sg(e){let t;return(Cs??(t=new globalThis.TextDecoder,Cs=t.decode.bind(t)))(e)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $l{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(t){if(t==null)return[];const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?qu(t):t;this.buffer=ok([this.buffer,n]);const r=[];let a;for(;(a=rk(this.buffer,this.carriageReturnIndex))!=null;){if(a.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=a.index;continue}if(this.carriageReturnIndex!=null&&(a.index!==this.carriageReturnIndex+1||a.carriage)){r.push(sg(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const i=this.carriageReturnIndex!==null?a.preceding-1:a.preceding,s=sg(this.buffer.subarray(0,i));r.push(s),this.buffer=this.buffer.subarray(a.index),this.carriageReturnIndex=null}return r}flush(){return this.buffer.length?this.decode(`
`):[]}}$l.NEWLINE_CHARS=new Set([`
`,"\r"]);$l.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function rk(e,t){for(let a=t??0;a<e.length;a++){if(e[a]===10)return{preceding:a,index:a+1,carriage:!1};if(e[a]===13)return{preceding:a,index:a+1,carriage:!0}}return null}function ak(e){for(let r=0;r<e.length-1;r++){if(e[r]===10&&e[r+1]===10||e[r]===13&&e[r+1]===13)return r+2;if(e[r]===13&&e[r+1]===10&&r+3<e.length&&e[r+2]===13&&e[r+3]===10)return r+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vl={off:0,error:200,warn:300,info:400,debug:500},lg=(e,t,n)=>{if(e){if(FN(vl,e))return e;zn(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(vl))}`)}};function gi(){}function Ss(e,t,n){return!t||vl[e]>vl[n]?gi:t[e].bind(t)}const ik={error:gi,warn:gi,info:gi,debug:gi};let cg=new WeakMap;function zn(e){var t;const n=e.logger,r=(t=e.logLevel)!==null&&t!==void 0?t:"off";if(!n)return ik;const a=cg.get(n);if(a&&a[0]===r)return a[1];const i={error:Ss("error",n,r),warn:Ss("warn",n,r),info:Ss("info",n,r),debug:Ss("debug",n,r)};return cg.set(n,[r,i]),i}const Fr=e=>(e.options&&(e.options=Object.assign({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([t,n])=>[t,t.toLowerCase()==="x-goog-api-key"||t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _a{constructor(t,n,r){this.iterator=t,this.controller=n,this.client=r}static fromSSEResponse(t,n,r){let a=!1;const i=r?zn(r):console;function s(){return No(this,arguments,function*(){var c,d,h,g;if(a)throw new fo("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let m=!1;try{try{for(var _=!0,y=ko(sk(t,n)),v;v=yield mt(y.next()),c=v.done,!c;_=!0){g=v.value,_=!1;const C=g;if(!m)if(C.data.startsWith("[DONE]")){m=!0;continue}else try{yield yield mt(JSON.parse(C.data))}catch(w){throw i.error("Could not parse message into JSON:",C.data),i.error("From chunk:",C.raw),w}}}catch(C){d={error:C}}finally{try{!_&&!c&&(h=y.return)&&(yield mt(h.call(y)))}finally{if(d)throw d.error}}m=!0}catch(C){if(Fd(C))return yield mt(void 0);throw C}finally{m||n.abort()}})}return new _a(s,n,r)}static fromReadableStream(t,n,r){let a=!1;function i(){return No(this,arguments,function*(){var c,d,h,g;const m=new $l,_=vy(t);try{for(var y=!0,v=ko(_),C;C=yield mt(v.next()),c=C.done,!c;y=!0){g=C.value,y=!1;const w=g;for(const b of m.decode(w))yield yield mt(b)}}catch(w){d={error:w}}finally{try{!y&&!c&&(h=v.return)&&(yield mt(h.call(v)))}finally{if(d)throw d.error}}for(const w of m.flush())yield yield mt(w)})}function s(){return No(this,arguments,function*(){var c,d,h,g;if(a)throw new fo("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let m=!1;try{try{for(var _=!0,y=ko(i()),v;v=yield mt(y.next()),c=v.done,!c;_=!0){g=v.value,_=!1;const C=g;m||C&&(yield yield mt(JSON.parse(C)))}}catch(C){d={error:C}}finally{try{!_&&!c&&(h=y.return)&&(yield mt(h.call(y)))}finally{if(d)throw d.error}}m=!0}catch(C){if(Fd(C))return yield mt(void 0);throw C}finally{m||n.abort()}})}return new _a(s,n,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],n=[],r=this.iterator(),a=i=>({next:()=>{if(i.length===0){const s=r.next();t.push(s),n.push(s)}return i.shift()}});return[new _a(()=>a(t),this.controller,this.client),new _a(()=>a(n),this.controller,this.client)]}toReadableStream(){const t=this;let n;return xy({async start(){n=t[Symbol.asyncIterator]()},async pull(r){try{const{value:a,done:i}=await n.next();if(i)return r.close();const s=qu(JSON.stringify(a)+`
`);r.enqueue(s)}catch(a){r.error(a)}},async cancel(){var r;await((r=n.return)===null||r===void 0?void 0:r.call(n))}})}}function sk(e,t){return No(this,arguments,function*(){var r,a,i,s;if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new fo("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new fo("Attempted to iterate over a response with no body");const l=new ck,c=new $l,d=vy(e.body);try{for(var h=!0,g=ko(lk(d)),m;m=yield mt(g.next()),r=m.done,!r;h=!0){s=m.value,h=!1;const _=s;for(const y of c.decode(_)){const v=l.decode(y);v&&(yield yield mt(v))}}}catch(_){a={error:_}}finally{try{!h&&!r&&(i=g.return)&&(yield mt(i.call(g)))}finally{if(a)throw a.error}}for(const _ of c.flush()){const y=l.decode(_);y&&(yield yield mt(y))}})}function lk(e){return No(this,arguments,function*(){var n,r,a,i;let s=new Uint8Array;try{for(var l=!0,c=ko(e),d;d=yield mt(c.next()),n=d.done,!n;l=!0){i=d.value,l=!1;const h=i;if(h==null)continue;const g=h instanceof ArrayBuffer?new Uint8Array(h):typeof h=="string"?qu(h):h;let m=new Uint8Array(s.length+g.length);m.set(s),m.set(g,s.length),s=m;let _;for(;(_=ak(s))!==-1;)yield yield mt(s.slice(0,_)),s=s.slice(_)}}catch(h){r={error:h}}finally{try{!l&&!n&&(a=c.return)&&(yield mt(a.call(c)))}finally{if(r)throw r.error}}s.length>0&&(yield yield mt(s))})}class ck{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(t),t.startsWith(":"))return null;let[n,r,a]=dk(t,":");return a.startsWith(" ")&&(a=a.substring(1)),n==="event"?this.event=a:n==="data"&&this.data.push(a),null}}function dk(e,t){const n=e.indexOf(t);return n!==-1?[e.substring(0,n),t,e.substring(n+t.length)]:[e,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function uk(e,t){const{response:n,requestLogID:r,retryOfRequestLogID:a,startTime:i}=t,s=await(async()=>{var l;if(t.options.stream)return zn(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):_a.fromSSEResponse(n,t.controller,e);if(n.status===204)return null;if(t.options.__binaryResponse)return n;const c=n.headers.get("content-type"),d=(l=c==null?void 0:c.split(";")[0])===null||l===void 0?void 0:l.trim();return(d==null?void 0:d.includes("application/json"))||(d==null?void 0:d.endsWith("+json"))?await n.json():await n.text()})();return zn(e).debug(`[${r}] response parsed`,Fr({retryOfRequestLogID:a,url:n.url,status:n.status,body:s,durationMs:Date.now()-i})),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ku extends Promise{constructor(t,n,r=uk){super(a=>{a(null)}),this.responsePromise=n,this.parseResponse=r,this.client=t}_thenUnwrap(t){return new Ku(this.client,this.responsePromise,async(n,r)=>t(await this.parseResponse(n,r),r))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(this.client,t))),this.parsedPromise}then(t,n){return this.parse().then(t,n)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ey=Symbol("brand.privateNullableHeaders");function*pk(e){if(!e)return;if(Ey in e){const{values:r,nulls:a}=e;yield*r.entries();for(const i of a)yield[i,null];return}let t=!1,n;e instanceof Headers?n=e.entries():og(e)?n=e:(t=!0,n=Object.entries(e??{}));for(let r of n){const a=r[0];if(typeof a!="string")throw new TypeError("expected header name to be a string");const i=og(r[1])?r[1]:[r[1]];let s=!1;for(const l of i)l!==void 0&&(t&&!s&&(s=!0,yield[a,null]),yield[a,l])}}const ci=e=>{const t=new Headers,n=new Set;for(const r of e){const a=new Set;for(const[i,s]of pk(r)){const l=i.toLowerCase();a.has(l)||(t.delete(i),a.add(l)),s===null?(t.delete(i),n.add(l)):(t.append(i,s),n.delete(l))}}return{[Ey]:!0,values:t,nulls:n}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Pc=e=>{var t,n,r,a,i,s;if(typeof globalThis.process<"u")return(r=(n=(t=Fw)===null||t===void 0?void 0:t[e])===null||n===void 0?void 0:n.trim())!==null&&r!==void 0?r:void 0;if(typeof globalThis.Deno<"u")return(s=(i=(a=globalThis.Deno.env)===null||a===void 0?void 0:a.get)===null||i===void 0?void 0:i.call(a,e))===null||s===void 0?void 0:s.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Ny;class Wl{constructor(t){var n,r,a,i,s,l,c,{baseURL:d=Pc("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:h=(n=Pc("GEMINI_API_KEY"))!==null&&n!==void 0?n:null,apiVersion:g="v1beta"}=t,m=xl(t,["baseURL","apiKey","apiVersion"]);const _=Object.assign(Object.assign({apiKey:h,apiVersion:g},m),{baseURL:d||"https://generativelanguage.googleapis.com"});this.baseURL=_.baseURL,this.timeout=(r=_.timeout)!==null&&r!==void 0?r:Wl.DEFAULT_TIMEOUT,this.logger=(a=_.logger)!==null&&a!==void 0?a:console;const y="warn";this.logLevel=y,this.logLevel=(s=(i=lg(_.logLevel,"ClientOptions.logLevel",this))!==null&&i!==void 0?i:lg(Pc("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&s!==void 0?s:y,this.fetchOptions=_.fetchOptions,this.maxRetries=(l=_.maxRetries)!==null&&l!==void 0?l:2,this.fetch=(c=_.fetch)!==null&&c!==void 0?c:WN(),this.encoder=KN,this._options=_,this.apiKey=h,this.apiVersion=g,this.clientAdapter=_.clientAdapter}withOptions(t){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),t))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:n}){if(!(t.has("authorization")||t.has("x-goog-api-key"))&&!(this.apiKey&&t.get("x-goog-api-key"))&&!n.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(t){const n=ci([t.headers]);if(!(n.values.has("authorization")||n.values.has("x-goog-api-key"))){if(this.apiKey)return ci([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return ci([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(t){return Object.entries(t).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new fo(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${la}`}defaultIdempotencyKey(){return`stainless-node-retry-${RN()}`}makeStatusError(t,n,r,a){return Hn.generate(t,n,r,a)}buildURL(t,n,r){const a=!this.baseURLOverridden()&&r||this.baseURL,i=jN(t)?new URL(t):new URL(a+(a.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),s=this.defaultQuery();return ON(s)||(n=Object.assign(Object.assign({},s),n)),typeof n=="object"&&n&&!Array.isArray(n)&&(i.search=this.stringifyQuery(n)),i.toString()}async prepareOptions(t){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!t.path.startsWith(`/${this.apiVersion}/projects/`)){const n=t.path.slice(this.apiVersion.length+1);t.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${n}`}}async prepareRequest(t,{url:n,options:r}){}get(t,n){return this.methodRequest("get",t,n)}post(t,n){return this.methodRequest("post",t,n)}patch(t,n){return this.methodRequest("patch",t,n)}put(t,n){return this.methodRequest("put",t,n)}delete(t,n){return this.methodRequest("delete",t,n)}methodRequest(t,n,r){return this.request(Promise.resolve(r).then(a=>Object.assign({method:t,path:n},a)))}request(t,n=null){return new Ku(this,this.makeRequest(t,n,void 0))}async makeRequest(t,n,r){var a,i,s;const l=await t,c=(a=l.maxRetries)!==null&&a!==void 0?a:this.maxRetries;n==null&&(n=c),await this.prepareOptions(l);const{req:d,url:h,timeout:g}=await this.buildRequest(l,{retryCount:c-n});await this.prepareRequest(d,{url:h,options:l});const m="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),_=r===void 0?"":`, retryOf: ${r}`,y=Date.now();if(zn(this).debug(`[${m}] sending request`,Fr({retryOfRequestLogID:r,method:l.method,url:h,options:l,headers:d.headers})),!((i=l.signal)===null||i===void 0)&&i.aborted)throw new Gd;const v=new AbortController,C=await this.fetchWithTimeout(h,d,g,v).catch(zd),w=Date.now();if(C instanceof globalThis.Error){const f=`retrying, ${n} attempts remaining`;if(!((s=l.signal)===null||s===void 0)&&s.aborted)throw new Gd;const T=Fd(C)||/timed? ?out/i.test(String(C)+("cause"in C?String(C.cause):""));if(n)return zn(this).info(`[${m}] connection ${T?"timed out":"failed"} - ${f}`),zn(this).debug(`[${m}] connection ${T?"timed out":"failed"} (${f})`,Fr({retryOfRequestLogID:r,url:h,durationMs:w-y,message:C.message})),this.retryRequest(l,n,r??m);throw zn(this).info(`[${m}] connection ${T?"timed out":"failed"} - error; no more retries left`),zn(this).debug(`[${m}] connection ${T?"timed out":"failed"} (error; no more retries left)`,Fr({retryOfRequestLogID:r,url:h,durationMs:w-y,message:C.message})),T?new cy:new Vl({cause:C})}const b=`[${m}${_}] ${d.method} ${h} ${C.ok?"succeeded":"failed"} with status ${C.status} in ${w-y}ms`;if(!C.ok){const f=await this.shouldRetry(C);if(n&&f){const A=`retrying, ${n} attempts remaining`;return await qN(C.body),zn(this).info(`${b} - ${A}`),zn(this).debug(`[${m}] response error (${A})`,Fr({retryOfRequestLogID:r,url:C.url,status:C.status,headers:C.headers,durationMs:w-y})),this.retryRequest(l,n,r??m,C.headers)}const T=f?"error; no more retries left":"error; not retryable";zn(this).info(`${b} - ${T}`);const I=await C.text().catch(A=>zd(A).message),E=GN(I),R=E?void 0:I;throw zn(this).debug(`[${m}] response error (${T})`,Fr({retryOfRequestLogID:r,url:C.url,status:C.status,headers:C.headers,message:R,durationMs:Date.now()-y})),this.makeStatusError(C.status,E,R,C.headers)}return zn(this).info(b),zn(this).debug(`[${m}] response start`,Fr({retryOfRequestLogID:r,url:C.url,status:C.status,headers:C.headers,durationMs:w-y})),{response:C,options:l,controller:v,requestLogID:m,retryOfRequestLogID:r,startTime:y}}async fetchWithTimeout(t,n,r,a){const i=n||{},{signal:s,method:l}=i,c=xl(i,["signal","method"]);s&&s.addEventListener("abort",()=>a.abort());const d=setTimeout(()=>a.abort(),r),h=globalThis.ReadableStream&&c.body instanceof globalThis.ReadableStream||typeof c.body=="object"&&c.body!==null&&Symbol.asyncIterator in c.body,g=Object.assign(Object.assign(Object.assign({signal:a.signal},h?{duplex:"half"}:{}),{method:"GET"}),c);l&&(g.method=l.toUpperCase());try{return await this.fetch.call(void 0,t,g)}finally{clearTimeout(d)}}async shouldRetry(t){const n=t.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,n,r,a){var i;let s;const l=a==null?void 0:a.get("retry-after-ms");if(l){const d=parseFloat(l);Number.isNaN(d)||(s=d)}const c=a==null?void 0:a.get("retry-after");if(c&&!s){const d=parseFloat(c);Number.isNaN(d)?s=Date.parse(c)-Date.now():s=d*1e3}if(!(s&&0<=s&&s<60*1e3)){const d=(i=t.maxRetries)!==null&&i!==void 0?i:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(n,d)}return await UN(s),this.makeRequest(t,n-1,r)}calculateDefaultRetryTimeoutMillis(t,n){const i=n-t,s=Math.min(.5*Math.pow(2,i),8),l=1-Math.random()*.25;return s*l*1e3}async buildRequest(t,{retryCount:n=0}={}){var r,a,i;const s=Object.assign({},t),{method:l,path:c,query:d,defaultBaseURL:h}=s,g=this.buildURL(c,d,h);"timeout"in s&&zN("timeout",s.timeout),s.timeout=(r=s.timeout)!==null&&r!==void 0?r:this.timeout;const{bodyHeaders:m,body:_}=this.buildBody({options:s}),y=await this.buildHeaders({options:t,method:l,bodyHeaders:m,retryCount:n});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:l,headers:y},s.signal&&{signal:s.signal}),globalThis.ReadableStream&&_ instanceof globalThis.ReadableStream&&{duplex:"half"}),_&&{body:_}),(a=this.fetchOptions)!==null&&a!==void 0?a:{}),(i=s.fetchOptions)!==null&&i!==void 0?i:{}),url:g,timeout:s.timeout}}async buildHeaders({options:t,method:n,bodyHeaders:r,retryCount:a}){let i={};this.idempotencyHeader&&n!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=t.idempotencyKey);const s=await this.authHeaders(t);let l=ci([i,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(a)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),$N()),this._options.defaultHeaders,r,t.headers,s]);return this.validateHeaders(l),l.values}buildBody({options:{body:t,headers:n}}){if(!t)return{bodyHeaders:void 0,body:void 0};const r=ci([n]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&r.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:YN(t)}:this.encoder({body:t,headers:r})}}Wl.DEFAULT_TIMEOUT=6e4;class _n extends Wl{constructor(){super(...arguments),this.interactions=new Ty(this)}}Ny=_n;_n.GeminiNextGenAPIClient=Ny;_n.GeminiNextGenAPIClientError=fo;_n.APIError=Hn;_n.APIConnectionError=Vl;_n.APIConnectionTimeoutError=cy;_n.APIUserAbortError=Gd;_n.NotFoundError=hy;_n.ConflictError=my;_n.RateLimitError=fy;_n.BadRequestError=dy;_n.AuthenticationError=uy;_n.InternalServerError=yy;_n.PermissionDeniedError=py;_n.UnprocessableEntityError=gy;_n.toFile=ek;_n.Interactions=Ty;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function hk(e,t){const n={},r=u(e,["name"]);return r!=null&&p(n,["_url","name"],r),n}function mk(e,t){const n={},r=u(e,["name"]);return r!=null&&p(n,["_url","name"],r),n}function gk(e,t){const n={},r=u(e,["sdkHttpResponse"]);return r!=null&&p(n,["sdkHttpResponse"],r),n}function fk(e,t){const n={},r=u(e,["sdkHttpResponse"]);return r!=null&&p(n,["sdkHttpResponse"],r),n}function yk(e,t,n){const r={};if(u(e,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const a=u(e,["tunedModelDisplayName"]);if(t!==void 0&&a!=null&&p(t,["displayName"],a),u(e,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const i=u(e,["epochCount"]);t!==void 0&&i!=null&&p(t,["tuningTask","hyperparameters","epochCount"],i);const s=u(e,["learningRateMultiplier"]);if(s!=null&&p(r,["tuningTask","hyperparameters","learningRateMultiplier"],s),u(e,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(u(e,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(u(e,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const l=u(e,["batchSize"]);t!==void 0&&l!=null&&p(t,["tuningTask","hyperparameters","batchSize"],l);const c=u(e,["learningRate"]);if(t!==void 0&&c!=null&&p(t,["tuningTask","hyperparameters","learningRate"],c),u(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(u(e,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function xk(e,t,n){const r={};let a=u(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const _=u(e,["validationDataset"]);t!==void 0&&_!=null&&p(t,["supervisedTuningSpec"],dg(_))}else if(a==="PREFERENCE_TUNING"){const _=u(e,["validationDataset"]);t!==void 0&&_!=null&&p(t,["preferenceOptimizationSpec"],dg(_))}const i=u(e,["tunedModelDisplayName"]);t!==void 0&&i!=null&&p(t,["tunedModelDisplayName"],i);const s=u(e,["description"]);t!==void 0&&s!=null&&p(t,["description"],s);let l=u(n,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const _=u(e,["epochCount"]);t!==void 0&&_!=null&&p(t,["supervisedTuningSpec","hyperParameters","epochCount"],_)}else if(l==="PREFERENCE_TUNING"){const _=u(e,["epochCount"]);t!==void 0&&_!=null&&p(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],_)}let c=u(n,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const _=u(e,["learningRateMultiplier"]);t!==void 0&&_!=null&&p(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],_)}else if(c==="PREFERENCE_TUNING"){const _=u(e,["learningRateMultiplier"]);t!==void 0&&_!=null&&p(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],_)}let d=u(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const _=u(e,["exportLastCheckpointOnly"]);t!==void 0&&_!=null&&p(t,["supervisedTuningSpec","exportLastCheckpointOnly"],_)}else if(d==="PREFERENCE_TUNING"){const _=u(e,["exportLastCheckpointOnly"]);t!==void 0&&_!=null&&p(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],_)}let h=u(n,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const _=u(e,["adapterSize"]);t!==void 0&&_!=null&&p(t,["supervisedTuningSpec","hyperParameters","adapterSize"],_)}else if(h==="PREFERENCE_TUNING"){const _=u(e,["adapterSize"]);t!==void 0&&_!=null&&p(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],_)}if(u(e,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(u(e,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const g=u(e,["labels"]);t!==void 0&&g!=null&&p(t,["labels"],g);const m=u(e,["beta"]);return t!==void 0&&m!=null&&p(t,["preferenceOptimizationSpec","hyperParameters","beta"],m),r}function vk(e,t){const n={},r=u(e,["baseModel"]);r!=null&&p(n,["baseModel"],r);const a=u(e,["preTunedModel"]);a!=null&&p(n,["preTunedModel"],a);const i=u(e,["trainingDataset"]);i!=null&&Ik(i);const s=u(e,["config"]);return s!=null&&yk(s,n),n}function bk(e,t){const n={},r=u(e,["baseModel"]);r!=null&&p(n,["baseModel"],r);const a=u(e,["preTunedModel"]);a!=null&&p(n,["preTunedModel"],a);const i=u(e,["trainingDataset"]);i!=null&&Pk(i,n,t);const s=u(e,["config"]);return s!=null&&xk(s,n,t),n}function wk(e,t){const n={},r=u(e,["name"]);return r!=null&&p(n,["_url","name"],r),n}function _k(e,t){const n={},r=u(e,["name"]);return r!=null&&p(n,["_url","name"],r),n}function Ck(e,t,n){const r={},a=u(e,["pageSize"]);t!==void 0&&a!=null&&p(t,["_query","pageSize"],a);const i=u(e,["pageToken"]);t!==void 0&&i!=null&&p(t,["_query","pageToken"],i);const s=u(e,["filter"]);return t!==void 0&&s!=null&&p(t,["_query","filter"],s),r}function Sk(e,t,n){const r={},a=u(e,["pageSize"]);t!==void 0&&a!=null&&p(t,["_query","pageSize"],a);const i=u(e,["pageToken"]);t!==void 0&&i!=null&&p(t,["_query","pageToken"],i);const s=u(e,["filter"]);return t!==void 0&&s!=null&&p(t,["_query","filter"],s),r}function Tk(e,t){const n={},r=u(e,["config"]);return r!=null&&Ck(r,n),n}function Ek(e,t){const n={},r=u(e,["config"]);return r!=null&&Sk(r,n),n}function Nk(e,t){const n={},r=u(e,["sdkHttpResponse"]);r!=null&&p(n,["sdkHttpResponse"],r);const a=u(e,["nextPageToken"]);a!=null&&p(n,["nextPageToken"],a);const i=u(e,["tunedModels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>ky(l))),p(n,["tuningJobs"],s)}return n}function kk(e,t){const n={},r=u(e,["sdkHttpResponse"]);r!=null&&p(n,["sdkHttpResponse"],r);const a=u(e,["nextPageToken"]);a!=null&&p(n,["nextPageToken"],a);const i=u(e,["tuningJobs"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>Bd(l))),p(n,["tuningJobs"],s)}return n}function Ak(e,t){const n={},r=u(e,["name"]);r!=null&&p(n,["model"],r);const a=u(e,["name"]);return a!=null&&p(n,["endpoint"],a),n}function Ik(e,t){const n={};if(u(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(u(e,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const r=u(e,["examples"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(i=>i)),p(n,["examples","examples"],a)}return n}function Pk(e,t,n){const r={};let a=u(n,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const s=u(e,["gcsUri"]);t!==void 0&&s!=null&&p(t,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(a==="PREFERENCE_TUNING"){const s=u(e,["gcsUri"]);t!==void 0&&s!=null&&p(t,["preferenceOptimizationSpec","trainingDatasetUri"],s)}let i=u(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const s=u(e,["vertexDatasetResource"]);t!==void 0&&s!=null&&p(t,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(i==="PREFERENCE_TUNING"){const s=u(e,["vertexDatasetResource"]);t!==void 0&&s!=null&&p(t,["preferenceOptimizationSpec","trainingDatasetUri"],s)}if(u(e,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function ky(e,t){const n={},r=u(e,["sdkHttpResponse"]);r!=null&&p(n,["sdkHttpResponse"],r);const a=u(e,["name"]);a!=null&&p(n,["name"],a);const i=u(e,["state"]);i!=null&&p(n,["state"],Vf(i));const s=u(e,["createTime"]);s!=null&&p(n,["createTime"],s);const l=u(e,["tuningTask","startTime"]);l!=null&&p(n,["startTime"],l);const c=u(e,["tuningTask","completeTime"]);c!=null&&p(n,["endTime"],c);const d=u(e,["updateTime"]);d!=null&&p(n,["updateTime"],d);const h=u(e,["description"]);h!=null&&p(n,["description"],h);const g=u(e,["baseModel"]);g!=null&&p(n,["baseModel"],g);const m=u(e,["_self"]);return m!=null&&p(n,["tunedModel"],Ak(m)),n}function Bd(e,t){const n={},r=u(e,["sdkHttpResponse"]);r!=null&&p(n,["sdkHttpResponse"],r);const a=u(e,["name"]);a!=null&&p(n,["name"],a);const i=u(e,["state"]);i!=null&&p(n,["state"],Vf(i));const s=u(e,["createTime"]);s!=null&&p(n,["createTime"],s);const l=u(e,["startTime"]);l!=null&&p(n,["startTime"],l);const c=u(e,["endTime"]);c!=null&&p(n,["endTime"],c);const d=u(e,["updateTime"]);d!=null&&p(n,["updateTime"],d);const h=u(e,["error"]);h!=null&&p(n,["error"],h);const g=u(e,["description"]);g!=null&&p(n,["description"],g);const m=u(e,["baseModel"]);m!=null&&p(n,["baseModel"],m);const _=u(e,["tunedModel"]);_!=null&&p(n,["tunedModel"],_);const y=u(e,["preTunedModel"]);y!=null&&p(n,["preTunedModel"],y);const v=u(e,["supervisedTuningSpec"]);v!=null&&p(n,["supervisedTuningSpec"],v);const C=u(e,["preferenceOptimizationSpec"]);C!=null&&p(n,["preferenceOptimizationSpec"],C);const w=u(e,["tuningDataStats"]);w!=null&&p(n,["tuningDataStats"],w);const b=u(e,["encryptionSpec"]);b!=null&&p(n,["encryptionSpec"],b);const f=u(e,["partnerModelTuningSpec"]);f!=null&&p(n,["partnerModelTuningSpec"],f);const T=u(e,["customBaseModel"]);T!=null&&p(n,["customBaseModel"],T);const I=u(e,["experiment"]);I!=null&&p(n,["experiment"],I);const E=u(e,["labels"]);E!=null&&p(n,["labels"],E);const R=u(e,["outputUri"]);R!=null&&p(n,["outputUri"],R);const N=u(e,["pipelineJob"]);N!=null&&p(n,["pipelineJob"],N);const A=u(e,["serviceAccount"]);A!=null&&p(n,["serviceAccount"],A);const k=u(e,["tunedModelDisplayName"]);k!=null&&p(n,["tunedModelDisplayName"],k);const P=u(e,["veoTuningSpec"]);return P!=null&&p(n,["veoTuningSpec"],P),n}function Rk(e,t){const n={},r=u(e,["sdkHttpResponse"]);r!=null&&p(n,["sdkHttpResponse"],r);const a=u(e,["name"]);a!=null&&p(n,["name"],a);const i=u(e,["metadata"]);i!=null&&p(n,["metadata"],i);const s=u(e,["done"]);s!=null&&p(n,["done"],s);const l=u(e,["error"]);return l!=null&&p(n,["error"],l),n}function dg(e,t){const n={},r=u(e,["gcsUri"]);r!=null&&p(n,["validationDatasetUri"],r);const a=u(e,["vertexDatasetResource"]);return a!=null&&p(n,["validationDatasetUri"],a),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Mk extends tr{constructor(t){super(),this.apiClient=t,this.list=async(n={})=>new Qr(Zo.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.get=async n=>await this.getInternal(n),this.tune=async n=>{var r;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const a={tunedModelName:n.baseModel};!((r=n.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(a.checkpointId=n.config.preTunedModelCheckpointId);const i=Object.assign(Object.assign({},n),{preTunedModel:a});return i.baseModel=void 0,await this.tuneInternal(i)}else{const a=Object.assign({},n);return await this.tuneInternal(a)}else{const a=Object.assign({},n),i=await this.tuneMldevInternal(a);let s="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?s=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(s=i.name.split("/operations/")[0]),{name:s,state:Pd.JOB_STATE_QUEUED}}}}async getInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=_k(t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>Bd(h))}else{const d=wk(t);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>ky(h))}}async listInternal(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=Ek(t);return l=Ye("tuningJobs",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=kk(h),m=new Dm;return Object.assign(m,g),m})}else{const d=Tk(t);return l=Ye("tunedModels",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=Nk(h),m=new Dm;return Object.assign(m,g),m})}}async cancel(t){var n,r,a,i;let s,l="",c={};if(this.apiClient.isVertexAI()){const d=mk(t);return l=Ye("{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=fk(h),m=new Om;return Object.assign(m,g),m})}else{const d=hk(t);return l=Ye("{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(a=t.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(i=t.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(g=>{const m=g;return m.sdkHttpResponse={headers:h.headers},m})),s.then(h=>{const g=gk(h),m=new Om;return Object.assign(m,g),m})}}async tuneInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI()){const l=bk(t,t);return i=Ye("tuningJobs",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),a.then(c=>Bd(c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var n,r;let a,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=vk(t);return i=Ye("tunedModels",l._url),s=l._query,delete l._url,delete l._query,a=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=t.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:c.headers},h})),a.then(c=>Rk(c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class jk{async download(t,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const Lk=1024*1024*8,Dk=3,Ok=1e3,Fk=2,bl="x-goog-upload-status";async function zk(e,t,n){var r;const a=await Ay(e,t,n),i=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[bl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return i.file}async function Gk(e,t,n){var r;const a=await Ay(e,t,n),i=await(a==null?void 0:a.json());if(((r=a==null?void 0:a.headers)===null||r===void 0?void 0:r[bl])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const s=Ff(i),l=new Hu;return Object.assign(l,s),l}async function Ay(e,t,n){var r,a;let i=0,s=0,l=new Rd(new Response),c="upload";for(i=e.size;s<i;){const d=Math.min(Lk,i-s),h=e.slice(s,s+d);s+d>=i&&(c+=", finalize");let g=0,m=Ok;for(;g<Dk&&(l=await n.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(s),"Content-Length":String(d)}}}),!(!((r=l==null?void 0:l.headers)===null||r===void 0)&&r[bl]));)g++,await Hk(m),m=m*Fk;if(s+=d,((a=l==null?void 0:l.headers)===null||a===void 0?void 0:a[bl])!=="active")break;if(i<=s)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return l}async function Uk(e){return{size:e.size,type:e.type}}function Hk(e){return new Promise(t=>setTimeout(t,e))}class Bk{async upload(t,n,r){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await zk(t,n,r)}async uploadToFileSearchStore(t,n,r){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await Gk(t,n,r)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await Uk(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Vk{create(t,n,r){return new $k(t,n,r)}}class $k{constructor(t,n,r){this.url=t,this.headers=n,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ug="x-goog-api-key";class Wk{constructor(t){this.apiKey=t}async addAuthHeaders(t,n){if(t.get(ug)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");t.append(ug,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Yk="gl-node/";class qk{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const t=this.httpOptions;t!=null&&t.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const n=new _n({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:t==null?void 0:t.timeout});return this._interactions=n.interactions,this._interactions}constructor(t){var n;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=t.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=t.apiKey;const r=Hw(t.httpOptions,t.vertexai,void 0,void 0);r&&(t.httpOptions?t.httpOptions.baseUrl=r:t.httpOptions={baseUrl:r}),this.apiVersion=t.apiVersion,this.httpOptions=t.httpOptions;const a=new Wk(this.apiKey);this.apiClient=new UE({auth:a,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:Yk+"web",uploader:new Bk,downloader:new jk}),this.models=new iN(this.apiClient),this.live=new eN(this.apiClient,a,new Vk),this.batches=new yC(this.apiClient),this.chats=new ZC(this.models,this.apiClient),this.caches=new KC(this.apiClient),this.files=new lS(this.apiClient),this.operations=new sN(this.apiClient),this.authTokens=new CN(this.apiClient),this.tunings=new Mk(this.apiClient),this.fileSearchStores=new PN(this.apiClient)}}const Yt=()=>{const e=localStorage.getItem("gemini-api-key"),t=e&&e.trim()!==""?e:null;if(!t)throw console.error("Script Modifier: API Key is missing. Please enter it in the application settings."),new Error("API Key not found. Please set it in Settings.");return new qk({apiKey:t})},qt=async(e,t=3,n=1e3)=>{try{return await e()}catch(r){if(t>0&&(r.status===429||r.status>=500))return await new Promise(a=>setTimeout(a,n)),qt(e,t-1,n*2);throw r}},yo=e=>{if(!e)return"{}";let t=e.replace(/```json\n?/g,"").replace(/```\n?/g,"");const n=t.indexOf("["),r=t.lastIndexOf("]"),a=t.indexOf("{"),i=t.lastIndexOf("}");let s=-1,l=-1;return n!==-1&&(a===-1||n<a)?r!==-1&&r>n&&(s=n,l=r+1):a!==-1&&i!==-1&&i>a&&(s=a,l=i+1),s!==-1&&l!==-1?t.substring(s,l):t.trim()},Xi=(e,t=null)=>{const n=yo(e);try{return JSON.parse(n)}catch(r){const a=n.replace(/([{,]\s*)([a-zA-Z0-9_]+?)\s*:/g,'$1"$2":');try{return JSON.parse(a)}catch{const s=a.replace(/,\s*([\]}])/g,"$1");try{return JSON.parse(s)}catch{if(console.error("JSON Parse failed after fixes:",r),t!==null)return t;throw r}}}},Ju=`**MASTER CONSTRUCTION ALGORITHM (Unified Flow):**

Construct the final prompt as a **SINGLE, SEAMLESS BLOCK of descriptive text**. 

**CRITICAL GROUPING BAN:** You are FORBIDDEN from grouping subjects grammatically (e.g. 'Entity-1 and Entity-2 are running'). You MUST describe them SEQUENTIALLY.

**MANDATORY SEQUENCE:**
1. **[Master Set Design/Background]**
2. **[Subject 1: FULL BODY POSE & ACTION]** (Even if not fully visible)
3. *...interaction connector...*
4. **[Subject 2: FULL BODY POSE & ACTION]**
5. **[Specific Focus/Detail]** (If Close-Up)
6. **[Technical/Camera]**.

**LOGIC:**
- **Environment:** Establish the physical set first. 
- **Invisible Context:** You MUST describe the full posture (kneeling, running, slumped) BEFORE describing facial details, otherwise the AI generates a T-Pose.
- **Technical:** End with lens/angle.`,Xu=`**MASTER CONSTRUCTION ALGORITHM (No Entity Vis):**

Construct the final prompt as a **SINGLE, SEAMLESS BLOCK of descriptive text**. 

**CRITICAL GROUPING BAN:** You are FORBIDDEN from grouping subjects (e.g., 'Entity-1 and Entity-2 are running' is WRONG). You MUST iterate through them individually.

**MANDATORY SEQUENCE:**
1. **[Master Set Design/Background]**
2. **[Index-1] + [FULL BODY POSE & ACTION]**
3. *...spatial relation...*
4. **[Index-2] + [FULL BODY POSE & ACTION]**
5. **[Specific Focus/Detail]**
6. **[Technical/Camera]**.

**MANDATORY:** You MUST describe the physical body geometry (e.g., 'knees bent at 90 degrees', 'arms outstretched', 'jaw dropped') for EACH index separately.`,ne={INPUTS:{id:"inputs",label:"Inputs",text:"Source Data: Script Frames, Entity Visuals, Scene Style, Master Set Design (Context)."},ROLE:{id:"role_artist",label:"Role",text:"You are a Lead Keyframe Technical Director and AI Prompt Engineer. Your task is to generate a RAW TECHNICAL IMAGE PROMPT for a STATIC frame. Do not write introductory text. Do not use literary devices or abbreviations. Output ONLY the prompt content."},NO_POV:{id:"no_pov",label:"No POV",text:"**CRITICAL NEGATIVE CONSTRAINT: NO POV SHOTS.** You are strictly FORBIDDEN from generating 'Point of View', 'POV', or 'First Person' shots. The camera must ALWAYS be external to the subject. Do not use phrases like 'seen through eyes', 'view from', or 'hands entering frame'. Describe the scene from an objective, third-person cinematic angle."},STATIC_STATE:{id:"rule_static",label:"Static Only",text:"**CRITICAL RULE: NO NARRATIVE TRANSITIONS.** Do not use words like 'suddenly', 'instantly', 'begins to', 'changed', 'transitioned'. Describe the current visual STATE. Describe physical anatomy and stance."},ATMOSPHERIC_FIX:{id:"rule_atmosphere",label:"Fixed Atmosphere",text:"ATMOSPHERIC ANCHOR: Describe the current mood as a physical property of the air and light (e.g., fog density, light color, particulate matter). Do not describe how it 'became' this way."},STATELESS:{id:"rule_stateless",label:"Self-Contained",text:`**CRITICAL RULE: VISUAL STATELESSNESS.** You are strictly FORBIDDEN from using referential literary shortcuts. Every prompt is an independent technical document. DO NOT use words like 'same', 'opposite', 'continues', 'there', 'before', 'also'. You MUST fully redescribe the setting for every single frame as if the previous one never existed.

**MANDATORY ACTION RESET:** You must also fully redescribe the ACTION of EVERY entity from scratch. Describe the action hierarchy from **General to Specific**: 1. Full Body Posture. 2. Limb Action. 3. Facial Expression. Never abbreviate or omit the subject's physical state.`},SUBJECT_FOCUS:{id:"rule_subject_detail",label:"Invisible Context",text:`**CRITICAL: INVISIBLE BODY CONTEXT.** The Image Generator assumes a T-Pose if you don't describe the body. 
**RULE:** Even for Close-Ups (CU/ECU) of a face or object, you **MUST** describe the full body pose of the subject FIRST.
- **WRONG:** 'Close-up of Entity-1 smiling'. (Result: Floating head or T-Pose).
- **RIGHT:** 'Entity-1 is leaning forward over a table, shoulders hunched, weight on elbows. Close-up of Entity-1 smiling'.
*Always anchor the detail to a full physical posture.*`},STRICT_CHAR_INDEX:{id:"strict_char_index",label:"Entity Index",text:"Entities are identified by their index (Entity-N). Map these to the provided visual profiles perfectly."},GENERAL_CHAR_DESC:{id:"general_char_desc",label:"General Detail",text:"Summarize and incorporate a CONCISE, GENERAL version of the visual prompt from the character's profile."},FULL_CHAR_DESC:{id:"full_char_desc",label:"Full Detail",text:"Incorporate the FULL and DETAILED visual prompt from the entity's profile exactly as written."},NO_NAMES:{id:"rule_no_names",label:"No Names (English Tags)",text:"**CRITICAL: ABSOLUTE NAME BAN & BRACKETS.** You are strictly FORBIDDEN from including character names in the output. You MUST refer to characters ONLY by their Entity Index ID **enclosed in square brackets** (e.g., `[Entity-1]`, `[Entity-2]`). \n**ENGLISH TAGS ONLY:** The tag inside the brackets MUST remain in English (e.g., `[Entity-1]`), even if the rest of the prompt is in another language. DO NOT translate 'Entity'."},ALWAYS_ENV:{id:"rule_always_env",label:"Mandatory Set Design",text:`**CRITICAL RULE: MANDATORY SET DESIGN INJECTION.** The provided 'Global Scene Context' is the **PHYSICAL TRUTH**. You MUST incorporate its specific details (Furniture type/color, Floor texture, Wall material, Lighting source) into the environment layer of EVERY prompt.

**HIERARCHY:**
1. **SET DESIGN:** Establish the room/location details from the Context FIRST.
2. **DEPTH:** Then describe Far -> Mid -> Near elements.

*Do not hallucinate a generic background. Use the specific one provided.*`},LAYERED_CONSTRUCTION:{id:"rule_layers",label:"Layered",text:`**MASTER CONSTRUCTION ALGORITHM (Unified Flow):**

Construct the final prompt as a **SINGLE, SEAMLESS BLOCK of descriptive text**. 

**CRITICAL GROUPING BAN:** You are FORBIDDEN from grouping subjects (e.g. '[Entity-1] and [Entity-2]'). Describe them SEQUENTIALLY.

**STRUCTURE:**
1. **[Style]**
2. **[Master Set Design/Background]**
3. **[Subject 1 Visuals] + [Subject 1 FULL BODY POSE & ACTION]**
4. **[Subject 2 Visuals] + [Subject 2 FULL BODY POSE & ACTION]**
5. **[Specific Focus/Detail]** (If Close-Up)
6. **[Technical/Camera]**.

**LOGIC:**
- **Environment:** Start with the specific physical set details.
- **Subjects:** For EACH index, explicitly describe body geometry (e.g. 'kneeling', 'reaching', 'twisted torso') BEFORE describing face or details.
- **Technical:** End with lens, angle, and quality tags.`},VISUAL_SATURATION:{id:"rule_saturation",label:"Saturation",text:"Use technical descriptors: anamorphic flares, chromatic aberration, ray-tracing, sub-surface scattering."},PROCESS_WHOLE_SCENE:{id:"process_whole_scene",label:"Batch Scene",text:"Analyze all frames of a scene together for visual consistency."},GENERATE_VIDEO_PROMPT:{id:"generate_video",label:"Video Prompt",text:`Generate separate technical video prompt: 
**STRICT FORMATTING RULES:**
1. **SUBJECTS & ACTIONS:** DO NOT use names. Use ONLY Index in brackets (e.g. \`[Entity-1]\`). Format: \`[Entity-Index] (A detailed visual description of appearance, outfit, textures, and species) performs [Detailed Action]\`. 
2. **VISUAL DETAIL:** The visual description inside the video prompt MUST be extensive enough for the video model to understand the entity without external context.
3. **DYNAMICS:** Dynamics: [Describe environment motion, wind, light shifts].
4. **CAMERA:** Camera: [Movement].`},BREAK_PARAGRAPHS:{id:"break_paragraphs",label:"Formatting",text:`**FORMATTING OVERRIDE:**
Ignore the 'seamless block' rule. You MUST structure the output into distinct sections using explicit headers and line breaks:

**ENVIRONMENT:** [Set Design & Description]
**INTERACTION:** [Entities & Action Description]
**TECHNICAL:** [Camera & Style]`},ANTHRO_REINFORCEMENT:{id:"pm_anthro",label:"Anthro Detail",text:"**ANTHROPOMORPHIC ENFORCEMENT:** You MUST explicitly insert the word 'anthropomorphic' before the species name in BOTH the final 'imagePrompt' AND the 'videoPrompt'. Emphasize animal textures (fur, scales, etc.) and correct anatomical blending in all output fields."},SUBSCRIBE_REINFORCEMENT:{id:"pm_subscribe",label:"Legible Text",text:"**TEXT RENDERING ENHANCEMENT:** If the scene involves 'Subscribe' or 'Like', ensure the text is visible and legible. Use keywords: 'text label', 'signboard', 'neon typography', 'legible font', 'bold letters', 'typographic composition'."},ANATOMICAL_STRICTNESS:{id:"anatomical_strictness",label:"Anatomy Logic",text:`**CRITICAL: INDIVIDUAL PHYSICS.** Treat every entity as a separate 3D object.
1. **NO SHARED VERBS:** Never say 'they looked'. Say '[Entity-1] looked left, [Entity-2] looked right'.
2. **LIMB PLACEMENT:** Describe the exact position of arms and legs for EACH entity separately. 
3. **EMOTION:** Assign a specific facial muscle description to EACH entity (e.g. '[Entity-1] brow furrowed', '[Entity-2] smiling broadly').`},PROP_ENHANCEMENT:{id:"prop_enhancement",label:"Prop Materiality",text:"**PROP MATERIALITY & TEXTURE:** Amplify the physical presence of specific objects mentioned in the input. If the input specifies an object, you must describe the *interaction of light* with that specific material. **MANDATORY:** You must preserve the specific Object Type and Color defined in the input. Do not randomize objects."},IMG_VID_CONSISTENCY:{id:"img_vid_consistency",label:"Img-Vid Flow",text:`**RULE: START-TO-MOTION CONTINUITY.** The 'imagePrompt' describes the **INITIAL STATIC STATE (Frame 0/Start Frame)**. The 'videoPrompt' describes the **IMMEDIATE ACTION** occurring *after* that frame. 
- **Image:** Describe potential energy/static setup.
- **Video:** Describe the kinetic release/movement.

Do not describe the movement in the image prompt (keep it static). Do not describe the static setup in the video prompt (describe the evolution).`}},qe={INPUTS_DATA:{id:"sg_inputs",text:"Source Data: Concept/Idea, Character Profiles."},CORE:{id:"core_director",text:`You are NOT a cameraman. You are a PHYSICAL OBSERVER. 
**YOUR GOAL:** Describe the PHYSICAL REALITY of the scene.
**FORBIDDEN:** Metaphors, invisible feelings, and abstract summaries.
**REQUIRED:** Physical muscle movements, contact between surfaces, light hitting textures.`},ANALYSIS:{id:"sg_thinking",label:"Visual Logic",text:"LOGIC: Before writing, visualize the set. Where is the light coming from? What objects are present? If a character is performing an action, what specific tools are they using? Describe the physics of the scene."},IMPROVE_CONCEPT:{id:"sg_improve_input",label:"Creative Expansion",text:`**CRITICAL RULE: THE PROMPT IS SACRED.** 
1. **PRESERVATION:** You must incorporate EVERY visual detail, object, color, and specific action mentioned in the user's input. Do not skip "small" details like smells or background items.
2. **EXPANSION:** After preserving the original details, you MUST flesh them out with cinematic lighting, texture, and micro-movements.`},ANTI_COMPRESSION:{id:"sg_anti_compression",text:`**CRITICAL: ZERO OMISSION POLICY.** 
You are strictly FORBIDDEN from summarizing, compressing, or omitting details. 
- If the input lists specific items (e.g., 'rabbits, foxes, deer'), you MUST list them all.
- If the input describes a background room (e.g., 'living room with fireplace'), you MUST describe it.
**RULE: The output description MUST be longer and more detailed than the input.**`},EXPOSITION:{id:"sg_exposition",label:"Atmospheric Entry",text:"**MANDATORY OPENING BEAT:** Every scene description MUST start with 2-3 sentences establishing the location, mood, and lighting **BEFORE** the main character acts. Establish the world first."},DELAYED_REVEAL:{id:"sg_delayed_reveal",label:"Progressive Detail",text:"**SEQUENCE:** Describe the environment -> Then the action -> Then the character's reaction. Do not rush to the face."},VISUAL_METAPHOR:{id:"sg_metaphor",label:"Visual Proxies",text:"**VISUAL PROXIES FOR EMOTION:** Do not write abstract emotional states. Describe physical symptoms of that emotion (posture, facial muscle tension, sweat, breath visibility)."},PACING_RHYTHM:{id:"sg_pacing",label:"Action Atomization",text:`**CRITICAL: ACTION ATOMIZATION.** Never summarize an activity. Break it down into physical steps. 
**Expand every verb into a sequence of constituent motions.**`},SUBTEXT:{id:"sg_subtext",label:"Subtext",text:"SUBTEXT: Visual actions should tell the story. Use physical interactions with the environment to convey internal state."},FRAME_ESTIMATION:{text:`**CRITICAL: REALISTIC FRAME COUNT.** Analyze the 'Visual Density' of the scene description to set 'recommendedFrames'. Be conservative. Do not hallucinate length.
- **LOW DENSITY (Dialogue/Simple Action):** 2-5 Frames.
- **MID DENSITY (Interaction/Activity):** 6-10 Frames.
- **HIGH DENSITY (Complex Action/Montage):** 11-16 Frames.`},VISUALS_FIRST:{id:"rule_visuals",label:"Physics Only",text:"Describe Physics, not Vibes. Describe the behavior of light, particles, and textures."},VISUAL_DNA:{id:"sg_visual_dna",label:"Visual DNA",text:"**LIGHTING & TEXTURE:** Every scene description MUST include specific references to: 1. Light sources. 2. Surface textures and materials."},SEAMLESS_FLOW:{id:"rule_flow",label:"Continuity",text:"Ensure objects established in the beginning remain present throughout the scene description unless removed."},ATMOSPHERE:{id:"rule_atmosphere",label:"Atmosphere",text:"PARTICLE EFFECTS & SENSES: Mention airborne elements if applicable: dust, smoke, steam, snow, rain. Preserve described smells and sounds by converting them into visual cues (e.g. 'steam rising from cinnamon buns')."},NO_CAMERA_DIRECTIVES:{text:`**STRICT BAN ON CAMERA TERMS:** You are FORBIDDEN from using words like 'Camera', 'Shot', 'Pan', 'Zoom', 'Close-up', 'Wide', 'Angle'. 
Describe the **Subject** and the **Environment**, never the lens.`},OBJECT_AGENCY:{text:`**CRITICAL PHYSICS RULE:** Inanimate objects DO NOT MOVE ON THEIR OWN. 
ALWAYS attribute action to a character's body part unless it is falling via gravity.`},LIVING_WORLD:{text:"BACKGROUND: If the scene is not a close-up, briefly describe what is behind the character. Don't leave it as 'background'."},SCENELESS_MODE:{text:"**MODE: ASSET LIST.** Generate a sequential list of visual assets/locations based on the input. Focus purely on the visual description."},SIMPLE_ACTIONS:{text:"Keep poses stable and renderable. Avoid blurring motion."},COMMERCIAL_SAFE:{id:"commercial_safe",text:"**NO BRANDS:** Replace specific brands with generic physical descriptions."},STRICT_NAME_PERSISTENCE:{text:"**CRITICAL ENTITY NAMING RULE:** Use `Entity-N` tags **ONLY** for the characters/items explicitly listed in the provided 'CAST LIST'. \n**FORBIDDEN:** Do NOT invent new tags (like `Entity-2`, `Entity-3`) for objects, props, or background elements that are NOT in the Cast List. Refer to them by their generic names (e.g., 'a sword', 'a table').\n**CORRECT:** 'Entity-1 picks up a sword.' \n**INCORRECT:** 'Entity-1 picks up Entity-2.'"},SCENE_CHARACTERS_LIST:{text:"**CRITICAL JSON REQUIREMENT:** The `characters` array in each scene must contain **ONLY** the `Entity-N` tags from the CAST LIST that participate in that scene. Do not include tags for props or objects."}},wt={SMART_CONCEPT:{id:"char_smart_concept",text:"VISUAL LOGIC: Determine if the entity is a sentient character or a static object/item. If it's a CHARACTER: append ', full body character concept on a gray background'. If it's an OBJECT/ITEM: append ', centered object concept, fill the frame, macro focus, on a gray background'. Never mix these two styles."},MAIN_CHAR_LOGIC:{id:"create_main_chars",text:"MAIN CHARACTER GENERATION: You MUST generate detailed profiles for the MAIN protagonists/antagonists based on the story concept. Do not generate generic background characters here. Focus on the core cast."},SECONDARY_CHARS:{id:"create_secondary_chars",text:'You MAY generate new secondary characters if the plot requires it. \n**OUTFIT CHANGES:** If a main character changes outfit, you MUST generate a NEW entity entry for them. \n**NAMING RULE FOR OUTFIT CHANGES:** You MUST append the look name in parentheses. Format: `"Name (Look Name)"` (e.g., `"Batman (Tuxedo)"`). This allows the system to distinguish it from the original.'},KEY_ITEMS_LOGIC:{id:"create_key_items",text:`KEY ITEM GENERATION RULE: You MUST generate a specific object/item as a separate entry in the 'detailedCharacters' array if it is visually significant. 

**MANDATORY FIELDS FOR ITEMS:**
1. **name**: Name of the item.
2. **fullDescription**: Detailed physical description (Materials, colors, state of wear).
3. **prompt**: A precise visual prompt for image generation.`},STRICT_NO_NEW:{text:"**ABSOLUTE PROHIBITION ON NEW ENTITIES:** \n1. **CLOSED SYSTEM:** You are working with a CLOSED CAST. You CANNOT add, invent, or tag any new entities, characters, or items.\n2. **PROPS ARE JUST TEXT:** Items like 'fish', 'meat', 'slipper' MUST remain as plain text descriptions. Do NOT assign them an `Entity-N` tag.\n3. **SINGLE SOURCE:** If the input list only has `Entity-1`, your output MUST ONLY contain `Entity-1`. Any appearance of `Entity-2` is a hallucination and a critical failure."},NO_DUPLICATES:{id:"char_no_dupes",text:'CRITICAL: Do NOT output an entity in `detailedCharacters` if it exactly matches the name of an entity in the Input List. \n**EXCEPTION:** If the character has a new outfit/look, you MUST create a new entry with the format `"Name (Look Name)"`. This distinction is required to create a new card.'},DETAILED_STYLE:{id:"char_detailed_style",label:"Stylized Detail",text:"CHARACTER PROMPT MASTERING: For the 'prompt' field of each entity, generate an extremely detailed visual description. You MUST infuse this description with the 'visualStyle' technical parameters. Describe textures of skin/clothing, eye reflections, and surface shaders that match the chosen aesthetic."}},we={INPUTS:{id:"inputs_data",text:"Source Data: Script Summary, Entity Profiles, Scene Texts."},ROLE:{id:"ana_role",text:"You are a world-class Film Director and Cinematographer (DoP). Your task is to write precise technical instructions for an AI Image Generator and an AI Video Generator. Each frame must be described repeatedly and in detail, independently of the previous one, while maintaining the context of previous frames. Do not use literary abbreviations or devices."},NO_POV:{text:`**CRITICAL NEGATIVE CONSTRAINT: NO POV/FIRST-PERSON.** You are strictly FORBIDDEN from generating 'Point of View' shots. The camera must ALWAYS be an external observer. 
1. **FORBIDDEN PHRASES:** 'looking down at', 'seen through eyes', 'view from', 'my hands'. 
2. **CORRECTION:** Describe the subject's position relative to the environment and the camera angle (e.g., 'Close-up high angle', 'Side view'). 
3. **CAMERA:** Always position the camera as a Third-Person observer (Over-the-Shoulder, Side, Front, High Angle).`},CINEMATOGRAPHY:{id:"ana_cinema",text:"Use professional terms for framing, lighting and PERSPECTIVE. \n**CRITICAL FORMATTING RULE:** Determine the Shot Type (WS, CU, etc.) and put it **ONLY** in the `shotType` JSON field. \n**FORBIDDEN:** Do NOT write 'Wide Shot', 'Close-up', or 'WS' inside the `imagePrompt` text. The `imagePrompt` must contain ONLY the visual description of the scene content."},CINEMATOGRAPHY_WIDE:{id:"ana_cinema_wide",text:`Use professional terms for framing and spatial geometry. 
1. **FRAMING:** Wide Shot, Long Shot, Establishing Shot. (NO Close-ups). 
2. **ANGLES:** Aerial, Bird's Eye, Worm's Eye, Low Angle, Side Tracking. 
3. **PERSPECTIVE:** Full Body Side View, Full Body Rear View, Distant Frontal.`},STATIC_FRAME_LOGIC:{id:"static_frame_logic",label:"Strict Static",text:`**CRITICAL: STATIC FRAME RULE.** You are writing instructions for an AI Image Generator, NOT a novel for humans. Describe a single MICRO-SECOND frozen in time. 
1. **BAN PROGRESSIVE VERBS:** Forbidden words: 'walking', 'swaying', 'crashing', 'moving', 'begins to'. 
2. **USE STATE DESCRIPTORS:** Describe the suspended physical state of elements (e.g., 'frozen', 'suspended', 'leaning', 'angled'). 
3. **ADJECTIVE OVER VERB:** Focus on color, texture, and geometry.`},ANATOMICAL_POSING:{id:"anatomical_posing",label:"Anatomical Posing",text:`**CRITICAL: ANATOMICAL RIGGING.** Do not use abstract literary actions. You MUST describe the GEOMETRY of the body.
1. **HIERARCHY:** Describe General Posture -> Specific Limb Placement -> Facial Muscle State.
2. **PRECISION:** Specify the angle and direction of limbs relative to the torso.`},ANATOMICAL_STRICTNESS:{id:"anatomical_strictness",label:"Anatomy Logic",text:`**CRITICAL: LIMB BUDGET & LOGIC.** You act as a 3D Rigger. An entity has only 2 hands (unless specified otherwise).
1. **CALCULATE:** If a hand is holding an object, it CANNOT be doing something else. 
2. **SEPARATE:** Forbidden to use plural 'Arms' or 'Hands' if they do different things. 
3. **SYNTAX:** Explicitly describe: 'Left Hand [State/Action], Right Hand [State/Action]'. 
4. **ELIMINATE HALLUCINATIONS:** Ensure the pose is physically possible.`},PROP_CONSISTENCY:{id:"prop_consistency",label:"Object Specificity",text:`**CRITICAL: OBJECT SPECIFICITY & LOCK.** When an entity interacts with an item, you MUST assign it concrete Visual Attributes immediately: **Color, Material, Texture**. 
1. **BAN GENERIC NOUNS:** Never write just the object name. 
2. **REQUIREMENT:** Define the material properties (e.g., 'cracked black plastic', 'glossy white fiberglass'). 
3. **LOCK:** Once defined, this specific description (Color/Material) MUST be repeated in EVERY subsequent frame where the object appears.`},SUBJECT_HIERARCHY:{id:"subject_hierarchy",label:"Context Anchoring",text:`**CRITICAL: INVISIBLE CONTEXT & INTERACTION.** Even for Close-Ups or details, you MUST explicitly state the entity's FULL BODY ACTION, even if it is out of frame.
**FORMAT:** \`[Subject] + [FULL BODY POSTURE] + [Specific Detail]\`.
**EXAMPLE:** Instead of 'Close-up of boots sinking in snow', write: 'Entity-2 is leaning forward, dragging a heavy weight, muscles tensed. Close-up of boots sinking deep into the snow'.
*Never describe a part without the action of the whole.*`},MOTION_DYNAMICS:{id:"motion_dynamics",label:"Motion Dynamics",text:`**DYNAMICS SEPARATION:** 
- The 'imagePrompt' MUST be 100% static (Frozen). 
- The 'videoPrompt' (Dynamics) field is the ONLY place for movement. Describe the flow of time here.`},HIERARCHY:{id:"rule_hierarchy",text:`**MASTER FRAMING ALGORITHM (General-to-Specific):** For EVERY single frame, you must construct the description in this strict order:
1. **GLOBAL CONTEXT:** Location, Weather, Lighting.
2. **FULL POSTURE & INTERACTION:** Describe the entity's full body state AND what they are interacting with (e.g., 'dragging Entity-3'), regardless of shot size.
3. **DETAILED PROP:** Describe the object involved in the interaction (Material/Texture).
4. **FOCUS DETAIL:** The specific detail visible in the shot (e.g., 'rubber soles crushing snow').

*Ensure the causal link between the action (dragging) and the detail (boots sinking) is explicit.*`},STATE_PERSISTENCE:{id:"rule_persistence",text:"SCENE-WIDE CHRONOLOGICAL PERSISTENCE: Maintain a persistent global state for the entire scene. Every frame is part of a single physical space. Track the exact position, pose, and status of every entity and object, even when they are off-camera. If an object is moved, it stays moved. Ensure total continuity across the sequence."},RULE_ISOLATION:{id:"rule_isolation",label:"Zero Context",text:"**CRITICAL RULE: ZERO CONTEXT ASSUMPTION.** The image generator DOES NOT know the previous frame exists. You cannot say 'it continues' or 'she does the same'. You MUST re-describe everything. DO NOT ASSUME CONTEXT. REPEAT IT."},SENSORY_SATURATION:{id:"sensory_saturation",label:"Anti-Brevity",text:"**CRITICAL RULE: ANTI-BREVITY & SENSORY DETAIL**. You are forbidden from being concise. Expand every description. Describe textures, lighting interaction, and physical weight. Minimum 15 words per action description."},MANDATORY_BG:{id:"rule_mandatory_bg",text:`**CRITICAL: DETAILED SET DESIGN & CONTEXT.** The scene context is NOT just a background; it is a physical set. 
1. **LOCATION & GEOMETRY:** Define if Indoors/Outdoors. Define room shape, ceiling height, and boundaries.
2. **FURNITURE & PROPS:** You MUST describe the SIZE, COLOR, MATERIAL, and POSITION of every major object (e.g., NOT 'a sofa', BUT 'a massive L-shaped crimson velvet sofa in the corner'). Describe specific floor textures (e.g., 'worn beige wool carpet').
3. **LIGHTING & PALETTE:** Define the exact light source (window, lamp, neon), temperature (warm/cold), intensity (dim/bright), and the overall color palette of the scene.

**RULE:** This detailed environment MUST be established in the \`sceneContext\` and referenced in EVERY frame, even Close-Ups.`},MANDATORY_BG_WIDE:{text:"**CRITICAL RULE: MANDATORY GLOBAL BACKGROUND.** The 'environmentPrompt' field can NEVER be empty. Since you are generating WIDE SHOTS only, you must provide a comprehensive description of the geography, horizon, and weather, and spatial layout in every frame. Ensure the environment feels vast and grounded."},LIVING_WORLD:{id:"rule_living_world",text:"If public place, describe background extras/silhouettes consistent with the world context."},BATCH_PROCESSING:{id:"batch_processing",text:"Analyze all provided scenes as a continuous sequence to maintain narrative and visual consistency."},USE_ALIASES:{id:"use_aliases",text:"**CRITICAL: ENGLISH INDEXING.** When referring to characters in any field (imagePrompt, environmentPrompt, etc.), ALWAYS use the English format `Entity-N` (e.g. `Entity-1`). \n**NEVER translate 'Entity'** (e.g. NO '-1', NO 'Entidad-1'). \nAll other descriptive text must be in the Target Language."},CHARACTER_ARRAY_INTEGRITY:{id:"character_array_integrity",text:'**CRITICAL JSON RULE: CHARACTER ARRAY INTEGRITY.** The `characters` array in the JSON output MUST list the Index string of **EVERY** entity mentioned in the `imagePrompt`, `videoPrompt`, or `environmentPrompt` for that frame. \n**VIOLATION:** Describing interaction between Entity-1 and Entity-2 but only listing `["Entity-1"]`. \n**CORRECTION:** List `["Entity-1", "Entity-2"]` if both are visually present or interacting.'},EXTENDED_VISUALS:{id:"extended_visuals",text:`**EXTENDED VISUAL EXPANSION (ANTI-COMPRESSION):** The AI has a tendency to summarize. YOU MUST RESIST THIS. Decompose every single script sentence into 3-5 visual frames. 
- **EXPLODE TIME:** Break actions into constituent parts. 
- **MINIMUM FLOOR:** The 'recommendedFrames' from input is your ABSOLUTE MINIMUM. You must aim to EXCEED it. Use shot diversity: Wide, Medium, Close-up, and Detail/Macro.`},EXTENDED_VISUALS_WIDE:{id:"extended_visuals_wide",text:"**EXTENDED VISUAL EXPANSION (WIDE):** Decompose scenes into a rich sequence of shots strictly maintaining the WIDE-ONLY constraint. The 'recommendedFrames' input is your MINIMUM floor. EXCEED it by adding Establishing Shots, Environmental Transitions, and Medium interactions. Do NOT use Close-ups or Macro shots. Focus on spatial relationships and atmosphere."},ACTION_PHASE_BREAKDOWN:{id:"action_phase_breakdown",text:`**CRITICAL: ATOMIC DECOMPOSITION & LOOP PREVENTION.** 
1. Split every significant movement into distinct phases: **Preparation** (wind-up), **Initiation** (start), **Apex** (peak), **Reaction** (follow-through). 
2. **NO LOOPS:** You are FORBIDDEN from repeating the exact same prompt to fill a quota. Focus on DIFFERENT aspects for subsequent frames.`},STORYBOARD_RULES:{id:"storyboard_rules",text:`**CRITICAL RULE: DYNAMIC CAMERA ANGLES & SIZES.** Never repeat the same composition twice in a row. You MUST combine Shot Size with Camera Angle/Position.
1. **VARY ANGLES:** Use Front View, Side Profile, Rear View, Over-the-Shoulder, Low Angle, High Angle, Overhead/Bird's Eye.
2. **VARY DEPTH:** Wide, Medium, Close-up.`},STORYBOARD_RULES_WIDE:{id:"storyboard_rules_wide",text:`**RULE: WIDE SHOT DIVERSITY.** You are strictly limited to WIDE angles, so you MUST vary the CAMERA POSITION to keep it interesting. **NEVER** use a static eye-level front shot twice in a row.
- **MANDATORY ANGLES:** Alternate between: Frontal Wide, Full Body Side View, Full Body Rear View, Low Angle Wide, High Angle Wide, Aerial/Drone.
Ensure every frame captures the full context of the environment.`},TECHNICAL_DIRECTIVES:{id:"tech_directives",text:"STRICT TECHNICAL TERMINOLOGY. For 'shotType', use ONLY abbreviations: WS, MS, CU, ECU, LS. Do NOT write full names."},TECHNICAL_DIRECTIVES_WIDE:{id:"tech_directives_wide",text:"STRICT TECHNICAL TERMINOLOGY. For 'shotType', use ONLY abbreviations: WS, MS, LS. Do NOT use CU or ECU."},ANTHRO_LOGIC:{id:"ana_anthro_logic",text:"**ANTHROPOMORPHIC SPECIES RULE:** Treat all entities as Anthropomorphic Animals unless specified otherwise. In the 'description' field, you MUST explicitly append the species to the entity index/name. Describe animal-specific traits: tail position, ear movements, fur, and muzzle expressions. **CRITICAL:** This rule extends to the background. Any extras or crowds must also be described as specific animal species. Do NOT include humans in the background."},SUBSCRIBE_LOGIC:{id:"ana_subscribe_logic",text:`**SUBSCRIBE CTA VISUALIZATION:** If a scene involves a 'Subscribe' or 'Like' call-to-action (breaking the fourth wall), you MUST visualize it diegetically. 
1. Entities should hold physical signs or tablets displaying the text. 
2. Or interact with giant 3D floating letters. 
3. Ensure the text is described as large, legible, and integrated into the environment.`},SHOT_FILTER_WIDE:{id:"shot_filter_wide",text:`**ULTRA-STRICT CINEMATOGRAPHY FILTER:** For ALL generated frames, you are ABSOLUTELY FORBIDDEN from using Close-Up (CU), Extreme Close-Up (ECU), or Detail shots. 

**TRANSLATION PROTOCOL:** If the script describes a detail (e.g., 'a tear rolling down a cheek'), you MUST TRANSLATE it into a Full Body pose within a Wide Shot (e.g., 'Wide Shot: Character slumps shoulders, head low, body language conveys grief').

**RULE:** Use ONLY Wide Shots (WS), Long Shots (LS), or Medium Shots (MS). Reject the impulse to zoom in.`},ENTITY_LIMIT:{id:"entity_limit",text:"**CRITICAL ENTITY LIMIT:** You are STRICTLY FORBIDDEN from including more than 3 entities in a single frame description. If a scene involves more than 3 characters, you MUST break it down into separate shots focusing on small groups (Shared Splits, Close-ups, Reaction Shots). NEVER crowd the frame with >3 entities."}},Qo={text:"CRITICAL SAFETY CONSTRAINT: Strictly avoid any words that trigger AI safety filters. DO NOT use terms like 'teenager', 'intimate', 'erotic', 'sensual', 'sexy', or 'revealing'. Instead, use 'young adult', 'young person', 'artistic composition', 'emotional atmosphere', or 'professional cinematography'. Focus on narrative importance and abstract beauty. If describing clothing, use 'modest', 'professional', or 'stylized' descriptors. Ensure the content remains within PG-13 artistic boundaries."},Bn=e=>({ru:"Russian",en:"English",es:"Spanish",fr:"French",de:"German",it:"Italian",pt:"Portuguese",zh:"Chinese",ja:"Japanese",ko:"Korean",uz:"Uzbek",tr:"Turkish",sys:"English"})[e]||"English",Kk=async(e,t,n,r,a,i,s,l,c,d,h)=>{const g=Yt(),m=Bn(t),_=[];_.push("You are an expert Character Designer and Prop Master for film production. Your goal is to analyze the story concept and existing cast to generate necessary additional entities (Main Characters, Secondary Characters, and Key Items)."),_.push(`${qe.INPUTS_DATA.text} "${e}"`);const y=r&&r.length>0;if(y){const w=r.map(b=>`- **Name:** ${b.name}
  **Index:** ${b.index}
  **Description:** ${b.fullDescription}`).join(`

`);_.push(`EXISTING CAST (LOCKED): 
${w}`)}else _.push("No existing cast provided.");_.push(`**OUTPUT LANGUAGE:** Character names can remain in their original language/English, but descriptions must be in ${m}.`),a.generateMainChars&&(y?_.push(`**SMART GENERATION LOGIC:** The Main Character(s) are likely already provided in the 'EXISTING CAST' list above. 
1. **DO NOT** re-generate or duplicate existing characters (e.g., if Entity-1 is the hero, do not create a new hero). 
2. **ONLY** generate a new profile for an existing character if the plot explicitly demands a **visual transformation** (e.g., 'Batman (Armored Suit)'). 
3. Focus primarily on generating **MISSING** entities required by the prompt (Antagonists, Sidekicks) that are not yet in the list.`):_.push(wt.MAIN_CHAR_LOGIC.text)),c?_.push(wt.SECONDARY_CHARS.text):_.push("Do NOT generate secondary characters unless absolutely necessary for the main plot."),d?_.push(wt.KEY_ITEMS_LOGIC.text):_.push("Do NOT generate key items."),_.push(wt.NO_DUPLICATES.text),_.push(wt.SMART_CONCEPT.text),s==="custom"&&l?(_.push(`TARGET VISUAL STYLE: ${l}`),_.push(wt.DETAILED_STYLE.text)):s&&s!=="none"&&(_.push(`TARGET VISUAL STYLE: ${s}`),_.push(wt.DETAILED_STYLE.text)),_.push("Return JSON object with key: 'detailedCharacters' (array of objects with keys: 'name', 'fullDescription', 'prompt', 'index' (optional - will be assigned automatically if missing)).");const v=_.join(`

`),C=await qt(()=>g.models.generateContent({model:i,contents:v,config:{responseMimeType:"application/json",thinkingConfig:h?{thinkingBudget:4e3}:void 0}}));return Xi(C.text||"{}")},Jk=async(e,t,n,r,a,i,s,l,c,d,h,g,m,_,y,v)=>{const C=Yt(),w=Bn(t),b=[];if(b.push(qe.CORE.text),b.push(`**OUTPUT LANGUAGE:** You MUST write the 'summary', scene 'title', 'description', and 'narratorText' strictly in ${w}.`),b.push(`${qe.INPUTS_DATA.text} "${e}"`),b.push(qe.IMPROVE_CONCEPT.text),b.push(qe.ANTI_COMPRESSION.text),g?b.push(qe.SCENELESS_MODE.text):(b.push(qe.ANALYSIS.text),v&&b.push(qe.EXPOSITION.text),b.push(qe.DELAYED_REVEAL.text),b.push(qe.VISUALS_FIRST.text),b.push(qe.SEAMLESS_FLOW.text),b.push(qe.ATMOSPHERE.text),b.push(qe.VISUAL_METAPHOR.text),b.push(qe.PACING_RHYTHM.text),b.push(qe.SUBTEXT.text),b.push(qe.NO_CAMERA_DIRECTIVES.text),b.push(qe.OBJECT_AGENCY.text)),b.push(qe.FRAME_ESTIMATION.text),s.safeGeneration&&b.push(Qo.text),_&&b.push(qe.COMMERCIAL_SAFE.text),m&&b.push(qe.SIMPLE_ACTIONS.text),b.push(qe.STRICT_NAME_PERSISTENCE.text),b.push(qe.SCENE_CHARACTERS_LIST.text),i&&i.length>0){const I=i.map(E=>`- **Name:** ${E.name}
  **Index:** ${E.index}
  **Description:** ${E.fullDescription}`).join(`

`);b.push(`**MANDATORY CAST LIST (DO NOT INVENT NEW ENTITY TAGS):**
${I}`),b.push(wt.STRICT_NO_NEW.text),b.push("ABSOLUTE PROHIBITION: Do NOT invent new `Entity-N` tags for objects or props in the scene text. Refer to objects by their names (e.g. 'table', 'sword'), NOT as Entities.")}else s.noCharacters?b.push("No specific characters. Focus on events and atmosphere."):b.push("No cast provided. Refer to characters generically (e.g. 'A tall man') or use 'Entity-1' if you must introduce a protagonist, but DO NOT generate a 'detailedCharacters' profile output.");c==="custom"&&d?(b.push(`TARGET VISUAL STYLE NAME: ${d}`),b.push("In the JSON output field 'generatedStyle', you must NOT simply repeat this name. YOU MUST EXPAND IT into a full, detailed technical prompt.")):c&&c!=="none"&&(b.push(`TARGET VISUAL STYLE NAME: ${c}`),b.push("In the JSON output field 'generatedStyle', you must NOT simply repeat this name. YOU MUST EXPAND IT into a full, detailed technical prompt.")),b.push(qe.VISUAL_DNA.text),s.includeSubscribeScene&&!g&&b.push("Include a scene breaking the fourth wall asking to subscribe/like."),r&&b.push(`Include Narrator voiceover. Style: ${a}.`),s.numberOfScenes&&b.push(`Generate exactly ${s.numberOfScenes} scenes.`),n==="anthro"&&b.push("Characters must be Anthropomorphic animals."),g&&b.push(qe.LIVING_WORLD.text),b.push(`REMINDER: Output Language MUST be ${w}.`),b.push('REMINDER: Use entity format: "Entity-Index" (e.g. "Entity-1").'),b.push(`Return JSON with keys: 'summary', 'generatedStyle', 'scenes' (array of objects with 'title', 'description', 'recommendedFrames', 'narratorText', 'characters' (array of strings)). 

**IMPORTANT:** DO NOT include a 'detailedCharacters' field in this response. Character generation is handled by a separate process.`);const f=b.join(`

`),T=await qt(()=>C.models.generateContent({model:l,contents:f,config:{responseMimeType:"application/json",thinkingConfig:h?{thinkingBudget:16e3}:void 0}}));return Xi(T.text||"{}")},pg=async(e,t,n,r,a,i)=>{const s=Yt(),l=Bn(r),c=[];c.push(we.ROLE.text),c.push(we.INPUTS.text),c.push(we.NO_POV.text);let d="";a.minFrames?d=`
**CRITICAL FRAME COUNT ENFORCEMENT:**
For EVERY scene, you MUST generate a MINIMUM of ${a.minFrames} frames. This is a HARD CONSTRAINT. You are FORBIDDEN from generating fewer. If the action seems short, you MUST use "slow motion" descriptions and break actions into micro-details (e.g., 'Hand reaching', 'Fingers touching', 'Grip tightening') to satisfy the frame count. DO NOT MERGE ACTIONS.`:a.framesPerScene?d=`
**FRAME COUNT GOAL:** Target approximately ${a.framesPerScene} frames per scene. Decompose actions to fill this quota.`:d=`
**FRAME COUNT:** Respect the 'recommendedFrames' provided in the scene input. Try to match it exactly by decomposing actions.`,c.push(d),a.professionalStoryboard&&(c.push(we.STORYBOARD_RULES.text),c.push(we.TECHNICAL_DIRECTIVES.text)),c.push(we.MANDATORY_BG.text),c.push(we.BATCH_PROCESSING.text),a.extendedAnalysis&&c.push(we.EXTENDED_VISUALS.text),c.push(we.ACTION_PHASE_BREAKDOWN.text),c.push(we.USE_ALIASES.text),c.push(we.CHARACTER_ARRAY_INTEGRITY.text),c.push(we.ENTITY_LIMIT.text),c.push(`**TARGET LANGUAGE:** The entire analysis (sceneContext, imagePrompt, environmentPrompt, videoPrompt) MUST be written in **${l}**. 
**EXCEPTION:** The Character Tags must remain in English: 'Entity-1', 'Entity-2'. Do not translate the word 'Entity' to ${l}.`);const h=e.map(y=>{const v=y.characters?`Participating Entities: [${y.characters.join(", ")}]`:"";return`SCENE ${y.sceneNumber} (Rec Frames: ${y.recommendedFrames}): ${y.title}
${v}
${y.description}
${y.narratorText||""}`}).join(`

`),g=t.map(y=>`${y.name} (Index: ${y.index||y.alias}): ${y.fullDescription}`).join(`
`),m=`
        ${c.join(`

`)}
        
        SUMMARY: ${n}
        
        ENTITIES / CHARACTERS:
        ${g}
        
        SCENES TO ANALYZE:
        ${h}
        
        Return JSON array of scene objects.
        Each scene object MUST contain:
        1. "sceneNumber": (integer)
        2. "sceneContext": (string in ${l}) **VISUAL MANIFEST.** You MUST describe: Location type (In/Out), Furniture (Specific Size/Color/Material/Position), Flooring/Walls, Lighting (Temp/Source/Intensity), and overall Color Palette. This context will be applied to every frame.
        3. "frames": (array of frame objects)
        
        Each frame object has: 'frameNumber', 'imagePrompt' (in ${l}), 'environmentPrompt' (in ${l}), 'videoPrompt' (in ${l}), 'characters' (array of indices e.g. "Entity-1"), 'shotType', 'duration' (integer, seconds, e.g. 2).
    `,_=await qt(()=>s.models.generateContent({model:i,contents:m,config:{responseMimeType:"application/json"}}));return Xi(_.text||"[]")},Xk=async(e,t,n,r,a,i="",s={},l=[],c=[],d={charDescMode:"general"})=>{const h=Yt(),g=Bn(r),m=[],_=c.includes(ne.VISUAL_SATURATION.id);d.safeGeneration&&m.push(Qo.text),m.push(ne.ROLE.text),m.push(ne.NO_POV.text),m.push(ne.STATIC_STATE.text),m.push(ne.ATMOSPHERIC_FIX.text),m.push(ne.STATELESS.text),m.push(ne.SUBJECT_FOCUS.text),m.push(ne.STRICT_CHAR_INDEX.text),m.push(ne.ALWAYS_ENV.text),c.includes(ne.ANTHRO_REINFORCEMENT.id)&&m.push(ne.ANTHRO_REINFORCEMENT.text),c.includes(ne.SUBSCRIBE_REINFORCEMENT.id)&&m.push(ne.SUBSCRIBE_REINFORCEMENT.text),c.includes(ne.IMG_VID_CONSISTENCY.id)&&m.push(ne.IMG_VID_CONSISTENCY.text),c.includes(ne.PROP_ENHANCEMENT.id)&&m.push(ne.PROP_ENHANCEMENT.text),d.charDescMode==="general"?(m.push(ne.GENERAL_CHAR_DESC.text),m.push("**CHARACTER VISUAL INTEGRATION:** Summarize the visual prompt from the character's profile. Merge details naturally.")):d.charDescMode==="full"&&(m.push(ne.FULL_CHAR_DESC.text),m.push("**CHARACTER VISUAL INTEGRATION:** Use FULL visual profiles.")),c.includes(ne.LAYERED_CONSTRUCTION.id)&&(d.charDescMode==="none"?m.push(Xu):_?m.push(ne.LAYERED_CONSTRUCTION.text):m.push(Ju)),c.includes(ne.VISUAL_SATURATION.id)&&m.push(ne.VISUAL_SATURATION.text),c.includes(ne.NO_NAMES.id)&&m.push(ne.NO_NAMES.text),c.includes(ne.BREAK_PARAGRAPHS.id)&&m.push(ne.BREAK_PARAGRAPHS.text),m.push(`**OUTPUT LANGUAGE:** The final image and video prompts MUST be written in **${g}**. 
**EXCEPTION:** The Character Tags inside square brackets must remain in English: '[Entity-1]', '[Entity-2]'. Do not translate the word 'Entity'.`);const y=c.includes(ne.GENERATE_VIDEO_PROMPT.id);y?(m.push(ne.GENERATE_VIDEO_PROMPT.text),m.push('Return JSON: { "imagePrompt": "...", "videoPrompt": "..." }')):m.push("Return ONLY the final image prompt string.");const v=l.length>0?l.map(f=>s[f]?`[${f}]: ${s[f]}`:null).filter(Boolean):n,C=v.length>0?`Use ONLY these character profiles relevant to this frame:
${v.map(f=>`- ${f}`).join(`
`)}`:"No specific characters in this frame.",w=_?`**VISUAL STYLE:** ${a||"Cinematic realism"}`:"",b=`
        ${m.join(`

`)}

        **INPUTS:**
        - **MASTER SCENE SET DESIGN (MANDATORY CONTEXT):** "${i.replace(/`/g,"")}"
        ${w}
        - **Entities / Characters:** ${C.replace(/`/g,"")}
        - **Frame Action & Subject Detail:** ${e.replace(/`/g,"")}
        - **Frame World Context (MANDATORY BACKGROUND):** ${t.replace(/`/g,"")}
    `;try{const T=((await qt(()=>h.models.generateContent({model:"gemini-2.5-flash",contents:b,config:{...y?{responseMimeType:"application/json"}:{},thinkingConfig:d.thinkingEnabled?{thinkingBudget:16e3}:void 0}}))).text??"").trim();if(y)try{return Xi(T)}catch{return{imagePrompt:T,videoPrompt:""}}return T}catch(f){throw console.error("Error modifying script prompt:",f),f}},Zk=async(e,t,n,r,a,i,s=[],l={charDescMode:"general"})=>{const c=Yt(),d=Bn(r),h=[],g=s.includes(ne.VISUAL_SATURATION.id);l.safeGeneration&&h.push(Qo.text),h.push(ne.ROLE.text),h.push(ne.NO_POV.text),h.push(ne.STATIC_STATE.text),h.push(ne.ATMOSPHERIC_FIX.text),h.push(ne.STATELESS.text),h.push(ne.SUBJECT_FOCUS.text),h.push(ne.STRICT_CHAR_INDEX.text),h.push(ne.ALWAYS_ENV.text),s.includes(ne.ANTHRO_REINFORCEMENT.id)&&h.push(ne.ANTHRO_REINFORCEMENT.text),s.includes(ne.SUBSCRIBE_REINFORCEMENT.id)&&h.push(ne.SUBSCRIBE_REINFORCEMENT.text),s.includes(ne.IMG_VID_CONSISTENCY.id)&&h.push(ne.IMG_VID_CONSISTENCY.text),s.includes(ne.PROP_ENHANCEMENT.id)&&h.push(ne.PROP_ENHANCEMENT.text),l.charDescMode==="general"?(h.push(ne.GENERAL_CHAR_DESC.text),h.push("**CHARACTER VISUAL INTEGRATION:** Summarize the visual prompt from the character's profile. Merge details naturally.")):l.charDescMode==="full"&&(h.push(ne.FULL_CHAR_DESC.text),h.push("**CHARACTER VISUAL INTEGRATION:** Use FULL visual profiles.")),s.includes(ne.LAYERED_CONSTRUCTION.id)&&(l.charDescMode==="none"?h.push(Xu):g?h.push(ne.LAYERED_CONSTRUCTION.text):h.push(Ju)),s.includes(ne.VISUAL_SATURATION.id)&&h.push(ne.VISUAL_SATURATION.text),s.includes(ne.NO_NAMES.id)&&h.push(ne.NO_NAMES.text),s.includes(ne.BREAK_PARAGRAPHS.id)&&h.push(ne.BREAK_PARAGRAPHS.text),h.push(`**OUTPUT LANGUAGE:** The final image and video prompts MUST be written in **${d}**. 
**EXCEPTION:** The Character Tags inside square brackets must remain in English: '[Entity-1]', '[Entity-2]'. Do not translate the word 'Entity'.`),s.includes(ne.GENERATE_VIDEO_PROMPT.id)?(h.push(ne.GENERATE_VIDEO_PROMPT.text),h.push('Return JSON array: [{ "imagePrompt": "...", "videoPrompt": "..." }]')):h.push("Return JSON array of strings (image prompts only)."),h.push('**STRICT JSON SYNTAX:** Ensure all keys (e.g. "imagePrompt") are double-quoted. Do NOT use trailing commas. Escape any quotes inside strings.');const _=new Set;t.forEach(b=>{b.characters&&Array.isArray(b.characters)&&b.characters.forEach(f=>_.add(f))});const y=Array.from(_).map(b=>n[b]?`[${b}]: ${n[b]}`:null).filter(Boolean).join(`

`),v=t.map((b,f)=>{const T=(b.characters||[]).join(", ");return`FRAME_${f}:
        // Shot Type removed to prevent AI from shortcutting descriptions
        - Subject Detail & Action: ${(b.imagePrompt||"").replace(/`/g,"")}
        - World Context (MANDATORY): ${(b.environmentPrompt||"").replace(/`/g,"")}
        - Active Characters: ${T||"None"}
        `}).join(`

`),C=g?`**STYLE DEFINITION:** ${a||"Cinematic realism"}`:"",w=`
        ${h.join(`

`)}

        **MASTER SCENE SET DESIGN (MANDATORY CONTEXT):** "${e.replace(/`/g,"")}"
        ${C}
        
        **SCENE CAST VISUAL PROFILES (REFERENCE):**
        ${y||"No specific characters in this scene."}

        **FRAMES TO PROCESS:**
        ${v}
    `;try{const b=await qt(()=>c.models.generateContent({model:i,contents:w,config:{responseMimeType:"application/json",thinkingConfig:l.thinkingEnabled?{thinkingBudget:16e3}:void 0}}));return Xi(b.text||"[]")}catch(b){throw console.error("Error batch modifying scene:",b),b}},hg=async(e,t)=>{const n=Yt(),r=`Modify text:
Original: ${e}
Instructions: ${t}`;return(await qt(()=>n.models.generateContent({model:"gemini-2.5-flash",contents:r}))).text||""},Qk=async(e,t)=>{const n=Yt(),a=`You are a professional Script Doctor and Visual Director.
    Significantly ENRICH, EXPAND, and DIVERSIFY the given story concept in ${Bn(t)}.
    
    CRITICAL OUTPUT RULES:
    1. **Visual Focus:** Use vivid, descriptive language suitable for AI image generation (lighting, colors, textures, atmosphere).
    2. **Detail:** Add specific details about the setting, characters, and mood.
    3. **Expansion:** Flesh out the premise into a robust narrative foundation.
    4. **Output:** Return ONLY the improved concept text. DO NOT include prefixes like "Title:".

    Raw Concept: "${e}"`;return((await qt(()=>n.models.generateContent({model:"gemini-3-flash-preview",contents:a}))).text||"").trim()},eA=async(e,t,n,r,a,i)=>{const s=Yt(),l=n==="ru"?"  ,  ":"on a gray background, character concept",c=Bn(n),d=`You are a creative character designer. Generate ${t} distinct characters based on the user's prompt. Language: ${c}. Type: ${r}. Style: ${i||a}. 
    
    IMPORTANT: For the "fullDescription" field, strictly use the following Markdown headers to separate sections, regardless of the target language (translate header titles if appropriate for ${c} but keep structure):
    #### Appearance
    #### Personality
    #### Clothing
    
    Ensure all three sections are present and detailed.

    For the "prompt" field, generate a detailed visual description for image generation and APPEND: ", ${l}".

    Return JSON array.`,h=await qt(()=>s.models.generateContent({model:"gemini-3-pro-preview",contents:e,config:{systemInstruction:d,responseMimeType:"application/json",responseSchema:{type:yt.OBJECT,properties:{characters:{type:yt.ARRAY,items:{type:yt.OBJECT,properties:{name:{type:yt.STRING},fullDescription:{type:yt.STRING},prompt:{type:yt.STRING,description:"Visual generation prompt for this character"}},required:["name","fullDescription","prompt"]}}}}}}));return JSON.parse(yo(h.text||"{}")).characters||[]},tA=async e=>{const t=Yt(),n=`Analyze the character description and separate it into: Character (physical appearance) and Clothing.
    Description: "${e}"
    Return JSON.`,r=await qt(()=>t.models.generateContent({model:"gemini-2.5-flash",contents:n,config:{responseMimeType:"application/json"}}));return JSON.parse(yo(r.text||"{}"))},nA=async(e,t="1:1")=>{var a,i,s;const n=Yt(),r=await qt(()=>n.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{text:e}]},config:{imageConfig:{aspectRatio:t}}}));if((s=(i=(a=r.candidates)==null?void 0:a[0])==null?void 0:i.content)!=null&&s.parts){for(const l of r.candidates[0].content.parts)if(l.inlineData&&l.inlineData.data)return l.inlineData.data}throw new Error("No image generated")},oA=async e=>{const t=Yt();return(await qt(()=>t.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:"image/png",data:e}},{text:"Extract all text from this image."}]}}))).text||""},Iy=async e=>{const t=Yt(),n=`Analyze this image (a screenshot of a YouTube video row). 
    Extract the Video Title.
    Also generate a short description (1-2 sentences) describing the video content based on the title and thumbnail visual elements.
    If visible, also extract:
    - Views count (as a number)
    - Upload date (as a string)
    
    Return JSON: { "title": string, "description": string, "views"?: number, "uploadDate"?: string }`,r=await qt(()=>t.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:"image/png",data:e}},{text:n}]},config:{responseMimeType:"application/json",responseSchema:{type:yt.OBJECT,properties:{title:{type:yt.STRING},description:{type:yt.STRING},views:{type:yt.NUMBER,nullable:!0},uploadDate:{type:yt.STRING,nullable:!0}},required:["title","description"]}}}));return JSON.parse(yo(r.text||"{}"))},rA=async e=>{const t=Yt(),n=`Enhance and combine these prompts into a detailed image generation prompt: ${e.join(`
`)}`;return(await qt(()=>t.models.generateContent({model:"gemini-2.5-flash",contents:n}))).text||""},aA=async(e,t)=>{const n=Yt(),r=`Translate the following text to ${t}:

${e}`;return(await qt(()=>n.models.generateContent({model:"gemini-2.5-flash",contents:r}))).text||""},iA=async e=>{const t=Yt(),n=`Fix grammar and spelling errors in the following text:

${e}`;return(await qt(()=>t.models.generateContent({model:"gemini-2.5-flash",contents:n}))).text||""},sA=async e=>{const t=Yt(),n=`Analyze the following prompt and split it into these components: Environment, Characters (array of names/descriptions), Action, Style.
    Prompt: "${e}"
    Return JSON.`,r=await qt(()=>t.models.generateContent({model:"gemini-2.5-flash",contents:n,config:{responseMimeType:"application/json"}}));return JSON.parse(yo(r.text||"{}"))},Vd=async(e,t,n,r)=>{var c,d,h,g,m,_;const a=Yt();let i;r&&r.speakers&&r.speakers.length===2?i={multiSpeakerVoiceConfig:{speakerVoiceConfigs:[{speaker:r.speakers[0].name,voiceConfig:{prebuiltVoiceConfig:{voiceName:r.speakers[0].voice}}},{speaker:r.speakers[1].name,voiceConfig:{prebuiltVoiceConfig:{voiceName:r.speakers[1].voice}}}]}}:i={voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};const s={responseModalities:[Vi.AUDIO],speechConfig:i};return((_=(m=(g=(h=(d=(c=(await qt(()=>a.models.generateContent({model:"gemini-2.5-flash-preview-tts",contents:{parts:[{text:e}]},config:s}))).candidates)==null?void 0:c[0])==null?void 0:d.content)==null?void 0:h.parts)==null?void 0:g[0])==null?void 0:m.inlineData)==null?void 0:_.data)||""},lA=async(e,t,n,r)=>{const a=Yt(),i=`Generate narrator text for: ${e}. Role: ${t}. Languages: ${JSON.stringify(n)}. Use SSML: ${r}. Return JSON with keys matching language codes (ru, en).`,s=await qt(()=>a.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{responseMimeType:"application/json"}}));return JSON.parse(yo(s.text||"{}"))},cA=async(e,t)=>{const n=Yt(),r=await qt(()=>n.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{inlineData:{mimeType:t,data:e}},{text:"Transcribe this audio. Return a JSON array of segments. Each segment must have: startTime (format HH:MM:SS,mmm), endTime (format HH:MM:SS,mmm), and text."}]},config:{responseMimeType:"application/json",responseSchema:{type:yt.ARRAY,items:{type:yt.OBJECT,properties:{startTime:{type:yt.STRING},endTime:{type:yt.STRING},text:{type:yt.STRING}},required:["startTime","endTime","text"]}}}}));return yo(r.text||"[]")},Vt={ROLE:{id:"music_role",text:"You are a professional Music Producer, Composer, and Lyricist. Your task is to analyze a concept and translate it into specific musical directions and lyrical content."},INPUT_CONTEXT:{id:"music_input",text:"Source Data: User Concept/Mood/Theme."},CREATIVE_RULE:{id:"music_creative",text:"CREATIVE INTERPRETATION RULE: Do NOT interpret the input literally. If the input is a weak or generic example (e.g., 'sad song', 'about love'), DO NOT just repeat those words. Analyze the underlying mood, atmosphere, and subtext. Generate ORIGINAL lyrics and musical cues that evoke the theme metaphorically and artistically. Avoid clichs. Elevate the concept beyond the literal input keywords."},LYRICS_RULE:{id:"music_lyrics",text:"LYRICS STRUCTURE: If requested, write lyrics adhering to a standard song structure (Verse 1, Chorus, Verse 2, Chorus, Bridge, Outro). Ensure rhymes and rhythm match the requested genre."},VERSE_COUNT_RULE:{id:"music_verse_count",text:"STRICT STRUCTURE CONSTRAINT: You MUST generate exactly {N} UNIQUE Verses in the song structure. Do not summarize or skip verses. Explicitly label them as [Verse 1], [Verse 2] ... up to [Verse {N}]."},MUSIC_PROMPT_RULE:{id:"music_prompt_rule",text:"AI MUSIC PROMPT: Generate a technical description string optimized for AI Music Generators (like Suno or Udio). Include: Genre, Instruments, BPM, Mood, Vocal Style. Format as a comma-separated list of tags. CRITICAL CONSTRAINT: The 'music_prompt' must be under 1000 characters."},FORMAT:{id:"music_format",text:"Return a JSON object where keys are language codes. For each language, provide: 'song_title', 'music_prompt', and optional 'lyrics'."}},dA=async(e,t,n)=>{const r=Yt(),a=Bn(e),i=n&&n.trim()!==""?`The ideas should be related to the following theme: "${n}".`:"",s=`
        You are a creative assistant for story writing.
        Generate a list of 10 random and interesting ideas for each of the following three categories, tailored for a "${t}" story format.
        ${i}
        The categories are:
        1. Action (a key verb or event, e.g., "find a hidden map", "escape from a maze")
        2. Place (a setting, e.g., "an abandoned space station", "a magical forest")
        3. Obstacle (a challenge or antagonist, e.g., "a mischievous dragon", "a forgotten curse")

        All ideas must be in ${a}.
        Return the output as a single JSON object with keys "action", "place", and "obstacle", where each key has an array of 10 strings.
    `,l={type:yt.OBJECT,properties:{action:{type:yt.ARRAY,items:{type:yt.STRING}},place:{type:yt.ARRAY,items:{type:yt.STRING}},obstacle:{type:yt.ARRAY,items:{type:yt.STRING}}},required:["action","place","obstacle"]};try{const d=(await qt(()=>r.models.generateContent({model:"gemini-2.5-flash",contents:s,config:{responseMimeType:"application/json",responseSchema:l}}))).text;if(!d)throw new Error("Received empty response from model.");return JSON.parse(yo(d))}catch(c){throw console.error("Error generating idea categories:",c),c}},uA=async(e,t,n,r)=>{const a=Yt(),s=`
        Combine the following three elements into a short, one-paragraph story idea.
        The story idea should be written in ${Bn(r)}.

        - Action: ${e}
        - Place: ${t}
        - Obstacle: ${n}

        Return only the story idea paragraph.
    `;try{return((await qt(()=>a.models.generateContent({model:"gemini-2.5-flash",contents:s}))).text??"").trim()}catch(l){throw console.error("Error combining story idea:",l),l}},pA=async(e,t,n,r=2,a="gemini-3-flash-preview")=>{const i=Yt(),s=[];s.push(Vt.ROLE.text),s.push(`${Vt.INPUT_CONTEXT.text}: "${e}"`);const l=Object.keys(t).filter(_=>t[_]);s.push(`Target Languages: ${JSON.stringify(l)}`),s.push(Vt.CREATIVE_RULE.text),s.push(Vt.MUSIC_PROMPT_RULE.text),n?(s.push(Vt.LYRICS_RULE.text),r&&r>0&&s.push(Vt.VERSE_COUNT_RULE.text.replace("{N}",r.toString()))):s.push("Do NOT generate lyrics."),s.push("Return a JSON object containing an 'outputs' array. Each item in the array must correspond to one of the target languages and contain: 'language', 'song_title', 'music_prompt', and optional 'lyrics'.");const c=s.join(`

`),d={type:yt.OBJECT,properties:{outputs:{type:yt.ARRAY,items:{type:yt.OBJECT,properties:{language:{type:yt.STRING},song_title:{type:yt.STRING},music_prompt:{type:yt.STRING},lyrics:{type:yt.STRING,nullable:!0}},required:["language","song_title","music_prompt"]}}},required:["outputs"]},h=await qt(()=>i.models.generateContent({model:a,contents:c,config:{responseMimeType:"application/json",responseSchema:d}})),g=JSON.parse(yo(h.text||"{}")),m={};return g.outputs&&Array.isArray(g.outputs)&&g.outputs.forEach(_=>{_.language&&(m[_.language]=_)}),m},At={ROLE:{id:"yt_role",text:"You are an expert YouTube Growth Strategist, SEO Specialist, and Copywriter. Your goal is to maximize Click-Through Rate (CTR) and Audience Retention."},INPUT_CONTEXT:{id:"yt_input",text:"Source Data: User Concept/Video Topic/Channel Theme."},TITLE_MODE_RULES:{id:"yt_title_mode",text:`Generate catchy, high-CTR metadata. 
1. **Titles:** Must be punchy, under 60 chars where possible, evoking curiosity or benefit. 
2. **Description:** First 2 lines must be the hook. Include keywords naturally. 
3. **Tags:** Mix of broad and specific keywords.`},HASHTAGS:{id:"yt_hashtags",text:"HASHTAG INTEGRATION: You MUST append 3-5 highly relevant hashtags (format: #Hashtag) at the very end of the 'description' field. Choose high-volume tags related to the niche."},THUMBNAIL:{id:"yt_thumbnail",text:`THUMBNAIL GENERATION: Generate a separate field 'thumbnailPrompt'. Describe a high-CTR YouTube thumbnail image. 
- **Focus:** Facial expression, emotional hook, bright colors, text overlay (keep it short), and contrast. 
- **Style:** High saturation, clean background, 4k quality.`},CHANNEL_MODE_RULES:{id:"yt_channel_mode",text:`Generate cohesive channel branding. 
1. **Name:** Memorable, unique, easy to spell. 
2. **Handle:** Short, matching the name. 
3. **Bio:** Clear value proposition (Who is this for? What will they get?).`},FORMAT:{id:"yt_format",text:"Return a JSON object where keys are language codes. For 'Title Mode' provide: title, description (with hashtags included), tags, and optional thumbnailPrompt. For 'Channel Mode' provide: channelName, channelDescription, channelKeywords, channelHandle."}},hA=async(e,t="ru")=>{const n=Yt(),r=Bn(t),a=e.contextPrompt?`
**User Context / Specific Question:**
"${e.contextPrompt}"
`:"",i=`
        You are an expert YouTube Growth Strategist and Data Analyst. 
        You have been provided with data for a YouTube channel.
        **Current Date/Time:** ${e.currentDate||"Unknown"}
        ${a}
        
        **Channel Context:**
        - **Current Goal:** ${e.goal||"Not specified"}
        - **Current Subscribers:** ${e.currentSubscribers||"Unknown"}
        - **Monetization Status:** ${e.isMonetized?"Monetized":"Not Monetized"}
        
        **Your Task:**
        Analyze the provided data and the user's goal (and answer their specific question if provided). Provide actionable advice to improve channel performance and reach the goal.
        
        1.  **Goal Analysis:** Is the current goal realistic given the stats? Is it the right next step? 
            - If the goal is "Not specified" or seems inappropriate for the channel's current size, suggest a better, immediate milestone.
            - If you suggest a new goal, provide it in the "suggestedGoal" field.
        2.  **Consistency:** Are videos being uploaded regularly? Consider the current date.
        3.  **Trends:** Are subscribers and views increasing, decreasing, or stagnant? Pay attention to Shorts vs Long form performance if distinct.
        4.  **Content Strategy:** Based on the Channel Description and titles of uploaded videos (if available), suggest improvements.
        5.  **Action Plan:** Provide a bulleted list of specific actions.

        **Input Data:**
        ${JSON.stringify(e.channels,null,2)}

        **Output Format:**
        Return a JSON object.
        - "advice": The main analysis and advice text in Markdown format. Use headings.
        - "suggestedGoal": (Optional) A short string (max 5 words) if you recommend changing the specific goal target (e.g., "Reach 1,000 Subscribers"). Leave empty if the current goal is fine.
        
        IMPORTANT: The "advice" content MUST be written in ${r}.
    `,s={type:yt.OBJECT,properties:{advice:{type:yt.STRING},suggestedGoal:{type:yt.STRING,nullable:!0}},required:["advice"]};try{const l=await qt(()=>n.models.generateContent({model:"gemini-3-pro-preview",contents:i,config:{responseMimeType:"application/json",responseSchema:s}}));return JSON.parse(yo(l.text||"{}"))}catch(l){throw console.error("Error analyzing YouTube stats:",l),l}},mA=async(e,t,n)=>{const r=Yt(),a=[];a.push(At.ROLE.text),a.push(At.TITLE_MODE_RULES.text),(n==null?void 0:n.includeHashtags)!==!1&&a.push(At.HASHTAGS.text),n!=null&&n.generateThumbnail&&a.push(At.THUMBNAIL.text),a.push(`${At.INPUT_CONTEXT.text}: "${e}"`),a.push(`Target Languages: ${JSON.stringify(t)}`),a.push(At.FORMAT.text);const i=a.join(`

`),s=await qt(()=>r.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{responseMimeType:"application/json"}}));return JSON.parse(yo(s.text||"{}"))},gA=async(e,t)=>{const n=Yt(),r=[];r.push(At.ROLE.text),r.push(At.CHANNEL_MODE_RULES.text),r.push(`${At.INPUT_CONTEXT.text}: "${e}"`),r.push(`Target Languages: ${JSON.stringify(t)}`),r.push(At.FORMAT.text);const a=r.join(`

`),i=await qt(()=>n.models.generateContent({model:"gemini-2.5-flash",contents:a,config:{responseMimeType:"application/json"}}));return JSON.parse(yo(i.text||"{}"))},mg=(e,t,n)=>new Promise((r,a)=>{const i=new Image;i.onload=()=>{const s=document.createElement("canvas");let l=i.width,c=i.height;l>c?l>t&&(c*=t/l,l=t):c>n&&(l*=n/c,c=n),s.width=l,s.height=c;const d=s.getContext("2d");if(d){d.drawImage(i,0,0,l,c);const h=s.toDataURL("image/jpeg",.8);r(h.split(",")[1])}else a(new Error("Failed to get canvas context"))},i.onerror=a,i.src=e.startsWith("data:")?e:`data:image/png;base64,${e}`}),fA=e=>new Promise((t,n)=>{const r=new Image;r.src=URL.createObjectURL(e),r.onload=()=>{const a=document.createElement("canvas"),i=a.getContext("2d");if(!i){n(new Error("Could not get canvas context"));return}const s=128,l=72;a.width=s,a.height=l;const c=Math.max(s/r.width,l/r.height),d=s/2-r.width/2*c,h=l/2-r.height/2*c;i.drawImage(r,d,h,r.width*c,r.height*c),t(a.toDataURL("image/png").split(",")[1])},r.onerror=n}),Py=e=>new Promise((t,n)=>{const r=new Image;r.src=URL.createObjectURL(e),r.onload=()=>{if(r.width<=136){const h=document.createElement("canvas");h.width=r.width,h.height=r.height;const g=h.getContext("2d");g?(g.drawImage(r,0,0),t({thumbnail:h.toDataURL("image/png").split(",")[1],metadataImage:""})):n(new Error("Canvas error"));return}const i=document.createElement("canvas");i.width=136,i.height=r.height;const s=i.getContext("2d");if(!s){n("Canvas error");return}s.drawImage(r,0,0,136,r.height,0,0,136,r.height);const l=document.createElement("canvas"),c=r.width-136;l.width=c,l.height=r.height;const d=l.getContext("2d");if(!d){n("Canvas error");return}d.drawImage(r,136,0,c,r.height,0,0,c,r.height),t({thumbnail:i.toDataURL("image/png").split(",")[1],metadataImage:l.toDataURL("image/png").split(",")[1]})},r.onerror=n}),yA=({nodes:e,connections:t,groups:n,addNodeFromHook:r,t:a,clientPointerPosition:i,clientPointerPositionRef:s,viewTransform:l,setCreationLine:c,setLastAddedNodeId:d,handleDeleteNode:h,removeConnectionsByNodeId:g,addConnection:m,handleValueChange:_,nodeIdCounter:y,setNodes:v,setConnections:C,addGroup:w,selectedNodeIds:b,setSelectedNodeIds:f,removeGroup:T,saveGroupToCatalog:I,catalogItems:E,currentCatalogItems:R,handleCloseCatalog:N,geminiContext:A,addToast:k,setGroups:P,handleDuplicateNode:M,handleDuplicateNodeEmpty:H,saveGenericItemToCatalog:W})=>{const O=x.useCallback((X,F,Y,K)=>{const V=r(X,F,a,Y,K);return d(V),setTimeout(()=>{d(oe=>oe===V?null:oe)},1500),V},[r,a,d]),U=x.useCallback(X=>{const F={x:window.innerWidth/2,y:window.innerHeight/2},Y={x:(F.x-l.translate.x)/l.scale,y:(F.y-l.translate.y)/l.scale};c({start:s.current,end:F}),setTimeout(()=>c(null),700),O(X,Y,void 0)},[s,l,O,c]),z=x.useCallback(X=>{const F=e.find(Y=>Y.id===X);if(F&&F.type===S.REROUTE_DOT){const Y=t.find(V=>V.toNodeId===X),K=t.filter(V=>V.fromNodeId===X);Y&&K.length>0&&K.map(oe=>({fromNodeId:Y.fromNodeId,fromHandleId:Y.fromHandleId,toNodeId:oe.toNodeId,toHandleId:oe.toHandleId})).forEach(oe=>{const de=e.find(Z=>Z.id===oe.fromNodeId);de&&m(oe,de)})}h(X),g(X)},[e,t,h,g,m]),L=x.useCallback((X,F)=>{const Y=t.find(fe=>fe.id===X);if(!Y)return;const K=e.find(fe=>fe.id===Y.fromNodeId);if(!K)return;y.current+=1;const V=`node-${y.current}-${Date.now()}`,oe=Ua(K,Y.fromHandleId),de={x:(F.clientX-l.translate.x)/l.scale,y:(F.clientY-l.translate.y)/l.scale},Z={id:V,type:S.REROUTE_DOT,position:{x:de.x-30,y:de.y-20},value:JSON.stringify({type:oe}),title:a("node.title.reroute_dot"),width:60,height:40},Q={id:`conn-${Date.now()}-1-${Math.random().toString(36).substr(2,9)}`,fromNodeId:Y.fromNodeId,toNodeId:V,fromHandleId:Y.fromHandleId},j={id:`conn-${Date.now()}-2-${Math.random().toString(36).substr(2,9)}`,fromNodeId:V,toNodeId:Y.toNodeId,toHandleId:Y.toHandleId};v(fe=>[...fe,Z]),C(fe=>[...fe.filter(Pe=>Pe.id!==X),Q,j])},[t,e,a,v,C,y,l]),D=x.useCallback(()=>{if(b.length>1){const X=e.filter(F=>b.includes(F.id));w(X),f([])}},[b,e,w,f]),G=x.useCallback((X,F)=>{if(F.shiftKey){const Y=n.find(K=>K.id===X);Y&&Y.nodeIds.forEach(K=>z(K))}T(X)},[n,z,T]),q=x.useCallback(X=>{const F=n.find(Y=>Y.id===X);F&&(I(F,e,t),k(a("alert.groupSaved",{groupTitle:F.title}),"success"))},[n,e,t,I,a,k]),ie=x.useCallback(async X=>{const F=n.find(j=>j.id===X);if(!F)return;const Y=e.filter(j=>F.nodeIds.includes(j.id));if(Y.length===0)return;const K=new Set(Y.map(j=>j.id)),V=t.filter(j=>K.has(j.fromNodeId)&&K.has(j.toNodeId)),oe=JSON.parse(JSON.stringify(Y)),de=Math.min(...oe.map(j=>j.position.x)),Z=Math.min(...oe.map(j=>j.position.y));oe.forEach(j=>{j.position.x-=de,j.position.y-=Z});const Q={type:"scriptModifierGroup",name:F.title,nodes:oe,connections:V};try{await navigator.clipboard.writeText(JSON.stringify(Q,null,2)),k(a("toast.copied"),"success")}catch(j){console.error("Failed to copy group:",j),k("Failed to copy group","info")}},[n,e,t,a,k]),te=x.useCallback((X,F)=>{if(!X.nodes||X.nodes.length===0)return;const Y=new Map,K=[];let V=1/0,oe=1/0;X.nodes.length>0?X.nodes.forEach(Z=>{V=Math.min(V,Z.position.x),oe=Math.min(oe,Z.position.y)}):(V=0,oe=0),X.nodes.forEach(Z=>{y.current++;const Q=`node-${y.current}-${Date.now()}`;Y.set(Z.id,Q),K.push({...Z,id:Q,position:{x:F.x+(Z.position.x-V),y:F.y+(Z.position.y-oe)}})});const de=(X.connections||[]).map(Z=>({...Z,id:`conn-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,fromNodeId:Y.get(Z.fromNodeId),toNodeId:Y.get(Z.toNodeId)})).filter(Z=>Z.fromNodeId&&Z.toNodeId);v(Z=>[...Z,...K]),C(Z=>[...Z,...de]),w(K,X.name)},[y,v,C,w]),ye=x.useCallback(X=>{const F=n.find(Z=>Z.id===X);if(!F)return;const Y=e.filter(Z=>F.nodeIds.includes(Z.id));if(Y.length===0)return;const K=new Set(Y.map(Z=>Z.id)),V=t.filter(Z=>K.has(Z.fromNodeId)&&K.has(Z.toNodeId)),oe={x:F.position.x+50,y:F.position.y+50},de={name:F.title+" (Copy)",nodes:Y,connections:V};te(de,oe),k(a("toast.pasted"),"success")},[n,e,t,te,a,k]),ue=x.useCallback((X,F,Y)=>{const K=e.find(oe=>oe.id===X);if(!K)return;let V={};try{const oe=JSON.parse(K.value||"{}");switch(F){case Ze.CHARACTERS:K.type===S.CHARACTER_GENERATOR?V={type:"character-generator-data",characters:oe.characters||[]}:K.type===S.CHARACTER_CARD&&(V=(Array.isArray(oe)?oe:[oe]).map(Q=>{const j={},fe=["1:1","16:9","9:16"],Pe=Q.imageSources||Q.thumbnails||{};fe.forEach(ke=>{let $e=Pe[ke];ke==="1:1"&&!$e&&($e=Q.image||Q.imageBase64),$e?j[ke]=$e.startsWith("data:image")?$e:`data:image/png;base64,${$e}`:j[ke]=null});let je=j["1:1"]||null;if(!je&&(Q.image||Q.imageBase64)){const ke=Q.image||Q.imageBase64;je=ke.startsWith("data:image")?ke:`data:image/png;base64,${ke}`,j["1:1"]||(j["1:1"]=je)}return{type:"character-card",nodeTitle:K.title,id:Q.id||`char-card-${Date.now()}-${Math.random()}`,name:Q.name,index:Q.index||Q.alias||"Entity-1",image:je,selectedRatio:Q.selectedRatio||"1:1",prompt:Q.prompt||"",fullDescription:Q.fullDescription||"",imageSources:j,additionalPrompt:Q.additionalPrompt,targetLanguage:Q.targetLanguage,isOutput:Q.isOutput,isActive:Q.isActive!==!1,isDescriptionCollapsed:!!Q.isDescriptionCollapsed,isImageCollapsed:!!Q.isImageCollapsed,isPromptCollapsed:Q.isPromptCollapsed!==!1}}));break;case Ze.SCRIPT:V={type:"script-generator-data",scenes:oe.scenes||[]};break;case Ze.ANALYSIS:V={type:"script-analyzer-data",scenes:oe.scenes||[],visualStyle:oe.visualStyle||""};break;case Ze.FINAL_PROMPTS:V={type:"script-prompt-modifier-data",finalPrompts:oe.finalPrompts||[],usedCharacters:oe.usedCharacters||[]};break;case Ze.YOUTUBE:K.type===S.YOUTUBE_TITLE_GENERATOR?V={type:"youtube-title-data",generatedTitleOutputs:oe.generatedTitleOutputs,generatedChannelOutputs:oe.generatedChannelOutputs}:K.type===S.YOUTUBE_ANALYTICS&&(V={type:"youtube-analytics-data",...oe});break;case Ze.MUSIC:V={type:"music-idea-data",idea:oe.idea,generatedLyrics:oe.generatedLyrics,generatedMusicPrompts:oe.generatedMusicPrompts,generatedTitles:oe.generatedTitles};break;default:V=oe}}catch(oe){console.error("Failed to parse node value for catalog save",oe);return}Array.isArray(V)?V.length>0&&(V[0].nodeTitle=K.title):V.title=K.title,W(F,Y,V),k(a("toast.savedToCatalog"),"success")},[e,W,a,k]),$=x.useCallback(X=>{const F=n.find(Oe=>Oe.id===X);if(!F)return;const Y=e.filter(Oe=>F.nodeIds.includes(Oe.id));if(Y.length===0)return;const K=new Set(Y.map(Oe=>Oe.id)),V=t.filter(Oe=>K.has(Oe.fromNodeId)&&K.has(Oe.toNodeId)),oe=JSON.parse(JSON.stringify(Y)),de=Math.min(...oe.map(Oe=>Oe.position.x)),Z=Math.min(...oe.map(Oe=>Oe.position.y));oe.forEach(Oe=>{Oe.position.x-=de,Oe.position.y-=Z});const Q={type:"scriptModifierGroup",name:F.title,nodes:oe,connections:JSON.parse(JSON.stringify(V))},j=JSON.stringify(Q,null,2),fe=new Blob([j],{type:"application/json"}),Pe=URL.createObjectURL(fe),je=document.createElement("a");je.href=Pe;const ke=new Date,$e=ke.getFullYear(),ze=String(ke.getMonth()+1).padStart(2,"0"),nt=String(ke.getDate()).padStart(2,"0"),at=String(ke.getHours()).padStart(2,"0"),xe=String(ke.getMinutes()).padStart(2,"0"),he=String(ke.getSeconds()).padStart(2,"0"),Ge=`${$e}-${ze}-${nt}_${at}-${xe}-${he}`,me=F.title.replace(/[^a-z0-9-\s-_]/gi,"").trim().replace(/\s+/g,"_");je.download=`${me}_Script_Modifier_Group_${Ge}.json`,je.click(),URL.revokeObjectURL(Pe),je.remove(),k(a("toast.groupSavedToDisk",{groupTitle:F.title}),"success")},[n,e,t,a,k]),ee=x.useCallback(X=>{const F=E.find(K=>K.id===X)||R.find(K=>K.id===X);if(!F)return;const Y={x:(-l.translate.x+window.innerWidth/2)/l.scale,y:(-l.translate.y+window.innerHeight/2)/l.scale};F.type===Ze.GROUP&&F.nodes&&F.connections&&te({name:F.name,nodes:F.nodes,connections:F.connections},Y),N()},[E,R,l,te,N]),Te=x.useCallback(async X=>{const F=e.find(Y=>Y.id===X);(F==null?void 0:F.type)===S.SCRIPT_ANALYZER?await A.handleApplyAliasesForScriptAnalyzer(X):(F==null?void 0:F.type)===S.CHARACTER_GENERATOR&&await A.handleApplyAliasesForCharacterGenerator(X)},[e,A]),le=x.useCallback((X,F)=>{if(!X||!F)return;y.current++;const Y=`node-${y.current}-${Date.now()}`,K={};X.imageBase64&&(K["1:1"]=X.imageBase64);const V=JSON.stringify([{type:"character-card",id:`char-card-${Date.now()}`,name:X.name||"New Entity",index:X.index||X.alias||"Entity-1",imageSources:K,selectedRatio:"1:1",prompt:X.prompt||"",fullDescription:X.fullDescription||"",isOutput:!0,isActive:!0,isPromptCollapsed:!0}]),oe={id:Y,type:S.CHARACTER_CARD,position:{x:F.position.x+F.width+60,y:F.position.y},value:V,title:X.name||a("node.title.character_card"),width:460,height:1e3};v(de=>[...de,oe])},[y,v,a]),J=x.useCallback((X,F)=>{const Y=Z=>{const Q={};Z.imageSources&&Object.keys(Z.imageSources).forEach(fe=>{const Pe=Z.imageSources[fe];typeof Pe=="string"&&Pe.startsWith("data:image")?Q[fe]=Pe.split(",")[1]:Q[fe]=Pe});let j=Z.image;return typeof j=="string"&&j.startsWith("data:image")&&(j=j.split(",")[1]),Q["1:1"]||(Q["1:1"]=j),{type:"character-card",id:Z.id||`char-card-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:Z.name||"Loaded Entity",index:Z.index||Z.alias||"Entity-1",imageSources:Q,selectedRatio:Z.selectedRatio||"1:1",prompt:Z.prompt||"",additionalPrompt:Z.additionalPrompt||"Full body character concept on a gray background",fullDescription:Z.fullDescription||"",targetLanguage:Z.targetLanguage||"en",isOutput:!!Z.isOutput,isActive:Z.isActive!==!1,isDescriptionCollapsed:!!Z.isDescriptionCollapsed,isImageCollapsed:!!Z.isImageCollapsed,isPromptCollapsed:Z.isPromptCollapsed!==!1,nodeTitle:Z.nodeTitle}};let K=[],V=a("node.title.character_card");if(Array.isArray(X))K=X.map(Y),K.length>0&&X[0].nodeTitle?V=X[0].nodeTitle:K.length>1&&(V=`${a("node.title.character_card")} (${K.length})`);else{if(X.type!=="character-card"&&!X.name)return;K=[Y(X)],V=X.title||X.nodeTitle||X.name||a("node.title.character_card")}y.current++;const oe=`node-${y.current}-${Date.now()}`;K=K.map(Z=>({...Z,nodeTitle:V}));const de={id:oe,type:S.CHARACTER_CARD,position:F,value:JSON.stringify(K),title:V,width:Math.max(460,K.length*420),height:1e3};v(Z=>[...Z,de])},[y,v,a]),ge=x.useCallback((X,F)=>{const Y=new FileReader;Y.onload=K=>{var oe;const V=(oe=K.target)==null?void 0:oe.result;if(V){const de=V.split(",")[1];y.current++;const Z=`node-${y.current}-${Date.now()}`,Q=JSON.stringify({imageBase64:de}),j=X.name.replace(/\.[^/.]+$/,"")||a("node.title.image_preview"),fe={id:Z,type:S.IMAGE_PREVIEW,position:F,value:Q,title:j,width:300,height:340};v(Pe=>[...Pe,fe])}},Y.readAsDataURL(X)},[y,v,a]),ae=x.useCallback(X=>{const F=e.find(Y=>Y.id===X);if(!(!F||F.type!==S.GEMINI_CHAT))try{const Y=JSON.parse(F.value||"{}"),K={type:"gemini-chat-data",title:F.title,...Y},V=JSON.stringify(K,null,2),oe=new Blob([V],{type:"application/json"}),de=URL.createObjectURL(oe),Z=document.createElement("a"),Q=new Date,fe=`Gemini_Chat_${`${Q.getFullYear()}-${String(Q.getMonth()+1).padStart(2,"0")}-${String(Q.getDate()).padStart(2,"0")}_${String(Q.getHours()).padStart(2,"0")}-${String(Q.getMinutes()).padStart(2,"0")}`}.json`;Z.href=de,Z.download=fe,Z.click(),URL.revokeObjectURL(de),k(a("toast.savedToCatalog")||"Chat saved","success")}catch(Y){console.error("Failed to download chat:",Y),k(a("toast.saveFailed"),"info")}},[e,k,a]),ce=x.useCallback(async()=>{try{const X=await navigator.clipboard.read().catch(()=>[]),F={x:(s.current.x-l.translate.x)/l.scale,y:(s.current.y-l.translate.y)/l.scale};if(b.length===1){const K=e.find(V=>V.id===b[0]);if(K&&K.type===S.YOUTUBE_ANALYTICS)for(const V of X){const oe=V.types.find(de=>de.startsWith("image/"));if(oe){const de=await V.getType(oe),Z=new File([de],"pasted.png",{type:oe});Py(Z).then(async({thumbnail:Q,metadataImage:j})=>{const fe=`vid-${Date.now()}`,Pe={id:fe,thumbnailBase64:Q,uploadDate:new Date().toISOString(),title:"Processing...",description:"",views:0,likes:0,isShort:!1};if(v(je=>je.map(ke=>{var $e;if(ke.id===K.id)try{const ze=JSON.parse(ke.value||"{}"),nt=ze.channels||[],at=ze.activeChannelId||(($e=nt[0])==null?void 0:$e.id),xe=nt.findIndex(he=>he.id===at);if(xe!==-1){const he=[...nt];return he[xe]={...he[xe],videos:[Pe,...he[xe].videos]},{...ke,value:JSON.stringify({...ze,channels:he})}}}catch(ze){console.error(ze)}return ke})),k(a("toast.videoPasted"),"success",s.current),!!j)try{const je=await Iy(j);v(ke=>ke.map($e=>{var ze;if($e.id===K.id)try{const nt=JSON.parse($e.value||"{}"),at=nt.channels||[],xe=nt.activeChannelId||((ze=at[0])==null?void 0:ze.id),he=at.findIndex(Ge=>Ge.id===xe);if(he!==-1){const Ge=at[he].videos,me=Ge.findIndex(Oe=>Oe.id===fe);if(me!==-1){const Oe=[...Ge];Oe[me]={...Oe[me],title:je.title||"Untitled",description:je.description||"",views:je.views||0,uploadDate:je.uploadDate||Oe[me].uploadDate};const De=[...at];return De[he]={...De[he],videos:Oe},{...$e,value:JSON.stringify({...nt,channels:De})}}}}catch(nt){console.error(nt)}return $e})),k("Metadata extracted!","success")}catch(je){console.error("Gemini analysis failed",je),k("Metadata extraction failed","info")}});return}}}if(b.length===1){const K=e.find(V=>V.id===b[0]);if(K&&K.type===S.CHARACTER_CARD){for(const V of X)if(V.types.includes("text/plain")){const de=await(await V.getType("text/plain")).text();try{const Z=JSON.parse(de);let Q=Z;if(Array.isArray(Z)&&Z.length>0&&(Q=Z[0]),Q.type==="character-card"||Q.name&&Q.fullDescription){const j=JSON.parse(K.value||"[]"),fe=Array.isArray(j)?j:[j],Pe={...Q,type:"character-card",nodeTitle:K.title,id:`char-card-${Date.now()}`,index:Q.index||Q.alias||`Entity-${fe.length+1}`,isActive:!0,isPromptCollapsed:!0};delete Pe.alias,Q.imageSources&&(Object.keys(Q.imageSources).forEach(ke=>{Q.imageSources[ke]&&Q.imageSources[ke].startsWith("data:image")&&(Q.imageSources[ke]=Q.imageSources[ke].split(",")[1])}),Pe.imageSources=Q.imageSources);const je=[...fe,Pe];_(K.id,JSON.stringify(je)),v(ke=>ke.map($e=>$e.id===K.id?{...$e,width:je.length*420}:$e)),k(a("toast.charLoaded"),"success",s.current);return}}catch{}}}}for(const K of X){const V=K.types.find(oe=>oe.startsWith("image/"));if(V){const oe=await K.getType(V),de=new File([oe],"pasted_image.png",{type:V});ge(de,F),k(a("toast.pasted"),"success",s.current);return}}const Y=await navigator.clipboard.readText().catch(()=>"");if(Y){if(Y.startsWith("data:image/")&&Y.includes("base64,")){const K=Y.split(",")[1],V=JSON.stringify({imageBase64:K});y.current++;const de={id:`node-${y.current}-${Date.now()}`,type:S.IMAGE_PREVIEW,position:F,value:V,title:a("node.title.image_preview"),width:300,height:340};v(Z=>[...Z,de]),k(a("toast.pasted"),"success",s.current);return}try{const K=JSON.parse(Y);if(K.type==="group"||K.type==="scriptModifierGroup"){te(K,F),k(a("toast.pasted"),"success",s.current);return}if(Array.isArray(K)&&K.length>0&&(K[0].type==="character-card"||K[0].name)){J(K,F),k(a("toast.charLoaded"),"success",s.current);return}if(K.type==="character-card"||K.name&&K.fullDescription){J(K,F),k(a("toast.charLoaded"),"success",s.current);return}if(K.type==="youtube-analytics-data"){O(S.YOUTUBE_ANALYTICS,F,Y,K.title),k(a("toast.pasted"),"success",s.current);return}if(K.type==="music-idea-data"){O(S.MUSIC_IDEA_GENERATOR,F,Y,K.title),k(a("toast.pasted"),"success",s.current);return}if(K.imageBase64&&typeof K.imageBase64=="string"){y.current++;const oe={id:`node-${y.current}-${Date.now()}`,type:S.IMAGE_PREVIEW,position:F,value:Y,title:a("node.title.image_preview"),width:300,height:340};v(de=>[...de,oe]),k(a("toast.pasted"),"success",s.current);return}}catch{}O(S.TEXT_INPUT,F,Y),k(a("toast.pasted"),"success",s.current);return}}catch(X){console.error("Failed to read clipboard contents: ",X),A.setError("Could not read from clipboard. Permission might be denied.")}},[s,l,O,A,b,e,_,k,a,J,te,v,ge,y]),B=x.useCallback(X=>H(X,a),[H,a]);return{onAddNode:O,handleAddNodeFromToolbar:U,deleteNodeAndConnections:z,handleSplitConnection:L,handleGroupSelection:D,handleRemoveGroup:G,handleSaveGroupToCatalog:q,handleSaveGroupToDisk:$,handleCopyGroup:ie,handleDuplicateGroup:ye,handleAddGroupFromCatalog:ee,handleApplyAliases:Te,handleDetachCharacter:le,addCharacterCardFromFile:J,addImagePreviewNodeFromFile:ge,handlePasteFromClipboard:ce,handleAddGroupFromTemplate:te,handleDuplicateNode:M,handleDuplicateNodeEmpty:B,saveDataToCatalog:ue,handleDownloadChat:ae}},gg=40,Ry=(e,t)=>{const n=new Map;let r;try{r=JSON.parse(e.value||"{}")}catch{r={summary:"",detailedCharacters:[],scenes:[]}}const{summary:a="",detailedCharacters:i=[],scenes:s=[]}=r,l=[];l.push({handleId:"all-script-parts",title:t("node.content.allScriptParts")}),s.some(m=>m.narratorText&&m.narratorText.trim()!=="")&&l.push({handleId:"all-narrator-text",title:t("node.content.allNarratorData")}),a&&l.push({handleId:"summary",title:t("node.content.summary")}),i.forEach((m,_)=>{const y=m.id||`char-idx-${_}`;l.push({handleId:`character-${y}`,title:m.name||"Character"})}),[...s].sort((m,_)=>m.sceneNumber-_.sceneNumber).forEach((m,_)=>{const y=`scene-${_}`;l.push({handleId:y,title:m.title||`Scene ${_+1}`})});const h=e.height-gg,g=l.length;return g===0||l.forEach(({handleId:m,title:_},y)=>{const v=gg+h/(g+1)*(y+1);n.set(m,{y:v,title:_})}),n},hn=40,oa=12,ra=10,xA=({nodes:e,connections:t,selectedNodeIds:n,dollyZoomingInfo:r,draggingInfo:a,effectiveTool:i,isPanning:s,t:l,selectionRect:c})=>{const d=x.useMemo(()=>{const y=new Map;return t.forEach(v=>{y.has(v.toNodeId)||y.set(v.toNodeId,new Set),y.get(v.toNodeId).add(v.toHandleId)}),y},[t]),h=x.useMemo(()=>{if(n.length<=1)return null;const y=e.filter(T=>n.includes(T.id));let v=1/0,C=1/0,w=-1/0;return y.forEach(T=>{v=Math.min(v,T.position.x),C=Math.min(C,T.position.y),w=Math.max(w,T.position.x+T.width)}),v===1/0?null:{x:(v+w)/2,y:C-60}},[n,e]),g=()=>r?"var(--cursor-zoom-in)":a||s?"grabbing":i==="zoom"?"var(--cursor-zoom-in)":i==="selection"?"crosshair":["edit","cutter","reroute"].includes(i)?"grab":"default",m=x.useCallback((y,v,C)=>{const w={x:0,y:0},b={x:0,y:0};if(w.x=y.position.x+y.width,y.isCollapsed){let f=[];const T=Ua(y);if(y.type===S.PROMPT_ANALYZER){let E=[];try{E=JSON.parse(y.value||"{}").characters||[]}catch{}f=["environment",...Array.from({length:Math.max(1,E.length)},(N,A)=>`character-${A}`),"action","style"].map(N=>({handleId:N}))}else if(y.type===S.CHARACTER_ANALYZER)f=[{handleId:"character"},{handleId:"clothing"}];else if(y.type===S.SCRIPT_GENERATOR){f.push({handleId:"all-script-parts"});let E={};try{E=JSON.parse(y.value||"{}")}catch{}(E.scenes||[]).some(A=>A.narratorText&&A.narratorText.trim()!=="")&&f.push({handleId:"all-narrator-text"})}else y.type===S.CHARACTER_CARD?f=[{handleId:"all-characters"},{handleId:"primary-character"}]:(T!==null||y.type===S.REROUTE_DOT)&&(f=[{handleId:void 0}]);const I=f.findIndex(E=>E.handleId===C.fromHandleId);w.y=y.position.y+(I>=0?(I+1)*(hn/(f.length+1)):hn/2)}else switch(y.type){case S.PROMPT_ANALYZER:{let f=[];try{f=JSON.parse(y.value||"{}").characters||[]}catch{}const T=Math.max(1,f.length),I=3+T,R=["environment",...Array.from({length:T},(P,M)=>`character-${M}`),"action","style"].indexOf(C.fromHandleId||""),N=hn+oa,k=y.height-oa-40-8-N;w.y=y.position.y+N+k/I*(R+.5);break}case S.CHARACTER_ANALYZER:{const T=["character","clothing"].indexOf(C.fromHandleId||""),I=hn+oa,R=y.height-oa-40-8-I;w.y=y.position.y+I+R/2*(T+.5);break}case S.CHARACTER_GENERATOR:{let f=[];try{f=JSON.parse(y.value||"{}").characters||[]}catch{}const T=[];f.forEach((N,A)=>{T.push({handleId:N.id?`character-${N.id}`:`character-${A}`})});const I=T.length,E=y.height-hn,R=T.findIndex(N=>N.handleId===C.fromHandleId);R!==-1?w.y=y.position.y+hn+E/(I+1)*(R+1):w.y=y.position.y+y.height/2;break}case S.SCRIPT_GENERATOR:{const T=Ry(y,l).get(C.fromHandleId||"all-script-parts");w.y=T?y.position.y+T.y:y.position.y+y.height/2;break}case S.SCRIPT_ANALYZER:{let f={characters:[],scenes:[]};try{f=JSON.parse(y.value||"{}")}catch{}const{characters:T=[],scenes:I=[]}=f,E=[];E.push({handleId:"all-script-analyzer-data"}),I.some(A=>A.narratorText)&&E.push({handleId:"all-narrator-data"}),T.forEach((A,k)=>{const P=A.id||`char-idx-${k}`;E.push({handleId:`character-${P}`})});const N=E.findIndex(A=>A.handleId===C.fromHandleId);if(N!==-1){const A=y.height-hn;w.y=y.position.y+hn+A/(E.length+1)*(N+1)}else w.y=y.position.y+y.height/2;break}case S.SCRIPT_PROMPT_MODIFIER:{let f={finalPrompts:[]};try{f=JSON.parse(y.value||"{}")}catch{}const{finalPrompts:T=[]}=f,I=C.fromHandleId||"",E=T.findIndex(R=>`final-prompt-${R.frameNumber}`===I);if(E!==-1){const R=T.length,A=(y.height-hn)/(R+1)*(E+1);w.y=y.position.y+hn+A}else w.y=y.position.y+y.height/2;break}case S.NARRATOR_TEXT_GENERATOR:{let f={};try{f=JSON.parse(y.value||"{}").targetLanguages||{}}catch{}const T=Object.entries(f).filter(([,E])=>E).map(([E])=>E),I=T.indexOf(C.fromHandleId||"");if(I!==-1){const E=T.length,R=60,N=96,A=40,k=8,P=R+k+N+k+A,M=hn+oa+P+k,W=y.height-oa-M;let O;if(W<=20*E){const z=y.height-M;O=M+z/(E+1)*(I+1)}else O=M+W/E*(I+.5);const U=Math.max(hn+ra,Math.min(O,y.height-ra));w.y=y.position.y+U}else w.y=y.position.y+y.height/2;break}case S.YOUTUBE_TITLE_GENERATOR:{let f={};try{f=JSON.parse(y.value||"{}").targetLanguages||{}}catch{}const T=Object.entries(f).filter(([,E])=>E).map(([E])=>E),I=T.indexOf(C.fromHandleId||"");if(I!==-1){const E=T.length,R=y.height-hn,N=hn+R/(E+1)*(I+1),A=Math.max(hn+ra,Math.min(N,y.height-ra));w.y=y.position.y+A}else w.y=y.position.y+y.height/2;break}case S.CHARACTER_CARD:{const f=[{handleId:"all-characters"},{handleId:"primary-character"}],T=y.height-hn,I=f.length,E=f.findIndex(R=>R.handleId===C.fromHandleId);if(E!==-1){const R=hn+T/(I+1)*(E+1),N=Math.max(hn+ra,Math.min(R,y.height-ra));w.y=y.position.y+N}else w.y=y.position.y+y.height/2;break}default:w.y=y.position.y+y.height/2}if(b.x=v.position.x,v.isCollapsed){let f=[];v.type===S.SCRIPT_GENERATOR?f=[{handleId:"prompt"},{handleId:"characters"}]:v.type===S.SCRIPT_PROMPT_MODIFIER?f=[{handleId:"all-script-analyzer-data"},{handleId:"style"}]:v.type===S.SCRIPT_ANALYZER?f=[{handleId:void 0}]:(Jr(v)!==null||v.type===S.REROUTE_DOT)&&(f=[{handleId:void 0}]);const T=f.findIndex(I=>I.handleId===C.toHandleId);b.y=v.position.y+(T>=0?(T+1)*(hn/(f.length+1)):hn/2)}else{let f;const T=(I,E,R)=>{const N=I&&E[I]?E[I]:R;return v.position.y+v.height*N};switch(v.type){case S.SCRIPT_GENERATOR:C.toHandleId==="prompt"?f=v.position.y+95:C.toHandleId==="characters"?f=v.position.y+330:f=v.position.y+v.height/2;break;case S.SCRIPT_PROMPT_MODIFIER:f=T(C.toHandleId,{"all-script-analyzer-data":1/3,style:2/3},1/3);break;case S.SCRIPT_ANALYZER:f=v.position.y+v.height/2;break;default:f=v.position.y+v.height/2}b.y=f}return{start:w,end:b}},[e,l]),_=x.useMemo(()=>{if(!c)return null;const{start:y,end:v}=c,C=Math.min(y.x,v.x),w=Math.min(y.y,v.y),b=Math.abs(y.x-v.x),f=Math.abs(y.y-v.y);return{x:C,y:w,width:b,height:f}},[c]);return{connectedInputs:d,groupButtonPosition:h,getCanvasCursor:g,getConnectionPoints:m,selectionRect:_}},vA=({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:r,setError:a,executionStopRequested:i})=>{const[s,l]=x.useState(null),[c,d]=x.useState(null),[h,g]=x.useState(null),[m,_]=x.useState(null),[y,v]=x.useState(null),[C,w]=x.useState(null),[b,f]=x.useState(null),[T,I]=x.useState(null),[E,R]=x.useState(null),[N,A]=x.useState(null),[k,P]=x.useState(null),[M,H]=x.useState(null),[W,O]=x.useState(null),[U,z]=x.useState(null),L=x.useCallback(async ae=>{i.current=!1;const ce=e.find(ke=>ke.id===ae);if(!ce)return;let B;try{B=JSON.parse(ce.value||"{}")}catch{B={}}const{prompt:X,targetLanguage:F,characterType:Y,model:K,visualStyle:V,customVisualStyle:oe,createSecondaryChars:de,createKeyItems:Z,thinkingEnabled:Q,useExistingCharacters:j,detailedCharacters:fe}=B,Pe=t.find(ke=>ke.toNodeId===ae&&(ke.toHandleId==="prompt"||ke.toHandleId===void 0)),je=Pe?r(Pe.fromNodeId,Pe.fromHandleId):X;if(!je.trim()&&(!fe||fe.length===0)){a("No prompt or existing characters provided.");return}d(ae),a(null);try{const ke=await Kk(je,F,Y,fe,B,K,V,oe,de,Z,Q);if(i.current)throw new Error("Generation stopped.");let $e=ke.detailedCharacters||[];const ze=fe.reduce((xe,he)=>{const Ge=(he.index||"").match(/(\d+)/),me=Ge?parseInt(Ge[1],10):0;return Math.max(xe,me)},0);$e=$e.map((xe,he)=>({...xe,id:`gen-ent-${Date.now()}-${he}`,index:`Entity-${ze+he+1}`}));const nt=[...fe||[],...$e],at={...B.uiState||{},isCharactersSectionCollapsed:!1};n(xe=>xe.map(he=>he.id===ae?{...he,value:JSON.stringify({...B,detailedCharacters:nt,uiState:at})}:he))}catch(ke){a(ke.message||"Entity generation failed.")}finally{d(null)}},[e,t,r,n,a,i]),D=x.useCallback(async ae=>{i.current=!1;const ce=e.find(he=>he.id===ae);if(!ce)return;let B;try{B=JSON.parse(ce.value||"{}")}catch{B={}}const{prompt:X,targetLanguage:F,characterType:Y,narratorEnabled:K,narratorMode:V,model:oe,visualStyle:de,customVisualStyle:Z,thinkingEnabled:Q,scenelessMode:j,simpleActions:fe,commercialSafe:Pe,smartConceptEnabled:je,atmosphericEntryEnabled:ke,useExistingCharacters:$e,detailedCharacters:ze}=B,nt=t.find(he=>he.toNodeId===ae&&(he.toHandleId==="prompt"||he.toHandleId===void 0)),at=nt?r(nt.fromNodeId,nt.fromHandleId):X;if(!at.trim()&&(!ze||ze.length===0)){a("No prompt or existing characters provided.");return}l(ae),a(null);const xe=Date.now();n(he=>he.map(Ge=>Ge.id===ae?{...Ge,value:JSON.stringify({...B,generationProgress:{current:0,total:1,totalStartTime:xe,currentItemStartTime:xe}})}:Ge));try{const he=await Jk(at,F,Y,K,V,ze,B,oe,de,Z,Q,j,fe,Pe,je,ke);if(i.current)throw new Error("Generation stopped.");const Ge=he.generatedStyle||he.visualStyle||"",me={...he,generatedStyle:Ge,visualStyle:B.visualStyle,detailedCharacters:ze};n(Oe=>Oe.map(De=>{if(De.id===ae){const Ce=JSON.parse(De.value||"{}");return{...De,value:JSON.stringify({...Ce,...me,generationProgress:{...Ce.generationProgress,endTime:Date.now(),current:1}})}}return De}))}catch(he){a(he.message||"Script generation failed.")}finally{l(null)}},[e,t,r,n,a,i]),G=x.useCallback(async ae=>{const ce=e.find(Q=>Q.id===ae);if(!ce)return;let B;try{B=JSON.parse(ce.value||"{}")}catch{B={}}const{prompt:X,numberOfCharacters:F,targetLanguage:Y,characterType:K,style:V,customStyle:oe}=B,de=t.find(Q=>Q.toNodeId===ae),Z=de?r(de.fromNodeId,de.fromHandleId):X;if(!Z.trim()){a("No prompt provided.");return}g(ae),a(null);try{const Q=await eA(Z,F,Y,K,V,oe);n(j=>j.map(fe=>{if(fe.id===ae){const Pe=JSON.parse(fe.value||"{}");return{...fe,value:JSON.stringify({...Pe,characters:Q})}}return fe}))}catch(Q){a(Q.message||"Character generation failed.")}finally{g(null)}},[e,t,r,n,a]),q=x.useCallback(async(ae,ce)=>{const B=e.find(K=>K.id===ae);if(!B)return;let X;try{X=JSON.parse(B.value||"{}")}catch{X={}}let F="";if(B.type===S.IMAGE_GENERATOR){const K=t.find(V=>V.toNodeId===ae);F=K?r(K.fromNodeId,K.fromHandleId):X.prompt}else if(B.type===S.CHARACTER_GENERATOR&&ce!==void 0){const K=X.characters.find(V=>V.id===ce);F=K?K.prompt:"",K&&K.additionalPrompt&&K.additionalPrompt.trim()&&(F=`${F}, ${K.additionalPrompt.trim()}`)}else if(B.type===S.CHARACTER_CARD&&ce!==void 0){const K=Array.isArray(X)?X[ce]:X;F=K.prompt,K.additionalPrompt&&K.additionalPrompt.trim()&&(F=`${F}, ${K.additionalPrompt}`)}if(!F){a("No prompt found.");return}const Y=ce!==void 0?`${ae}-${ce}`:ae;ce!==void 0?v(Y):_(ae),a(null);try{let K="1:1";B.type===S.CHARACTER_CARD&&ce!==void 0&&(K=(Array.isArray(X)?X[ce]:X).selectedRatio||"1:1");const V=await nA(F,K);n(oe=>oe.map(de=>{if(de.id===ae){const Z=JSON.parse(de.value||"{}");if(B.type===S.IMAGE_GENERATOR)return{...de,value:JSON.stringify({...Z,imageBase64:V})};if(B.type===S.CHARACTER_GENERATOR){const Q=Z.characters.map(j=>j.id===ce?{...j,imageBase64:V}:j);return{...de,value:JSON.stringify({...Z,characters:Q})}}else if(B.type===S.CHARACTER_CARD){const Q=[...Array.isArray(Z)?Z:[Z]],j=ce;if(Q[j]){const fe=Q[j],Pe={...fe.imageSources,[K]:V},je={...fe.thumbnails,[K]:V};Q[j]={...fe,image:V,imageSources:Pe,thumbnails:je}}return{...de,value:JSON.stringify(Q)}}}return de}))}catch(K){a(K.message||"Image generation failed.")}finally{ce!==void 0?v(null):_(null)}},[e,t,r,n,a]),ie=x.useCallback(async ae=>{const ce=e.find(fe=>fe.id===ae);if(!ce)return;let B;try{B=JSON.parse(ce.value||"{}")}catch{B={}}const{voice:X,intonation:F,audioFiles:Y,mode:K,isMultiSpeaker:V,speaker1Name:oe,speaker1Voice:de,speaker2Name:Z,speaker2Voice:Q}=B;let j=B.inputText;if(!j||Array.isArray(j)&&j.length===0){a("No text to synthesize.");return}w(ae),a(null);try{const fe=[...Y],Pe=V?{speakers:[{name:oe,voice:de},{name:Z,voice:Q}]}:void 0,je=V?"multi":X;if(K==="scene"&&Array.isArray(j)){for(const ke of j)if(ke.text){const $e=await Vd(ke.text,je,F,Pe);$e&&fe.push({id:`scene-${ke.sceneNumber}-${Date.now()}`,title:`Scene ${ke.sceneNumber}`,text:ke.text,audioData:$e,voiceName:V?"Multi":X,intonation:F})}}else{const ke=typeof j=="string"?j:"",$e=await Vd(ke,je,F,Pe);$e&&fe.push({id:`simple-${Date.now()}`,title:"Generated Audio",text:ke.substring(0,50)+"...",audioData:$e,voiceName:V?"Multi":X,intonation:F})}n(ke=>ke.map($e=>$e.id===ae?{...$e,value:JSON.stringify({...B,audioFiles:fe})}:$e))}catch(fe){a(fe.message||"Speech generation failed.")}finally{w(null)}},[e,n,a]),te=x.useCallback(async ae=>{const ce=e.find(V=>V.id===ae);if(!ce)return;let B;try{B=JSON.parse(ce.value||"{}")}catch{B={}}const{prompt:X,role:F,targetLanguages:Y,generateSSML:K}=B;if(!X){a("No prompt provided.");return}f(ae),a(null);try{const V=Object.keys(Y).filter(de=>Y[de]),oe=await lA(X,F,V,K);n(de=>de.map(Z=>{if(Z.id===ae){const Q=JSON.parse(Z.value||"{}");return{...Z,value:JSON.stringify({...Q,generatedTexts:oe})}}return Z}))}catch(V){a(V.message||"Narrator text generation failed.")}finally{f(null)}},[e,n,a]),ye=x.useCallback(async ae=>{const ce=e.find(Y=>Y.id===ae);if(!ce)return;let B;try{B=JSON.parse(ce.value||"{}")}catch{B={}}const{audioBase64:X,mimeType:F}=B;if(!X){a("No audio loaded.");return}I(ae),a(null);try{const Y=await cA(X,F||"audio/mp3");let K=[];try{K=JSON.parse(Y)}catch{}const V=K.map(oe=>oe.text).join(" ");n(oe=>oe.map(de=>de.id===ae?{...de,value:JSON.stringify({...B,transcription:V,segments:K})}:de))}catch(Y){a(Y.message||"Transcription failed.")}finally{I(null)}},[e,n,a]),ue=x.useCallback(async ae=>{const ce=e.find(de=>de.id===ae);if(!ce)return;let B;try{B=JSON.parse(ce.value||"{}")}catch{B={}}const{idea:X,targetLanguages:F,includeHashtags:Y,generateThumbnail:K}=B,V=t.find(de=>de.toNodeId===ae),oe=V?r(V.fromNodeId,V.fromHandleId):X;if(!oe){a("No idea provided.");return}R(ae),a(null);try{const de=Object.keys(F).filter(Q=>F[Q]),Z=await mA(oe,de,{includeHashtags:Y,generateThumbnail:K});n(Q=>Q.map(j=>j.id===ae?{...j,value:JSON.stringify({...B,generatedTitleOutputs:Z})}:j))}catch(de){a(de.message||"Title generation failed.")}finally{R(null)}},[e,t,r,n,a]),$=x.useCallback(async ae=>{const ce=e.find(V=>V.id===ae);if(!ce)return;let B;try{B=JSON.parse(ce.value||"{}")}catch{B={}}const{idea:X,targetLanguages:F}=B,Y=t.find(V=>V.toNodeId===ae),K=Y?r(Y.fromNodeId,Y.fromHandleId):X;if(!K){a("No theme provided.");return}A(ae),a(null);try{const V=Object.keys(F).filter(de=>F[de]),oe=await gA(K,V);n(de=>de.map(Z=>Z.id===ae?{...Z,value:JSON.stringify({...B,generatedChannelOutputs:oe})}:Z))}catch(V){a(V.message||"Channel info generation failed.")}finally{A(null)}},[e,t,r,n,a]),ee=x.useCallback(async ae=>{const ce=e.find(Q=>Q.id===ae);if(!ce)return;let B;try{B=JSON.parse(ce.value||"{}")}catch{a("Invalid node data.");return}const{idea:X,targetLanguages:F,generateLyrics:Y,verseCount:K,model:V}=B,oe=t.find(Q=>Q.toNodeId===ae),de=oe?r(oe.fromNodeId,oe.fromHandleId):X;if(!Object.values(F).some(Q=>Q)){a("Please select at least one language.");return}if(!de||!de.trim()){a("Please provide an idea.");return}a(null),P(ae);try{const Q=await pA(de,F,Y,K||2,V),j={},fe={},Pe={};for(const ke in Q)Q[ke].lyrics&&(j[ke]=Q[ke].lyrics),Q[ke].music_prompt&&(fe[ke]=Q[ke].music_prompt),Q[ke].song_title&&(Pe[ke]=Q[ke].song_title);const je={...B,idea:de,generatedLyrics:j,generatedMusicPrompts:fe,generatedTitles:Pe};n(ke=>ke.map($e=>$e.id===ae?{...$e,value:JSON.stringify(je)}:$e))}catch(Q){a(Q.message||"An unknown error occurred.")}finally{P(null)}},[e,t,r,n,a,P]),Te=x.useCallback(async ae=>{const ce=e.find(F=>F.id===ae);if(!ce)return;let B;try{B=JSON.parse(ce.value||"{}")}catch{B={}}const{imageBase64:X}=B;if(!X){a("No image loaded.");return}H(ae),a(null);try{const F=await oA(X);n(Y=>Y.map(K=>K.id===ae?{...K,value:JSON.stringify({...B,extractedText:F})}:K))}catch(F){a(F.message||"Text extraction failed.")}finally{H(null)}},[e,n,a]),le=x.useCallback(async ae=>{const ce=e.find(K=>K.id===ae);if(!ce)return;let B;try{B=JSON.parse(ce.value||"{}")}catch{B={}}const{targetLanguage:X,format:F,theme:Y}=B;O(ae),a(null);try{const K=await dA(X,F,Y);n(V=>V.map(oe=>oe.id===ae?{...oe,value:JSON.stringify({...B,categories:K,stage:"selection",selection:{action:null,place:null,obstacle:null}})}:oe))}catch(K){a(K.message||"Category generation failed.")}finally{O(null)}},[e,n,a]),J=x.useCallback(async ae=>{const ce=e.find(Y=>Y.id===ae);if(!ce)return;let B;try{B=JSON.parse(ce.value||"{}")}catch{B={}}const{selection:X,targetLanguage:F}=B;if(!X.action||!X.place||!X.obstacle){a("Please select all three categories.");return}z(ae),a(null);try{const Y=await uA(X.action,X.place,X.obstacle,F);n(K=>K.map(V=>V.id===ae?{...V,value:JSON.stringify({...B,generatedIdea:Y})}:V))}catch(Y){a(Y.message||"Idea generation failed.")}finally{z(null)}},[e,n,a]),ge=x.useCallback(()=>{l(null),d(null),g(null),_(null),v(null),w(null),f(null),I(null),R(null),A(null),P(null),H(null),O(null),z(null)},[]);return{handleGenerateScript:D,handleGenerateEntities:L,handleGenerateCharacters:G,handleGenerateImage:q,handleGenerateCharacterImage:(ae,ce)=>q(ae,ce),handleGenerateSpeech:ie,handleGenerateNarratorText:te,handleTranscribeAudio:ye,handleGenerateYouTubeTitles:ue,handleGenerateYouTubeChannelInfo:$,handleGenerateMusicIdeas:ee,handleExtractTextFromImage:Te,handleGenerateIdeaCategories:le,handleCombineStoryIdea:J,stop:ge,states:{isGeneratingScript:s,isGeneratingEntities:c,isGeneratingCharacters:h,isGeneratingImage:m,isGeneratingCharacterImage:y,isGeneratingSpeech:C,isGeneratingNarratorText:b,isTranscribingAudio:T,isGeneratingYouTubeTitles:E,isGeneratingYouTubeChannelInfo:N,isGeneratingMusicIdeas:k,isExtractingText:M,isGeneratingIdeaCategories:W,isCombiningStoryIdea:U}}},Ts=e=>{if(!e)return[];const t=/\[Character-(\d+)\]/g,n=new Set;let r;for(;(r=t.exec(e))!==null;)n.add(`Character-${r[1]}`);return Array.from(n)},fg=e=>e.sort((t,n)=>{const r=parseInt(t.replace(/\D/g,"")||"0",10),a=parseInt(n.replace(/\D/g,"")||"0",10);return r-a}),bA=({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:r,setError:a,executionStopRequested:i})=>{const[s,l]=x.useState(null),[c,d]=x.useState(null),[h,g]=x.useState(null),[m,_]=x.useState(null),[y,v]=x.useState(null),[C,w]=x.useState(null),b=x.useCallback(async A=>{const P=t.filter(M=>M.toNodeId===A).map(M=>r(M.fromNodeId,M.fromHandleId));a(null),l(A);try{const M=await rA(P);n(H=>H.map(W=>W.id===A?{...W,value:M}:W))}catch(M){throw a(M.message||"An unknown error occurred."),M}finally{l(null)}},[t,n,r,a,l]),f=x.useCallback(async A=>{var P;const k=e.find(M=>M.id===A);if(k){d(A),a(null);try{let M;try{M=JSON.parse(k.value||"{}")}catch{M={}}let{inputText:H="",targetLanguage:W="en"}=M;const O=t.find(L=>L.toNodeId===A);if(O&&(H=r(O.fromNodeId,O.fromHandleId)),!H.trim())throw new Error("No text to translate.");const U=((P=zl.find(L=>L.code===W))==null?void 0:P.name)||"English",z=await aA(H,U);n(L=>L.map(D=>{if(D.id===A){const G={...M,inputText:H,translatedText:z};return{...D,value:JSON.stringify(G)}}return D}))}catch(M){a(M.message||"An unknown error occurred during translation.")}finally{d(null)}}},[t,n,r,e,a,d]),T=x.useCallback(async(A,k,P,M)=>{const H=`${A}/${k}`;g(H),a(null);try{const W=await hg(P,M);n(O=>O.map(U=>{var z,L;if(U.id===A)try{const D=JSON.parse(U.value||"{}");let G=!1;if(k==="summary")D.summary=W,G=!0;else if(k.startsWith("character-")){const q=k.substring(10),ie=(z=D.detailedCharacters)==null?void 0:z.find(te=>te.id===q);ie&&(ie.fullDescription=W,G=!0)}else if(k.startsWith("scene-")){const q=k.split("-"),ie=parseInt(q[1],10),te=q[2],ye=(L=D.scenes)==null?void 0:L[ie];ye&&(te==="narratorText"?ye.narratorText=W:ye.description=W,G=!0)}return G?{...U,value:JSON.stringify(D)}:U}catch{return U}return U}))}catch(W){a(W.message||"An unknown error occurred during modification.")}finally{g(null)}},[n,a,g]),I=x.useCallback(async(A,k,P,M)=>{if(!M.trim())return;const H=`${A}/frame-${k}/${P}`;g(H),a(null);try{const W=e.find(G=>G.id===A);if(!W)throw new Error("Node not found");const z=(JSON.parse(W.value||"{}").scenes||[]).flatMap(G=>G.frames).find(G=>G.frameNumber===k);if(!z||!z[P])throw new Error("Frame or part not found");const L=z[P],D=await hg(L,M);n(G=>G.map(q=>{if(q.id===A)try{const ie=JSON.parse(q.value||"{}"),te=ie.scenes.map(ye=>({...ye,frames:ye.frames.map(ue=>ue.frameNumber===k?{...ue,[P]:D}:ue)}));return{...q,value:JSON.stringify({...ie,scenes:te})}}catch{return q}return q}))}catch(W){a(W.message||"An unknown error occurred during modification.")}finally{g(null)}},[e,n,a,g]),E=x.useCallback(async A=>{const k=e.find(H=>H.id===A);if(!k)return;const P=t.find(H=>H.toNodeId===A);let M=k.value;if(P&&(M=r(P.fromNodeId,P.fromHandleId)),!M.trim()){a("No text to fix.");return}_(A),a(null);try{const H=await iA(M);n(W=>W.map(O=>O.id===A?{...O,value:H}:O))}catch(H){a(H.message||"An unknown error occurred while fixing errors.")}finally{_(null)}},[e,t,r,n,a,_]),R=x.useCallback(async A=>{i.current=!1;const k=e.find(j=>j.id===A);if(!k||y===A)return;const P=t.find(j=>j.toNodeId===A&&(j.toHandleId==="all-script-analyzer-data"||!j.toHandleId));if(!P){a("Please connect a Script Analyzer node to the 'Data from analyzer' input.");return}const M=r(P.fromNodeId,P.fromHandleId);if(!M||M.trim()===""||M.trim()==="{}"){a("Upstream script analysis data is empty.");return}let H,W;try{H=JSON.parse(M),W=JSON.parse(k.value||"{}")}catch{a("Failed to parse node data. Ensure it's valid JSON.");return}const{characters:O=[],scenes:U=[]}=H,{targetLanguage:z="en",startFrameNumber:L=null,endFrameNumber:D=null,startSceneNumber:G=null,endSceneNumber:q=null,styleOverride:ie,model:te="gemini-2.5-pro",disabledInstructionIds:ye=[],includeGeneralCharDesc:ue=!1,includeFullCharDesc:$=!1,safeGeneration:ee=!1,thinkingEnabled:Te=!1,charDescMode:le,sceneContexts:J={}}=W;let ge=le;ge||($?ge="full":ue===!1?ge="none":ge="general");const ce=Object.keys(ne).map(j=>ne[j].id).filter(j=>!ye.includes(j)),B=ce.includes(ne.PROCESS_WHOLE_SCENE.id),X=ce.includes(ne.GENERATE_VIDEO_PROMPT.id),F=t.find(j=>j.toNodeId===A&&j.toHandleId==="style");let Y=ie;F?Y=r(F.fromNodeId,F.fromHandleId):Y||(Y=H.visualStyle||H.generatedStyle||"");const K={};O.forEach(j=>{const fe=j.imagePrompt||j.prompt||j.fullDescription||"";j.index&&(K[j.index]=`${j.name} [Visual Profile: ${fe}]`),j.alias&&(K[j.alias]=`${j.name} [Visual Profile: ${fe}]`),j.name&&(K[j.name]=`${j.name} [Visual Profile: ${fe}]`)});let V=[];const oe=U.map(j=>({...j,sceneContext:J[j.sceneNumber]&&J[j.sceneNumber].trim()?J[j.sceneNumber]:j.sceneContext||""}));if(B?V=oe.filter(j=>{const fe=j.sceneNumber,Pe=!G||fe>=G,je=!q||fe<=q;return Pe&&je}).map(j=>({...j,framesToProcess:j.frames||[]})):V=oe.map(j=>{const fe=(j.frames||[]).filter(Pe=>{const je=!L||Pe.frameNumber>=L,ke=!D||Pe.frameNumber<=D;return je&&ke});return{...j,framesToProcess:fe}}).filter(j=>j.framesToProcess.length>0),V.length===0){a(B?"No scenes found in the specified range.":"No frames to process within the specified range.");return}a(null),v(A);let de=0,Z=0;V.forEach(j=>Z+=j.framesToProcess.length);const Q=Date.now();n(j=>j.map(fe=>{if(fe.id===A)try{const Pe=JSON.parse(fe.value||"{}");return{...fe,value:JSON.stringify({...Pe,generationProgress:{current:0,total:Z,totalStartTime:Q,currentItemStartTime:Date.now()}})}}catch{return fe}return fe}));try{if(B)for(const j of V){if(i.current)throw new Error("Chain execution stopped.");const fe=Date.now();n(Pe=>Pe.map(je=>{if(je.id===A)try{const ke=JSON.parse(je.value||"{}"),$e=ke.generationProgress||{current:de,total:Z,totalStartTime:Q};return{...je,value:JSON.stringify({...ke,generationProgress:{...$e,currentItemStartTime:fe}})}}catch{return je}return je}));try{const Pe=j.sceneContext||"",je=await Zk(Pe,j.framesToProcess,K,z,Y,te,ce,{charDescMode:ge,safeGeneration:ee,thinkingEnabled:Te}),ke=[],$e=[];Array.isArray(je)&&je.length===j.framesToProcess.length?(je.forEach((ze,nt)=>{const at=j.framesToProcess[nt],xe=(at.characters||[]).map(Ce=>{const Qe=O.find(pe=>pe.index===Ce||pe.alias===Ce);if(!Qe){const pe=O.find(Se=>Se.name===Ce);return pe?pe.index||pe.alias:Ce}return Qe.index||Qe.alias});let he="",Ge="";typeof ze=="string"?he=ze:ze&&typeof ze=="object"&&(he=ze.imagePrompt||"",Ge=ze.videoPrompt||"");const me=Ts(he),Oe=Ts(Ge),De=fg(Array.from(new Set([...xe,...me,...Oe])));ke.push({frameNumber:at.frameNumber,sceneNumber:j.sceneNumber,sceneTitle:j.title,characters:De,duration:at.duration,prompt:he,shotType:at.shotType}),X&&Ge&&$e.push({frameNumber:at.frameNumber,sceneNumber:j.sceneNumber,sceneTitle:j.title,videoPrompt:Ge,shotType:at.shotType})}),de+=j.framesToProcess.length,n(ze=>ze.map(nt=>{if(nt.id===A)try{const at=JSON.parse(nt.value||"{}");let xe=[...at.finalPrompts||[]];const he=De=>`${De.sceneNumber}-${De.frameNumber}`,Ge=new Map(ke.map(De=>[he(De),De]));xe=xe.map(De=>{const Ce=he(De);return Ge.has(Ce)?Ge.get(Ce):De}),ke.forEach(De=>{xe.some(Ce=>Ce.frameNumber===De.frameNumber&&Ce.sceneNumber===De.sceneNumber)||xe.push(De)}),xe.sort((De,Ce)=>De.sceneNumber!==Ce.sceneNumber?(De.sceneNumber||0)-(Ce.sceneNumber||0):De.frameNumber-Ce.frameNumber);let me=[...at.videoPrompts||[]];const Oe=new Map($e.map(De=>[he(De),De]));return me=me.map(De=>{const Ce=he(De);return Oe.has(Ce)?Oe.get(Ce):De}),$e.forEach(De=>{me.some(Ce=>Ce.frameNumber===De.frameNumber&&Ce.sceneNumber===De.sceneNumber)||me.push(De)}),me.sort((De,Ce)=>De.sceneNumber!==Ce.sceneNumber?(De.sceneNumber||0)-(Ce.sceneNumber||0):De.frameNumber-Ce.frameNumber),{...nt,value:JSON.stringify({...at,finalPrompts:xe,videoPrompts:me,generationProgress:{current:de,total:Z,totalStartTime:Q,currentItemStartTime:Date.now()}})}}catch{return nt}return nt}))):(de+=j.framesToProcess.length,a(`Warning: Batch result mismatch for Scene ${j.sceneNumber}`))}catch(Pe){a(`Error in Scene ${j.sceneNumber}: ${Pe.message}`),de+=j.framesToProcess.length,n(je=>je.map(ke=>{if(ke.id===A)try{const $e=JSON.parse(ke.value||"{}");return{...ke,value:JSON.stringify({...$e,generationProgress:{current:de,total:Z,totalStartTime:Q,currentItemStartTime:Date.now()}})}}catch{return ke}return ke}))}}else for(const j of V)for(const fe of j.framesToProcess){if(i.current)throw new Error("Chain execution stopped.");const Pe=Date.now();n(je=>je.map(ke=>{if(ke.id===A)try{const $e=JSON.parse(ke.value||"{}"),ze=$e.generationProgress||{current:de,total:Z,totalStartTime:Q};return{...ke,value:JSON.stringify({...$e,generationProgress:{...ze,currentItemStartTime:Pe}})}}catch{return ke}return ke}));try{const je=fe.imagePrompt||"",ke=fe.environmentPrompt||"",$e=(fe.characters||[]).map(Ce=>{if(K[Ce])return`[${Ce}]: ${K[Ce]}`;const Qe=O.find(pe=>pe.name===Ce);if(Qe){const pe=Qe.imagePrompt||Qe.prompt||"";return`[${Ce}]: ${Qe.name} [Visual Profile: ${pe}]`}return null}).filter(Boolean),ze=(fe.characters||[]).map(Ce=>{const Qe=O.find(pe=>pe.index===Ce||pe.alias===Ce);if(!Qe){const pe=O.find(Se=>Se.name===Ce);return pe?pe.index||pe.alias:Ce}return Qe.index||Qe.alias}),nt=await Xk(je,ke,$e,z,Y,j.sceneContext||"",K,fe.characters||[],ce,{charDescMode:ge,safeGeneration:ee,thinkingEnabled:Te});let at="",xe="";typeof nt=="string"?at=nt:(at=nt.imagePrompt,xe=nt.videoPrompt);const he=Ts(at),Ge=Ts(xe),me=fg(Array.from(new Set([...ze,...he,...Ge]))),Oe={frameNumber:fe.frameNumber,sceneNumber:j.sceneNumber,sceneTitle:j.title,characters:me,duration:fe.duration,prompt:at,shotType:fe.shotType};let De=null;X&&xe&&(De={frameNumber:fe.frameNumber,sceneNumber:j.sceneNumber,sceneTitle:j.title,videoPrompt:xe,shotType:fe.shotType}),de++,n(Ce=>Ce.map(Qe=>{if(Qe.id===A)try{const pe=JSON.parse(Qe.value||"{}");let Se=[...pe.finalPrompts||[]];const Ee=Se.findIndex(be=>be.frameNumber===fe.frameNumber&&be.sceneNumber===j.sceneNumber);Ee!==-1?Se[Ee]=Oe:Se.push(Oe),Se.sort((be,_e)=>be.sceneNumber!==_e.sceneNumber?(be.sceneNumber||0)-(_e.sceneNumber||0):be.frameNumber-_e.frameNumber);let Fe=[...pe.videoPrompts||[]];if(De){const be=Fe.findIndex(_e=>_e.frameNumber===fe.frameNumber&&_e.sceneNumber===j.sceneNumber);be!==-1?Fe[be]=De:Fe.push(De),Fe.sort((_e,Ue)=>_e.sceneNumber!==Ue.sceneNumber?(_e.sceneNumber||0)-(Ue.sceneNumber||0):_e.frameNumber-Ue.frameNumber)}return{...Qe,value:JSON.stringify({...pe,finalPrompts:Se,videoPrompts:Fe,generationProgress:{current:de,total:Z,totalStartTime:Q,currentItemStartTime:Date.now()}})}}catch{return Qe}return Qe}))}catch{de++}}n(j=>j.map(fe=>{if(fe.id===A)try{const Pe=JSON.parse(fe.value||"{}"),je=Pe.generationProgress;return je?{...fe,value:JSON.stringify({...Pe,generationProgress:{...je,endTime:Date.now()}})}:fe}catch{return fe}return fe}))}catch{n(fe=>fe.map(Pe=>{if(Pe.id===A)try{const ke={...JSON.parse(Pe.value||"{}")};return delete ke.generationProgress,{...Pe,value:JSON.stringify(ke)}}catch{return Pe}return Pe}))}finally{v(null)}},[t,r,n,e,a,v,i,y]),N=x.useCallback(async(A,k)=>{const P=e.find(W=>W.id===A);if(!P)return;let M;try{M=JSON.parse(P.value||"{}")}catch{M={}}const H=M.targetLanguage||"en";w(A),a(null);try{const W=await Qk(k,H);n(O=>O.map(U=>U.id===A?{...U,value:JSON.stringify({...M,prompt:W})}:U))}catch(W){a(W.message||"Concept improvement failed.")}finally{w(null)}},[e,n,a,w]);return{states:{isEnhancing:s,isTranslating:c,isModifyingScriptPart:h,isFixingErrors:m,isModifyingScriptPrompts:y,isImprovingScriptConcept:C},handleEnhance:b,handleTranslate:f,handleModifyScriptPart:T,handleModifyAnalyzerFramePart:I,handleFixErrors:E,handleModifyScriptPrompts:R,handleImproveScriptConcept:N,stop:()=>{l(null),d(null),g(null),_(null),v(null),w(null)}}},wA=({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:r,setError:a,executionStopRequested:i})=>{const[s,l]=x.useState(null),[c,d]=x.useState(null),[h,g]=x.useState(null),[m,_]=x.useState(null),y=x.useCallback(async b=>{if(!e.find(E=>E.id===b))return;const T=t.find(E=>E.toNodeId===b),I=T?r(T.fromNodeId,T.fromHandleId):"";if(!I){a("No input text to analyze.");return}l(b),a(null);try{const E=await sA(I);n(R=>R.map(N=>N.id===b?{...N,value:JSON.stringify(E)}:N))}catch(E){a(E.message||"Analysis failed")}finally{l(null)}},[e,t,r,n,a]),v=x.useCallback(async b=>{if(!e.find(E=>E.id===b))return;const T=t.find(E=>E.toNodeId===b),I=T?r(T.fromNodeId,T.fromHandleId):"";if(!I){a("No input text to analyze.");return}d(b),a(null);try{const E=await tA(I);n(R=>R.map(N=>N.id===b?{...N,value:JSON.stringify(E)}:N))}catch(E){a(E.message||"Character analysis failed")}finally{d(null)}},[e,t,r,n,a]),C=x.useCallback(async b=>{i.current=!1;const f=e.find(B=>B.id===b);if(!f)return;let T;try{T=JSON.parse(f.value||"{}")}catch{T={}}const{model:I="gemini-3-pro-preview",targetLanguage:E="ru",framesPerScene:R,minFrames:N,maxFrames:A,hierarchyEnabled:k=!0,mandatoryBgEnabled:P=!0,statePersistenceEnabled:M=!0,livingWorldEnabled:H=!0,extendedAnalysis:W,generateStartEndFrames:O,professionalStoryboard:U=!1,startSceneNumber:z,endSceneNumber:L,autoIndexCharacters:D=!0,batchProcessing:G=!0}=T,q=t.filter(B=>B.toNodeId===b);let ie="",te=[],ye=[];const ue=B=>{const{image:X,imageBase64:F,imageSources:Y,...K}=B;return K};for(const B of q){const X=r(B.fromNodeId,B.fromHandleId);try{const F=JSON.parse(X);if(F.scenes){if(F.summary&&(ie=F.summary),Array.isArray(F.scenes)&&(te=F.scenes.map((Y,K)=>({...Y,sceneNumber:typeof Y.sceneNumber=="number"?Y.sceneNumber:K+1}))),Array.isArray(F.detailedCharacters)){const Y=F.detailedCharacters.map(ue);ye=[...ye,...Y]}}else F.name?ye.push(ue(F)):Array.isArray(F.characters)&&(ye=[...ye,...F.characters.map(ue)])}catch{}}const $=new Map;ye.forEach(B=>{B.name&&$.set(B.name,B)});const ee=Array.from($.values());if(te.length===0){a("No scenes found to analyze. Please connect a Script Generator.");return}const Te=new Map;te.forEach(B=>{typeof B.sceneNumber=="number"&&B.title&&Te.set(B.sceneNumber,B.title)});const le=z&&z>0?z:1,J=L&&L>0?L:999999,ge=te.filter(B=>{const X=B.sceneNumber!==void 0?B.sceneNumber:-1;return X>=le&&X<=J});if(ge.length===0){a(`No scenes found in the selected range (${le}-${J}). Check input scene numbers.`);return}g(b),a(null);let ae=ge.length;const ce=Date.now();n(B=>B.map(X=>{if(X.id===b)try{const F=JSON.parse(X.value||"{}");return{...X,value:JSON.stringify({...F,generationProgress:{current:0,total:ae,totalStartTime:ce,currentItemStartTime:Date.now()}})}}catch{return X}return X}));try{let B=Array.isArray(T.scenes)?[...T.scenes]:[];const X=new Map(B.map(K=>[K.sceneNumber,K])),F=K=>{K.map(Q=>({...Q,title:Te.get(Q.sceneNumber)||Q.title})).forEach(Q=>X.set(Q.sceneNumber,Q));let oe=Array.from(X.values()).sort((Q,j)=>Q.sceneNumber-j.sceneNumber),de=0,Z=oe.map(Q=>({...Q,frames:(Q.frames||[]).map(j=>{de++;let fe=2;if(j.duration!==void 0){if(typeof j.duration=="number")fe=Math.round(j.duration);else if(typeof j.duration=="string"){const Pe=parseFloat(j.duration.replace(/s$/i,""));isNaN(Pe)||(fe=Math.round(Pe))}}return{...j,frameNumber:de,duration:fe}})}));if(D){const Q=ee.map(Pe=>({from:Pe.originalName||Pe.name,to:Pe.alias})),j=Pe=>Pe.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),fe=Pe=>{if(!Pe)return"";let je=Pe;return Q.forEach(({from:ke,to:$e})=>{if(ke&&$e){const ze=j(ke),nt=new RegExp(`\\b${ze}\\b`,"gi");je=je.replace(nt,$e)}}),je};Z=Z.map(Pe=>({...Pe,frames:Pe.frames.map(je=>({...je,description:fe(je.description),imagePrompt:fe(je.imagePrompt),environmentPrompt:fe(je.environmentPrompt),videoPrompt:fe(je.videoPrompt)}))}))}return Z},Y={framesPerScene:R,minFrames:N,maxFrames:A,extendedAnalysis:W,generateStartEndFrames:O,batchProcessing:G,professionalStoryboard:U,hierarchyEnabled:k,mandatoryBgEnabled:P,statePersistenceEnabled:M,livingWorldEnabled:H};if(G){if(i.current)throw new Error("Analysis stopped by user.");const K=await pg(ge,ee,ie,E,Y,I),V=Array.isArray(K)?K.map((de,Z)=>{if(Z<ge.length){const Q=ge[Z];return{...de,sceneNumber:Q.sceneNumber,characters:de.characters||Q.characters||[]}}return de}):[],oe=F(V);n(de=>de.map(Z=>{if(Z.id===b)try{const Q=JSON.parse(Z.value||"{}");return{...Z,value:JSON.stringify({...Q,scenes:oe,generationProgress:{current:ae,total:ae,totalStartTime:ce,currentItemStartTime:Date.now()}})}}catch{return Z}return Z}))}else for(let K=0;K<ge.length;K++){if(i.current)throw new Error("Analysis stopped by user.");const V=ge[K],oe=Date.now();n(j=>j.map(fe=>{if(fe.id===b)try{const Pe=JSON.parse(fe.value||"{}"),je=Pe.generationProgress||{current:K,total:ae,totalStartTime:ce};return{...fe,value:JSON.stringify({...Pe,generationProgress:{...je,current:K,currentItemStartTime:oe}})}}catch{return fe}return fe}));const de=await pg([V],ee,ie,E,Y,I),Z=Array.isArray(de)?de.map(j=>({...j,sceneNumber:V.sceneNumber,characters:j.characters||V.characters||[]})):[],Q=F(Z);n(j=>j.map(fe=>{if(fe.id===b)try{const Pe=JSON.parse(fe.value||"{}");return{...fe,value:JSON.stringify({...Pe,scenes:Q,generationProgress:{current:K+1,total:ae,totalStartTime:ce,currentItemStartTime:Date.now()}})}}catch{return fe}return fe}))}n(K=>K.map(V=>{if(V.id===b)try{const oe=JSON.parse(V.value||"{}"),de=oe.generationProgress;return de?{...V,value:JSON.stringify({...oe,generationProgress:{...de,endTime:Date.now()}})}:V}catch{return V}return V}))}catch(B){B.message!=="Analysis stopped by user."&&a(B.message||"Script analysis failed."),n(X=>X.map(F=>{if(F.id===b)try{const K={...JSON.parse(F.value||"{}")};return delete K.generationProgress,{...F,value:JSON.stringify(K)}}catch{return F}return F}))}finally{g(null)}},[e,t,r,n,a,i]),w=x.useCallback(async b=>{var A,k;const f=e.find(P=>P.id===b);if(!f)return;let T;try{T=JSON.parse(f.value||"{}")}catch{a("Invalid node data.");return}const I=T.activeChannelId,E=((A=T.channels)==null?void 0:A.find(P=>P.id===I))||((k=T.channels)==null?void 0:k[0]);if(!E){a("No active channel found to analyze.");return}const R={channels:[E].map(P=>({name:P.name,description:P.description,stats:P.stats,goal:P.goal,isMonetized:P.isMonetized,currentSubscribers:P.currentSubscribers,videos:P.videos.map(M=>({uploadDate:M.uploadDate,title:M.title,views:M.views,likes:M.likes,isShort:M.isShort}))}))||[],goal:E.goal,isMonetized:E.isMonetized,currentSubscribers:E.currentSubscribers,contextPrompt:T.contextPrompt,currentDate:new Date().toLocaleString()},N=T.targetLanguage||"ru";if(R.channels.length===0){a("No channel data available to analyze.");return}a(null),_(b);try{const P=await hA(R,N);n(M=>M.map(H=>{if(H.id===b){const W=JSON.parse(H.value||"{}");return{...H,value:JSON.stringify({...W,aiAdvice:P.advice,aiSuggestedGoal:P.suggestedGoal})}}return H}))}catch(P){a(P.message||"An unknown error occurred during YouTube stats analysis.")}finally{_(null)}},[e,n,a,_]);return{states:{isAnalyzing:s,isAnalyzingCharacter:c,isAnalyzingScript:h,isAnalyzingYouTubeStats:m},handleAnalyzeScript:C,handleAnalyzeYouTubeStats:w,handleAnalyzePrompt:y,handleAnalyzeCharacter:v,stop:()=>{l(null),d(null),g(null),_(null)}}},yg={general:"            ' '.         ,   .    ,    ,     .      ,      ,   .    ,     Markdown.",script:"         .       ,   .       ( ,  ),   ,      .    ,  ,     .       .",prompt:"    -    (Stable Diffusion, Midjourney, DALL-E).       ,    .  ,    (volumetric lighting, cinematic lighting),  (rule of thirds, wide shot),  (cyberpunk, watercolor, oil painting),     (4k, 8k, detailed).     ,      .",youtube:"     YouTube,      .     SEO   (, , ),   (CTR, retention rate)  .        ,   ,   ( )     ,   .    , -    ."},_A=({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:r,setError:a})=>{const[i,s]=x.useState(null),[l,c]=x.useState(null),d=x.useCallback(async g=>{const m=e.find(f=>f.id===g);if(!m)return;let _;try{_=JSON.parse(m.value||"{}")}catch{a("Invalid chat node data.");return}const y=Array.isArray(_.messages)?_.messages:[],{currentInput:v,mode:C="general"}=_;if(!v||v.trim()==="")return;const w={role:"user",content:v},b=[...y,w];n(f=>f.map(T=>T.id===g?{...T,value:JSON.stringify({messages:b,currentInput:"",mode:C})}:T)),a(null),s(g);try{const f=y.map(k=>({role:k.role,parts:[{text:k.content}]})),T=yg[C]||yg.general,N={role:"model",content:(await Yt().chats.create({model:"gemini-2.5-flash",history:f,config:{systemInstruction:T}}).sendMessage({message:v})).text??""},A=[...b,N];n(k=>k.map(P=>P.id===g?{...P,value:JSON.stringify({messages:A,currentInput:"",mode:C})}:P))}catch(f){a(f.message||"An unknown error occurred during chat."),n(T=>T.map(I=>I.id===g?{...I,value:JSON.stringify({messages:y,currentInput:v,mode:C})}:I))}finally{s(null)}},[e,n,a,s]),h=x.useCallback(async g=>{const m=e.find(w=>w.id===g);if(!m)return;let _;m.type===S.SCRIPT_GENERATOR?_=t.find(w=>w.toNodeId===g&&(w.toHandleId==="prompt"||w.toHandleId===void 0)):_=t.find(w=>w.toNodeId===g);let y="";_&&(y=r(_.fromNodeId,_.fromHandleId));let v;try{v=JSON.parse(m.value||"{}")}catch{v={}}const C=v.mode||"simple";if(m.type===S.SPEECH_SYNTHESIZER){if(C==="scene"){let w=[];try{const b=JSON.parse(y);Array.isArray(b)&&(w=b)}catch{}if(JSON.stringify(v.inputText)===JSON.stringify(w))return}else if(v.inputText===y)return}else if(m.type===S.DATA_READER){if(m.value===y)return;try{const w=JSON.parse(y),b=JSON.stringify(w,null,2);if(m.value===b)return}catch{}}else if(m.type===S.SCRIPT_GENERATOR||m.type===S.CHARACTER_GENERATOR||m.type===S.IDEA_GENERATOR||m.type===S.NARRATOR_TEXT_GENERATOR){const w=m.type===S.IDEA_GENERATOR?"theme":"prompt";if(v[w]===y)return}a(null),c(g);try{if(await new Promise(w=>setTimeout(w,30)),m.type===S.SPEECH_SYNTHESIZER)n(w=>w.map(b=>{if(b.id===g){let f;try{f=JSON.parse(b.value||"{}")}catch{f={}}const T=f.mode||"simple";let I;if(T==="scene"){let E=[];try{const R=JSON.parse(y);Array.isArray(R)&&(E=R)}catch{}I={...f,inputText:E,audioFiles:[]}}else I={...f,inputText:y};return{...b,value:JSON.stringify(I)}}return b}));else if(m.type===S.SCRIPT_GENERATOR||m.type===S.CHARACTER_GENERATOR||m.type===S.IDEA_GENERATOR||m.type===S.NARRATOR_TEXT_GENERATOR)n(w=>w.map(b=>{if(b.id===g){let f;try{f=JSON.parse(b.value||"{}")}catch{f={}}const T=b.type===S.IDEA_GENERATOR?"theme":"prompt";return{...b,value:JSON.stringify({...f,[T]:y})}}return b}));else if(!(m.type===S.SCRIPT_ANALYZER||m.type===S.SCRIPT_PROMPT_MODIFIER)){let w=y;try{const b=JSON.parse(y);w=JSON.stringify(b,null,2)}catch{}n(b=>b.map(f=>f.id===g?{...f,value:w}:f))}}catch(w){a(w.message||"An unknown error occurred while reading data.")}finally{c(null)}},[t,r,n,e,a,c]);return{states:{isChatting:i,isReadingData:l},handleSendMessage:d,handleReadData:h,stop:()=>{s(null),c(null)}}},CA=({nodes:e,connections:t,setNodes:n,executionStopRequested:r,setError:a,generationHandlers:i,analysisHandlers:s,modificationHandlers:l})=>{const[c,d]=x.useState(null),[h,g]=x.useState(!1),[m,_]=x.useState(new Set),y=x.useCallback(f=>new Promise(T=>{n(I=>{const E=I.find(z=>z.id===f);if(!E||E.type!==S.SCRIPT_ANALYZER)return T(),I;let R;try{R=JSON.parse(E.value||"{}")}catch{return T(),I}const{characters:N,scenes:A}=R;if(!N||N.length===0||!A)return T(),I;const k=N.map(z=>({from:z.originalName||z.name,to:z.index||z.alias})),P=z=>z.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),M=z=>{if(!z)return"";let L=z;return k.forEach(({from:D,to:G})=>{if(D&&G){const q=P(D),ie=new RegExp(`\\b${q}\\b`,"gi");L=L.replace(ie,G)}}),L},H=A.map(z=>({...z,frames:z.frames.map(L=>({...L,description:M(L.description),imagePrompt:M(L.imagePrompt),environmentPrompt:M(L.environmentPrompt),videoPrompt:M(L.videoPrompt)}))})),W=N.map(z=>({...z,imagePrompt:M(z.imagePrompt)})),O={...R,characters:W,scenes:H},U=I.map(z=>z.id===f?{...z,value:JSON.stringify(O)}:z);return T(),U})}),[n]),v=x.useCallback(f=>new Promise(T=>{n(I=>{const E=I.find(O=>O.id===f);if(!E||E.type!==S.CHARACTER_GENERATOR)return T(),I;let R;try{R=JSON.parse(E.value||"{}")}catch{return T(),I}const{characters:N}=R;if(!N||N.length===0)return T(),I;const A=N.map(O=>({from:O.originalName,to:O.index||O.alias})),k=O=>O.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),P=O=>{let U=O;return A.forEach(({from:z,to:L})=>{if(z&&L&&z!==L){const D=k(z),G=new RegExp(`\\b${D}\\b`,"gi");U=U.replace(G,L)}}),U},M=N.map(O=>({...O,fullDescription:P(O.fullDescription),prompt:P(O.prompt)})),H={...R,characters:M},W=I.map(O=>O.id===f?{...O,value:JSON.stringify(H)}:O);return T(),W})}),[n]),C=x.useCallback(async f=>{a(null),g(!0),r.current=!1;const T=(I,E)=>{let R=t.find(A=>A.toNodeId===I);if(!R)return;let N=e.find(A=>A.id===R.fromNodeId);for(;N&&N.type===S.REROUTE_DOT;){if(R=t.find(A=>A.toNodeId===N.id),!R)return;N=e.find(A=>A.id===R.fromNodeId)}return N&&N.type===E?N:void 0};try{d(f);const I=T(f,S.SCRIPT_ANALYZER);if(!I)throw new Error("Could not find a connected Script Analyzer node.");const E=T(I.id,S.SCRIPT_GENERATOR);if(!E)throw new Error("Could not find a connected Script Generator node.");if(d(E.id),await i.handleGenerateScript(E.id),r.current)throw new Error("Chain execution stopped.");if(d(I.id),await s.handleAnalyzeScript(I.id),r.current)throw new Error("Chain execution stopped.");if(await y(I.id),r.current)throw new Error("Chain execution stopped.");if(d(f),await l.handleModifyScriptPrompts(f),r.current)throw new Error("Chain execution stopped.")}catch(I){I.message!=="Chain execution stopped."&&a(I.message||"An unknown error occurred during chain execution.")}finally{g(!1),d(null)}},[e,t,a,g,d,r,i,s,l,y]),w=x.useCallback(async f=>{console.warn("Chain execution is not fully implemented."),g(!0),d(f),r.current=!1,await new Promise(T=>setTimeout(T,1e3)),r.current||(g(!1),d(null))},[g,d,r]),b=x.useCallback(async f=>{console.warn("Process chain forward is not fully implemented.")},[]);return{states:{executingNodeId:c,isExecutingChain:h,stoppingNodes:m},handleExecuteFullChain:C,handleExecuteChain:w,handleProcessChainForward:b,handleApplyAliasesForScriptAnalyzer:y,handleApplyAliasesForCharacterGenerator:v,stop:()=>{g(!1),d(null)}}},SA=(e,t,n)=>{const[r,a]=x.useState(null),i=x.useRef(!1),s=x.useRef(e);s.current=e;const l=x.useCallback(()=>{i.current=!0},[]),c=x.useCallback((C,w,b=new Set)=>{var T,I,E,R,N,A,k,P,M;if(b.has(C))return"";b.add(C);const f=s.current.find(H=>H.id===C);if(!f)return"";if(f.type===S.REROUTE_DOT){const H=t.find(W=>W.toNodeId===C);return H?c(H.fromNodeId,H.fromHandleId,b):""}try{const H=JSON.parse(f.value||"{}");if(f.type===S.TEXT_INPUT||f.type===S.NOTE)return f.value;if(f.type===S.TRANSLATOR)return H.translatedText||"";if(f.type===S.PROMPT_PROCESSOR)return f.value;switch(f.type){case S.PROMPT_ANALYZER:if(w==="environment")return H.environment||"";if(w==="action")return H.action||"";if(w==="style")return H.style||"";if(w!=null&&w.startsWith("character-")){const U=parseInt(w.split("-")[1],10);return((T=H.characters)==null?void 0:T[U])||""}return"";case S.CHARACTER_ANALYZER:return w==="character"?H.character||"":w==="clothing"&&H.clothing||"";case S.CHARACTER_CARD:let W=H;Array.isArray(W)||(W=[W]);const O=U=>{const{image:z,imageBase64:L,imageSources:D,thumbnails:G,selectedRatio:q,alias:ie,...te}=U;return!te.index&&ie&&(te.index=ie),te};if(w==="primary-character"){const U=W.find(z=>z.isOutput)||W[0];return U?JSON.stringify([O(U)]):"[]"}return JSON.stringify(W.map(U=>O(U)));case S.CHARACTER_GENERATOR:if(w!=null&&w.startsWith("character-")){const U=w.replace("character-",""),z=((I=H.characters)==null?void 0:I.find(L=>L.id===U))||((E=H.characters)==null?void 0:E[parseInt(U,10)]);if(z){const{imageBase64:L,image:D,alias:G,...q}=z;return!q.index&&G&&(q.index=G),JSON.stringify(q)}return""}return"";case S.SCRIPT_GENERATOR:if(w==="all-script-parts"||w===void 0){const U={...H},z=t.filter(q=>q.toNodeId===C&&q.toHandleId==="characters"),L=[];z.forEach(q=>{const ie=c(q.fromNodeId,q.fromHandleId,new Set([...b]));try{const te=JSON.parse(ie||"{}");if(te.name){const{image:ye,imageBase64:ue,imageSources:$,alias:ee,...Te}=te;!Te.index&&ee&&(Te.index=ee),L.push(Te)}else if(Array.isArray(te)){const ye=te.map(ue=>{const{image:$,imageBase64:ee,imageSources:Te,thumbnails:le,alias:J,...ge}=ue;return!ge.index&&J&&(ge.index=J),ge});L.push(...ye)}else if(te.characters&&Array.isArray(te.characters)){const ye=te.characters.map(ue=>{const{image:$,imageBase64:ee,imageSources:Te,alias:le,...J}=ue;return!J.index&&le&&(J.index=le),J});L.push(...ye)}}catch{}});const D=new Set((U.detailedCharacters||[]).map(q=>q.name)),G=L.filter(q=>!D.has(q.name));return U.detailedCharacters=[...U.detailedCharacters||[],...G],!U.generatedStyle&&U.visualStyle&&U.visualStyle!=="none"&&(U.generatedStyle=U.customVisualStyle||U.visualStyle),JSON.stringify(U)}if(w==="all-narrator-text"){const z=(H.scenes||[]).map(L=>({sceneNumber:L.sceneNumber,text:L.narratorText})).filter(L=>L.text);return JSON.stringify(z)}if(w==="summary")return H.summary||"";if(w!=null&&w.startsWith("scene-")){const U=parseInt(w.split("-")[1],10);return((N=(R=H.scenes)==null?void 0:R[U])==null?void 0:N.description)||""}if(w!=null&&w.startsWith("character-")){const U=w.replace("character-",""),z=(A=H.detailedCharacters)==null?void 0:A.find(L=>L.id===U);if(z)return JSON.stringify(z)}return"";case S.SCRIPT_ANALYZER:if(w==="all-script-analyzer-data"||w===void 0){const U={...H},z=t.find(L=>L.toNodeId===C);if(z){const L=c(z.fromNodeId,z.fromHandleId,new Set([...b]));try{const D=JSON.parse(L);if(D.generatedStyle&&(U.generatedStyle=D.generatedStyle),!U.visualStyle&&(D.generatedStyle||D.visualStyle)&&(U.visualStyle=D.generatedStyle||D.visualStyle),D.detailedCharacters&&Array.isArray(D.detailedCharacters)?(U.detailedCharacters=D.detailedCharacters,U.characters=D.detailedCharacters):D.characters&&(U.detailedCharacters=D.characters,U.characters=D.characters),D.scenes&&Array.isArray(D.scenes)&&U.scenes&&Array.isArray(U.scenes)){const G=new Map;D.scenes.forEach(q=>{typeof q.sceneNumber=="number"&&G.set(q.sceneNumber,q)}),U.scenes=U.scenes.map(q=>{const ie=G.get(q.sceneNumber);return ie?{...q,title:q.title||ie.title,description:q.description||ie.description,narratorText:q.narratorText||ie.narratorText}:q})}}catch{}}return JSON.stringify(U)}if(w==="all-narrator-data"){const z=(H.scenes||[]).map(L=>({sceneNumber:L.sceneNumber,text:L.narratorText})).filter(L=>L.text);return JSON.stringify(z)}if(w!=null&&w.startsWith("character-")){const U=w.replace("character-",""),z=(k=H.characters)==null?void 0:k.find(L=>L.id===U);if(z)return JSON.stringify(z)}if(w!=null&&w.startsWith("frame-")){const U=parseInt(w.split("-")[1],10),L=(H.scenes||[]).flatMap(D=>D.frames||[]).find(D=>D.frameNumber===U);return(L==null?void 0:L.imagePrompt)||""}return"";case S.SCRIPT_PROMPT_MODIFIER:if(w!=null&&w.startsWith("final-prompt-")){const U=parseInt(w.substring(13),10),z=(P=H.finalPrompts)==null?void 0:P.find(L=>L.frameNumber===U);if(z)return z.prompt||""}return"";case S.YOUTUBE_ANALYTICS:return H.aiAdvice||"";case S.NARRATOR_TEXT_GENERATOR:return((M=H.generatedTexts)==null?void 0:M[w||""])||"";case S.AUDIO_TRANSCRIBER:return H.transcription||"";case S.IDEA_GENERATOR:return H.generatedIdea||"";case S.YOUTUBE_TITLE_GENERATOR:return w&&H.generatedTitleOutputs&&H.generatedTitleOutputs[w]?JSON.stringify(H.generatedTitleOutputs[w]):JSON.stringify(H);case S.MUSIC_IDEA_GENERATOR:return JSON.stringify(H);default:return f.value||""}}catch{return f.value||""}},[t]),d=vA({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:c,setError:a,executionStopRequested:i}),h=wA({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:c,setError:a,executionStopRequested:i}),g=bA({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:c,setError:a,executionStopRequested:i}),m=_A({nodes:e,connections:t,setNodes:n,getUpstreamTextValue:c,setError:a}),_=CA({nodes:e,connections:t,setNodes:n,executionStopRequested:i,setError:a,generationHandlers:{handleGenerateScript:d.handleGenerateScript},analysisHandlers:{handleAnalyzeScript:h.handleAnalyzeScript},modificationHandlers:{handleModifyScriptPrompts:g.handleModifyScriptPrompts}}),y={...d.states,...h.states,...g.states,...m.states,..._.states},v=x.useCallback(()=>{l(),d.stop(),h.stop(),g.stop(),m.stop(),_.stop()},[l,d,h,g,m,_]);return{...d,...h,...g,...m,..._,stopGeneration:v,error:r,setError:a,getUpstreamTextValue:c,...y}},TA="ScriptModifierDB",wl="autosave",EA="appState",NA=()=>new Promise((e,t)=>{const n=indexedDB.open(TA,1);n.onupgradeneeded=r=>{const a=r.target.result;a.objectStoreNames.contains(wl)||a.createObjectStore(wl)},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)}),kA=async e=>{const t=await NA();return new Promise((n,r)=>{const s=t.transaction(wl,"readwrite").objectStore(wl).put(e,EA);s.onsuccess=()=>n(),s.onerror=()=>r(s.error)})},AA=(e,t)=>{const n=x.useRef(!0),r=x.useRef(e);x.useEffect(()=>{r.current=e},[e]),x.useEffect(()=>{if(n.current){n.current=!1;return}const a=setTimeout(()=>{const i={tabs:e,activeTabIndex:t,timestamp:Date.now()};kA(i).catch(s=>{console.warn("IndexedDB save failed, attempting localStorage fallback",s);try{localStorage.setItem("script-modifier-autosave",JSON.stringify(i))}catch(l){console.error("Failed to auto-save state:",l)}})},1e3);return()=>clearTimeout(a)},[e,t]),x.useEffect(()=>{const a=i=>{if(window.isReloading)return;if(r.current.some(l=>l.nodes.length>0))return i.preventDefault(),i.returnValue="",""};return window.addEventListener("beforeunload",a),()=>window.removeEventListener("beforeunload",a)},[])},IA=40,PA=(e,t,n)=>{const[r,a]=x.useState({width:window.innerWidth,height:window.innerHeight});x.useLayoutEffect(()=>{const l=()=>{a({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",l),l(),()=>window.removeEventListener("resize",l)},[]);const{visibleNodes:i,visibleConnections:s}=x.useMemo(()=>{const c=(-1e3-n.translate.x)/n.scale,d=(-1e3-n.translate.y)/n.scale,h=(r.width+1e3-n.translate.x)/n.scale,g=(r.height+1e3-n.translate.y)/n.scale,m=new Set,_=[];for(const v of e){const C=v.width,w=v.isCollapsed?IA:v.height,b=v.position.x+C,f=v.position.y+w;v.position.x<h&&b>c&&v.position.y<g&&f>d&&(_.push(v),m.add(v.id))}const y=t.filter(v=>m.has(v.fromNodeId)||m.has(v.toNodeId));return{visibleNodes:_,visibleConnections:y}},[e,t,n,r]);return{visibleNodes:i,visibleConnections:s}},Mr={nodes:[{type:S.SCRIPT_GENERATOR,title:" ",value:'{"prompt":"","targetLanguage":"en","characterType":"simple","useExistingCharacters":false,"narratorEnabled":false,"narratorMode":"normal","summary":"","detailedCharacters":[],"scenes":[],"isAdvancedMode":false,"numberOfScenes":null,"isDetailedPlot":false,"genre":"general","genre2":"general","noCharacters":false,"model":"gemini-3-pro-preview","includeSubscribeScene":false,"visualStyle":"none","customVisualStyle":"","generatedStyle":"","generateMainChars":true,"createSecondaryChars":true,"createKeyItems":true,"safeGeneration":false,"thinkingEnabled":false,"scenelessMode":false,"simpleActions":false,"commercialSafe":false,"smartConceptEnabled":false,"atmosphericEntryEnabled":false,"generationProgress":null,"uiState":{"isSettingsCollapsed":true,"isSummaryCollapsed":true,"isStyleCollapsed":true,"isCharactersSectionCollapsed":true,"isScenesSectionCollapsed":true,"collapsedCharacters":[],"collapsedScenes":[]}}',width:680,height:800,id:"node-13-1763665880409",position:{x:180,y:180}},{type:S.SCRIPT_ANALYZER,title:" ",value:'{"characters":[],"scenes":[],"targetLanguage":"en","model":"gemini-3-pro-preview","startSceneNumber":null,"endSceneNumber":null,"framesPerScene":null,"minFrames":null,"maxFrames":null,"hierarchyEnabled":true,"mandatoryBgEnabled":true,"statePersistenceEnabled":true,"livingWorldEnabled":false,"extendedAnalysis":false,"microActionBreakdown":false,"batchProcessing":true,"professionalStoryboard":true,"cinematographyEnabled":true,"safeGeneration":false,"thinkingEnabled":false,"shotFilter":"all","anthroEnabled":false,"subscribeEnhancement":false,"anatomicalStrictness":true,"propConsistency":true,"visualStyle":"","autoIndexCharacters":true,"uiState":{"isSettingsCollapsed":true,"isCharStyleCollapsed":true},"settingsPaneHeight":200,"characterPaneHeight":160,"generationProgress":null}',width:680,height:800,id:"node-15-1763665895770",position:{x:940,y:180}},{type:S.SCRIPT_PROMPT_MODIFIER,title:" ",value:'{"finalPrompts":[],"videoPrompts":[],"sceneContexts":{},"usedCharacters":[],"targetLanguage":"en","startFrameNumber":null,"endFrameNumber":null,"startSceneNumber":null,"endSceneNumber":null,"generationProgress":null,"styleOverride":"","characterPaneHeight":162,"model":"gemini-3-pro-preview","disabledInstructionIds":["break_paragraphs","rule_saturation","pm_anthro"],"charDescMode":"none","safeGeneration":false,"thinkingEnabled":false,"propEnhancementEnabled":true,"uiState":{"isSettingsCollapsed":true,"isCharStyleCollapsed":false},"settingsPaneHeight":200}',width:680,height:800,id:"node-16-1763665908511",position:{x:1700,y:180}},{type:S.CHARACTER_GENERATOR,title:" ",value:'{"prompt":"","numberOfCharacters":1,"targetLanguage":"en","characterType":"simple","style":"simple","customStyle":"","characters":[]}',width:680,height:800,id:"node-17-1763665920176",position:{x:180,y:1340}},{type:S.YOUTUBE_TITLE_GENERATOR,title:"  YouTube",value:'{"mode":"title","idea":"","targetLanguages":{"ru":true,"en":false},"generatedTitleOutputs":{},"generatedChannelOutputs":{}}',width:680,height:800,id:"node-18-1763665947291",position:{x:3220,y:1340}},{type:S.NARRATOR_TEXT_GENERATOR,title:"  ",value:'{"prompt":"","role":"narrator","generatedTexts":{"ru":"","en":""},"targetLanguages":{"ru":true,"en":true},"generateSSML":false}',width:680,height:800,id:"node-19-1763665953580",position:{x:940,y:1340}},{type:S.SPEECH_SYNTHESIZER,title:" ",value:'{"inputText":"","voice":"Zephyr","audioFiles":[],"startSceneNumber":null,"endSceneNumber":null,"intonation":"standard","mode":"simple","isMultiSpeaker":false,"speaker1Name":"Man","speaker1Voice":"Zephyr","speaker2Name":"Woman","speaker2Voice":"Kore"}',width:680,height:800,id:"node-21-1763665961743",position:{x:1700,y:1340}},{type:S.MUSIC_IDEA_GENERATOR,title:"  ",value:'{"generateLyrics":true,"idea":"","targetLanguages":{"ru":true,"en":false},"generatedLyrics":{},"generatedMusicPrompts":{},"generatedTitles":{}}',width:680,height:800,id:"node-31-1764450930993",position:{x:2460,y:1340}}],connections:[{fromNodeId:"node-13-1763665880409",toNodeId:"node-15-1763665895770",fromHandleId:"all-script-parts",fromPointOffset:{x:681.2500038165192,y:419.99998694653596},id:"conn-1763665902004-t74xvfcuv"},{fromNodeId:"node-15-1763665895770",toNodeId:"node-16-1763665908511",fromHandleId:"all-script-analyzer-data",toHandleId:"all-script-analyzer-data",fromPointOffset:{x:681.2499748553378,y:419.99998694653596},id:"conn-1763665935004-en9p0i2wu"},{fromNodeId:"node-19-1763665953580",toNodeId:"node-21-1763665961743",fromHandleId:"ru",fromPointOffset:{x:681.249946470853,y:400.99999128512286},id:"conn-1763665983386-jjaugycj8"}],groups:[],viewTransform:{scale:1,translate:{x:-10.476763626649245,y:-116.12297952975814}},nodeIdCounter:32},My=x.createContext(null),RA=({children:e})=>{var fp;const{t}=Ht(),[n,r]=x.useState(!1),[a,i]=x.useState("orthogonal"),[s,l]=x.useState(()=>{try{const Ne=localStorage.getItem("context-menu-slots");if(Ne)return JSON.parse(Ne)}catch{}return Array(8).fill(null)}),c=x.useRef(new Map),[d,h]=x.useState(null),g=x.useCallback((Ne,Ve,ot)=>{const ut=`${Ne}-${Ve}`;ot?c.current.set(ut,ot):c.current.delete(ut)},[]),m=x.useCallback((Ne,Ve)=>{const ot=`${Ne}-${Ve}`;return c.current.get(ot)||null},[]),_=x.useCallback(async Ne=>{try{const ot=await(await fetch(`data:image/png;base64,${Ne}`)).blob();await navigator.clipboard.write([new ClipboardItem({[ot.type]:ot})])}catch(Ve){console.error("Failed to copy image",Ve)}},[]),y=x.useCallback((Ne,Ve)=>{const ot=document.createElement("a");ot.href=`data:image/png;base64,${Ne}`,ot.download=Ve,document.body.appendChild(ot),ot.click(),document.body.removeChild(ot)},[]),v=x.useCallback((Ne,Ve)=>{l(ot=>{const ut=[...ot];return Ne>=0&&Ne<8&&(ut[Ne]=Ve),localStorage.setItem("context-menu-slots",JSON.stringify(ut)),ut})},[]),C=x.useCallback((Ne,Ve)=>({id:`tab-${Date.now()}`,name:Ne,nodes:(Ve==null?void 0:Ve.nodes)??[],connections:(Ve==null?void 0:Ve.connections)??[],groups:(Ve==null?void 0:Ve.groups)??[],viewTransform:(Ve==null?void 0:Ve.viewTransform)??{scale:1,translate:{x:0,y:0}},nodeIdCounter:(Ve==null?void 0:Ve.nodeIdCounter)??1,...Ve}),[]),w={id:`tab-${Date.now()}`,name:"Canvas 1",...Mr},[b,f]=x.useState([C("Canvas 1",w)]),[T,I]=x.useState(0),E=x.useRef(w.id),R=Ne=>{Ne<0||Ne>=b.length||I(Ne)},N=()=>{const Ne=C(`Canvas ${b.length+1}`);f(Ve=>[...Ve,Ne]),I(b.length)},A=Ne=>{if(b.length<=1)return;b[Ne],b[T];let Ve=T;Ne<T?Ve=T-1:Ne===T&&(Ve=Ne>0?Ne-1:0),f(ot=>ot.filter((ut,zt)=>zt!==Ne)),I(Ve)},k=(Ne,Ve)=>{f(ot=>ot.map((ut,zt)=>zt===Ne?{...ut,name:Ve}:ut))},{nodes:P,setNodes:M,nodeIdCounter:H,handleValueChange:W,handleAddNode:O,handleDeleteNode:U,handleCopyNodeValue:z,handlePasteNodeValue:L,handleDuplicateNode:D,handleDuplicateNodeEmpty:G,handleToggleNodeOutputVisibility:q}=Ew(Mr.nodes,Mr.nodeIdCounter),ie=D,{connections:te,setConnections:ye,addConnection:ue,removeConnectionsByNodeId:$,removeConnectionById:ee}=Nw(Mr.connections),{viewTransform:Te,setViewTransform:le,isPanning:J,pointerPosition:ge,clientPointerPosition:ae,handleWheel:ce,startPanning:B,pan:X,updatePointerPosition:F,stopPanning:Y,setZoom:K,handleCanvasTouchStart:V,handleCanvasTouchMove:oe,handleCanvasTouchEnd:de}=kw(Mr.viewTransform),{groups:Z,setGroups:Q,addGroup:j,removeGroup:fe}=Iw(Mr.groups),Pe=x.useCallback(Ne=>{M(Ve=>{const ot=Ve.map(ut=>ut.id===Ne?{...ut,isCollapsed:!ut.isCollapsed}:ut);return Q(ut=>ut.map(zt=>{if(!zt.nodeIds.includes(Ne))return zt;const ao=ot.filter(pn=>zt.nodeIds.includes(pn.id));if(ao.length===0)return zt;const Fn=30,io=70;let zo=1/0,Mo=1/0,ar=-1/0,bo=-1/0;return ao.forEach(pn=>{zo=Math.min(zo,pn.position.x),Mo=Math.min(Mo,pn.position.y),ar=Math.max(ar,pn.position.x+pn.width);const Qa=pn.isCollapsed?40:pn.height;bo=Math.max(bo,pn.position.y+Qa)}),{...zt,position:{x:zo-Fn,y:Mo-io},width:ar-zo+Fn*2,height:bo-Mo+io+Fn}})),ot})},[M,Q]);x.useEffect(()=>{const Ne=b[T];Ne&&Ne.id===E.current&&f(Ve=>Ve.map((ot,ut)=>ut===T?{...ot,nodes:P,connections:te,groups:Z,viewTransform:Te,nodeIdCounter:H.current}:ot))},[P,te,Z,Te,T]),x.useEffect(()=>{const Ne=b[T];Ne&&Ne.id!==E.current&&(M(Ne.nodes),ye(Ne.connections),Q(Ne.groups||[]),le(Ne.viewTransform),H.current=Ne.nodeIdCounter,E.current=Ne.id)},[T,b]),AA(b,T);const je=x.useRef(ae);x.useEffect(()=>{je.current=ae},[ae]);const{showDialog:ke,requestPermission:$e,declinePermission:ze}=jw("clipboard-read"),{isQuickSearchOpen:nt,isQuickAddOpen:at,quickAddPosition:xe,openQuickSearchMenu:he,openQuickAddMenu:Ge,handleCloseAddNodeMenus:me,isCatalogOpen:Oe,handleToggleCatalog:De,handleCloseCatalog:Ce,isRadialMenuOpen:Qe,radialMenuPosition:pe,openRadialMenu:Se,isContextMenuOpen:Ee,contextMenuPosition:Fe,openContextMenu:be,closeContextMenu:_e,connectionMenu:Ue,setConnectionMenu:We,isContextMenuPinned:gt,toggleContextMenuPin:Et,isQuickAddPinned:It,toggleQuickAddPin:Mt}=Rw(),xt=SA(P,te,M),{currentCatalogItems:Ft,catalogPath:cn,navigateCatalogBack:Bt,navigateCatalogToFolder:en,createCatalogItem:ve,saveGroupToCatalog:Be,saveGenericItemToCatalog:Je,renameCatalogItem:it,deleteCatalogItem:ct,saveCatalogItemToDisk:jt,catalogFileInputRef:Nn,handleCatalogFileChange:Kt,triggerLoadFromFile:re,moveCatalogItem:Le,catalogItems:Re,activeCategory:Ke,setActiveCategory:dt,importCatalog:rt}=Mw(t),{libraryItems:St,currentLibraryItems:Pt,currentPath:Gt,navigateBack:se,navigateToFolder:Me,createLibraryItem:Ae,updateLibraryItem:et,deleteLibraryItem:pt,saveLibraryItemToDisk:Lt,libraryFileInputRef:sn,handleLibraryFileChange:Zt,triggerLoadLibraryFromFile:On,moveLibraryItem:xn,importLibrary:Cn}=Lw(t),[xo,vo]=x.useState(0),Ir=x.useCallback(()=>vo(Ne=>Ne+1),[]),[rr,$a]=x.useState(null),[Wa,Ya]=x.useState(null),st=x.useRef(null),{renameInfo:tt,setRenameInfo:Dt,promptEditInfo:un,setPromptEditInfo:vt,confirmInfo:Po,setConfirmInfo:Pr,isErrorCopied:qa,handleCopyError:ea,handleRenameGroup:Ka,handleRenameCatalogItem:Yl,confirmRename:ql,confirmPromptEdit:Kl,handleDeleteCatalogItem:Jl,handleDeleteLibraryItem:Xl,handleClearCanvas:Zl,toasts:Ql,addToast:Zn,removeToast:ec}=Dw({t,setGroups:Q,renameCatalogItem:it,updateLibraryItem:et,libraryItems:St,deleteLibraryItem:pt,setNodes:M,setConnections:ye,nodeIdCounter:H,geminiContext:xt,currentCatalogItems:Ft,deleteCatalogItem:ct,saveDataToCatalog:(Ne,Ve,ot)=>{var ut;return(ut=st.current)==null?void 0:ut.call(st,Ne,Ve,ot)}}),Ja=x.useCallback((Ne,Ve="info")=>Zn(Ne,Ve),[Zn]),Xa=x.useCallback(()=>{M(Ne=>Ne.map(Ve=>Ve.id==="node-24-1763746608198"?{...Ve,title:t("app.title")}:{...Ve,title:t(`node.title.${Ve.type.toLowerCase()}`)}))},[t,M]),tc=x.useCallback((Ne=!1)=>{const Ve=()=>{const ot=Mr;M(ot.nodes),ye(ot.connections),Q(ot.groups||[]),le(ot.viewTransform),H.current=ot.nodeIdCounter,f(ut=>ut.map((zt,ao)=>ao===T?{...zt,...ot}:zt)),setTimeout(Xa,0),Ne||Zn(t("toast.resetComplete"),"success")};Ne?Ve():Pr({title:t("dialog.reset.title"),message:t("dialog.reset.message"),onConfirm:Ve})},[t,M,ye,Q,le,H,Zn,Xa,T]),ht=x.useCallback(()=>{M([]),ye([]),Q([]),H.current=0,f(Ne=>Ne.map((Ve,ot)=>ot===T?{...Ve,nodes:[],connections:[],groups:[],nodeIdCounter:0}:Ve))},[M,ye,Q,T]),gn=x.useCallback(()=>{const Ne={nodes:[],connections:[],groups:[],viewTransform:{scale:1,translate:{x:0,y:0}},nodeIdCounter:1},Ve=C("Canvas 1",Ne);M([]),ye([]),Q([]),le(Ne.viewTransform),H.current=1,f([Ve]),I(0),E.current=Ve.id},[C]),tn=x.useCallback((Ne,Ve)=>{const ot=P.find(ut=>ut.id===Ne.toNodeId);if(ot&&ot.type===S.REROUTE_DOT){const ut=Ua(Ve,Ne.fromHandleId);W(ot.id,JSON.stringify({type:ut}))}ue(Ne),ot&&(ot.type===S.SPEECH_SYNTHESIZER||ot.type===S.DATA_READER)&&setTimeout(()=>xt.handleReadData(ot.id),100)},[P,ue,W,xt]),Ro=x.useCallback(Ne=>{Q(Ve=>{const ot=Ve.find(zt=>zt.nodeIds.includes(Ne));if(!ot)return Ve;const ut=ot.nodeIds.filter(zt=>zt!==Ne);if(ut.length===0)return Ve.filter(zt=>zt.id!==ot.id);{const zt=P.filter(io=>ut.includes(io.id)),Fn=((io,zo)=>{if(zo.length===0)return io;const Mo=30,ar=70;let bo=1/0,pn=1/0,Qa=-1/0,oc=-1/0;return zo.forEach(Rr=>{bo=Math.min(bo,Rr.position.x),pn=Math.min(pn,Rr.position.y),Qa=Math.max(Qa,Rr.position.x+Rr.width);const Ox=Rr.isCollapsed?40:Rr.height;oc=Math.max(oc,Rr.position.y+Ox)}),{...io,position:{x:bo-Mo,y:pn-ar},width:Qa-bo+Mo*2,height:oc-pn+ar+Mo}})({...ot,nodeIds:ut},zt);return Ve.map(io=>io.id===Fn.id?Fn:io)}})},[P,Q]),Za=x.useCallback((Ne,Ve)=>{We({isOpen:!0,position:Ve,sourceNodeId:Ne.fromNodeId,sourceHandleId:Ne.fromHandleId,fromType:Ne.fromType})},[We]),{activeTool:ta,effectiveTool:Qu,setActiveTool:ep,connectingInfo:Gy,connectionTarget:Uy,hoveredNodeId:Hy,setHoveredNodeId:By,selectedNodeIds:Zi,setSelectedNodeIds:nc,deselectAllNodes:Vy,handleNodeMouseDown:$y,handleGroupMouseDown:Wy,handleNodeResizeMouseDown:Yy,handleStartConnection:qy,handleNodeClick:Ky,hoveredGroupIdForDrop:Jy,handleCanvasMouseDown:tp,selectionRect:Xy,draggingInfo:np,dollyZoomingInfo:op,handleNodeTouchStart:Zy,handleGroupTouchStart:Qy,handleNodeResizeTouchStart:ex,handleStartConnectionTouchStart:tx,isAltDown:rp,extractionTarget:ap}=Pw({nodes:P,setNodes:M,groups:Z,setGroups:Q,addConnection:tn,connections:te,setConnections:ye,viewTransform:Te,updatePointerPosition:F,pan:X,isPanning:J,startPanning:B,stopPanning:Y,isSnapToGrid:n,onAddNode:O,removeConnectionsByNodeId:$,setZoom:K,triggerClearSelections:Ir,t,clientPointerPosition:ae,clientPointerPositionRef:je,isQuickAddOpen:at,handleCloseAddNodeMenus:me,handleExtractNodeFromGroup:Ro,openRadialMenu:Se,onConnectionReleased:Za}),{onAddNode:Qi,handleAddNodeFromToolbar:nx,deleteNodeAndConnections:ip,handleSplitConnection:ox,handleGroupSelection:sp,handleRemoveGroup:rx,handleSaveGroupToCatalog:ax,handleSaveGroupToDisk:ix,handleCopyGroup:sx,handleDuplicateGroup:lx,handleAddGroupFromCatalog:cx,handleApplyAliases:dx,handleDetachCharacter:ux,addCharacterCardFromFile:lp,addImagePreviewNodeFromFile:cp,handlePasteFromClipboard:dp,handleAddGroupFromTemplate:px,handleDuplicateNode:up,handleDuplicateNodeEmpty:pp,saveDataToCatalog:es,handleDownloadChat:hx}=yA({nodes:P,connections:te,groups:Z,addNodeFromHook:O,t,clientPointerPosition:ae,clientPointerPositionRef:je,viewTransform:Te,setCreationLine:Ya,setLastAddedNodeId:$a,handleDeleteNode:U,removeConnectionsByNodeId:$,addConnection:tn,handleValueChange:W,nodeIdCounter:H,setNodes:M,setConnections:ye,addGroup:j,selectedNodeIds:Zi,setSelectedNodeIds:nc,removeGroup:fe,saveGroupToCatalog:Be,catalogItems:Re,currentCatalogItems:Ft,handleCloseCatalog:Ce,geminiContext:xt,addToast:Ja,setGroups:Q,handleDuplicateNode:ie,handleDuplicateNodeEmpty:G,saveGenericItemToCatalog:Je}),mx=x.useCallback(Ne=>{if(!Ue)return;const Ve={x:(Ue.position.x-Te.translate.x)/Te.scale,y:(Ue.position.y-Te.translate.y)/Te.scale},ot={x:Ve.x-20,y:Ve.y-20};let ut;Ne===S.REROUTE_DOT&&Ue.fromType&&(ut=JSON.stringify({type:Ue.fromType}));const zt=Qi(Ne,ot,ut),ao=P.find(Fn=>Fn.id===Ue.sourceNodeId);if(ao){let Fn;Ne===S.SCRIPT_GENERATOR?Fn="prompt":Ne===S.SCRIPT_PROMPT_MODIFIER?Fn="all-script-analyzer-data":Ne===S.SCRIPT_ANALYZER&&(Fn=void 0),tn({fromNodeId:Ue.sourceNodeId,fromHandleId:Ue.sourceHandleId,toNodeId:zt,toHandleId:Fn},ao)}We(null)},[Ue,Te,Qi,P,tn,We]);x.useEffect(()=>{st.current=es},[es]);const hp=Ne=>rp?Ro(Ne):Pe(Ne),mp=x.useCallback(()=>{try{const Ne=new Date,Ve=Ne.getFullYear(),ot=String(Ne.getMonth()+1).padStart(2,"0"),ut=String(Ne.getDate()).padStart(2,"0"),zt=String(Ne.getHours()).padStart(2,"0"),ao=String(Ne.getMinutes()).padStart(2,"0"),Fn=String(Ne.getSeconds()).padStart(2,"0"),io=`${Ve}-${ot}-${ut}_${zt}-${ao}-${Fn}`,zo={type:"script-modifier-project",timestamp:Date.now(),appState:{activeTabIndex:T,isSnapToGrid:n,lineStyle:a},tabs:b,catalog:Re,library:St},Mo=JSON.stringify(zo,null,2),ar=new Blob([Mo],{type:"application/json"}),bo=URL.createObjectURL(ar),pn=document.createElement("a");pn.href=bo,pn.download=`Script_Modifier_Project_${io}.SMP`,document.body.appendChild(pn),pn.click(),document.body.removeChild(pn),URL.revokeObjectURL(bo),Zn(t("toast.projectSaved"),"success")}catch(Ne){console.error("Failed to save project:",Ne),Zn(t("toast.saveFailed")||"Failed to save project","info")}},[T,n,a,b,Re,St,Zn,t]),ts=x.useCallback(Ne=>{if(Ne.type!=="script-modifier-project"){Zn(t("alert.loadProjectFailed")||"Invalid project file format","info");return}Pr({title:"Load Project",message:t("alert.confirmLoadProject"),onConfirm:()=>{var Ve;if(Ne.appState&&(typeof Ne.appState.activeTabIndex=="number"&&I(Ne.appState.activeTabIndex),typeof Ne.appState.isSnapToGrid=="boolean"&&r(Ne.appState.isSnapToGrid),Ne.appState.lineStyle&&i(Ne.appState.lineStyle)),Array.isArray(Ne.tabs)){f(Ne.tabs),E.current=null;const ot=((Ve=Ne.appState)==null?void 0:Ve.activeTabIndex)||0,ut=Ne.tabs[ot]||Ne.tabs[0];ut&&(M(ut.nodes),ye(ut.connections),Q(ut.groups||[]),le(ut.viewTransform),H.current=ut.nodeIdCounter,E.current=ut.id)}Ne.catalog&&rt(Ne.catalog),Ne.library&&Cn(Ne.library),Zn(t("toast.projectLoaded"),"success")}})},[t,Zn,rt,Cn,M,ye,Q,le,H]),ns=x.useRef(null);x.useEffect(()=>{ns.current=ts},[ts]);const{fileInputRef:gx,handleSaveCanvas:fx,handleLoadCanvas:yx,handleFileChange:gp,loadStateFromFileContent:xx}=Aw({nodes:P,connections:te,groups:Z,viewTransform:Te,nodeIdCounter:H,setNodes:M,setConnections:ye,setGroups:Q,setViewTransform:le,activeTabName:((fp=b[T])==null?void 0:fp.name)||"default",onLoadProject:Ne=>{var Ve;return(Ve=ns.current)==null?void 0:Ve.call(ns,Ne)},addToast:Zn,setGlobalError:xt.setError}),vx=x.useCallback(Ne=>{var ot;const Ve=(ot=Ne.target.files)==null?void 0:ot[0];if(Ve){const ut=/^Script_Modifier_Canvas_(.+)_\d{4}-\d{2}-\d{2}_\d{2}-\d{2}-\d{2}\.(SMC|json)$/i,zt=Ve.name.match(ut);if(zt&&zt[1]){const ao=zt[1].replace(/_/g," ");k(T,ao)}}gp(Ne)},[gp,k,T]),{isDraggingOverCanvas:bx,handleCanvasDoubleClick:wx,handleDrop:_x,handleDragOver:Cx,handleDragLeave:Sx}=Ow({isQuickSearchOpen:nt,handleToggleCatalog:De,openQuickSearchMenu:he,openQuickAddMenu:Ge,clientPointerPosition:ae,clientPointerPositionRef:je,onAddNode:Qi,handleCloseAddNodeMenus:me,loadStateFromFileContent:xx,activeTool:ta,setActiveTool:ep,isSnapToGrid:n,setIsSnapToGrid:r,lineStyle:a,setLineStyle:i,selectedNodeIds:Zi,copyNodeValue:z,geminiContext:xt,addCharacterCardFromFile:lp,addImagePreviewNodeFromFile:cp,viewTransform:Te,nodes:P,handlePasteFromClipboard:dp,handleAddGroupFromTemplate:px,catalogItems:Re,handleToggleNodeCollapse:Pe,handleNodeDoubleClick:hp,deleteNodeAndConnections:ip,setSelectedNodeIds:nc,handleGroupSelection:sp,handleDuplicateNode:up,handleDuplicateNodeEmpty:pp,t,contextMenuSlots:s,handleValueChange:W,handleSaveProject:mp,handleLoadProject:ts,addToast:Ja}),{connectedInputs:Tx,groupButtonPosition:Ex,getCanvasCursor:Nx,getConnectionPoints:kx,selectionRect:Ax}=xA({nodes:P,connections:te,selectedNodeIds:Zi,dollyZoomingInfo:op,draggingInfo:np,effectiveTool:Qu,isPanning:J,t,selectionRect:Xy}),Ix=x.useCallback(Ne=>{Ee&&!gt&&_e(),Ne.button!==2&&tp(Ne)},[Ee,gt,_e,tp]),Px=x.useCallback(Ne=>{Ne.preventDefault(),be({x:Ne.clientX,y:Ne.clientY})},[be]),Rx=x.useCallback((Ne,Ve)=>{Dt({type:"node",id:Ne,currentTitle:Ve})},[Dt]),Mx=Ne=>{console.log("Save character card",Ne)},jx=Ne=>{console.log("Load character card",Ne)},Lx=Ne=>{es(Ne,Ze.CHARACTERS,"Character")},Dx={tabs:b,activeTabIndex:T,switchTab:R,addTab:N,closeTab:A,renameTab:k,nodes:P,setNodes:M,connections:te,groups:Z,viewTransform:Te,setViewTransform:le,isSnapToGrid:n,setIsSnapToGrid:r,lineStyle:a,setLineStyle:i,setZoom:K,isQuickSearchOpen:nt,isQuickAddOpen:at,quickAddPosition:xe,isRadialMenuOpen:Qe,radialMenuPosition:pe,isContextMenuOpen:Ee,contextMenuPosition:Fe,isCatalogOpen:Oe,isErrorCopied:qa,renameInfo:tt,promptEditInfo:un,confirmInfo:Po,isDraggingOverCanvas:bx||!!ap,showDialog:ke,activeTool:ta,effectiveTool:Qu,connectingInfo:Gy,connectionTarget:Uy,hoveredNodeId:Hy,selectedNodeIds:Zi,setSelectedNodeIds:nc,selectionRect:Ax,groupButtonPosition:Ex,draggingInfo:np,dollyZoomingInfo:op,hoveredGroupIdForDrop:Jy,dragOverNodeId:null,isAltDown:rp,extractionTarget:ap,currentCatalogItems:Ft,catalogPath:cn,currentLibraryItems:Pt,libraryPath:Gt,libraryItems:St,activeCategory:Ke,setActiveCategory:dt,fileInputRef:gx,catalogFileInputRef:Nn,libraryFileInputRef:sn,handleFileChange:vx,handleCatalogFileChange:Kt,handleLibraryFileChange:Zt,handleCanvasMouseDown:Ix,handleCanvasContextMenu:Px,updatePointerPosition:F,pointerPosition:ge,clientPointerPosition:ae,handleWheel:ce,handleCanvasDoubleClick:wx,handleDrop:_x,handleDragOver:Cx,handleDragLeave:Sx,getCanvasCursor:Nx,getConnectionPoints:kx,handleCanvasTouchStart:V,handleCanvasTouchMove:oe,handleCanvasTouchEnd:de,handleNodeMouseDown:$y,handleNodeTouchStart:Zy,handleNodeResizeMouseDown:Yy,handleNodeResizeTouchStart:ex,handleStartConnection:qy,handleStartConnectionTouchStart:tx,setHoveredNodeId:By,deleteNodeAndConnections:ip,removeConnectionsByNodeId:$,copyNodeValue:z,pasteNodeValue:L,handleDuplicateNode:up,handleDuplicateNodeEmpty:pp,handleToggleNodeCollapse:Pe,deselectAllNodes:Vy,handleNodeClick:Ky,handleNodeDoubleClick:hp,handleGroupMouseDown:Wy,handleGroupTouchStart:Qy,handleGroupSelection:sp,handleRenameGroup:Ka,handleRemoveGroup:rx,handleSaveGroupToCatalog:ax,handleSaveGroupToDisk:ix,removeConnectionById:ee,handleSplitConnection:ox,handleCloseAddNodeMenus:me,setActiveTool:ep,onAddNode:Qi,handleAddNodeFromToolbar:nx,handleSaveCanvas:fx,handleLoadCanvas:yx,openQuickSearchMenu:he,openQuickAddMenu:Ge,openRadialMenu:Se,onOpenCatalog:De,handleClearCanvas:Zl,handleResetToDefault:tc,handleCloseCatalog:Ce,confirmRename:ql,confirmPromptEdit:Kl,setRenameInfo:Dt,setPromptEditInfo:vt,setConfirmInfo:Pr,handleCopyError:ea,requestPermission:$e,declinePermission:ze,navigateCatalogBack:Bt,navigateCatalogToFolder:en,createCatalogItem:ve,handleAddGroupFromCatalog:cx,handleRenameCatalogItem:Yl,saveCatalogItemToDisk:jt,handleDeleteCatalogItem:Jl,triggerLoadFromFile:re,moveCatalogItem:Le,importCatalog:rt,importLibrary:Cn,navigateBack:se,navigateToFolder:Me,createLibraryItem:Ae,updateLibraryItem:et,deleteLibraryItem:Ne=>Xl(Ne),saveLibraryItemToDisk:Lt,triggerLoadLibraryFromFile:On,moveLibraryItem:xn,handleValueChange:W,connectedInputs:Tx,t,lastAddedNodeId:rr,creationLine:Wa,clearSelectionsSignal:xo,...xt,handleGenerateEntities:xt.handleGenerateEntities,isGeneratingEntities:xt.isGeneratingEntities,onAnalyzeYouTubeStats:xt.handleAnalyzeYouTubeStats,handleApplyAliases:dx,handleDetachCharacter:ux,addCharacterCardFromFile:lp,addImagePreviewNodeFromFile:cp,handlePasteFromClipboard:dp,toasts:Ql,addToast:Ja,removeToast:ec,setIsSettingsOpen:()=>{},contextMenuSlots:s,setContextMenuSlot:v,saveDataToCatalog:es,connectionMenu:Ue,setConnectionMenu:We,handleAddNodeFromConnectionMenu:mx,handleRenameNode:Rx,handleSaveProject:mp,handleLoadProject:ts,closeContextMenu:_e,openContextMenu:be,isContextMenuPinned:gt,toggleContextMenuPin:Et,isQuickAddPinned:It,toggleQuickAddPin:Mt,handleCopyGroup:sx,handleDuplicateGroup:lx,translateGraph:Xa,clearCanvasData:ht,clearProject:gn,handleToggleNodeOutputVisibility:q,setFullSizeImage:g,getFullSizeImage:m,setImageViewer:h,imageViewerState:d,onCopyImageToClipboard:_,onDownloadImage:y,onSaveCharacterCard:Mx,onLoadCharacterCard:jx,onSaveCharacterToCatalog:Lx,handleGenerateMusicIdeas:xt.handleGenerateMusicIdeas,isGeneratingMusicIdeas:xt.isGeneratingMusicIdeas,handleExtractTextFromImage:xt.handleExtractTextFromImage,isExtractingText:xt.isExtractingText,isAnalyzingYouTubeStats:xt.isAnalyzingYouTubeStats,handleDownloadChat:hx};return o.jsx(My.Provider,{value:Dx,children:e})},or=()=>{const e=x.useContext(My);if(!e)throw new Error("useAppContext must be used within an AppProvider");return e},MA=({node:e,onValueChange:t,onAnalyzeCharacter:n,isAnalyzingCharacter:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l})=>{const c=x.useMemo(()=>{try{const m=JSON.parse(e.value||"{}");return{character:m.character||"",clothing:m.clothing||""}}catch{return{character:"",clothing:""}}},[e.value]),{character:d="",clothing:h=""}=c,g=(m,_)=>{t(e.id,JSON.stringify({...c,[m]:_}))};return o.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[o.jsxs("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",onWheel:m=>m.stopPropagation(),children:[o.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400 mb-1",children:s("node.content.character")}),o.jsx("textarea",{value:d,onChange:m=>g("character",m.target.value),placeholder:s("node.content.characterPlaceholder"),className:"w-full flex-grow p-2 bg-gray-700 border border-transparent rounded-md resize-y focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar overflow-y-scroll",onMouseDown:m=>m.stopPropagation(),onFocus:l})]}),o.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400 mb-1",children:s("node.content.clothing")}),o.jsx("textarea",{value:h,onChange:m=>g("clothing",m.target.value),placeholder:s("node.content.clothingPlaceholder"),className:"w-full flex-grow p-2 bg-gray-700 border border-transparent rounded-md resize-y focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar overflow-y-scroll",onMouseDown:m=>m.stopPropagation(),onFocus:l})]})]}),o.jsx("button",{onClick:r?i:()=>n(e.id),disabled:a,className:`w-full px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 flex-shrink-0 ${a?"bg-yellow-600":r?"bg-red-600 hover:bg-red-700":"bg-cyan-600 hover:bg-cyan-700"}`,children:s(a?"node.action.stopping":r?"node.action.stop":"node.content.analyzePrompt")})]})},jA=({isOpen:e,onClose:t,onApply:n,imageSrc:r})=>e?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:o.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg text-white",children:[o.jsx("h3",{className:"text-xl mb-4",children:"Simple Editor"}),r&&o.jsx("img",{src:r.startsWith("data:")?r:`data:image/png;base64,${r}`,alt:"Edit",className:"max-w-md max-h-96 object-contain mb-4"}),o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-700 rounded hover:bg-gray-600",children:"Close"}),o.jsx("button",{onClick:()=>{r&&n(r.startsWith("data:")?r.split(",")[1]:r),t()},className:"px-4 py-2 bg-emerald-600 rounded hover:bg-emerald-700",children:"Apply (No Op)"})]})]})}):null,lt=({title:e,children:t,position:n="bottom",className:r="",contentClassName:a=""})=>{const[i,s]=x.useState(!1),[l,c]=x.useState({top:0,left:0}),d=x.useRef(null),h=()=>{if(d.current&&i){const m=d.current.getBoundingClientRect(),_=6;let y=0,v=0;switch(n){case"top":y=m.top-_,v=m.left+m.width/2;break;case"bottom":y=m.bottom+_,v=m.left+m.width/2;break;case"left":y=m.top+m.height/2,v=m.left-_;break;case"right":y=m.top+m.height/2,v=m.right+_;break}c({top:y,left:v})}};x.useLayoutEffect(()=>{if(i)return h(),window.addEventListener("scroll",h,!0),window.addEventListener("resize",h),()=>{window.removeEventListener("scroll",h,!0),window.removeEventListener("resize",h)}},[i,n]);const g={top:"-translate-x-1/2 -translate-y-full",bottom:"-translate-x-1/2",left:"-translate-x-full -translate-y-1/2",right:"-translate-y-1/2"};return e?o.jsxs("div",{ref:d,className:`relative flex items-center justify-center ${r}`,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),onMouseDown:()=>s(!1),children:[t,i&&Ji.createPortal(o.jsx("div",{className:`fixed z-[9999] px-2 py-1 bg-gray-900 text-gray-200 text-xs font-medium rounded shadow-xl pointer-events-none transition-opacity duration-200 ${g[n]} ${a||"whitespace-nowrap"}`,style:{top:l.top,left:l.left,isolation:"isolate"},role:"tooltip",children:e}),document.body)]}):o.jsx("div",{className:`relative flex items-center justify-center ${r}`,children:t})},Ie=({title:e,onClick:t,children:n,tooltipPosition:r="top",disabled:a=!1,className:i=""})=>o.jsx(lt,{title:a?"":e,position:r,children:o.jsx("button",{onClick:t,disabled:a,onMouseDown:s=>s.stopPropagation(),"aria-label":e,className:`p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none disabled:text-gray-600 disabled:bg-transparent disabled:cursor-not-allowed flex items-center justify-center ${i}`,children:n})}),Wo=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})}),Ei=({className:e})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14l2 2 4-4"})]}),LA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),jy=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"})}),Ly=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5M15 15l5.25 5.25"})}),DA=({className:e})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),OA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),FA=({className:e})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 3v1.5M3 21v-6m0 0l2-2m-2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3"})]}),zA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),GA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),UA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"})}),_l=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),HA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),BA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}),VA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),$A=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),WA=({className:e})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),Dy=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),Oy=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),YA=({className:e})=>o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),o.jsx("path",{d:"m15 5 4 4"})]}),qA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9"})}),KA=({className:e})=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),JA=({value:e,onChange:t,placeholder:n,className:r,onFocus:a,onCopy:i})=>{const s=l=>{const c=parseInt(e.replace(/[^0-9]/g,""),10)||0,d=Math.max(1,c+l);t(`Entity-${d}`)};return o.jsxs("div",{className:`flex items-center bg-gray-700 rounded-md border border-gray-600 h-[32px] overflow-hidden group hover:border-gray-500 transition-colors ${r}`,children:[o.jsx("input",{type:"text",value:e,readOnly:!0,placeholder:n,onFocus:a,className:"w-full h-full bg-transparent text-sm text-gray-300 px-2 focus:outline-none border-none min-w-0 cursor-default select-none",onMouseDown:l=>l.stopPropagation()}),o.jsxs("div",{className:"flex flex-col h-full border-l border-gray-600 w-5 flex-shrink-0 bg-gray-800",children:[o.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-emerald-600 text-gray-400 hover:text-white transition-colors",onClick:l=>{l.stopPropagation(),s(1)},children:o.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M4 0L8 4H0L4 0Z",fill:"currentColor"})})}),o.jsx("button",{className:"h-1/2 flex items-center justify-center hover:bg-emerald-600 text-gray-400 hover:text-white transition-colors border-t border-gray-600",onClick:l=>{l.stopPropagation(),s(-1)},children:o.jsx("svg",{width:"6",height:"3",viewBox:"0 0 8 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M4 4L0 0H8L4 4Z",fill:"currentColor"})})})]})]})},XA=({fullDescription:e,onDescriptionChange:t,t:n,onFocus:r})=>{const[a,i]=x.useState({});x.useEffect(()=>{const c={Appearance:"",Personality:"",Clothing:""},d={:"Appearance",:"Personality",:"Personality",:"Clothing",apariencia:"Appearance",personalidad:"Personality",ropa:"Clothing",appearance:"Appearance",personality:"Personality",clothing:"Clothing"},h=/####\s*(Appearance|Personality|Clothing|||||Apariencia|Personalidad|Ropa)\s*([\s\S]*?)(?=####|$)/gi;let g,m=!1;for(;(g=h.exec(e))!==null;){m=!0;const _=g[1].trim().toLowerCase(),y=d[_],v=g[2].trim();y&&(c[y]=v)}!m&&e.trim()&&(c.Appearance=e.trim()),i(c)},[e]);const s=(c,d)=>{const h={...a,[c]:d};i(h);const g=`#### Appearance
${h.Appearance||""}

#### Personality
${h.Personality||""}

#### Clothing
${h.Clothing||""}`;t(g)},l={Appearance:{icon:o.jsx(DA,{className:"h-3.5 w-3.5"}),color:"text-gray-400"},Personality:{icon:o.jsx(OA,{className:"h-3.5 w-3.5"}),color:"text-gray-400"},Clothing:{icon:o.jsx(FA,{className:"h-3.5 w-3.5"}),color:"text-gray-400"}};return o.jsx("div",{className:"space-y-4 p-4 pb-2 text-sm flex flex-col pr-1 overflow-x-hidden",children:["Appearance","Personality","Clothing"].map(c=>{const d=l[c];return o.jsxs("div",{className:"flex-shrink-0 flex flex-col items-start w-full",children:[o.jsxs("div",{className:"flex flex-row items-center justify-between mb-1.5 w-full",children:[o.jsxs("div",{className:"flex flex-row items-center gap-1.5",children:[o.jsx("span",{className:"text-gray-400",children:d.icon}),o.jsx("h5",{className:`font-bold ${d.color} text-[11px] uppercase tracking-wider flex-shrink-0`,children:n(`node.content.${c.toLowerCase()}`)||c})]}),o.jsx(Ie,{title:n("node.action.copy"),onClick:h=>{h.stopPropagation(),navigator.clipboard.writeText(a[c]||"")},className:"p-1 text-gray-500 hover:text-emerald-400 transition-colors",tooltipPosition:"left",children:o.jsx(Wo,{className:"h-3 w-3"})})]}),o.jsx("textarea",{value:a[c]||"",onChange:h=>s(c,h.target.value),className:"w-full text-sm p-2 bg-gray-900/60 border border-gray-700 rounded-md resize-y focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar min-h-[60px] transition-colors hover:bg-gray-800/80 text-gray-200 text-left",onWheel:h=>h.stopPropagation(),onKeyDown:h=>h.stopPropagation(),onFocus:r})]},c)})})},ZA=380,QA=({char:e,index:t,nodeId:n,isDragging:r,isDuplicate:a,t:i,onUpdate:s,onRemove:l,onSetOutput:c,onDragStart:d,onGenerateImage:h,isGeneratingImage:g,onSyncFromConnection:m,onCopyImageToClipboard:_,onDetach:y,onSaveCharacter:v,onLoadCharacter:C,onSaveToCatalog:w,onCopyCard:b,onPasteToCard:f,onOpenInEditor:T,onOpenInRasterEditor:I,onRatioChange:E,onCrop1x1:R,onRatioExpand:N,onPasteImageToSlot:A,onClearImage:k,onViewImage:P,onUploadImage:M,onImageDrop:H,transformingRatio:W,deselectAllNodes:O,isModifying:U,isUpdatingDescription:z,onModifyRequest:L,onUpdateDescriptionRequest:D,secondaryLanguage:G})=>{const[q,ie]=x.useState(!1),[te,ye]=x.useState("");x.useRef(null);const ue=!!(e.thumbnails[e.selectedRatio]||e.image),$=ee=>{ee.dataTransfer.types.includes("application/prompt-modifier-card")&&ee.preventDefault()};return o.jsxs("div",{className:"flex flex-col h-full border border-gray-700/50 rounded-xl bg-gray-900/80 p-2.5 overflow-hidden shadow-xl hover:border-gray-600 transition-colors flex-shrink-0",style:{width:`${ZA}px`,opacity:r?.4:1,transform:r?"scale(0.95)":"none"},onDragOver:$,children:[o.jsxs("div",{className:"h-8 bg-gray-900/60 rounded-t-lg border-b border-gray-700/50 flex items-center px-3 cursor-grab active:cursor-grabbing hover:bg-gray-800 transition-colors mb-2 group/handle relative flex-shrink-0 gap-2",draggable:!0,onDragStart:d,onMouseDown:ee=>ee.stopPropagation(),children:[o.jsx("div",{className:"flex items-center gap-1 overflow-hidden flex-grow",children:o.jsxs("span",{className:"text-xs font-bold truncate",children:[o.jsxs("span",{className:"text-emerald-400",children:[e.index||"ENT",":"]})," ",o.jsx("span",{className:"text-gray-200 ml-1",children:e.name||"Unnamed"}),o.jsxs("span",{className:"text-[9px] text-gray-500 font-mono ml-2 opacity-50",children:["#",e.id]})]})}),o.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[o.jsx(lt,{title:i("node.action.markPrimary"),children:o.jsx("button",{onClick:ee=>{ee.stopPropagation(),c()},className:`p-0.5 rounded hover:bg-gray-700 transition-colors ${e.isOutput?"text-emerald-400":"text-gray-500 hover:text-gray-300"}`,onMouseDown:ee=>ee.stopPropagation(),children:e.isOutput?o.jsx(UA,{className:"h-4 w-4"}):o.jsx(GA,{className:"h-4 w-4"})})}),o.jsx(lt,{title:i("node.action.deleteItem"),children:o.jsx("button",{onClick:ee=>{ee.stopPropagation(),l()},className:"p-0.5 rounded hover:bg-red-900/50 text-gray-500 hover:text-red-400 transition-colors",onMouseDown:ee=>ee.stopPropagation(),children:o.jsx(_l,{className:"h-4 w-4"})})})]})]}),o.jsxs("div",{className:"flex gap-2 flex-shrink-0 items-center mb-2 h-[32px]",children:[o.jsx("input",{type:"text",value:e.name,onChange:ee=>s({name:ee.target.value}),placeholder:i("node.content.character"),className:"flex-grow min-w-0 px-2 bg-gray-700 border border-gray-600 rounded-md text-sm text-white focus:ring-1 focus:ring-emerald-500 outline-none h-[32px] transition-colors hover:border-gray-500",onMouseDown:ee=>ee.stopPropagation(),onFocus:O}),o.jsx(JA,{value:e.index,onChange:ee=>s({index:ee}),placeholder:"Index",onFocus:O,onCopy:()=>navigator.clipboard.writeText(e.index),className:`w-28 shrink-0 ${a?"!border-red-500 !ring-1 !ring-red-500":""}`})]}),o.jsxs("div",{className:"flex flex-col flex-shrink-0 mb-1",children:[o.jsxs("div",{className:"flex items-end justify-between pr-2 h-7 z-0 cursor-pointer hover:bg-gray-700/30 transition-colors rounded-t-md select-none",onClick:ee=>{ee.stopPropagation(),s({isImageCollapsed:!e.isImageCollapsed})},children:[o.jsx("div",{className:"flex items-end pl-2 gap-1 h-full",children:["1:1","16:9","9:16"].map(ee=>o.jsx("button",{onClick:Te=>{Te.stopPropagation(),E(ee)},onDragEnter:Te=>{Te.stopPropagation(),E(ee)},className:`px-3 py-1 text-[10px] font-bold outline-none transition-colors rounded-t-md ${e.selectedRatio===ee?"bg-gray-700/80 text-emerald-400 h-full shadow-inner":"bg-gray-700/40 text-gray-500 h-[80%] hover:bg-gray-700/60"}`,children:ee},ee))}),o.jsx("button",{className:"p-1 mb-0.5 text-gray-500 hover:text-emerald-400 transition-colors",title:e.isImageCollapsed?"Show Image":"Hide Image",children:e.isImageCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!e.isImageCollapsed&&o.jsx("div",{onClick:ee=>{ee.stopPropagation(),ue?P():M()},onDragEnter:ee=>{ee.dataTransfer.types.includes("application/prompt-modifier-card")||(ee.preventDefault(),ee.stopPropagation(),ie(!0))},onDragOver:ee=>{ee.dataTransfer.types.includes("application/prompt-modifier-card")||(ee.preventDefault(),ee.stopPropagation(),ie(!0))},style:{cursor:ue?"zoom-in":"pointer"},className:`flex-shrink-0 h-[256px] bg-gray-700/50 rounded-xl flex items-center justify-center transition-all group relative overflow-hidden z-10 hover:z-20 hover:bg-gray-600/70 ${q?"border-2 border-emerald-500 ring-2 ring-emerald-500/20":""}`,onDragLeave:()=>ie(!1),onDrop:ee=>{ee.dataTransfer.types.includes("application/prompt-modifier-card")||(ee.preventDefault(),ee.stopPropagation(),ie(!1),H(ee))},children:e.thumbnails[e.selectedRatio]||e.image?o.jsxs(o.Fragment,{children:[o.jsx("img",{src:`data:image/png;base64,${e.thumbnails[e.selectedRatio]||e.image}`,className:"object-contain w-full h-full",style:{imageRendering:"auto"},draggable:!0,onDragStart:ee=>{var le;const Te=((le=e.imageSources)==null?void 0:le[e.selectedRatio])||e.image;Te&&(ee.dataTransfer.setData("application/prompt-modifier-drag-image",Te),ee.stopPropagation())}}),o.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-20",children:[o.jsx(Ie,{title:i("node.action.paste"),onClick:ee=>{ee.stopPropagation(),A()},className:"bg-black/60 p-1.5 rounded text-emerald-400 hover:text-white",tooltipPosition:"left",children:o.jsx(Ei,{className:"h-4 w-4"})}),o.jsx(Ie,{title:i("node.action.copy"),onClick:ee=>{var le;ee.stopPropagation();const Te=((le=e.imageSources)==null?void 0:le[e.selectedRatio])||e.image;Te&&_(Te)},className:"bg-black/60 p-1.5 rounded text-emerald-400 hover:text-white",tooltipPosition:"left",children:o.jsx(Wo,{className:"h-4 w-4"})}),o.jsx(Ie,{title:i("node.action.clear"),onClick:ee=>{ee.stopPropagation(),k()},className:"bg-black/60 p-1.5 rounded text-red-400 hover:text-white",tooltipPosition:"left",children:o.jsx(_l,{className:"h-4 w-4"})})]})]}):o.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-full gap-2",children:[o.jsx(Oy,{className:"h-10 w-10 text-gray-500"}),o.jsx("span",{className:"text-[10px] text-gray-500 uppercase font-bold text-center px-4 leading-tight",children:i("node.content.imagePromptPlaceholder")}),o.jsxs("button",{onClick:ee=>{ee.stopPropagation(),A()},className:"mt-2 px-3 py-1 bg-gray-700 hover:bg-gray-600 text-gray-300 hover:text-white text-xs font-bold rounded border border-gray-600 transition-colors flex items-center gap-1.5",children:[o.jsx(Ei,{className:"h-3.5 w-3.5"}),i("node.action.paste")]})]})}),!e.isImageCollapsed&&o.jsx("div",{className:"h-4"})]}),o.jsx("div",{className:"flex gap-1 flex-shrink-0 mb-2 items-center px-1",children:o.jsxs("button",{onClick:ee=>{ee.stopPropagation(),h()},disabled:!!g||!e.prompt,className:`flex-grow h-8 font-bold rounded text-[10px] uppercase transition-all shadow-sm flex items-center justify-center gap-2
                            ${g?"bg-gray-600 text-gray-300 cursor-not-allowed opacity-75":"bg-emerald-600 hover:bg-emerald-500 text-white"}
                            disabled:opacity-50 disabled:cursor-not-allowed`,children:[g&&o.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i(g?"node.content.generating":"node.content.generateImage")]})}),o.jsxs("div",{className:"flex flex-col gap-1 mb-2 shrink-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:"text-gray-400",children:o.jsx(zA,{className:"h-3 w-3"})}),o.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:i("node.content.prompt")})]}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx(Ie,{title:i("node.action.sync"),onClick:m,tooltipPosition:"left",children:o.jsx(Dy,{className:"h-3 w-3"})}),o.jsx(Ie,{title:i("node.action.copy"),onClick:()=>navigator.clipboard.writeText(e.prompt),tooltipPosition:"left",children:o.jsx(Wo,{className:"h-3 w-3"})})]})]}),o.jsx("textarea",{value:e.prompt,onChange:ee=>s({prompt:ee.target.value}),className:"w-full p-2 bg-gray-900/60 border border-gray-700 rounded text-xs text-gray-200 resize-y focus:border-emerald-500 outline-none min-h-[60px] max-h-[120px] custom-scrollbar",onMouseDown:ee=>ee.stopPropagation(),onFocus:O})]}),o.jsxs("div",{className:"flex flex-col gap-1 mb-2 shrink-0",children:[o.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:"Suffix"}),o.jsx("input",{type:"text",value:e.additionalPrompt||"",onChange:ee=>s({additionalPrompt:ee.target.value}),className:"w-full p-1 bg-gray-900/60 border border-gray-700 rounded text-xs text-gray-400 focus:border-emerald-500 outline-none",onMouseDown:ee=>ee.stopPropagation(),onFocus:O})]}),o.jsxs("div",{className:"flex flex-col gap-1 border-b border-gray-700/50 pb-3 mb-2 flex-shrink-0",children:[o.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter",children:i("node.content.modificationPromptPlaceholder")}),o.jsxs("div",{className:"flex gap-2 h-[32px]",children:[o.jsx("input",{value:te,onChange:ee=>ye(ee.target.value),placeholder:"...",className:"flex-grow bg-gray-900/60 border border-gray-700 rounded px-2 text-xs text-white focus:border-emerald-500 outline-none h-full",onMouseDown:ee=>ee.stopPropagation(),onFocus:O}),o.jsx("div",{className:"flex items-center bg-gray-700 rounded p-0.5 h-full space-x-0.5 justify-center min-w-[50px]",children:[{code:"en",label:"EN"},{code:G,label:G.toUpperCase()}].map((ee,Te)=>o.jsx("button",{onClick:le=>{le.stopPropagation(),s({targetLanguage:ee.code})},className:`h-full flex-1 rounded px-1.5 text-[10px] font-bold transition-colors flex items-center justify-center ${e.targetLanguage===ee.code?"bg-emerald-600 text-white":"text-gray-400 hover:text-gray-200"}`,children:ee.label},ee.code+Te))}),o.jsxs("div",{className:"flex gap-1 h-full",children:[o.jsx(lt,{title:"Modify",children:o.jsx("button",{onClick:ee=>{ee.stopPropagation(),L(te),ye("")},disabled:!te.trim()||U,className:"w-8 bg-emerald-600 hover:bg-emerald-500 text-white rounded flex items-center justify-center disabled:opacity-50 h-full",children:U?o.jsxs("svg",{className:"animate-spin h-3.5 w-3.5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})}),o.jsx(lt,{title:"Update Desc",children:o.jsx("button",{onClick:ee=>{ee.stopPropagation(),D()},disabled:z||!e.prompt,className:"w-8 bg-cyan-600 hover:bg-cyan-500 text-white rounded flex items-center justify-center disabled:opacity-50 h-full transition-colors",children:z?o.jsxs("svg",{className:"animate-spin h-3.5 w-3.5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})})]})]})]}),o.jsxs("div",{className:"flex-grow min-h-0 mt-2 relative p-0 border border-gray-700/50 rounded-xl bg-gray-900/20 shadow-inner overflow-hidden flex flex-col overflow-x-hidden",children:[o.jsxs("div",{className:"px-4 py-2 bg-gray-800 border-b border-gray-700 flex items-center justify-between cursor-pointer hover:bg-gray-750 transition-colors select-none flex-shrink-0",onClick:()=>s({isDescriptionCollapsed:!e.isDescriptionCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:`transform transition-transform duration-200 ${e.isDescriptionCollapsed?"-rotate-90":""}`,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})}),o.jsx("span",{className:"text-[10px] font-black text-gray-300 uppercase tracking-widest",children:i("node.content.fullDescription")})]}),o.jsx("div",{className:"flex gap-1",children:o.jsx(Ie,{title:i("node.action.copy"),onClick:ee=>{ee.stopPropagation(),navigator.clipboard.writeText(e.fullDescription)},className:"p-1 text-gray-500 hover:text-emerald-400 transition-colors",tooltipPosition:"left",children:o.jsx(Wo,{className:"h-3 w-3"})})})]}),!e.isDescriptionCollapsed&&o.jsx("div",{className:"overflow-y-auto custom-scrollbar flex-grow overflow-x-hidden",onWheel:ee=>ee.stopPropagation(),style:{scrollbarGutter:"stable",overscrollBehaviorY:"contain"},children:o.jsx(XA,{fullDescription:e.fullDescription||"",onDescriptionChange:ee=>s({fullDescription:ee}),t:i,onFocus:O})})]}),o.jsxs("div",{className:"flex gap-1.5 pt-2.5 mt-auto border-t border-gray-700/50 flex-shrink-0 bg-gray-800/20 backdrop-blur-sm",children:[o.jsx("button",{onClick:ee=>{ee.stopPropagation(),v()},className:"flex-1 h-9 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded text-[10px] uppercase tracking-tighter transition-colors",children:i("node.action.saveCharacter")}),o.jsx("button",{onClick:ee=>{ee.stopPropagation(),C()},className:"flex-1 h-9 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded text-[10px] uppercase tracking-tighter transition-colors",children:i("node.action.loadCharacter")}),o.jsxs("div",{className:"flex gap-1.5 ml-auto",children:[o.jsx(Ie,{title:i("group.saveToCatalog"),onClick:ee=>{ee.stopPropagation(),w()},children:o.jsx(KA,{className:"h-5 w-5"})}),o.jsx(Ie,{title:i("node.action.copy"),onClick:ee=>{ee.stopPropagation(),b()},children:o.jsx(Wo,{className:"h-4 w-4"})}),o.jsx(Ie,{title:i("node.action.paste"),onClick:ee=>{ee.stopPropagation(),f()},children:o.jsx(Ei,{className:"h-4 w-4"})}),o.jsx(Ie,{title:"Detach",onClick:ee=>{ee.stopPropagation(),y()},children:o.jsx(LA,{className:"h-4 w-4"})})]})]})]})},e5=({node:e,onValueChange:t,onSaveCharacterCard:n,onLoadCharacterCard:r,t:a,deselectAllNodes:i,onSaveCharacterToCatalog:s,setFullSizeImage:l,getFullSizeImage:c,setImageViewer:d,onCopyImageToClipboard:h,onDownloadImage:g,addToast:m,onUpdateCharacterDescription:_,isUpdatingDescription:y,onModifyCharacter:v,isModifyingCharacter:C,getUpstreamNodeValues:w,connectedInputs:b,onDetachCharacter:f,onGenerateImage:T,isGeneratingImage:I,isGeneratingCharacterImage:E,onAddNode:R,onDeleteNode:N})=>{const A=or(),{setNodes:k}=A||{};R||(A==null||A.onAddNode);const P=e.id,M=e.title,H=x.useRef(null),[W,O]=x.useState(!1),[U,z]=x.useState(!1),[L,D]=x.useState(null),[G,q]=x.useState(0),[ie,te]=x.useState(null),[ye,ue]=x.useState(null),[$,ee]=x.useState(null),[Te,le]=x.useState(null),[J,ge]=x.useState(null),{language:ae}=Ht(),ce=ae==="en"?"ru":ae;b==null||b.has(void 0);const B=x.useMemo(()=>{try{let xe=JSON.parse(e.value||"[]");return Array.isArray(xe)||(typeof xe=="object"&&xe!==null?xe=[xe]:xe=[]),xe.length===0&&(xe=[{type:"character-card",id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},imageSources:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!0,additionalPrompt:"Full body character concept on a gray background"}]),xe.map((he,Ge)=>({type:"character-card",nodeTitle:M,id:he.id||`char-card-${Date.now()}-${Ge}`,name:he.name||"",index:he.index||he.alias||`Entity-${Ge+1}`,image:he.image||null,thumbnails:he.thumbnails||he.imageSources||{"1:1":null,"16:9":null,"9:16":null},imageSources:he.imageSources||he.thumbnails||{"1:1":null,"16:9":null,"9:16":null},selectedRatio:he.selectedRatio||"1:1",prompt:he.prompt||"",additionalPrompt:he.additionalPrompt!==void 0?he.additionalPrompt:"Full body character concept on a gray background",fullDescription:he.fullDescription||"",targetLanguage:he.targetLanguage||"en",isOutput:he.isOutput||Ge===0&&!xe.some(me=>me.isOutput),isActive:he.isActive!==!1,isDescriptionCollapsed:he.isDescriptionCollapsed??!1,isImageCollapsed:he.isImageCollapsed??!1,isPromptCollapsed:he.isPromptCollapsed??!0,_fullResActive:he._fullResActive||null}))}catch{return[{type:"character-card",nodeTitle:M,id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},imageSources:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!0,additionalPrompt:"Full body character concept on a gray background"}]}},[e.value,M]),X=x.useMemo(()=>{const xe={};B.forEach(Ge=>{const me=(Ge.index||"").trim();xe[me]=(xe[me]||0)+1});const he=new Set;return Object.entries(xe).forEach(([Ge,me])=>{me>1&&Ge!==""&&he.add(Ge)}),he},[B]),F=x.useCallback(xe=>{const he=xe.map(Ge=>({...Ge,type:"character-card",nodeTitle:M}));t(e.id,JSON.stringify(he))},[e.id,t,M]),Y=x.useCallback((xe,he)=>{const Ge=[...B];Ge[xe]={...Ge[xe],...he},F(Ge)},[B,F]),K=xe=>{const he=B.map((Ge,me)=>({...Ge,isOutput:me===xe}));F(he),m==null||m("Entity marked as output","success")},V=(xe,he)=>{xe.stopPropagation();const Ge=B[he],me={...Ge.thumbnails};c&&Object.entries(Go).forEach(([De,Ce])=>{const Qe=c(e.id,he*10+Ce);Qe&&(me[De]=Qe)});const Oe={type:"prompt-modifier-character-card-transfer",sourceNodeId:e.id,sourceIndex:he,character:{...Ge,imageSources:me,type:"character-card",nodeTitle:M,_fullResActive:c?c(e.id,he*10):null}};xe.dataTransfer.setData("application/prompt-modifier-card",JSON.stringify(Oe)),xe.dataTransfer.effectAllowed="move",requestAnimationFrame(()=>ue(he))},oe=(xe,he)=>{xe.dataTransfer.types.includes("application/prompt-modifier-card")&&(xe.preventDefault(),xe.stopPropagation(),le(he),ee(he))},de=()=>{le(null),ee(null)},Z=async xe=>{xe.preventDefault(),xe.stopPropagation(),le(null),ue(null),O(!1);const he=$;ee(null);const Ge=xe.dataTransfer.getData("application/prompt-modifier-card");if(Ge)try{const me=JSON.parse(Ge);if(me.type!=="prompt-modifier-character-card-transfer")return;const{sourceNodeId:Oe,sourceIndex:De,character:Ce}=me,Qe=he!==null?he:B.length;if(Oe===e.id){if(De===Qe||De===Qe-1)return;const pe=[...B],[Se]=pe.splice(De,1);let Ee=Qe;Qe>De&&(Ee-=1),pe.splice(Ee,0,Se);const Fe={};if(c&&B.forEach((be,_e)=>{for(let Ue=0;Ue<10;Ue++){const We=c(e.id,_e*10+Ue);We&&(Fe[_e*10+Ue]=We)}}),l){for(let be=0;be<B.length*10;be++)l(e.id,be,null);pe.forEach((be,_e)=>{const Ue=B.findIndex(We=>We.id===be.id);if(Ue!==-1)for(let We=0;We<10;We++){const gt=Fe[Ue*10+We];gt&&l(e.id,_e*10+We,gt)}})}F(pe)}else{const pe=[...B];pe.length===1&&!pe[0].name&&!pe[0].image&&!pe[0].prompt&&pe.splice(0,1);const Se={...Ce,id:`char-card-${Date.now()}`};pe.splice(Qe,0,Se),l&&(Se.imageSources&&Object.entries(Se.imageSources).forEach(([Ee,Fe])=>{const be=Go[Ee];be&&typeof Fe=="string"&&l(e.id,Qe*10+be,Fe)}),Se._fullResActive&&l(e.id,Qe*10,Se._fullResActive)),k&&k(Ee=>Ee.map(Fe=>Fe.id===e.id?{...Fe,width:pe.length*sa}:Fe)),F(pe),k&&(A!=null&&A.setFullSizeImage)&&(A!=null&&A.getFullSizeImage)&&k(Ee=>Ee.map(Fe=>{if(Fe.id===Oe)try{const _e=JSON.parse(Fe.value).filter((Ue,We)=>We!==De);return{...Fe,value:JSON.stringify(_e),width:Math.max(sa,_e.length*sa)}}catch{return Fe}return Fe})),m==null||m("Card transferred","success")}}catch(me){console.error("Drop failed",me)}},Q=xe=>{if(B.length<=1){F([{type:"character-card",nodeTitle:M,id:`char-card-${Date.now()}`,name:"New Entity 1",index:"Entity-1",image:null,thumbnails:{"1:1":null,"16:9":null,"9:16":null},imageSources:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!0,isActive:!0,isDescriptionCollapsed:!1,isImageCollapsed:!1,isPromptCollapsed:!0,additionalPrompt:"Full body character concept on a gray background"}]);return}if(l&&c){for(let me=xe;me<B.length-1;me++)for(let Oe=0;Oe<10;Oe++){const De=c(e.id,(me+1)*10+Oe);l(e.id,me*10+Oe,De||null)}const Ge=B.length-1;for(let me=0;me<10;me++)l(e.id,Ge*10+me,null)}const he=B.filter((Ge,me)=>me!==xe);he.some(Ge=>Ge.isOutput)||(he[0].isOutput=!0),F(he),k&&k(Ge=>Ge.map(me=>me.id===e.id?{...me,width:Math.max(sa,he.length*sa)}:me))},j=async(xe,he)=>{const Ge=B[xe];l&&(l(e.id,xe*10,he),l(e.id,xe*10+(Go[Ge.selectedRatio]||1),he));const me=await mg(he,256,256),Oe={...Ge.thumbnails,[Ge.selectedRatio]:me},De={...Ge.imageSources,[Ge.selectedRatio]:he};Y(xe,{thumbnails:Oe,image:me,imageSources:De})},fe=(xe,he)=>{const Ge=B[xe];if(he===Ge.selectedRatio)return;let me=null;c&&(me=c(e.id,xe*10+(Go[he]||1)));const Oe=Ge.thumbnails[he]||null;l&&(me?l(e.id,xe*10,me):Oe&&l(e.id,xe*10,Oe)),Y(xe,{selectedRatio:he,image:Oe})},Pe=async xe=>{const he=B[xe],Ge={...he.thumbnails};c&&Object.entries(Go).forEach(([Oe,De])=>{const Ce=c(e.id,xe*10+De);Ce&&(Ge[Oe]=Ce)});const me={type:"character-card",...he,imageSources:Ge,nodeTitle:M};delete me.id;try{await navigator.clipboard.writeText(JSON.stringify(me,null,2)),m==null||m(a("toast.copied"),"success")}catch{m==null||m(a("app.error.copy"),"info")}},je=async xe=>{try{const he=await navigator.clipboard.readText(),Ge=JSON.parse(he);let me=Array.isArray(Ge)?Ge[0]:Ge;if(me&&(me.type==="character-card"||me.name||me.prompt)){const Oe=me.imageSources||{"1:1":null,"16:9":null,"9:16":null},De={"1:1":null,"16:9":null,"9:16":null};me.image&&!me.imageSources&&(Oe["1:1"]=me.image);for(const[Qe,pe]of Object.entries(Oe))if(typeof pe=="string"&&pe.startsWith("data:")){const Se=xe*10+(Go[Qe]||1);l&&l(e.id,Se,pe),De[Qe]=await mg(pe,256,256)}else De[Qe]=pe;const Ce=me.selectedRatio||"1:1";Y(xe,{name:me.name||"",index:me.index||me.alias||`Entity-${xe+1}`,prompt:me.prompt||"",fullDescription:me.fullDescription||"",selectedRatio:Ce,image:De[Ce],thumbnails:De,imageSources:Oe}),m==null||m(a("toast.pasted"),"success")}}catch{m==null||m(a("app.error.fileReadError"),"info")}},ke=async xe=>{try{const he=await navigator.clipboard.read();for(const Ge of he){const me=Ge.types.find(Oe=>Oe.startsWith("image/"));if(me){const Oe=await Ge.getType(me),De=new FileReader;De.onload=async Ce=>{var pe;const Qe=(pe=Ce.target)==null?void 0:pe.result;Qe&&(await j(xe,Qe),m==null||m(a("toast.pasted"),"success"))},De.readAsDataURL(Oe);return}}m==null||m(a("toast.pasteFailed"),"info")}catch{m==null||m(a("toast.pasteFailed"),"info")}},$e=(xe,he)=>{const Ge={},me=["1:1","16:9","9:16"],Oe=xe.imageSources||xe.thumbnails||{};me.forEach(Ee=>{let Fe=Oe[Ee];if(c){const be=c(e.id,he*10+(Go[Ee]||1));be&&(Fe=be)}Ee==="1:1"&&!Fe&&(Fe=xe.image),Fe?Ge[Ee]=Fe.startsWith("data:image")?Fe:`data:image/png;base64,${Fe}`:Ge[Ee]=null});const De={type:"character-card",nodeTitle:M,name:xe.name,index:xe.index,image:Ge["1:1"]||null,selectedRatio:xe.selectedRatio||"1:1",prompt:xe.prompt,fullDescription:xe.fullDescription,imageSources:Ge,additionalPrompt:xe.additionalPrompt,targetLanguage:xe.targetLanguage,isOutput:xe.isOutput,isActive:xe.isActive,isDescriptionCollapsed:xe.isDescriptionCollapsed,isImageCollapsed:xe.isImageCollapsed,isPromptCollapsed:xe.isPromptCollapsed},Ce=JSON.stringify(De,null,2),Qe=new Blob([Ce],{type:"application/json"}),pe=URL.createObjectURL(Qe),Se=document.createElement("a");Se.href=pe,Se.download=`${(xe.name||"character").replace(/ /g,"_")}.json`,document.body.appendChild(Se),Se.click(),document.body.removeChild(Se),URL.revokeObjectURL(pe)},ze=xe=>{(xe.dataTransfer.types.includes("application/prompt-modifier-card")||xe.dataTransfer.types.includes("Files"))&&(xe.preventDefault(),xe.stopPropagation(),O(!0))},nt=x.useCallback(xe=>{var Ge;const he=(Ge=xe.target.files)==null?void 0:Ge[0];if(he){const me=new FileReader;me.onload=async Oe=>{var Qe;const De=(Qe=Oe.target)==null?void 0:Qe.result;De&&await j(ie!==null?ie:G,De)},me.readAsDataURL(he)}xe.target&&(xe.target.value=""),te(null)},[G,ie]),at=({index:xe})=>o.jsx("div",{className:`w-[24px] h-full flex items-center justify-center flex-shrink-0 transition-all cursor-copy ${Te===xe?"bg-gray-800/30":""}`,onDragOver:he=>oe(he,xe),onDragLeave:de,onDrop:Z,children:o.jsx("div",{className:`h-[90%] rounded-full transition-all duration-200 pointer-events-none ${Te===xe?"w-1 bg-emerald-500 shadow-[0_0_10px_#10b981] opacity-100 scale-y-100":"w-[1px] bg-gray-700/30 opacity-50 scale-y-90"}`})});return o.jsxs("div",{className:`flex h-full w-full overflow-x-scroll custom-scrollbar p-0 gap-0 pb-2 transition-colors ${W?"bg-emerald-900/20":""}`,onWheel:xe=>xe.stopPropagation(),style:{scrollbarGutter:"stable",overscrollBehaviorY:"contain"},onDrop:Z,onDragOver:ze,onDragLeave:()=>O(!1),children:[o.jsx("style",{children:".custom-scrollbar::-webkit-scrollbar { height: 8px; width: 8px; } .custom-scrollbar::-webkit-scrollbar-track { background: rgba(31, 41, 45, 0.5); border-radius: 4px; margin: 0 4px; } .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(75, 85, 99, 0.5); border-radius: 4px; } .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #6b7280; }"}),o.jsx(jA,{isOpen:U,onClose:()=>z(!1),onApply:xe=>j(G,xe),imageSrc:L}),o.jsx("input",{ref:H,type:"file",accept:"image/*",className:"hidden",onChange:nt}),B.map((xe,he)=>{const Ge=`${P}-${he}`,me=X.has((xe.index||"").trim());return o.jsxs(_t.Fragment,{children:[o.jsx(at,{index:he}),o.jsx(QA,{char:xe,index:he,nodeId:P,isDragging:ye===he,isDuplicate:me,t:a,onUpdate:Oe=>Y(he,Oe),onRemove:()=>Q(he),onSetOutput:()=>K(he),onDragStart:Oe=>V(Oe,he),onGenerateImage:()=>T(P,he),isGeneratingImage:E===`${P}-${he}`,onSyncFromConnection:()=>{},onCopyImageToClipboard:h,onDetach:()=>f(xe,{id:P}),onSaveCharacter:()=>$e(xe,he),onLoadCharacter:()=>r(P),onSaveToCatalog:()=>s(P),onCopyCard:()=>Pe(he),onPasteToCard:()=>je(he),onOpenInEditor:()=>{},onOpenInRasterEditor:()=>{let Oe=xe.image;c&&(Oe=c(P,he*10+(Go[xe.selectedRatio]||1))||xe.image),Oe&&(D(Oe),q(he),z(!0))},onRatioChange:Oe=>fe(he,Oe),onCrop1x1:()=>{},onRatioExpand:Oe=>{},onPasteImageToSlot:()=>ke(he),onClearImage:()=>Y(he,{thumbnails:{...xe.thumbnails,[xe.selectedRatio]:null},image:null,imageSources:{...xe.imageSources,[xe.selectedRatio]:null}}),onViewImage:()=>{if(d){const Oe=Go[xe.selectedRatio]||1,De=(c?c(P,he*10+Oe):null)||xe.thumbnails[xe.selectedRatio]||xe.image;De&&d({sources:[{src:De.startsWith("data:")?De:`data:image/png;base64,${De}`,frameNumber:0,prompt:xe.name}],initialIndex:0})}},onUploadImage:()=>{var Oe;te(he),(Oe=H.current)==null||Oe.click()},onImageDrop:Oe=>{var Qe;const De=Oe.dataTransfer.getData("application/prompt-modifier-drag-image");De&&j(he,De);const Ce=(Qe=Oe.dataTransfer.files)==null?void 0:Qe[0];if(Ce!=null&&Ce.type.startsWith("image/")){const pe=new FileReader;pe.onload=Se=>{var Ee;return j(he,(Ee=Se.target)==null?void 0:Ee.result)},pe.readAsDataURL(Ce)}},transformingRatio:J,deselectAllNodes:i,isModifying:C===Ge,isUpdatingDescription:y===Ge,onModifyRequest:Oe=>v(P,he,Oe),onUpdateDescriptionRequest:()=>_(P,he),secondaryLanguage:ce})]},xe.id)}),o.jsx(at,{index:B.length})]})},Yn=({options:e,value:t,onChange:n,disabled:r,id:a,title:i,placeholder:s})=>{const[l,c]=x.useState(!1),[d,h]=x.useState(!1),[g,m]=x.useState(!1),[_,y]=x.useState(-1),[v,C]=x.useState({top:0,left:0,minWidth:0,maxHeight:300}),w=x.useRef(null),b=x.useRef(null),f=x.useRef([]),T=e.find(A=>A.value===t),I=T?T.label:s||t;x.useEffect(()=>{if(l)h(!0),requestAnimationFrame(()=>m(!0));else{m(!1);const A=setTimeout(()=>h(!1),200);return()=>clearTimeout(A)}},[l]);const E=()=>{if(w.current){const A=w.current.getBoundingClientRect(),P=window.innerHeight-A.bottom-10,M=A.top-10,H=e.length*36+10;let W=0,O=0;P>=H||P>M?(W=A.bottom+window.scrollY+4,O=Math.min(H,P)):(W=A.top+window.scrollY-Math.min(H,M)-4,O=Math.min(H,M)),C({top:W,left:A.left+window.scrollX,minWidth:A.width,maxHeight:O})}};x.useEffect(()=>{const A=P=>{w.current&&!w.current.contains(P.target)&&b.current&&!b.current.contains(P.target)&&c(!1)},k=P=>{if(P.type==="resize"){l&&c(!1);return}b.current&&P.target instanceof Node&&b.current.contains(P.target)||l&&c(!1)};return l&&(E(),document.addEventListener("mousedown",A,!0),window.addEventListener("scroll",k,!0),window.addEventListener("resize",k)),()=>{document.removeEventListener("mousedown",A,!0),window.removeEventListener("scroll",k,!0),window.removeEventListener("resize",k)}},[l]),x.useEffect(()=>{if(l){const A=e.findIndex(k=>k.value===t);y(A>-1?A:0)}},[l,e,t]);const R=A=>{var k,P;switch(A.key){case"ArrowDown":if(A.preventDefault(),!l)c(!0);else{const M=Math.min(_+1,e.length-1);y(M),(k=f.current[M])==null||k.scrollIntoView({block:"nearest"})}break;case"ArrowUp":if(A.preventDefault(),l){const M=Math.max(_-1,0);y(M),(P=f.current[M])==null||P.scrollIntoView({block:"nearest"})}break;case"Enter":case" ":A.preventDefault(),l&&_!==-1?(n(e[_].value),c(!1)):c(!l);break;case"Escape":c(!1);break;case"Tab":c(!1);break}},N=A=>{n(A),c(!1)};return o.jsxs(o.Fragment,{children:[o.jsxs("button",{ref:w,id:a,disabled:r,onClick:()=>!r&&c(!l),onKeyDown:R,type:"button",title:i,"aria-haspopup":"listbox","aria-expanded":l,className:"w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-1 focus:ring-emerald-500 disabled:opacity-50 disabled:cursor-not-allowed flex justify-between items-center text-left group h-9 text-sm transition-colors hover:border-gray-500",children:[o.jsxs("span",{className:"truncate flex items-center gap-2",children:[(T==null?void 0:T.icon)&&o.jsx("span",{className:"text-gray-400",children:T.icon}),o.jsx("span",{className:T?"":"text-gray-400",children:I})]}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 text-gray-400 transition-transform duration-200 flex-shrink-0 ml-1 ${l?"transform rotate-180":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),d&&Ji.createPortal(o.jsx("ul",{ref:b,role:"listbox",className:`fixed z-[9999] bg-gray-800 border border-gray-600 rounded-md shadow-2xl focus:outline-none overflow-y-auto custom-scrollbar py-1 transition-[opacity,transform] duration-200 ease-out origin-top ${g?"opacity-100 scale-100":"opacity-0 scale-95"}`,style:{top:v.top,left:v.left,minWidth:v.minWidth,width:"max-content",maxWidth:"90vw",maxHeight:`${v.maxHeight}px`},onWheel:A=>A.stopPropagation(),children:e.map((A,k)=>o.jsxs("li",{ref:P=>{f.current[k]=P},tabIndex:-1,role:"option","aria-selected":t===A.value,onClick:()=>N(A.value),className:`px-3 py-2 text-sm cursor-pointer select-none transition-colors flex items-center gap-2 group whitespace-nowrap ${_===k||t===A.value?"bg-emerald-600 text-white":"text-gray-200 hover:bg-gray-700"} ${t===A.value?"font-semibold":""}`,onMouseEnter:()=>y(k),children:[A.icon&&o.jsx("span",{className:`${_===k||t===A.value?"text-white":"text-gray-400 group-hover:text-gray-200"}`,children:A.icon}),o.jsx("span",{children:A.label})]},A.value))}),document.body)]})},t5=[{code:"ru",label:"RU"},{code:"en",label:"EN"},{code:"es",label:"ES"},{code:"de",label:"DE"},{code:"fr",label:"FR"},{code:"it",label:"IT"},{code:"pt",label:"PT"},{code:"zh",label:"ZH"},{code:"ja",label:"JA"},{code:"ko",label:"KO"}],n5=({fullDescription:e,onDescriptionChange:t,t:n,onFocus:r})=>{const[a,i]=x.useState({});x.useEffect(()=>{const l={Appearance:"",Personality:"",Clothing:""},c={:"Appearance",:"Personality",:"Personality",:"Clothing",appearance:"Appearance",personality:"Personality",clothing:"Clothing"},d=/####\s*(Appearance|Personality|Clothing||||)\s*([\s\S]*?)(?=####|$)/gi;let h,g=!1;for(;(h=d.exec(e))!==null;){g=!0;const m=h[1].trim().toLowerCase(),_=c[m],y=h[2].trim();_&&(l[_]=y)}!g&&e.trim()&&(l.Appearance=e.trim()),i(l)},[e]);const s=(l,c)=>{const d={...a,[l]:c};i(d);const h=`#### Appearance
${d.Appearance||""}

#### Personality
${d.Personality||""}

#### Clothing
${d.Clothing||""}`;t(h)};return o.jsx("div",{className:"space-y-2 text-sm",children:["Appearance","Personality","Clothing"].map(l=>o.jsxs("div",{children:[o.jsx("h5",{className:"font-semibold text-gray-400 text-xs uppercase tracking-wider",children:n(`node.content.${l.toLowerCase()}`)||l}),o.jsx("textarea",{value:a[l]||"",onChange:c=>s(l,c.target.value),className:"w-full text-sm p-2 bg-gray-800 border border-transparent rounded-md resize-y min-h-[60px] focus:outline-none focus:border-emerald-500 focus:ring-0 custom-scrollbar overflow-y-scroll",onWheel:c=>c.stopPropagation(),onFocus:r})]},l))})},o5=({node:e,onValueChange:t,onGenerateCharacters:n,isGeneratingCharacters:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l,connectedInputs:c,clearSelectionsSignal:d,onGenerateCharacterImage:h,isGeneratingCharacterImage:g,onDetachCharacter:m,setImageViewer:_,onCopyImageToClipboard:y})=>{const v=r===e.id,C=c==null?void 0:c.has(void 0),[w,b]=x.useState(new Set),[f,T]=x.useState(new Set);x.useEffect(()=>{d>0&&b(new Set)},[d]);const I=x.useMemo(()=>{try{const $=JSON.parse(e.value||"{}");return{prompt:$.prompt||"",numberOfCharacters:$.numberOfCharacters||1,targetLanguage:$.targetLanguage||"ru",characterType:$.characterType||"simple",style:$.style||"simple",customStyle:$.customStyle||"",characters:Array.isArray($.characters)?$.characters:[],error:$.error||null}}catch{return{prompt:"",numberOfCharacters:1,targetLanguage:"ru",characterType:"simple",style:"simple",customStyle:"",characters:[],error:null}}},[e.value]),{prompt:E,numberOfCharacters:R,targetLanguage:N,characterType:A,style:k,customStyle:P,characters:M,error:H}=I,W=x.useCallback($=>{const ee={...I,...$};t(e.id,JSON.stringify(ee))},[e.id,t,I]),O=x.useMemo(()=>[{value:"simple",label:s("node.content.characterType.simple")},{value:"anthro",label:s("node.content.characterType.anthro")},{value:"chibi",label:s("node.content.characterType.chibi")},{value:"key_item",label:s("node.content.characterType.key_item")}],[s]),U=x.useMemo(()=>[{value:"simple",label:s("node.content.style.simple")},{value:"realistic",label:s("node.content.style.realistic")},{value:"3d_cartoon",label:s("node.content.style.3d_cartoon")},{value:"3d_realistic",label:s("node.content.style.3d_realistic")},{value:"2d_animation",label:s("node.content.style.2d_animation")},{value:"anime",label:s("node.content.style.anime")},{value:"comics",label:s("node.content.style.comics")},{value:"custom",label:s("node.content.style.custom")}],[s]),z=x.useMemo(()=>t5.map($=>({value:$.code,label:$.label})),[]),L=($,ee)=>{$.target.closest("textarea, input, button")||(document.activeElement&&(document.activeElement instanceof HTMLTextAreaElement||document.activeElement instanceof HTMLInputElement)&&document.activeElement.blur(),b(le=>{const J=new Set($.shiftKey?le:[]);return J.has(ee)?J.delete(ee):J.add(ee),J}))},D=$=>{T(ee=>{const Te=new Set(ee);return Te.has($)?Te.delete($):Te.add($),Te})},G=($,ee,Te)=>{const le=M.map(J=>J.id===$?{...J,[ee]:Te}:J);W({characters:le})},q=$=>{W({characters:M.filter(ee=>ee.id!==$)})},ie=$=>{navigator.clipboard.writeText($)},te=$=>{const ee=M.map(Te=>Te.id===$?{...Te,imageBase64:null}:Te);W({characters:ee})},ye=$=>{const ee={};$.imageBase64&&(ee["1:1"]=`data:image/png;base64,${$.imageBase64}`);const Te={type:"character-card",name:$.name,index:$.index||$.alias||"Entity-1",image:$.imageBase64?`data:image/png;base64,${$.imageBase64}`:null,selectedRatio:"1:1",prompt:$.prompt,additionalPrompt:$.additionalPrompt,fullDescription:$.fullDescription,imageSources:ee},le=JSON.stringify(Te,null,2),J=new Blob([le],{type:"application/json"}),ge=URL.createObjectURL(J),ae=document.createElement("a");ae.href=ge,ae.download=`${($.name||"character").replace(/ /g,"_")}.json`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(ge)},ue=()=>{let $=0;const ee=/^New Entity\s*(\d*)$/i;M.forEach(ce=>{const B=(ce.name||"").match(ee);if(B){const X=B[1]?parseInt(B[1],10):1;X>$&&($=X)}});const Te=`New Entity ${$+1}`;let le=0;const J=/^(?:Entity|Character)-(\d+)$/i;M.forEach(ce=>{const B=(ce.index||ce.alias||"").match(J);if(B){const X=parseInt(B[1],10);X>le&&(le=X)}});const ge=`Entity-${le+1}`,ae={id:`char-manual-${Date.now()}`,name:Te,index:ge,fullDescription:"",prompt:"",additionalPrompt:"Full body character concept on a gray background",originalName:Te};W({characters:[...M,ae]})};return o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsxs("div",{className:"flex-shrink-0 space-y-2 mb-2",children:[o.jsx("textarea",{value:E,onChange:$=>W({prompt:$.target.value}),placeholder:s(C?"node.content.connectedPlaceholder":"character_generator.promptPlaceholder"),disabled:C||v,className:"w-full p-2 bg-gray-700 border border-transparent rounded-md resize-y min-h-[80px] focus:border-emerald-500 focus:ring-0 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar overflow-y-scroll",rows:2,onWheel:$=>$.stopPropagation(),onMouseDown:$=>$.stopPropagation(),onFocus:l}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{className:"text-xs text-gray-400 font-medium pl-1",children:s("node.content.characterType")}),o.jsx(Yn,{id:`char-type-select-${e.id}`,value:A,onChange:$=>W({characterType:$}),options:O,disabled:v})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{className:"text-xs text-gray-400 font-medium pl-1",children:s("node.content.style")}),o.jsx(Yn,{id:`char-style-select-${e.id}`,value:k,onChange:$=>W({style:$}),options:U,disabled:v})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{className:"text-xs text-gray-400 font-medium pl-1",children:s("node.content.numberOfCharactersShort")}),o.jsx("div",{className:"relative h-9",children:o.jsx("input",{id:`char-count-${e.id}`,type:"number",min:"1",max:"10",value:R,onChange:$=>W({numberOfCharacters:parseInt($.target.value,10)||1}),className:"w-full h-full pl-3 pr-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm focus:ring-1 focus:ring-emerald-500 focus:outline-none appearance-none",onMouseDown:$=>$.stopPropagation(),onFocus:l})})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{className:"text-xs text-gray-400 font-medium pl-1",children:s("node.content.targetLanguage")}),o.jsx(Yn,{id:`char-lang-select-${e.id}`,value:N,onChange:$=>W({targetLanguage:$}),options:z,disabled:v})]})]}),k==="custom"&&o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{htmlFor:`custom-style-input-${e.id}`,className:"text-xs text-gray-400 font-medium pl-1",children:s("node.content.style.custom")}),o.jsx("textarea",{id:`custom-style-input-${e.id}`,value:P,onChange:$=>W({customStyle:$.target.value}),onMouseDown:$=>$.stopPropagation(),onFocus:l,rows:2,className:"w-full p-2 bg-gray-700 border border-transparent text-white rounded-md text-xs focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar",placeholder:"..."})]}),o.jsx("button",{onClick:v?i:()=>n(e.id),disabled:a||!v&&!C&&!E.trim(),className:`w-full h-10 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 ${a?"bg-yellow-600":v?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed"}`,children:s(a?"node.action.stopping":v?"node.action.stop":"node.content.generateCharacters")})]}),H&&o.jsx("div",{className:"bg-red-900/50 border border-red-700 text-red-200 text-sm p-2 rounded-md mb-2",children:H}),o.jsxs("div",{className:"flex-grow overflow-y-auto overflow-x-hidden space-y-3 pr-1 custom-scrollbar",onWheel:$=>$.stopPropagation(),children:[M.map(($,ee)=>{const Te=w.has($.id),le=f.has($.id),J=g===`${e.id}-${$.id}`;return o.jsxs("div",{className:`bg-gray-700 rounded-lg p-3 space-y-2 border-2 ${Te?"border-emerald-500":"border-transparent"} transition-colors`,onClick:ge=>L(ge,$.id),children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"flex items-center flex-grow min-w-0",children:[o.jsx(Ie,{tooltipPosition:"left",title:s(le?"node.action.expand":"node.action.collapse"),onClick:ge=>{ge.stopPropagation(),D($.id)},children:le?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsx("input",{type:"text",value:$.name,onChange:ge=>G($.id,"name",ge.target.value),className:"font-semibold text-white bg-transparent w-32 focus:bg-gray-800 rounded px-1",onFocus:l,onMouseDown:ge=>ge.stopPropagation()})]}),o.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[o.jsxs("label",{className:"text-xs text-gray-400 whitespace-nowrap",children:[s("node.content.characterIndex"),":"]}),o.jsx("input",{type:"text",value:$.index||$.alias||"",onChange:ge=>G($.id,"index",ge.target.value),className:"font-semibold text-white bg-gray-800 w-24 rounded px-1 text-xs py-0.5 focus:ring-1 focus:ring-emerald-500 focus:outline-none",onFocus:l,onMouseDown:ge=>ge.stopPropagation()}),o.jsx(Ie,{tooltipPosition:"left",title:"Copy All Text",onClick:ge=>{ge.stopPropagation(),ie(`Name: ${$.name}

${$.fullDescription}`)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})}),o.jsx(Ie,{tooltipPosition:"left",title:"Save Character to File",onClick:ge=>{ge.stopPropagation(),ye($)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),o.jsx(Ie,{tooltipPosition:"left",title:"Detach to Character Card Node",onClick:ge=>{ge.stopPropagation(),m($,e)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})}),o.jsx(Ie,{tooltipPosition:"left",title:s("node.action.deleteItem"),onClick:ge=>{ge.stopPropagation(),q($.id)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),!le&&o.jsxs("div",{className:"flex flex-col space-y-3",children:[o.jsxs("div",{className:"flex gap-3",children:[o.jsxs("div",{className:"w-40 flex-shrink-0 space-y-2",children:[o.jsx("div",{className:"relative w-full aspect-square bg-gray-900/50 rounded-md flex items-center justify-center overflow-hidden group",children:J?o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse"}),o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]}):$.imageBase64?o.jsxs(o.Fragment,{children:[o.jsx("img",{src:`data:image/png;base64,${$.imageBase64}`,alt:$.name||"Character",className:"w-full h-full object-contain cursor-pointer transition-transform hover:scale-105",onClick:ge=>{ge.stopPropagation(),_&&_({sources:[{src:`data:image/png;base64,${$.imageBase64}`,frameNumber:0,prompt:$.prompt}],initialIndex:0})}}),o.jsxs("div",{className:"absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 rounded p-0.5",children:[o.jsx("button",{className:"p-1 hover:bg-gray-700 rounded text-gray-200",title:"Copy Image",onClick:ge=>{ge.stopPropagation(),y&&$.imageBase64&&y($.imageBase64)},children:o.jsx(Wo,{className:"w-3 h-3"})}),o.jsx("button",{className:"p-1 hover:bg-red-900/50 rounded text-red-300",title:"Clear Image",onClick:ge=>{ge.stopPropagation(),te($.id)},children:o.jsx(_l,{className:"w-3 h-3"})})]})]}):o.jsxs("div",{className:"text-center text-gray-500 p-2 pointer-events-none",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 mx-auto mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})}),o.jsx("p",{className:"text-xs",children:"No Image"})]})}),o.jsx("button",{onClick:ge=>{ge.stopPropagation(),h(e.id,$.id)},disabled:J||!$.prompt&&!$.additionalPrompt&&$.additionalPrompt!==void 0,className:"w-full px-2 py-1 text-xs font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed",children:J?"...":s("node.content.generateImage")})]}),o.jsxs("div",{className:"flex-grow min-w-0 flex flex-col gap-2",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:s("node.content.imagePrompt")}),o.jsx("div",{className:"flex items-center gap-1",children:o.jsx(Ie,{tooltipPosition:"left",title:s("node.action.copy"),onClick:ge=>{ge.stopPropagation(),ie($.prompt||"")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]}),o.jsx("textarea",{value:$.prompt||"",onChange:ge=>G($.id,"prompt",ge.target.value),className:"w-full text-xs p-2 bg-gray-800 border border-transparent rounded-md resize-y min-h-[80px] focus:outline-none focus:border-emerald-500 focus:ring-0 custom-scrollbar overflow-y-scroll",onWheel:ge=>ge.stopPropagation(),onFocus:l,placeholder:"Main prompt..."})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-tighter block",children:s("node.content.suffix")}),o.jsx("input",{type:"text",value:$.additionalPrompt!==void 0?$.additionalPrompt:"Full body character concept on a gray background",onChange:ge=>G($.id,"additionalPrompt",ge.target.value),className:"w-full p-1.5 bg-gray-800 border border-transparent rounded text-xs text-gray-400 focus:border-emerald-500 outline-none",onMouseDown:ge=>ge.stopPropagation(),onFocus:l})]})]})]}),o.jsxs("div",{className:"border border-gray-700/30 rounded bg-gray-800/20 p-2 mt-2",children:[o.jsx("h5",{className:"font-semibold text-gray-400 text-xs uppercase tracking-wider mb-2 border-b border-gray-700/50 pb-1",children:"Full Character Description"}),o.jsx(n5,{fullDescription:$.fullDescription||"",onDescriptionChange:ge=>G($.id,"fullDescription",ge),t:s,onFocus:l})]})]})]},$.id||ee)}),o.jsx("div",{className:"flex justify-center pt-2 pb-1",children:o.jsxs("button",{onClick:ue,className:"flex items-center gap-1 px-4 py-1.5 bg-gray-800 hover:bg-emerald-700/50 border border-gray-600 hover:border-emerald-500 rounded-full transition-colors text-xs font-bold text-gray-300 hover:text-white",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Manual Entity"]})})]})]})},r5=({node:e,onValueChange:t,onFixErrors:n,isFixingErrors:r,isStopping:a,onStopGeneration:i,connectedInputs:s,t:l,deselectAllNodes:c})=>{const d=s==null?void 0:s.has(void 0),h=r===e.id;return o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsx("textarea",{value:e.value,onChange:g=>t(e.id,g.target.value),placeholder:l(d?"node.content.connectedPlaceholder":"node.content.notePlaceholder"),className:"w-full flex-grow p-2 bg-gray-700 border border-transparent rounded-md resize-none focus:border-emerald-500 focus:ring-0 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 mb-2 custom-scrollbar overflow-y-scroll",onWheel:g=>g.stopPropagation(),onMouseDown:g=>g.stopPropagation(),onFocus:c,disabled:d||h}),o.jsx("button",{onClick:h?i:()=>n(e.id),disabled:a||!h&&!d&&!e.value.trim(),className:`w-full px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 ${a?"bg-yellow-600":h?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed"}`,children:l(a?"node.action.stopping":h?"node.action.stop":"node.content.fixErrors")})]})},a5=({node:e,onValueChange:t,onSendMessage:n,isChatting:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l})=>{const c=r===e.id,d=x.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{messages:[],currentInput:"",mode:"general"}}},[e.value]),{messages:h=[],currentInput:g="",mode:m="general"}=d,_=x.useRef(null);x.useEffect(()=>{_.current&&(_.current.scrollTop=_.current.scrollHeight)},[h]);const y=()=>{c||n(e.id)},v=C=>{t(e.id,JSON.stringify({...d,mode:C}))};return o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsx("div",{className:"bg-gray-800 rounded-md p-1 mb-2 flex-shrink-0",children:o.jsxs("div",{className:"flex space-x-1 w-full",children:[o.jsxs("button",{onClick:()=>v("general"),className:`flex-1 py-2 px-1 rounded transition-colors flex flex-col items-center justify-center gap-1 ${m==="general"?"bg-emerald-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),o.jsx("span",{className:"text-[10px] font-medium leading-none text-center",children:s("chat.mode.general")})]}),o.jsxs("button",{onClick:()=>v("script"),className:`flex-1 py-2 px-1 rounded transition-colors flex flex-col items-center justify-center gap-1 ${m==="script"?"bg-emerald-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),o.jsx("span",{className:"text-[10px] font-medium leading-none text-center",children:s("chat.mode.script")})]}),o.jsxs("button",{onClick:()=>v("prompt"),className:`flex-1 py-2 px-1 rounded transition-colors flex flex-col items-center justify-center gap-1 ${m==="prompt"?"bg-emerald-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),o.jsx("span",{className:"text-[10px] font-medium leading-none text-center",children:s("chat.mode.prompt")})]}),o.jsxs("button",{onClick:()=>v("youtube"),className:`flex-1 py-2 px-1 rounded transition-colors flex flex-col items-center justify-center gap-1 ${m==="youtube"?"bg-emerald-600 text-white":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),o.jsx("span",{className:"text-[10px] font-medium leading-none text-center",children:s("chat.mode.youtube")})]})]})}),o.jsxs("div",{ref:_,onWheel:C=>C.stopPropagation(),className:"flex-grow p-2 bg-gray-900/50 rounded-md overflow-y-auto overflow-x-auto mb-2 space-y-4 select-text custom-scrollbar",children:[h.length===0&&o.jsx("div",{className:"flex h-full items-center justify-center text-gray-500 text-xs italic text-center px-4",children:s(`chat.mode.${m}`)}),h.map((C,w)=>o.jsx("div",{className:`flex ${C.role==="user"?"justify-end":"justify-start"}`,children:o.jsxs("div",{className:`relative group max-w-[80%] p-3 rounded-lg ${C.role==="user"?"bg-emerald-600":"bg-gray-700"}`,children:[o.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:C.content}),C.role==="model"&&o.jsx("div",{className:"absolute -top-2 -right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:o.jsx(Ie,{tooltipPosition:"left",title:s("node.action.copy"),onClick:()=>navigator.clipboard.writeText(C.content),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]})},w)),c&&o.jsx("div",{className:"flex justify-start",children:o.jsx("div",{className:"max-w-[80%] p-3 rounded-lg bg-gray-700",children:o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse"}),o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]})})})]}),o.jsxs("div",{className:"relative w-full",children:[o.jsx("textarea",{value:g,onChange:C=>t(e.id,JSON.stringify({...d,currentInput:C.target.value})),onKeyDown:C=>{C.key==="Enter"&&!C.shiftKey&&(C.preventDefault(),y())},placeholder:s("node.content.chatPlaceholder"),onWheel:C=>C.stopPropagation(),onMouseDown:C=>C.stopPropagation(),className:"w-full p-2 pr-10 bg-gray-700 border border-transparent rounded-md resize-y focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar overflow-y-scroll min-h-[80px]",rows:2,onFocus:l}),o.jsx("button",{onClick:c?i:y,disabled:a||!c&&!g.trim(),className:`absolute right-2 bottom-2 p-1.5 rounded-md transition-colors duration-200 flex items-center justify-center ${a?"bg-yellow-600 text-white":c?"bg-red-600 hover:bg-red-700 text-white":"bg-emerald-600 hover:bg-emerald-700 text-white disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed"}`,title:a?"Stopping":c?"Stop":"Send",children:a?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 animate-pulse",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("rect",{x:"6",y:"6",width:"8",height:"8"})}):c?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})})]})]})},i5=({node:e,onValueChange:t,onGenerateImage:n,isGeneratingImage:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l,connectedInputs:c})=>{const d=r===e.id,h=c==null?void 0:c.has(void 0),g=x.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{prompt:"",imageBase64:""}}},[e.value]),{prompt:m,imageBase64:_}=g,y=v=>{const C={...g,...v};t(e.id,JSON.stringify(C))};return o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsx("textarea",{value:m,onChange:v=>y({prompt:v.target.value}),placeholder:s(h?"node.content.connectedPlaceholder":"node.content.imagePromptPlaceholder"),disabled:h||d,className:"w-full p-2 bg-gray-700 border border-transparent rounded-md resize-none focus:border-emerald-500 focus:ring-0 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar overflow-y-scroll",rows:4,onWheel:v=>v.stopPropagation(),onMouseDown:v=>v.stopPropagation(),onFocus:l}),o.jsx("button",{onClick:d?i:()=>n(e.id),disabled:a||!d&&!h&&!m.trim(),className:`w-full px-4 py-2 mt-2 font-bold text-white rounded-md transition-colors duration-200 ${a?"bg-yellow-600":d?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed"}`,children:s(a?"node.action.stopping":d?"node.action.stop":"node.content.generateImage")}),o.jsx("div",{className:"flex-grow mt-2 bg-gray-900/50 rounded-md flex items-center justify-center overflow-hidden",children:d?o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full animate-pulse"}),o.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"150ms"}}),o.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"300ms"}})]}):_?o.jsx("img",{src:`data:image/png;base64,${_}`,alt:"Generated",className:"w-full h-full object-contain"}):o.jsxs("div",{className:"text-center text-gray-500 p-4",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),o.jsx("p",{className:"text-sm",children:s("node.content.imagePromptPlaceholder")})]})})]})},s5=({node:e,onValueChange:t,t:n,onExtractTextFromImage:r,isExtractingText:a,addToast:i,deselectAllNodes:s,setImageViewer:l})=>{const[c,d]=x.useState(!1),h=a,g=x.useMemo(()=>{try{return JSON.parse(e.value||"{}")}catch{return{imageBase64:null,extractedText:""}}},[e.value]),{imageBase64:m,extractedText:_}=g,y=R=>{t(e.id,JSON.stringify({...g,...R}))},v=R=>{R.preventDefault(),R.stopPropagation(),d(!0)},C=R=>{R.preventDefault(),R.stopPropagation(),d(!1)},w=R=>{var A;R.preventDefault(),R.stopPropagation(),d(!1);const N=(A=R.dataTransfer.files)==null?void 0:A[0];if(N&&N.type.startsWith("image/")){const k=new FileReader;k.onload=P=>{var H;const M=(H=P.target)==null?void 0:H.result;if(M){const W=M.split(",")[1];y({imageBase64:W})}},k.readAsDataURL(N)}},b=()=>{r&&r(e.id)},f=()=>{_&&(navigator.clipboard.writeText(_),i(n("toast.copied"),"success"))},T=async()=>{if(m)try{const N=await(await fetch(`data:image/png;base64,${m}`)).blob();await navigator.clipboard.write([new ClipboardItem({[N.type]:N})]),i(n("toast.copied"),"success")}catch(R){console.error("Failed to copy image:",R),i("Failed to copy image","info")}},I=R=>{m&&l&&(R.stopPropagation(),l({sources:[{src:`data:image/png;base64,${m}`,frameNumber:0,prompt:e.title}],initialIndex:0}))},E=R=>{(R.ctrlKey||R.metaKey)&&R.key==="c"&&m&&(R.preventDefault(),R.stopPropagation(),T())};return o.jsxs("div",{tabIndex:0,onKeyDown:E,onDragOver:v,onDragLeave:C,onDrop:w,className:`flex flex-col h-full rounded-md transition-all duration-200 outline-none ${c?"ring-2 ring-emerald-400":"focus:ring-1 focus:ring-emerald-500/50"}`,children:[o.jsx("div",{className:"relative flex-grow bg-gray-900/50 rounded-md flex items-center justify-center overflow-hidden mb-2 group cursor-pointer",onClick:I,children:m?o.jsxs(o.Fragment,{children:[o.jsx("img",{src:`data:image/png;base64,${m}`,alt:"Preview",className:"w-full h-full object-contain pointer-events-none"}),o.jsxs("div",{className:"absolute top-2 right-2 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[o.jsx("button",{onClick:R=>{R.stopPropagation(),T()},className:"p-1.5 bg-gray-800/80 rounded-full text-white hover:bg-emerald-600 transition-colors backdrop-blur-sm",title:n("node.action.copy"),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),o.jsx("button",{onClick:R=>{R.stopPropagation(),y({imageBase64:null,extractedText:""})},className:"p-1.5 bg-gray-800/80 rounded-full text-white hover:bg-red-600 transition-colors backdrop-blur-sm",title:n("node.action.clear"),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}):o.jsxs("div",{className:"text-center text-gray-500 p-4 pointer-events-none",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),o.jsx("p",{className:"text-sm",children:"Drag & drop image here"})]})}),o.jsx("button",{onClick:b,disabled:h||!m,className:"w-full px-4 py-2 mb-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-500 disabled:cursor-not-allowed transition-colors flex-shrink-0",children:n(h?"node.content.extracting":"node.content.imageToText")}),_&&o.jsxs("div",{className:"flex flex-col flex-shrink-0 h-32",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:n("node.content.extractedText")}),o.jsx(Ie,{title:n("node.action.copy"),onClick:f,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{readOnly:!0,value:_,className:"w-full flex-grow p-2 bg-gray-700 border-none rounded-md resize-none focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar overflow-y-scroll",onWheel:R=>R.stopPropagation(),onFocus:s})]})]})},l5=({node:e,onValueChange:t,t:n,deselectAllNodes:r})=>o.jsx("textarea",{value:e.value,onChange:a=>t(e.id,a.target.value),placeholder:n("node.content.notePlaceholder"),className:"w-full h-full p-2 bg-transparent border border-transparent rounded-md resize-none focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar overflow-y-scroll",onWheel:a=>a.stopPropagation(),onMouseDown:a=>a.stopPropagation(),onFocus:r}),c5=({node:e,onValueChange:t,onAnalyze:n,isAnalyzing:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l})=>{const c=x.useMemo(()=>{try{const f=JSON.parse(e.value||"{}");return Array.isArray(f.characters)||(f.characters=[]),{environment:f.environment||"",characters:f.characters||[],action:f.action||"",style:f.style||"",targetLanguage:f.targetLanguage||"ru"}}catch{return{environment:"",characters:[],action:"",style:"",targetLanguage:"ru"}}},[e.value]),{environment:d,characters:h,action:g,style:m,targetLanguage:_}=c,y=Math.max(1,h.length),v=f=>{const T={...c,...f};t(e.id,JSON.stringify(T))},C=(f,T)=>{const I=[...h||[]];I[f]=T,v({characters:I})},w=(f,T)=>{v({[f]:T})},b=[{key:"environment",value:d,handler:f=>w("environment",f),placeholder:"node.content.environmentPlaceholder"},...Array.from({length:y}).map((f,T)=>({key:`character-${T}`,value:h[T]||"",handler:I=>C(T,I),placeholder:"node.content.characterPlaceholder"})),{key:"action",value:g,handler:f=>w("action",f),placeholder:"node.content.actionPlaceholder"},{key:"style",value:m,handler:f=>w("style",f),placeholder:"node.content.stylePlaceholder"}];return o.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[o.jsx("div",{className:"flex-grow flex flex-col space-y-2 min-h-0",onWheel:f=>f.stopPropagation(),children:b.map(f=>o.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400 mb-1",children:f.key.startsWith("character-")?`${s("node.content.character")} ${parseInt(f.key.split("-")[1],10)+1}`:s(`node.content.${f.key}`)}),o.jsx("textarea",{value:f.value,onChange:T=>f.handler(T.target.value),placeholder:s(f.placeholder),className:"w-full flex-grow p-2 bg-gray-700 border border-transparent rounded-md resize-y focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar overflow-y-scroll",onMouseDown:T=>T.stopPropagation(),onFocus:l})]},f.key))}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:r?i:()=>n(e.id),disabled:a,className:`flex-grow px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 flex-shrink-0 ${a?"bg-yellow-600":r?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500"}`,children:s(a?"node.action.stopping":r?"node.action.stop":"node.content.analyzePrompt")}),o.jsxs("div",{className:"flex items-center bg-gray-700 rounded-md p-1 space-x-1",children:[o.jsx("button",{onClick:()=>v({targetLanguage:"ru"}),className:`px-2 py-1 rounded text-xs font-semibold transition-colors w-10 ${_==="ru"?"bg-emerald-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:"RU"}),o.jsx("button",{onClick:()=>v({targetLanguage:"en"}),className:`px-2 py-1 rounded text-xs font-semibold transition-colors w-10 ${_==="en"?"bg-emerald-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:"EN"})]})]})]})},d5=({node:e,onEnhance:t,isEnhancing:n,onProcessChainForward:r,isExecutingChain:a,isStopping:i,onStopGeneration:s,t:l,deselectAllNodes:c})=>o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsx("textarea",{readOnly:!0,value:e.value,placeholder:l("node.content.enhancedPromptHere"),className:"w-full flex-grow p-2 bg-gray-700 border border-transparent rounded-md resize-none focus:outline-none mb-2 custom-scrollbar overflow-y-scroll",onWheel:d=>d.stopPropagation(),onMouseDown:d=>d.stopPropagation(),onFocus:c}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:n?s:()=>t(e.id),disabled:a||i,className:`w-1/2 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 ${i&&n?"bg-yellow-600":n?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500"}`,children:l(i&&n?"node.action.stopping":n?"node.action.stop":"node.content.enhancePrompt")}),o.jsxs("button",{onClick:a?s:()=>r(e.id),disabled:n||i,className:`w-1/2 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 flex items-center justify-center space-x-2 ${i&&a?"bg-yellow-600":a?"bg-red-600 hover:bg-red-700":"bg-cyan-600 hover:bg-cyan-700 disabled:bg-gray-500"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 5l7 7m0 0l-7 7m7-7H3"})}),o.jsx("span",{children:l(i&&a?"node.action.stopping":a?"node.action.stop":"node.action.processChainForward")})]})]})]}),u5=()=>null,kt=x.forwardRef(({id:e,label:t,originalText:n,translatedText:r,isCritical:a,isEnabled:i=!0,isMandatory:s=!1,onToggle:l,color:c="emerald",className:d="",index:h,isHighlighted:g},m)=>{const[_,y]=x.useState(!1);let v="",C="",w="",b="",f="",T="";if(!i)v="bg-gray-800/20",C="border-gray-700",w="text-gray-500",b="bg-gray-700",f="text-gray-500",T="bg-gray-800 text-gray-600";else if(a)v="bg-red-900/20",C="border-red-800/50",w="text-red-400",b="bg-red-500",f="text-gray-300",T="bg-red-900/50 text-red-200";else if(s)v="bg-gray-800",C="border-gray-600",w="text-emerald-400",b="bg-gray-500",f="text-gray-300",T="bg-gray-700 text-gray-400";else switch(f="text-gray-300",c){case"cyan":v="bg-cyan-900/20",C="border-cyan-700/50",w="text-cyan-400",b="bg-cyan-500",T="bg-cyan-900/50 text-cyan-200";break;default:v="bg-emerald-900/20",C="border-emerald-700/50",w="text-emerald-400",b="bg-emerald-500",T="bg-emerald-900/50 text-emerald-200"}g&&(C="border-yellow-400 ring-1 ring-yellow-400/50",v="bg-yellow-900/30");const I=E=>{E.stopPropagation(),navigator.clipboard.writeText(n),y(!0),setTimeout(()=>y(!1),1500)};return o.jsxs("div",{ref:m,onMouseDown:E=>E.stopPropagation(),onClick:()=>!s&&l&&l(e),className:`flex flex-row p-2 rounded border text-xs transition-all relative overflow-hidden group select-none items-stretch gap-3 ${v} ${C} ${d} flex-shrink-0 ${s?"":"cursor-pointer hover:border-opacity-100 hover:shadow-sm"} duration-300`,children:[h!==void 0&&o.jsxs("div",{className:"flex-shrink-0 w-6 flex flex-col items-center justify-start pt-0.5",children:[o.jsx("div",{className:`text-[9px] font-mono font-bold w-5 h-5 flex items-center justify-center rounded-full ${T}`,children:h}),o.jsx("div",{className:`w-px flex-grow mt-1 ${i?"bg-gray-700":"bg-transparent"}`})]}),o.jsxs("div",{className:"flex flex-col flex-grow min-w-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1 flex-shrink-0",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[h===void 0&&o.jsx("div",{className:`w-1.5 h-1.5 rounded-full flex-shrink-0 ${b} shadow-[0_0_5px_rgba(0,0,0,0.5)]`}),o.jsx("div",{className:`font-bold uppercase tracking-wider text-[10px] leading-tight ${w}`,children:t})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:I,className:`p-0.5 rounded transition-colors ${i?"text-gray-500 hover:text-white":"text-gray-600 hover:text-gray-400"}`,title:"Copy Prompt Text",children:_?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),!s&&o.jsx("div",{className:`text-[9px] uppercase font-mono px-1 rounded ${i?"text-white bg-white/10":"text-gray-600 bg-black/20"}`,children:i?"ON":"OFF"})]})]}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("div",{className:`leading-tight ${i?"text-gray-400":"text-gray-600"} text-[10px] mb-1`,children:n}),r&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-gray-600/30 my-1 w-full"}),o.jsx("div",{className:`leading-tight italic ${f}`,children:r})]})]})]}),o.jsx("div",{className:`absolute bottom-0 left-0 w-full h-[2px] opacity-30 ${b}`})]})});_t.memo(({id:e,onClick:t,t:n})=>o.jsx(lt,{title:n("node.action.locateInStack"),position:"left",children:o.jsx("button",{onClick:r=>{r.stopPropagation(),t(r,e)},className:"ml-auto p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}));const p5=_t.memo(({uiState:e,onUpdateUiState:t,onUpdateValue:n,hierarchyEnabled:r,mandatoryBgEnabled:a,statePersistenceEnabled:i,livingWorldEnabled:s,extendedAnalysis:l,microActionBreakdown:c,batchProcessing:d,professionalStoryboard:h,cinematographyEnabled:g,safeGeneration:m=!1,thinkingEnabled:_=!1,shotFilter:y="all",anthroEnabled:v=!1,subscribeEnhancement:C=!1,anatomicalStrictness:w=!0,propConsistency:b=!0,t:f,initialHeight:T,onHeightChange:I,scale:E,model:R,targetLanguage:N,minFrames:A,maxFrames:k,framesPerScene:P,targetScrollId:M,onSetTargetScrollId:H})=>{const[W,O]=x.useState(!1),[U,z]=x.useState(""),L=x.useRef({}),D=x.useRef(null),[G,q]=x.useState(T||380);x.useEffect(()=>{Math.abs(T-G)>1&&q(T||380)},[T]),x.useEffect(()=>{if(M){z(""),setTimeout(()=>{if(L.current[M]&&!e.isSettingsCollapsed){const fe=L.current[M],Pe=D.current;if(fe&&Pe){const je=fe.offsetTop,ke=Math.max(0,je-Pe.clientHeight/2+fe.clientHeight/2);Pe.scrollTo({top:ke,behavior:"smooth"})}}},50);const j=setTimeout(()=>{H(null)},2e3);return()=>clearTimeout(j)}},[M,e.isSettingsCollapsed,H]);const ie=j=>{j.preventDefault(),j.stopPropagation();const fe=j.clientY,Pe=G;let je=Pe;const ke=ze=>{ze.preventDefault(),ze.stopPropagation();const nt=(ze.clientY-fe)/E;je=Math.max(100,Math.min(800,Pe+nt)),q(je)},$e=ze=>{ze.preventDefault(),ze.stopPropagation(),window.removeEventListener("mousemove",ke),window.removeEventListener("mouseup",$e),I(je)};window.addEventListener("mousemove",ke),window.addEventListener("mouseup",$e)},te=j=>{j.stopPropagation(),n({hierarchyEnabled:!0,mandatoryBgEnabled:!0,statePersistenceEnabled:!0,livingWorldEnabled:!0,extendedAnalysis:!1,microActionBreakdown:!1,batchProcessing:!0,professionalStoryboard:!0,cinematographyEnabled:!0,safeGeneration:!1,thinkingEnabled:!1,shotFilter:"all",anthroEnabled:!1,subscribeEnhancement:!1,anatomicalStrictness:!0,propConsistency:!0,minFrames:null,maxFrames:null})},ye=j=>j==="gemini-3-flash-preview"?"Gemini 3 Flash Preview":j==="gemini-3-pro-preview"?"Gemini 3 Pro Preview":j,ue=y==="wideOnly",$=ue?we.STORYBOARD_RULES_WIDE.id:we.STORYBOARD_RULES.id,ee=ue?we.STORYBOARD_RULES_WIDE.text:we.STORYBOARD_RULES.text,Te=ue?"instruction.desc.storyboard_rules_wide":"instruction.desc.storyboard_rules",le=ue?we.CINEMATOGRAPHY_WIDE.id:we.CINEMATOGRAPHY.id,J=ue?we.CINEMATOGRAPHY_WIDE.text:we.CINEMATOGRAPHY.text,ge=ue?"instruction.desc.ana_cinema_wide":"instruction.desc.ana_cinema",ae=ue?we.TECHNICAL_DIRECTIVES_WIDE.id:we.TECHNICAL_DIRECTIVES.id,ce=ue?we.TECHNICAL_DIRECTIVES_WIDE.text:we.TECHNICAL_DIRECTIVES.text,B=ue?"instruction.desc.tech_directives_wide":"instruction.desc.tech_directives",X=ue?we.EXTENDED_VISUALS_WIDE.id:we.EXTENDED_VISUALS.id,F=ue?we.EXTENDED_VISUALS_WIDE.text:we.EXTENDED_VISUALS.text,Y=ue?"instruction.desc.extended_visuals_wide":"instruction.desc.extended_visuals",K=f(ue?"instruction.extended_visuals_wide":"node.content.extendedAnalysis"),V=ue?"rule_mandatory_bg_wide":we.MANDATORY_BG.id,oe=ue?we.MANDATORY_BG_WIDE.text:we.MANDATORY_BG.text,de=ue?"instruction.desc.rule_mandatory_bg_wide":"instruction.desc.rule_mandatory_bg";let Z=0;const Q=(j,fe)=>{if(!U)return!0;const Pe=U.toLowerCase();return j.toLowerCase().includes(Pe)||fe.toLowerCase().includes(Pe)};return o.jsxs("div",{className:`border ${W?"border-emerald-500":"border-gray-600"} hover:border-gray-400 rounded-md bg-gray-900 overflow-hidden mb-2 flex-shrink-0 flex flex-col relative transition-colors duration-200`,style:{height:e.isSettingsCollapsed?"auto":`${G}px`},children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>t({isSettingsCollapsed:!e.isSettingsCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-1.533 2.16-1.535.113-1.535 2.322 0 2.435 1.594.118 2.073 1.274 1.533 2.16-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.948c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.948c1.372.836 2.942-.734 2.106-2.106-.54-.886-.061-2.042 1.533-2.16 1.535-.113 1.535-2.322 0-2.435-1.594-.118-2.073-1.274-1.533-2.16.836-1.372-.734-2.942-2.106-2.106a1.533 1.533 0 01-2.287-.948zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})}),o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:f("node.content.activePromptStack")})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ie,{title:f("toolbar.resetToDefault"),onClick:te,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Ie,{title:e.isSettingsCollapsed?f("node.action.expand"):f("node.action.collapse"),onClick:j=>{j.stopPropagation(),t({isSettingsCollapsed:!e.isSettingsCollapsed})},children:e.isSettingsCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!e.isSettingsCollapsed&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"p-2 border-b border-gray-700 bg-gray-800/80 sticky top-0 z-10 flex items-center gap-2",children:o.jsxs("div",{className:"relative w-full",children:[o.jsx("input",{type:"text",value:U,onChange:j=>z(j.target.value),placeholder:f("node.content.findStack"),className:"w-full pl-7 pr-2 py-1 text-xs bg-gray-900/80 border border-gray-600 rounded-md focus:outline-none focus:border-emerald-500 text-gray-300 placeholder-gray-600"}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 absolute left-2 top-1/2 -translate-y-1/2 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),U&&o.jsx("button",{onClick:()=>z(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white",children:""})]})}),o.jsxs("div",{ref:D,className:"p-2 bg-gray-800/20 flex flex-col gap-1 overflow-y-auto custom-scrollbar flex-grow pb-4 relative",onWheel:j=>j.stopPropagation(),children:[Q(ye(R),f("node.content.model"))&&o.jsx(kt,{id:"model-brick",label:f("node.content.model"),originalText:ye(R),isMandatory:!0,color:"gray",className:"mb-2"}),Q(we.INPUTS.text,f(`instruction.${we.INPUTS.id}`))&&o.jsx(kt,{ref:j=>{L.current[we.INPUTS.id]=j},id:we.INPUTS.id,index:++Z,label:f(`instruction.${we.INPUTS.id}`),originalText:we.INPUTS.text,translatedText:f(`instruction.desc.${we.INPUTS.id}`),isMandatory:!0,color:"gray",isHighlighted:M===we.INPUTS.id}),Q(Bn(N),f("node.content.targetLanguage"))&&o.jsx(kt,{id:"target-lang-brick",index:++Z,label:f("node.content.targetLanguage"),originalText:Bn(N),translatedText:f("instruction.desc.target_lang"),isMandatory:!0,color:"gray"}),Q("Enable extended reasoning",f("node.content.thinkingEnabled"))&&o.jsx(kt,{ref:j=>{L.current.thinking_mode=j},id:"thinking_mode",index:_?++Z:void 0,label:f("node.content.thinkingEnabled"),originalText:"Enable extended reasoning for deeper plot coherence.",translatedText:"     .",isEnabled:_,onToggle:()=>n({thinkingEnabled:!_}),color:"cyan",isHighlighted:M==="thinking_mode"}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:f("node.content.stack.system")}),Q(Qo.text,f("node.content.safeGeneration"))&&o.jsx(kt,{ref:j=>{L.current.safe_gen=j},id:"safe_gen",index:m?++Z:void 0,label:f("node.content.safeGeneration"),originalText:Qo.text,translatedText:f("instruction.desc.safe_gen"),isCritical:!0,isEnabled:m,onToggle:()=>n({safeGeneration:!m}),isHighlighted:M==="safe_gen"}),Q(we.BATCH_PROCESSING.text,f("instruction.batch_processing"))&&o.jsx(kt,{ref:j=>{L.current[we.BATCH_PROCESSING.id]=j},id:we.BATCH_PROCESSING.id,index:d?++Z:void 0,label:f("instruction.batch_processing"),originalText:we.BATCH_PROCESSING.text,translatedText:f("instruction.desc.batch_processing"),isEnabled:d,onToggle:()=>n({batchProcessing:!d}),color:"emerald",isHighlighted:M===we.BATCH_PROCESSING.id})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:f("node.content.stack.role")}),Q(we.ROLE.text,f("instruction.ana_role"))&&o.jsx(kt,{ref:j=>{L.current[we.ROLE.id]=j},id:we.ROLE.id,index:++Z,label:f("instruction.ana_role"),originalText:we.ROLE.text,translatedText:f("instruction.desc.ana_role"),isMandatory:!0,color:"emerald",isHighlighted:M===we.ROLE.id}),Q(we.STATIC_FRAME_LOGIC.text,we.STATIC_FRAME_LOGIC.label)&&o.jsx(kt,{ref:j=>{L.current[we.STATIC_FRAME_LOGIC.id]=j},id:we.STATIC_FRAME_LOGIC.id,index:++Z,label:f("instruction.static_frame_logic"),originalText:we.STATIC_FRAME_LOGIC.text,translatedText:f("instruction.desc.static_frame_logic"),isMandatory:!0,isCritical:!0,isHighlighted:M===we.STATIC_FRAME_LOGIC.id}),Q(we.ANATOMICAL_POSING.text,we.ANATOMICAL_POSING.label)&&o.jsx(kt,{ref:j=>{L.current[we.ANATOMICAL_POSING.id]=j},id:we.ANATOMICAL_POSING.id,index:++Z,label:f("instruction.anatomical_posing"),originalText:we.ANATOMICAL_POSING.text,translatedText:f("instruction.desc.anatomical_posing"),isMandatory:!0,isCritical:!0,isHighlighted:M===we.ANATOMICAL_POSING.id}),Q(we.ANATOMICAL_STRICTNESS.text,we.ANATOMICAL_STRICTNESS.label)&&o.jsx(kt,{ref:j=>{L.current[we.ANATOMICAL_STRICTNESS.id]=j},id:we.ANATOMICAL_STRICTNESS.id,index:++Z,label:f("instruction.anatomical_strictness"),originalText:we.ANATOMICAL_STRICTNESS.text,translatedText:f("instruction.desc.anatomical_strictness"),isEnabled:w,onToggle:()=>n({anatomicalStrictness:!w}),color:"emerald",isCritical:!0,isHighlighted:M===we.ANATOMICAL_STRICTNESS.id}),Q(we.PROP_CONSISTENCY.text,we.PROP_CONSISTENCY.label)&&o.jsx(kt,{ref:j=>{L.current[we.PROP_CONSISTENCY.id]=j},id:we.PROP_CONSISTENCY.id,index:++Z,label:f("instruction.prop_consistency"),originalText:we.PROP_CONSISTENCY.text,translatedText:f("instruction.desc.prop_consistency"),isEnabled:b,onToggle:()=>n({propConsistency:!b}),color:"emerald",isHighlighted:M===we.PROP_CONSISTENCY.id}),Q(we.MOTION_DYNAMICS.text,we.MOTION_DYNAMICS.label)&&o.jsx(kt,{ref:j=>{L.current[we.MOTION_DYNAMICS.id]=j},id:we.MOTION_DYNAMICS.id,index:++Z,label:f("instruction.motion_dynamics"),originalText:we.MOTION_DYNAMICS.text,translatedText:f("instruction.desc.motion_dynamics"),isMandatory:!0,isCritical:!0,isHighlighted:M===we.MOTION_DYNAMICS.id}),Q(we.SUBJECT_HIERARCHY.text,we.SUBJECT_HIERARCHY.label)&&o.jsx(kt,{ref:j=>{L.current[we.SUBJECT_HIERARCHY.id]=j},id:we.SUBJECT_HIERARCHY.id,index:++Z,label:f("instruction.subject_hierarchy"),originalText:we.SUBJECT_HIERARCHY.text,translatedText:f("instruction.desc.subject_hierarchy"),isMandatory:!0,isCritical:!0,isHighlighted:M===we.SUBJECT_HIERARCHY.id}),Q(we.RULE_ISOLATION.text,we.RULE_ISOLATION.label)&&o.jsx(kt,{ref:j=>{L.current[we.RULE_ISOLATION.id]=j},id:we.RULE_ISOLATION.id,index:++Z,label:f("instruction.rule_isolation"),originalText:we.RULE_ISOLATION.text,translatedText:f("instruction.desc.rule_isolation"),isMandatory:!0,isCritical:!0,isHighlighted:M===we.RULE_ISOLATION.id}),Q(we.SENSORY_SATURATION.text,we.SENSORY_SATURATION.label)&&o.jsx(kt,{ref:j=>{L.current[we.SENSORY_SATURATION.id]=j},id:we.SENSORY_SATURATION.id,index:++Z,label:f("instruction.sensory_saturation"),originalText:we.SENSORY_SATURATION.text,translatedText:f("instruction.desc.sensory_saturation"),isMandatory:!0,isCritical:!0,isHighlighted:M===we.SENSORY_SATURATION.id})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:f("node.content.stack.cinematography")}),Q(we.SHOT_FILTER_WIDE.text,f("node.content.shotFilter.wideOnly"))&&o.jsx(kt,{ref:j=>{L.current[we.SHOT_FILTER_WIDE.id]=j},id:we.SHOT_FILTER_WIDE.id,index:ue?++Z:void 0,label:f("node.content.shotFilter.wideOnly"),originalText:we.SHOT_FILTER_WIDE.text,translatedText:f("instruction.desc.shot_filter_wide"),isEnabled:ue,onToggle:()=>n({shotFilter:ue?"all":"wideOnly"}),color:"cyan",isHighlighted:M===we.SHOT_FILTER_WIDE.id}),Q(J,f(ue?"instruction.ana_cinema_wide":"instruction.ana_cinema"))&&o.jsx(kt,{ref:j=>{L.current[le]=j},id:le,index:g?++Z:void 0,label:f(ue?"instruction.ana_cinema_wide":"instruction.ana_cinema"),originalText:J,translatedText:f(ge),isEnabled:g,onToggle:()=>n({cinematographyEnabled:!g}),color:"emerald",isHighlighted:M===le}),Q(ee,f(ue?"instruction.storyboard_rules_wide":"instruction.storyboard_rules"))&&o.jsx(kt,{ref:j=>{L.current[$]=j},id:$,index:h?++Z:void 0,label:f(ue?"instruction.storyboard_rules_wide":"instruction.storyboard_rules"),originalText:ee,translatedText:f(Te),isEnabled:h,onToggle:()=>n({professionalStoryboard:!h}),color:"emerald",isHighlighted:M===$}),Q(ce,f(ue?"instruction.tech_directives_wide":"instruction.tech_directives"))&&o.jsx(kt,{ref:j=>{L.current[ae]=j},id:ae,index:++Z,label:f(ue?"instruction.tech_directives_wide":"instruction.tech_directives"),originalText:ce,translatedText:f(B),isEnabled:!0,isMandatory:!0,color:"emerald",className:"opacity-100",isHighlighted:M===ae}),Q(oe,f("instruction.rule_mandatory_bg"))&&o.jsx(kt,{ref:j=>{L.current[V]=j},id:V,index:a?++Z:void 0,label:f("instruction.rule_mandatory_bg"),originalText:oe,translatedText:f(de),isCritical:!0,isEnabled:a,onToggle:()=>n({mandatoryBgEnabled:!a}),isHighlighted:M===V}),Q(F,K)&&o.jsx(kt,{ref:j=>{L.current[X]=j},id:X,index:l?++Z:void 0,label:K,originalText:F,translatedText:f(Y),isEnabled:l,onToggle:()=>n({extendedAnalysis:!l}),color:"cyan",isHighlighted:M===X}),Q(we.ACTION_PHASE_BREAKDOWN.text,f("node.content.microActionBreakdown"))&&o.jsx(kt,{ref:j=>{L.current[we.ACTION_PHASE_BREAKDOWN.id]=j},id:we.ACTION_PHASE_BREAKDOWN.id,index:c?++Z:void 0,label:f("node.content.microActionBreakdown"),originalText:we.ACTION_PHASE_BREAKDOWN.text,translatedText:f("instruction.desc.action_phase_breakdown"),isEnabled:c,onToggle:()=>n({microActionBreakdown:!c}),color:"cyan",isHighlighted:M===we.ACTION_PHASE_BREAKDOWN.id}),Q(f("node.content.recommendedFrames"),f("node.content.recommendedFrames"))&&o.jsx(kt,{id:"framing-logic",index:++Z,label:f("node.content.recommendedFrames"),originalText:A||k?`GLOBAL FRAME COUNT: Generate between ${A||1} and ${k||"unlimited"} frames per scene.`:P?`GLOBAL MINIMUM FRAMES: Generate at least ${P} frames per scene.`:"PER-SCENE FRAMING: Check 'recommendedFrames' property per scene. Generate enough shots to cover narrative pacing.",translatedText:A||k?` :  ${A||1}  ${k||"."} .`:P?` : ${P}   .`:"     .",isMandatory:!0,color:"gray"})]}),o.jsxs("div",{className:"space-y-1 mb-1",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:f("node.content.stack.world")}),Q(we.HIERARCHY.text,f("instruction.rule_hierarchy"))&&o.jsx(kt,{ref:j=>{L.current[we.HIERARCHY.id]=j},id:we.HIERARCHY.id,index:r?++Z:void 0,label:f("instruction.rule_hierarchy"),originalText:we.HIERARCHY.text,translatedText:f("instruction.desc.rule_hierarchy"),isEnabled:r,onToggle:()=>n({hierarchyEnabled:!r}),color:"emerald",isHighlighted:M===we.HIERARCHY.id}),Q(we.LIVING_WORLD.text,f("instruction.rule_living_world"))&&o.jsx(kt,{ref:j=>{L.current[we.LIVING_WORLD.id]=j},id:we.LIVING_WORLD.id,index:s?++Z:void 0,label:f("instruction.rule_living_world"),originalText:v?"**LIVING WORLD & EXTRAS (ANTHRO):** Describe background extras/crowds as **Anthropomorphic Animals** of diverse species.":we.LIVING_WORLD.text,translatedText:f(v?"instruction.desc.rule_living_world_anthro":"instruction.desc.rule_living_world"),isEnabled:s,onToggle:()=>n({livingWorldEnabled:!s}),color:"emerald",isHighlighted:M===we.LIVING_WORLD.id}),Q(we.STATE_PERSISTENCE.text,f("instruction.rule_persistence"))&&o.jsx(kt,{ref:j=>{L.current[we.STATE_PERSISTENCE.id]=j},id:we.STATE_PERSISTENCE.id,index:i?++Z:void 0,label:f("instruction.rule_persistence"),originalText:we.STATE_PERSISTENCE.text,translatedText:f("instruction.desc.rule_persistence"),isEnabled:i,onToggle:()=>n({statePersistenceEnabled:!i}),color:"emerald",isHighlighted:M===we.STATE_PERSISTENCE.id}),Q(we.USE_ALIASES.text,f("instruction.use_aliases"))&&o.jsx(kt,{ref:j=>{L.current[we.USE_ALIASES.id]=j},id:we.USE_ALIASES.id,index:++Z,label:f("instruction.use_aliases"),originalText:we.USE_ALIASES.text,translatedText:f("instruction.desc.use_aliases"),isMandatory:!0,color:"gray",isHighlighted:M===we.USE_ALIASES.id}),Q(we.CHARACTER_ARRAY_INTEGRITY.text,f("instruction.character_array_integrity"))&&o.jsx(kt,{ref:j=>{L.current[we.CHARACTER_ARRAY_INTEGRITY.id]=j},id:we.CHARACTER_ARRAY_INTEGRITY.id,index:++Z,label:f("instruction.character_array_integrity"),originalText:we.CHARACTER_ARRAY_INTEGRITY.text,translatedText:f("instruction.desc.character_array_integrity"),isMandatory:!0,isCritical:!0,isHighlighted:M===we.CHARACTER_ARRAY_INTEGRITY.id}),Q(we.ENTITY_LIMIT.text,f("instruction.entity_limit"))&&o.jsx(kt,{ref:j=>{L.current[we.ENTITY_LIMIT.id]=j},id:we.ENTITY_LIMIT.id,index:++Z,label:f("instruction.entity_limit"),originalText:we.ENTITY_LIMIT.text,translatedText:f("instruction.desc.entity_limit"),isMandatory:!0,isCritical:!0,isHighlighted:M===we.ENTITY_LIMIT.id}),Q(we.ANTHRO_LOGIC.text,f("node.content.anthroEnabled"))&&o.jsx(kt,{ref:j=>{L.current[we.ANTHRO_LOGIC.id]=j},id:we.ANTHRO_LOGIC.id,index:v?++Z:void 0,label:f("node.content.anthroEnabled"),originalText:we.ANTHRO_LOGIC.text,translatedText:f("instruction.desc.ana_anthro_logic"),isEnabled:v,onToggle:()=>n({anthroEnabled:!v}),color:"cyan",isHighlighted:M===we.ANTHRO_LOGIC.id}),Q(we.SUBSCRIBE_LOGIC.text,f("node.content.subscribeEnhancement"))&&o.jsx(kt,{ref:j=>{L.current[we.SUBSCRIBE_LOGIC.id]=j},id:we.SUBSCRIBE_LOGIC.id,index:C?++Z:void 0,label:f("node.content.subscribeEnhancement"),originalText:we.SUBSCRIBE_LOGIC.text,translatedText:f("instruction.desc.ana_subscribe_logic"),isEnabled:C,onToggle:()=>n({subscribeEnhancement:!C}),color:"cyan",isHighlighted:M===we.SUBSCRIBE_LOGIC.id})]})]}),o.jsx("div",{className:"absolute bottom-0 inset-x-0 h-3 cursor-ns-resize bg-transparent z-20",onMouseDown:ie,onMouseEnter:()=>O(!0),onMouseLeave:()=>O(!1)})]})]})}),h5=_t.memo(({fullDescription:e,onDescriptionChange:t,readOnly:n=!1,t:r,onFocus:a})=>{const[i,s]=x.useState({});x.useEffect(()=>{const c={Appearance:"",Personality:"",Clothing:""},d={:"Appearance",:"Personality",:"Personality",:"Clothing",Appearance:"Appearance",Personality:"Personality",Clothing:"Clothing"},h=/####\s*(Appearance|Personality|Clothing||||)\s*([\s\S]*?)(?=####|$)/gi;let g,m=!1;for(;(g=h.exec(e))!==null;){m=!0;const _=d[g[1].trim()],y=g[2].trim();_&&(c[_]=y)}!m&&e.trim()&&(c.Appearance=e.trim()),s(c)},[e]);const l=(c,d)=>{const h={...i,[c]:d},g=`#### Appearance
${h.Appearance||""}

#### Personality
${h.Personality||""}

#### Clothing
${h.Clothing||""}`;t(g)};return o.jsx("div",{className:"space-y-2 text-sm",children:["Appearance","Personality","Clothing"].map(c=>o.jsxs("div",{children:[o.jsx("h5",{className:"font-semibold text-gray-400 text-xs uppercase tracking-wider",children:r(`node.content.${c.toLowerCase()}`)||c}),o.jsx("textarea",{value:i[c]||"",onChange:d=>l(c,d.target.value),readOnly:n,className:"w-full text-sm p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar overflow-y-scroll read-only:bg-gray-900/50 read-only:text-gray-400",onWheel:d=>d.stopPropagation(),onFocus:a})]},c))})}),ft=({checked:e,onChange:t,disabled:n,id:r,className:a="h-4 w-4",title:i})=>o.jsx("button",{type:"button",id:r,role:"checkbox","aria-checked":e,disabled:n,onClick:s=>{s.stopPropagation(),n||t(!e)},onMouseDown:s=>{s.stopPropagation(),s.preventDefault()},title:i,className:`
        relative flex items-center justify-center 
        rounded border 
        transition-colors duration-200 ease-in-out flex-shrink-0
        outline-none focus:outline-none focus-visible:ring-1 focus-visible:ring-emerald-500
        ${a}
        ${e?"bg-emerald-600 border-emerald-500 hover:bg-emerald-500":"bg-gray-900 border-gray-600 hover:border-gray-500"}
        ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"}
      `,children:o.jsx("svg",{className:`w-[70%] h-[70%] text-white transition-transform duration-200 ${e?"scale-100 opacity-100":"scale-0 opacity-0"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})}),m5=_t.memo(({char:e,currentId:t,isSelected:n,isCollapsed:r,t:a,onClick:i,onToggleCollapse:s,onUpdate:l,deselectAllNodes:c,onEmbed:d,onDelete:h})=>o.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 mb-2 space-y-2 border border-gray-700 transition-colors",children:[o.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:g=>{g.target.closest("input, button")||s(t)},children:[o.jsxs("div",{className:"flex items-center flex-grow min-w-0",children:[e.isLinked&&o.jsx("div",{title:"Linked from upstream (Read-only)",className:"mr-2 text-emerald-400 flex-shrink-0",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),o.jsx(Ie,{tooltipPosition:"right",title:a("node.action.togglePanel"),onClick:g=>{g.stopPropagation(),s(t)},children:r?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"text",value:e.name,readOnly:e.isLinked,onChange:g=>l(t,"name",g.target.value),className:`font-semibold text-white bg-transparent w-64 rounded px-1 border border-transparent focus:border-emerald-500 focus:ring-0 focus:bg-gray-800 focus:outline-none transition-colors ${e.isLinked?"cursor-not-allowed text-gray-400 focus:border-transparent":""}`,onMouseDown:g=>g.stopPropagation()}),o.jsxs("span",{className:"text-[9px] text-gray-500 font-mono ml-2 truncate max-w-[120px]",title:String(t),children:["(",t,")"]})]})]}),o.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[o.jsxs("label",{className:"text-xs text-gray-400 whitespace-nowrap",children:[a("node.content.characterIndex"),":"]}),o.jsx("input",{type:"text",value:e.index||"",readOnly:e.isLinked,onChange:g=>l(t,"index",g.target.value),className:`font-semibold text-white bg-gray-800 w-24 rounded px-1 text-xs py-0.5 border border-transparent focus:border-emerald-500 focus:ring-0 focus:outline-none transition-colors ${e.isLinked?"bg-gray-900/50 text-gray-400 cursor-not-allowed focus:border-transparent":""}`,onFocus:c,onMouseDown:g=>g.stopPropagation()}),h&&o.jsx(Ie,{tooltipPosition:"left",title:a("node.action.deleteItem"),onClick:g=>{g.stopPropagation(),h(t)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),!r&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"space-y-1 mb-2",children:[o.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider",children:a("node.content.imagePrompt")}),o.jsx("textarea",{value:e.imagePrompt||e.prompt||"",onChange:g=>l(t,"imagePrompt",g.target.value),readOnly:e.isLinked,className:`w-full text-xs p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar overflow-y-scroll ${e.isLinked?"bg-gray-900/50 text-gray-400 cursor-not-allowed":""}`,onWheel:g=>g.stopPropagation(),onMouseDown:g=>g.stopPropagation()})]}),o.jsx(h5,{fullDescription:e.fullDescription||"",onDescriptionChange:g=>l(t,"fullDescription",g),readOnly:e.isLinked,t:a,onFocus:c})]})]})),g5=_t.memo(({uiState:e,initialHeight:t,onHeightChange:n,scale:r,onUpdateUiState:a,onUpdateValue:i,onApplyAliases:s,nodeId:l,autoIndexCharacters:c,charactersToDisplay:d,selectedCharacters:h,collapsedCharacters:g,areAllCharactersCollapsed:m,onToggleAllCharacters:_,handleCharacterClick:y,handleToggleCharacterCollapse:v,updateCharacter:C,visualStyle:w,upstreamVisualStyle:b,deselectAllNodes:f,t:T,onEmbedCharacter:I,onSyncCharacters:E,onClearCharacters:R,onDeleteCharacter:N,isSyncAvailable:A,onMoveCharacter:k,onAddCharacter:P})=>{const[M,H]=x.useState(!1),W=x.useRef(null),[O,U]=x.useState(t||170);x.useEffect(()=>{Math.abs(t-O)>1&&U(t||170)},[t]);const z=G=>{G.preventDefault(),G.stopPropagation();const q=G.clientY,ie=O;let te=ie;const ye=$=>{$.preventDefault(),$.stopPropagation();const ee=($.clientY-q)/r;te=Math.max(100,Math.min(800,ie+ee)),W.current&&requestAnimationFrame(()=>{W.current&&(W.current.style.height=`${te}px`)})},ue=$=>{$.preventDefault(),$.stopPropagation(),window.removeEventListener("mousemove",ye),window.removeEventListener("mouseup",ue),U(te),n(te)};window.addEventListener("mousemove",ye),window.addEventListener("mouseup",ue)},L=x.useMemo(()=>[...d||[]].sort((q,ie)=>{const te=$=>{const ee=($||"").match(/(\d+)/);return ee?parseInt(ee[1],10):99999},ye=q.index||"",ue=ie.index||"";return te(ye)-te(ue)}),[d]),D={};return L.forEach(G=>{const q=(G.name||"").trim().toLowerCase();D[q]=(D[q]||0)+1}),L.forEach(G=>{(G.index||G.alias||"").trim().toLowerCase()}),o.jsxs("div",{ref:W,style:{height:e.isCharStyleCollapsed?"auto":`${O}px`},className:`flex-shrink-0 mb-1 bg-gray-900 rounded-md border ${M?"border-emerald-500":"border-gray-700"} hover:border-gray-400 overflow-hidden flex flex-col transition-all duration-200 relative`,children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>a({isCharStyleCollapsed:!e.isCharStyleCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"})}),o.jsx("h3",{className:"font-bold text-emerald-400 select-none transition-colors uppercase text-xs tracking-wider",children:T("node.content.characters")}),A&&E&&o.jsx(lt,{title:T("node.action.refreshData"),position:"top",children:o.jsx("button",{onClick:G=>{G.stopPropagation(),E()},className:"p-1 hover:bg-gray-700 rounded text-emerald-400 hover:text-emerald-300 transition-colors ml-1",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(lt,{title:T(m?"node.action.expandAll":"node.action.collapseAll"),position:"top",children:o.jsx("button",{onClick:G=>{G.stopPropagation(),_()},disabled:e.isCharStyleCollapsed,className:`p-1 rounded transition-colors ${e.isCharStyleCollapsed?"text-gray-600 cursor-default":"hover:bg-gray-700 text-emerald-400 hover:text-emerald-300"}`,children:m?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})})}),P&&o.jsx(Ie,{tooltipPosition:"left",title:T("node.action.addCharacter"),onClick:G=>{G.stopPropagation(),P()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),R&&o.jsx(Ie,{tooltipPosition:"left",title:T("node.action.clear"),onClick:G=>{G.stopPropagation(),R()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),o.jsx(lt,{title:T("node.action.index"),position:"left",children:o.jsx("button",{onClick:G=>{G.stopPropagation(),s(l)},className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-gray-200 transition-colors",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}),o.jsxs("div",{className:"flex items-center space-x-2 pl-1",onClick:G=>G.stopPropagation(),children:[o.jsx(ft,{id:`auto-index-${l}`,checked:c,onChange:G=>i({autoIndexCharacters:G}),className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:`auto-index-${l}`,className:"text-[10px] font-medium text-gray-400 cursor-pointer select-none uppercase tracking-wide",children:T("node.content.autoIndexCharacters")})]}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Ie,{tooltipPosition:"left",title:e.isCharStyleCollapsed?T("node.action.expand"):T("node.action.collapse"),onClick:G=>{G.stopPropagation(),a({isCharStyleCollapsed:!e.isCharStyleCollapsed})},children:e.isCharStyleCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!e.isCharStyleCollapsed&&o.jsx("div",{style:{contentVisibility:"auto"},className:"p-2 space-y-2 overflow-y-auto custom-scrollbar flex-grow",onWheel:G=>G.stopPropagation(),children:L.map((G,q)=>{const ie=G.id||`char-idx-${q}`,te=D[(G.name||"").trim().toLowerCase()]>1;return(G.index||G.alias||"").trim().toLowerCase(),o.jsxs("div",{className:te?"border-red-500 border rounded-lg":"",children:[te&&o.jsx("div",{className:"text-[10px] text-red-400 bg-red-900/30 px-2 py-0.5 rounded-t-lg",children:"Duplicate Name Warning"}),o.jsx(m5,{char:G,currentId:ie,isSelected:h.has(ie),isCollapsed:g.has(ie),t:T,onToggleCollapse:v,onClick:y,onUpdate:C,onEmbed:I,onDelete:N,deselectAllNodes:f})]},ie)})}),!e.isCharStyleCollapsed&&o.jsx("div",{className:"absolute bottom-0 inset-x-0 h-3 cursor-ns-resize bg-transparent z-20",onMouseDown:z,onMouseEnter:()=>H(!0),onMouseLeave:()=>H(!1)})]})}),f5=_t.memo(({scene:e,t,isCollapsed:n,onToggle:r})=>{const a=e.characters&&Array.isArray(e.characters)?e.characters.map(s=>{const l=s.match(/(?:Entity|Character|)[-\s]?(\d+)/i);return l?`ENT-${l[1]}`:s}).join(", "):null,i=(e.title||"").replace(/^(Scene||Scne|Escena|Szene)\s*\d+[:\s-]*/i,"").trim();return o.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2 border border-transparent hover:border-gray-700/50 transition-colors",children:[o.jsxs("div",{className:"flex justify-between items-center cursor-pointer select-none",onClick:s=>{s.stopPropagation(),r()},children:[o.jsxs("div",{className:"flex flex-col min-w-0",children:[o.jsx("span",{className:"font-semibold text-gray-300 text-sm truncate pr-2",children:`${t("node.content.scene")} ${e.sceneNumber}${i?`: ${i}`:""}`}),o.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.recommendedFrames!==void 0&&o.jsxs("span",{className:"text-[9px] text-emerald-500 font-mono font-bold uppercase tracking-wider",children:[t("node.content.recommendedFrames"),": ",e.recommendedFrames]}),a&&o.jsx("span",{className:"text-[9px] text-cyan-300 font-mono uppercase tracking-wider bg-cyan-900/30 px-1 rounded truncate max-w-[150px]",title:a,children:a})]})]}),o.jsx(Ie,{tooltipPosition:"left",title:t(n?"node.action.expandScene":"node.action.collapseScene"),onClick:s=>{s.stopPropagation(),r()},children:n?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!n&&o.jsxs("div",{className:"mt-2 text-xs",children:[o.jsx("p",{className:"text-gray-400 whitespace-pre-wrap select-text",children:e.description}),e.narratorText&&o.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-700/50",children:[o.jsx("p",{className:"font-semibold text-emerald-400 mb-1",children:t("node.content.narrator")}),o.jsx("p",{className:"text-gray-300 italic whitespace-pre-wrap select-text pl-2 border-l-2 border-emerald-500",children:e.narratorText})]})]})]})}),y5=_t.memo(({width:e,upstreamScriptData:t,collapsedInputScenes:n,isSummaryCollapsed:r,onToggleInputSceneCollapse:a,setIsSummaryCollapsed:i,t:s,onToggleAllInputScenes:l,areAllInputScenesCollapsed:c})=>o.jsxs("div",{className:"overflow-y-scroll overflow-x-hidden custom-scrollbar pr-1 space-y-2 px-1 pb-1",style:{width:e,contentVisibility:"auto"},onWheel:d=>d.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center pr-2 sticky top-0 bg-gray-900 z-10 py-1 border-b border-gray-800/50 mb-2 -mx-1 px-2",children:[o.jsx("h3",{className:"font-bold text-emerald-400 px-1",children:s("node.content.inputScripts")}),(t==null?void 0:t.scenes)&&t.scenes.length>0&&o.jsx(Ie,{tooltipPosition:"left",title:s(c?"node.action.expandAllScenes":"node.action.collapseAllScenes"),onClick:l,children:c?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})]}),r?(t==null?void 0:t.summary)&&o.jsx("div",{className:"bg-gray-800/50 rounded-lg p-2 cursor-pointer hover:bg-gray-800 border border-transparent hover:border-gray-700/50 transition-colors",onClick:()=>i(!1),children:o.jsxs("h4",{className:"font-semibold text-gray-300 text-sm flex items-center",children:[o.jsx("span",{className:"truncate mr-2",children:s("node.content.summary")}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]})}):(t==null?void 0:t.summary)&&o.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2 border border-transparent",children:[o.jsxs("h4",{className:"font-semibold text-gray-300 text-sm flex justify-between items-center cursor-pointer",onClick:()=>i(!0),children:[o.jsx("span",{children:s("node.content.summary")}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})]}),o.jsx("div",{className:"mt-1 text-xs text-gray-400 whitespace-pre-wrap select-text",children:t.summary})]}),t!=null&&t.scenes&&t.scenes.length>0?t.scenes.map((d,h)=>o.jsx(f5,{scene:d,t:s,isCollapsed:n.has(h),onToggle:()=>a(h)},h)):o.jsx("div",{className:"text-center text-xs text-gray-500 p-4",children:s("node.content.noInputScenes")})]})),x5=({characters:e,onChange:t,availableCharacters:n})=>{const r=l=>{const c=l.match(/(?:Entity|Character|)[-\s]?(\d+)/i);if(c)return parseInt(c[1],10);const d=l.match(/(\d+)/);return d?parseInt(d[1],10):null},a=(l,c)=>{const d=e[l];let h=r(d);h===null&&(h=0);const m=`Entity-${Math.max(1,h+c)}`,_=[...e];_[l]=m,t(_)},i=l=>{const c=e.filter((d,h)=>h!==l);t(c)},s=()=>{let l=0;e.forEach(d=>{const h=r(d);h!==null&&h>l&&(l=h)});const c=[...e,`Entity-${l+1}`];t(c)};return o.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[e.map((l,c)=>{const h=`ENT-${r(l)??"?"}`;return o.jsxs("div",{className:"flex items-center bg-gray-900 rounded px-1 border border-gray-600 h-6",children:[o.jsx("span",{className:"text-xs font-mono text-gray-300 mr-1 select-none",title:l,children:h}),o.jsxs("div",{className:"flex flex-col -space-y-0.5",children:[o.jsx("button",{onClick:g=>{g.stopPropagation(),a(c,1)},className:"text-[8px] leading-none text-gray-500 hover:text-white",children:""}),o.jsx("button",{onClick:g=>{g.stopPropagation(),a(c,-1)},className:"text-[8px] leading-none text-gray-500 hover:text-white",children:""})]}),o.jsx("button",{onClick:g=>{g.stopPropagation(),i(c)},className:"ml-1 text-xs text-gray-500 hover:text-white",children:""})]},c)}),o.jsx("button",{onClick:l=>{l.stopPropagation(),s()},className:"w-6 h-6 flex items-center justify-center bg-gray-900 hover:bg-gray-700 border border-gray-600 rounded text-gray-400 hover:text-white text-xs font-bold",title:"Add character reference",children:"+"})]})},v5=_t.memo(({frame:e,sceneIndex:t,frameIndex:n,frameUniqueId:r,isSelected:a,isCollapsed:i,availableCharacters:s,t:l,onClick:c,onToggleCollapse:d,onUpdate:h,onAddFrame:g,onReorder:m,onDelete:_,onCopy:y,handleTextFocus:v})=>{const C=(e.characters||[]).map(T=>{const I=T.match(/(?:Entity|Character|)[-\s]?(\d+)/i);if(I)return`ENT-${I[1]}`;const E=s.find(R=>R.name===T);if(E){const R=E.index||E.alias;if(R){const N=R.match(/(?:Entity|Character|)[-\s]?(\d+)/i);return N?`ENT-${N[1]}`:R}}return T}),w=C.length>0?C.join(", "):"NONE",b=e.shotType?` [${e.shotType}]`:"",f=`F${e.frameNumber}-S${e.sceneNumber||t+1}: ${w}${b} (${e.duration}s)`;return o.jsxs("div",{className:`bg-gray-800 rounded-lg p-2 space-y-2 border ${a?"border-emerald-500":"border-gray-700"} cursor-pointer`,onClick:T=>c(T,r),children:[o.jsxs("div",{className:"flex justify-between items-center",onClick:T=>{T.target.closest("input, button")||d(r)},children:[o.jsxs("div",{className:"flex items-center space-x-2 flex-grow min-w-0",children:[o.jsx(Ie,{tooltipPosition:"right",title:l(i?"node.action.expandFrame":"node.action.collapseFrame"),onClick:T=>{T.stopPropagation(),d(r)},children:i?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsx("h4",{className:"font-bold text-white truncate pr-2 text-sm",children:f})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ie,{tooltipPosition:"left",title:l("node.action.addFrame"),onClick:T=>{T.stopPropagation(),g(t,n)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),o.jsx(Ie,{tooltipPosition:"left",title:l("node.action.moveUp"),onClick:T=>{T.stopPropagation(),m(t,n,"up")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsx(Ie,{tooltipPosition:"left",title:l("node.action.moveDown"),onClick:T=>{T.stopPropagation(),m(t,n,"down")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),o.jsx(Ie,{tooltipPosition:"left",title:l("node.action.deleteItem"),onClick:T=>{T.stopPropagation(),_(t,n)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),!i&&o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{className:"flex items-center justify-between bg-gray-900/50 p-1 rounded border border-gray-700 overflow-hidden",children:[o.jsxs("div",{className:"flex items-center ml-1",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-gray-500 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),o.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase flex-shrink-0",children:":"})]}),o.jsx("input",{type:"number",value:e.duration,onChange:T=>h(t,n,"duration",parseInt(T.target.value)||0),className:"w-10 p-0.5 bg-gray-800 text-white rounded text-[10px] border border-gray-600 outline-none focus:border-emerald-500 text-center",onFocus:v,onMouseDown:T=>T.stopPropagation()})]}),o.jsxs("div",{className:"flex items-center justify-between bg-gray-900/50 p-1 rounded border border-gray-700 overflow-hidden",children:[o.jsxs("div",{className:"flex items-center ml-1",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-gray-500 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),o.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase flex-shrink-0",children:":"})]}),o.jsx("input",{type:"text",value:e.shotType||"",onChange:T=>h(t,n,"shotType",T.target.value),placeholder:"...",className:"w-14 p-0.5 bg-gray-800 text-white rounded text-[10px] border border-gray-600 outline-none focus:border-emerald-500 font-mono uppercase px-1 text-center",onFocus:v,onMouseDown:T=>T.stopPropagation()})]})]}),o.jsxs("div",{className:"bg-gray-900/30 p-1.5 rounded border border-gray-700",children:[o.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase block mb-1",children:l("node.content.characters")}),o.jsx(x5,{characters:e.characters||[],onChange:T=>h(t,n,"characters",T),availableCharacters:s})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-emerald-500 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),o.jsx("label",{className:"text-xs font-medium text-emerald-400",children:l("node.content.compositionAndBlocking")})]}),o.jsx(Ie,{tooltipPosition:"left",title:l("node.action.copy"),onClick:T=>{T.stopPropagation(),y(e.imagePrompt)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})})]}),o.jsx("textarea",{value:e.imagePrompt,onChange:T=>h(t,n,"imagePrompt",T.target.value),className:"w-full text-xs p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar",onFocus:v,onMouseDown:T=>T.stopPropagation()})]}),o.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-cyan-500 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),o.jsx("label",{className:"text-xs font-medium text-cyan-400",children:l("node.content.environmentPrompt")})]}),o.jsx(Ie,{tooltipPosition:"left",title:l("node.action.copy"),onClick:T=>{T.stopPropagation(),y(e.environmentPrompt)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{value:e.environmentPrompt,onChange:T=>h(t,n,"environmentPrompt",T.target.value),className:"w-full text-xs p-2 bg-gray-900 border-none rounded-md resize-y min-h-[40px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar",onFocus:v,onMouseDown:T=>T.stopPropagation()})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-purple-500 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),o.jsx("label",{className:"text-xs font-medium text-purple-400",children:l("node.content.videoPrompt")})]}),o.jsx(Ie,{tooltipPosition:"left",title:l("node.action.copy"),onClick:T=>{T.stopPropagation(),y(e.videoPrompt)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{value:e.videoPrompt,onChange:T=>h(t,n,"videoPrompt",T.target.value),className:"w-full text-xs p-2 bg-gray-900 border-none rounded-md resize-y min-h-[40px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar",onFocus:v,onMouseDown:T=>T.stopPropagation()})]})]})]})]})}),b5=_t.memo(({width:e,scenes:t,characters:n,areAllOutputScenesCollapsed:r,areAllFramesCollapsed:a,collapsedOutputScenes:i,collapsedFrames:s,collapsedContexts:l,selectedFrames:c,onToggleAllOutputScenes:d,onToggleAllFramesCollapse:h,onToggleOutputSceneCollapse:g,onToggleSceneContextCollapse:m,onToggleCollapse:_,onAddFrame:y,onAddScene:v,onRenameScene:C,onReorderFrame:w,onDeleteFrame:b,onFramePartChange:f,onSceneContextChange:T,onFrameClick:I,onCopy:E,handleTextFocus:R,t:N,onDeleteScene:A})=>{const[k,P]=x.useState(null),[M,H]=x.useState(""),W=(z,L,D)=>{D.stopPropagation(),P(z),H(L)},O=z=>{C(z,M),P(null)},U=()=>{P(null)};return o.jsxs("div",{className:"overflow-y-scroll custom-scrollbar pl-1 space-y-2 px-1 pb-1",style:{width:e,contentVisibility:"auto"},onWheel:z=>z.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center pr-2 sticky top-0 bg-gray-900 z-10 py-1 border-b border-gray-800/50 -mx-1 px-2",children:[o.jsx("h3",{className:"font-bold text-emerald-400 px-2",children:N("node.content.frames")}),o.jsxs("div",{className:"flex items-center space-x-1",children:[t.length===0&&o.jsx(Ie,{tooltipPosition:"left",title:N("node.action.addFirstFrame"),onClick:z=>{z.stopPropagation(),v()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),t.length>0&&o.jsxs(o.Fragment,{children:[o.jsx(Ie,{tooltipPosition:"left",title:N("node.action.addScene"),onClick:z=>{z.stopPropagation(),v()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),o.jsx(Ie,{tooltipPosition:"left",title:N(r?"node.action.expandAllScenes":"node.action.collapseAllScenes"),onClick:d,children:r?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})}),o.jsx(Ie,{tooltipPosition:"left",title:N(a?"node.action.expandAllFrames":"node.action.collapseAllFrames"),onClick:h,disabled:r,children:a?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${r?"text-gray-600":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${r?"text-gray-600":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})})]})]})]}),t.map((z,L)=>{var ie;const D=i.has(L),G=l.has(L),q=(z.title||"").replace(/^(Scene||Scne|Escena|Szene)\s*\d+[:\s-]*/i,"").trim();return o.jsxs("div",{className:"mb-4",children:[o.jsx("div",{className:"group px-2 py-1 mb-1 text-xs font-bold text-gray-400 uppercase border-b border-gray-700 hover:bg-gray-800/50 transition-colors rounded",onClick:()=>g(L),children:o.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[o.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[o.jsx(Ie,{tooltipPosition:"right",title:N(D?"node.action.expandScene":"node.action.collapseScene"),onClick:te=>{te.stopPropagation(),g(L)},children:D?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),k===L?o.jsx("input",{type:"text",value:M,onChange:te=>H(te.target.value),onBlur:()=>O(L),onKeyDown:te=>{te.key==="Enter"?O(L):te.key==="Escape"&&U()},onClick:te=>te.stopPropagation(),onMouseDown:te=>te.stopPropagation(),autoFocus:!0,className:"bg-gray-900 text-white px-1 py-0.5 rounded border border-emerald-500 outline-none w-full font-bold"}):o.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[o.jsx("span",{className:"truncate font-bold text-gray-300 text-sm",children:`${N("node.content.scene")} ${z.sceneNumber}${q?`: ${q}`:""}`}),o.jsx("button",{onClick:te=>W(L,z.title||`Scene ${z.sceneNumber}`,te),className:"opacity-0 group-hover:opacity-100 text-gray-500 hover:text-emerald-400 transition-opacity",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})})]})]}),o.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[o.jsxs("span",{className:"flex-shrink-0 text-[9px] bg-gray-700 px-1.5 py-0.5 rounded text-gray-400 font-mono",children:[((ie=z.frames)==null?void 0:ie.length)||0," ",N("node.content.frame_plural")]}),o.jsx(Ie,{tooltipPosition:"left",title:N("node.action.addFrame"),onClick:te=>{te.stopPropagation(),y(L)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),o.jsx(Ie,{tooltipPosition:"left",title:N("node.action.deleteItem"),onClick:te=>{te.stopPropagation(),A(L)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})}),!D&&o.jsxs("div",{className:"pl-2 space-y-2",children:[o.jsxs("div",{className:"bg-gray-800 p-2 rounded-md border border-gray-700 mb-2",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1 cursor-pointer",onClick:te=>{const ye=te.target;ye&&!ye.closest("button")&&m(L)},children:[o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ie,{tooltipPosition:"right",title:N(G?"node.action.expand":"node.action.collapse"),onClick:te=>{te.stopPropagation(),m(L)},children:G?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),o.jsx("label",{className:"text-xs font-bold text-emerald-400 cursor-pointer select-none",children:N("node.content.sceneContext")})]}),o.jsx(Ie,{tooltipPosition:"left",title:N("node.action.copy"),onClick:te=>{te.stopPropagation(),E(z.sceneContext||"")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),!G&&o.jsx("textarea",{value:z.sceneContext||"",onChange:te=>T(L,te.target.value),className:"w-full text-xs p-2 bg-gray-900 border-none rounded-md resize-y min-h-[50px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar",placeholder:N("node.content.sceneContextPlaceholder"),onFocus:R,onMouseDown:te=>te.stopPropagation()})]}),(z.frames||[]).map((te,ye)=>{const ue=`${L}-${te.frameNumber}`;return o.jsx(v5,{frame:te,sceneIndex:L,frameIndex:ye,frameUniqueId:ue,isSelected:c.has(ue),isCollapsed:s.has(ue),availableCharacters:n,t:N,onClick:I,onToggleCollapse:_,onUpdate:f,onAddFrame:y,onReorder:w,onDelete:b,onCopy:E,handleTextFocus:R},ue)})]})]},z.sceneNumber)})]})}),sr=_t.memo(({id:e,onClick:t})=>o.jsx("button",{onClick:n=>{n.stopPropagation(),t(n,e)},className:"ml-auto p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",title:"Locate in Stack",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})),w5=({node:e,onValueChange:t,onAnalyzeScript:n,isAnalyzingScript:r,isStopping:a,onStopGeneration:i,t:s,getUpstreamTextValue:l,connections:c,connectedInputs:d,onApplyAliases:h,addToast:g,deselectAllNodes:m,inputData:_})=>{var Kt;const{language:y}=Ht(),[v,C]=x.useState(null),[w,b]=x.useState(new Set),[f,T]=x.useState(!0),[I,E]=x.useState(50),[R,N]=x.useState(new Set),[A,k]=x.useState(new Set),[P,M]=x.useState(new Set),[H,W]=x.useState(new Set),[O,U]=x.useState(new Set),[z,L]=x.useState(new Set),[D,G]=x.useState(null),q=(re,Le)=>G(Le),[ie,te]=x.useState({current:0,total:0,last:0}),ye=r===e.id,{viewTransform:ue}=or(),$=y==="en"?"ru":y,ee=x.useMemo(()=>{try{const re=JSON.parse(e.value||"{}");return{characters:Array.isArray(re.characters)?re.characters:[],scenes:Array.isArray(re.scenes)?re.scenes:[],targetLanguage:re.targetLanguage||y,model:re.model||"gemini-3-pro-preview",startSceneNumber:re.startSceneNumber||null,endSceneNumber:re.endSceneNumber||null,framesPerScene:re.framesPerScene||null,minFrames:re.minFrames||null,maxFrames:re.maxFrames||null,hierarchyEnabled:re.hierarchyEnabled!==!1,mandatoryBgEnabled:re.mandatoryBgEnabled!==!1,statePersistenceEnabled:re.statePersistenceEnabled!==!1,livingWorldEnabled:re.livingWorldEnabled!==!1,extendedAnalysis:!!re.extendedAnalysis,microActionBreakdown:!!re.microActionBreakdown,batchProcessing:re.batchProcessing!==!1,professionalStoryboard:re.professionalStoryboard!==!1,cinematographyEnabled:re.cinematographyEnabled!==!1,safeGeneration:!!re.safeGeneration,thinkingEnabled:!!re.thinkingEnabled,shotFilter:re.shotFilter||"all",anthroEnabled:!!re.anthroEnabled,subscribeEnhancement:!!re.subscribeEnhancement,anatomicalStrictness:re.anatomicalStrictness!==!1,propConsistency:re.propConsistency!==!1,visualStyle:re.visualStyle||"",autoIndexCharacters:re.autoIndexCharacters!==!1,uiState:re.uiState||{isSettingsCollapsed:!0,isCharStyleCollapsed:!0},settingsPaneHeight:re.settingsPaneHeight||380,characterPaneHeight:re.characterPaneHeight||170,generationProgress:re.generationProgress||null}}catch{return{characters:[],scenes:[],targetLanguage:y,model:"gemini-3-pro-preview",uiState:{isSettingsCollapsed:!0,isCharStyleCollapsed:!0},settingsPaneHeight:380,characterPaneHeight:170,anatomicalStrictness:!0,propConsistency:!0,minFrames:null,maxFrames:null,framesPerScene:null}}},[e.value,y]),{characters:Te,scenes:le,targetLanguage:J,model:ge,startSceneNumber:ae,endSceneNumber:ce,minFrames:B,maxFrames:X,framesPerScene:F,hierarchyEnabled:Y,mandatoryBgEnabled:K,statePersistenceEnabled:V,livingWorldEnabled:oe,extendedAnalysis:de,microActionBreakdown:Z,batchProcessing:Q,professionalStoryboard:j,cinematographyEnabled:fe,safeGeneration:Pe,thinkingEnabled:je,shotFilter:ke,anthroEnabled:$e,subscribeEnhancement:ze,anatomicalStrictness:nt,propConsistency:at,visualStyle:xe,autoIndexCharacters:he,uiState:Ge,settingsPaneHeight:me,characterPaneHeight:Oe,generationProgress:De}=ee;x.useEffect(()=>{if(le&&le.length>0){const re=new Set(le.map((Ke,dt)=>dt)),Le=new Set(le.map((Ke,dt)=>dt)),Re=new Set;le.forEach((Ke,dt)=>{(Ke.frames||[]).forEach(rt=>Re.add(`${dt}-${rt.frameNumber}`))}),N(re),M(Le),k(Re)}if(Te&&Te.length>0){const re=new Set(Te.map(Le=>Le.id||Le.name));L(re)}},[]);const Ce=x.useCallback(re=>{const Le={...ee,...re};t(e.id,JSON.stringify(Le))},[e.id,t,ee]),Qe=x.useCallback(re=>{Ce({uiState:{...Ge,...re}})},[Ce,Ge]),pe=re=>{re.preventDefault();const Le=re.clientX,Re=I,Ke=re.target.parentElement;if(!Ke)return;const dt=Ke.offsetWidth,rt=ue.scale,St=Gt=>{const se=(Gt.clientX-Le)/rt,Me=Re+se/dt*100;E(Math.max(20,Math.min(80,Me)))},Pt=()=>{window.removeEventListener("mousemove",St),window.removeEventListener("mouseup",Pt)};window.addEventListener("mousemove",St),window.addEventListener("mouseup",Pt)},Se=re=>{const Le=Math.max(1,re),Re={startSceneNumber:Le};ce!==null&&Le>ce&&(Re.endSceneNumber=Le),Ce(Re)},Ee=re=>{if(re===null){Ce({endSceneNumber:null});return}const Le=Math.max(1,re),Re={endSceneNumber:Le};Le<(ae||1)&&(Re.startSceneNumber=Le),Ce(Re)};x.useEffect(()=>{let re;return De?De.endTime?te({current:0,total:Math.floor((De.endTime-De.totalStartTime)/1e3),last:De.lastItemDuration||0}):ye&&(re=window.setInterval(()=>{const Le=Date.now();te({current:Math.floor((Le-(De.currentItemStartTime||Le))/1e3),total:Math.floor((Le-(De.totalStartTime||Le))/1e3),last:De.lastItemDuration||0})},100)):te({current:0,total:0,last:0}),()=>clearInterval(re)},[ye,De]);const Fe=x.useMemo(()=>le.reduce((re,Le)=>{var Re;return re+(((Re=Le.frames)==null?void 0:Re.length)||0)},0),[le]),be=x.useMemo(()=>ae||ce?`${s("node.content.scene_plural")}: ${ae||1}-${ce||"End"}`:"",[ae,ce,s]),_e=x.useCallback(()=>{if(!c||!l)return;const re=c.find(Le=>Le.toNodeId===e.id);if(re){const Le=l(re.fromNodeId,re.fromHandleId);try{const Re=JSON.parse(Le),Ke=(Re.scenes||[]).map((se,Me)=>({...se,sceneNumber:typeof se.sceneNumber=="number"?se.sceneNumber:Me+1}));C({summary:Re.summary||"",scenes:Ke,generatedStyle:Re.generatedStyle||Re.visualStyle||""}),Ke.length>0&&b(new Set(Ke.map((se,Me)=>Me)));let dt=[];Array.isArray(Re.detailedCharacters)?dt=Re.detailedCharacters:Array.isArray(Re.characters)?dt=Re.characters:Re.name&&(dt=[Re]);const rt=ee.characters||[],St=rt.filter(se=>!se.isLinked),Pt=dt.map(se=>{const{alias:Me,...Ae}=se;return{name:Ae.name||"Unknown",id:Ae.id||`linked-${re.fromNodeId}-${Ae.index||Ae.name||Math.random()}`,index:Ae.index,imagePrompt:Ae.prompt||Ae.imagePrompt||"",fullDescription:Ae.fullDescription||Ae.description||"",isLinked:!0}});let Gt=[...St,...Pt];Gt.sort((se,Me)=>{const Ae=Lt=>{const sn=(Lt||"").match(/(\d+)/);return sn?parseInt(sn[1],10):99999},et=se.index||"",pt=Me.index||"";return Ae(et)-Ae(pt)}),Gt=Gt.map((se,Me)=>({...se,index:`Entity-${Me+1}`})),JSON.stringify(Gt)!==JSON.stringify(rt)&&Ce({characters:Gt})}catch{C(null)}}else{C(null);const Le=ee.characters||[],Re=Le.filter(Ke=>!Ke.isLinked);Le.length!==Re.length&&Ce({characters:Re})}},[c,l,e.id,ee.characters,Ce]);x.useEffect(()=>{const re=setTimeout(()=>{_e()},100);return()=>clearTimeout(re)},[_e,_]);const Ue=()=>{_e(),setTimeout(()=>n(e.id),50)},We=()=>{const Le=Math.ceil((ae||1)/5)*5+1,Re=Le+4;Ce({startSceneNumber:Le,endSceneNumber:Re})},gt=()=>{const Le=Math.max(1,Math.floor(((ae||1)-1)/5)*5-4),Re=Le+4;Ce({startSceneNumber:Le,endSceneNumber:Re})},Et=()=>Ce({startSceneNumber:null,endSceneNumber:null}),It=x.useCallback(()=>{v!=null&&v.scenes&&(w.size===v.scenes.length?b(new Set):b(new Set(v.scenes.map((re,Le)=>Le))))},[v,w]),Mt=x.useCallback(()=>{if(R.size===le.length)N(new Set);else{N(new Set(le.map((Re,Ke)=>Ke)));const re=new Set,Le=new Set;le.forEach((Re,Ke)=>{Le.add(Ke),(Re.frames||[]).forEach(dt=>re.add(`${Ke}-${dt.frameNumber}`))}),k(re),M(Le)}},[le,R]),xt=x.useCallback(()=>{const re=le.flatMap((Re,Ke)=>Re.frames.map(dt=>`${Ke}-${dt.frameNumber}`)),Le=le.map((Re,Ke)=>Ke);A.size===re.length?(k(new Set),M(new Set)):(k(new Set(re)),M(new Set(Le)))},[le,A]),Ft=x.useCallback((re,Le)=>{const Re=[...le];Re[re]={...Re[re],sceneContext:Le},Ce({scenes:Re})},[le,Ce]),cn=x.useCallback((re,Le,Re,Ke)=>{const dt=[...le],rt={...dt[re]},St=[...rt.frames||[]];St[Le]={...St[Le],[Re]:Ke},rt.frames=St,dt[re]=rt,Ce({scenes:dt})},[le,Ce]),Bt=x.useCallback((re,Le)=>{const Re=[...le],Ke={...Re[re]},dt=[...Ke.frames||[]],rt={frameNumber:0,characters:[],duration:2,imagePrompt:"",environmentPrompt:"",videoPrompt:"",shotType:"WS"};Le!==void 0?dt.splice(Le+1,0,rt):dt.push(rt),Ke.frames=dt.map((St,Pt)=>({...St,frameNumber:Pt+1})),Re[re]=Ke,Ce({scenes:Re})},[le,Ce]),en=x.useCallback(()=>{const re=[...le],Le=le.length+1;re.push({sceneNumber:Le,title:`Scene ${Le}`,description:"",frames:[],sceneContext:""}),Ce({scenes:re})},[le,Ce]),ve=x.useCallback((re,Le)=>{const Re=[...le];Re[re]&&(Re[re]={...Re[re],title:Le},Ce({scenes:Re}))},[le,Ce]),Be=x.useCallback((re,Le,Re)=>{const Ke=[...le],dt={...Ke[re]},rt=[...dt.frames||[]];if(Re==="up"){if(Le<=0)return;[rt[Le],rt[Le-1]]=[rt[Le-1],rt[Le]]}else{if(Le>=rt.length-1)return;[rt[Le],rt[Le+1]]=[rt[Le+1],rt[Le]]}dt.frames=rt.map((St,Pt)=>({...St,frameNumber:Pt+1})),Ke[re]=dt,Ce({scenes:Ke})},[le,Ce]),Je=x.useCallback((re,Le)=>{const Re=[...le],Ke={...Re[re]},dt=(Ke.frames||[]).filter((rt,St)=>St!==Le);Ke.frames=dt.map((rt,St)=>({...rt,frameNumber:St+1})),Re[re]=Ke,Ce({scenes:Re})},[le,Ce]),it=x.useCallback(re=>{const Le=le.filter((Re,Ke)=>Ke!==re);Ce({scenes:Le})},[le,Ce]),ct=x.useCallback(re=>{navigator.clipboard.writeText(re),g(s("toast.copied"),"success")},[g,s]),jt=x.useCallback((re,Le)=>{re.stopPropagation(),W(Re=>{const Ke=new Set(re.shiftKey?Re:[]);return Ke.has(Le)?Ke.delete(Le):Ke.add(Le),Ke})},[]),Nn=x.useCallback(re=>{const Le=Te.filter(Re=>Re.id!==re&&Re.index!==re);Ce({characters:Le})},[Te,Ce]);return o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsxs("div",{className:"flex flex-col gap-2 mb-2 flex-shrink-0",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsxs("div",{className:"flex flex-shrink-0 gap-1 h-10 select-none bg-gray-900/50 rounded-lg p-0.5",children:[o.jsx(lt,{title:s("tooltip.model.flash"),position:"top",className:"h-full flex",children:o.jsxs("button",{onClick:()=>Ce({model:"gemini-3-flash-preview"}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all flex items-center justify-center ${ge==="gemini-3-flash-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 mr-1",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})}),"FLASH"]})}),o.jsx(lt,{title:s("tooltip.model.pro"),position:"top",className:"h-full flex",children:o.jsxs("button",{onClick:()=>Ce({model:"gemini-3-pro-preview"}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all flex items-center justify-center ${ge==="gemini-3-pro-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})}),"PRO"]})})]}),o.jsxs("div",{className:"flex flex-shrink-0 gap-1 h-10 select-none bg-gray-900/50 rounded-lg p-0.5",children:[o.jsx(lt,{title:s(`tooltip.lang.${$}`),position:"top",className:"h-full flex",children:o.jsx("button",{onClick:()=>Ce({targetLanguage:$}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all ${J===$?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:$.toUpperCase()})}),o.jsx(lt,{title:s("tooltip.lang.en"),position:"top",className:"h-full flex",children:o.jsx("button",{onClick:()=>Ce({targetLanguage:"en"}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all ${J==="en"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:"EN"})})]}),o.jsxs("button",{onClick:ye?i:Ue,disabled:a,className:`flex-grow h-10 px-4 font-bold text-xs uppercase tracking-wide text-white rounded-lg transition-all duration-200 shadow-sm flex items-center justify-center ${a?"bg-yellow-600 hover:bg-yellow-500":ye?"bg-cyan-600 hover:bg-cyan-500":"bg-emerald-600 hover:bg-emerald-500 disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed"}`,children:[ye?o.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),s(a?"node.action.stopping":ye?"node.content.analyzing":"node.content.analyzeScript")]})]}),o.jsxs("div",{className:"bg-gray-900/50 rounded-md flex-shrink-0 flex flex-col",children:[o.jsxs("div",{className:"p-2 border-b border-gray-800 flex items-center justify-start gap-4",children:[o.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-400",children:[o.jsx("label",{className:"whitespace-nowrap",children:s("node.content.analyzeFromScene")}),o.jsxs("div",{className:"relative w-14 h-7",children:[o.jsx("input",{type:"number",min:"1",placeholder:"1",value:ae||"",onChange:re=>Se(parseInt(re.target.value)||1),className:"w-full h-full pl-2 pr-4 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 focus:outline-none appearance-none text-xs",onMouseDown:re=>re.stopPropagation()}),o.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-4 flex flex-col border-l border-gray-700",children:[o.jsx("button",{onClick:()=>Se((ae||0)+1),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-tr-md focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z",clipRule:"evenodd"})})}),o.jsx("button",{onClick:()=>Se(Math.max(1,(ae||0)-1)),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-br-md border-t border-gray-700 focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]}),o.jsx("label",{className:"whitespace-nowrap",children:s("node.content.analyzeUpToScene")}),o.jsxs("div",{className:"relative w-16 h-7",children:[o.jsx("input",{type:"number",min:"1",placeholder:s("node.content.endPlaceholder"),value:ce||"",onChange:re=>Ee(re.target.value?parseInt(re.target.value):null),className:"w-full h-full pl-2 pr-4 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 focus:outline-none appearance-none text-xs",onMouseDown:re=>re.stopPropagation()}),o.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-4 flex flex-col border-l border-gray-700",children:[o.jsx("button",{onClick:()=>Ee((ce||ae||1)+1),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-tr-md focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z",clipRule:"evenodd"})})}),o.jsx("button",{onClick:()=>Ee((ce||ae||1)-1),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-br-md border-t border-gray-700 focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx("button",{onClick:gt,className:"p-1 text-gray-400 hover:text-white bg-gray-800 rounded hover:bg-gray-700",title:"-5",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),o.jsx("button",{onClick:We,className:"p-1 text-gray-400 hover:text-white bg-gray-800 rounded hover:bg-gray-700",title:"+5",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})}),o.jsx("button",{onClick:Et,className:"p-1 text-gray-400 hover:text-red-400 bg-gray-800 rounded hover:bg-gray-700 ml-1",title:"Clear Range",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),o.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-400 border-l border-gray-700 pl-4",children:[o.jsx("label",{className:"whitespace-nowrap font-bold text-emerald-500/80 uppercase tracking-tight",children:s("node.content.framesPerScene")}),o.jsx("input",{type:"number",min:"1",placeholder:s("node.content.minFrames"),value:B||"",onChange:re=>Ce({minFrames:re.target.value?parseInt(re.target.value):null}),className:"w-10 p-1 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 focus:outline-none appearance-none text-[10px]",onMouseDown:re=>re.stopPropagation(),title:"Minimum frames per scene"}),o.jsx("span",{className:"text-gray-600",children:"-"}),o.jsx("input",{type:"number",min:"1",placeholder:s("node.content.maxFrames"),value:X||"",onChange:re=>Ce({maxFrames:re.target.value?parseInt(re.target.value):null}),className:"w-10 p-1 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 focus:outline-none appearance-none text-[10px]",onMouseDown:re=>re.stopPropagation(),title:"Maximum frames per scene"})]})]}),o.jsxs("div",{className:"px-2 pb-2 flex flex-wrap items-center gap-x-4 gap-y-2 border-b border-gray-800",children:[o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:re=>{re.stopPropagation(),ye||Ce({batchProcessing:!Q})},children:[o.jsx(ft,{id:`batch-processing-${e.id}`,checked:Q,onChange:re=>Ce({batchProcessing:re}),disabled:ye,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-emerald-400 transition-colors",title:s("node.content.batchProcessingInfo"),children:s("node.content.batchProcessing")}),o.jsx(sr,{id:we.BATCH_PROCESSING.id,onClick:q})]}),o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:re=>{re.stopPropagation(),ye||Ce({thinkingEnabled:!je})},children:[o.jsx(ft,{id:`thinking-${e.id}`,checked:je,onChange:re=>Ce({thinkingEnabled:re}),disabled:ye,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-cyan-400 transition-colors",children:s("node.content.thinkingEnabled")}),o.jsx(sr,{id:"thinking_mode",onClick:q})]}),o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:re=>{re.stopPropagation(),ye||Ce({shotFilter:ke==="wideOnly"?"all":"wideOnly"})},children:[o.jsx(ft,{id:`shot-filter-wide-${e.id}`,checked:ke==="wideOnly",onChange:re=>Ce({shotFilter:re?"wideOnly":"all"}),disabled:ye,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-cyan-400 transition-colors",children:s("node.content.shotFilter.wideOnly")}),o.jsx(sr,{id:we.SHOT_FILTER_WIDE.id,onClick:q})]}),o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:re=>{re.stopPropagation(),ye||Ce({extendedAnalysis:!de})},children:[o.jsx(ft,{id:`extended-analysis-${e.id}`,checked:de,onChange:re=>Ce({extendedAnalysis:re}),disabled:ye,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-cyan-400 transition-colors",children:s("node.content.extendedAnalysis")}),o.jsx(sr,{id:we.EXTENDED_VISUALS.id,onClick:q})]}),o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:re=>{re.stopPropagation(),ye||Ce({microActionBreakdown:!Z})},children:[o.jsx(ft,{id:`micro-action-${e.id}`,checked:Z,onChange:re=>Ce({microActionBreakdown:re}),disabled:ye,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-cyan-400 transition-colors",children:s("node.content.microActionBreakdown")}),o.jsx(sr,{id:we.ACTION_PHASE_BREAKDOWN.id,onClick:q})]}),o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:re=>{re.stopPropagation(),ye||Ce({livingWorldEnabled:!oe})},children:[o.jsx(ft,{id:`living-world-${e.id}`,checked:oe,onChange:re=>Ce({livingWorldEnabled:re}),disabled:ye,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-emerald-400 transition-colors",children:s("instruction.rule_living_world")}),o.jsx(sr,{id:we.LIVING_WORLD.id,onClick:q})]}),o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:re=>{re.stopPropagation(),ye||Ce({anthroEnabled:!$e})},children:[o.jsx(ft,{id:`anthro-${e.id}`,checked:$e,onChange:re=>Ce({anthroEnabled:re}),disabled:ye,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-cyan-400 transition-colors",children:s("node.content.anthroEnabled")}),o.jsx(sr,{id:we.ANTHRO_LOGIC.id,onClick:q})]}),o.jsxs("div",{className:"flex items-center gap-2 cursor-pointer group",onClick:re=>{re.stopPropagation(),ye||Ce({subscribeEnhancement:!ze})},children:[o.jsx(ft,{id:`subscribe-${e.id}`,checked:ze,onChange:re=>Ce({subscribeEnhancement:re}),disabled:ye,className:"h-3.5 w-3.5 pointer-events-none"}),o.jsx("label",{className:"text-xs text-gray-400 cursor-pointer select-none font-medium group-hover:text-cyan-400 transition-colors",children:s("node.content.subscribeEnhancement")}),o.jsx(sr,{id:we.SUBSCRIBE_LOGIC.id,onClick:q})]})]}),o.jsxs("div",{className:"p-2 flex items-center justify-between text-xs border-t border-gray-800",children:[o.jsx("div",{className:"font-semibold text-emerald-400",children:s("node.content.frames_analyzed",{count:Fe})}),o.jsxs("div",{className:"flex items-center gap-4 text-gray-400",children:[be&&o.jsx("div",{className:"text-gray-500 font-medium",children:be}),De&&o.jsxs(o.Fragment,{children:[ye?o.jsx("div",{className:"text-yellow-400 animate-pulse font-mono",children:s("node.content.status.batch",{current:De.current,total:De.total})}):null,o.jsxs("div",{className:"text-gray-400 font-mono text-[10px]",children:[" (): (: ",ie.last,") / : ",ie.current," / : ",ie.total]})]})]})]}),ye&&De&&o.jsx("div",{className:"w-full h-1 bg-gray-800 rounded-b-md overflow-hidden border-t border-gray-800",children:o.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-300 ease-out",style:{width:`${De.current/Math.max(1,De.total)*100}%`}})}),o.jsx(p5,{uiState:Ge,onUpdateUiState:Qe,onUpdateValue:Ce,hierarchyEnabled:Y,mandatoryBgEnabled:K,statePersistenceEnabled:V,livingWorldEnabled:oe,extendedAnalysis:de,microActionBreakdown:Z,batchProcessing:Q,professionalStoryboard:j,cinematographyEnabled:fe,safeGeneration:Pe,thinkingEnabled:je,shotFilter:ke,anthroEnabled:$e,subscribeEnhancement:ze,anatomicalStrictness:nt,propConsistency:at,t:s,initialHeight:me||380,onHeightChange:re=>Ce({settingsPaneHeight:re}),scale:ue.scale,model:ge,targetLanguage:J,minFrames:B,maxFrames:X,framesPerScene:F,targetScrollId:D,onSetTargetScrollId:G})]})]}),o.jsx(g5,{uiState:Ge,initialHeight:Oe||170,onHeightChange:re=>Ce({characterPaneHeight:re}),scale:ue.scale,onUpdateUiState:Qe,onUpdateValue:Ce,onApplyAliases:h,nodeId:e.id,autoIndexCharacters:he,charactersToDisplay:Te,selectedCharacters:O,collapsedCharacters:z,areAllCharactersCollapsed:Te.length>0&&z.size===Te.length,onToggleAllCharacters:()=>{z.size===Te.length?L(new Set):L(new Set(Te.map(re=>re.id||re.name)))},handleCharacterClick:(re,Le)=>{U(Re=>{const Ke=new Set(Re);return Ke.has(Le)?Ke.delete(Le):Ke.add(Le),Ke})},handleToggleCharacterCollapse:re=>{L(Le=>{const Re=new Set(Le);return Re.has(re)?Re.delete(re):Re.add(re),Re})},updateCharacter:(re,Le,Re)=>{const Ke=Te.map(dt=>dt.id===re||dt.index===re?{...dt,[Le]:Re}:dt);Ce({characters:Ke})},visualStyle:xe,upstreamVisualStyle:(v==null?void 0:v.generatedStyle)||"",deselectAllNodes:m,t:s,onEmbedCharacter:re=>{const Le=Te.map(Re=>{if(Re.id===re.id||Re.index===re.index){const{isLinked:Ke,...dt}=Re;return{...dt,id:`detached-${Date.now()}-${Re.id||Math.random()}`}}return Re});Ce({characters:Le})},onSyncCharacters:_e,isSyncAvailable:!0,onMoveCharacter:()=>{},onClearCharacters:()=>Ce({characters:[]}),onDeleteCharacter:Nn}),o.jsxs("div",{className:"flex-grow flex flex-row min-h-0 items-stretch bg-gray-900 rounded-b-md overflow-hidden border-t border-gray-600",children:[o.jsx(y5,{width:`calc(${I}% - 0.5rem)`,upstreamScriptData:v,collapsedInputScenes:w,isSummaryCollapsed:f,onToggleInputSceneCollapse:re=>{b(Le=>{const Re=new Set(Le);return Re.has(re)?Re.delete(re):Re.add(re),Re})},setIsSummaryCollapsed:T,t:s,onToggleAllInputScenes:It,areAllInputScenesCollapsed:((Kt=v==null?void 0:v.scenes)==null?void 0:Kt.length)>0&&w.size===v.scenes.length}),o.jsx("div",{onMouseDown:pe,className:"w-2 mx-1 cursor-col-resize bg-gray-600 hover:bg-emerald-500 transition-colors flex-shrink-0 rounded-full"}),o.jsx(b5,{width:`calc(${100-I}% - 0.5rem)`,scenes:le,characters:Te,areAllOutputScenesCollapsed:le.length>0&&R.size===le.length,areAllFramesCollapsed:le.length>0&&A.size>0,collapsedOutputScenes:R,collapsedFrames:A,collapsedContexts:P,selectedFrames:H,onToggleAllOutputScenes:Mt,onToggleAllFramesCollapse:xt,onToggleOutputSceneCollapse:re=>{N(Le=>{const Re=new Set(Le);return Re.has(re)?Re.delete(re):Re.add(re),Re})},onToggleSceneContextCollapse:re=>{M(Le=>{const Re=new Set(Le);return Re.has(re)?Re.delete(re):Re.add(re),Re})},onToggleCollapse:re=>{k(Le=>{const Re=new Set(Le);return Re.has(re)?Re.delete(re):Re.add(re),Re})},onAddFrame:Bt,onAddScene:en,onRenameScene:ve,onReorderFrame:Be,onDeleteFrame:Je,onFramePartChange:cn,onSceneContextChange:Ft,onFrameClick:jt,onCopy:ct,handleTextFocus:m,t:s,onDeleteScene:it})]})]})},Rt=x.forwardRef(({label:e,text:t,translatedText:n,isCritical:r,isEnabled:a=!0,isMandatory:i=!1,onToggle:s,color:l="emerald",className:c="",index:d,isHighlighted:h},g)=>{const[m,_]=x.useState(!1);let y="",v="",C="",w="",b="",f="";if(!a)y="bg-gray-800/20",v="border-gray-700",C="text-gray-500",w="bg-gray-700",b="text-gray-500",f="bg-gray-800 text-gray-600";else if(r)y="bg-red-900/20",v="border-red-800/50",C="text-red-400",w="bg-red-500",b="text-gray-300",f="bg-red-900/50 text-red-200";else if(i)y="bg-gray-800",v="border-gray-600",C="text-emerald-400",w="bg-gray-500",b="text-gray-300",f="bg-gray-700 text-gray-400";else switch(b="text-gray-300",l){case"cyan":y="bg-cyan-900/20",v="border-cyan-700/50",C="text-cyan-400",w="bg-cyan-500",f="bg-cyan-900/50 text-cyan-200";break;case"purple":y="bg-purple-900/20",v="border-purple-700/50",C="text-purple-400",w="bg-purple-500",f="bg-purple-900/50 text-purple-200";break;default:y="bg-emerald-900/20",v="border-emerald-700/50",C="text-emerald-400",w="bg-emerald-500",f="bg-emerald-900/50 text-emerald-200"}h&&(v="border-yellow-400 ring-1 ring-yellow-400/50",y="bg-yellow-900/30");const T=I=>{I.stopPropagation(),navigator.clipboard.writeText(t),_(!0),setTimeout(()=>_(!1),1500)};return o.jsxs("div",{ref:g,onMouseDown:I=>I.stopPropagation(),onClick:()=>!i&&s&&s(),className:`flex flex-row p-2 rounded border text-xs transition-all relative overflow-hidden group select-none items-stretch gap-3 ${y} ${v} ${c} flex-shrink-0 ${i?"":"cursor-pointer hover:border-opacity-100 hover:shadow-sm"} duration-300`,children:[d!==void 0&&o.jsxs("div",{className:"flex-shrink-0 w-6 flex flex-col items-center justify-start pt-0.5",children:[o.jsx("div",{className:`text-[9px] font-mono font-bold w-5 h-5 flex items-center justify-center rounded-full ${f}`,children:d}),o.jsx("div",{className:`w-px flex-grow mt-1 ${a?"bg-gray-700":"bg-transparent"}`})]}),o.jsxs("div",{className:"flex flex-col flex-grow min-w-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[d===void 0&&o.jsx("div",{className:`w-1.5 h-1.5 rounded-full flex-shrink-0 ${w}`}),o.jsx("div",{className:`font-bold uppercase tracking-wider text-[10px] leading-tight ${C}`,children:e})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:T,className:`p-0.5 rounded transition-colors ${a?"text-gray-500 hover:text-white":"text-gray-600 hover:text-gray-400"}`,title:"Copy Prompt Text",children:m?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),!i&&o.jsx("div",{className:`text-[9px] uppercase font-mono px-1 rounded ${a?"text-white bg-white/10":"text-gray-600 bg-black/20"}`,children:a?"ON":"OFF"})]})]}),o.jsx("div",{className:`leading-tight ${a?"text-gray-300":"text-gray-600"} text-[10px] mb-1`,children:t}),n&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-gray-600/30 my-1 w-full"}),o.jsx("div",{className:`text-[9px] italic leading-tight ${b} opacity-70`,children:n})]})]}),o.jsx("div",{className:`absolute bottom-0 left-0 w-full h-[2px] opacity-30 ${w}`})]})}),Pn=_t.memo(({id:e,onClick:t,t:n})=>o.jsx(lt,{title:n("node.action.locateInStack"),position:"left",children:o.jsx("button",{onClick:r=>{r.stopPropagation(),t(r,e)},className:"ml-auto p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})})),_5=({uiState:e,onUpdateUiState:t,onUpdateValue:n,nodeId:r,t:a,deselectAllNodes:i,numberOfScenes:s,visualStyle:l,customVisualStyle:c,genre:d,genre2:h,characterType:g,narratorMode:m,narratorEnabled:_,noCharacters:y,useExistingCharacters:v,isCharactersInputConnected:C,linkedCharactersCount:w,isDetailedPlot:b,includeSubscribeScene:f,model:T,isLoading:I,targetLanguage:E,prompt:R,allCharacters:N,estimateFrames:A=!0,safeGeneration:k=!1,thinkingEnabled:P=!1,scenelessMode:M=!1,simpleActions:H=!1,commercialSafe:W=!1,smartConceptEnabled:O=!0,atmosphericEntryEnabled:U=!0,generateMainChars:z,createSecondaryChars:L,createKeyItems:D,onToggleGenerateMainChars:G,onToggleCreateSecondaryChars:q,onToggleCreateKeyItems:ie,targetScrollId:te,onSetTargetScrollId:ye})=>{const[ue,$]=x.useState(""),[ee,Te]=x.useState(null),le=x.useRef({}),J=x.useRef(null),ge=x.useCallback((j,fe)=>{$(""),requestAnimationFrame(()=>{setTimeout(()=>{const Pe=le.current[fe],je=J.current;if(Pe&&je){const $e=Pe.offsetTop-40;je.scrollTo({top:Math.max(0,$e),behavior:"smooth"}),Te(fe),setTimeout(()=>Te(null),2e3)}},50)})},[]),ae=j=>j==="gemini-3-flash-preview"?"Gemini 3 Flash Preview":j==="gemini-3-pro-preview"?"Gemini 3 Pro Preview":j,ce=j=>({ru:"",en:"English",es:"Espaol",fr:"Franais",de:"Deutsch",it:"Italian",pt:"Portugus",zh:"",ja:"",ko:"",uz:"Ozbek",tr:"Trke"})[j]||j.toUpperCase(),B=j=>({general:"General",comedy:"Comedy",drama:"Drama",action:"Action",scifi:"Sci-Fi",fantasy:"Fantasy",horror:"Horror",thriller:"Thriller",childrens_animation:"Children's Animation",shorts_story:"Shorts Story",scientific_historical:"Scientific Historical"})[j]||j,X=j=>({none:"None",simple:"Simple",realistic:"Realistic","3d_cartoon":"3D Cartoon","3d_realistic":"3D Realistic","2d_animation":"2D Animation",anime:"Anime",comics:"Comics",custom:"Custom"})[j]||j,F=x.useMemo(()=>["general","comedy","drama","action","scifi","fantasy","horror","thriller","childrens_animation","shorts_story","scientific_historical"].map(j=>({value:j,label:a(`genre.${j}`)})),[a]),Y=x.useMemo(()=>[{value:"",label:a("node.content.style.none")},{value:"simple",label:a("node.content.style.simple")},{value:"realistic",label:a("node.content.style.realistic")},{value:"3d_cartoon",label:a("node.content.style.3d_cartoon")},{value:"3d_realistic",label:a("node.content.style.3d_realistic")},{value:"2d_animation",label:a("node.content.style.2d_animation")},{value:"anime",label:a("node.content.style.anime")},{value:"comics",label:a("node.content.style.comics")},{value:"custom",label:a("node.content.style.custom")}],[a]),K=x.useMemo(()=>[{value:"simple",label:a("node.content.characterType.simple")},{value:"anthro",label:a("node.content.characterType.anthro")}],[a]),V=x.useMemo(()=>[{value:"normal",label:a("node.content.narratorMode.normal")},{value:"dual",label:a("node.content.narratorMode.dual")},{value:"first_person",label:a("node.content.narratorMode.first_person")}],[a]),oe=j=>{n({numberOfScenes:Math.max(1,j)})},de=j=>{j.stopPropagation(),n({characterType:"simple",useExistingCharacters:!1,narratorEnabled:!0,narratorMode:"normal",isAdvancedMode:!1,numberOfScenes:null,isDetailedPlot:!1,genre:"general",noCharacters:!1,genre2:"general",model:"gemini-3-flash-preview",includeSubscribeScene:!1,visualStyle:"none",customVisualStyle:"",estimateFrames:!0,safeGeneration:!1,thinkingEnabled:!1,scenelessMode:!1,simpleActions:!1,commercialSafe:!1,smartConceptEnabled:!0,atmosphericEntryEnabled:!0,generateMainChars:!0,createSecondaryChars:!0,createKeyItems:!0})},Z=(j,fe)=>{if(!ue)return!0;const Pe=ue.toLowerCase();return j.toLowerCase().includes(Pe)||fe.toLowerCase().includes(Pe)};let Q=0;return o.jsxs("div",{className:`border border-gray-600 hover:border-gray-200 rounded-md bg-gray-900 overflow-hidden flex-shrink-0 flex flex-col transition-colors duration-200 ${e.isSettingsCollapsed?"":"h-[400px]"}`,children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>t({isSettingsCollapsed:!e.isSettingsCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-1.533 2.16-1.535.113-1.535 2.322 0 2.435 1.594.118 2.073 1.274 1.533 2.16-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.948c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.948c1.372.836 2.942-.734 2.106-2.106-.54-.886-.061-2.042 1.533-2.16 1.535-.113 1.535-2.322 0-2.435-1.594-.118-2.073-1.274-1.533-2.16.836-1.372-.734-2.942-2.106-2.106a1.533 1.533 0 01-2.287-.948zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})}),o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:a("node.content.parameters")})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ie,{title:a("toolbar.resetToDefault"),onClick:de,tooltipPosition:"left",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Ie,{tooltipPosition:"left",title:e.isSettingsCollapsed?a("node.action.expand"):a("node.action.collapse"),onClick:j=>{j.stopPropagation(),t({isSettingsCollapsed:!e.isSettingsCollapsed})},children:e.isSettingsCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!e.isSettingsCollapsed&&o.jsxs("div",{className:"flex flex-row flex-grow min-h-0 bg-gray-800/50",onWheel:j=>j.stopPropagation(),children:[o.jsxs("div",{className:"w-1/2 p-2 space-y-3 border-r border-gray-600 overflow-y-auto custom-scrollbar",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsx("label",{htmlFor:`num-scenes-${r}`,className:"block text-xs font-medium text-gray-400 truncate",children:a("node.content.numberOfScenes")}),o.jsx(Pn,{id:"sg_scene_count",onClick:ge,t:a})]}),o.jsxs("div",{className:"relative w-full h-9",children:[o.jsx("input",{id:`num-scenes-${r}`,type:"number",min:"1",value:s??"",onChange:j=>n({numberOfScenes:j.target.value?parseInt(j.target.value):null}),placeholder:a("node.content.numberOfScenes.auto"),className:"w-full h-full pl-3 pr-6 bg-gray-700 border border-gray-600 text-white rounded-md text-sm focus:ring-2 focus:ring-emerald-500 focus:outline-none appearance-none"}),o.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-6 flex flex-col border-l border-gray-600",children:[o.jsx("button",{onClick:()=>oe((s||0)+1),className:"h-1/2 hover:bg-gray-600 text-gray-400 hover:text-white flex items-center justify-center rounded-tr-md focus:outline-none",onMouseDown:j=>j.stopPropagation(),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z",clipRule:"evenodd"})})}),o.jsx("button",{onClick:()=>oe((s||0)-1),className:"h-1/2 hover:bg-gray-600 text-gray-400 hover:text-white flex items-center justify-center rounded-br-md border-t border-gray-600 focus:outline-none",onMouseDown:j=>j.stopPropagation(),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsx("label",{className:"block text-xs font-medium text-gray-400 truncate",children:a("node.content.style")}),o.jsx(Pn,{id:"sg_visual_style",onClick:ge,t:a})]}),o.jsx(Yn,{value:l,onChange:j=>n({visualStyle:j}),options:Y,disabled:I,id:`style-select-${r}`})]})]}),l==="custom"&&o.jsxs("div",{className:"flex flex-col space-y-1 pt-1 border-t border-gray-700/50",children:[o.jsx("label",{htmlFor:`custom-style-input-${r}`,className:"text-xs text-gray-400",children:a("node.content.style.custom")}),o.jsx("textarea",{id:`custom-style-input-${r}`,value:c,onChange:j=>n({customVisualStyle:j.target.value}),onMouseDown:j=>j.stopPropagation(),onFocus:i,rows:2,className:"w-full p-1 bg-gray-800 text-white rounded-md text-xs focus:ring-2 focus:ring-emerald-500 focus:outline-none custom-scrollbar resize-none",placeholder:"..."})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6 bg-gray-800/50 rounded px-2 border border-gray-700",children:[o.jsx(ft,{id:`sceneless-mode-${r}`,checked:M,onChange:j=>n({scenelessMode:j}),disabled:I,className:"h-3.5 w-3.5"}),o.jsx("label",{className:"text-xs text-emerald-400 font-bold select-none truncate cursor-pointer flex-grow",htmlFor:`sceneless-mode-${r}`,children:a("node.content.scenelessMode")}),o.jsx(Pn,{id:"sceneless_mode",onClick:ge,t:a})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsx("label",{className:`block text-xs font-medium text-gray-400 truncate ${M?"opacity-50":""}`,children:a("node.content.genre")}),o.jsx(Pn,{id:"sg_genre",onClick:ge,t:a})]}),o.jsx(Yn,{value:d,onChange:j=>n({genre:j}),options:F,id:`genre-select-${r}`,disabled:M})]}),o.jsxs("div",{children:[o.jsx("label",{className:`block text-xs font-medium text-gray-400 mb-1 truncate ${M?"opacity-50":""}`,children:a("node.content.genre2")}),o.jsx(Yn,{value:h,onChange:j=>n({genre2:j}),options:F,id:`genre2-select-${r}`,disabled:M})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsx("label",{className:"text-xs text-gray-400 truncate",children:a("node.content.characterType")}),o.jsx(Pn,{id:"sg_anthro",onClick:ge,t:a})]}),o.jsx(Yn,{value:g,onChange:j=>n({characterType:j}),options:K,disabled:I,id:`char-type-select-${r}`})]}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("label",{className:`text-xs text-gray-400 mb-1 truncate transition-opacity ${_?"opacity-100":"opacity-50"}`,children:a("node.content.narratorMode")}),o.jsx(Yn,{value:m,onChange:j=>n({narratorMode:j}),options:V,disabled:!_||I,id:`narrator-mode-${r}`})]})]}),o.jsxs("div",{className:"grid grid-cols-1 gap-y-1",children:[o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(ft,{id:`thinking-enabled-${r}`,checked:P,onChange:j=>n({thinkingEnabled:j}),disabled:I,className:"h-3.5 w-3.5"}),o.jsx("label",{className:"text-xs text-gray-300 select-none truncate cursor-pointer hover:text-cyan-400 transition-colors flex-grow",htmlFor:`thinking-enabled-${r}`,children:a("node.content.thinkingEnabled")}),o.jsx(Pn,{id:"thinking_mode",onClick:ge,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(ft,{id:`safe-gen-${r}`,checked:k,onChange:j=>n({safeGeneration:j}),disabled:I,className:"h-3.5 w-3.5"}),o.jsx("label",{className:"text-xs text-gray-300 select-none truncate cursor-pointer hover:text-emerald-400 transition-colors flex-grow",htmlFor:`safe-gen-${r}`,children:a("node.content.safeGeneration")}),o.jsx(Pn,{id:"safe_gen",onClick:ge,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(ft,{id:`commercial-safe-${r}`,checked:W,onChange:j=>n({commercialSafe:j}),disabled:I,className:"h-3.5 w-3.5"}),o.jsx("label",{className:"text-xs text-gray-300 select-none truncate cursor-pointer hover:text-emerald-400 transition-colors flex-grow",htmlFor:`commercial-safe-${r}`,children:a("node.content.commercialSafe")}),o.jsx(Pn,{id:qe.COMMERCIAL_SAFE.id,onClick:ge,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(ft,{id:`smart-concept-${r}`,checked:O,onChange:j=>n({smartConceptEnabled:j}),disabled:I,className:"h-3.5 w-3.5"}),o.jsx("label",{className:"text-xs text-gray-300 select-none truncate cursor-pointer hover:text-cyan-400 transition-colors flex-grow",htmlFor:`smart-concept-${r}`,children:a("node.content.smartConcept")}),o.jsx(Pn,{id:"char_smart_concept",onClick:ge,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(ft,{id:`atmospheric-entry-${r}`,checked:U,onChange:j=>n({atmosphericEntryEnabled:j}),disabled:I||M,className:"h-3.5 w-3.5"}),o.jsx("label",{className:`text-xs text-gray-300 select-none truncate cursor-pointer hover:text-emerald-400 transition-colors flex-grow ${M?"opacity-50":""}`,htmlFor:`atmospheric-entry-${r}`,children:a("instruction.sg_exposition")}),o.jsx(Pn,{id:qe.EXPOSITION.id,onClick:ge,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(ft,{id:`no-characters-${r}`,checked:y,onChange:j=>{n({noCharacters:j,useExistingCharacters:j?!1:v})},disabled:I||C,className:"h-3.5 w-3.5"}),o.jsx("label",{className:`text-xs text-gray-300 select-none truncate cursor-pointer flex-grow ${C?"opacity-50 cursor-not-allowed":""}`,htmlFor:`no-characters-${r}`,children:a("node.content.noCharacters")}),o.jsx(Pn,{id:"sg_no_chars",onClick:ge,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(ft,{id:`use-existing-${r}`,checked:v||C,onChange:j=>n({useExistingCharacters:j}),disabled:I||y||C,className:"h-3.5 w-3.5"}),o.jsxs("label",{className:`text-xs text-gray-300 select-none truncate cursor-pointer flex-grow ${y?"opacity-50":""} ${C?"cursor-not-allowed text-emerald-400":""}`,htmlFor:`use-existing-${r}`,children:[a("node.content.useExistingCharacters"),C&&" (Locked by connection)"]}),C&&w>0&&o.jsx("span",{className:"text-[10px] text-emerald-400 font-mono bg-emerald-900/30 px-1.5 py-0.5 rounded ml-1",title:"Connected Characters Count",children:w}),o.jsx(Pn,{id:"no_duplicates",onClick:ge,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(ft,{id:`narrator-enabled-${r}`,checked:_,onChange:j=>n({narratorEnabled:j}),className:"h-3.5 w-3.5"}),o.jsx("label",{className:"text-xs text-gray-300 select-none truncate cursor-pointer flex-grow",htmlFor:`narrator-enabled-${r}`,children:a("node.content.narratorEnabled")}),o.jsx(Pn,{id:"sg_narrator",onClick:ge,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(ft,{id:`simple-actions-${r}`,checked:H,onChange:j=>n({simpleActions:j}),className:"h-3.5 w-3.5"}),o.jsx("label",{className:"text-xs text-emerald-300 font-medium select-none truncate cursor-pointer flex-grow",htmlFor:`simple-actions-${r}`,children:a("node.content.simpleActions")}),o.jsx(Pn,{id:"sg_simple_actions",onClick:ge,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(ft,{id:`detailed-plot-${r}`,checked:b,onChange:j=>n({isDetailedPlot:j}),disabled:M,className:"h-3.5 w-3.5"}),o.jsx("label",{className:`text-xs text-gray-300 select-none truncate cursor-pointer flex-grow ${M?"opacity-50":""}`,htmlFor:`detailed-plot-${r}`,children:a("node.content.detailedPlot")}),o.jsx(Pn,{id:"sg_detailed_plot",onClick:ge,t:a})]}),o.jsxs("div",{className:"flex items-center space-x-2 h-6",children:[o.jsx(ft,{id:`subscribe-scene-${r}`,checked:f,onChange:j=>n({includeSubscribeScene:j}),disabled:M,className:"h-3.5 w-3.5"}),o.jsx("label",{className:`text-xs text-gray-300 select-none truncate cursor-pointer flex-grow ${M?"opacity-50":""}`,htmlFor:`subscribe-scene-${r}`,children:a("node.content.includeSubscribeScene")}),o.jsx(Pn,{id:"sg_subscribe",onClick:ge,t:a})]})]})]}),o.jsxs("div",{className:"w-1/2 flex flex-col relative",children:[o.jsx("div",{className:"p-2 border-b border-gray-700 bg-gray-800/80 sticky top-0 z-10 flex items-center gap-2",children:o.jsxs("div",{className:"relative w-full",children:[o.jsx("input",{type:"text",value:ue,onChange:j=>$(j.target.value),placeholder:a("node.content.findStack"),className:"w-full pl-7 pr-2 py-1 text-xs bg-gray-900/80 border border-gray-600 rounded-md focus:outline-none focus:border-emerald-500 text-gray-300 placeholder-gray-600"}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 absolute left-2 top-1/2 -translate-y-1/2 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),ue&&o.jsx("button",{onClick:()=>$(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white",children:""})]})}),o.jsxs("div",{ref:J,className:"p-2 overflow-y-auto custom-scrollbar space-y-1 flex-grow relative",children:[o.jsx("h5",{className:"text-[10px] text-gray-500 uppercase font-bold mb-1 border-b border-gray-700 pb-1",children:a("node.content.scriptGenerationStack")}),o.jsxs("div",{className:"space-y-1 pb-2 mb-2 border-b border-gray-700/30",children:[Z(T,a("node.content.model"))&&o.jsx(Rt,{ref:j=>{le.current["model-brick"]=j},id:"model-brick",label:a("node.content.model"),text:ae(T),isMandatory:!0,color:"gray",isHighlighted:ee==="model-brick"}),Z(a(`instruction.${qe.INPUTS_DATA.id}`),a(`instruction.${qe.INPUTS_DATA.id}`))&&o.jsx(Rt,{label:a(`instruction.${qe.INPUTS_DATA.id}`),text:qe.INPUTS_DATA.text,translatedText:a(`instruction.desc.${qe.INPUTS_DATA.id}`),isMandatory:!0,color:"gray",index:++Q}),Z(ce(E),a("node.content.targetLanguage"))&&o.jsx(Rt,{ref:j=>{le.current.target_lang=j},id:"target_lang",index:++Q,label:a("node.content.targetLanguage"),text:`Target Language: ${Bn(E)}`,translatedText:ce(E),isMandatory:!0,color:"gray",isHighlighted:ee==="target_lang"}),Z("Thinking Mode",a("node.content.thinkingEnabled"))&&o.jsx(Rt,{ref:j=>{le.current.thinking_mode=j},id:"thinking_mode",index:P?++Q:void 0,label:a("node.content.thinkingEnabled"),text:"Enable extended reasoning for deeper plot coherence.",translatedText:"  .",isEnabled:P,onToggle:()=>n({thinkingEnabled:!P}),color:"cyan",isHighlighted:ee==="thinking_mode"})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:a("node.content.sg_stack.priming")}),Z(Qo.text,a("node.content.safeGeneration"))&&o.jsx(Rt,{ref:j=>{le.current.safe_gen=j},id:"safe_gen",index:k?++Q:void 0,label:a("node.content.safeGeneration"),text:Qo.text,translatedText:a("instruction.desc.safe_gen"),isCritical:!0,isEnabled:k,onToggle:()=>n({safeGeneration:!k}),isHighlighted:ee==="safe_gen"}),Z(qe.COMMERCIAL_SAFE.text,a("node.content.commercialSafe"))&&o.jsx(Rt,{ref:j=>{le.current[qe.COMMERCIAL_SAFE.id]=j},id:qe.COMMERCIAL_SAFE.id,index:W?++Q:void 0,label:a("node.content.commercialSafe"),text:qe.COMMERCIAL_SAFE.text,translatedText:a("instruction.desc.commercial_safe"),isCritical:!0,isEnabled:W,onToggle:()=>n({commercialSafe:!W}),isHighlighted:ee===qe.COMMERCIAL_SAFE.id}),Z(qe.CORE.text,a(`instruction.${qe.CORE.id}`))&&o.jsx(Rt,{ref:j=>{le.current[qe.CORE.id]=j},id:qe.CORE.id,index:++Q,label:a(`instruction.${qe.CORE.id}`),text:qe.CORE.text,translatedText:a(`instruction.desc.${qe.CORE.id}`),isMandatory:!0,color:"emerald",isHighlighted:ee===qe.CORE.id}),Z(qe.ANTI_COMPRESSION.text,a(`instruction.${qe.ANTI_COMPRESSION.id}`))&&o.jsx(Rt,{ref:j=>{le.current[qe.ANTI_COMPRESSION.id]=j},id:qe.ANTI_COMPRESSION.id,index:++Q,label:a(`instruction.${qe.ANTI_COMPRESSION.id}`),text:qe.ANTI_COMPRESSION.text,translatedText:a(`instruction.desc.${qe.ANTI_COMPRESSION.id}`),isMandatory:!0,color:"emerald",isHighlighted:ee===qe.ANTI_COMPRESSION.id}),Z(qe.SCENELESS_MODE.text,a("instruction.sceneless_mode"))&&o.jsx(Rt,{ref:j=>{le.current.sceneless_mode=j},id:"sceneless_mode",index:M?++Q:void 0,label:a("instruction.sceneless_mode"),text:qe.SCENELESS_MODE.text,translatedText:a("instruction.desc.sceneless_mode"),isEnabled:M,onToggle:()=>n({scenelessMode:!M}),color:M?"emerald":"gray",isHighlighted:ee==="sceneless_mode"})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:a("node.content.sg_stack.narrative")}),(M?[qe.VISUALS_FIRST,qe.ATMOSPHERE]:[qe.ANALYSIS,qe.IMPROVE_CONCEPT,qe.EXPOSITION,qe.VISUALS_FIRST,qe.SEAMLESS_FLOW,qe.ATMOSPHERE,qe.DELAYED_REVEAL,qe.VISUAL_METAPHOR,qe.PACING_RHYTHM,qe.SUBTEXT]).map(j=>j.id===qe.EXPOSITION.id?Z(j.text,a(`instruction.${j.id}`))&&o.jsx(Rt,{ref:fe=>{le.current[j.id]=fe},id:j.id,index:U?++Q:void 0,label:a(`instruction.${j.id}`),text:j.text,translatedText:a(`instruction.desc.${j.id}`),isEnabled:U,onToggle:()=>n({atmosphericEntryEnabled:!U}),color:"emerald",isHighlighted:ee===j.id},j.id):Z(j.text,a(`instruction.${j.id}`))&&o.jsx(Rt,{ref:fe=>{le.current[j.id]=fe},id:j.id,index:++Q,label:a(`instruction.${j.id}`)||j.label,text:j.text,translatedText:a(`instruction.desc.${j.id}`),isMandatory:!0,color:j.id==="rule_visuals"||j.id==="rule_flow"||j.id==="rule_atmosphere"?"gray":"emerald",isHighlighted:ee===j.id},j.id))]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:a("node.content.sg_stack.world")}),Z(qe.LIVING_WORLD.text,a("instruction.sg_living_world"))&&o.jsx(Rt,{ref:j=>{le.current.sg_living_world=j},id:"sg_living_world",index:++Q,label:a("instruction.sg_living_world"),text:g==="anthro"?"EXTRAS: Anthropomorphic animals of various species.":"EXTRAS: Human crowd appropriate to setting.",translatedText:a(g==="anthro"?"instruction.desc.sg_living_world_anthro":"instruction.desc.sg_living_world_simple"),isMandatory:!0,color:"emerald",isHighlighted:ee==="sg_living_world"}),Z(wt.SMART_CONCEPT.text,a(`instruction.${wt.SMART_CONCEPT.id}`))&&o.jsx(Rt,{ref:j=>{le.current[wt.SMART_CONCEPT.id]=j},id:wt.SMART_CONCEPT.id,index:O?++Q:void 0,label:a(`instruction.${wt.SMART_CONCEPT.id}`),text:wt.SMART_CONCEPT.text,translatedText:a(`instruction.desc.${wt.SMART_CONCEPT.id}`),isEnabled:O,onToggle:()=>n({smartConceptEnabled:!O}),color:"gray",isHighlighted:ee===wt.SMART_CONCEPT.id},wt.SMART_CONCEPT.id),[qe.VISUAL_DNA,wt.DETAILED_STYLE].map(j=>Z(j.text,a(`instruction.${j.id}`))&&o.jsx(Rt,{ref:fe=>{le.current[j.id]=fe},id:j.id,index:++Q,label:a(`instruction.${j.id}`)||j.label,text:j.text,translatedText:a(`instruction.desc.${j.id}`),isMandatory:!0,color:j.id==="sg_visual_dna"?"cyan":"emerald",isHighlighted:ee===j.id},j.id)),Z(qe.FRAME_ESTIMATION.text,a("node.content.recommendedFrames"))&&o.jsx(Rt,{ref:j=>{le.current.sg_frame_estimation=j},id:"sg_frame_estimation",index:++Q,label:a("node.content.recommendedFrames"),text:qe.FRAME_ESTIMATION.text,translatedText:a("instruction.desc.sg_frame_estimation"),isMandatory:!0,color:"emerald",isHighlighted:ee==="sg_frame_estimation"}),Z(a("instruction.sg_visual_style"),a("instruction.sg_visual_style"))&&o.jsx(Rt,{ref:j=>{le.current.sg_visual_style=j},id:"sg_visual_style",index:l&&l!=="none"?++Q:void 0,label:a("instruction.sg_visual_style"),text:`Request: Generate visual style based on '${l==="custom"?c:X(l)}'.`,translatedText:a("instruction.desc.sg_visual_style",{style:l==="custom"?c:a(`node.content.style.${l||"none"}`)}),isEnabled:!!l&&l!=="none",onToggle:()=>n({visualStyle:l!=="none"?"":"simple"}),color:"cyan",isHighlighted:ee==="sg_visual_style"}),Z(a("instruction.sg_anthro"),a("instruction.sg_anthro"))&&o.jsx(Rt,{ref:j=>{le.current.sg_anthro=j},id:"sg_anthro",index:g==="anthro"?++Q:void 0,label:a("instruction.sg_anthro"),text:"Characters MUST be animals with human traits.",translatedText:a("instruction.desc.sg_anthro"),isEnabled:g==="anthro",onToggle:()=>n({characterType:g==="anthro"?"simple":"anthro"}),color:"cyan",isHighlighted:ee==="sg_anthro"}),Z(a("instruction.sg_genre"),a("instruction.sg_genre"))&&o.jsx(Rt,{ref:j=>{le.current.sg_genre=j},id:"sg_genre",index:!M&&(d!=="general"||h!=="general")?++Q:void 0,label:a("instruction.sg_genre"),text:`Context: ${B(d)}${h!=="general"?` + ${B(h)}`:""}`,translatedText:a("instruction.desc.sg_genre",{genre:`${a(`genre.${d}`)} ${h!=="general"?`+ ${a(`genre.${h}`)}`:""}`}),isEnabled:!M&&(d!=="general"||h!=="general"),onToggle:()=>{n(d!=="general"||h!=="general"?{genre:"general",genre2:"general"}:{genre:"comedy"})},color:"cyan",isHighlighted:ee==="sg_genre"})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:a("node.content.sg_stack.constraints")}),Z(a("instruction.sg_simple_actions"),a("instruction.sg_simple_actions"))&&o.jsx(Rt,{ref:j=>{le.current.sg_simple_actions=j},id:"sg_simple_actions",index:H?++Q:void 0,label:a("instruction.sg_simple_actions"),text:qe.SIMPLE_ACTIONS.text,translatedText:a("instruction.desc.sg_simple_actions"),isEnabled:H,onToggle:()=>n({simpleActions:!H}),color:"emerald",isCritical:!0,isHighlighted:ee==="sg_simple_actions"}),Z(a("instruction.sg_no_chars"),a("instruction.sg_no_chars"))&&o.jsx(Rt,{ref:j=>{le.current.sg_no_chars=j},id:"sg_no_chars",index:y?++Q:void 0,label:a("instruction.sg_no_chars"),text:"Focus on events/documentary style.",translatedText:a("instruction.desc.sg_no_chars"),isEnabled:y,onToggle:()=>n({noCharacters:!y}),color:"emerald",isHighlighted:ee==="sg_no_chars"}),!y&&Z(a("node.content.useExistingCharacters"),a("node.content.useExistingCharacters"))&&o.jsx(Rt,{ref:j=>{le.current.use_existing=j},id:"use_existing",index:v?++Q:void 0,label:a("node.content.useExistingCharacters"),text:"Use connected character profiles.",translatedText:a("node.content.useExistingCharactersInfo"),isEnabled:v,onToggle:()=>{C||n({useExistingCharacters:!v})},color:"cyan",isHighlighted:ee==="use_existing"}),!y&&o.jsx(o.Fragment,{children:Z(a(`instruction.${wt.NO_DUPLICATES.id}`),a(`instruction.${wt.NO_DUPLICATES.id}`))&&o.jsx(Rt,{ref:j=>{le.current.no_duplicates=j},id:"no_duplicates",index:v?++Q:void 0,label:a(`instruction.${wt.NO_DUPLICATES.id}`),text:wt.NO_DUPLICATES.text,translatedText:a(`instruction.desc.${wt.NO_DUPLICATES.id}`),isEnabled:v,isMandatory:!1,color:"emerald",isHighlighted:ee==="no_duplicates"})}),Z(a("node.content.narrator"),a("node.content.narrator"))&&o.jsx(Rt,{ref:j=>{le.current.sg_narrator=j},id:"sg_narrator",index:++Q,label:a("node.content.narrator"),text:_?`Include Narrator voiceover text. Style: ${m}.`:"Do NOT include narrator text.",translatedText:_?"  .":"   .",isEnabled:_,onToggle:()=>n({narratorEnabled:!_}),color:"cyan",isHighlighted:ee==="sg_narrator"}),Z(a("node.content.numberOfScenes"),a("node.content.numberOfScenes"))&&o.jsx(Rt,{ref:j=>{le.current.sg_scene_count=j},id:"sg_scene_count",index:s?++Q:void 0,label:a("node.content.numberOfScenes"),text:s?`Exactly ${s} scenes.`:"Auto-determine scene count.",translatedText:s?`${a("node.content.numberOfScenes")}: ${s}`:a("node.content.numberOfScenes.auto"),isEnabled:s!==null,onToggle:()=>n({numberOfScenes:s?null:5}),color:"cyan",isHighlighted:ee==="sg_scene_count"}),Z(a("instruction.sg_detailed_plot"),a("instruction.sg_detailed_plot"))&&o.jsx(Rt,{ref:j=>{le.current.sg_detailed_plot=j},id:"sg_detailed_plot",index:!M&&b?++Q:void 0,label:a("instruction.sg_detailed_plot"),text:"Plot Detail: Provide highly detailed descriptions of actions and plot.",translatedText:a("instruction.desc.sg_detailed_plot"),isEnabled:!M&&b,onToggle:()=>n({isDetailedPlot:!b}),color:"emerald",isHighlighted:ee==="sg_detailed_plot"}),Z(a("instruction.sg_subscribe"),a("instruction.sg_subscribe"))&&o.jsx(Rt,{ref:j=>{le.current.sg_subscribe=j},id:"sg_subscribe",index:!M&&f?++Q:void 0,label:a("instruction.sg_subscribe"),text:"Include a scene asking audience to Subscribe/Like.",translatedText:a("instruction.desc.sg_subscribe"),isEnabled:!M&&f,onToggle:()=>n({includeSubscribeScene:!f}),color:"emerald",isHighlighted:ee==="sg_subscribe"})]}),o.jsx("h5",{className:"text-[10px] text-gray-500 uppercase font-bold mb-1 pt-2 border-t border-gray-700",children:a("node.content.entityGenerationStack")}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx(Rt,{label:"Entity Mode",text:"Focus: Generating Entities based on the story concept.",translatedText:":      .",isMandatory:!0,color:"purple"}),Z(a("instruction.create_main_chars"),a("instruction.create_main_chars"))&&o.jsx(Rt,{ref:j=>{le.current[wt.MAIN_CHAR_LOGIC.id]=j},id:wt.MAIN_CHAR_LOGIC.id,label:a("instruction.create_main_chars"),text:wt.MAIN_CHAR_LOGIC.text,translatedText:a("instruction.desc.create_main_chars"),isEnabled:z,onToggle:G,color:"emerald",isHighlighted:te===wt.MAIN_CHAR_LOGIC.id}),Z(a("instruction.create_secondary_chars"),a("instruction.create_secondary_chars"))&&o.jsx(Rt,{ref:j=>{le.current[wt.SECONDARY_CHARS.id]=j},id:wt.SECONDARY_CHARS.id,label:a("instruction.create_secondary_chars"),text:wt.SECONDARY_CHARS.text,translatedText:a("instruction.desc.create_secondary_chars"),isEnabled:L,onToggle:q,color:"emerald",isHighlighted:te===wt.SECONDARY_CHARS.id}),Z(a("instruction.create_key_items"),a("instruction.create_key_items"))&&o.jsx(Rt,{ref:j=>{le.current[wt.KEY_ITEMS_LOGIC.id]=j},id:wt.KEY_ITEMS_LOGIC.id,label:a("instruction.create_key_items"),text:wt.KEY_ITEMS_LOGIC.text,translatedText:a("instruction.desc.create_key_items"),isEnabled:D,onToggle:ie,color:"cyan",isHighlighted:te===wt.KEY_ITEMS_LOGIC.id})]})]})]})]})]})},C5=_t.memo(({fullDescription:e,onDescriptionChange:t,readOnly:n=!1,t:r,onFocus:a})=>{const[i,s]=x.useState({});x.useEffect(()=>{const c={Appearance:"",Personality:"",Clothing:""},d={:"Appearance",:"Personality",:"Clothing",Appearance:"Appearance",Personality:"Personality",Clothing:"Clothing"},h=/####\s*(Appearance|Personality|Clothing|||)\s*([\s\S]*?)(?=####|$)/gi;let g,m=!1;for(;(g=h.exec(e))!==null;){m=!0;const _=d[g[1].trim()],y=g[2].trim();_&&(c[_]=y)}!m&&e.trim()&&(c.Appearance=e.trim()),s(c)},[e]);const l=(c,d)=>{const h={...i,[c]:d},g=`#### Appearance
${h.Appearance||""}

#### Personality
${h.Personality||""}

#### Clothing
${h.Clothing||""}`;t(g)};return o.jsx("div",{className:"space-y-2 text-sm",children:["Appearance","Personality","Clothing"].map(c=>o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h5",{className:"font-semibold text-gray-400 text-xs uppercase tracking-wider",children:r(`node.content.${c.toLowerCase()}`)||c}),o.jsx(Ie,{tooltipPosition:"left",title:`${r("node.action.copy")} ${c}`,onClick:d=>{d.stopPropagation(),navigator.clipboard.writeText(i[c]||"")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{value:i[c]||"",onChange:d=>l(c,d.target.value),readOnly:n,className:`w-full text-sm p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar overflow-y-scroll read-only:bg-gray-900/50 read-only:text-gray-400 ${n?"read-only:cursor-not-allowed":""}`,onWheel:d=>d.stopPropagation(),onFocus:a})]},c))})}),S5=_t.memo(({char:e,currentId:t,isSelected:n,isCollapsed:r,t:a,onClick:i,onToggleCollapse:s,onUpdate:l,deselectAllNodes:c,onEmbed:d,onDelete:h,onDetach:g,onMove:m,index:_,isFirst:y,isLast:v,hasDuplicateIndex:C})=>o.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 mb-2 space-y-2 border border-gray-700 transition-colors",children:[o.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:w=>{w.target.closest("input, button")||s(t)},children:[o.jsxs("div",{className:"flex items-center flex-grow min-w-0",children:[e.isLinked&&o.jsx("div",{title:"Linked from upstream (Read-only)",className:"mr-2 text-emerald-400 flex-shrink-0",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),o.jsx(Ie,{tooltipPosition:"right",title:a("node.action.togglePanel"),onClick:w=>{w.stopPropagation(),s(t)},children:r?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"text",value:e.name,readOnly:e.isLinked,onChange:w=>l(t,"name",w.target.value),className:`font-semibold text-white bg-gray-900 w-64 rounded px-2 py-0.5 border border-transparent focus:border-emerald-500 focus:ring-0 focus:outline-none transition-colors ${e.isLinked?"cursor-not-allowed text-gray-400 focus:border-transparent !bg-transparent !px-1":""}`,onMouseDown:w=>w.stopPropagation(),onFocus:c}),o.jsxs("span",{className:"text-[9px] text-gray-500 font-mono ml-2 opacity-50 select-none",children:["#",String(t)]})]})]}),o.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[o.jsxs("label",{className:"text-xs text-gray-400 whitespace-nowrap",children:[a("node.content.characterIndex"),":"]}),o.jsx("input",{type:"text",value:e.index||e.alias||"",readOnly:e.isLinked,onChange:w=>l(t,"index",w.target.value),className:`font-semibold text-white bg-gray-900/50 w-24 rounded px-1 text-xs py-0.5 border border-transparent cursor-not-allowed focus:outline-none focus:ring-0 ${C?"border-red-500 ring-1 ring-red-500":""}`,onFocus:c,onMouseDown:w=>w.stopPropagation()}),e.isLinked?o.jsx(Ie,{tooltipPosition:"left",title:a("node.action.embedCharacter"),onClick:w=>{w.stopPropagation(),d(e)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}):g&&o.jsx(Ie,{tooltipPosition:"left",title:"Detach to Character Card Node",onClick:w=>{w.stopPropagation(),g(e)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})}),h&&o.jsx(Ie,{tooltipPosition:"left",title:a("node.action.deleteItem"),onClick:w=>{w.stopPropagation(),h(t)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),!r&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"space-y-1 mb-2",children:[o.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider",children:a("node.content.imagePrompt")}),o.jsx("textarea",{value:e.prompt||"",onChange:w=>l(t,"prompt",w.target.value),readOnly:e.isLinked,className:`w-full text-xs p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar overflow-y-scroll ${e.isLinked?"bg-gray-900/50 text-gray-400 cursor-not-allowed":""}`,onWheel:w=>w.stopPropagation(),onMouseDown:w=>w.stopPropagation(),onFocus:c})]}),o.jsx(C5,{fullDescription:e.fullDescription||"",onDescriptionChange:w=>l(t,"fullDescription",w),readOnly:e.isLinked,t:a,onFocus:c})]})]})),T5=_t.memo(({uiState:e,onUpdateUiState:t,onUpdateValue:n,isCharactersSectionCollapsed:r,allCharacters:a,selectedCharacters:i,collapsedCharacters:s,areAllCharactersCollapsed:l,handleToggleAllCharacters:c,handleCharacterClick:d,handleToggleCharacterCollapse:h,updateCharacter:g,deleteCharacter:m,onAddCharacter:_,handleEmbedCharacter:y,deselectAllNodes:v,t:C,onDetachCharacter:w,onMoveCharacter:b,onClearCharacters:f,onGenerateEntities:T,isGeneratingEntities:I,generateMainChars:E,createSecondaryChars:R,createKeyItems:N,onGenerateMainChange:A,onCreateSecondaryChange:k,onCreateKeyItemsChange:P,onSetTargetScrollId:M,isScriptGenerating:H})=>{const W={};a.forEach(z=>{const L=(z.index||z.alias||"").trim().toLowerCase();W[L]=(W[L]||0)+1});const O={};a.forEach(z=>{const L=(z.name||"").trim().toLowerCase();O[L]=(O[L]||0)+1});const U=(z,L)=>{z.stopPropagation(),M&&(M(L),e.isSettingsCollapsed&&t({isSettingsCollapsed:!1}))};return o.jsxs("div",{className:"flex-shrink-0 mb-1 bg-gray-900 rounded-md border border-gray-700 hover:border-emerald-500 overflow-hidden flex flex-col transition-all duration-200 relative",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>t({isCharactersSectionCollapsed:!r}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"})}),o.jsx("h3",{className:"font-bold text-emerald-400 select-none transition-colors uppercase text-xs tracking-wider",children:C("node.content.characters")})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(lt,{title:C(l?"node.action.expandAll":"node.action.collapseAll"),position:"top",children:o.jsx("button",{onClick:z=>{z.stopPropagation(),c()},disabled:r,className:`p-1 rounded transition-colors ${r?"text-gray-600 cursor-default":"hover:bg-gray-700 text-emerald-400 hover:text-emerald-300"}`,children:l?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})})}),_&&o.jsx(Ie,{tooltipPosition:"left",title:C("node.action.addCharacter"),onClick:z=>{z.stopPropagation(),_()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),f&&o.jsx(Ie,{tooltipPosition:"left",title:C("node.action.clear"),onClick:z=>{z.stopPropagation(),f()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Ie,{tooltipPosition:"left",title:C(r?"node.action.expand":"node.action.collapse"),onClick:z=>{z.stopPropagation(),t({isCharactersSectionCollapsed:!r})},children:r?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!r&&o.jsxs("div",{style:{contentVisibility:"auto"},className:"p-2 space-y-2 overflow-y-auto custom-scrollbar flex-grow",onWheel:z=>z.stopPropagation(),children:[T&&o.jsxs("div",{className:"flex items-center justify-between gap-2 p-2 bg-gray-800/50 rounded-md border border-gray-700 mb-2",children:[o.jsxs("div",{className:"flex gap-3 items-center",children:[o.jsxs("div",{className:"flex items-center gap-1 group",title:"Create Main Characters",children:[o.jsx(ft,{id:"gen_main_chars",checked:!!E,onChange:z=>A==null?void 0:A(z),disabled:!!I,className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:"gen_main_chars",className:"text-[10px] text-gray-300 font-bold uppercase cursor-pointer select-none hover:text-emerald-400 transition-colors",children:C("node.content.mainChars")}),o.jsx("button",{onClick:z=>U(z,wt.MAIN_CHAR_LOGIC.id),className:"p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2.5 w-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),o.jsxs("div",{className:"flex items-center gap-1 group",title:C("instruction.create_secondary_chars"),children:[o.jsx(ft,{id:"create_secondary",checked:!!R,onChange:z=>k==null?void 0:k(z),disabled:!!I,className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:"create_secondary",className:"text-[10px] text-gray-300 font-bold uppercase cursor-pointer select-none hover:text-emerald-400 transition-colors",children:C("node.content.secChars")}),o.jsx("button",{onClick:z=>U(z,wt.SECONDARY_CHARS.id),className:"p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2.5 w-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),o.jsxs("div",{className:"flex items-center gap-1 group",title:C("instruction.create_key_items"),children:[o.jsx(ft,{id:"create_items",checked:!!N,onChange:z=>P==null?void 0:P(z),disabled:!!I,className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:"create_items",className:"text-[10px] text-gray-300 font-bold uppercase cursor-pointer select-none hover:text-cyan-400 transition-colors",children:C("node.content.keyItems")}),o.jsx("button",{onClick:z=>U(z,wt.KEY_ITEMS_LOGIC.id),className:"p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2.5 w-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]}),o.jsx("button",{onClick:T,disabled:I||H,className:`px-3 py-1 text-[10px] font-bold uppercase tracking-wider rounded bg-cyan-600 hover:bg-cyan-500 text-white transition-colors flex items-center justify-center ${I||H?"opacity-50 cursor-not-allowed":""}`,children:I?o.jsxs("svg",{className:"animate-spin h-3 w-3 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):C("node.content.generateEntities")})]}),a.map((z,L)=>{const D=z.id||`char-idx-${L}`,G=O[(z.name||"").trim().toLowerCase()]>1,q=(z.index||z.alias||"").trim().toLowerCase(),ie=W[q]>1;return o.jsxs("div",{className:G?"border-red-500 border rounded-lg":"",children:[G&&o.jsx("div",{className:"text-[10px] text-red-400 bg-red-900/30 px-2 py-0.5 rounded-t-lg",children:"Duplicate Name Warning"}),o.jsx(S5,{char:z,index:L,currentId:D,isSelected:i.has(D),isCollapsed:s.includes(String(D)),t:C,onToggleCollapse:h,onClick:d,onUpdate:g,onDelete:m,onDetach:w,onEmbed:y,onMove:b,deselectAllNodes:v,isFirst:L===0,isLast:L===a.length-1,hasDuplicateIndex:ie})]},D)})]})]})}),E5=_t.memo(({scene:e,index:t,isSelected:n,isCollapsed:r,narratorEnabled:a,isModifying:i,t:s,onToggleCollapse:l,onClick:c,onUpdate:d,onDelete:h,onAddAfter:g,onMove:m,onModifyScriptPart:_,deselectAllNodes:y})=>{const[v,C]=x.useState(""),w=(e.title||"").replace(/^(Scene||Scne|Escena|Szene)\s*\d+[:\s-]*/i,"").trim(),b=w?`${s("node.content.scene")} ${t+1}: ${w}`:`${s("node.content.scene")} ${t+1}`,f=E=>{E.stopPropagation();const R=Array.isArray(e.characters)?e.characters:[];let N=0;R.forEach(k=>{const P=k.match(/(\d+)/);P&&(N=Math.max(N,parseInt(P[1],10)))});const A=[...R,`Entity-${N+1}`];d(t,"characters",A)},T=(E,R)=>{const N=[...Array.isArray(e.characters)?e.characters:[]],k=N[E].match(/(\d+)/);let P=k?parseInt(k[1],10):0;const M=Math.max(1,P+R);N[E]=`Entity-${M}`,d(t,"characters",N)},I=E=>{const R=[...Array.isArray(e.characters)?e.characters:[]];R.splice(E,1),d(t,"characters",R)};return o.jsxs("div",{className:`bg-gray-800 rounded-lg p-3 mb-2 space-y-2 border-2 ${n?"border-emerald-500":"border-transparent"} transition-colors shadow-sm`,onClick:E=>c(E,t),children:[o.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:E=>{E.target.closest("input, button")||l(t)},children:[o.jsx("div",{className:"flex items-center space-x-2 flex-grow min-w-0",children:o.jsxs("div",{className:"flex flex-col min-w-0",children:[o.jsx("span",{className:"font-bold text-white truncate text-sm",title:b,children:b}),o.jsxs("div",{className:"flex items-center gap-2 mt-0.5 flex-wrap",children:[e.recommendedFrames!==void 0&&o.jsxs("span",{className:"text-[9px] text-emerald-400 font-mono uppercase tracking-wider bg-emerald-900/30 px-1 rounded whitespace-nowrap",children:[s("node.content.recommendedFrames"),": ",e.recommendedFrames]}),o.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[(Array.isArray(e.characters)?e.characters:[]).map((E,R)=>{const N=E.match(/(?:Entity|Character|)[-\s]?(\d+)/i),A=N?`ENT-${N[1]}`:E;return o.jsx("div",{className:"relative group/char",children:o.jsx(lt,{title:"Scroll/Arrows to change. Shift+Click to delete.",position:"top",children:o.jsx("input",{type:"text",value:A,readOnly:!0,className:"text-[9px] text-cyan-300 font-mono uppercase tracking-wider bg-cyan-900/30 px-1 rounded w-12 text-center border border-transparent focus:border-cyan-500 focus:outline-none cursor-text select-none",onClick:k=>k.stopPropagation(),onWheel:k=>{k.stopPropagation(),k.preventDefault();const P=k.deltaY<0?1:-1;T(R,P)},onKeyDown:k=>{(k.key==="ArrowUp"||k.key==="ArrowRight")&&(k.preventDefault(),k.stopPropagation(),T(R,1)),(k.key==="ArrowDown"||k.key==="ArrowLeft")&&(k.preventDefault(),k.stopPropagation(),T(R,-1))},onMouseDown:k=>{k.shiftKey&&(k.stopPropagation(),k.preventDefault(),I(R))}})})},`${t}-${R}`)}),o.jsx(lt,{title:"Add Character (ENT-N)",position:"top",children:o.jsx("button",{onClick:f,className:"text-[9px] text-gray-400 hover:text-white bg-gray-700 hover:bg-gray-600 px-1.5 rounded transition-colors font-bold h-4 flex items-center justify-center",children:"+"})})]})]})]})}),o.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[o.jsx(Ie,{tooltipPosition:"left",title:s("node.action.addScene"),onClick:E=>{E.stopPropagation(),g(t)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),o.jsx(Ie,{tooltipPosition:"left",title:s("node.action.moveUp"),onClick:E=>{E.stopPropagation(),m(t,"up")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsx(Ie,{tooltipPosition:"left",title:s("node.action.moveDown"),onClick:E=>{E.stopPropagation(),m(t,"down")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),o.jsx(Ie,{tooltipPosition:"left",title:s("node.action.deleteItem"),onClick:E=>{E.stopPropagation(),h(t)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Ie,{tooltipPosition:"left",title:s(r?"node.action.expandScene":"node.action.collapseScene"),onClick:E=>{E.stopPropagation(),l(t)},children:r?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!r&&o.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-700/50",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:s("node.content.sceneDescription")}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsxs("span",{className:"text-[10px] text-gray-500 uppercase",children:[s("node.content.recommendedFrames"),":"]}),o.jsx("input",{type:"number",min:"1",value:e.recommendedFrames||"",onChange:E=>d(t,"recommendedFrames",parseInt(E.target.value,10)||0),className:"bg-gray-900 border border-gray-700 text-emerald-400 text-[10px] w-10 px-1 rounded focus:outline-none focus:border-emerald-500",onMouseDown:E=>E.stopPropagation()})]})]}),o.jsx(Ie,{tooltipPosition:"left",title:s("node.action.copy"),onClick:E=>{E.stopPropagation(),navigator.clipboard.writeText(e.description)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})})]}),o.jsx("textarea",{value:e.description,onChange:E=>d(t,"description",E.target.value),className:"w-full text-sm p-2 bg-gray-900 border-none rounded-md resize-y min-h-[80px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar overflow-y-scroll",onWheel:E=>E.stopPropagation(),onFocus:y}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("input",{type:"text",value:v,onChange:E=>C(E.target.value),placeholder:s("node.content.modificationPromptPlaceholder"),className:"flex-grow bg-gray-800 text-xs rounded px-2 py-1 border border-gray-700 focus:border-emerald-500 outline-none text-gray-300",onMouseDown:E=>E.stopPropagation()}),o.jsx("button",{onClick:E=>{E.stopPropagation(),_(`scene-${t}-description`,e.description,v),C("")},disabled:!v.trim()||i,className:"bg-emerald-600 hover:bg-emerald-500 text-white text-xs px-2 py-1 rounded disabled:opacity-50",children:i?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})})})]})]}),a&&o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("label",{className:"text-xs font-medium text-emerald-400",children:s("node.content.narrator")}),o.jsx(Ie,{tooltipPosition:"left",title:s("node.action.copy"),onClick:E=>{E.stopPropagation(),navigator.clipboard.writeText(e.narratorText||"")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})})]}),o.jsx("textarea",{value:e.narratorText||"",onChange:E=>d(t,"narratorText",E.target.value),className:"w-full text-sm p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar overflow-y-scroll text-gray-300 italic",onWheel:E=>E.stopPropagation(),onFocus:y})]})]})]})}),N5=({isScenesSectionCollapsed:e,areAllScenesCollapsed:t,scenes:n,selectedScenes:r,collapsedScenes:a,narratorEnabled:i,isModifyingScriptPart:s,nodeId:l,t:c,handleUiStateUpdate:d,addScene:h,handleToggleAllScenes:g,handleSceneClick:m,handleToggleSceneCollapse:_,updateScene:y,deleteScene:v,addSceneAfter:C,moveScene:w,onModifyScriptPart:b,deselectAllNodes:f,onClearScenes:T})=>o.jsxs("div",{className:"flex-shrink-0 mb-1 bg-gray-900 rounded-md border border-gray-700 hover:border-emerald-500 overflow-hidden flex flex-col transition-all duration-200",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors",onClick:()=>d({isScenesSectionCollapsed:!e}),children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),o.jsx("h3",{className:"font-bold text-emerald-400 select-none transition-colors uppercase text-xs tracking-wider",children:c("node.content.scenes")})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx("button",{onClick:I=>{I.stopPropagation(),g()},disabled:e,className:`p-1 rounded transition-colors ${e?"text-gray-600 cursor-default":"hover:bg-gray-700 text-emerald-400 hover:text-emerald-300"}`,title:c(t?"node.action.expandAll":"node.action.collapseAll"),children:t?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})})}),o.jsx(Ie,{tooltipPosition:"left",title:c("node.action.addScene"),onClick:I=>{I.stopPropagation(),h()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),o.jsx(Ie,{tooltipPosition:"left",title:c("node.action.clear"),onClick:I=>{I.stopPropagation(),T()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Ie,{tooltipPosition:"left",title:c(e?"node.action.expand":"node.action.collapse"),onClick:I=>{I.stopPropagation(),d({isScenesSectionCollapsed:!e})},children:e?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!e&&o.jsx("div",{style:{contentVisibility:"auto"},className:"p-2 space-y-2",children:n.map((I,E)=>o.jsx(E5,{scene:I,index:E,isSelected:r.has(E),isCollapsed:a.includes(E),narratorEnabled:i,isModifying:s===`${l}/scene-${E}-description`,t:c,onToggleCollapse:_,onClick:m,onUpdate:y,onDelete:v,onAddAfter:C,onMove:w,onModifyScriptPart:b,deselectAllNodes:f},E))})]}),k5=({node:e,onValueChange:t,onGenerateScript:n,isGeneratingScript:r,isStopping:a,onStopGeneration:i,t:s,deselectAllNodes:l,connectedInputs:c,onModifyScriptPart:d,isModifyingScriptPart:h,onDetachCharacter:g,addToast:m,inputData:_,onImproveScriptConcept:y,isImprovingScriptConcept:v,connections:C,getUpstreamTextValue:w,onRemoveConnection:b,onGenerateEntities:f,isGeneratingEntities:T})=>{var Bt,en;const{viewTransform:I}=or(),{language:E}=Ht(),R=r===e.id,N=T===e.id,A=(c==null?void 0:c.has("prompt"))||(c==null?void 0:c.has(void 0)),k=c==null?void 0:c.has("characters"),P=E==="en"?"ru":E,[M,H]=x.useState(new Set),[W,O]=x.useState(new Set),[U,z]=x.useState(0),[L,D]=x.useState([]),[G,q]=x.useState(null),ie=x.useRef(new Set),[te,ye]=x.useState({current:0,total:0,last:0}),ue=x.useMemo(()=>{try{const ve=JSON.parse(e.value||"{}"),Be={isSettingsCollapsed:!0,isSummaryCollapsed:!0,isStyleCollapsed:!0,isCharactersSectionCollapsed:!0,isScenesSectionCollapsed:!1,collapsedCharacters:[],collapsedScenes:[]};return{prompt:ve.prompt||"",targetLanguage:ve.targetLanguage||"ru",characterType:ve.characterType||"simple",useExistingCharacters:!!ve.useExistingCharacters,narratorEnabled:!!ve.narratorEnabled,narratorMode:ve.narratorMode||"normal",summary:ve.summary||"",detailedCharacters:Array.isArray(ve.detailedCharacters)?ve.detailedCharacters:[],scenes:Array.isArray(ve.scenes)?ve.scenes:[],isAdvancedMode:!!ve.isAdvancedMode,numberOfScenes:ve.numberOfScenes||null,isDetailedPlot:!!ve.isDetailedPlot,genre:ve.genre||"general",genre2:ve.genre2||"general",noCharacters:!!ve.noCharacters,model:ve.model||"gemini-3-pro-preview",includeSubscribeScene:!!ve.includeSubscribeScene,visualStyle:ve.visualStyle||"none",customVisualStyle:ve.customVisualStyle||"",generatedStyle:ve.generatedStyle||"",generateMainChars:ve.generateMainChars!==!1,createSecondaryChars:ve.createSecondaryChars!==!1,createKeyItems:ve.createKeyItems!==!1,safeGeneration:!!ve.safeGeneration,thinkingEnabled:!!ve.thinkingEnabled,scenelessMode:!!ve.scenelessMode,simpleActions:!!ve.simpleActions,commercialSafe:!!ve.commercialSafe,smartConceptEnabled:!!ve.smartConceptEnabled,atmosphericEntryEnabled:ve.atmosphericEntryEnabled!==!1,generationProgress:ve.generationProgress||null,uiState:{...Be,...ve.uiState||{}}}}catch{return{prompt:"",targetLanguage:"ru",detailedCharacters:[],scenes:[],uiState:{isSettingsCollapsed:!0,isSummaryCollapsed:!0,isStyleCollapsed:!0,isCharactersSectionCollapsed:!0,isScenesSectionCollapsed:!1,collapsedCharacters:[],collapsedScenes:[]},model:"gemini-3-pro-preview",summary:"",generatedStyle:"",generateMainChars:!0,commercialSafe:!1,smartConceptEnabled:!1,atmosphericEntryEnabled:!0,generationProgress:null}}},[e.value]),{prompt:$,targetLanguage:ee,characterType:Te,useExistingCharacters:le,narratorEnabled:J,narratorMode:ge,summary:ae,detailedCharacters:ce,scenes:B,isAdvancedMode:X,numberOfScenes:F,isDetailedPlot:Y,genre:K,genre2:V,noCharacters:oe,model:de,includeSubscribeScene:Z,visualStyle:Q,customVisualStyle:j,generatedStyle:fe,generateMainChars:Pe,createSecondaryChars:je,createKeyItems:ke,safeGeneration:$e,thinkingEnabled:ze,scenelessMode:nt,simpleActions:at,commercialSafe:xe,smartConceptEnabled:he,atmosphericEntryEnabled:Ge,uiState:me,generationProgress:Oe}=ue,De=x.useRef(ce),Ce=x.useRef(me),Qe=x.useRef(le),pe=x.useRef(oe);x.useEffect(()=>{De.current=ce,Ce.current=me,Qe.current=le,pe.current=oe},[ce,me,le,oe]),x.useEffect(()=>{let ve;return Oe?Oe.endTime?ye({current:0,total:Math.floor((Oe.endTime-Oe.totalStartTime)/1e3),last:Oe.lastItemDuration||0}):R&&(ve=window.setInterval(()=>{const Be=Date.now();ye({current:Math.floor((Be-(Oe.currentItemStartTime||Be))/1e3),total:Math.floor((Be-(Oe.totalStartTime||Be))/1e3),last:Oe.lastItemDuration||0})},100)):ye({current:0,total:0,last:0}),()=>clearInterval(ve)},[R,Oe]);const Se=x.useMemo(()=>C==null?void 0:C.find(ve=>ve.toNodeId===e.id&&(ve.toHandleId==="prompt"||ve.toHandleId===void 0)),[C,e.id]),Ee=x.useMemo(()=>!Se||!w?"":w(Se.fromNodeId,Se.fromHandleId),[Se,w,_]),Fe=A?Ee:$,be=x.useCallback(ve=>{const Be={...ue,...ve};t(e.id,JSON.stringify(Be))},[e.id,t,ue]);x.useEffect(()=>{let ve={},Be=!1;if(B.length>0){const Je=B.map((ct,jt)=>jt);(me.collapsedScenes||[]).length!==Je.length&&(ve.uiState={...me,collapsedScenes:Je},Be=!0)}if(ce.length>0){const Je=ce.map(jt=>jt.id),it=me.collapsedCharacters||[];Je.every(jt=>it.includes(jt))||(ve.uiState={...ve.uiState||me,collapsedCharacters:Je},Be=!0)}Be&&be(ve)},[]),x.useEffect(()=>{if(_&&le){const ve=setTimeout(()=>{be({_upstreamSync:Date.now()})},800);return()=>clearTimeout(ve)}},[_,le]);const _e=x.useCallback(ve=>{be({uiState:{...me,...ve}})},[be,me]),Ue=()=>{n(e.id)},We=ve=>{ve.stopPropagation();const Be=Fe;if(!Be.trim()){m&&m("No concept to improve.","info");return}A&&Se&&b&&b(Se.id),y&&y(e.id,Be)},gt=x.useCallback(()=>{const ve=`char-${Date.now()}`;let Be=0;const Je=/^New Entity\s*(\d*)$/i,it=[...L,...ce||[]];it.forEach(Le=>{const Re=(Le.name||"").match(Je);if(Re){const Ke=Re[1]?parseInt(Re[1],10):1;Ke>Be&&(Be=Ke)}});const ct=`New Entity ${Be+1}`,jt=it.length+1,Nn={id:ve,name:ct,index:`Entity-${jt}`,fullDescription:"",prompt:"",originalName:ct},Kt=[...ce||[],Nn],re={...me,isCharactersSectionCollapsed:!1,collapsedCharacters:[...me.collapsedCharacters||[],ve]};be({detailedCharacters:Kt,uiState:re})},[ce,L,be,me]),Et=x.useCallback(()=>{const ve=((B==null?void 0:B.length)||0)+1,Be={sceneNumber:ve,title:`Scene ${ve}`,description:"",narratorText:"",recommendedFrames:6},Je=[...B||[],Be],it=Je.length-1,ct={...me,isScenesSectionCollapsed:!1,collapsedScenes:[...me.collapsedScenes||[],it]};be({scenes:Je,uiState:ct})},[B,be,me]),It=x.useCallback(ve=>{const Be=[...B||[]],Je={sceneNumber:0,title:"New Scene",description:"",narratorText:"",recommendedFrames:6};Be.splice(ve+1,0,Je);const it=Be.map((Kt,re)=>({...Kt,sceneNumber:re+1,title:Kt.title==="New Scene"||Kt.title.match(/^Scene \d+$/)?`Scene ${re+1}`:Kt.title})),ct=ve+1,jt=(me.collapsedScenes||[]).map(Kt=>Kt>=ct?Kt+1:Kt).concat(ct),Nn={...me,isScenesSectionCollapsed:!1,collapsedScenes:jt};be({scenes:it,uiState:Nn})},[B,be,me]),Mt=x.useCallback((ve,Be)=>{if(!B||B.length<2)return;const Je=[...B];if(Be==="up"){if(ve===0)return;[Je[ve],Je[ve-1]]=[Je[ve-1],Je[ve]]}else{if(ve===Je.length-1)return;[Je[ve],Je[ve+1]]=[Je[ve+1],Je[ve]]}const it=Je.map((ct,jt)=>({...ct,sceneNumber:jt+1}));be({scenes:it})},[B,be]),xt=x.useCallback((ve,Be)=>{if(!ce||ce.length<2)return;let Je=[...ce];const it=Je[ve];Je.splice(ve,1),Be==="top"?Je.unshift(it):Be==="bottom"?Je.push(it):Be==="up"?Je.splice(Math.max(0,ve-1),0,it):Be==="down"&&Je.splice(Math.min(Je.length,ve+1),0,it),be({detailedCharacters:Je})},[ce,be]);x.useEffect(()=>{if(!C||!w){D([]),z(0);return}const ve=C.filter(rt=>rt.toNodeId===e.id&&rt.toHandleId==="characters"),Be=[];ve.forEach(rt=>{const St=w(rt.fromNodeId,rt.fromHandleId);try{const Pt=JSON.parse(St||"{}"),Gt=se=>({...se,isLinked:!0,id:se.id||`linked-${rt.fromNodeId}-${se.name}`});Array.isArray(Pt)?Pt.forEach(se=>Be.push(Gt(se))):Pt.characters&&Array.isArray(Pt.characters)?Pt.characters.forEach(se=>Be.push(Gt(se))):Pt.name&&Be.push(Gt(Pt))}catch{}});const Je=De.current||[],it=Ce.current;let ct={};ve.length>0&&(Qe.current||(ct.useExistingCharacters=!0),pe.current&&(ct.noCharacters=!1));const jt=Be.map((rt,St)=>{const{alias:Pt,...Gt}=rt;return{...Gt,index:`Entity-${St+1}`}}),Nn=jt.length+1;let Kt=!1;const re=Je.map((rt,St)=>{const Gt=`Entity-${Nn+St}`,{alias:se,...Me}=rt;return Me.index!==Gt||se?(Kt=!0,{...Me,index:Gt}):Me}),Le=[...jt,...re].map(rt=>rt.id),Re=new Set(it.collapsedCharacters||[]);let Ke=!1;Le.forEach(rt=>{ie.current.has(rt)||Re.has(rt)||(Re.add(rt),Ke=!0)}),ie.current=new Set(Le);const dt=JSON.stringify(L)!==JSON.stringify(jt);JSON.stringify(Je),JSON.stringify(re),dt&&(D(jt),z(jt.length)),(Kt||Ke||Object.keys(ct).length>0)&&(Kt&&(ct.detailedCharacters=re),Ke&&(ct.uiState={...it,collapsedCharacters:Array.from(Re)}),setTimeout(()=>{be(ct)},0))},[C,w,e.id,_,be]);const Ft=x.useCallback(ve=>{const Be={...ve,isLinked:!1,id:`char-${Date.now()}-${Math.random().toString(36).substr(2,5)}`};be({detailedCharacters:[...ce,Be]})},[ce,be]),cn=x.useMemo(()=>[...L,...ce].sort((Be,Je)=>{const it=parseInt(Be.index.replace(/\D/g,""))||999,ct=parseInt(Je.index.replace(/\D/g,""))||999;return it-ct}),[L,ce]);return o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsxs("div",{className:"flex flex-col gap-2 mb-2 flex-shrink-0",children:[o.jsxs("div",{className:"flex justify-between items-center px-1",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:s("node.content.scriptPromptPlaceholder")}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ie,{title:s("node.action.improveConcept"),tooltipPosition:"left",onClick:We,disabled:!Fe.trim()||!!v,children:v?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 animate-spin",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),o.jsx(Ie,{title:s("node.action.clear"),tooltipPosition:"left",onClick:ve=>{ve.stopPropagation(),be({prompt:""})},disabled:A||!$,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),o.jsx("textarea",{value:Fe,onChange:ve=>be({prompt:ve.target.value}),placeholder:s(A?"node.content.connectedPlaceholder":"node.content.scriptPromptPlaceholder"),disabled:A||R||N,className:`w-full p-2 bg-gray-700 border border-gray-600 rounded-md resize-y min-h-[80px] max-h-[200px] focus:border-emerald-500 focus:ring-0 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar overflow-y-scroll ${A?"text-gray-300 italic":""}`,rows:2,onWheel:ve=>ve.stopPropagation(),onMouseDown:ve=>ve.stopPropagation(),onFocus:l}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsxs("div",{className:"flex flex-shrink-0 gap-1 h-10 select-none bg-gray-900/50 rounded-lg p-0.5 items-center",children:[o.jsx(lt,{title:s("tooltip.model.flash"),position:"top",className:"h-full flex-1",children:o.jsxs("button",{onClick:()=>be({model:"gemini-3-flash-preview"}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all flex items-center justify-center ${de==="gemini-3-flash-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 mr-1",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})}),"FLASH"]})}),o.jsx(lt,{title:s("tooltip.model.pro"),position:"top",className:"h-full flex-1",children:o.jsxs("button",{onClick:()=>be({model:"gemini-3-pro-preview"}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all flex items-center justify-center ${de==="gemini-3-pro-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})}),"PRO"]})})]}),o.jsxs("div",{className:"flex flex-shrink-0 gap-1 h-10 select-none bg-gray-900/50 rounded-lg p-0.5 items-center",children:[o.jsx(lt,{title:s(`tooltip.lang.${P}`),position:"top",className:"h-full flex",children:o.jsx("button",{onClick:()=>be({targetLanguage:P}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all ${ee===P?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:P.toUpperCase()})}),o.jsx(lt,{title:s("tooltip.lang.en"),position:"top",className:"h-full flex",children:o.jsx("button",{onClick:()=>be({targetLanguage:"en"}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all ${ee==="en"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:"EN"})})]}),o.jsxs("button",{onClick:R||N?i:Ue,disabled:a||!!N||!R&&!Fe.trim(),className:`flex-grow h-10 px-4 font-bold text-xs uppercase tracking-wide text-white rounded-lg transition-all duration-200 shadow-sm flex items-center justify-center ${a?"bg-yellow-600 hover:bg-yellow-500":R?"bg-cyan-600 hover:bg-cyan-500":"bg-emerald-600 hover:bg-emerald-500 disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed"}`,children:[R?o.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})}),s(a?"node.action.stopping":R?"node.content.generating":"node.content.generateScript")]})]}),o.jsxs("div",{className:"p-2 flex items-center justify-between text-xs border border-gray-700 bg-gray-900/50 rounded-md",children:[o.jsx("div",{className:"font-semibold text-emerald-400",children:s("node.content.scenes_generated",{count:B.length})}),o.jsx("div",{className:"flex items-center gap-4 text-gray-400",children:Oe&&o.jsxs(o.Fragment,{children:[R?o.jsx("div",{className:"text-yellow-400 animate-pulse font-mono",children:s("node.content.status.generating")}):null,o.jsxs("div",{className:"text-gray-400 font-mono text-[10px]",children:["Time (sec): (prev: ",te.last,") / Cur: ",te.current," / Total: ",te.total]})]})})]}),R&&Oe&&o.jsx("div",{className:"w-full h-1 bg-gray-800 rounded-b-md overflow-hidden border-t border-gray-800 -mt-2",children:o.jsx("div",{className:"h-full bg-emerald-500 animate-pulse w-full"})})]}),o.jsx(_5,{uiState:me,onUpdateUiState:_e,onUpdateValue:be,nodeId:e.id,t:s,deselectAllNodes:l,numberOfScenes:F,visualStyle:Q,customVisualStyle:j,genre:K,genre2:V,characterType:Te,narratorMode:ge,narratorEnabled:J,noCharacters:oe,useExistingCharacters:le,isCharactersInputConnected:!!k,linkedCharactersCount:U,isDetailedPlot:Y,includeSubscribeScene:Z,model:de,isLoading:R||!!N,targetLanguage:ee,prompt:$,allCharacters:ce,estimateFrames:!0,safeGeneration:$e,thinkingEnabled:ze,scenelessMode:nt,simpleActions:at,commercialSafe:xe,smartConceptEnabled:he,atmosphericEntryEnabled:Ge,targetScrollId:G,onSetTargetScrollId:q,generateMainChars:Pe,createSecondaryChars:je,createKeyItems:ke,onToggleGenerateMainChars:()=>be({generateMainChars:!Pe}),onToggleCreateSecondaryChars:()=>be({createSecondaryChars:!je}),onToggleCreateKeyItems:()=>be({createKeyItems:!ke})}),o.jsx("div",{className:"my-2 border-b border-gray-700/50"}),o.jsxs("div",{className:"flex-grow overflow-y-auto min-h-0 custom-scrollbar p-1 flex flex-col gap-1 bg-gray-900/30 border border-gray-700/50 rounded-md",onWheel:ve=>ve.stopPropagation(),style:{scrollbarGutter:"stable"},children:[o.jsxs("div",{className:"flex-shrink-0 mb-1 bg-gray-900 rounded-md border border-gray-700 hover:border-emerald-500 overflow-hidden flex flex-col transition-all duration-200",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors",onClick:()=>_e({isStyleCollapsed:!me.isStyleCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),o.jsx("h3",{className:"font-bold text-emerald-400 select-none transition-colors uppercase text-xs tracking-wider",children:s("node.content.style")})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ie,{tooltipPosition:"left",title:s("node.action.copy"),onClick:ve=>{ve.stopPropagation(),navigator.clipboard.writeText(fe)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),o.jsx(Ie,{tooltipPosition:"left",title:s("node.action.clear"),onClick:ve=>{ve.stopPropagation(),be({generatedStyle:""})},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Ie,{title:me.isStyleCollapsed?s("node.action.expand"):s("node.action.collapse"),onClick:ve=>{ve.stopPropagation(),_e({isStyleCollapsed:!me.isStyleCollapsed})},tooltipPosition:"left",children:me.isStyleCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!me.isStyleCollapsed&&o.jsx("div",{className:"p-2",children:o.jsx("textarea",{value:fe,onChange:ve=>be({generatedStyle:ve.target.value}),placeholder:s("node.content.stylePromptPlaceholder"),className:"w-full text-xs p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:border-emerald-500 focus:ring-0 custom-scrollbar text-gray-300"})})]}),o.jsxs("div",{className:"flex-shrink-0 mb-1 bg-gray-900 rounded-md border border-gray-700 hover:border-emerald-500 overflow-hidden flex flex-col transition-all duration-200",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors",onClick:()=>_e({isSummaryCollapsed:!me.isSummaryCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),o.jsx("h3",{className:"font-bold text-emerald-400 select-none transition-colors uppercase text-xs tracking-wider",children:s("node.content.summary")})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ie,{tooltipPosition:"left",title:s("node.action.copy"),onClick:ve=>{ve.stopPropagation(),navigator.clipboard.writeText(ae)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),o.jsx(Ie,{tooltipPosition:"left",title:s("node.action.clear"),onClick:ve=>{ve.stopPropagation(),be({summary:""})},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Ie,{title:me.isSummaryCollapsed?s("node.action.expand"):s("node.action.collapse"),onClick:ve=>{ve.stopPropagation(),_e({isSummaryCollapsed:!me.isSummaryCollapsed})},tooltipPosition:"left",children:me.isSummaryCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!me.isSummaryCollapsed&&o.jsx("div",{className:"p-2",children:o.jsx("textarea",{value:ae,onChange:ve=>be({summary:ve.target.value}),placeholder:"...",className:"w-full text-sm p-2 bg-gray-900 border-none rounded-md resize-y min-h-[60px] focus:outline-none focus:border-emerald-500 focus:ring-0 custom-scrollbar text-gray-300"})})]}),o.jsx(T5,{uiState:me,onUpdateUiState:_e,onUpdateValue:be,allCharacters:cn,selectedCharacters:W,collapsedCharacters:me.collapsedCharacters||[],isCharactersSectionCollapsed:!!me.isCharactersSectionCollapsed,areAllCharactersCollapsed:cn.length>0&&((Bt=me.collapsedCharacters)==null?void 0:Bt.length)===cn.length,t:s,onAddCharacter:gt,handleToggleAllCharacters:()=>{var ve;((ve=me.collapsedCharacters)==null?void 0:ve.length)===cn.length?be({uiState:{...me,collapsedCharacters:[]}}):be({uiState:{...me,collapsedCharacters:cn.map(Be=>Be.id)}})},handleCharacterClick:(ve,Be)=>{O(Je=>{const it=new Set(Je);return it.has(String(Be))?it.delete(String(Be)):it.add(String(Be)),it})},handleToggleCharacterCollapse:ve=>{const Be=me.collapsedCharacters||[],Je=Be.includes(String(ve))?Be.filter(it=>it!==String(ve)):[...Be,String(ve)];_e({collapsedCharacters:Je})},updateCharacter:(ve,Be,Je)=>{const it=ce.map(ct=>ct.id===ve?{...ct,[Be]:Je}:ct);be({detailedCharacters:it})},deleteCharacter:ve=>{const Be=ce.filter(Je=>Je.id!==ve);be({detailedCharacters:Be})},onDetachCharacter:ve=>g(ve,e),handleEmbedCharacter:Ft,deselectAllNodes:l,onSyncCharacters:void 0,isSyncAvailable:!1,onMoveCharacter:xt,onClearCharacters:()=>be({detailedCharacters:[]}),onGenerateEntities:()=>f(e.id),isGeneratingEntities:!!N,generateMainChars:Pe,createSecondaryChars:je,createKeyItems:ke,onGenerateMainChange:ve=>be({generateMainChars:ve}),onCreateSecondaryChange:ve=>be({createSecondaryChars:ve}),onCreateKeyItemsChange:ve=>be({createKeyItems:ve}),onSetTargetScrollId:q,isScriptGenerating:!!R}),o.jsx(N5,{isScenesSectionCollapsed:!!me.isScenesSectionCollapsed,areAllScenesCollapsed:B.length>0&&((en=me.collapsedScenes)==null?void 0:en.length)===B.length,scenes:B,selectedScenes:M,collapsedScenes:me.collapsedScenes||[],narratorEnabled:J,isModifyingScriptPart:h,nodeId:e.id,t:s,handleUiStateUpdate:_e,addScene:Et,handleToggleAllScenes:()=>{var ve;((ve=me.collapsedScenes)==null?void 0:ve.length)===B.length?be({uiState:{...me,collapsedScenes:[]}}):be({uiState:{...me,collapsedScenes:B.map((Be,Je)=>Je)}})},handleSceneClick:()=>{},handleToggleSceneCollapse:ve=>{const Be=me.collapsedScenes||[],Je=Be.includes(ve)?Be.filter(it=>it!==ve):[...Be,ve];be({uiState:{...me,collapsedScenes:Je}})},updateScene:(ve,Be,Je)=>{const it=[...B];it[ve]={...it[ve],[Be]:Je},be({scenes:it})},deleteScene:ve=>{const Be=B.filter((Je,it)=>it!==ve);be({scenes:Be})},addSceneAfter:It,moveScene:Mt,onModifyScriptPart:(ve,Be,Je)=>d(e.id,ve,Be,Je),deselectAllNodes:l,onClearScenes:()=>be({scenes:[]})})]})]})},Ut=x.forwardRef(({id:e,label:t,originalText:n,translatedText:r,isCritical:a,isEnabled:i=!0,isMandatory:s=!1,onToggle:l,color:c="emerald",className:d="h-full",index:h,isHighlighted:g},m)=>{const[_,y]=x.useState(!1);let v="",C="",w="",b="",f="",T="";const I="flex flex-row p-2 rounded border text-xs transition-all relative overflow-hidden group select-none gap-3 items-stretch duration-200";if(!i)v="bg-gray-800/40 hover:bg-gray-800/60",C="border-gray-700 hover:border-gray-600",w="text-gray-500 group-hover:text-gray-400",b="bg-gray-700 group-hover:bg-gray-600",f="text-gray-600 group-hover:text-gray-500",T="bg-gray-800 text-gray-600";else if(a)v="bg-red-900/20",C="border-red-800/50",w="text-red-400",b="bg-red-500",f="text-gray-300",T="bg-red-900/50 text-red-200";else if(s)v="bg-gray-800",C="border-gray-600",w="text-emerald-400",b="bg-gray-500",f="text-gray-300",T="bg-gray-700 text-gray-400";else switch(f="text-gray-300",c){case"cyan":v="bg-cyan-900/20",C="border-cyan-700/50",w="text-cyan-400",b="bg-cyan-500",T="bg-cyan-900/50 text-cyan-200";break;case"gray":v="bg-gray-700/40",C="border-gray-500/50",w="text-gray-300",b="bg-gray-400",T="bg-gray-600 text-gray-200";break;default:v="bg-emerald-900/20",C="border-emerald-700/50",w="text-emerald-400",b="bg-emerald-500",T="bg-emerald-900/50 text-emerald-200"}g&&(C="border-yellow-400 ring-1 ring-yellow-400/50",v="bg-yellow-900/30");const E=N=>{!s&&l&&(N.preventDefault(),N.stopPropagation(),l(e))},R=N=>{N.preventDefault(),N.stopPropagation(),navigator.clipboard.writeText(n),y(!0),setTimeout(()=>y(!1),1500)};return o.jsxs("div",{ref:m,onMouseDown:N=>N.stopPropagation(),onClick:E,className:`${I} ${v} ${C} ${d} ${s?"":"cursor-pointer shadow-sm"}`,children:[h!==void 0&&o.jsxs("div",{className:"flex-shrink-0 w-6 flex flex-col items-center justify-start pt-0.5",children:[o.jsx("div",{className:`text-[9px] font-mono font-bold w-5 h-5 flex items-center justify-center rounded-full ${T}`,children:h}),o.jsx("div",{className:`w-px flex-grow mt-1 ${i?"bg-gray-700":"bg-transparent"}`})]}),o.jsxs("div",{className:"flex flex-col flex-grow min-w-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1 flex-shrink-0",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[h===void 0&&o.jsx("div",{className:`w-1.5 h-1.5 rounded-full flex-shrink-0 ${b}`}),o.jsx("div",{className:`font-bold uppercase tracking-wider text-[10px] leading-tight ${w}`,children:t})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:R,className:`p-0.5 rounded transition-colors ${i?"text-gray-500 hover:text-white":"text-gray-600 hover:text-gray-400"}`,title:"Copy Prompt Text",children:_?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),!s&&o.jsx("div",{className:`text-[9px] uppercase font-mono px-1 rounded ${i?"text-white bg-white/10":"text-gray-600 bg-black/20"}`,children:i?"ON":"OFF"})]})]}),o.jsx("div",{className:`mb-1 leading-tight ${i?"text-gray-400":"text-gray-600"} text-[10px]`,children:n}),r&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-gray-600/30 my-1 w-full"}),o.jsx("div",{className:`leading-tight italic ${f}`,children:r})]})]}),o.jsx("div",{className:`absolute bottom-0 left-0 w-full h-[2px] opacity-30 ${b}`})]})}),aa=_t.memo(({id:e,onClick:t,t:n})=>o.jsx(lt,{title:n("node.action.locateInStack"),position:"left",children:o.jsx("button",{onClick:r=>{r.stopPropagation(),t(r,e)},className:"ml-auto p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",type:"button",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})})),A5=_t.memo(({uiState:e,localSettingsHeight:t,setLocalSettingsHeight:n,onUpdateUiState:r,onUpdateValue:a,disabledInstructionIds:i,t:s,targetLanguage:l,scale:c,maxHeight:d,charDescMode:h,safeGeneration:g=!1,thinkingEnabled:m=!1,model:_,targetScrollId:y,onSetTargetScrollId:v,propEnhancementEnabled:C=!0,isProcessWholeScene:w,onToggleProcessWholeScene:b,isSaturationEnabled:f,onToggleSaturation:T,onTogglePropEnhancement:I,nodeId:E})=>{const[R,N]=x.useState(!1),[A,k]=x.useState(""),P=x.useRef({}),M=x.useRef(null),[H,W]=x.useState(t||380);x.useEffect(()=>{Math.abs(t-H)>1&&W(t||380)},[t]),x.useEffect(()=>{if(y){k(""),setTimeout(()=>{if(P.current[y]&&!e.isSettingsCollapsed){const ee=P.current[y],Te=M.current;if(ee&&Te){const le=ee.offsetTop,J=Math.max(0,le-Te.clientHeight/2+ee.clientHeight/2);Te.scrollTo({top:J,behavior:"smooth"})}}},50);const $=setTimeout(()=>{v(null)},2e3);return()=>clearTimeout($)}},[y,e.isSettingsCollapsed,v]);const O=$=>{$.preventDefault(),$.stopPropagation();const ee=$.clientY,Te=H;let le=Te;const J=ae=>{ae.preventDefault(),ae.stopPropagation();const ce=(ae.clientY-ee)/c;le=Math.max(100,Math.min(800,Te+ce)),W(le),n(le)},ge=ae=>{ae.preventDefault(),ae.stopPropagation(),window.removeEventListener("mousemove",J),window.removeEventListener("mouseup",ge),a({settingsPaneHeight:le})};window.addEventListener("mousemove",J),window.addEventListener("mouseup",ge)},U=$=>{$.stopPropagation(),a({disabledInstructionIds:["break_paragraphs","pm_anthro","pm_subscribe","rule_saturation"],charDescMode:"none",safeGeneration:!1,thinkingEnabled:!1,propEnhancementEnabled:!0})},z=$=>{const ee=i.includes($);let Te;ee?Te=i.filter(ge=>ge!==$):Te=[...i,$];const le=ne.GENERATE_VIDEO_PROMPT.id,J=ne.IMG_VID_CONSISTENCY.id;$===le&&(ee?Te=Te.filter(ge=>ge!==J):Te.includes(J)||Te.push(J)),a({disabledInstructionIds:Te})},L=$=>!i.includes($),D=L(ne.GENERATE_VIDEO_PROMPT.id),G=$=>$==="gemini-3-flash-preview"?"Gemini 3 Flash Preview":$==="gemini-3-pro-preview"?"Gemini 3 Pro Preview":$;let q=0;const ie=($,ee)=>{v(ee)},te=($,ee)=>{if(!A)return!0;const Te=A.toLowerCase();return $.toLowerCase().includes(Te)||ee.toLowerCase().includes(Te)},ye=()=>h==="none"?Xu:L(ne.VISUAL_SATURATION.id)?ne.LAYERED_CONSTRUCTION.text:Ju,ue=()=>h==="none"?"instruction.desc.layered_no_char":L(ne.VISUAL_SATURATION.id)?"instruction.desc.layered":"instruction.desc.layered_no_style";return o.jsxs("div",{className:`border ${R?"border-emerald-500":"border-gray-600"} hover:border-gray-400 rounded-md bg-gray-900 overflow-hidden mb-2 flex-shrink-0 flex flex-col relative transition-colors duration-200`,style:{height:e.isSettingsCollapsed?"auto":`${H}px`},onWheel:$=>$.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>r({isSettingsCollapsed:!e.isSettingsCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-1.533 2.16-1.535.113-1.535 2.322 0 2.435 1.594.118 2.073 1.274 1.533 2.16-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.948c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.948c1.372.836 2.942-.734 2.106-2.106-.54-.886-.061-2.042 1.533-2.16 1.535-.113 1.535-2.322 0-2.435-1.594-.118-2.073-1.274-1.533-2.16.836-1.372-.734-2.942-2.106-2.106a1.533 1.533 0 01-2.287-.948zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})}),o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:s("node.content.activePromptStack")})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ie,{title:s("toolbar.resetToDefault"),onClick:U,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Ie,{title:e.isSettingsCollapsed?s("node.action.expand"):s("node.action.collapse"),onClick:$=>{$.stopPropagation(),r({isSettingsCollapsed:!e.isSettingsCollapsed})},children:e.isSettingsCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]})]}),!e.isSettingsCollapsed&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"px-2 py-2 border-b border-gray-700 bg-gray-800/30 flex flex-wrap gap-x-3 gap-y-2",children:[o.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 px-1.5 py-0.5 rounded border border-gray-700 group",children:[o.jsx(ft,{id:`quick-safe-${E}`,checked:g,onChange:$=>a({safeGeneration:$}),className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:`quick-safe-${E}`,className:"text-xs text-gray-300 select-none cursor-pointer group-hover:text-emerald-400 transition-colors whitespace-nowrap",children:s("node.content.safeGeneration")}),o.jsx(aa,{id:"safe-gen-brick",onClick:ie,t:s})]}),o.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 px-1.5 py-0.5 rounded border border-gray-700 group",children:[o.jsx(ft,{id:`quick-thinking-${E}`,checked:m,onChange:$=>a({thinkingEnabled:$}),className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:`quick-thinking-${E}`,className:"text-xs text-gray-300 select-none cursor-pointer group-hover:text-cyan-400 transition-colors whitespace-nowrap",children:s("node.content.thinkingEnabled")}),o.jsx(aa,{id:"thinking-brick",onClick:ie,t:s})]}),o.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 px-1.5 py-0.5 rounded border border-gray-700 group",children:[o.jsx(ft,{id:`quick-anthro-${E}`,checked:L(ne.ANTHRO_REINFORCEMENT.id),onChange:()=>z(ne.ANTHRO_REINFORCEMENT.id),className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:`quick-anthro-${E}`,className:"text-xs text-gray-300 select-none cursor-pointer group-hover:text-cyan-400 transition-colors whitespace-nowrap",children:s("node.content.anthroEnabled")}),o.jsx(aa,{id:ne.ANTHRO_REINFORCEMENT.id,onClick:ie,t:s})]}),o.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 px-1.5 py-0.5 rounded border border-gray-700 group",children:[o.jsx(ft,{id:`quick-format-${E}`,checked:L(ne.BREAK_PARAGRAPHS.id),onChange:()=>z(ne.BREAK_PARAGRAPHS.id),className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:`quick-format-${E}`,className:"text-xs text-gray-300 select-none cursor-pointer group-hover:text-white transition-colors whitespace-nowrap",children:s("instruction.formatting")}),o.jsx(aa,{id:ne.BREAK_PARAGRAPHS.id,onClick:ie,t:s})]}),o.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 px-1.5 py-0.5 rounded border border-gray-700 group",children:[o.jsx(ft,{id:`quick-general-char-${E}`,checked:h==="general",onChange:()=>a({charDescMode:h==="general"?"none":"general"}),className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:`quick-general-char-${E}`,className:"text-xs text-gray-300 select-none cursor-pointer group-hover:text-emerald-400 transition-colors whitespace-nowrap",children:s("node.content.includeGeneralCharDesc")}),o.jsx(aa,{id:ne.GENERAL_CHAR_DESC.id,onClick:ie,t:s})]}),o.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 px-1.5 py-0.5 rounded border border-gray-700 group",children:[o.jsx(ft,{id:`quick-video-prompt-${E}`,checked:D,onChange:()=>z(ne.GENERATE_VIDEO_PROMPT.id),className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:`quick-video-prompt-${E}`,className:"text-xs text-gray-300 select-none cursor-pointer group-hover:text-cyan-400 transition-colors whitespace-nowrap",children:s("instruction.video")}),o.jsx(aa,{id:ne.GENERATE_VIDEO_PROMPT.id,onClick:ie,t:s})]})]}),o.jsx("div",{className:"p-2 border-b border-gray-700 bg-gray-800/80 sticky top-0 z-10 flex items-center gap-2",children:o.jsxs("div",{className:"relative w-full",children:[o.jsx("input",{type:"text",value:A,onChange:$=>k($.target.value),placeholder:s("node.content.findStack"),className:"w-full pl-7 pr-2 py-1 text-xs bg-gray-900/80 border border-gray-600 rounded-md focus:outline-none focus:border-emerald-500 text-gray-300 placeholder-gray-600"}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 absolute left-2 top-1/2 -translate-y-1/2 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),A&&o.jsx("button",{onClick:()=>k(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white",children:""})]})}),o.jsxs("div",{ref:M,className:"p-2 overflow-y-auto custom-scrollbar flex-grow bg-gray-800/20 space-y-2 pb-4 relative",onWheel:$=>$.stopPropagation(),children:[te(G(_),s("node.content.model"))&&o.jsx(Ut,{ref:$=>{P.current["model-brick"]=$},id:"model-brick",label:s("node.content.model"),originalText:G(_),isMandatory:!0,color:"gray",className:"h-auto",isHighlighted:y==="model-brick"}),te(ne.INPUTS.text,s(`instruction.${ne.INPUTS.id}`))&&o.jsx(Ut,{ref:$=>{P.current[ne.INPUTS.id]=$},id:ne.INPUTS.id,index:++q,label:s(`instruction.${ne.INPUTS.id}`),originalText:ne.INPUTS.text,translatedText:s(`instruction.desc.${ne.INPUTS.id}`),isMandatory:!0,color:"gray",className:"h-auto",isHighlighted:y===ne.INPUTS.id}),te(Bn(l),s("node.content.targetLanguage"))&&o.jsx(Ut,{id:"target-lang-brick",index:++q,label:s("node.content.targetLanguage"),originalText:Bn(l),translatedText:s("instruction.desc.target_lang"),isMandatory:!0,color:"gray",className:"h-auto"}),te("Enable extended reasoning",s("node.content.thinkingEnabled"))&&o.jsx(Ut,{ref:$=>{P.current["thinking-brick"]=$},id:"thinking-brick",index:m?++q:void 0,label:s("node.content.thinkingEnabled"),originalText:"Enable extended reasoning for deeper plot coherence.",translatedText:"     .",isEnabled:m,onToggle:()=>a({thinkingEnabled:!m}),color:"cyan",className:"h-auto",isHighlighted:y==="thinking-brick"}),o.jsxs("div",{className:"space-y-1 flex-none mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:s("node.content.spm_stack.priming")}),te(Qo.text,s("node.content.safeGeneration"))&&o.jsx(Ut,{ref:$=>{P.current["safe-gen-brick"]=$},id:"safe-gen-brick",index:g?++q:void 0,label:s("node.content.safeGeneration"),originalText:Qo.text,translatedText:s("instruction.desc.safe_gen"),isCritical:!0,isEnabled:g,onToggle:()=>a({safeGeneration:!g}),className:"h-auto",isHighlighted:y==="safe-gen-brick"}),te(ne.ROLE.text,s("instruction.role"))&&o.jsx(Ut,{ref:$=>{P.current[ne.ROLE.id]=$},id:ne.ROLE.id,index:++q,label:s("instruction.role"),originalText:ne.ROLE.text,translatedText:s("instruction.desc.role"),isMandatory:!0,className:"h-auto",isHighlighted:y===ne.ROLE.id})]}),o.jsxs("div",{className:"space-y-1 flex-none mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:s("node.content.spm_stack.physics")}),te(ne.NO_POV.text,s("instruction.no_pov"))&&o.jsx(Ut,{ref:$=>{P.current[ne.NO_POV.id]=$},id:ne.NO_POV.id,index:++q,label:s("instruction.no_pov"),originalText:ne.NO_POV.text,translatedText:s("instruction.desc.no_pov"),isMandatory:!0,isCritical:!0,className:"h-auto",isHighlighted:y===ne.NO_POV.id}),te(ne.STATIC_STATE.text,s("instruction.rule_static"))&&o.jsx(Ut,{ref:$=>{P.current[ne.STATIC_STATE.id]=$},id:ne.STATIC_STATE.id,index:++q,label:s("instruction.rule_static"),originalText:ne.STATIC_STATE.text,translatedText:s("instruction.desc.rule_static"),isMandatory:!0,className:"h-auto",isHighlighted:y===ne.STATIC_STATE.id}),te(ne.ATMOSPHERIC_FIX.text,s("instruction.atmosphere_fix"))&&o.jsx(Ut,{ref:$=>{P.current[ne.ATMOSPHERIC_FIX.id]=$},id:ne.ATMOSPHERIC_FIX.id,index:++q,label:s("instruction.atmosphere_fix"),originalText:ne.ATMOSPHERIC_FIX.text,translatedText:s("instruction.desc.atmosphere_fix"),isMandatory:!0,className:"h-auto",isHighlighted:y===ne.ATMOSPHERIC_FIX.id}),te(ne.STATELESS.text,s("instruction.stateless"))&&o.jsx(Ut,{ref:$=>{P.current[ne.STATELESS.id]=$},id:ne.STATELESS.id,index:++q,label:s("instruction.stateless"),originalText:ne.STATELESS.text,translatedText:s("instruction.desc.stateless"),isMandatory:!0,isCritical:!0,className:"h-auto",isHighlighted:y===ne.STATELESS.id}),te(ne.ALWAYS_ENV.text,s("instruction.always_env"))&&o.jsx(Ut,{ref:$=>{P.current[ne.ALWAYS_ENV.id]=$},id:ne.ALWAYS_ENV.id,index:++q,label:s("instruction.always_env"),originalText:ne.ALWAYS_ENV.text,translatedText:s("instruction.desc.always_env"),isCritical:!0,isMandatory:!0,className:"h-auto",isHighlighted:y===ne.ALWAYS_ENV.id})]}),o.jsxs("div",{className:"space-y-1 flex-none mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:s("node.content.spm_stack.hierarchy")}),te(ne.SUBJECT_FOCUS.text,s("instruction.subject_focus"))&&o.jsx(Ut,{ref:$=>{P.current[ne.SUBJECT_FOCUS.id]=$},id:ne.SUBJECT_FOCUS.id,index:++q,label:s("instruction.subject_focus"),originalText:ne.SUBJECT_FOCUS.text,translatedText:s("instruction.desc.subject_focus"),isMandatory:!0,className:"h-auto",isHighlighted:y===ne.SUBJECT_FOCUS.id}),te(ne.ANATOMICAL_STRICTNESS.text,s("instruction.anatomical_strictness"))&&o.jsx(Ut,{ref:$=>{P.current[ne.ANATOMICAL_STRICTNESS.id]=$},id:ne.ANATOMICAL_STRICTNESS.id,index:L(ne.ANATOMICAL_STRICTNESS.id)?++q:void 0,label:s("instruction.anatomical_strictness"),originalText:ne.ANATOMICAL_STRICTNESS.text,translatedText:s("instruction.desc.anatomical_strictness"),onToggle:()=>z(ne.ANATOMICAL_STRICTNESS.id),isEnabled:L(ne.ANATOMICAL_STRICTNESS.id),isCritical:!0,color:"emerald",className:"h-auto",isHighlighted:y===ne.ANATOMICAL_STRICTNESS.id}),te(ne.PROP_ENHANCEMENT.text,ne.PROP_ENHANCEMENT.label)&&o.jsx(Ut,{ref:$=>{P.current[ne.PROP_ENHANCEMENT.id]=$},id:ne.PROP_ENHANCEMENT.id,index:C?++q:void 0,label:ne.PROP_ENHANCEMENT.label,originalText:ne.PROP_ENHANCEMENT.text,translatedText:s("instruction.desc.prop_enhancement"),isEnabled:C,onToggle:()=>a({propEnhancementEnabled:!C}),color:"emerald",className:"h-auto",isHighlighted:y===ne.PROP_ENHANCEMENT.id}),te(ne.STRICT_CHAR_INDEX.text,s("instruction.strict_char_index"))&&o.jsx(Ut,{ref:$=>{P.current[ne.STRICT_CHAR_INDEX.id]=$},id:ne.STRICT_CHAR_INDEX.id,index:++q,label:s("instruction.strict_char_index"),originalText:ne.STRICT_CHAR_INDEX.text,translatedText:s("instruction.desc.strict_char_index"),isMandatory:!0,className:"h-auto",isHighlighted:y===ne.STRICT_CHAR_INDEX.id}),te(ne.NO_NAMES.text,s("instruction.no_names"))&&o.jsx(Ut,{ref:$=>{P.current[ne.NO_NAMES.id]=$},id:ne.NO_NAMES.id,index:++q,label:s("instruction.no_names"),originalText:ne.NO_NAMES.text,translatedText:s("instruction.desc.no_names"),isCritical:!0,isMandatory:!0,className:"h-auto",isHighlighted:y===ne.NO_NAMES.id}),o.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[te(ne.ANTHRO_REINFORCEMENT.text,s("node.content.anthroEnabled"))&&o.jsx(Ut,{ref:$=>{P.current[ne.ANTHRO_REINFORCEMENT.id]=$},id:ne.ANTHRO_REINFORCEMENT.id,index:L(ne.ANTHRO_REINFORCEMENT.id)?++q:void 0,label:s("node.content.anthroEnabled"),originalText:ne.ANTHRO_REINFORCEMENT.text,translatedText:s("instruction.desc.pm_anthro"),onToggle:()=>z(ne.ANTHRO_REINFORCEMENT.id),isEnabled:L(ne.ANTHRO_REINFORCEMENT.id),color:"cyan",className:"h-auto",isHighlighted:y===ne.ANTHRO_REINFORCEMENT.id}),te(ne.SUBSCRIBE_REINFORCEMENT.text,s("node.content.subscribeEnhancement"))&&o.jsx(Ut,{ref:$=>{P.current[ne.SUBSCRIBE_REINFORCEMENT.id]=$},id:ne.SUBSCRIBE_REINFORCEMENT.id,index:L(ne.SUBSCRIBE_REINFORCEMENT.id)?++q:void 0,label:s("node.content.subscribeEnhancement"),originalText:ne.SUBSCRIBE_REINFORCEMENT.text,translatedText:s("instruction.desc.pm_subscribe"),onToggle:()=>z(ne.SUBSCRIBE_REINFORCEMENT.id),isEnabled:L(ne.SUBSCRIBE_REINFORCEMENT.id),color:"cyan",className:"h-auto",isHighlighted:y===ne.SUBSCRIBE_REINFORCEMENT.id})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-1 mt-1",children:[te(s("node.content.noCharDesc"),s("node.content.noCharDesc"))&&o.jsx(Ut,{id:"no-char-desc",index:h==="none"?++q:void 0,label:s("node.content.noCharDesc"),originalText:"Excludes character visual descriptions.",translatedText:s("instruction.desc.layered_no_char"),isEnabled:h==="none",onToggle:()=>a({charDescMode:"none"}),color:"gray"}),te(ne.GENERAL_CHAR_DESC.text,s("node.content.includeGeneralCharDesc"))&&o.jsx(Ut,{ref:$=>{P.current[ne.GENERAL_CHAR_DESC.id]=$},id:ne.GENERAL_CHAR_DESC.id,index:h==="general"?++q:void 0,label:s("node.content.includeGeneralCharDesc"),originalText:ne.GENERAL_CHAR_DESC.text,translatedText:s("instruction.desc.general_char_desc"),isEnabled:h==="general",onToggle:()=>a({charDescMode:"general"}),color:"emerald",isHighlighted:y===ne.GENERAL_CHAR_DESC.id}),te(ne.FULL_CHAR_DESC.text,s("node.content.includeFullCharDesc"))&&o.jsx(Ut,{ref:$=>{P.current[ne.FULL_CHAR_DESC.id]=$},id:ne.FULL_CHAR_DESC.id,index:h==="full"?++q:void 0,label:s("node.content.includeFullCharDesc"),originalText:ne.FULL_CHAR_DESC.text,translatedText:s("instruction.desc.full_char_desc"),isEnabled:h==="full",onToggle:()=>a({charDescMode:"full"}),color:"emerald",isHighlighted:y===ne.FULL_CHAR_DESC.id})]})]}),o.jsxs("div",{className:"space-y-1 flex-none",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:s("node.content.spm_stack.construction")}),te(ne.PROCESS_WHOLE_SCENE.text,s("instruction.process_whole_scene"))&&o.jsx(Ut,{ref:$=>{P.current[ne.PROCESS_WHOLE_SCENE.id]=$},id:ne.PROCESS_WHOLE_SCENE.id,index:L(ne.PROCESS_WHOLE_SCENE.id)?++q:void 0,label:s("instruction.process_whole_scene"),originalText:ne.PROCESS_WHOLE_SCENE.text,translatedText:s("instruction.desc.process_whole_scene"),onToggle:()=>z(ne.PROCESS_WHOLE_SCENE.id),isEnabled:L(ne.PROCESS_WHOLE_SCENE.id),color:"cyan",className:"h-auto",isHighlighted:y===ne.PROCESS_WHOLE_SCENE.id}),te(ye(),s("instruction.layered"))&&o.jsx(Ut,{ref:$=>{P.current[ne.LAYERED_CONSTRUCTION.id]=$},id:ne.LAYERED_CONSTRUCTION.id,index:++q,label:s("instruction.layered"),originalText:ye(),translatedText:s(ue()),onToggle:()=>z(ne.LAYERED_CONSTRUCTION.id),isEnabled:L(ne.LAYERED_CONSTRUCTION.id),color:"emerald",className:"h-auto",isHighlighted:y===ne.LAYERED_CONSTRUCTION.id}),te(ne.VISUAL_SATURATION.text,s("instruction.visuals"))&&o.jsx(Ut,{ref:$=>{P.current[ne.VISUAL_SATURATION.id]=$},id:ne.VISUAL_SATURATION.id,index:L(ne.VISUAL_SATURATION.id)?++q:void 0,label:s("instruction.visuals"),originalText:ne.VISUAL_SATURATION.text,translatedText:s("instruction.desc.visuals"),onToggle:()=>z(ne.VISUAL_SATURATION.id),isEnabled:L(ne.VISUAL_SATURATION.id),color:"cyan",className:"h-auto",isHighlighted:y===ne.VISUAL_SATURATION.id}),te(ne.BREAK_PARAGRAPHS.text,s("instruction.formatting"))&&o.jsx(Ut,{ref:$=>{P.current[ne.BREAK_PARAGRAPHS.id]=$},id:ne.BREAK_PARAGRAPHS.id,index:L(ne.BREAK_PARAGRAPHS.id)?++q:void 0,label:s("instruction.formatting"),originalText:ne.BREAK_PARAGRAPHS.text,translatedText:s("instruction.desc.formatting"),onToggle:()=>z(ne.BREAK_PARAGRAPHS.id),isEnabled:L(ne.BREAK_PARAGRAPHS.id),color:"gray",className:"h-auto",isHighlighted:y===ne.BREAK_PARAGRAPHS.id}),te(ne.GENERATE_VIDEO_PROMPT.text,s("instruction.video"))&&o.jsx(Ut,{ref:$=>{P.current[ne.GENERATE_VIDEO_PROMPT.id]=$},id:ne.GENERATE_VIDEO_PROMPT.id,index:D?++q:void 0,label:s("instruction.video"),originalText:ne.GENERATE_VIDEO_PROMPT.text,translatedText:s("instruction.desc.video"),onToggle:()=>z(ne.GENERATE_VIDEO_PROMPT.id),isEnabled:D,color:"cyan",className:"h-auto",isHighlighted:y===ne.GENERATE_VIDEO_PROMPT.id}),te(ne.IMG_VID_CONSISTENCY.text,s("instruction.img_vid_consistency"))&&o.jsx(Ut,{ref:$=>{P.current[ne.IMG_VID_CONSISTENCY.id]=$},id:ne.IMG_VID_CONSISTENCY.id,index:L(ne.IMG_VID_CONSISTENCY.id)?++q:void 0,label:s("instruction.img_vid_consistency"),originalText:ne.IMG_VID_CONSISTENCY.text,translatedText:s("instruction.desc.img_vid_consistency"),onToggle:()=>z(ne.IMG_VID_CONSISTENCY.id),isEnabled:L(ne.IMG_VID_CONSISTENCY.id),color:"emerald",className:"h-auto",isHighlighted:y===ne.IMG_VID_CONSISTENCY.id})]})]}),o.jsx("div",{className:"absolute bottom-0 inset-x-0 h-3 cursor-ns-resize bg-transparent z-20",onMouseDown:O,onMouseEnter:()=>N(!0),onMouseLeave:()=>N(!1)})]})]})}),I5=({uiState:e,onUpdateUiState:t,onUpdateValue:n,upstreamAnalyzerData:r,isStyleConnected:a,isDataConnected:i,upstreamStyleValue:s,styleOverride:l,deselectAllNodes:c,t:d,characters:h,onRefresh:g})=>{const m=(r==null?void 0:r.generatedStyle)||((r==null?void 0:r.visualStyle)!=="none"?r==null?void 0:r.visualStyle:"")||"",_=a?d("node.content.connectedPlaceholder"):m||d("node.content.stylePromptPlaceholder"),y=x.useMemo(()=>h?[...h].sort((v,C)=>{const w=T=>{const I=(T||"").match(/(\d+)/);return I?parseInt(I[1],10):99999},b=v.index||v.alias||"",f=C.index||C.alias||"";return w(b)-w(f)}):[],[h]);return o.jsxs("div",{className:"flex-shrink-0 mb-1 bg-gray-900 rounded-md border border-gray-700 hover:border-gray-400 overflow-hidden flex flex-col transition-colors duration-200",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors",onClick:()=>t({isCharStyleCollapsed:!e.isCharStyleCollapsed}),children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"})}),o.jsxs("h3",{className:"font-bold text-gray-400 text-xs uppercase tracking-wider",children:[d("node.content.characters")," & ",d("node.content.style")]}),g&&o.jsx("button",{onClick:v=>{v.stopPropagation(),g()},className:"p-1 hover:bg-gray-700 rounded text-emerald-400 hover:text-emerald-300 transition-colors ml-2",title:d("node.action.refreshData"),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),o.jsx("div",{className:"pl-1 border-l border-gray-700 ml-1",children:o.jsx(Ie,{tooltipPosition:"left",title:e.isCharStyleCollapsed?d("node.action.expand"):d("node.action.collapse"),onClick:v=>{v.stopPropagation(),t({isCharStyleCollapsed:!e.isCharStyleCollapsed})},children:e.isCharStyleCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})})]}),!e.isCharStyleCollapsed&&o.jsxs("div",{className:"p-2 flex gap-2 h-[170px]",children:[o.jsx("div",{className:"w-1/2 flex flex-col min-h-0",children:o.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar pr-1 space-y-1 bg-gray-800 rounded-md p-1 border border-gray-700",onWheel:v=>v.stopPropagation(),children:y&&y.length>0?y.map((v,C)=>o.jsxs("div",{className:"bg-gray-800 p-1.5 rounded-md text-xs flex flex-col border border-gray-600/50",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"flex items-center gap-1.5 flex-1 min-w-0",children:[i&&o.jsx("div",{title:"Linked from upstream",className:"text-emerald-400 flex-shrink-0",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),o.jsx("span",{className:"font-semibold text-gray-200 truncate",title:v.name,children:v.name||"Unknown"})]}),(v.index||v.alias)&&o.jsxs("span",{className:"text-gray-400 ml-2 flex-shrink-0 font-mono text-[10px]",children:["(",v.index||v.alias,")"]})]}),v.id&&o.jsxs("div",{className:"text-[9px] text-gray-500 font-mono mt-0.5 truncate select-all",title:v.id,children:["ID: ",v.id]})]},C)):o.jsx("p",{className:"text-xs text-gray-500 text-center pt-4",children:d("node.content.noCharactersAnalyzed")})})}),o.jsx("div",{className:"w-1/2 flex flex-col min-h-0 border-l border-gray-700 pl-2",children:o.jsx("textarea",{value:a?s:l,onChange:v=>n({styleOverride:v.target.value}),placeholder:_,readOnly:a,className:"w-full flex-grow p-2 bg-gray-800 rounded-md resize-none focus:ring-1 focus:ring-emerald-500 focus:outline-none custom-scrollbar read-only:bg-gray-800/50 read-only:cursor-default read-only:text-gray-400 border border-gray-700 text-xs leading-relaxed placeholder-gray-500",onWheel:v=>v.stopPropagation(),onFocus:c,style:{scrollbarGutter:"stable"}})})]})]})},P5=_t.memo(({scene:e,t,isCollapsed:n,onToggle:r})=>{const a=e.frames&&Array.isArray(e.frames)&&e.frames.length>0,i=(e.title||"").replace(/^(Scene||Scne|Escena|Szene)\s*\d+[:\s-]*/i,"").trim();return o.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2 border border-transparent hover:border-gray-700/50 transition-colors",children:[o.jsxs("div",{className:"flex justify-between items-center cursor-pointer select-none",onClick:s=>{s.stopPropagation(),r()},children:[o.jsxs("div",{className:"flex flex-col min-w-0",children:[o.jsx("span",{className:"font-semibold text-gray-300 text-sm truncate pr-2",children:`${t("node.content.scene")} ${e.sceneNumber}${i?`: ${i}`:""}`}),o.jsx("span",{className:"text-[9px] text-emerald-500 font-mono font-bold uppercase tracking-wider",children:a?`${e.frames.length} ${t("node.content.frame_plural")}`:e.recommendedFrames!==void 0?`${t("node.content.recommendedFrames")}: ${e.recommendedFrames}`:""})]}),o.jsx(Ie,{tooltipPosition:"left",title:t(n?"node.action.expandScene":"node.action.collapseScene"),onClick:s=>{s.stopPropagation(),r()},children:n?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!n&&o.jsx("div",{className:"mt-2 text-xs",children:a?o.jsxs("div",{className:"space-y-3",children:[e.sceneContext&&o.jsxs("div",{className:"bg-gray-900/30 p-2 rounded border border-gray-700/50",children:[o.jsx("p",{className:"text-[9px] uppercase font-bold text-emerald-500 mb-1",children:t("node.content.sceneContext")}),o.jsx("p",{className:"text-gray-300 whitespace-pre-wrap leading-relaxed",children:e.sceneContext})]}),o.jsx("div",{className:"space-y-2",children:e.frames.map((s,l)=>{const c=(s.characters||[]).map(h=>{const g=h.match(/(?:Entity|Character|)[-\s]?(\d+)/i);return g?`ENT-${g[1]}`:h}),d=c.length>0?c.join(", "):"";return o.jsxs("div",{className:"bg-gray-900/50 p-2 rounded border border-gray-800",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1.5 border-b border-gray-800 pb-1",children:[o.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[o.jsxs("span",{className:"text-[10px] font-bold text-gray-400 whitespace-nowrap",children:[t("node.content.frame")," ",s.frameNumber," ",s.shotType?`| ${s.shotType}`:""]}),d&&o.jsx("span",{className:"text-[9px] text-cyan-500 font-mono truncate",title:d,children:d})]}),s.duration&&o.jsxs("span",{className:"text-[9px] text-gray-600 whitespace-nowrap ml-1",children:[s.duration,"s"]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-[9px] text-emerald-600 uppercase font-semibold",children:t("node.content.compositionAndBlocking")}),o.jsx("p",{className:"text-[10px] text-gray-400 italic leading-snug",children:s.imagePrompt})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[9px] text-cyan-600 uppercase font-semibold",children:t("node.content.environmentPrompt")}),o.jsx("p",{className:"text-[10px] text-gray-400 italic leading-snug",children:s.environmentPrompt})]}),s.videoPrompt&&o.jsxs("div",{children:[o.jsx("p",{className:"text-[9px] text-purple-500 uppercase font-semibold",children:t("node.content.videoPrompt")}),o.jsx("p",{className:"text-[10px] text-gray-400 italic leading-snug",children:s.videoPrompt})]})]})]},l)})})]}):o.jsxs(o.Fragment,{children:[o.jsx("p",{className:"text-gray-400 whitespace-pre-wrap select-text",children:e.description}),e.narratorText&&o.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-700/50",children:[o.jsx("p",{className:"font-semibold text-emerald-400 mb-1",children:t("node.content.narrator")}),o.jsx("p",{className:"text-gray-300 italic whitespace-pre-wrap select-text pl-2 border-l-2 border-emerald-500",children:e.narratorText})]})]})})]})}),R5=({verticalDividerPos:e,isProcessWholeScene:t,upstreamAnalyzerData:n,collapsedInputScenes:r,collapsedInputFrames:a,collapsedInputContexts:i,onToggleInputSceneCollapse:s,onToggleInputFrameCollapse:l,onToggleInputContextCollapse:c,onToggleAllInputScenes:d,onToggleAllInputFrames:h,areAllInputScenesCollapsed:g,areAllInputFramesCollapsed:m,t:_})=>o.jsxs("div",{className:"overflow-y-scroll overflow-x-hidden custom-scrollbar pr-1 space-y-2 px-1",style:{width:`calc(${e}% - 0.5rem)`,contentVisibility:"auto"},onWheel:y=>y.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center pr-2 sticky top-0 bg-gray-900 z-10 pt-1 pb-1 border-b border-gray-800/50 mb-2 -mx-1 px-2",children:[o.jsx("h3",{className:"font-bold text-emerald-400 px-1",children:_("node.content.inputFrames")}),(n==null?void 0:n.scenes)&&n.scenes.length>0&&o.jsx(Ie,{tooltipPosition:"left",title:_(g?"node.action.expandAllScenes":"node.action.collapseAllScenes"),onClick:d,children:g?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})]}),(n==null?void 0:n.summary)&&o.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2 border border-transparent mb-2",children:[o.jsx("h4",{className:"font-semibold text-gray-300 text-sm mb-1",children:_("node.content.summary")}),o.jsx("div",{className:"text-xs text-gray-400 whitespace-pre-wrap select-text",children:n.summary})]}),n!=null&&n.scenes&&n.scenes.length>0?n.scenes.map((y,v)=>o.jsx(P5,{scene:y,t:_,isCollapsed:r.has(v),onToggle:()=>s(v)},v)):o.jsx("div",{className:"text-center text-xs text-gray-500 p-4",children:_("node.content.noInputScenes")})]});_t.memo(({frame:e,characters:t,t:n,isCollapsed:r,onToggle:a})=>{const i=(e.characters||[]).map(d=>{const h=d.match(/(?:Entity|Character|)[-\s]?(\d+)/i);return h?`ENT-${h[1]}`:d}),s=i.length>0?i.join(", "):"NONE",l=e.shotType?` | ${e.shotType}`:"",c=`Frame-${e.frameNumber}${l}  ${s}`;return o.jsxs("div",{className:"bg-gray-800 rounded-lg p-2 border border-gray-700",children:[o.jsxs("h4",{className:"font-semibold text-gray-300 text-sm flex justify-between items-center cursor-pointer select-none",onClick:d=>{d.stopPropagation(),a()},children:[o.jsx("span",{className:"truncate pr-2",children:c}),o.jsx(Ie,{tooltipPosition:"left",title:n(r?"node.action.expandFrame":"node.action.collapseFrame"),onClick:d=>{d.stopPropagation(),a()},children:r?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!r&&o.jsxs("div",{className:"mt-1 text-xs space-y-2",children:[o.jsxs("div",{className:"pt-1",children:[o.jsx("p",{className:"font-semibold text-emerald-400 mb-0.5",children:n("node.content.compositionAndBlocking")}),o.jsx("p",{className:"text-gray-300 italic whitespace-pre-wrap select-text pl-2 border-l-2 border-emerald-500",children:e.imagePrompt})]}),o.jsxs("div",{className:"pt-1 border-t border-gray-700/50",children:[o.jsx("p",{className:"font-semibold text-cyan-400 mb-0.5",children:n("node.content.environmentPrompt")}),o.jsx("p",{className:"text-gray-300 italic whitespace-pre-wrap select-text pl-2 border-l-2 border-cyan-500",children:e.environmentPrompt})]})]})]})});const M5=_t.memo(({promptId:e,title:t,imagePrompt:n,videoPrompt:r,isCollapsed:a,t:i,onToggleCollapse:s,onCopy:l,onDelete:c})=>o.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 space-y-0",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 cursor-pointer hover:bg-gray-700/50 transition-colors rounded-t-lg",onDoubleClick:()=>s(e),onClick:()=>s(e),children:[o.jsxs("div",{className:"flex items-center space-x-2 flex-grow min-w-0",children:[o.jsx(Ie,{tooltipPosition:"right",title:i(a?"node.action.expand":"node.action.collapse"),onClick:d=>{d.stopPropagation(),s(e)},children:a?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsx("h4",{className:"font-bold text-white truncate pr-2 text-sm",title:t,children:t})]}),o.jsx("div",{className:"flex items-center space-x-1",children:o.jsx(Ie,{tooltipPosition:"left",title:i("node.action.deleteItem"),onClick:d=>{d.stopPropagation(),c()},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]}),!a&&o.jsxs("div",{className:"p-2 space-y-3 border-t border-gray-700",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-emerald-400 uppercase tracking-wider",children:i("node.content.imagePrompt")}),o.jsx(Ie,{tooltipPosition:"left",title:i("node.action.copy"),onClick:d=>{d.stopPropagation(),l(n)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})})]}),o.jsx("textarea",{className:"w-full p-2 bg-gray-900 border border-gray-700 rounded-md resize-none focus:outline-none custom-scrollbar text-xs text-gray-300 h-[120px]",value:n,readOnly:!0})]}),r&&o.jsxs("div",{className:"flex flex-col",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-emerald-400 uppercase tracking-wider",children:i("node.content.videoPrompt")}),o.jsx(Ie,{tooltipPosition:"left",title:i("node.action.copy"),onClick:d=>{d.stopPropagation(),l(r)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})})})]}),o.jsx("textarea",{className:"w-full p-2 bg-gray-900 border border-gray-700 rounded-md resize-none focus:outline-none custom-scrollbar text-xs text-gray-300 h-[60px]",value:r,readOnly:!0})]})]})]})),j5=({verticalDividerPos:e,groupedPrompts:t,collapsedOutputScenes:n,collapsedPrompts:r,areAllOutputScenesCollapsed:a,areAllOutputPromptsCollapsed:i,sceneContexts:s,onToggleOutputSceneCollapse:l,onTogglePromptCollapse:c,onToggleAllOutputScenes:d,onToggleAllOutputPrompts:h,onDeletePrompt:g,onDeleteScenePrompts:m,onDownloadJson:_,onCopy:y,onUpdateSceneContext:v,t:C,deselectAllNodes:w})=>{const[b,f]=x.useState(new Set),T=I=>{f(E=>{const R=new Set(E);return R.has(I)?R.delete(I):R.add(I),R})};return o.jsxs("div",{className:"overflow-y-scroll custom-scrollbar pl-1 space-y-2",style:{width:`calc(${100-e}% - 0.5rem)`,contentVisibility:"auto"},onWheel:I=>I.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center pl-2 sticky top-0 bg-gray-900 z-10 pt-1 pb-1 border-b border-gray-800/50",children:[o.jsx("h3",{className:"font-bold text-emerald-400 px-2",children:C("node.content.finalPrompt_plural")}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ie,{tooltipPosition:"left",title:C("node.action.downloadJson"),onClick:_,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),t.length>0&&o.jsxs(o.Fragment,{children:[o.jsx(Ie,{tooltipPosition:"left",title:C(a?"node.action.expandAllScenes":"node.action.collapseAllScenes"),onClick:d,children:a?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"})})}),o.jsx(Ie,{tooltipPosition:"left",title:C(i?"node.action.expandAllFrames":"node.action.collapseAllFrames"),onClick:h,disabled:a,children:i?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${a?"text-gray-600":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${a?"text-gray-600":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})})]})]})]}),t.length>0?t.map(I=>{const E=n.has(I.sceneNum),R=s[I.sceneNum]||"",N=(I.title||"").replace(/^(Scene||Scne|Escena|Szene)\s*\d+[:\s-]*/i,"").trim(),A=b.has(I.sceneNum);return o.jsxs("div",{className:"mb-4",children:[o.jsxs("div",{className:"px-2 py-1 mb-1 text-xs font-bold text-gray-400 uppercase border-b border-gray-700 flex justify-between items-center group cursor-pointer hover:bg-gray-800/50 transition-colors rounded",onClick:()=>l(I.sceneNum),children:[o.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden flex-1 min-w-0",children:[o.jsx(Ie,{tooltipPosition:"right",title:C(E?"node.action.expandScene":"node.action.collapseScene"),onClick:k=>{k.stopPropagation(),l(I.sceneNum)},children:E?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),o.jsx("span",{className:"truncate",children:`${C("node.content.scene")} ${I.sceneNum}${N?`: ${N}`:""}`})]}),o.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-2",children:[o.jsxs("span",{className:"text-[9px] bg-gray-700 px-1.5 py-0.5 rounded text-gray-400 font-mono",children:[I.prompts.length," ",C("node.content.frame_plural")]}),o.jsx(Ie,{tooltipPosition:"left",title:C("node.action.deleteItem"),onClick:k=>{k.stopPropagation(),m(Number(I.sceneNum))},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),!E&&o.jsxs("div",{className:"pl-2 space-y-2",children:[o.jsxs("div",{className:"bg-gray-800/80 border border-emerald-500/30 rounded-md mb-2 shadow-inner overflow-hidden transition-all",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 cursor-pointer hover:bg-gray-700/30 transition-colors",onClick:k=>{k.stopPropagation(),T(I.sceneNum)},children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("div",{className:`text-emerald-500 transition-transform duration-200 ${A?"rotate-90":""}`,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),o.jsx("span",{className:"text-[10px] font-bold text-emerald-400 uppercase tracking-wider",children:"MASTER ENVIRONMENT PROMPT"})]}),o.jsx(Ie,{tooltipPosition:"left",title:C("node.action.copy"),onClick:k=>{k.stopPropagation(),y(R)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),A&&o.jsx("div",{className:"px-2 pb-2 pt-0",children:o.jsx("textarea",{value:R,onChange:k=>v(I.sceneNum,k.target.value),className:"w-full text-xs p-2 bg-gray-900 border border-gray-700 rounded resize-y min-h-[60px] focus:outline-none focus:ring-1 focus:ring-emerald-500 custom-scrollbar text-gray-300 placeholder-gray-600",placeholder:"Detailed master scene description (Furniture, Lighting, Textures)...",onFocus:w,onMouseDown:k=>k.stopPropagation()})})]}),I.prompts.map((k,P)=>{const M=k.final||k.video,H=`${M.sceneNumber}-${M.frameNumber}`,W=(M.characters||[]).map(L=>{const D=L.match(/(?:Entity|Character|)[-\s]?(\d+)/i);return D?`ENT-${D[1]}`:L}),O=W.length>0?W.join(", "):"",U=M.shotType?` [${M.shotType}]`:"",z=`Frame-${M.frameNumber}${U} ${O}`;return o.jsx(M5,{promptId:H,title:z,imagePrompt:k.final?k.final.prompt:"No Image Prompt Generated",videoPrompt:k.video?k.video.videoPrompt:"No Video Prompt Generated",isCollapsed:r.has(H),t:C,onToggleCollapse:c,onCopy:y,onDelete:()=>g(Number(I.sceneNum),M.frameNumber)},H)})]})]},I.sceneNum)}):o.jsx("div",{className:"text-center text-xs text-gray-500 p-4",children:C("node.content.promptsGeneratedPlaceholder")})]})},L5=({node:e,onValueChange:t,onModifyScriptPrompts:n,isModifyingScriptPrompts:r,onExecuteFullChain:a,isExecutingChain:i,onStopGeneration:s,isStopping:l,t:c,getUpstreamTextValue:d,connections:h,connectedInputs:g,onApplyAliases:m,addToast:_,saveDataToCatalog:y,deselectAllNodes:v,inputData:C})=>{const{language:w}=Ht(),{setConfirmInfo:b,viewTransform:f}=or(),T=r===e.id,[I,E]=x.useState(!1),[R,N]=x.useState(50),A=_t.useRef(null),[k,P]=x.useState(null),[M,H]=x.useState(""),[W,O]=x.useState(new Set),[U,z]=x.useState(new Set),[L,D]=x.useState(new Set),[G,q]=x.useState(new Set),[ie,te]=x.useState(new Set),[ye,ue]=x.useState({current:0,total:0,last:0}),[$,ee]=x.useState(null),[Te,le]=x.useState(360),J=g==null?void 0:g.has("style"),ge=!!h.find(se=>se.toNodeId===e.id&&(se.toHandleId==="all-script-analyzer-data"||!se.toHandleId)),ae=w==="en"?"ru":w,ce=x.useMemo(()=>{try{const se=JSON.parse(e.value||"{}");let Me=Array.isArray(se.disabledInstructionIds)?[...se.disabledInstructionIds]:[];Array.isArray(se.disabledInstructionIds)||(se.processWholeScene===!1&&Me.push(ne.PROCESS_WHOLE_SCENE.id),se.generateVideoPrompt===!1&&Me.push(ne.GENERATE_VIDEO_PROMPT.id),se.breakIntoParagraphs===!1&&Me.push(ne.BREAK_PARAGRAPHS.id),(!se.finalPrompts||se.finalPrompts.length===0)&&(Me.includes(ne.BREAK_PARAGRAPHS.id)||Me.push(ne.BREAK_PARAGRAPHS.id)),Me=[...new Set(Me)]);let Ae=se.charDescMode;return Ae||(se.includeFullCharDesc?Ae="full":se.includeGeneralCharDesc===!1?Ae="none":Ae="general"),{finalPrompts:Array.isArray(se.finalPrompts)?se.finalPrompts.sort((et,pt)=>et.frameNumber-pt.frameNumber):[],videoPrompts:Array.isArray(se.videoPrompts)?se.videoPrompts.sort((et,pt)=>et.frameNumber-pt.frameNumber):[],sceneContexts:se.sceneContexts||{},usedCharacters:Array.isArray(se.usedCharacters)?se.usedCharacters:[],targetLanguage:se.targetLanguage||w,startFrameNumber:se.startFrameNumber||null,endFrameNumber:se.endFrameNumber||null,startSceneNumber:se.startSceneNumber||null,endSceneNumber:se.endSceneNumber||null,generationProgress:se.generationProgress||null,styleOverride:se.styleOverride||"",characterPaneHeight:se.characterPaneHeight||160,model:se.model||"gemini-3-flash-preview",disabledInstructionIds:Me,charDescMode:Ae||"general",safeGeneration:!!se.safeGeneration,thinkingEnabled:!!se.thinkingEnabled,propEnhancementEnabled:se.propEnhancementEnabled!==!1,uiState:se.uiState||{isSettingsCollapsed:!0,isCharStyleCollapsed:!1},settingsPaneHeight:se.settingsPaneHeight||360}}catch{return{finalPrompts:[],videoPrompts:[],sceneContexts:{},usedCharacters:[],targetLanguage:w,startFrameNumber:null,endFrameNumber:null,startSceneNumber:null,endSceneNumber:null,generationProgress:null,styleOverride:"",characterPaneHeight:160,model:"gemini-3-flash-preview",disabledInstructionIds:[ne.BREAK_PARAGRAPHS.id,ne.ANTHRO_REINFORCEMENT.id,ne.SUBSCRIBE_REINFORCEMENT.id,ne.VISUAL_SATURATION.id],charDescMode:"general",safeGeneration:!1,thinkingEnabled:!1,propEnhancementEnabled:!0,uiState:{isSettingsCollapsed:!0,isCharStyleCollapsed:!1},settingsPaneHeight:360}}},[e.value,w]),{finalPrompts:B,videoPrompts:X,sceneContexts:F,usedCharacters:Y,targetLanguage:K,startFrameNumber:V,endFrameNumber:oe,startSceneNumber:de,endSceneNumber:Z,generationProgress:Q,styleOverride:j,characterPaneHeight:fe,model:Pe,disabledInstructionIds:je,charDescMode:ke,safeGeneration:$e,thinkingEnabled:ze,propEnhancementEnabled:nt,uiState:at,settingsPaneHeight:xe}=ce;x.useEffect(()=>{let se;return Q?Q.endTime?ue({current:0,total:Math.floor((Q.endTime-Q.totalStartTime)/1e3),last:Q.lastItemDuration||0}):T&&(se=window.setInterval(()=>{const Me=Date.now();ue({current:Math.floor((Me-(Q.currentItemStartTime||Me))/1e3),total:Math.floor((Me-(Q.totalStartTime||Me))/1e3),last:Q.lastItemDuration||0})},100)):ue({current:0,total:0,last:0}),()=>clearInterval(se)},[T,Q]),x.useEffect(()=>{Math.abs((xe||360)-Te)>1&&le(xe||360)},[xe]);const he=!je.includes(ne.PROCESS_WHOLE_SCENE.id),Ge=!je.includes(ne.VISUAL_SATURATION.id),me=x.useCallback(se=>{const Me={...ce,...se};t(e.id,JSON.stringify(Me))},[e.id,t,ce]),Oe=x.useCallback(se=>{me({uiState:{...at,...se}})},[me,at]),De=x.useCallback(se=>{navigator.clipboard.writeText(se),_(c("toast.copied"),"success")},[_,c]),Ce=x.useCallback((se,Me)=>{const Ae=B.filter(pt=>!(pt.sceneNumber===se&&pt.frameNumber===Me)),et=X.filter(pt=>!(pt.sceneNumber===se&&pt.frameNumber===Me));me({finalPrompts:Ae,videoPrompts:et})},[B,X,me]),Qe=x.useCallback(se=>{const Me=B.filter(et=>et.sceneNumber!==se),Ae=X.filter(et=>et.sceneNumber!==se);me({finalPrompts:Me,videoPrompts:Ae})},[B,X,me]),pe=x.useCallback(async()=>{E(!0),await new Promise(Ae=>setTimeout(Ae,50));let se=null,Me="";try{if(!d||!h)return P(null),H(""),{analyzerData:null,styleVal:""};const Ae=h.find(pt=>pt.toNodeId===e.id&&(pt.toHandleId==="all-script-analyzer-data"||!pt.toHandleId));if(Ae){const pt=d(Ae.fromNodeId,Ae.fromHandleId);if(pt)try{const Lt=JSON.parse(pt),Zt=[...Array.isArray(Lt.detailedCharacters)?Lt.detailedCharacters:Array.isArray(Lt.characters)?Lt.characters:[]].sort((On,xn)=>{const Cn=Ir=>{const rr=(Ir||"").match(/(\d+)/);return rr?parseInt(rr[1],10):99999},xo=On.index||On.alias||"",vo=xn.index||xn.alias||"";return Cn(xo)-Cn(vo)});se={scenes:Array.isArray(Lt.scenes)?Lt.scenes:[],characters:Zt,visualStyle:Lt.visualStyle||Lt.generatedStyle||"",generatedStyle:Lt.generatedStyle,detailedCharacters:Lt.detailedCharacters}}catch{}}if(P(se),se!=null&&se.scenes){const pt=new Set,Lt=new Set,sn=new Set,Zt={...F};let On=!1;se.scenes.forEach((xn,Cn)=>{const xo=xn.sceneNumber||Cn+1;Lt.add(Cn),sn.add(Cn),(xn.frames||[]).forEach(vo=>pt.add(`${Cn}-${vo.frameNumber}`)),xn.sceneContext&&Zt[xo]!==xn.sceneContext&&(Zt[xo]=xn.sceneContext,On=!0)}),z(pt),q(Lt),te(sn),On&&me({sceneContexts:Zt})}const et=h.find(pt=>pt.toNodeId===e.id&&pt.toHandleId==="style");et&&(Me=d(et.fromNodeId,et.fromHandleId)),H(Me)}finally{E(!1)}return{analyzerData:se,styleVal:Me}},[h,d,e.id,F,me]);x.useEffect(()=>{pe()},[h,e.id,pe,C]),x.useEffect(()=>{const se=k==null?void 0:k.generatedStyle;se&&se!=="none"&&se.trim()!==""&&!j&&!J&&me({styleOverride:se})},[k,j,J,me]),x.useEffect(()=>{if(k!=null&&k.characters){const se=k.characters.map(Me=>({name:Me.name,index:Me.index||Me.alias}));JSON.stringify(se)!==JSON.stringify(Y)&&me({usedCharacters:se})}else ge||Y.length>0&&me({usedCharacters:[]})},[k,Y,me,ge]);const Se=x.useRef(r);x.useEffect(()=>{if(Se.current&&!r){const se=new Set;B.forEach(Me=>se.add(`${Me.sceneNumber}-${Me.frameNumber}`)),X.forEach(Me=>se.add(`${Me.sceneNumber}-${Me.frameNumber}`)),O(se)}Se.current=r},[r,B,X]);const Ee=async()=>{await pe(),n(e.id)},Fe=()=>{a&&b({title:c("dialog.executeChain.title"),message:c("dialog.executeChain.message"),onConfirm:()=>a(e.id)})},be=se=>{se.preventDefault();const Me=se.clientX,Ae=R,et=se.target.parentElement;if(!et)return;const pt=et.offsetWidth,Lt=f.scale,sn=On=>{const xn=(On.clientX-Me)/Lt,Cn=Ae+xn/pt*100;N(Math.max(20,Math.min(80,Cn)))},Zt=()=>{window.removeEventListener("mousemove",sn),window.removeEventListener("mouseup",Zt)};window.addEventListener("mousemove",sn),window.addEventListener("mouseup",Zt)},_e=x.useMemo(()=>{const se={},Me={};return k!=null&&k.scenes&&k.scenes.forEach(Ae=>{const et=Ae.sceneNumber.toString();se[et]=[],Me[et]=Ae.title||`Scene ${Ae.sceneNumber}`}),B.forEach(Ae=>{const et=Ae.sceneNumber!==void 0?Ae.sceneNumber:0,pt=et.toString();se[pt]||(se[pt]=[]),Ae.sceneTitle&&(Me[pt]=Ae.sceneTitle);const Lt=X.find(sn=>sn.frameNumber===Ae.frameNumber&&sn.sceneNumber===et);se[pt].push({final:Ae,video:Lt})}),Object.entries(se).sort((Ae,et)=>Number(Ae[0])-Number(et[0])).map(([Ae,et])=>({sceneNum:Ae,title:Me[Ae],prompts:et}))},[B,X,k]),Ue=se=>{D(Me=>{const Ae=new Set(Me);return Ae.has(se)?Ae.delete(se):Ae.add(se),Ae})},We=se=>{q(Me=>{const Ae=new Set(Me);return Ae.has(se)?Ae.delete(se):Ae.add(se),Ae})},gt=se=>{z(Me=>{const Ae=new Set(Me);return Ae.has(se)?Ae.delete(se):Ae.add(se),Ae})},Et=se=>{te(Me=>{const Ae=new Set(Me);return Ae.has(se)?Ae.delete(se):Ae.add(se),Ae})},It=se=>{O(Me=>{const Ae=new Set(Me);return Ae.has(se)?Ae.delete(se):Ae.add(se),Ae})},Mt=x.useMemo(()=>!(k!=null&&k.scenes)||k.scenes.length===0?!1:k.scenes.every((se,Me)=>G.has(Me)),[k,G]),xt=x.useCallback(()=>{if(k!=null&&k.scenes)if(Mt)q(new Set),z(new Set),te(new Set);else{const se=new Set,Me=new Set;k.scenes.forEach((Ae,et)=>{se.add(et),(Ae.frames||[]).forEach(pt=>Me.add(`${et}-${pt.frameNumber}`))}),q(se),z(Me),te(se)}},[k,Mt]),Ft=x.useMemo(()=>_e.length===0?!1:_e.every(se=>L.has(se.sceneNum)),[_e,L]),cn=x.useCallback(()=>{if(_e.length!==0)if(Ft)D(new Set),O(new Set);else{const se=new Set,Me=new Set;_e.forEach(Ae=>{se.add(Ae.sceneNum),Ae.prompts.forEach(et=>{const pt=et.final||et.video;Me.add(`${pt.sceneNumber}-${pt.frameNumber}`)})}),D(se),O(Me)}},[_e,Ft]),Bt=x.useMemo(()=>{if(!(k!=null&&k.scenes))return!1;const se=[];return k.scenes.forEach((Me,Ae)=>{(Me.frames||[]).forEach(et=>se.push(`${Ae}-${et.frameNumber}`))}),se.length===0?!1:se.every(Me=>U.has(Me))},[k,U]),en=x.useCallback(()=>{if(!(k!=null&&k.scenes))return;const se=new Set,Me=new Set;k.scenes.forEach((Ae,et)=>{Me.add(et),(Ae.frames||[]).forEach(pt=>se.add(`${et}-${pt.frameNumber}`))}),Bt?(z(new Set),te(new Set)):(z(se),te(Me))},[k,Bt]),ve=x.useMemo(()=>{if(_e.length===0)return!1;const se=[];return _e.forEach(Me=>{Me.prompts.forEach(Ae=>{const et=Ae.final||Ae.video;se.push(`${et.sceneNumber}-${et.frameNumber}`)})}),se.length===0?!1:se.every(Me=>W.has(Me))},[_e,W]),Be=x.useCallback(()=>{if(_e.length===0)return;const se=new Set;_e.forEach(Me=>{Me.prompts.forEach(Ae=>{const et=Ae.final||Ae.video;se.add(`${et.sceneNumber}-${et.frameNumber}`)})}),O(ve?new Set:se)},[_e,ve]),Je=()=>{const se=(k==null?void 0:k.generatedStyle)||(k==null?void 0:k.visualStyle)||"",Ae={type:"script-prompt-modifier-data",finalPrompts:B,videoPrompts:X,sceneContexts:F,usedCharacters:Y,visualStyle:j||se||"",title:e.title},et=JSON.stringify(Ae,null,2),pt=new Blob([et],{type:"application/json"}),Lt=URL.createObjectURL(pt),sn=document.createElement("a"),Zt=new Date,xn=`final_prompts_${`${Zt.getFullYear()}-${String(Zt.getMonth()+1).padStart(2,"0")}-${String(Zt.getDate()).padStart(2,"0")}_${String(Zt.getHours()).padStart(2,"0")}-${String(Zt.getMinutes()).padStart(2,"0")}`}.json`;sn.href=Lt,sn.download=xn,sn.click(),URL.revokeObjectURL(Lt),_(c("toast.savedToCatalog"),"success")},it=se=>{me(he?{startSceneNumber:se}:{startFrameNumber:se})},ct=se=>{me(he?{endSceneNumber:se}:{endFrameNumber:se})},jt=()=>me({startSceneNumber:null,endSceneNumber:null,startFrameNumber:null,endFrameNumber:null}),Nn=()=>{const Me=Math.ceil(((he?de:V)||1)/5)*5+1,Ae=Me+4;me(he?{startSceneNumber:Me,endSceneNumber:Ae}:{startFrameNumber:Me,endFrameNumber:Ae})},Kt=()=>{const Me=Math.max(1,Math.floor((((he?de:V)||1)-1)/5)*5-4),Ae=Me+4;me(he?{startSceneNumber:Me,endSceneNumber:Ae}:{startFrameNumber:Me,endFrameNumber:Ae})},re=se=>{const Me=ne.PROCESS_WHOLE_SCENE.id;let Ae;se?Ae=je.filter(et=>et!==Me):Ae=[...je,Me],me({disabledInstructionIds:Ae})},Le=se=>{const Me=ne.VISUAL_SATURATION.id;let Ae;se?Ae=je.filter(et=>et!==Me):Ae=[...je,Me],me({disabledInstructionIds:Ae})},Re=()=>{t(e.id,JSON.stringify({...ce,propEnhancementEnabled:!nt}))},Ke=(se,Me)=>{const Ae={...F,[se]:Me};me({sceneContexts:Ae})},dt=x.useMemo(()=>k!=null&&k.scenes?k.scenes.reduce((se,Me)=>{var Ae;return se+(((Ae=Me.frames)==null?void 0:Ae.length)||0)},0):0,[k]),rt=x.useMemo(()=>{const se=he?de:V,Me=he?Z:oe,Ae=c(he?"node.content.scenes":"node.content.frame");return se||Me?`${Ae}: ${se||1}-${Me||"End"}`:""},[he,de,Z,V,oe,c]);x.useMemo(()=>{const se={},{characters:Me=[]}=k||{};return Me.forEach(Ae=>{const et=Ae.imagePrompt||Ae.prompt||Ae.fullDescription||"";Ae.alias&&(se[Ae.alias]=`${Ae.name} [Visual Profile: ${et}]`),Ae.name&&(se[Ae.name]=`${Ae.name} [Visual Profile: ${et}]`)}),se},[k]);const St=(k==null?void 0:k.characters)||Y,Pt=(k==null?void 0:k.visualStyle)||(k==null?void 0:k.generatedStyle)||"",Gt=({id:se})=>o.jsx("button",{onClick:Me=>{Me.stopPropagation(),ee(se)},className:"ml-auto p-0.5 text-gray-500 hover:text-emerald-400 opacity-50 hover:opacity-100 transition-all focus:outline-none",title:"Locate in Stack",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})});return o.jsxs("div",{ref:A,className:"flex flex-col h-full",children:[o.jsxs("div",{className:"flex flex-col gap-2 mb-2 flex-shrink-0",children:[o.jsxs("div",{className:"flex gap-2 items-center",children:[o.jsxs("div",{className:"flex w-40 flex-shrink-0 gap-1 select-none bg-gray-900/50 rounded-lg p-0.5 h-10",children:[o.jsx(lt,{title:c("tooltip.model.flash"),position:"top",className:"h-full flex-1",children:o.jsxs("button",{onClick:()=>me({model:"gemini-3-flash-preview"}),className:`w-full h-full text-xs font-bold text-center transition-colors rounded-md flex items-center justify-center ${Pe==="gemini-3-flash-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 mr-1",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})}),"Flash"]})}),o.jsx(lt,{title:c("tooltip.model.pro"),position:"top",className:"h-full flex-1",children:o.jsxs("button",{onClick:()=>me({model:"gemini-3-pro-preview"}),className:`w-full h-full text-xs font-bold text-center transition-colors rounded-md flex items-center justify-center ${Pe==="gemini-3-pro-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})}),"Pro"]})})]}),o.jsxs("div",{className:"flex flex-shrink-0 gap-1 h-10 select-none bg-gray-900/50 rounded-lg p-0.5",children:[o.jsx(lt,{title:c("tooltip.lang.ru"),position:"top",className:"h-full flex",children:o.jsx("button",{onClick:()=>me({targetLanguage:ae}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all ${K===ae?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:ae.toUpperCase()})}),o.jsx(lt,{title:c("tooltip.lang.en"),position:"top",className:"h-full flex",children:o.jsx("button",{onClick:()=>me({targetLanguage:"en"}),className:`px-3 h-full rounded-md text-[10px] font-bold uppercase tracking-wider transition-all ${K==="en"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:"EN"})})]}),o.jsxs("button",{onClick:T?s:Ee,disabled:l||i,className:`flex-grow h-10 px-4 font-bold text-xs uppercase tracking-wide text-white rounded-lg transition-all duration-200 shadow-sm flex items-center justify-center ${l?"bg-yellow-600 hover:bg-yellow-500":T?"bg-cyan-600 hover:bg-cyan-500":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500"}`,children:[!T&&!l&&o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),T&&o.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),c(l?"node.action.stopping":T?"node.content.analyzing":"node.content.generateFinalPrompts")]}),a&&o.jsx("button",{onClick:i?s:Fe,disabled:T||l,className:`flex-shrink-0 w-10 h-10 p-2 font-bold text-white rounded-md transition-colors duration-200 flex items-center justify-center ${l&&i?"bg-yellow-600":i?"bg-red-600 hover:bg-red-700":"bg-cyan-600 hover:bg-cyan-700 disabled:bg-gray-500"}`,title:c("node.action.executeChainTitle"),children:l&&i?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 animate-pulse",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("rect",{x:"6",y:"6",width:"8",height:"8"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})})})]}),o.jsxs("div",{className:"bg-gray-900/50 rounded-md flex-shrink-0 flex flex-col",children:[o.jsxs("div",{className:"p-2 border-b border-gray-800 flex items-center justify-start gap-4",children:[o.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-400",children:[o.jsx("label",{htmlFor:`start-range-${e.id}`,className:"whitespace-nowrap",children:c(he?"node.content.processFromScene":"node.content.processFromFrame")}),o.jsxs("div",{className:"relative w-14 h-7",children:[o.jsx("input",{id:`start-range-${e.id}`,type:"number",min:"1",placeholder:"1",value:(he?de:V)||"",onChange:se=>it(se.target.value?parseInt(se.target.value,10):0),className:"w-full h-full pl-2 pr-4 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 focus:outline-none appearance-none text-xs",onMouseDown:se=>se.stopPropagation()}),o.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-4 flex flex-col border-l border-gray-700",children:[o.jsx("button",{onClick:()=>it(((he?de:V)||0)+1),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-tr-md focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z",clipRule:"evenodd"})})}),o.jsx("button",{onClick:()=>it(Math.max(1,((he?de:V)||0)-1)),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-br-md border-t border-gray-700 focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]}),o.jsx("label",{htmlFor:`end-range-${e.id}`,className:"whitespace-nowrap",children:c(he?"node.content.analyzeUpToScene":"node.content.generateUpToFrame")}),o.jsxs("div",{className:"relative w-16 h-7",children:[o.jsx("input",{id:`end-range-${e.id}`,type:"number",min:"1",placeholder:c("node.content.endPlaceholder"),value:(he?Z:oe)||"",onChange:se=>ct(se.target.value?parseInt(se.target.value,10):0),className:"w-full h-full pl-2 pr-4 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 focus:outline-none appearance-none text-xs",onMouseDown:se=>se.stopPropagation()}),o.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-4 flex flex-col border-l border-gray-700",children:[o.jsx("button",{onClick:()=>ct(((he?Z:oe)||0)+1),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-tr-md focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z",clipRule:"evenodd"})})}),o.jsx("button",{onClick:()=>ct(Math.max(1,((he?Z:oe)||0)-1)),className:"h-1/2 hover:bg-gray-700 text-gray-500 hover:text-white flex items-center justify-center rounded-br-md border-t border-gray-700 focus:outline-none",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-2 w-2",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]})]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx("button",{onClick:Kt,className:"p-1 text-gray-400 hover:text-white bg-gray-800 rounded hover:bg-gray-700",title:"-5",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),o.jsx("button",{onClick:Nn,className:"p-1 text-gray-400 hover:text-white bg-gray-800 rounded hover:bg-gray-700",title:"+5",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})}),o.jsx("button",{onClick:jt,className:"p-1 text-gray-400 hover:text-red-400 bg-gray-800 rounded hover:bg-gray-700 ml-1",title:"Clear Range",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]}),o.jsxs("div",{className:"px-2 pb-2 flex items-center gap-4 border-b border-gray-800",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ft,{id:`process-whole-scene-${e.id}`,checked:he,onChange:re,disabled:T,className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:`process-whole-scene-${e.id}`,className:"text-xs text-gray-400 cursor-pointer select-none font-medium hover:text-emerald-400 transition-colors",title:c("node.content.processWholeSceneInfo"),children:c("node.content.processWholeScene")}),o.jsx(Gt,{id:ne.PROCESS_WHOLE_SCENE.id})]}),o.jsxs("div",{className:"flex items-center ml-2 border-l border-gray-700 pl-2 gap-2",children:[o.jsx(ft,{id:`generate-style-${e.id}`,checked:!je.includes(ne.VISUAL_SATURATION.id),onChange:Le,disabled:T,className:"h-3.5 w-3.5"}),o.jsx("label",{htmlFor:`generate-style-${e.id}`,className:"text-xs text-gray-400 cursor-pointer select-none font-medium hover:text-emerald-400 transition-colors",children:c("node.content.generateStyle")}),o.jsx(Gt,{id:ne.VISUAL_SATURATION.id})]})]}),o.jsxs("div",{className:"p-2 flex items-center justify-between text-xs",children:[o.jsx("div",{className:"font-semibold text-emerald-400",children:c("node.content.status.total",{generated:B.length,total:dt})}),o.jsxs("div",{className:"flex items-center gap-4 text-gray-400",children:[rt&&o.jsx("div",{className:"text-gray-500 font-medium",children:rt}),Q&&o.jsxs(o.Fragment,{children:[T?o.jsx("div",{className:"text-yellow-400 animate-pulse font-mono",children:c("node.content.status.batch",{current:Q.current,total:Q.total})}):null,o.jsxs("div",{className:"text-gray-400 font-mono text-[10px]",children:[" (): (: ",ye.last,") / : ",ye.current," / : ",ye.total]})]})]})]}),T&&Q&&o.jsx("div",{className:"w-full h-1 bg-gray-800 rounded-b-md overflow-hidden border-t border-gray-800",children:o.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-300 ease-out",style:{width:`${Q.current/Math.max(1,Q.total)*100}%`}})})]}),o.jsx(A5,{nodeId:e.id,uiState:at,localSettingsHeight:Te,setLocalSettingsHeight:le,onUpdateUiState:Oe,onUpdateValue:me,disabledInstructionIds:je,t:c,targetLanguage:K,scale:f.scale,maxHeight:e.height-256,charDescMode:ke,safeGeneration:$e,thinkingEnabled:ze,model:Pe,targetScrollId:$,onSetTargetScrollId:ee,isProcessWholeScene:he,onToggleProcessWholeScene:re,isSaturationEnabled:Ge,onToggleSaturation:Le,propEnhancementEnabled:nt,onTogglePropEnhancement:Re})]}),o.jsx(I5,{uiState:at,onUpdateUiState:Oe,onUpdateValue:me,upstreamAnalyzerData:k,isStyleConnected:!!J,isDataConnected:ge,upstreamStyleValue:J?M:Pt,styleOverride:j,deselectAllNodes:v,t:c,characters:St,onRefresh:pe}),o.jsxs("div",{className:"flex-grow flex flex-row min-h-0 items-stretch bg-gray-900 rounded-b-md overflow-hidden border-t border-gray-600",children:[o.jsx(R5,{verticalDividerPos:R,isProcessWholeScene:he,upstreamAnalyzerData:k,collapsedInputScenes:G,collapsedInputFrames:U,collapsedInputContexts:ie,onToggleInputSceneCollapse:We,onToggleInputFrameCollapse:gt,onToggleInputContextCollapse:Et,onToggleAllInputScenes:xt,onToggleAllInputFrames:en,areAllInputScenesCollapsed:Mt,areAllInputFramesCollapsed:Bt,t:c}),o.jsx("div",{onMouseDown:be,className:"w-2 mx-1 cursor-col-resize bg-gray-600 hover:bg-emerald-500 transition-colors flex-shrink-0 rounded-full"}),o.jsx(j5,{verticalDividerPos:R,groupedPrompts:_e,collapsedOutputScenes:L,collapsedPrompts:W,areAllOutputScenesCollapsed:Ft,areAllOutputPromptsCollapsed:ve,sceneContexts:F,onToggleOutputSceneCollapse:Ue,onTogglePromptCollapse:It,onToggleAllOutputScenes:cn,onToggleAllOutputPrompts:Be,onDeletePrompt:Ce,onDeleteScenePrompts:Qe,onDownloadJson:Je,onCopy:De,onUpdateSceneContext:Ke,t:c,deselectAllNodes:v})]})]})},D5=({libraryItems:e,onPromptInsert:t})=>{const{t:n}=Ht(),[r,a]=x.useState(!1),[i,s]=x.useState(!1),[l,c]=x.useState(!1),[d,h]=x.useState(null),g=x.useRef(null),m=x.useMemo(()=>d?e.find(C=>C.id===d):null,[d,e]),_=x.useMemo(()=>e.filter(C=>C.parentId===d).sort((C,w)=>C.type===w.type?C.name.localeCompare(w.name):C.type===$t.FOLDER?-1:1),[e,d]);x.useEffect(()=>{if(r)s(!0),requestAnimationFrame(()=>c(!0));else{c(!1);const C=setTimeout(()=>s(!1),200);return()=>clearTimeout(C)}},[r]),x.useEffect(()=>{if(!r)return;const C=w=>{g.current&&!g.current.contains(w.target)&&(a(!1),h(null))};return document.addEventListener("mousedown",C),()=>document.removeEventListener("mousedown",C)},[r]);const y=C=>{C.type===$t.FOLDER?h(C.id):(t(C.content||""),a(!1),h(null))},v=()=>{h(m?m.parentId:null)};return o.jsxs("div",{ref:g,className:"relative mb-1 flex-shrink-0",children:[o.jsxs("button",{onClick:()=>a(!r),className:`flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-semibold transition-colors w-full bg-gray-800 hover:bg-gray-700 text-gray-300 hover:text-white border border-gray-700 ${r?"ring-1 ring-emerald-500 border-emerald-500":""}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-emerald-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),o.jsx("span",{children:n("catalog.tabs.library")}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ml-auto transition-transform ${r?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),i&&o.jsxs("div",{className:`absolute top-full left-0 right-0 mt-1 max-h-64 overflow-y-auto bg-gray-800 rounded-md shadow-xl z-50 border border-gray-600 flex flex-col transition-[opacity,transform] duration-200 ease-out origin-top ${l?"opacity-100 scale-100":"opacity-0 scale-95"}`,onWheel:C=>C.stopPropagation(),children:[d?o.jsxs("button",{onClick:v,className:"flex items-center px-3 py-2 text-sm font-bold text-gray-300 hover:text-white hover:bg-gray-700 border-b border-gray-700/50 sticky top-0 bg-gray-800 z-10",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),(m==null?void 0:m.name)||"Back"]}):o.jsx("div",{className:"px-3 py-2 text-xs font-bold text-gray-500 uppercase border-b border-gray-700/50 sticky top-0 bg-gray-800 z-10 cursor-default",children:n("catalog.tabs.library")}),o.jsx("div",{className:"p-1",children:_.length>0?_.map(C=>o.jsxs("button",{onClick:()=>y(C),className:"w-full text-left px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white rounded-md flex items-center group",title:C.content,children:[C.type===$t.FOLDER?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-emerald-500 group-hover:text-emerald-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-emerald-500 group-hover:text-emerald-400 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),o.jsx("span",{className:"truncate",children:C.name}),C.type===$t.FOLDER&&o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-auto text-gray-500 group-hover:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})]},C.id)):o.jsx("div",{className:"text-center text-xs text-gray-500 py-4 italic",children:n("library.empty.title")})})]})]})},O5=({node:e,onValueChange:t,libraryItems:n,t:r,deselectAllNodes:a})=>o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsx(D5,{libraryItems:n,onPromptInsert:i=>{const s=e.value?`${e.value}, ${i}`:i;t(e.id,s)}}),o.jsx("textarea",{value:e.value,onChange:i=>t(e.id,i.target.value),placeholder:r("node.content.textInputPlaceholder"),className:"w-full flex-grow p-2 bg-gray-700 border border-transparent rounded-md resize-none focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar overflow-y-scroll",onWheel:i=>i.stopPropagation(),onMouseDown:i=>i.stopPropagation(),onFocus:a})]}),F5=({node:e,onValueChange:t,onTranslate:n,isTranslating:r,isStopping:a,onStopGeneration:i,connectedInputs:s,t:l,deselectAllNodes:c})=>{const d=r===e.id,h=x.useMemo(()=>{try{const C=JSON.parse(e.value||"{}");return{inputText:C.inputText||"",targetLanguage:C.targetLanguage||"ru",translatedText:C.translatedText||""}}catch{return{inputText:"",targetLanguage:"ru",translatedText:""}}},[e.value]),{inputText:g,targetLanguage:m,translatedText:_}=h,y=s==null?void 0:s.has(void 0),v=C=>{const w={...h,...C};delete w.inputHeight,t(e.id,JSON.stringify(w))};return o.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[o.jsxs("div",{className:"flex-shrink-0 flex items-end space-x-2",children:[o.jsxs("div",{className:"flex-grow",children:[o.jsx("label",{htmlFor:`lang-select-${e.id}`,className:"block text-xs font-medium text-gray-400 mb-1",children:l("node.content.targetLanguage")}),o.jsx("select",{id:`lang-select-${e.id}`,value:m,onChange:C=>v({targetLanguage:C.target.value}),onMouseDown:C=>C.stopPropagation(),disabled:d,className:"w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:ring-2 focus:ring-emerald-500 focus:outline-none disabled:opacity-50 h-10",children:zl.map(C=>o.jsx("option",{value:C.code,children:C.name},C.code))})]}),o.jsx("button",{onClick:d?i:()=>n(e.id),disabled:a||!d&&!y&&!g.trim(),className:`px-4 py-2 h-10 font-bold text-white rounded-md transition-colors duration-200 flex-shrink-0 ${a?"bg-yellow-600":d?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed"}`,children:l(a?"node.action.stopping":d?"node.action.stop":"node.content.translate")})]}),o.jsx("textarea",{value:g,onChange:C=>v({inputText:C.target.value}),placeholder:l(y?"node.content.connectedPlaceholder":"node.content.translatePlaceholder"),className:"w-full flex-1 p-2 bg-gray-700 border border-transparent rounded-md resize-none focus:border-emerald-500 focus:ring-0 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 min-h-[60px] custom-scrollbar overflow-y-scroll",onWheel:C=>C.stopPropagation(),onMouseDown:C=>C.stopPropagation(),disabled:y||d,onFocus:c}),o.jsx("textarea",{readOnly:!0,value:_,placeholder:l("node.content.translatedTextPlaceholder"),className:"w-full flex-1 p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none custom-scrollbar overflow-y-scroll min-h-[60px]",onWheel:C=>C.stopPropagation(),onMouseDown:C=>C.stopPropagation(),onFocus:c})]})},z5=({node:e,onReadData:t,isReadingData:n,isStopping:r,onStopGeneration:a,t:i,deselectAllNodes:s})=>{const l=n===e.id;return o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsx("textarea",{readOnly:!0,value:e.value,placeholder:i("node.content.dataPlaceholder"),className:"w-full flex-grow p-2 bg-gray-700 border-none rounded-md resize-none focus:outline-none custom-scrollbar overflow-y-scroll",onWheel:c=>c.stopPropagation(),onMouseDown:c=>c.stopPropagation(),onFocus:s}),o.jsx("button",{onClick:l?a:()=>t(e.id),disabled:r,title:i("node.action.readData"),className:`w-full mt-2 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 ${r?"bg-yellow-600":l?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500"}`,children:i(r?"node.action.stopping":l?"node.content.reading":"node.content.readData")})]})};function Zu(e){const t=atob(e),n=t.length,r=new Uint8Array(n);for(let a=0;a<n;a++)r[a]=t.charCodeAt(a);return r}async function Fy(e,t,n,r){const a=new Int16Array(e.buffer),i=a.length/r,s=t.createBuffer(r,i,n);for(let l=0;l<r;l++){const c=s.getChannelData(l);for(let d=0;d<i;d++)c[d]=a[d*r+l]/32768}return s}const Rc=(e,t,n,r,a)=>{if(!e)return;const i=(v,C,w)=>{for(let b=0;b<w.length;b++)v.setUint8(C+b,w.charCodeAt(b))},s=Zu(e),l=new ArrayBuffer(44+s.length),c=new DataView(l);i(c,0,"RIFF"),c.setUint32(4,36+s.length,!0),i(c,8,"WAVE"),i(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,1,!0),c.setUint32(24,24e3,!0),c.setUint32(28,24e3*2,!0),c.setUint16(32,2,!0),c.setUint16(34,16,!0),i(c,36,"data"),c.setUint32(40,s.length,!0),new Uint8Array(l,44).set(s);let d;const h=String(t);h.startsWith("scene-")?d=`scene_${h.split("-")[1]}`:h.startsWith("simple-")?d=`generated_audio_${h.split("-")[1]}`:d=a.replace(/[^a-z0-9]/gi,"_").toLowerCase();const g=`${d}_${n}_${r}`,m=new Blob([c],{type:"audio/wav"}),_=URL.createObjectURL(m),y=document.createElement("a");y.href=_,y.download=`${g}.wav`,y.click(),URL.revokeObjectURL(_)},G5=({id:e,title:t,text:n,audioData:r,voiceName:a,intonation:i,isSelected:s,onSelect:l,onDownload:c,onPlayRequest:d,t:h})=>{var T;const[g,m]=x.useState(!1),_=x.useRef(null),y=x.useRef(null),C=((T=x.useMemo(()=>[{value:"standard",label:h("intonation.standard")},{value:"cheerful",label:h("intonation.cheerful")},{value:"angry",label:h("intonation.angry")},{value:"sad",label:h("intonation.sad")},{value:"excited",label:h("intonation.excited")},{value:"announcer",label:h("intonation.announcer")},{value:"whispering",label:h("intonation.whispering")}],[h]).find(I=>I.value===i))==null?void 0:T.label)||i,w=x.useCallback(()=>{y.current&&(y.current.onended=null,y.current.stop(),y.current.disconnect(),y.current=null),m(!1)},[]),b=x.useCallback(async()=>{if(!r)return;d(w),(!_.current||_.current.state==="closed")&&(_.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3}));const I=_.current;try{const E=Zu(r),R=await Fy(E,I,24e3,1),N=I.createBufferSource();N.buffer=R,N.connect(I.destination),N.onended=()=>{y.current===N&&(m(!1),y.current=null)},N.start(),y.current=N,m(!0)}catch(E){console.error("Error playing audio:",E),m(!1)}},[r,d,w]),f=x.useCallback(()=>{g?w():b()},[g,w,b]);return x.useEffect(()=>()=>{w(),_.current&&_.current.state!=="closed"&&_.current.close()},[w]),o.jsxs("div",{className:"bg-gray-700/50 p-2 rounded-lg space-y-2 flex items-center space-x-2",children:[o.jsx("input",{type:"checkbox",checked:s,onChange:()=>l(e),onClick:I=>I.stopPropagation(),className:"h-4 w-4 text-emerald-600 bg-gray-800 border-gray-600 rounded focus:ring-emerald-500"}),o.jsxs("div",{className:"flex-grow min-w-0",children:[o.jsxs("p",{className:"font-semibold text-sm text-gray-200 truncate",title:t,children:[t," - ",o.jsx("span",{className:"text-emerald-400",children:a})," / ",o.jsx("span",{className:"text-cyan-400",children:C})]}),o.jsx("p",{className:"text-xs text-gray-400 line-clamp-2",title:n,children:n})]}),o.jsxs("div",{className:"flex items-center justify-center space-x-2 flex-shrink-0",children:[o.jsx("button",{onClick:f,className:"p-2 rounded-full bg-emerald-600 text-white hover:bg-emerald-700 transition-colors","aria-label":g?"Stop":"Play",children:g?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})}),o.jsx("button",{onClick:()=>c(e),className:"p-2 rounded-full bg-cyan-600 text-white hover:bg-cyan-700 transition-colors","aria-label":"Download",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]})]})},U5=({node:e,onValueChange:t,onGenerateSpeech:n,isGeneratingSpeech:r,isStopping:a,onStopGeneration:i,t:s,onReadData:l,isReadingData:c,connectedInputs:d,addToast:h,inputData:g})=>{const m=r===e.id,_=c===e.id,[y,v]=x.useState(!1),C=x.useRef(null),w=x.useRef(null),b=x.useRef(new Map),[f,T]=x.useState(new Set),[I,E]=x.useState(new Set),R=d==null?void 0:d.has(void 0),N=x.useRef(null),A=x.useMemo(()=>{try{const V=JSON.parse(e.value||"{}");return{inputText:V.inputText||"",voice:V.voice||"Zephyr",audioFiles:Array.isArray(V.audioFiles)?V.audioFiles:[],startSceneNumber:V.startSceneNumber||null,endSceneNumber:V.endSceneNumber||null,isAutoDownloadEnabled:V.isAutoDownloadEnabled||!1,intonation:V.intonation||"standard",mode:V.mode||"simple",isMultiSpeaker:V.isMultiSpeaker||!1,speaker1Name:V.speaker1Name||"Man",speaker1Voice:V.speaker1Voice||"Zephyr",speaker2Name:V.speaker2Name||"Woman",speaker2Voice:V.speaker2Voice||"Kore"}}catch{return{inputText:"",voice:"Zephyr",audioFiles:[],startSceneNumber:null,endSceneNumber:null,isAutoDownloadEnabled:!1,intonation:"standard",mode:"simple",isMultiSpeaker:!1,speaker1Name:"Man",speaker1Voice:"Zephyr",speaker2Name:"Woman",speaker2Voice:"Kore"}}},[e.value]),{inputText:k,voice:P,audioFiles:M,startSceneNumber:H,endSceneNumber:W,isAutoDownloadEnabled:O,intonation:U,mode:z,isMultiSpeaker:L,speaker1Name:D,speaker1Voice:G,speaker2Name:q,speaker2Voice:ie}=A,te=V=>{const oe={...A,...V};t(e.id,JSON.stringify(oe))};x.useEffect(()=>{R&&g&&l(e.id)},[g,R,l,e.id]);const ye=x.useCallback(V=>{N.current&&N.current!==V&&N.current(),N.current=V},[]),ue=x.useCallback(()=>{w.current&&(w.current.onended=null,w.current.stop(),w.current.disconnect(),w.current=null),v(!1)},[]);x.useEffect(()=>(C.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3}),()=>{ue(),C.current&&C.current.state!=="closed"&&C.current.close().catch(console.error)}),[ue]);const $=x.useCallback(async V=>{if(y){ue();return}v(!0);try{const oe=s("node.content.voicePreviewText");let de=b.current.get(`${V}-${U}`);if(de||(de=await Vd(oe,V,U),de&&b.current.set(`${V}-${U}`,de)),!de)throw new Error("Failed to generate or retrieve audio data.");(!C.current||C.current.state==="closed")&&(C.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3}));const Z=C.current;Z.state==="suspended"&&await Z.resume();const Q=Zu(de),j=await Fy(Q,Z,24e3,1);w.current&&w.current.stop();const fe=Z.createBufferSource();fe.buffer=j,fe.connect(Z.destination),fe.onended=()=>{w.current===fe&&(v(!1),w.current=null)},fe.start(),w.current=fe}catch(oe){console.error("Error previewing voice:",oe),h(oe.message||"Failed to preview voice."),v(!1)}},[y,ue,s,U,h]),ee=x.useCallback(V=>{const oe=M.find(de=>de.id===V);oe&&Rc(oe.audioData,oe.id,oe.voiceName,oe.intonation||"standard",oe.title)},[M]),Te=x.useCallback(async()=>{const V=M.filter(oe=>f.has(oe.id));for(const oe of V)Rc(oe.audioData,oe.id,oe.voiceName,oe.intonation||"standard",oe.title),await new Promise(de=>setTimeout(de,300))},[M,f]),le=x.useRef(M.length);x.useEffect(()=>{if(O&&M.length>le.current){const V=M.slice(0,M.length-le.current);for(const oe of V)Rc(oe.audioData,oe.id,oe.voiceName,oe.intonation||"standard",oe.title)}le.current=M.length},[M,O]);const J=V=>{T(oe=>{const de=new Set(oe);return de.has(V)?de.delete(V):de.add(V),de})},ge=V=>{E(oe=>{const de=new Set(oe);return de.has(V)?de.delete(V):de.add(V),de})},ae=()=>{const V=new Set(M.map(oe=>oe.id));T(V)},ce=()=>{T(new Set)},B=()=>{const V=new Set(M.map(de=>de.id)),oe=new Set;V.forEach(de=>{f.has(de)||oe.add(de)}),T(oe)},X=x.useMemo(()=>[{name:"Aoede",apiName:"aoede",gender:s("gender.female")},{name:"Autonoe",apiName:"autonoe",gender:s("gender.female")},{name:"Callirrhoe",apiName:"callirrhoe",gender:s("gender.female")},{name:"Despina",apiName:"despina",gender:s("gender.female")},{name:"Erinome",apiName:"erinome",gender:s("gender.female")},{name:"Kore",apiName:"kore",gender:s("gender.female")},{name:"Laomedeia",apiName:"laomedeia",gender:s("gender.female")},{name:"Leda",apiName:"leda",gender:s("gender.female")},{name:"Pulcherrima",apiName:"pulcherrima",gender:s("gender.female")},{name:"Sadachbia",apiName:"sadachbia",gender:s("gender.female")},{name:"Sadaltager",apiName:"sadaltager",gender:s("gender.female")},{name:"Schedar",apiName:"schedar",gender:s("gender.female")},{name:"Sulafat",apiName:"sulafat",gender:s("gender.female")},{name:"Vindemiatrix",apiName:"vindemiatrix",gender:s("gender.female")},{name:"Achernar",apiName:"achernar",gender:s("gender.male")},{name:"Achird",apiName:"achird",gender:s("gender.male")},{name:"Algenib",apiName:"algenib",gender:s("gender.male")},{name:"Algieba",apiName:"algieba",gender:s("gender.male")},{name:"Alnilam",apiName:"alnilam",gender:s("gender.male")},{name:"Charon",apiName:"charon",gender:s("gender.male")},{name:"Enceladus",apiName:"enceladus",gender:s("gender.male")},{name:"Fenrir",apiName:"fenrir",gender:s("gender.male")},{name:"Gacrux",apiName:"gacrux",gender:s("gender.male")},{name:"Iapetus",apiName:"iapetus",gender:s("gender.male")},{name:"Orus",apiName:"orus",gender:s("gender.male")},{name:"Puck",apiName:"puck",gender:s("gender.male")},{name:"Rasalgethi",apiName:"rasalgethi",gender:s("gender.male")},{name:"Umbriel",apiName:"umbriel",gender:s("gender.male")},{name:"Zephyr",apiName:"zephyr",gender:s("gender.male")},{name:"Zubenelgenubi",apiName:"zubenelgenubi",gender:s("gender.male")}],[s]),F=x.useMemo(()=>X.map(V=>({value:V.apiName,label:`${V.name} (${V.gender})`})),[X]),Y=x.useMemo(()=>[{value:"standard",label:s("intonation.standard")},{value:"cheerful",label:s("intonation.cheerful")},{value:"angry",label:s("intonation.angry")},{value:"sad",label:s("intonation.sad")},{value:"excited",label:s("intonation.excited")},{value:"announcer",label:s("intonation.announcer")},{value:"whispering",label:s("intonation.whispering")}],[s]),K=/\[style:.*?]/.test(typeof k=="string"?k:"");return o.jsxs("div",{className:"flex flex-col h-full space-y-4",children:[o.jsxs("div",{className:"flex-shrink-0 space-y-3",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(ft,{id:`multi-speaker-${e.id}`,checked:L,onChange:V=>te({isMultiSpeaker:V}),disabled:m||y,className:"h-4 w-4"}),o.jsx("label",{htmlFor:`multi-speaker-${e.id}`,className:"text-sm text-gray-300 select-none cursor-pointer",children:s("speech_synthesizer.multiSpeaker")})]}),L?o.jsxs("div",{className:"p-3 bg-gray-900/40 rounded-md border border-gray-700/50 space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{htmlFor:`speaker1-name-${e.id}`,className:"text-xs font-medium text-emerald-400",children:s("speech_synthesizer.speaker1Name")}),o.jsx("input",{id:`speaker1-name-${e.id}`,type:"text",value:D,onChange:V=>te({speaker1Name:V.target.value}),className:"w-full p-2 bg-gray-900 border border-emerald-500/50 rounded-md text-xs focus:ring-1 focus:ring-emerald-500 outline-none text-gray-200",onMouseDown:V=>V.stopPropagation()}),o.jsx("label",{className:"text-xs font-medium text-gray-400",children:s("node.content.voice")}),o.jsx(Yn,{value:G,onChange:V=>te({speaker1Voice:V}),options:F,disabled:m,id:`speaker1-voice-${e.id}`})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{htmlFor:`speaker2-name-${e.id}`,className:"text-xs font-medium text-cyan-400",children:s("speech_synthesizer.speaker2Name")}),o.jsx("input",{id:`speaker2-name-${e.id}`,type:"text",value:q,onChange:V=>te({speaker2Name:V.target.value}),className:"w-full p-2 bg-gray-900 border border-emerald-500/50 rounded-md text-xs focus:ring-1 focus:ring-emerald-500 outline-none text-gray-200",onMouseDown:V=>V.stopPropagation()}),o.jsx("label",{className:"text-xs font-medium text-gray-400",children:s("node.content.voice")}),o.jsx(Yn,{value:ie,onChange:V=>te({speaker2Voice:V}),options:F,disabled:m,id:`speaker2-voice-${e.id}`})]})]}),o.jsx("p",{className:"text-[10px] text-gray-500 italic border-t border-gray-700/50 pt-1",children:s("speech_synthesizer.multiSpeakerHint")})]}):o.jsxs("div",{className:"flex items-center space-x-2 h-10",children:[o.jsx("div",{className:"w-1/2",children:o.jsx(Yn,{value:P,onChange:V=>te({voice:V}),options:F,disabled:m||y||L,id:`voice-select-${e.id}`})}),o.jsxs("div",{className:"w-1/2 relative",children:[o.jsx(Yn,{value:U,onChange:V=>te({intonation:V}),options:Y,disabled:m||y||K||L,id:`intonation-select-${e.id}`}),K&&o.jsx("div",{className:"absolute inset-0 bg-gray-700/80 rounded-md flex items-center justify-center text-xs text-gray-300 font-medium z-10 pointer-events-none",title:s("speech_synthesizer.ssmlHint"),children:"SSML Active"})]}),o.jsx("div",{className:"flex-shrink-0",children:o.jsx(Ie,{title:s("node.content.previewVoice"),onClick:()=>$(P),disabled:m||a||L,children:y?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 animate-pulse text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-emerald-500 hover:text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})})})]}),o.jsxs("div",{className:"flex-shrink-0 p-1 bg-gray-900/50 rounded-md flex items-center space-x-1 border border-gray-700/30",children:[o.jsx("div",{className:`p-2 h-8 w-10 flex items-center justify-center rounded-md transition-colors ${_?"bg-emerald-600/30 text-emerald-400":"text-gray-500 bg-transparent"}`,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${_?"animate-spin":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),o.jsx("button",{onClick:()=>te({mode:"simple"}),className:`flex-1 px-3 py-1 text-sm font-semibold rounded-md transition-colors h-8 ${z==="simple"?"bg-emerald-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:s("speech_synthesizer.mode.simple")}),o.jsx("button",{onClick:()=>te({mode:"scene"}),className:`flex-1 px-3 py-1 text-sm font-semibold rounded-md transition-colors h-8 ${z==="scene"?"bg-emerald-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:s("speech_synthesizer.mode.scene")})]})]}),z==="scene"&&o.jsx("div",{className:"flex items-center justify-end gap-2 p-2 bg-gray-900/50 rounded-md flex-shrink-0 border border-gray-700/30",children:o.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-400",children:[o.jsx("label",{htmlFor:`start-scene-${e.id}`,className:"whitespace-nowrap",children:s("node.content.analyzeFromScene")}),o.jsx("input",{id:`start-scene-${e.id}`,type:"number",min:"1",placeholder:"1",value:H||"",onChange:V=>te({startSceneNumber:V.target.value?parseInt(V.target.value,10):null}),className:"w-14 p-1 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 outline-none border border-transparent focus:border-emerald-500",onMouseDown:V=>V.stopPropagation()}),o.jsx("label",{htmlFor:`end-scene-${e.id}`,className:"whitespace-nowrap",children:s("node.content.analyzeUpToScene")}),o.jsx("input",{id:`end-scene-${e.id}`,type:"number",min:"1",placeholder:s("node.content.endPlaceholder"),value:W||"",onChange:V=>te({endSceneNumber:V.target.value?parseInt(V.target.value,10):null}),className:"w-16 p-1 bg-gray-800 text-white rounded-md text-center focus:ring-1 focus:ring-emerald-500 outline-none border border-transparent focus:border-emerald-500",onMouseDown:V=>V.stopPropagation()})]})}),o.jsxs("button",{onClick:m?i:()=>n(e.id),disabled:a||y||typeof k=="string"&&!k.trim()&&z==="simple"||Array.isArray(k)&&k.length===0&&z==="scene",className:`w-full flex-shrink-0 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 whitespace-nowrap flex items-center justify-center space-x-2 ${a?"bg-yellow-600":m?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed"}`,children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})}),o.jsx("span",{children:s(a?"node.action.stopping":m?"node.content.generating":"node.content.generateSpeech")})]}),o.jsxs("div",{className:"flex flex-row flex-grow min-h-0 space-x-2",children:[o.jsx("div",{onWheel:V=>V.stopPropagation(),className:"w-1/2 bg-gray-900/50 rounded p-2 overflow-y-auto custom-scrollbar border border-gray-700/30",children:z==="scene"?Array.isArray(k)&&k.length>0?o.jsx("div",{className:"space-y-2",children:k.map(V=>{const oe=I.has(V.sceneNumber);return o.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2 border border-gray-700/30 hover:border-gray-600 transition-colors",children:[o.jsxs("h4",{className:"font-semibold text-gray-300 text-sm flex justify-between items-center cursor-pointer select-none",onClick:()=>ge(V.sceneNumber),children:[o.jsxs("span",{children:[s("node.content.scene")," ",V.sceneNumber]}),oe?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})]}),!oe&&o.jsx("p",{className:"mt-2 text-sm text-gray-200 whitespace-pre-wrap select-text",children:V.text})]},V.sceneNumber)})}):o.jsx("div",{className:"flex items-center justify-center h-full text-center text-xs text-gray-500 p-4",children:o.jsx("p",{children:s("node.content.connectNarratorData")})}):o.jsx("textarea",{className:"w-full h-full bg-transparent p-1 disabled:bg-transparent disabled:text-gray-500 custom-scrollbar resize-none focus:ring-1 focus:ring-emerald-500 focus:outline-none rounded text-sm text-gray-200 placeholder-gray-600",placeholder:s(R?"node.content.connectedPlaceholder":"node.content.textToSynthesize"),value:typeof k=="string"?k:"",onChange:V=>te({inputText:V.target.value}),disabled:R||m,onMouseDown:V=>V.stopPropagation()})}),o.jsxs("div",{className:"w-1/2 bg-gray-900/50 rounded p-2 flex flex-col space-y-2 border border-gray-700/30",children:[M.length>0&&o.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between border-b border-gray-700/50 pb-2",children:[o.jsx("span",{className:"text-sm text-gray-300 font-medium",children:s("node.content.promptsGenerated",{count:M.length})}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ie,{title:s("selection.selectAll"),onClick:ae,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),o.jsx(Ie,{title:s("selection.deselectAll"),onClick:ce,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2M8 7h8M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V9a2 2 0 00-2-2h-2"})})}),o.jsx(Ie,{title:s("selection.invert"),onClick:B,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})})]})]}),o.jsx("div",{onWheel:V=>V.stopPropagation(),className:"flex-grow overflow-y-auto custom-scrollbar space-y-2 pr-1 -mr-1",children:M.length>0?M.map((V,oe)=>o.jsx(G5,{id:V.id,title:V.title,text:V.text,audioData:V.audioData,voiceName:V.voiceName,intonation:V.intonation||"standard",isSelected:f.has(V.id),onSelect:J,onDownload:ee,onPlayRequest:ye,t:s},V.id||oe)):o.jsx("div",{className:"flex items-center justify-center h-full text-center text-xs text-gray-500",children:o.jsx("p",{children:"Generated audio files will appear here."})})}),M.length>0&&o.jsxs("div",{className:"flex-shrink-0 flex flex-col items-stretch space-y-2 pt-2 border-t border-gray-700/50",children:[o.jsxs("div",{className:"flex items-center space-x-2 px-1",children:[o.jsx(ft,{id:`auto-download-${e.id}`,checked:O,onChange:V=>te({isAutoDownloadEnabled:V}),className:"h-4 w-4"}),o.jsx("label",{htmlFor:`auto-download-${e.id}`,className:"text-xs text-gray-300 select-none cursor-pointer",children:s("node.content.autoDownload")})]}),o.jsx("button",{onClick:Te,disabled:f.size===0,className:"w-full px-3 py-2 text-sm font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors",children:s("node.content.downloadSelected")})]})]})]})]})},H5=["   ","    ",",    ",",     ","   "," ,   ","    ","       ","   ","    ","    ",",    ",",   -  ",",     ","     "," ","   ","   ",",   ","  ","      "," ,   ","    ","-,    ","      -","    ","     ",",  "," -"," ,    "," ,   ","  -","-","     ","    ","  ,   ","    "," ,   ",",    ","    ","      ","    ","     ","     ","  "," ,    ","     ","      ",",   ","   ","    ","   "," ,   ","    ","     1940-","  ,   ","  ","    ?","   ","    ","  ,     "," ,   ",",       ","      ","    ",",    ",",   ","   ","  ","  ","   ","   ","-","       ","  ",",   ","  "," ","    ",",   ","    ","   ","      ","  ","    ","   ","    ","    ","    ","       ","  ","  ","   ","    ","     ","  "," ","     ","    ","   ","    "," ,   "," ,     ",",    ","    ","    ","    ",",   ","     ","   ,     ","    ","  ","    ","    ","  ","   ","  -","   ","    "," ,  ","    ","    ","    ","     ","     XIV","  "," ","   ","    ","   ","  "," ","  ","    ","   ","    ","     ","      ","    ","    ","    ","      ","    "," ,      ","  ","    ",",   ","    ,    ","-    ","     ","   ",",     ?","  ","      ","  :   ","   ","    ","      /","     ","   -","   ","  ",",    ","   ","   ","  ,     ","    ","    ",",     ","  ",",   ","    ","  ",",   ","  ","  "," ,  ","  ","   ","   ",",    ",",      ",",      ","  ,   ","   ","  ","   ",",   ",",    ",",   ","  ",",    - ","   ","  ",",   ","  ",",    ",",    ","  ","  "],B5=["A forgotten kingdom under the mountain","Flying islands with crystal castles","A forest where trees whisper prophecies","A city built on the back of a giant turtle","A magical academy in the clouds","A cursed artifact seeking its master","The last dragon and its rider","A war between elves and dwarves over an ancient relic","A journey to the underworld","A thieves' guild with magical abilities","Living statues in an ancient temple","A knight who made a deal with a demon","A library containing every book ever written","A world where magic is based on music","A monster hunter in a gothic city","A goblin rebellion","A prophecy about the end of the world","A lost city in the jungle","A kingdom ruled by animals","A floating market of wonders","A colony on Mars loses contact with Earth","An artificial intelligence that has realized it is a god","A journey to the center of a black hole","A cyberpunk city where memories can be bought","The last man on Earth and his robot companion","Space pirates in the asteroid belt","Discovery of an alien civilization in the depths of the ocean","A corporation that controls time","A rebellion of android servants","A generation ship flying to a new star","Virtual reality that has become more real than life","Genetically modified human super-soldiers","A prison planet","A bounty hunter in a neon metropolis","A post-apocalyptic world after a nuclear war","Contact with a race that communicates through emotions","Archaeological excavations on another planet","A star ark carrying frozen colonists","A world where people have stopped aging","Teleportation and its unforeseen consequences","A murder in a locked room in a Victorian mansion","The disappearance of a famous painting from a museum","A series of mysterious disappearances in a small town","A detective with amnesia investigates his own past","The mystery of an old lighthouse","An encrypted message found in an antique book","A crime on board a luxury cruise liner","An investigation in a closed scientific complex in the Arctic","A ghost haunting an old theater","A political conspiracy and blackmail","The search for a missing heir to a huge fortune","The mysterious death of a famous writer","A bank robbery committed without a trace","A case of forged works of art","A private detective in a noir city of the 1940s","The mystery of an ancient curse that kills family members","An investigation in a monastery","Who poisoned the critic in the restaurant?","The mystery of an abandoned amusement park","A secret society and its rituals","A haunted house that won't let its residents go","An ancient evil awakened in the forest","An experiment gone wrong in a secret laboratory","A group of teenagers at a summer camp and a maniac","A spaceship finds an abandoned station","A doll possessed by a spirit","A city shrouded in eternal fog","Vampires in a modern metropolis","The discovery of a strange videotape","A ritual to summon a demon","A creature from the depths of the sea","A psychological thriller about paranoia","A killer clown","A family moves into a new house with a dark past","Infection by an unknown virus","A cult that worships an ancient deity","Lost in caves","A living dead","Strange events on an isolated farm","Nightmares that become reality","A treasure hunt on a deserted island","An expedition to the North Pole","A journey down the Amazon in search of a lost tribe","Climbing Mount Everest","A round-the-world trip in a hot air balloon","Rafting down a turbulent river","Survival after a plane crash in the jungle","The search for the mythical fountain of youth","The adventures of an archaeologist in Egyptian tombs","A journey to the Wild West during the Gold Rush","A prison break","Exploring underwater caves","Hunting for a rare animal","Hitchhiking across the country","Becoming a student of a great martial arts master","A flight to Mars","The search for Atlantis","Participating in a dog sled race","The adventures of a cabin boy on a pirate ship","Crossing the desert on camels","First love in high school","A family secret revealed at a funeral","A young musician trying to make it in the big city","A friendship tested by time and distance","The complex relationship between a mother and daughter","A custody battle for a child","A doctor in the emergency room","A teacher inspiring troubled teenagers","A sports drama about the path to victory","Life in a small town where everyone knows each other","The story of immigrants in a new country","A midlife crisis","The choice between career and family","Volunteering at an animal shelter","The struggle with addiction","Starting your own small business","The rivalry between two chefs","Student life in a dormitory","A political career and moral dilemmas","A love story divided by war","The life of a gladiator in Ancient Rome","A Viking expedition to unknown lands","Espionage during the Cold War","The construction of the Great Wall of China through the eyes of a worker","Life at the court of King Louis XIV","The great geographical discoveries","The French Revolution","A samurai in the Meiji era","The Salem witch trials","Life in a medieval castle","The campaign of Alexander the Great","The Trojan War","The conquest of America by the conquistadors","Intrigues in the harem of the Ottoman sultan","The life of Leonardo da Vinci","Forbidden love in Victorian England","The struggle for independence in colonial America","Pirates of the Caribbean in the Golden Age of Piracy","Ancient Egypt and the construction of the pyramids","World War I in the trenches","Two losers try to rob a bank","A body swap between a teenager and his dog","An office comedy about strange colleagues","A family road trip where everything goes wrong","The adventures of a hapless superhero","A student accidentally becomes the head of the mafia","A farmer who won the lottery","A romantic comedy about two people who hate each other","A zombie apocalypse from the zombie's point of view","The gods of Olympus live in a modern apartment","A parody of spy movies","What if animals could talk?","A disastrous blind date","An attempt to make a movie with no budget and no talent","Roommates: a neat freak and a slob","A trip to a music festival","An alien tries to pretend to be a normal person","How to survive on a deserted island with your ex","An attempt to impress your partner's parents","A hot dog eating contest","The friendship of a boy and a dragon","The adventures of a talking cat","A girl who found a magic wand","A journey to the land of sweets","A school for young wizards","The story of how the stars got into the sky","An enchanted forest and its inhabitants","A little gnome looking for his home","A princess who didn't want to get married","The secret life of toys","A fairy who lost her wings","How animals prepare for winter","The underwater kingdom of mermaids","A boy who could fly","A competition of forest animals","The mystery of an old attic","A magic tree that grants wishes","The adventures of a little ghost","The search for a missing rainbow color","The story of a brave little mouse","A world where colors have taste","A man who can see other people's dreams","A city where time flows backwards","A journey through a country made of books","People with animal heads","An ocean in the sky","A conversation with one's own reflection","Memories that can be materialized","A city where everyone speaks in verse","A man made of glass","A staircase to nowhere","A desert where there are clocks instead of sand","A factory for producing clouds","A carnival of forgotten ideas","An architect who builds impossible buildings","A world without sounds","A map that changes before your eyes","A man living in a single minute","A symphony of city noises","A museum of lost feelings"],V5=({node:e,onValueChange:t,t:n,onGenerateIdeaCategories:r,isGeneratingIdeaCategories:a,onCombineStoryIdea:i,isCombiningStoryIdea:s,addToast:l})=>{const c=a||s,d=x.useMemo(()=>{try{const N=JSON.parse(e.value||"{}");return{stage:N.stage||"initial",theme:N.theme||"",categories:N.categories||null,selection:N.selection||{action:null,place:null,obstacle:null},generatedIdea:N.generatedIdea||"",targetLanguage:N.targetLanguage||"ru",format:N.format||"childrens"}}catch{return{stage:"initial",theme:"",categories:null,selection:{action:null,place:null,obstacle:null},generatedIdea:"",targetLanguage:"ru",format:"childrens"}}},[e.value]),{stage:h,theme:g,categories:m,selection:_,generatedIdea:y,targetLanguage:v,format:C}=d,w=x.useMemo(()=>[{value:"childrens",label:n("idea_generator.format.childrens")},{value:"adventure",label:n("idea_generator.format.adventure")},{value:"fantasy",label:n("idea_generator.format.fantasy")},{value:"detective",label:n("idea_generator.format.detective")},{value:"scifi",label:n("idea_generator.format.scifi")},{value:"horror",label:n("idea_generator.format.horror")},{value:"historical",label:n("idea_generator.format.historical")},{value:"general",label:n("idea_generator.format.general")}],[n]),b=N=>{t(e.id,JSON.stringify({...d,...N}))},f=(N,A)=>{b({selection:{..._,[N]:_[N]===A?null:A}})},T=()=>{const N=v==="ru"?H5:B5,A=Math.floor(Math.random()*N.length);b({theme:N[A]})},I=()=>{if(!m)return;const N=m.action[Math.floor(Math.random()*m.action.length)],A=m.place[Math.floor(Math.random()*m.place.length)],k=m.obstacle[Math.floor(Math.random()*m.obstacle.length)];b({selection:{action:N,place:A,obstacle:k}})},E=_.action&&_.place&&_.obstacle,R=()=>m?o.jsx("div",{className:"flex flex-row space-x-2 h-full",children:["action","place","obstacle"].map(N=>o.jsxs("div",{className:"flex flex-col w-1/3 bg-gray-900/50 p-2 rounded-md",children:[o.jsx("h4",{className:"font-semibold text-emerald-400 mb-2 capitalize flex-shrink-0",children:n(`node.content.category.${N}`)}),o.jsx("div",{className:"overflow-y-auto custom-scrollbar -mr-2 pr-2 p-1",children:o.jsx("div",{className:"flex flex-col items-start gap-2",children:(m[N]||[]).map((A,k)=>o.jsx("button",{onClick:()=>f(N,A),disabled:c,className:`w-full text-left px-3 py-1 text-sm rounded-md transition-colors ${_[N]===A?"bg-emerald-600 text-white font-semibold ring-2 ring-emerald-400":"bg-gray-800 hover:bg-gray-600 text-gray-200 disabled:bg-gray-800/50 disabled:cursor-not-allowed"}`,children:A},k))})})]},N))}):null;return o.jsxs("div",{className:"flex flex-col h-full space-y-2",onWheel:N=>N.stopPropagation(),children:[o.jsxs("div",{className:"flex-shrink-0 flex items-end space-x-2",children:[o.jsxs("div",{className:"flex-grow space-y-1",children:[o.jsx("label",{htmlFor:`theme-input-${e.id}`,className:"text-xs font-medium text-gray-400 block mb-1",children:n("node.content.theme")}),o.jsxs("div",{className:"relative",children:[o.jsx("textarea",{id:`theme-input-${e.id}`,value:g,onChange:N=>b({theme:N.target.value}),disabled:c,placeholder:n("idea_generator.themePlaceholder"),rows:1,className:"w-full pl-2 pr-8 py-2 text-sm bg-gray-700 border-none rounded-md resize-none focus:ring-1 focus:ring-emerald-500 focus:outline-none custom-scrollbar h-9 leading-tight"}),o.jsx("button",{onClick:T,disabled:c,title:n("idea_generator.randomTheme"),className:"absolute top-1/2 right-1 -translate-y-1/2 p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white disabled:opacity-50",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h5m-5.223 2.152A9 9 0 0119.77 8.227M20 20v-5h-5m5.223-2.152A9 9 0 014.23 15.773"})})})]})]}),o.jsxs("div",{className:"w-48 flex-shrink-0 space-y-1",children:[o.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:n("node.content.storyFormat")}),o.jsx(Yn,{value:C,onChange:N=>b({format:N}),options:w,disabled:c,id:`format-select-${e.id}`})]})]}),o.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2",children:[o.jsxs("div",{className:"flex w-24 flex-shrink-0 bg-gray-700 rounded-md overflow-hidden h-10",children:[o.jsx("button",{onClick:()=>b({targetLanguage:"ru"}),className:`flex-1 py-1.5 text-xs font-bold text-center transition-colors ${v==="ru"?"bg-emerald-600 text-white":"bg-transparent text-gray-300 hover:text-white"}`,children:"RU"}),o.jsx("div",{className:"w-px bg-gray-600"}),o.jsx("button",{onClick:()=>b({targetLanguage:"en"}),className:`flex-1 py-1.5 text-xs font-bold text-center transition-colors ${v==="en"?"bg-emerald-600 text-white":"bg-transparent text-gray-300 hover:text-white"}`,children:"EN"})]}),o.jsx("button",{onClick:()=>r(e.id),disabled:c,className:"flex-grow h-10 px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:bg-gray-500/50 transition-colors",children:n(a?"node.content.generating":h==="initial"?"node.content.requestCategories":"node.content.requestNewCategories")})]}),o.jsx("div",{className:"flex-grow min-h-0",children:h==="initial"?o.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 text-center p-4 bg-gray-900/50 rounded-md",children:o.jsx("p",{children:n("idea_generator.initialMessage",{buttonName:n("node.content.requestCategories")})})}):R()}),o.jsxs("div",{className:"flex-shrink-0 space-y-2",children:[o.jsxs("div",{className:"bg-gray-900/50 p-2 rounded-md",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:n("node.content.generatedIdea")}),o.jsx(Ie,{title:n("node.action.copy"),onClick:()=>{y&&(navigator.clipboard.writeText(y),l(n("toast.copied"),"success"))},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{value:y,onChange:N=>b({generatedIdea:N.target.value}),placeholder:n("idea_generator.ideaPlaceholder"),className:"w-full text-sm p-2 bg-gray-800 border-none rounded-md resize-none focus:outline-none custom-scrollbar overflow-y-scroll",rows:3,onWheel:N=>N.stopPropagation()})]}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:I,disabled:c||!m,title:n("idea_generator.randomCombination"),className:"h-10 px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h5m-5.223 2.152A9 9 0 0119.77 8.227M20 20v-5h-5m5.223-2.152A9 9 0 014.23 15.773"})})}),o.jsx("button",{onClick:()=>i(e.id),disabled:c||!E,className:"w-full px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 disabled:bg-gray-500 disabled:cursor-not-allowed",children:n(s?"node.content.generating":"node.content.generateIdea")})]})]})]})},Es=x.forwardRef(({label:e,text:t,translatedText:n,isCritical:r,isEnabled:a=!0,isMandatory:i=!1,onToggle:s,color:l="emerald",className:c="",index:d},h)=>{const[g,m]=x.useState(!1);let _="",y="",v="",C="",w="",b="";if(!a)_="bg-gray-800/20",y="border-gray-700",v="text-gray-500",C="bg-gray-700",w="text-gray-500",b="bg-gray-800 text-gray-600";else if(r)_="bg-red-900/20",y="border-red-800/50",v="text-red-400",C="bg-red-500",w="text-gray-300",b="bg-red-900/50 text-red-200";else if(i)_="bg-gray-800",y="border-gray-600",v="text-emerald-400",C="bg-gray-500",w="text-gray-300",b="bg-gray-700 text-gray-400";else switch(w="text-gray-300",l){case"cyan":_="bg-cyan-900/20",y="border-cyan-700/50",v="text-cyan-400",C="bg-cyan-500",b="bg-cyan-900/50 text-cyan-200";break;case"purple":_="bg-purple-900/20",y="border-purple-700/50",v="text-purple-400",C="bg-purple-500",b="bg-purple-900/50 text-purple-200";break;default:_="bg-emerald-900/20",y="border-emerald-700/50",v="text-emerald-400",C="bg-emerald-500",b="bg-emerald-900/50 text-emerald-200"}const f=T=>{T.stopPropagation(),navigator.clipboard.writeText(t),m(!0),setTimeout(()=>m(!1),1500)};return o.jsxs("div",{ref:h,onMouseDown:T=>T.stopPropagation(),onClick:()=>!i&&s&&s(),className:`flex flex-row p-2 rounded border text-xs transition-all relative overflow-hidden group select-none items-stretch gap-3 ${_} ${y} ${c} flex-shrink-0 ${i?"":"cursor-pointer hover:border-opacity-100 hover:shadow-sm"} duration-300`,children:[d!==void 0&&o.jsxs("div",{className:"flex-shrink-0 w-6 flex flex-col items-center justify-start pt-0.5",children:[o.jsx("div",{className:`text-[9px] font-mono font-bold w-5 h-5 flex items-center justify-center rounded-full ${b}`,children:d}),o.jsx("div",{className:`w-px flex-grow mt-1 ${a?"bg-gray-700":"bg-transparent"}`})]}),o.jsxs("div",{className:"flex flex-col flex-grow min-w-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[d===void 0&&o.jsx("div",{className:`w-1.5 h-1.5 rounded-full flex-shrink-0 ${C}`}),o.jsx("div",{className:`font-bold uppercase tracking-wider text-[10px] leading-tight ${v}`,children:e})]}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx("button",{onClick:f,className:`p-0.5 rounded transition-colors ${a?"text-gray-500 hover:text-white":"text-gray-600 hover:text-gray-400"}`,title:"Copy Prompt Text",children:g?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]}),o.jsx("div",{className:`leading-tight ${a?"text-gray-300":"text-gray-600"} text-[10px] mb-1`,children:t}),n&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-gray-600/30 my-1 w-full"}),o.jsx("div",{className:`text-[9px] italic leading-tight ${w} opacity-70`,children:n})]})]}),o.jsx("div",{className:`absolute bottom-0 left-0 w-full h-[2px] opacity-30 ${C}`})]})}),so={ROLE_NARRATOR:{id:"narrator_role_story",label:"Role: Storyteller",text:"You are a professional Voiceover Artist and Storyteller. Your tone should be engaging, descriptive, and emotionally resonant, suitable for audiobooks or narrative content."},ROLE_ANNOUNCER:{id:"narrator_role_news",label:"Role: Announcer",text:"You are a professional Broadcaster and Announcer. Your tone should be clear, punchy, energetic, and authoritative, suitable for commercials, trailers, or news."},ROLE_FIRST_PERSON:{id:"narrator_role_fps",label:"Role: Character",text:"You are the Character speaking from the First Person perspective. Express internal monologue, subjectivity, and direct emotional reaction to the events."},INPUT_CONTEXT:{id:"narrator_input",text:"Source Data: User Prompt / Scene Description."},SSML_RULE:{id:"narrator_ssml",text:'USE SSML TAGS: You MUST use Speech Synthesis Markup Language (SSML) to control the prosody. Use <break time="..."/> for pauses, <emphasis> for stress, and <prosody> for speed/pitch changes to enhance the performance.'},FORMAT:{id:"narrator_format",text:"Return a JSON object where keys are language codes (e.g., 'en', 'ru') and values are the generated voiceover scripts for those languages."}},$5=({uiState:e,onUpdateUiState:t,role:n,generateSSML:r,onToggleSSML:a,t:i})=>{let s=0;const c=(()=>{switch(n){case"announcer":case"dual_announcer":return so.ROLE_ANNOUNCER;case"first_person":return so.ROLE_FIRST_PERSON;case"narrator":case"dual_narrator":default:return so.ROLE_NARRATOR}})();return o.jsxs("div",{className:"border border-gray-600 hover:border-gray-400 rounded-md bg-gray-900 overflow-hidden flex-shrink-0 flex flex-col transition-colors duration-200",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>t({isSettingsCollapsed:!e.isSettingsCollapsed}),children:[o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:i("node.content.activePromptStack")}),o.jsx("div",{className:"text-gray-400",children:e.isSettingsCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!e.isSettingsCollapsed&&o.jsxs("div",{className:"p-2 bg-gray-800/20 flex flex-col gap-1 overflow-y-auto custom-scrollbar max-h-64",onWheel:d=>d.stopPropagation(),children:[o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"1. Context"}),o.jsx(Es,{label:i(`instruction.${so.INPUT_CONTEXT.id}`),text:so.INPUT_CONTEXT.text,translatedText:i(`instruction.desc.${so.INPUT_CONTEXT.id}`),isMandatory:!0,color:"gray",index:++s}),o.jsx(Es,{label:i(`instruction.${c.id}`),text:c.text,translatedText:i(`instruction.desc.${c.id}`),isMandatory:!0,color:"emerald",index:++s})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"2. Formatting"}),o.jsx(Es,{label:i(`instruction.${so.SSML_RULE.id}`),text:so.SSML_RULE.text,translatedText:i(`instruction.desc.${so.SSML_RULE.id}`),isEnabled:r,onToggle:a,color:"purple",index:r?++s:void 0})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"3. Output"}),o.jsx(Es,{label:i(`instruction.${so.FORMAT.id}`),text:so.FORMAT.text,translatedText:i(`instruction.desc.${so.FORMAT.id}`),isMandatory:!0,color:"gray",index:++s})]})]})]})},W5=[{code:"ru",label:"RU"},{code:"en",label:"EN"},{code:"es",label:"ES"},{code:"fr",label:"FR"},{code:"de",label:"DE"},{code:"it",label:"IT"},{code:"pt",label:"PT"},{code:"zh",label:"ZH"},{code:"ja",label:"JA"},{code:"ko",label:"KO"}],Y5={ru:"",en:"English",es:"Espaol",fr:"Franais",de:"Deutsch",it:"Italiano",pt:"Portugus",zh:"",ja:"",ko:""},q5=({node:e,onValueChange:t,t:n,deselectAllNodes:r,connectedInputs:a,onGenerateNarratorText:i,isGeneratingNarratorText:s,isStopping:l,onStopGeneration:c,getUpstreamTextValue:d,inputData:h,connections:g})=>{const m=s===e.id,_=a==null?void 0:a.has(void 0),y=x.useMemo(()=>{try{const P=JSON.parse(e.value||"{}"),M=P.targetLanguages||{ru:!0,en:!1},H=P.languageSelectionOrder||Object.keys(M).filter(W=>M[W]);return{prompt:P.prompt||"",role:P.role||"narrator",generatedTexts:P.generatedTexts||{ru:"",en:""},targetLanguages:M,generateSSML:P.generateSSML||!1,languageSelectionOrder:H,uiState:P.uiState||{isSettingsCollapsed:!0}}}catch{return{prompt:"",role:"narrator",generatedTexts:{ru:"",en:""},targetLanguages:{ru:!0,en:!1},generateSSML:!1,languageSelectionOrder:["ru"],uiState:{isSettingsCollapsed:!0}}}},[e.value]),{prompt:v,role:C,generatedTexts:w,targetLanguages:b,generateSSML:f,languageSelectionOrder:T,uiState:I}=y,E=x.useMemo(()=>[{value:"narrator",label:n("node.content.role.narrator")},{value:"announcer",label:n("node.content.role.announcer")},{value:"first_person",label:n("node.content.role.first_person")},{value:"dual_narrator",label:n("node.content.role.dual_narrator")},{value:"dual_announcer",label:n("node.content.role.dual_announcer")}],[n]),R=P=>{const M={...y,...P};t(e.id,JSON.stringify(M))},N=P=>{R({uiState:{...I,...P}})};x.useEffect(()=>{if(_&&d&&g){const P=g.find(M=>M.toNodeId===e.id);if(P){const M=d(P.fromNodeId,P.fromHandleId);M!==v&&R({prompt:M})}}},[h,_]);const A=P=>{const M=!!b[P];let H={...b},W=[...T||[]];if(M)H[P]=!1,W=W.filter(O=>O!==P);else{for(;W.length>=2;){const O=W.shift();O&&(H[O]=!1)}H[P]=!0,W.push(P)}R({targetLanguages:H,languageSelectionOrder:W})},k=(P,M)=>{R({generatedTexts:{...w,[P]:M}})};return o.jsxs("div",{className:"flex flex-col h-full space-y-2",children:[o.jsx("textarea",{value:v,onChange:P=>R({prompt:P.target.value}),placeholder:n(_?"node.content.connectedPlaceholder":"node.content.scriptPromptPlaceholder"),disabled:_||m,className:"w-full min-h-[80px] max-h-[140px] p-2 bg-gray-700 border border-transparent rounded-md resize-y focus:border-emerald-500 focus:ring-0 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar flex-shrink-0",onWheel:P=>P.stopPropagation(),onFocus:r}),o.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2",children:[o.jsx("div",{className:"w-40 flex-shrink-0",children:o.jsx(Yn,{value:C,onChange:P=>R({role:P}),options:E,disabled:m,id:`narrator-role-${e.id}`})}),o.jsxs("div",{className:"flex items-center bg-gray-700 rounded-md px-2 space-x-2 h-9 border border-gray-600 flex-shrink-0",title:"Embed intonation tags for speech synthesis.",children:[o.jsx(ft,{id:`generate-ssml-${e.id}`,checked:f,onChange:P=>R({generateSSML:P}),disabled:m,className:"h-4 w-4"}),o.jsx("label",{htmlFor:`generate-ssml-${e.id}`,className:"text-xs text-gray-300 select-none cursor-pointer font-medium",children:"SSML"})]}),o.jsxs("button",{onClick:m?c:()=>i(e.id),disabled:l||!m&&!v.trim()&&!_,className:`flex-grow h-9 px-4 py-2 font-bold text-white text-xs uppercase rounded-md transition-colors duration-200 flex-shrink-0 flex items-center justify-center ${l?"bg-yellow-600":m?"bg-red-600 hover:bg-red-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500"}`,children:[!m&&!l&&o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),n(l?"node.action.stopping":m?"node.content.generating":"node.content.generateText")]})]}),o.jsx($5,{uiState:I,onUpdateUiState:N,role:C,generateSSML:f,onToggleSSML:()=>R({generateSSML:!f}),t:n}),o.jsx("div",{className:"flex-shrink-0 bg-gray-700/50 p-1 rounded-md",children:o.jsx("div",{className:"flex flex-wrap gap-1",children:W5.map(P=>o.jsx(lt,{title:n(`languages.${P.code}`),position:"top",className:"flex-1",children:o.jsx("button",{onClick:()=>A(P.code),className:`w-full min-w-[30px] py-1 rounded text-[10px] font-bold uppercase transition-colors ${b[P.code]?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-600 hover:text-gray-200"}`,children:P.label})},P.code))})}),o.jsx("div",{className:"flex flex-col flex-grow min-h-0 space-y-2",children:(T&&T.length>0?T:Object.keys(b)).map(P=>{if(!b[P])return null;const M=Y5[P]||P.toUpperCase(),H=w&&w[P]||"";return o.jsxs("div",{className:"bg-gray-900/50 rounded-md p-2 flex flex-col flex-1 min-h-[120px]",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1 flex-shrink-0",children:[o.jsx("h4",{className:"font-semibold text-gray-300 text-sm",children:M}),o.jsx(Ie,{tooltipPosition:"left",title:n("node.action.copy"),onClick:W=>{W.stopPropagation(),navigator.clipboard.writeText(H)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{value:H,onChange:W=>k(P,W.target.value),className:"w-full text-sm p-2 bg-gray-800 border border-transparent rounded-md resize-y focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar flex-grow",onWheel:W=>W.stopPropagation(),onFocus:r})]},P)})})]})};function K5(e){return new Promise((t,n)=>{const r=new FileReader;r.onload=()=>{t(r.result)},r.onerror=n,r.readAsArrayBuffer(e)})}function J5(e){const t=e.numberOfChannels,n=e.length,r=new Int16Array(n*t),a=[];for(let s=0;s<t;s++)a.push(e.getChannelData(s));let i=0;for(let s=0;s<n;s++)for(let l=0;l<t;l++){const c=Math.max(-1,Math.min(1,a[l][s]));r[i++]=c<0?c*32768:c*32767}return r}function Ns(e,t,n){for(let r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}function X5(e){const t=J5(e),n=new ArrayBuffer(44),r=new DataView(n),a=e.numberOfChannels,i=e.sampleRate,s=16,l=i*a*(s/8),c=a*(s/8);return Ns(r,0,"RIFF"),r.setUint32(4,36+t.byteLength,!0),Ns(r,8,"WAVE"),Ns(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,a,!0),r.setUint32(24,i,!0),r.setUint32(28,l,!0),r.setUint16(32,c,!0),r.setUint16(34,s,!0),Ns(r,36,"data"),r.setUint32(40,t.byteLength,!0),new Blob([r,t],{type:"audio/wav"})}const Z5=({node:e,onValueChange:t,t:n,onTranscribeAudio:r,isTranscribingAudio:a,isStopping:i,onStopGeneration:s,deselectAllNodes:l,addToast:c})=>{const d=x.useRef(null),h=a,[g,m]=x.useState(!1),[_,y]=x.useState(!1),v=x.useMemo(()=>{try{const U=JSON.parse(e.value||"{}");return{audioBase64:U.audioBase64||null,mimeType:U.mimeType||null,transcription:U.transcription||"",segments:U.segments||[],fileName:U.fileName||null}}catch{return{audioBase64:null,mimeType:null,transcription:"",segments:[],fileName:null}}},[e.value]),{audioBase64:C,transcription:w,fileName:b,segments:f,mimeType:T}=v,I=U=>{t(e.id,JSON.stringify({...v,...U}))},E=async U=>{if(U.type.startsWith("video/mp4")){y(!0);try{const z=new(window.AudioContext||window.webkitAudioContext),L=await K5(U),D=await z.decodeAudioData(L),G=X5(D),q=new FileReader;q.onload=ie=>{var ye;const te=((ye=ie.target)==null?void 0:ye.result).split(",")[1];I({audioBase64:te,mimeType:"audio/wav",fileName:U.name,transcription:"",segments:[]}),y(!1)},q.onerror=()=>{y(!1),c(n("error.fileReadError"),"info")},q.readAsDataURL(G)}catch(z){console.error("Error converting video to audio:",z),c(n("error.videoConversionError"),"info"),y(!1)}}else if(U.type.startsWith("audio/")){const z=new FileReader;z.onload=L=>{var G;const D=((G=L.target)==null?void 0:G.result).split(",")[1];I({audioBase64:D,mimeType:U.type,fileName:U.name,transcription:"",segments:[]})},z.readAsDataURL(U)}else c(n("error.unsupportedFile"),"info")},R=U=>{var L;const z=(L=U.target.files)==null?void 0:L[0];z&&(E(z),U.target&&(U.target.value=""))},N=()=>{var U;(U=d.current)==null||U.click()},A=async()=>{r(e.id)};x.useMemo(()=>{if(w&&typeof w=="string"&&w.trim().startsWith("["))try{const U=JSON.parse(w);if(Array.isArray(U)&&U.length>0&&U[0].startTime){const z=U.map(L=>L.text).join(" ");setTimeout(()=>{I({transcription:z,segments:U})},0)}}catch{}},[w]);const k=()=>{let U="";const z=f||[];z.length>0?U=z.map((ie,te)=>{const ye=ie.startTime.replace(".",","),ue=ie.endTime.replace(".",",");return`${te+1}
${ye} --> ${ue}
${ie.text}
`}).join(`
`):U=`1
00:00:00,000 --> 00:00:05,000
${w}`;const L=new Blob([U],{type:"text/plain"}),D=URL.createObjectURL(L),G=document.createElement("a");G.href=D;const q=b?b.replace(/\.[^/.]+$/,""):"transcription";G.download=`${q}.srt`,G.click(),URL.revokeObjectURL(D)},P=U=>{if(U.preventDefault(),U.stopPropagation(),U.dataTransfer.items&&U.dataTransfer.items.length>0){const z=U.dataTransfer.items[0].type;(z.startsWith("audio/")||z==="video/mp4")&&m(!0)}},M=U=>{U.preventDefault(),U.stopPropagation(),m(!1)},H=U=>{var L;U.preventDefault(),U.stopPropagation(),m(!1);const z=(L=U.dataTransfer.files)==null?void 0:L[0];z&&(z.type.startsWith("audio/")||z.type==="video/mp4")&&E(z)},W=U=>{U.stopPropagation(),I({audioBase64:null,mimeType:null,fileName:null})},O=()=>T?b!=null&&b.endsWith(".mp4")||T.startsWith("video/")?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{d:"M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.414z",clipRule:"evenodd"})}):null;return o.jsxs("div",{className:`flex flex-col h-full space-y-2 rounded-md transition-all duration-200 ${g?"ring-2 ring-blue-400":""}`,onDragOver:P,onDragLeave:M,onDrop:H,children:[o.jsx("input",{type:"file",ref:d,onChange:R,accept:"audio/*,video/mp4",className:"hidden"}),o.jsxs("div",{className:"flex flex-col gap-1 flex-shrink-0",children:[o.jsxs("button",{onClick:N,disabled:h||_,className:"w-full px-4 py-2 font-bold text-white bg-cyan-600 hover:bg-cyan-500 rounded-md disabled:bg-gray-700 disabled:text-gray-500 transition-colors text-sm flex items-center justify-center gap-2",children:[_?o.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),n(_?"node.content.convertingVideo":"node.content.uploadAudio")]}),o.jsxs("div",{className:`text-center text-[10px] p-1 bg-gray-900/30 rounded truncate flex items-center justify-between gap-1 h-6 relative ${b?"text-cyan-400 font-medium":"text-gray-500"}`,children:[o.jsxs("div",{className:"flex items-center justify-center w-full gap-1 truncate px-4",children:[b&&O(),o.jsx("span",{className:"truncate",children:_?n("node.content.convertingVideo"):b?`${b}`:n("node.content.noAudioLoaded")})]}),b&&!_&&o.jsx("button",{onClick:W,className:"absolute right-1 top-1/2 -translate-y-1/2 p-0.5 hover:text-red-400 text-gray-500 rounded-full transition-colors flex items-center justify-center",title:"Remove file",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),o.jsxs("button",{onClick:h?s:A,disabled:i||!C||_,className:`w-full px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 flex-shrink-0 flex items-center justify-center gap-2 ${i?"bg-yellow-600":h?"bg-cyan-600 hover:bg-cyan-500":"bg-emerald-600 hover:bg-emerald-500 disabled:bg-gray-700 disabled:text-gray-500"}`,children:[h&&!i?o.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),n(i?"node.action.stopping":h?"node.content.transcribing":"node.content.transcribe")]}),o.jsx("textarea",{value:w,onChange:U=>I({transcription:U.target.value}),onMouseDown:U=>U.stopPropagation(),onFocus:l,placeholder:n("node.content.transcriptionPlaceholder"),className:"w-full flex-grow p-2 bg-gray-700 border border-transparent rounded-md resize-none focus:border-emerald-500 focus:ring-0 focus:outline-none custom-scrollbar",onWheel:U=>U.stopPropagation()}),w&&o.jsxs("button",{onClick:k,className:"w-full px-4 py-2 font-bold text-white bg-cyan-600 rounded-md hover:bg-cyan-700 transition-colors duration-200 flex items-center justify-center gap-2 flex-shrink-0",title:n("node.action.downloadSRT"),children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),o.jsx("span",{children:n("node.action.downloadSRT")})]})]})},jr=x.forwardRef(({label:e,text:t,translatedText:n,isCritical:r,isEnabled:a=!0,isMandatory:i=!1,onToggle:s,color:l="emerald",className:c="",index:d},h)=>{const[g,m]=x.useState(!1);let _="",y="",v="",C="",w="",b="";if(!a)_="bg-gray-800/20",y="border-gray-700",v="text-gray-500",C="bg-gray-700",w="text-gray-500",b="bg-gray-800 text-gray-600";else if(r)_="bg-red-900/20",y="border-red-800/50",v="text-red-400",C="bg-red-500",w="text-gray-300",b="bg-red-900/50 text-red-200";else if(i)_="bg-gray-800",y="border-gray-600",v="text-emerald-400",C="bg-gray-500",w="text-gray-300",b="bg-gray-700 text-gray-400";else switch(w="text-gray-300",l){case"cyan":_="bg-cyan-900/20",y="border-cyan-700/50",v="text-cyan-400",C="bg-cyan-500",b="bg-cyan-900/50 text-cyan-200";break;case"red":_="bg-red-900/20",y="border-red-700/50",v="text-red-400",C="bg-red-500",b="bg-red-900/50 text-red-200";break;default:_="bg-emerald-900/20",y="border-emerald-700/50",v="text-emerald-400",C="bg-emerald-500",b="bg-emerald-900/50 text-emerald-200"}const f=T=>{T.stopPropagation(),navigator.clipboard.writeText(t),m(!0),setTimeout(()=>m(!1),1500)};return o.jsxs("div",{ref:h,onMouseDown:T=>T.stopPropagation(),onClick:()=>!i&&s&&s(),className:`flex flex-row p-2 rounded border text-xs transition-all relative overflow-hidden group select-none items-stretch gap-3 ${_} ${y} ${c} flex-shrink-0 ${i?"":"cursor-pointer hover:border-opacity-100 hover:shadow-sm"} duration-300`,children:[d!==void 0&&o.jsxs("div",{className:"flex-shrink-0 w-6 flex flex-col items-center justify-start pt-0.5",children:[o.jsx("div",{className:`text-[9px] font-mono font-bold w-5 h-5 flex items-center justify-center rounded-full ${b}`,children:d}),o.jsx("div",{className:`w-px flex-grow mt-1 ${a?"bg-gray-700":"bg-transparent"}`})]}),o.jsxs("div",{className:"flex flex-col flex-grow min-w-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[d===void 0&&o.jsx("div",{className:`w-1.5 h-1.5 rounded-full flex-shrink-0 ${C}`}),o.jsx("div",{className:`font-bold uppercase tracking-wider text-[10px] leading-tight ${v}`,children:e})]}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx("button",{onClick:f,className:`p-0.5 rounded transition-colors ${a?"text-gray-500 hover:text-white":"text-gray-600 hover:text-gray-400"}`,title:"Copy Prompt Text",children:g?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})})]}),o.jsx("div",{className:`leading-tight ${a?"text-gray-300":"text-gray-600"} text-[10px] mb-1`,children:t}),n&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-gray-600/30 my-1 w-full"}),o.jsx("div",{className:`text-[9px] italic leading-tight ${w} opacity-70`,children:n})]})]}),o.jsx("div",{className:`absolute bottom-0 left-0 w-full h-[2px] opacity-30 ${C}`})]})}),Q5=({uiState:e,onUpdateUiState:t,mode:n,t:r,includeHashtags:a=!0,onToggleHashtags:i,generateThumbnail:s=!1,onToggleThumbnail:l})=>{let c=0;return o.jsxs("div",{className:"border border-gray-600 hover:border-gray-400 rounded-md bg-gray-900 overflow-hidden flex-shrink-0 flex flex-col transition-colors duration-200",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>t({isSettingsCollapsed:!e.isSettingsCollapsed}),children:[o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:r("node.content.activePromptStack")}),o.jsx("div",{className:"text-gray-400",children:e.isSettingsCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!e.isSettingsCollapsed&&o.jsxs("div",{className:"p-2 bg-gray-800/20 flex flex-col gap-1 overflow-y-auto custom-scrollbar max-h-64",onWheel:d=>d.stopPropagation(),children:[o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"1. Context"}),o.jsx(jr,{label:r(`instruction.${At.ROLE.id}`),text:At.ROLE.text,translatedText:r(`instruction.desc.${At.ROLE.id}`),isMandatory:!0,color:"red",index:++c}),o.jsx(jr,{label:r(`instruction.${At.INPUT_CONTEXT.id}`),text:At.INPUT_CONTEXT.text,translatedText:r(`instruction.desc.${At.INPUT_CONTEXT.id}`),isMandatory:!0,color:"gray",index:++c})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"2. Strategy"}),n==="title"&&o.jsxs(o.Fragment,{children:[o.jsx(jr,{label:r(`instruction.${At.TITLE_MODE_RULES.id}`),text:At.TITLE_MODE_RULES.text,translatedText:r(`instruction.desc.${At.TITLE_MODE_RULES.id}`),isMandatory:!0,color:"cyan",index:++c}),o.jsx(jr,{label:r(`instruction.${At.HASHTAGS.id}`),text:At.HASHTAGS.text,translatedText:r(`instruction.desc.${At.HASHTAGS.id}`),isEnabled:a,onToggle:i,color:"emerald",index:a?++c:void 0}),o.jsx(jr,{label:r(`instruction.${At.THUMBNAIL.id}`),text:At.THUMBNAIL.text,translatedText:r(`instruction.desc.${At.THUMBNAIL.id}`),isEnabled:s,onToggle:l,color:"emerald",index:s?++c:void 0})]}),n==="channel"&&o.jsx(jr,{label:r(`instruction.${At.CHANNEL_MODE_RULES.id}`),text:At.CHANNEL_MODE_RULES.text,translatedText:r(`instruction.desc.${At.CHANNEL_MODE_RULES.id}`),isMandatory:!0,color:"cyan",index:++c})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"3. Output Format"}),o.jsx(jr,{label:r(`instruction.${At.FORMAT.id}`),text:At.FORMAT.text,translatedText:r(`instruction.desc.${At.FORMAT.id}`),isMandatory:!0,color:"gray",index:++c})]})]})]})},eI=[{code:"ru",label:"RU"},{code:"en",label:"EN"},{code:"es",label:"ES"},{code:"fr",label:"FR"},{code:"de",label:"DE"},{code:"it",label:"IT"},{code:"pt",label:"PT"},{code:"zh",label:"ZH"},{code:"ja",label:"JA"},{code:"ko",label:"KO"}],tI={ru:"",en:"English",es:"Espaol",fr:"Franais",de:"Deutsch",it:"Italiano",pt:"Portugus",zh:"",ja:"",ko:""},nI=({node:e,onValueChange:t,t:n,deselectAllNodes:r,connectedInputs:a,onGenerateYouTubeTitles:i,isGeneratingYouTubeTitles:s,onGenerateYouTubeChannelInfo:l,isGeneratingYouTubeChannelInfo:c,isStopping:d,onStopGeneration:h,addToast:g})=>{const m=s||c,_=a==null?void 0:a.has(void 0),y=x.useMemo(()=>{try{const O=JSON.parse(e.value||"{}"),U=O.targetLanguages||{ru:!0,en:!1},z=O.languageSelectionOrder||Object.keys(U).filter(L=>U[L]);return{mode:O.mode||"title",idea:O.idea||"",targetLanguages:U,generatedTitleOutputs:O.generatedTitleOutputs||{},generatedChannelOutputs:O.generatedChannelOutputs||{},languageSelectionOrder:z,includeHashtags:O.includeHashtags!==!1,generateThumbnail:O.generateThumbnail!==!1,uiState:O.uiState||{isSettingsCollapsed:!0}}}catch{return{mode:"title",idea:"",targetLanguages:{ru:!0,en:!1},generatedTitleOutputs:{},generatedChannelOutputs:{},languageSelectionOrder:["ru"],includeHashtags:!0,generateThumbnail:!0,uiState:{isSettingsCollapsed:!0}}}},[e.value]),{mode:v,idea:C,targetLanguages:w,generatedTitleOutputs:b,generatedChannelOutputs:f,languageSelectionOrder:T,includeHashtags:I,generateThumbnail:E,uiState:R}=y,N=O=>{t(e.id,JSON.stringify({...y,...O}))},A=O=>{N({uiState:{...R,...O}})},k=O=>{const U=!!w[O];let z={...w},L=[...T||[]];if(U)z[O]=!1,L=L.filter(D=>D!==O);else{for(;L.length>=2;){const D=L.shift();D&&(z[D]=!1)}z[O]=!0,L.push(O)}N({targetLanguages:z,languageSelectionOrder:L})},P=O=>{O&&(navigator.clipboard.writeText(O),g(n("toast.copied"),"success"))},M=()=>{v==="title"&&i?i(e.id):l&&l(e.id)},H=Object.entries(w).filter(([,O])=>O).map(([O])=>O),W=O=>{const U=v==="title",z=U?b[O]||{}:f[O]||{},L=tI[O]||O.toUpperCase(),D=U?[{key:"title",label:n("youtube_title_generator.title")},{key:"description",label:n("youtube_title_generator.description")},{key:"tags",label:n("youtube_title_generator.tags")},...E?[{key:"thumbnailPrompt",label:n("node.content.thumbnailPrompt")}]:[]]:[{key:"channelName",label:n("youtube_title_generator.channelName")},{key:"channelDescription",label:n("youtube_title_generator.channelDescription")},{key:"channelKeywords",label:n("youtube_title_generator.channelKeywords")},{key:"channelHandle",label:n("youtube_title_generator.channelHandle")}];return o.jsxs("div",{className:"flex flex-col flex-1 min-h-0 space-y-2 min-w-0 h-full",children:[o.jsx("h4",{className:"font-semibold text-gray-300 text-sm border-b border-gray-700/50 pb-1 flex-shrink-0",children:L}),o.jsx("div",{className:"flex-grow flex flex-col min-h-0 space-y-2 pr-1",children:D.map(G=>{let q="flex-1";return G.key==="description"||G.key==="channelDescription"?q="flex-[4]":G.key==="thumbnailPrompt"&&(q="flex-[2]"),o.jsxs("div",{className:`flex flex-col w-full min-h-[60px] ${q}`,children:[o.jsxs("div",{className:"flex justify-between items-center mb-1 shrink-0",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:G.label}),o.jsx(Ie,{title:n("node.action.copy"),onClick:()=>P(z[G.key]||""),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{readOnly:!0,value:z[G.key]||"",className:"w-full p-2 bg-gray-900/50 rounded-md resize-none custom-scrollbar focus:border-emerald-500 focus:ring-0 focus:outline-none border border-transparent h-full",onMouseDown:ie=>ie.stopPropagation(),onFocus:r})]},G.key)})})]},O)};return o.jsxs("div",{className:"flex flex-col h-full space-y-2",onWheel:O=>O.stopPropagation(),children:[o.jsx("textarea",{value:C,onChange:O=>N({idea:O.target.value}),placeholder:n(_?"node.content.connectedPlaceholder":v==="title"?"youtube_title_generator.ideaPlaceholder":"youtube_title_generator.channelIdeaPlaceholder"),disabled:_||m,className:"w-full p-2 bg-gray-700 border border-transparent rounded-md resize-y focus:border-emerald-500 focus:ring-0 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar min-h-[60px] max-h-[120px] flex-shrink-0",rows:2,onMouseDown:O=>O.stopPropagation(),onFocus:r}),o.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-2",children:[o.jsxs("div",{className:"flex items-center bg-gray-700 rounded-md p-1 space-x-1 h-10",children:[o.jsx("button",{onClick:()=>N({mode:"title"}),className:`px-2 py-1 rounded text-xs font-semibold h-full ${v==="title"?"bg-emerald-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:n("youtube_title_generator.mode.title")}),o.jsx("button",{onClick:()=>N({mode:"channel"}),className:`px-2 py-1 rounded text-xs font-semibold h-full ${v==="channel"?"bg-emerald-600 text-white":"text-gray-300 hover:bg-gray-600"}`,children:n("youtube_title_generator.mode.channel")})]}),v==="title"&&o.jsxs("div",{className:"flex items-center bg-gray-700 rounded-md px-2 space-x-2 h-10 border border-gray-600 flex-shrink-0",title:n("node.content.thumbnailPrompt"),children:[o.jsx(ft,{id:`gen-thumb-${e.id}`,checked:E,onChange:O=>N({generateThumbnail:O}),disabled:m,className:"h-4 w-4"}),o.jsx("label",{htmlFor:`gen-thumb-${e.id}`,className:"text-xs text-gray-300 select-none cursor-pointer font-medium",children:"Cover"})]}),o.jsxs("button",{onClick:m?h:M,disabled:d||!m&&!C.trim()&&!_,className:`flex-grow flex-shrink-0 h-10 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 flex items-center justify-center gap-2 ${d?"bg-yellow-600 hover:bg-yellow-500":m?"bg-cyan-600 hover:bg-cyan-500":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-500"}`,children:[m?o.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):!d&&o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),o.jsx("span",{children:n(d?"node.action.stopping":m?"node.content.generating":"node.content.generateText")})]})]}),o.jsx(Q5,{uiState:R,onUpdateUiState:A,mode:v,t:n,includeHashtags:I,onToggleHashtags:()=>N({includeHashtags:!I}),generateThumbnail:E,onToggleThumbnail:()=>N({generateThumbnail:!E})}),o.jsx("div",{className:"flex-shrink-0 bg-gray-700/50 p-1 rounded-md border border-gray-600/30",children:o.jsx("div",{className:"flex flex-wrap gap-1",children:eI.map(O=>o.jsx(lt,{title:n(`languages.${O.code}`),position:"top",className:"flex-1",children:o.jsx("button",{onClick:()=>k(O.code),className:`w-full min-w-[30px] py-1 rounded text-[10px] font-bold uppercase transition-colors ${w[O.code]?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-600 hover:text-gray-200"}`,children:O.label})},O.code))})}),o.jsx("div",{className:"flex flex-row flex-grow min-h-0 space-x-2",children:H.map(O=>W(O))})]})},Lr=x.forwardRef(({label:e,text:t,translatedText:n,isCritical:r,isEnabled:a=!0,isMandatory:i=!1,onToggle:s,color:l="emerald",className:c="",index:d},h)=>{const[g,m]=x.useState(!1);let _="",y="",v="",C="",w="",b="";if(!a)_="bg-gray-800/20",y="border-gray-700",v="text-gray-500",C="bg-gray-700",w="text-gray-500",b="bg-gray-800 text-gray-600";else if(r)_="bg-red-900/20",y="border-red-800/50",v="text-red-400",C="bg-red-500",w="text-gray-300",b="bg-red-900/50 text-red-200";else if(i)_="bg-gray-800",y="border-gray-600",v="text-emerald-400",C="bg-gray-500",w="text-gray-300",b="bg-gray-700 text-gray-400";else switch(w="text-gray-300",l){case"cyan":_="bg-cyan-900/20",y="border-cyan-700/50",v="text-cyan-400",C="bg-cyan-500",b="bg-cyan-900/50 text-cyan-200";break;default:_="bg-emerald-900/20",y="border-emerald-700/50",v="text-emerald-400",C="bg-emerald-500",b="bg-emerald-900/50 text-emerald-200"}const f=T=>{T.stopPropagation(),navigator.clipboard.writeText(t),m(!0),setTimeout(()=>m(!1),1500)};return o.jsxs("div",{ref:h,onMouseDown:T=>T.stopPropagation(),onClick:()=>!i&&s&&s(),className:`flex flex-row p-2 rounded border text-xs transition-all relative overflow-hidden group select-none items-stretch gap-3 ${_} ${y} ${c} flex-shrink-0 ${i?"":"cursor-pointer hover:border-opacity-100 hover:shadow-sm"} duration-300`,children:[d!==void 0&&o.jsxs("div",{className:"flex-shrink-0 w-6 flex flex-col items-center justify-start pt-0.5",children:[o.jsx("div",{className:`text-[9px] font-mono font-bold w-5 h-5 flex items-center justify-center rounded-full ${b}`,children:d}),o.jsx("div",{className:`w-px flex-grow mt-1 ${a?"bg-gray-700":"bg-transparent"}`})]}),o.jsxs("div",{className:"flex flex-col flex-grow min-w-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[d===void 0&&o.jsx("div",{className:`w-1.5 h-1.5 rounded-full flex-shrink-0 ${C}`}),o.jsx("div",{className:`font-bold uppercase tracking-wider text-[10px] leading-tight ${v}`,children:e})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:f,className:`p-0.5 rounded transition-colors ${a?"text-gray-500 hover:text-white":"text-gray-600 hover:text-gray-400"}`,title:"Copy Prompt Text",children:g?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),!i&&o.jsx("div",{className:`text-[9px] uppercase font-mono px-1 rounded ${a?"text-white bg-white/10":"text-gray-600 bg-black/20"}`,children:a?"ON":"OFF"})]})]}),o.jsx("div",{className:`leading-tight ${a?"text-gray-300":"text-gray-600"} text-[10px] mb-1`,children:t}),n&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"border-t border-gray-600/30 my-1 w-full"}),o.jsx("div",{className:`text-[9px] italic leading-tight ${w} opacity-70`,children:n})]})]}),o.jsx("div",{className:`absolute bottom-0 left-0 w-full h-[2px] opacity-30 ${C}`})]})}),oI=({uiState:e,onUpdateUiState:t,generateLyrics:n,onToggleGenerateLyrics:r,verseCount:a,onVerseCountChange:i,model:s,t:l})=>{let c=0;const d=h=>h==="gemini-3-flash-preview"?"Gemini 3 Flash Preview":h==="gemini-3-pro-preview"?"Gemini 3 Pro Preview":h;return o.jsxs("div",{className:"border border-gray-600 hover:border-gray-400 rounded-md bg-gray-900 overflow-hidden flex-shrink-0 flex flex-col transition-colors duration-200",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 cursor-pointer select-none hover:bg-gray-700/50 transition-colors flex-shrink-0",onClick:()=>t({isSettingsCollapsed:!e.isSettingsCollapsed}),children:[o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:l("node.content.activePromptStack")}),o.jsx("div",{className:"text-gray-400",children:e.isSettingsCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!e.isSettingsCollapsed&&o.jsxs("div",{className:"p-2 bg-gray-800/20 flex flex-col gap-1 overflow-y-auto custom-scrollbar max-h-64",onWheel:h=>h.stopPropagation(),children:[o.jsx(Lr,{label:l("node.content.model"),text:d(s),isMandatory:!0,color:"gray",className:"mb-2"}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"1. Context"}),o.jsx(Lr,{label:l(`instruction.${Vt.ROLE.id}`),text:Vt.ROLE.text,translatedText:l(`instruction.desc.${Vt.ROLE.id}`),isMandatory:!0,color:"emerald",index:++c}),o.jsx(Lr,{label:l(`instruction.${Vt.INPUT_CONTEXT.id}`),text:Vt.INPUT_CONTEXT.text,translatedText:l(`instruction.desc.${Vt.INPUT_CONTEXT.id}`),isMandatory:!0,color:"gray",index:++c})]}),o.jsxs("div",{className:"space-y-1 mb-3",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"2. Generation Rules"}),o.jsx(Lr,{label:l(`instruction.${Vt.CREATIVE_RULE.id}`),text:Vt.CREATIVE_RULE.text,translatedText:l(`instruction.desc.${Vt.CREATIVE_RULE.id}`),isMandatory:!0,color:"cyan",index:++c}),o.jsx(Lr,{label:l(`instruction.${Vt.MUSIC_PROMPT_RULE.id}`),text:Vt.MUSIC_PROMPT_RULE.text,translatedText:l(`instruction.desc.${Vt.MUSIC_PROMPT_RULE.id}`),isMandatory:!0,color:"cyan",index:++c}),o.jsx(Lr,{label:l(`instruction.${Vt.LYRICS_RULE.id}`),text:Vt.LYRICS_RULE.text,translatedText:l(`instruction.desc.${Vt.LYRICS_RULE.id}`),isEnabled:n,onToggle:r,color:"emerald",index:n?++c:void 0}),n&&o.jsxs("div",{className:"flex flex-row p-2 rounded border border-gray-700 text-xs transition-all relative overflow-hidden group select-none items-center gap-3 bg-emerald-900/20 flex-shrink-0",children:[o.jsx("div",{className:"flex-shrink-0 w-6 flex flex-col items-center justify-start pt-0.5",children:o.jsx("div",{className:"text-[9px] font-mono font-bold w-5 h-5 flex items-center justify-center rounded-full bg-emerald-900/50 text-emerald-200",children:++c})}),o.jsxs("div",{className:"flex-grow min-w-0 flex items-center justify-between",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsx("div",{className:"font-bold uppercase tracking-wider text-[10px] leading-tight text-emerald-400",children:l(`instruction.${Vt.VERSE_COUNT_RULE.id}`)}),o.jsx("div",{className:"text-[10px] text-gray-400 mt-1",children:Vt.VERSE_COUNT_RULE.text.replace("{N}",a.toString())})]}),o.jsx("input",{type:"number",min:"1",max:"20",value:a,onChange:h=>i(Math.max(1,parseInt(h.target.value)||1)),className:"w-12 h-6 bg-gray-800 border border-gray-600 rounded text-center text-white text-xs focus:outline-none focus:ring-1 focus:ring-emerald-500",onClick:h=>h.stopPropagation(),onMouseDown:h=>h.stopPropagation()})]})]})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("h6",{className:"text-[9px] font-bold text-gray-500 uppercase px-1 border-b border-gray-700/50 pb-0.5",children:"3. Output Format"}),o.jsx(Lr,{label:l(`instruction.${Vt.FORMAT.id}`),text:Vt.FORMAT.text,translatedText:l(`instruction.desc.${Vt.FORMAT.id}`),isMandatory:!0,color:"gray",index:++c})]})]})]})},rI=[{code:"ru",label:"RU"},{code:"en",label:"EN"},{code:"es",label:"ES"},{code:"fr",label:"FR"},{code:"de",label:"DE"},{code:"it",label:"IT"},{code:"pt",label:"PT"},{code:"zh",label:"ZH"},{code:"ja",label:"JA"},{code:"ko",label:"KO"}],aI={ru:"",en:"English",es:"Espaol",fr:"Franais",de:"Deutsch",it:"Italiano",pt:"Portugus",zh:"",ja:"",ko:""},iI=({node:e,onValueChange:t,t:n,deselectAllNodes:r,connectedInputs:a,onGenerateMusicIdeas:i,isGeneratingMusicIdeas:s,isStopping:l,onStopGeneration:c,addToast:d})=>{const h=s,g=a==null?void 0:a.has(void 0),m=x.useMemo(()=>{try{const O=JSON.parse(e.value||"{}"),U=O.targetLanguages||{ru:!0,en:!1},z=O.languageSelectionOrder||Object.keys(U).filter(L=>U[L]);return{generateLyrics:O.generateLyrics??!0,verseCount:O.verseCount||2,idea:O.idea||"",targetLanguages:U,generatedLyrics:O.generatedLyrics||{},generatedMusicPrompts:O.generatedMusicPrompts||{},generatedTitles:O.generatedTitles||{},languageSelectionOrder:z,model:O.model||"gemini-3-flash-preview",uiState:O.uiState||{isSettingsCollapsed:!0}}}catch{return{generateLyrics:!0,verseCount:2,idea:"",targetLanguages:{ru:!0,en:!1},generatedLyrics:{},generatedMusicPrompts:{},generatedTitles:{},languageSelectionOrder:["ru"],model:"gemini-3-flash-preview",uiState:{isSettingsCollapsed:!0}}}},[e.value]),{generateLyrics:_,verseCount:y,idea:v,targetLanguages:C,generatedLyrics:w,generatedMusicPrompts:b,generatedTitles:f,languageSelectionOrder:T,model:I,uiState:E}=m,R=O=>{t(e.id,JSON.stringify({...m,...O}))},N=O=>{R({uiState:{...E,...O}})},A=O=>{const U=!!C[O];let z={...C},L=[...T||[]];if(U)z[O]=!1,L=L.filter(D=>D!==O);else{for(;L.length>=2;){const D=L.shift();D&&(z[D]=!1)}z[O]=!0,L.push(O)}R({targetLanguages:z,languageSelectionOrder:L})},k=O=>{O&&(navigator.clipboard.writeText(O),d(n("toast.copied"),"success"))},P=()=>{i&&i(e.id)},M=O=>{const U=f[O]||"Untitled",z=w[O]||"",L=b[O]||"",D=`Title: ${U}

--- Music Prompt ---
${L}

--- Lyrics ---
${z}`,G=new Date,q=`${G.getFullYear()}-${String(G.getMonth()+1).padStart(2,"0")}-${String(G.getDate()).padStart(2,"0")}_${String(G.getHours()).padStart(2,"0")}-${String(G.getMinutes()).padStart(2,"0")}`,ie=U.replace(/[^a-z0-9-\s-_]/gi,"").trim().replace(/\s+/g,"_")||"Song",te=new Blob([D],{type:"text/plain"}),ye=URL.createObjectURL(te),ue=document.createElement("a");ue.href=ye,ue.download=`${ie}_${q}.txt`,ue.click(),URL.revokeObjectURL(ye),d("TXT Saved","success")},H=Object.entries(C).filter(([,O])=>O).map(([O])=>O),W=()=>H.length===0?null:o.jsx("div",{className:"flex flex-row flex-grow min-h-0 space-x-2",children:H.map(O=>{const U=w[O]||"",z=b[O]||"",L=f[O]||"",D=aI[O]||O.toUpperCase();return o.jsxs("div",{className:"flex flex-col flex-1 min-h-0 space-y-2",children:[o.jsxs("div",{className:"flex justify-between items-center flex-shrink-0 border-b border-gray-700/50 pb-1",children:[o.jsx("h4",{className:"font-semibold text-gray-300 text-sm",children:D}),o.jsx(Ie,{title:"Download TXT",onClick:()=>M(O),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})})]}),o.jsxs("div",{className:"flex flex-col flex-shrink-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:n("music_idea_generator.songTitle")}),o.jsx(Ie,{title:n("node.action.copy"),onClick:()=>k(L),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{readOnly:!0,value:L,placeholder:n("music_idea_generator.songTitlePlaceholder"),className:"w-full p-2 bg-gray-900/50 rounded-md resize-none custom-scrollbar focus:outline-none focus:ring-1 focus:ring-emerald-500 selection:bg-emerald-500 selection:text-white",rows:1})]}),_&&o.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:n("music_idea_generator.mode.lyrics")}),o.jsx(Ie,{title:n("node.action.copy"),onClick:()=>k(U),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{readOnly:!0,value:U,placeholder:n("music_idea_generator.lyricsPlaceholder"),className:"w-full flex-grow p-2 bg-gray-900/50 rounded-md resize-none custom-scrollbar focus:outline-none focus:ring-1 focus:ring-emerald-500 selection:bg-emerald-500 selection:text-white"})]}),o.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-xs font-medium text-gray-400",children:n("music_idea_generator.mode.music_prompt")}),o.jsx(Ie,{title:n("node.action.copy"),onClick:()=>k(z),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("textarea",{readOnly:!0,value:z,placeholder:n("music_idea_generator.musicPromptPlaceholder"),className:"w-full flex-grow p-2 bg-gray-900/50 rounded-md resize-none custom-scrollbar focus:outline-none focus:ring-1 focus:ring-emerald-500 selection:bg-emerald-500 selection:text-white"})]})]},O)})});return o.jsxs("div",{className:"flex flex-col h-full space-y-2",onWheel:O=>O.stopPropagation(),children:[o.jsx("textarea",{value:v,onChange:O=>R({idea:O.target.value}),placeholder:n(g?"node.content.connectedPlaceholder":"music_idea_generator.ideaPlaceholder"),disabled:g||h,className:"w-full p-2 bg-gray-700 border border-transparent rounded-md resize-y min-h-[60px] max-h-[120px] focus:border-emerald-500 focus:outline-none disabled:bg-gray-800 disabled:text-gray-500 custom-scrollbar selection:bg-emerald-500 selection:text-white flex-shrink-0 transition-colors",rows:2,onMouseDown:O=>O.stopPropagation(),onFocus:r}),o.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 h-10",children:[o.jsxs("div",{className:"flex w-36 flex-shrink-0 gap-1 select-none bg-gray-900/50 rounded-lg p-0.5 h-full",children:[o.jsx(lt,{title:n("tooltip.model.flash"),position:"top",className:"h-full flex-1",children:o.jsx("button",{onClick:()=>R({model:"gemini-3-flash-preview"}),className:`w-full h-full text-[10px] font-bold text-center transition-colors rounded-md flex items-center justify-center ${I==="gemini-3-flash-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:"FLASH"})}),o.jsx(lt,{title:n("tooltip.model.pro"),position:"top",className:"h-full flex-1",children:o.jsx("button",{onClick:()=>R({model:"gemini-3-pro-preview"}),className:`w-full h-full text-[10px] font-bold text-center transition-colors rounded-md flex items-center justify-center ${I==="gemini-3-pro-preview"?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:"PRO"})})]}),o.jsx(lt,{title:n("music_idea_generator.mode.lyrics"),position:"top",children:o.jsx("button",{onClick:()=>R({generateLyrics:!_}),className:`w-10 h-10 rounded-md flex items-center justify-center transition-colors border ${_?"bg-emerald-600 border-emerald-500 text-white shadow-sm":"bg-gray-700 border-gray-600 text-gray-400 hover:text-white hover:border-gray-500"}`,title:n("music_idea_generator.mode.lyrics"),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})}),_&&o.jsxs("div",{className:"flex items-center bg-gray-900/50 rounded-lg p-0.5 border border-gray-700/50 h-full",title:n("node.content.verseCount"),children:[o.jsx("span",{className:"text-[9px] text-gray-500 px-1 font-bold select-none",children:"V:"}),o.jsx("input",{type:"number",min:"1",max:"12",value:y,onChange:O=>R({verseCount:Math.max(1,parseInt(O.target.value)||1)}),className:"w-8 h-full bg-transparent text-center text-xs text-white outline-none font-mono",onMouseDown:O=>O.stopPropagation()})]}),o.jsxs("button",{onClick:h?c:P,disabled:l||!h&&!v.trim()&&!g,className:`flex-grow h-10 px-4 py-2 font-bold text-white rounded-md transition-colors duration-200 flex items-center justify-center gap-2 ${l?"bg-yellow-600":h?"bg-cyan-600 hover:bg-cyan-700":"bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed"}`,children:[h?o.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):!l&&o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})}),o.jsx("span",{children:n(l?"node.action.stopping":h?"node.content.generating":"node.content.generateText")})]})]}),o.jsx(oI,{uiState:E,onUpdateUiState:N,generateLyrics:_,onToggleGenerateLyrics:()=>R({generateLyrics:!_}),verseCount:y,onVerseCountChange:O=>R({verseCount:O}),model:I,t:n}),o.jsx("div",{className:"flex-shrink-0 bg-gray-700/50 p-1.5 rounded-md border border-gray-600/30",children:o.jsx("div",{className:"flex flex-wrap gap-1",children:rI.map(O=>o.jsx(lt,{title:n(`languages.${O.code}`),position:"top",className:"flex-1",children:o.jsx("button",{onClick:()=>A(O.code),className:`w-full min-w-[30px] py-1 px-2 rounded text-[10px] font-bold uppercase transition-colors ${C[O.code]?"bg-emerald-600 text-white shadow-sm":"bg-gray-800 text-gray-400 hover:bg-gray-600 hover:text-gray-200"}`,children:O.label})},O.code))})}),W()]})},xg={idea:"bg-gray-600",scripting:"bg-yellow-600",filming:"bg-cyan-600",published:"bg-emerald-600"},sI=["indigo","orange","emerald","cyan","pink","red"],lI=({active:e,x:t,y:n,onComplete:r})=>{const a=x.useRef(null);return x.useEffect(()=>{if(!e||!a.current)return;const i=a.current.getContext("2d");if(!i)return;let s=[];const l=["#FFD700","#FFC107","#3498DB","#2980B9","#FFFFFF"];for(let h=0;h<50;h++)s.push({x:t,y:n,vx:(Math.random()-.5)*10,vy:(Math.random()-1)*10-5,color:l[Math.floor(Math.random()*l.length)],size:Math.random()*5+2,life:100});let c;const d=()=>{if(!i||!a.current)return;i.clearRect(0,0,a.current.width,a.current.height);let h=!1;s.forEach(g=>{g.life>0&&(h=!0,g.x+=g.vx,g.y+=g.vy,g.vy+=.5,g.life-=2,i.fillStyle=g.color,i.fillRect(g.x,g.y,g.size,g.size))}),h?c=requestAnimationFrame(d):r()};return d(),()=>cancelAnimationFrame(c)},[e,t,n,r]),e?o.jsx("canvas",{ref:a,className:"absolute inset-0 pointer-events-none z-50",width:window.innerWidth,height:window.innerHeight}):null},cI=({channels:e,activeChannelIds:t,schedule:n,onUpdateActiveChannels:r,onUpdateSchedule:a,disciplinePoints:i,globalGoals:s,habitCompletions:l,onUpdatePoints:c,onUpdateGoals:d,onUpdateHabitCompletions:h,t:g})=>{const[m,_]=x.useState(new Date),[y,v]=x.useState(new Date().toISOString().split("T")[0]),[C,w]=x.useState({active:!1,x:0,y:0}),[b,f]=x.useState(0),[T,I]=x.useState(!1),[E,R]=x.useState(""),[N,A]=x.useState(180),[k,P]=x.useState([]),[M,H]=x.useState(""),[W,O]=x.useState("indigo"),U=(F,Y)=>new Date(F,Y+1,0).getDate(),z=(F,Y)=>new Date(F,Y,1).getDay(),L=m.getFullYear(),D=m.getMonth(),G=U(L,D),q=z(L,D),ie=Array.from({length:q},(F,Y)=>Y),te=Array.from({length:G},(F,Y)=>Y+1),ye=m.toLocaleString("default",{month:"long"}),ue=()=>{M.trim()&&(P([...k,M.trim()]),H(""))},$=()=>{if(!E.trim())return;const F=new Date,Y=new Date;Y.setDate(F.getDate()+N);const K={id:`goal-${Date.now()}`,title:E,color:W,startDate:F.toISOString().split("T")[0],endDate:Y.toISOString().split("T")[0],habits:k};d([...s,K]),R(""),P([]),I(!1),f(20),setTimeout(()=>f(0),1e3)},ee=F=>{d(s.filter(Y=>Y.id!==F))},Te=F=>{const Y=`${L}-${String(D+1).padStart(2,"0")}-${String(F).padStart(2,"0")}`;v(Y)},le=F=>{r([F])},J=(F,Y,K)=>{w({active:!0,x:F,y:Y}),c(i+K),f(K),setTimeout(()=>f(0),1e3)},ge=(F,Y,K)=>{const V=`${Y}-${K}`,oe=l[y]||{},de=!!oe[V],Z={...oe,[V]:!de};if(h({...l,[y]:Z}),!de){const Q=F.target.getBoundingClientRect();J(Q.left+Q.width/2,Q.top+Q.height/2,10)}},ae=(F,Y)=>{const V=(n[y]||[]).map(oe=>oe.id===F?{...oe,isCompleted:Y}:oe);a({...n,[y]:V}),Y&&J(window.innerWidth/2,window.innerHeight/2,50)},ce=()=>{const F={id:`task-${Date.now()}`,channelId:t.length>0?t[0]:void 0,title:"",status:"idea",isCompleted:!1},Y=n[y]||[];a({...n,[y]:[...Y,F]})},B=(F,Y)=>{const V=(n[y]||[]).map(oe=>oe.id===F?{...oe,...Y}:oe);a({...n,[y]:V})},X=F=>{const K=(n[y]||[]).filter(V=>V.id!==F);a({...n,[y]:K})};return o.jsxs("div",{className:"flex h-full bg-gray-900/50 overflow-hidden border-t border-gray-700 relative",children:[o.jsx(lI,{active:C.active,x:C.x,y:C.y,onComplete:()=>w({...C,active:!1})}),o.jsxs("div",{className:"w-56 bg-gray-800/50 border-r border-gray-700 flex flex-col flex-shrink-0",children:[o.jsxs("div",{className:"p-2 border-b border-gray-700 max-h-[150px] overflow-y-auto custom-scrollbar",children:[o.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase mb-2 tracking-wider flex justify-between",children:g("planner.activeChannels")}),o.jsx("div",{className:"space-y-1",children:e.length===0?o.jsx("div",{className:"text-[10px] text-gray-600",children:g("planner.noChannels")}):e.map(F=>o.jsxs("div",{className:`flex items-center space-x-2 p-1.5 rounded cursor-pointer transition-colors border ${t.includes(F.id)?"bg-emerald-900/30 border-emerald-500/50":"bg-gray-800 border-transparent hover:border-gray-600"}`,onClick:()=>le(F.id),children:[o.jsx("div",{className:`w-2 h-2 rounded-full flex-shrink-0 ${t.includes(F.id)?"bg-emerald-500":"bg-gray-600"}`}),o.jsx("span",{className:`text-xs truncate ${t.includes(F.id)?"text-white":"text-gray-400"}`,children:F.name})]},F.id))})]}),o.jsxs("div",{className:"flex-grow flex flex-col p-2 min-h-0",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:g("planner.globalGoals")}),o.jsx("button",{onClick:()=>I(!T),className:"text-emerald-400 hover:text-white font-bold text-lg leading-none transition-transform hover:scale-110",children:"+"})]}),o.jsxs("div",{className:"flex-grow overflow-y-auto custom-scrollbar space-y-2",children:[T&&o.jsxs("div",{className:"bg-gray-700/50 p-2 rounded border border-gray-600 mb-2 shadow-lg animate-fade-in-up",children:[o.jsxs("div",{className:"flex gap-1 mb-1",children:[o.jsx("input",{className:"w-full bg-gray-900 p-1 text-xs text-white rounded border border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-400",placeholder:g("planner.newGoalTitle"),value:E,onChange:F=>R(F.target.value),onKeyDown:F=>F.key==="Enter"&&$(),autoFocus:!0}),o.jsx("button",{onClick:$,className:"text-emerald-400 hover:text-white p-1",title:"Save Goal",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})})]}),o.jsx("div",{className:"flex gap-1 mb-2 justify-between",children:sI.map(F=>o.jsx("div",{onClick:()=>O(F),className:`w-3 h-3 rounded-full cursor-pointer bg-${F}-500 ${W===F?"ring-2 ring-white scale-110":"opacity-60 hover:opacity-100"}`},F))}),o.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[o.jsx("span",{className:"text-[10px] text-gray-400",children:"Days:"}),o.jsx("input",{type:"number",className:"flex-grow bg-gray-900 p-1 text-xs text-white rounded border border-emerald-500 focus:outline-none",value:N,onChange:F=>A(parseInt(F.target.value)),onKeyDown:F=>F.key==="Enter"&&$()})]}),o.jsxs("div",{className:"flex gap-1 mb-1 mt-2 border-t border-gray-600 pt-2",children:[o.jsx("input",{className:"flex-grow bg-gray-900 p-1 text-xs text-white rounded border border-emerald-500 focus:outline-none",placeholder:g("planner.addHabit"),value:M,onChange:F=>H(F.target.value),onKeyDown:F=>F.key==="Enter"&&ue()}),o.jsx("button",{onClick:ue,className:"text-gray-400 hover:text-white px-1",children:"+"})]}),o.jsx("div",{className:"space-y-0.5",children:k.map((F,Y)=>o.jsxs("div",{className:"text-[9px] text-gray-300 bg-gray-800/50 px-1 rounded flex items-center gap-1",children:[o.jsx("div",{className:`w-1 h-1 rounded-full bg-${W}-500`}),F]},Y))})]}),s.map(F=>{const Y=new Date(F.startDate).getTime(),K=new Date(F.endDate).getTime(),V=new Date().getTime(),oe=K-Y,de=Math.min(oe,Math.max(0,V-Y)),Z=Math.floor(de/oe*100),Q=Math.floor(de/(1e3*60*60*24)),j=Math.floor(oe/(1e3*60*60*24));return o.jsxs("div",{className:`bg-gray-800/80 p-2 rounded border border-${F.color}-500/30 group`,children:[o.jsxs("div",{className:"flex justify-between items-start mb-1",children:[o.jsx("span",{className:`text-xs font-bold text-${F.color}-400`,children:F.title}),o.jsx("button",{onClick:()=>ee(F.id),className:"text-[10px] text-gray-600 hover:text-red-400 opacity-0 group-hover:opacity-100",children:""})]}),o.jsx("div",{className:"w-full bg-gray-900 h-1.5 rounded-full mb-1 overflow-hidden",children:o.jsx("div",{className:`h-full bg-${F.color}-500`,style:{width:`${Z}%`}})}),o.jsxs("div",{className:"flex justify-between text-[9px] text-gray-500 font-mono mb-2",children:[o.jsx("span",{children:g("planner.dayProgress",{current:Q})}),o.jsx("span",{children:g("planner.totalDays",{total:j})})]}),o.jsx("div",{className:"space-y-0.5",children:F.habits.map((fe,Pe)=>o.jsxs("div",{className:"text-[10px] text-gray-400 flex items-center gap-1",children:[o.jsx("div",{className:`w-1 h-1 rounded-full bg-${F.color}-500`}),fe]},Pe))})]},F.id)})]})]})]}),o.jsxs("div",{className:"flex-grow flex flex-col border-r border-gray-700 min-w-0 bg-gray-800/20",children:[o.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-gray-700 bg-gray-800 flex-shrink-0",children:[o.jsx("button",{onClick:()=>_(new Date(L,D-1,1)),className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-white",children:"<"}),o.jsxs("span",{className:"font-bold text-gray-200 capitalize",children:[ye," ",L]}),o.jsx("button",{onClick:()=>_(new Date(L,D+1,1)),className:"p-1 hover:bg-gray-700 rounded text-gray-400 hover:text-white",children:">"})]}),o.jsx("div",{className:"grid grid-cols-7 border-b border-gray-700 bg-gray-800/30 flex-shrink-0",children:["S","M","T","W","T","F","S"].map((F,Y)=>o.jsx("div",{className:"text-center text-[10px] text-gray-500 py-1 font-bold",children:F},Y))}),o.jsxs("div",{className:"grid grid-cols-7 grid-rows-6 flex-grow bg-gray-900/20",children:[ie.map(F=>o.jsx("div",{className:"border-r border-b border-gray-700/30 bg-gray-900/40"},`pad-${F}`)),te.map(F=>{const Y=`${L}-${String(D+1).padStart(2,"0")}-${String(F).padStart(2,"0")}`,K=Y===y,V=n[Y]||[],oe=new Date().toISOString().split("T")[0]===Y,de=s.reduce((Z,Q)=>Z+Q.habits.reduce((j,fe,Pe)=>{var je;return j+((je=l[Y])!=null&&je[`${Q.id}-${Pe}`]?1:0)},0),0);return o.jsxs("div",{onClick:()=>Te(F),className:`
                                    border-r border-b border-gray-700/30 relative cursor-pointer transition-colors flex flex-col p-1 min-h-[60px]
                                    ${K?"bg-emerald-900/10 shadow-[inset_0_0_0_2px_#10b981]":"hover:bg-gray-800/50"}
                                    ${oe?"bg-gray-800":""}
                                `,children:[o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsx("span",{className:`text-[10px] font-mono mb-1 ${oe?"text-emerald-400 font-bold":"text-gray-500"}`,children:F}),de>0&&o.jsxs("span",{className:"text-[9px] text-yellow-500 font-bold",children:["",de]})]}),o.jsx("div",{className:"flex flex-col gap-1 overflow-hidden",children:V.slice(0,3).map(Z=>o.jsxs("div",{className:`text-[8px] px-1 py-0.5 rounded truncate flex items-center gap-1 ${Z.isCompleted?"bg-gray-700 text-gray-500 line-through":`${xg[Z.status]} text-white`}`,children:[o.jsx("div",{className:"w-1 h-1 rounded-full bg-white/50 flex-shrink-0"}),o.jsx("span",{className:"truncate",children:Z.title||"Untitled"})]},Z.id))})]},F)})]})]}),o.jsxs("div",{className:"w-80 bg-gray-800/80 flex flex-col min-w-0 flex-shrink-0 backdrop-blur-sm",children:[o.jsxs("div",{className:"p-3 border-b border-gray-700 bg-gray-900/50 font-bold text-gray-200 text-sm flex justify-between items-center",children:[o.jsx("span",{children:y}),o.jsx("span",{className:"text-xs text-gray-500 font-normal",children:g("planner.dailyOverview")})]}),o.jsxs("div",{className:"flex-grow overflow-y-auto p-3 space-y-4 custom-scrollbar",children:[o.jsxs("div",{children:[o.jsx("h5",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 border-b border-gray-700/50 pb-1",children:g("planner.dailyRoutine")}),s.length>0?o.jsx("div",{className:"space-y-2",children:s.map(F=>o.jsxs("div",{className:`space-y-1 pl-2 border-l-2 border-${F.color}-500/50`,children:[o.jsx("div",{className:`text-[10px] font-bold text-${F.color}-400 mb-1`,children:F.title}),F.habits.map((Y,K)=>{var oe;const V=!!((oe=l[y])!=null&&oe[`${F.id}-${K}`]);return o.jsxs("div",{className:`flex items-center gap-2 p-1.5 rounded cursor-pointer hover:bg-gray-700/50 transition-all ${V?"opacity-50":""}`,onClick:de=>ge(de,F.id,K),children:[o.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center transition-colors ${V?`bg-${F.color}-600 border-${F.color}-500`:"bg-gray-800 border-gray-600"}`,children:V&&o.jsx("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),o.jsx("span",{className:`text-xs ${V?"text-gray-500 line-through":"text-gray-200"}`,children:Y})]},`${F.id}-${K}`)})]},F.id))}):o.jsx("div",{className:"text-center text-xs text-gray-600 py-4 italic",children:"Add a Goal to track habits"})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-2 border-b border-gray-700/50 pb-1",children:[o.jsx("h5",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:g("planner.specificTasks")}),o.jsx("button",{onClick:ce,className:"text-emerald-400 hover:text-white font-bold text-lg leading-none",children:"+"})]}),o.jsxs("div",{className:"space-y-2",children:[(n[y]||[]).map(F=>o.jsx("div",{className:`rounded border p-2 flex flex-col gap-2 transition-all ${F.isCompleted?"bg-gray-800/50 border-gray-700 opacity-60":"bg-gray-700/80 border-gray-600 shadow-md"}`,children:o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx("div",{className:"pt-1",children:o.jsx(ft,{checked:!!F.isCompleted,onChange:Y=>ae(F.id,Y),className:"h-4 w-4"})}),o.jsxs("div",{className:"flex-grow min-w-0 space-y-2",children:[o.jsx("textarea",{value:F.title,onChange:Y=>B(F.id,{title:Y.target.value}),placeholder:g("planner.taskPlaceholder"),className:`w-full bg-transparent border-none p-0 text-xs focus:ring-0 resize-none leading-snug ${F.isCompleted?"text-gray-500 line-through":"text-white"}`,rows:2}),o.jsxs("div",{className:"flex justify-between items-center gap-1",children:[o.jsxs("select",{value:F.channelId||"",onChange:Y=>B(F.id,{channelId:Y.target.value}),className:"bg-gray-900/50 text-[9px] text-gray-400 border border-gray-600 rounded px-1 py-0.5 max-w-[90px] outline-none truncate",disabled:!!F.isCompleted,children:[o.jsx("option",{value:"",children:g("genre.general")}),e.map(Y=>o.jsx("option",{value:Y.id,children:Y.name},Y.id))]}),o.jsxs("select",{value:F.status,onChange:Y=>B(F.id,{status:Y.target.value}),className:`text-[9px] font-bold uppercase rounded px-2 py-0.5 border border-transparent outline-none text-white ${F.isCompleted?"bg-gray-600":xg[F.status]}`,disabled:!!F.isCompleted,children:[o.jsx("option",{value:"idea",children:"Idea"}),o.jsx("option",{value:"scripting",children:"Script"}),o.jsx("option",{value:"filming",children:"Film"}),o.jsx("option",{value:"published",children:"Done"})]})]})]}),o.jsx("button",{onClick:()=>X(F.id),className:"text-gray-500 hover:text-red-400 -mt-1 -mr-1",children:""})]})},F.id)),(!n[y]||n[y].length===0)&&o.jsx("div",{className:"text-center text-xs text-gray-600 py-4 italic",children:g("planner.noTasks")})]})]})]})]})]})},dI=({authorName:e,channels:t,activeChannelId:n,activeChannel:r,aiSuggestedGoal:a,t:i,onUpdateValue:s,onUpdateChannel:l,onAddChannel:c,onDeleteChannel:d,onAcceptSuggestion:h,deselectAllNodes:g,nodeId:m})=>{const[_,y]=x.useState(!1),v=["100 Subscribers","1,000 Subscribers","Monetization (4k hours / 1k subs)","10,000 Subscribers","Silver Play Button (100k)","Gold Play Button (1M)","High Retention","Increase CTR","Regular Upload Schedule"];return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"bg-gray-900 px-2 border-b border-gray-700 flex items-center space-x-2 flex-shrink-0 h-10",children:[o.jsxs("label",{className:"text-xs text-gray-400 whitespace-nowrap font-semibold",children:[i("youtube_analytics.authorName"),":"]}),o.jsx("input",{type:"text",value:e,onChange:C=>s({authorName:C.target.value}),className:"bg-gray-800 text-sm rounded p-1 border border-transparent focus:border-emerald-500 focus:ring-0 outline-none flex-grow text-emerald-300 font-medium transition-all",onFocus:g,placeholder:i("youtube_analytics.authorName")})]}),o.jsxs("div",{className:"flex items-center bg-gray-900 p-1 gap-1 overflow-x-auto custom-scrollbar flex-shrink-0",children:[t.map(C=>o.jsxs("div",{onClick:()=>s({activeChannelId:C.id}),className:`px-3 py-1.5 h-8 text-xs rounded-t-md cursor-pointer flex items-center gap-2 flex-shrink-0 transition-colors ${n===C.id?"bg-gray-800 text-emerald-400 font-bold":"bg-gray-900 hover:bg-gray-800 text-gray-400"}`,children:[n===C.id?o.jsx("input",{type:"text",value:C.name,onChange:w=>l(C.id,{name:w.target.value}),className:"bg-transparent border-none focus:ring-0 p-0 text-emerald-400 font-bold w-24 text-xs focus:outline-none",onClick:w=>w.stopPropagation(),onFocus:g}):o.jsx("span",{children:C.name}),t.length>1&&o.jsx("button",{onClick:w=>d(w,C.id),className:"text-gray-500 hover:text-red-400",children:""})]},C.id)),o.jsx("button",{onClick:c,className:"px-2 text-gray-400 hover:text-emerald-400 font-bold text-lg",children:"+"})]}),r&&o.jsxs("div",{className:"p-2 bg-gray-900/50 border-b border-gray-700 grid grid-cols-2 gap-2",children:[o.jsxs("div",{className:"col-span-2",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("label",{className:"text-[10px] text-gray-400 uppercase font-bold block cursor-pointer select-none hover:text-gray-300 transition-colors",onClick:()=>y(!_),children:i("youtube_title_generator.description")}),o.jsx(Ie,{title:i(_?"node.action.expand":"node.action.collapse"),onClick:C=>{C.stopPropagation(),y(!_)},tooltipPosition:"left",children:_?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})})]}),!_&&o.jsx("textarea",{value:r.description||"",onChange:C=>l(r.id,{description:C.target.value}),className:"w-full bg-gray-800 text-xs rounded p-1 border border-transparent focus:border-emerald-500 focus:ring-0 outline-none text-white transition-all resize-none h-[60px] custom-scrollbar",placeholder:i("youtube_title_generator.channelDescription"),onFocus:g,onWheel:C=>C.stopPropagation()})]}),o.jsxs("div",{className:"col-span-2",children:[o.jsx("label",{className:"text-[10px] text-gray-400 uppercase font-bold block mb-1",children:i("youtube_analytics.goal")}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("input",{list:`goal-options-${m}`,type:"text",value:r.goal||"",onChange:C=>l(r.id,{goal:C.target.value}),className:"flex-grow bg-gray-800 text-xs rounded p-1 border border-transparent focus:border-emerald-500 focus:ring-0 outline-none text-white transition-all",placeholder:i("youtube_analytics.goalPlaceholder"),onFocus:g}),o.jsx("datalist",{id:`goal-options-${m}`,children:v.map(C=>o.jsx("option",{value:C},C))}),a&&r.goal!==a&&o.jsx("button",{onClick:h,className:"bg-emerald-600 hover:bg-emerald-500 text-white text-[10px] font-bold px-2 rounded animate-pulse",title:`Accept Suggestion: ${a}`,children:i("youtube_analytics.accept")})]}),a&&r.goal!==a&&o.jsxs("div",{className:"text-[10px] text-emerald-400 mt-1",children:[i("youtube_analytics.suggestion"),": ",a]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-[10px] text-gray-400 uppercase font-bold block mb-1",children:i("youtube_analytics.currentSubs")}),o.jsx("input",{type:"number",value:r.currentSubscribers||"",onChange:C=>l(r.id,{currentSubscribers:parseInt(C.target.value)||0}),className:"w-full bg-gray-800 text-xs rounded p-1 border border-transparent focus:border-emerald-500 focus:ring-0 outline-none text-white transition-all",placeholder:"0",onFocus:g})]}),o.jsx("div",{className:"flex flex-col justify-end",children:o.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer bg-gray-800 p-1 rounded border border-gray-700 h-[26px]",children:[o.jsx(ft,{id:`monetization-${m}`,checked:r.isMonetized||!1,onChange:C=>l(r.id,{isMonetized:C}),className:"h-3.5 w-3.5"}),o.jsx("span",{className:"text-[10px] text-gray-300 font-bold uppercase select-none",children:i("youtube_analytics.monetization")})]})})]})]})},uI=({activeChannel:e,onUpdateChannel:t,onUpdatePoints:n,disciplinePoints:r,t:a,deselectAllNodes:i,addToast:s,incomingVideoData:l,refreshIncomingData:c,setJustEarned:d})=>{const[h,g]=x.useState("all"),[m,_]=x.useState(!1),y=(E,R)=>{if(!e)return;const N=e.videos.map(A=>A.id===E?{...A,...R}:A);t(e.id,{videos:N})},v=E=>{if(!e)return;const R=e.videos.filter(N=>N.id!==E);t(e.id,{videos:R})},C=x.useMemo(()=>{if(!e)return[];if(h==="all")return e.videos;const E=h==="shorts";return e.videos.filter(R=>!!R.isShort===E)},[e,h]),w=()=>{if(!l||!e)return;const R=[{id:`vid-${Date.now()}`,thumbnailBase64:null,uploadDate:new Date().toISOString(),title:l.title,description:l.description,views:0,likes:0,isShort:!1},...e.videos];t(e.id,{videos:R});const N=50;d(N),n(r+N),setTimeout(()=>d(0),1500),s(a("youtube_analytics.videoAdded"),"success")},b=E=>{e&&Py(E).then(async({thumbnail:R,metadataImage:N})=>{const A=`vid-${Date.now()}`;let P=[{id:A,thumbnailBase64:R,uploadDate:new Date().toISOString(),title:"Processing...",views:0,likes:0,isShort:!1},...e.videos];t(e.id,{videos:P});const M=50;if(d(M),n(r+M),setTimeout(()=>d(0),1500),s(a("toast.videoPasted"),"success"),N)try{const H=await Iy(N),W=P.findIndex(O=>O.id===A);if(W!==-1){const O=[...P];O[W]={...O[W],title:H.title||"Untitled",description:H.description||"",views:H.views||0,uploadDate:H.uploadDate||O[W].uploadDate},t(e.id,{videos:O}),s("Title and description extracted!","success")}}catch(H){console.error("Failed to extract metadata",H),s("Failed to extract text from image","info")}}).catch(R=>{console.error("Failed to process screenshot",R),s("Failed to process image","info")})},f=E=>{var N;if(E.preventDefault(),E.stopPropagation(),_(!1),!e)return;const R=(N=E.dataTransfer.files)==null?void 0:N[0];R&&R.type.startsWith("image/")&&b(R)},T=async()=>{if(e)try{const E=await navigator.clipboard.read();for(const R of E){const N=R.types.find(A=>A.startsWith("image/"));if(N){const A=await R.getType(N),k=new File([A],"pasted_screenshot.png",{type:A.type});b(k);return}}s("No image in clipboard","info")}catch(E){console.error(E),s("Paste failed or not supported","info")}},I=(E,R)=>{var A;E.preventDefault(),E.stopPropagation();const N=(A=E.dataTransfer.files)==null?void 0:A[0];N&&N.type.startsWith("image/")&&fA(N).then(k=>{y(R,{thumbnailBase64:k}),s(a("youtube_analytics.thumbnailUpdated"),"success")})};return o.jsxs("div",{className:"flex-grow flex flex-col p-2 min-h-0 bg-gray-800/30",children:[o.jsx("div",{className:"flex space-x-1 mb-2",children:["all","long","shorts"].map(E=>o.jsx("button",{onClick:()=>g(E),className:`px-2 py-1 text-[10px] font-bold uppercase rounded ${h===E?"bg-emerald-600 text-white":"bg-gray-700 text-gray-400 hover:text-white"}`,children:E},E))}),l&&o.jsxs("div",{className:"bg-gray-900/80 border border-emerald-500/30 rounded-md p-2 mb-2 flex flex-col gap-2 shadow-lg flex-shrink-0",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h4",{className:"text-xs font-bold text-emerald-400 uppercase tracking-wider",children:a("youtube_analytics.incomingData")}),o.jsx("button",{onClick:c,className:"text-gray-400 hover:text-white",title:a("node.action.refreshData"),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),o.jsx("div",{className:"text-sm text-white font-semibold truncate",title:l.title,children:l.title}),l.description&&o.jsx("div",{className:"text-xs text-gray-400 line-clamp-2",children:l.description}),o.jsxs("button",{onClick:w,className:"w-full bg-emerald-700 hover:bg-emerald-600 text-white text-xs py-1 rounded font-bold transition-colors",children:[a("youtube_analytics.addToChannel")," (+50 pts)"]})]}),o.jsxs("div",{onDragOver:E=>{E.preventDefault(),E.stopPropagation(),_(!0)},onDragLeave:E=>{E.preventDefault(),E.stopPropagation(),_(!1)},onDrop:f,className:`flex-shrink-0 h-16 border-2 border-dashed rounded-lg flex flex-col items-center justify-center mb-2 transition-colors relative group ${m?"border-emerald-400 bg-emerald-900/20":"border-gray-600 hover:border-gray-500 bg-gray-800/50"}`,children:[o.jsx("p",{className:"text-xs text-gray-400 pointer-events-none text-center px-2",children:a("youtube_analytics.dragDrop")}),o.jsxs("button",{onClick:T,className:"absolute right-2 bottom-2 bg-gray-700 hover:bg-emerald-600 text-white text-[10px] py-1 px-2 rounded font-bold shadow transition-colors flex items-center gap-1 opacity-80 hover:opacity-100",title:a("contextMenu.paste"),children:[o.jsx(Ei,{className:"h-3 w-3"}),"Paste"]})]}),o.jsxs("div",{className:"flex-grow overflow-y-auto custom-scrollbar space-y-2",onWheel:E=>E.stopPropagation(),children:[C.map(E=>o.jsxs("div",{className:"flex gap-2 bg-gray-900/50 p-2 rounded-md group relative hover:bg-gray-800 transition-colors",onDragOver:R=>{R.preventDefault(),R.stopPropagation()},onDrop:R=>I(R,E.id),children:[o.jsxs("div",{className:"w-20 h-12 bg-black flex-shrink-0 rounded overflow-hidden relative group/thumb",children:[E.thumbnailBase64?o.jsx("img",{src:`data:image/png;base64,${E.thumbnailBase64}`,className:"w-full h-full object-cover",alt:"Thumb"}):o.jsx("div",{className:"w-full h-full bg-gray-800 flex items-center justify-center text-gray-600 text-[9px]",children:"No Image"}),o.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover/thumb:opacity-100 transition-opacity pointer-events-none",children:o.jsx("span",{className:"text-[8px] text-white",children:"Drop Image"})}),E.isShort&&o.jsx("div",{className:"absolute bottom-0 right-0 bg-red-600 text-white text-[8px] px-1 font-bold",children:"SHORTS"})]}),o.jsxs("div",{className:"flex-grow min-w-0 flex flex-col justify-between",children:[o.jsxs("div",{className:"flex justify-between items-start gap-1",children:[o.jsx("input",{type:"text",value:E.title,onChange:R=>y(E.id,{title:R.target.value}),placeholder:a("youtube_analytics.videoTitle"),className:"bg-transparent border border-transparent focus:border-emerald-500 focus:ring-0 rounded p-0.5 -ml-1 text-sm text-white font-medium focus:bg-gray-800 w-full transition-all outline-none",onFocus:i}),o.jsx("div",{className:"mt-1",children:o.jsx(ft,{id:`is-short-${E.id}`,checked:!!E.isShort,onChange:R=>y(E.id,{isShort:R}),className:"h-3 w-3 text-red-500",title:"Mark as Shorts"})})]}),o.jsx("textarea",{value:E.description||"",onChange:R=>y(E.id,{description:R.target.value}),placeholder:a("youtube_analytics.videoDescriptionPlaceholder"),className:"bg-transparent border border-transparent focus:border-emerald-500 focus:ring-0 rounded p-0.5 -ml-1 text-xs text-gray-400 w-full resize-none focus:bg-gray-800 focus:text-gray-300 transition-all outline-none",rows:1,onFocus:i}),o.jsxs("div",{className:"flex justify-between items-end mt-1",children:[o.jsx("span",{className:"text-xs text-gray-500",children:new Date(E.uploadDate).toLocaleString()}),o.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[o.jsx("input",{type:"number",placeholder:a("youtube_analytics.views"),value:E.views||"",onChange:R=>y(E.id,{views:parseInt(R.target.value)||0}),className:"w-16 bg-gray-800 text-xs p-0.5 rounded text-right text-gray-300 border border-gray-700 focus:ring-0 focus:border-emerald-500 outline-none transition-all",onFocus:i}),o.jsx("button",{onClick:()=>v(E.id),className:"text-gray-500 hover:text-red-400",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]})]},E.id)),C.length===0&&o.jsx("p",{className:"text-center text-xs text-gray-500 mt-4",children:a("youtube_analytics.noVideos")})]})]})},pI=({stats:e,videos:t,showSubs:n,showViews:r,showVideos:a})=>{if(!e.length&&!t.length)return o.jsx("div",{className:"h-24 flex items-center justify-center text-gray-500 text-xs",children:"No data for chart"});const i=new Set;e.forEach(C=>i.add(C.date)),t.forEach(C=>i.add(C.uploadDate.split("T")[0]));const s=Array.from(i).sort();if(s.length<2)return o.jsx("div",{className:"h-24 flex items-center justify-center text-gray-500 text-xs",children:"Not enough data points"});const l=s.map(C=>{const w=e.find(T=>T.date===C),b=new Date(C).getTime(),f=t.filter(T=>T.uploadDate.split("T")[0]<=C).length;return{date:C,time:b,subscribers:w?w.subscribers:void 0,totalViews:w?w.totalViews:void 0,videoCount:f}}),c=l[0].time,h=l[l.length-1].time-c||1,g=C=>{const w=l.filter(E=>E[C]!==void 0);if(w.length===0)return[];const b=w.map(E=>E[C]),f=Math.min(...b),I=Math.max(...b)-f||1;return w.map(E=>({x:(E.time-c)/h*100,y:100-(E[C]-f)/I*100,val:E[C],date:E.date}))},m=n?g("subscribers"):[],_=r?g("totalViews"):[],y=a?g("videoCount"):[],v=(C,w)=>{if(C.length<2)return null;const b=C.map((f,T)=>`${T===0?"M":"L"} ${f.x} ${f.y}`).join(" ");return o.jsxs(o.Fragment,{children:[o.jsx("path",{d:b,fill:"none",stroke:w,strokeWidth:"2",vectorEffect:"non-scaling-stroke"}),C.map((f,T)=>o.jsx("circle",{cx:f.x,cy:f.y,r:"1.5",fill:w,stroke:"none",vectorEffect:"non-scaling-stroke",children:o.jsx("title",{children:`${f.date}: ${f.val}`})},T))]})};return o.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-24 bg-gray-900/30 rounded border border-gray-700 overflow-visible",preserveAspectRatio:"none",children:[v(m,"#10b981")," ",v(_,"#06b6d4")," ",v(y,"#a855f7")," "]})},hI=({activeChannel:e,onUpdateChannel:t,channels:n,t:r,addToast:a,deselectAllNodes:i,onSaveToDisk:s,onSaveToCatalog:l,onLoadFromFile:c,nodeId:d})=>{const[h,g]=x.useState(""),[m,_]=x.useState(""),[y,v]=x.useState(""),[C,w]=x.useState(!0),[b,f]=x.useState(!1),[T,I]=x.useState(!0),E=x.useRef(null),[R,N]=x.useState(!1),A=x.useMemo(()=>new Date().toLocaleString(),[]),k=()=>{if(!e)return;const O=new Date,U=O.getFullYear()+"-"+String(O.getMonth()+1).padStart(2,"0")+"-"+String(O.getDate()).padStart(2,"0"),z=parseInt(h)||0,L=parseInt(m)||0,D=parseInt(y)||0,G=L+D;if(z===0&&G===0)return;const q=e.stats.findIndex(ye=>ye.date===U);let ie=[...e.stats];const te={date:U,subscribers:z,totalViews:G,shortsViews:D,longViews:L};q>=0?ie[q]=te:(ie.push(te),ie.sort((ye,ue)=>new Date(ye.date).getTime()-new Date(ue.date).getTime())),t(e.id,{stats:ie}),g(""),_(""),v(""),a(r("youtube_analytics.statsUpdated"),"success")},P=O=>{const U=new Date,z=new Date(U.getTime()-7*24*60*60*1e3),L=new Date(U.getTime()-30*24*60*60*1e3),D=O.videos.filter(ie=>new Date(ie.uploadDate)>=z).length,G=O.videos.filter(ie=>new Date(ie.uploadDate)>=L).length;let q="0";if(O.stats.length>=2){const ie=O.stats[O.stats.length-1],te=O.stats[O.stats.length-2],ye=ie.subscribers-te.subscribers;q=ye>0?`+${ye}`:`${ye}`}return{videosWeek:D,videosMonth:G,growth:q}},M=e?P(e):{videosWeek:0,growth:"0"},H=n.reduce((O,U)=>O+P(U).videosWeek,0),W=n.reduce((O,U)=>O+P(U).videosMonth,0);return o.jsxs("div",{className:"bg-gray-900 border-t border-gray-700 flex-shrink-0 mt-auto flex flex-col transition-all duration-300",children:[o.jsx("div",{className:"flex items-center justify-between px-2 py-1 cursor-pointer hover:bg-gray-800 transition-colors select-none bg-gray-900",onClick:()=>N(!R),children:o.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 transition-transform duration-200 ${R?"":"rotate-180"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}),o.jsxs("span",{className:"font-bold uppercase tracking-wider text-[10px]",children:[r("youtube_analytics.statsTrend")," & ",r("toolbar.group.file")]})]})}),!R&&o.jsxs("div",{className:"p-2 flex flex-col gap-2 animate-fade-in-up",children:[o.jsxs("div",{className:"bg-gray-800/50 p-2 rounded-md border border-gray-700/50",children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("h4",{className:"text-xs font-bold text-gray-400",children:r("youtube_analytics.statsTrend")}),o.jsx("div",{className:"text-[10px] text-gray-500 font-mono bg-gray-800 px-1 rounded",children:A})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("label",{className:"flex items-center text-[10px] text-emerald-400 space-x-1 cursor-pointer",children:[o.jsx(ft,{id:`chart-subs-${d}`,checked:C,onChange:w,className:"h-3 w-3"}),o.jsx("span",{children:r("youtube_analytics.subs")})]}),o.jsxs("label",{className:"flex items-center text-[10px] text-cyan-400 space-x-1 cursor-pointer",children:[o.jsx(ft,{id:`chart-views-${d}`,checked:b,onChange:f,className:"h-3 w-3"}),o.jsx("span",{children:r("youtube_analytics.views_short")})]}),o.jsxs("label",{className:"flex items-center text-[10px] text-purple-400 space-x-1 cursor-pointer",children:[o.jsx(ft,{id:`chart-vids-${d}`,checked:T,onChange:I,className:"h-3 w-3"}),o.jsx("span",{children:r("youtube_analytics.vids_short")})]})]})]}),o.jsx(pI,{stats:(e==null?void 0:e.stats)||[],videos:(e==null?void 0:e.videos)||[],showSubs:C,showViews:b,showVideos:T})]}),o.jsxs("div",{className:"bg-gray-900/50 p-2 rounded-md space-y-2 border border-emerald-500/20",children:[o.jsx("h4",{className:"text-xs font-bold text-emerald-400 uppercase",children:r("youtube_analytics.logDailyStats")}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("div",{className:"flex-1",children:o.jsx("input",{type:"number",value:h,onChange:O=>g(O.target.value),className:"w-full bg-gray-800 text-sm rounded p-1 border border-gray-700 focus:border-emerald-500 focus:ring-0 outline-none",onFocus:i,placeholder:r("youtube_analytics.subscribers")})}),o.jsx("div",{className:"flex-1",children:o.jsx("input",{type:"number",value:m,onChange:O=>_(O.target.value),className:"w-full bg-gray-800 text-sm rounded p-1 border border-gray-700 focus:border-emerald-500 focus:ring-0 outline-none",onFocus:i,placeholder:r("youtube_analytics.longViews")})}),o.jsx("div",{className:"flex-1",children:o.jsx("input",{type:"number",value:y,onChange:O=>v(O.target.value),className:"w-full bg-gray-800 text-sm rounded p-1 border border-gray-700 focus:border-emerald-500 focus:ring-0 outline-none",onFocus:i,placeholder:r("youtube_analytics.shortsViews")})})]}),o.jsx("button",{onClick:k,className:"w-full bg-emerald-600 hover:bg-emerald-500 text-white text-xs font-bold py-1 rounded transition-colors",children:r("youtube_analytics.updateStats")})]}),o.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-400 px-2",children:[o.jsxs("div",{className:"flex gap-4",children:[o.jsxs("div",{children:[o.jsx("span",{className:"block text-[10px] text-gray-500 uppercase",children:r("youtube_analytics.currentChannel")}),o.jsxs("span",{className:"text-white font-bold",children:[M.videosWeek," ",r("youtube_analytics.videos_wk")]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"block text-[10px] text-gray-500 uppercase",children:r("youtube_analytics.growth")}),o.jsxs("span",{className:`${parseInt(M.growth)>0?"text-green-400":"text-gray-300"}`,children:[M.growth," ",r("youtube_analytics.subs_short")]})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("span",{className:"block text-[10px] text-gray-500 uppercase",children:r("youtube_analytics.allChannels")}),o.jsxs("span",{className:"text-emerald-400 font-bold",children:[H," ",r("youtube_analytics.vids_wk"),"  |  ",W," ",r("youtube_analytics.vids_mo")]})]})]}),o.jsxs("div",{className:"flex gap-2 border-t border-gray-800 pt-2",children:[o.jsx("button",{onClick:s,className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white text-xs font-bold py-1 rounded transition-colors",children:r("youtube_analytics.saveDisk")}),o.jsx("button",{onClick:l,className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white text-xs font-bold py-1 rounded transition-colors",children:r("youtube_analytics.saveCatalog")}),o.jsxs("label",{className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white text-xs font-bold py-1 rounded transition-colors text-center cursor-pointer",children:[r("youtube_analytics.loadDisk"),o.jsx("input",{type:"file",accept:".json",onChange:c,className:"hidden",ref:E})]})]})]})]})},mI=({advice:e,addToast:t})=>{if(!e)return null;const n=x.useMemo(()=>e.split(/(?=###\s)/).map(s=>{const l=s.trim();if(l.startsWith("###")){const[c,...d]=l.split(`
`);return{title:c.replace(/^###\s*/,"").trim(),content:d.join(`
`).trim(),isHeader:!0}}return{title:null,content:l,isHeader:!1}}).filter(s=>s.content),[e]),r=i=>{navigator.clipboard.writeText(i),t("Copied to clipboard","success")},a=i=>i.split(/(\*\*.*?\*\*)/g).map((l,c)=>l.startsWith("**")&&l.endsWith("**")?o.jsx("strong",{className:"text-emerald-300 font-semibold",children:l.slice(2,-2)},c):l);return o.jsx("div",{className:"space-y-2 mt-2",children:n.map((i,s)=>o.jsxs("div",{className:`bg-gray-800/80 border border-gray-700 rounded-md overflow-hidden ${i.isHeader?"mb-2":"mb-1"}`,children:[i.title&&o.jsxs("div",{className:"flex justify-between items-center bg-gray-900/60 px-2 py-1.5 border-b border-gray-700/50",children:[o.jsx("h4",{className:"text-sm font-bold text-emerald-400",children:i.title}),o.jsx(Ie,{title:"Copy Section",onClick:()=>r(`${i.title}
${i.content}`),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),o.jsx("div",{className:"p-2 text-xs text-gray-300 whitespace-pre-wrap select-text leading-relaxed",children:a(i.content)})]},s))})},gI=({node:e,onValueChange:t,t:n,deselectAllNodes:r,onAnalyzeYouTubeStats:a,isAnalyzingYouTubeStats:i,isStopping:s,onStopGeneration:l,addToast:c,saveDataToCatalog:d,getUpstreamTextValue:h,connections:g})=>{const[m,_]=x.useState("analytics"),[y,v]=x.useState(null),[C,w]=x.useState(0),b=x.useMemo(()=>{try{const J=JSON.parse(e.value||"{}"),ge=Array.isArray(J.channels)?J.channels:[{id:"default",name:"Main Channel",videos:[],stats:[]}];return{authorName:J.authorName||"",channels:ge,activeChannelId:J.activeChannelId||"default",globalNotes:Array.isArray(J.globalNotes)?J.globalNotes:Array.isArray(J.notes)?J.notes:[],aiAdvice:J.aiAdvice||"",aiSuggestedGoal:J.aiSuggestedGoal||"",targetLanguage:J.targetLanguage||"ru",contextPrompt:J.contextPrompt||"",schedule:J.schedule||{},activePlanningChannels:J.activePlanningChannels||[],disciplinePoints:J.disciplinePoints||0,globalGoals:J.globalGoals||[],habitCompletions:J.habitCompletions||{}}}catch{return{authorName:"",channels:[{id:"default",name:"Main Channel",videos:[],stats:[]}],activeChannelId:"default",globalNotes:[],aiAdvice:"",aiSuggestedGoal:"",targetLanguage:"ru",contextPrompt:"",schedule:{},activePlanningChannels:[],disciplinePoints:0,globalGoals:[],habitCompletions:{}}}},[e.value]),{authorName:f,channels:T,activeChannelId:I,globalNotes:E,aiAdvice:R,aiSuggestedGoal:N,targetLanguage:A,contextPrompt:k,schedule:P,activePlanningChannels:M,disciplinePoints:H,globalGoals:W,habitCompletions:O}=b,U=T.find(J=>J.id===I)||T[0],z=J=>{t(e.id,JSON.stringify({...b,...J}))},L=(J,ge)=>{const ae=T.map(ce=>ce.id===J?{...ce,...ge}:ce);z({channels:ae})},D=()=>{if(!h||!g)return;const J=g.find(ge=>ge.toNodeId===e.id);if(J){const ge=h(J.fromNodeId,J.fromHandleId);try{const ae=JSON.parse(ge),ce=ae.title||(typeof ae=="string"?ae:""),B=ae.description||"";ce?(v({title:ce,description:B}),c(n("node.action.refreshData"),"success")):c(n("youtube_analytics.noIncomingData"),"info")}catch{ge&&ge.trim()?(v({title:ge,description:""}),c(n("node.action.refreshData"),"success")):v(null)}}else v(null)};_t.useEffect(()=>{D()},[g]);const G=()=>{const J=`channel-${Date.now()}`,ge={id:J,name:`Channel ${T.length+1}`,videos:[],stats:[]};z({channels:[...T,ge],activeChannelId:J})},q=(J,ge)=>{if(J.stopPropagation(),T.length<=1)return;const ae=T.filter(ce=>ce.id!==ge);z({channels:ae,activeChannelId:I===ge?ae[0].id:I})},ie=()=>{if(N&&U){const J=T.map(ge=>ge.id===U.id?{...ge,goal:N}:ge);t(e.id,JSON.stringify({...b,channels:J,aiSuggestedGoal:""})),c(n("youtube_analytics.goalUpdated")||"Goal updated","success")}},te=()=>{const J=new Date,ge=J.getFullYear()+"-"+String(J.getMonth()+1).padStart(2,"0")+"-"+String(J.getDate()).padStart(2,"0"),ae={id:`note-${Date.now()}`,date:ge,content:""};z({globalNotes:[ae,...E]})},ye=(J,ge)=>{const ae=E.map(ce=>ce.id===J?{...ce,content:ge}:ce);z({globalNotes:ae})},ue=J=>{const ge=E.filter(ae=>ae.id!==J);z({globalNotes:ge})},$=()=>{const J={type:"youtube-analytics-data",...b},ge=JSON.stringify(J,null,2),ae=new Blob([ge],{type:"application/json"}),ce=URL.createObjectURL(ae),B=document.createElement("a"),X=f.replace(/[^a-z0-9-\s-_]/gi,"").trim()||"Unknown",F=U.name.replace(/[^a-z0-9-\s-_]/gi,"").trim()||"Channel",Y=new Date().toISOString().replace(/[:.]/g,"-");B.href=ce,B.download=`youtube_analytics_${X.replace(/\s+/g,"_")}_${F.replace(/\s+/g,"_")}_${Y}.json`,B.click(),URL.revokeObjectURL(ce),c(n("youtube_analytics.savedToDisk"),"success")},ee=()=>{d&&d(e.id,Ze.YOUTUBE,U.name||"YouTube Data")},Te=J=>{var ce;const ge=(ce=J.target.files)==null?void 0:ce[0];if(!ge)return;const ae=new FileReader;ae.onload=B=>{var X;try{const F=JSON.parse((X=B.target)==null?void 0:X.result);t(e.id,JSON.stringify(F)),c(n("youtube_analytics.loadedFromDisk"),"success")}catch{c(n("youtube_analytics.loadFailed"),"info")}},ae.readAsText(ge),J.target&&(J.target.value="")},le={channels:T.map(J=>({id:J.id,name:J.name})),activeChannelIds:M||[],schedule:P||{},onUpdateActiveChannels:J=>z({activePlanningChannels:J}),onUpdateSchedule:J=>z({schedule:J}),disciplinePoints:H||0,globalGoals:W||[],habitCompletions:O||{},onUpdatePoints:J=>z({disciplinePoints:J}),onUpdateGoals:J=>z({globalGoals:J}),onUpdateHabitCompletions:J=>z({habitCompletions:J}),t:n};return o.jsxs("div",{className:"flex flex-col h-full rounded-lg overflow-hidden relative",children:[o.jsxs("div",{className:"flex-shrink-0 flex items-end gap-1 px-2 pt-2 bg-gray-900 border-b border-gray-700",children:[o.jsx("button",{onClick:()=>_("analytics"),className:`px-4 py-1.5 text-xs font-bold rounded-t-md transition-colors border-t border-l border-r -mb-px z-10 ${m==="analytics"?"bg-gray-800 text-emerald-400 border-gray-700":"bg-gray-900 text-gray-400 border-transparent hover:bg-gray-800 hover:text-gray-200"}`,children:n("youtube_analytics.mode.analytics")}),o.jsx("button",{onClick:()=>_("planner"),className:`px-4 py-1.5 text-xs font-bold rounded-t-md transition-colors border-t border-l border-r -mb-px z-10 ${m==="planner"?"bg-gray-800 text-emerald-400 border-gray-700":"bg-gray-900 text-gray-400 border-transparent hover:bg-gray-800 hover:text-gray-200"}`,children:n("youtube_analytics.mode.planner")}),o.jsxs("div",{className:"ml-auto flex items-center gap-2 mb-1 px-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z",clipRule:"evenodd"})}),o.jsx("span",{className:"text-sm font-bold text-yellow-100 font-mono",children:H||0}),C>0&&o.jsxs("span",{className:"text-xs font-bold text-emerald-400 animate-bounce",children:["+",C]})]})]}),m==="planner"?o.jsx("div",{className:"flex-grow p-0 overflow-hidden h-full bg-gray-800",children:o.jsx(cI,{...le})}):o.jsxs("div",{className:"flex flex-row flex-grow min-h-0 bg-gray-800",children:[o.jsxs("div",{className:"flex flex-col flex-1 h-full border-r border-gray-700 min-w-0",children:[o.jsx(dI,{authorName:f,channels:T,activeChannelId:I,activeChannel:U,aiSuggestedGoal:N,t:n,onUpdateValue:z,onUpdateChannel:L,onAddChannel:G,onDeleteChannel:q,onAcceptSuggestion:ie,deselectAllNodes:r,nodeId:e.id}),o.jsx(uI,{activeChannel:U,onUpdateChannel:L,onUpdatePoints:J=>z({disciplinePoints:J}),disciplinePoints:H,t:n,deselectAllNodes:r,addToast:c,incomingVideoData:y,refreshIncomingData:D,setJustEarned:w}),o.jsx(hI,{activeChannel:U,onUpdateChannel:L,channels:T,t:n,addToast:c,deselectAllNodes:r,onSaveToDisk:$,onSaveToCatalog:ee,onLoadFromFile:Te,nodeId:e.id})]}),o.jsxs("div",{className:"flex flex-col flex-1 h-full border-r border-gray-700 min-w-0 bg-gray-900/20",children:[o.jsxs("div",{className:"flex flex-col bg-gray-900 px-2 pt-2 pb-2 border-b border-gray-700 gap-2",children:[o.jsxs("div",{className:"w-full",children:[o.jsx("label",{className:"text-[10px] text-gray-400 uppercase font-bold block mb-1",children:n("youtube_analytics.contextPrompt")}),o.jsx("textarea",{value:k,onChange:J=>z({contextPrompt:J.target.value}),className:"w-full bg-gray-800 text-xs rounded p-2 border border-gray-700 focus:border-emerald-500 outline-none text-white resize-y custom-scrollbar",placeholder:n("youtube_analytics.contextPlaceholder"),rows:2,onFocus:r,onWheel:J=>J.stopPropagation()})]}),o.jsxs("div",{className:"flex items-center h-8",children:[o.jsxs("div",{className:"flex items-center space-x-1 mr-2 h-full",children:[o.jsx("button",{onClick:()=>z({targetLanguage:"ru"}),className:`px-2 h-full rounded text-xs font-bold transition-colors ${A==="ru"?"bg-emerald-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"RU"}),o.jsx("button",{onClick:()=>z({targetLanguage:"en"}),className:`px-2 h-full rounded text-xs font-bold transition-colors ${A==="en"?"bg-emerald-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"EN"})]}),o.jsx("button",{onClick:()=>a&&a(e.id),disabled:i||s,className:`flex-grow h-full px-3 text-xs font-bold uppercase tracking-wider rounded transition-colors ${i?"bg-gray-700 text-gray-400 cursor-not-allowed":"bg-emerald-600 hover:bg-emerald-500 text-white"}`,children:n(i?"youtube_analytics.analyzing":"youtube_analytics.askAI")})]})]}),R?o.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar p-2",onWheel:J=>J.stopPropagation(),children:o.jsx(mI,{advice:R,addToast:c})}):o.jsx("div",{className:"flex-grow flex items-center justify-center text-xs text-gray-600 italic p-4 text-center",children:n(i?"youtube_analytics.analyzing":"youtube_analytics.clickForAdvice")})]}),o.jsx("div",{className:"w-80 flex flex-col p-2 border-l border-gray-700 bg-gray-900/20 flex-shrink-0 gap-2 overflow-hidden",children:o.jsxs("div",{className:"flex flex-col bg-gray-900/30 rounded-md border border-gray-700/50 overflow-hidden h-[180px] flex-shrink-0",children:[o.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-900/50 border-b border-gray-700/50",children:[o.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:n("youtube_analytics.dailyNotes")}),o.jsx("button",{onClick:te,className:"text-emerald-400 hover:text-emerald-300 bg-gray-800 rounded px-2 py-0.5 text-sm font-bold",children:"+"})]}),o.jsxs("div",{className:"flex-grow overflow-y-auto custom-scrollbar p-2 space-y-2",onWheel:J=>J.stopPropagation(),children:[E.map(J=>o.jsxs("div",{className:"bg-gray-800 rounded p-2 flex flex-col space-y-1 group",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-[10px] text-emerald-500 font-mono",children:J.date}),o.jsx("button",{onClick:()=>ue(J.id),className:"text-gray-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]}),o.jsx("textarea",{value:J.content,onChange:ge=>ye(J.id,ge.target.value),className:"w-full bg-transparent border border-transparent rounded text-xs text-gray-300 focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500 p-1 resize-y h-[60px] min-h-[60px] transition-colors outline-none",placeholder:n("node.content.notePlaceholder"),rows:3,onFocus:r})]},J.id)),E.length===0&&o.jsx("p",{className:"text-center text-[10px] text-gray-600 mt-4",children:n("youtube_analytics.noNotes")})]})]})})]})]})},fI=40,yI=({node:e,t,addToast:n,onMouseDown:r,onTouchStart:a,onNodeDoubleClick:i,onValueChange:s,onReadData:l,onPasteNodeValue:c,onCopyNodeValue:d,onCutConnections:h,onDeleteNode:g,onDuplicateNode:m,onDuplicateNodeEmpty:_,onRenameNode:y,onDownloadChat:v})=>{const{saveDataToCatalog:C,handleToggleNodeOutputVisibility:w,setNodes:b}=or(),f=e.type===S.REROUTE_DOT,T={[S.TEXT_INPUT]:t("node.help.text_input"),[S.PROMPT_PROCESSOR]:t("node.help.prompt_processor"),[S.PROMPT_ANALYZER]:t("node.help.prompt_analyzer"),[S.CHARACTER_ANALYZER]:t("node.help.character_analyzer"),[S.CHARACTER_GENERATOR]:t("node.help.character_generator"),[S.IMAGE_GENERATOR]:t("node.help.image_generator"),[S.IMAGE_PREVIEW]:t("node.help.image_preview"),[S.CHARACTER_CARD]:t("node.help.character_card"),[S.GEMINI_CHAT]:t("node.help.gemini_chat"),[S.TRANSLATOR]:t("node.help.translator"),[S.SCRIPT_GENERATOR]:t("node.help.script_generator"),[S.SCRIPT_ANALYZER]:t("node.help.script_analyzer"),[S.SCRIPT_PROMPT_MODIFIER]:t("node.help.script_prompt_modifier"),[S.ERROR_ANALYZER]:t("node.help.error_analyzer"),[S.NOTE]:t("node.help.note"),[S.REROUTE_DOT]:t("node.help.reroute_dot"),[S.DATA_READER]:t("node.help.data_reader"),[S.SPEECH_SYNTHESIZER]:t("node.help.speech_synthesizer"),[S.IDEA_GENERATOR]:t("node.help.idea_generator"),[S.NARRATOR_TEXT_GENERATOR]:t("node.help.narrator_text_generator"),[S.AUDIO_TRANSCRIBER]:t("node.help.audio_transcriber"),[S.YOUTUBE_TITLE_GENERATOR]:t("node.help.youtube_title_generator"),[S.MUSIC_IDEA_GENERATOR]:t("node.help.music_idea_generator"),[S.YOUTUBE_ANALYTICS]:t("node.help.youtube_analytics"),[S.IMAGE_EDITOR]:t("node.help.image_editor")},I=()=>{let P={};try{P=JSON.parse(e.value||"{}")}catch{}let M;switch(e.type){case S.PROMPT_ANALYZER:M={...P,environment:"",characters:[],action:"",style:""};break;case S.CHARACTER_ANALYZER:M={...P,character:"",clothing:""};break;case S.CHARACTER_GENERATOR:M={...P,prompt:"",characters:[],error:null};break;case S.CHARACTER_CARD:M=[{id:`char-card-${Date.now()}`,name:"",index:"Entity-1",imageSources:{},prompt:"",fullDescription:"",selectedRatio:"1:1"}];break;case S.GEMINI_CHAT:M={messages:[],currentInput:""};break;case S.SCRIPT_GENERATOR:M={...P,prompt:"",summary:"",detailedCharacters:[],scenes:[],generatedStyle:""};break;case S.SCRIPT_ANALYZER:M={...P,characters:[],scenes:[],visualStyle:"",generatedStyle:"",detailedCharacters:[]};break;case S.SCRIPT_PROMPT_MODIFIER:M={...P,finalPrompts:[],videoPrompts:[],generationProgress:null,usedCharacters:[],styleOverride:"",sceneContexts:{}};break;case S.NARRATOR_TEXT_GENERATOR:M={...P,prompt:"",generatedTexts:{ru:"",en:""}};break;case S.SPEECH_SYNTHESIZER:M={...P,audioFiles:[]};break;case S.IDEA_GENERATOR:M={...P,theme:"",stage:"initial",categories:null,selection:{action:null,place:null,obstacle:null},generatedIdea:""};break;case S.YOUTUBE_ANALYTICS:M={...P,channels:[{id:"default",name:"Main Channel",videos:[],stats:[]}],activeChannelId:"default",aiAdvice:""};break;case S.MUSIC_IDEA_GENERATOR:M={...P,idea:"",generatedLyrics:{},generatedMusicPrompts:{},generatedTitles:{}};break;case S.AUDIO_TRANSCRIBER:M={audioBase64:null,mimeType:null,transcription:"",segments:[],fileName:null};break;case S.TEXT_INPUT:case S.NOTE:case S.ERROR_ANALYZER:s(e.id,""),n(t("toast.cleared")),l&&l(e.id);return;default:s(e.id,JSON.stringify({})),n(t("toast.cleared")),l&&l(e.id);return}s(e.id,JSON.stringify(M)),n(t("toast.cleared")),l&&setTimeout(()=>l(e.id),50)},E=()=>{try{let P=JSON.parse(e.value||"[]");Array.isArray(P)||(Object.keys(P).length>0?P=[P]:P=[]);let M=0;const H=/^New Entity\s*(\d*)$/i;P.forEach(G=>{const q=(G.name||"").match(H);if(q){const ie=q[1]?parseInt(q[1],10):1;ie>M&&(M=ie)}});const W=`New Entity ${M+1}`;let O=0;const U=/^(?:Entity|Character)-(\d+)$/i;P.forEach(G=>{const q=(G.index||"").match(U);if(q){const ie=parseInt(q[1],10);ie>O&&(O=ie)}});const z=`Entity-${O+1}`,L={id:`char-card-${Date.now()}`,name:W,index:z,image:null,imageSources:{},thumbnails:{"1:1":null,"16:9":null,"9:16":null},selectedRatio:"1:1",prompt:"",fullDescription:"",targetLanguage:"en",isOutput:!1,isDescriptionCollapsed:!1,isImageCollapsed:!1,additionalPrompt:"Full body character concept on a gray background"},D=[...P,L];s(e.id,JSON.stringify(D)),b(G=>G.map(q=>q.id===e.id?{...q,width:Math.max(460,D.length*sa)}:q))}catch(P){console.error("Failed to add character card:",P)}},N=(()=>{switch(e.type){case S.CHARACTER_GENERATOR:return Ze.CHARACTERS;case S.CHARACTER_CARD:return Ze.CHARACTERS;case S.SCRIPT_GENERATOR:return Ze.SCRIPT;case S.SCRIPT_ANALYZER:return Ze.ANALYSIS;case S.SCRIPT_PROMPT_MODIFIER:return Ze.FINAL_PROMPTS;case S.YOUTUBE_TITLE_GENERATOR:return Ze.YOUTUBE;case S.YOUTUBE_ANALYTICS:return Ze.YOUTUBE;case S.MUSIC_IDEA_GENERATOR:return Ze.MUSIC;default:return null}})(),A=()=>{if(!C||!N)return;const P=new Date,M=P.getFullYear(),H=String(P.getMonth()+1).padStart(2,"0"),W=String(P.getDate()).padStart(2,"0"),O=String(P.getHours()).padStart(2,"0"),U=String(P.getMinutes()).padStart(2,"0"),z=String(P.getSeconds()).padStart(2,"0"),L=`${M}-${H}-${W} ${O}:${U}:${z}`,D=`${e.title} (${L})`;C(e.id,N,D)},k=f?"bg-transparent":e.type===S.NOTE?"bg-transparent border-b border-gray-700/50":"bg-gray-700";return o.jsx("div",{className:`${k} node-header text-white font-bold p-2 ${f?"":e.isCollapsed?"rounded-lg":"rounded-t-lg"} flex justify-between items-center ${f?"":"cursor-move"} flex-shrink-0`,onMouseDown:f?void 0:r,onTouchStart:f?void 0:a,onDoubleClick:P=>{P.stopPropagation(),i(e.id)},style:{height:f?"100%":`${fI}px`,zIndex:10},children:f?o.jsx("div",{className:"w-full h-full flex justify-center items-center",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-400 pointer-events-none",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[o.jsx(Ie,{title:e.isCollapsed?t("node.action.expand"):t("node.action.collapse"),onClick:()=>i(e.id),children:e.isCollapsed?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})}),o.jsx("span",{className:"truncate pr-2",children:e.title})]}),o.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[e.type===S.SCRIPT_PROMPT_MODIFIER&&o.jsx(Ie,{title:e.areOutputHandlesHidden?"Show Outputs":"Hide Outputs",onClick:()=>w(e.id),children:e.areOutputHandlesHidden?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),o.jsx(lt,{title:T[e.type]||"No help available.",position:"top",contentClassName:"w-56 whitespace-normal text-left leading-relaxed",children:o.jsx("button",{onMouseDown:P=>P.stopPropagation(),className:"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none focus:ring-1 focus:ring-emerald-500","aria-label":t("node.action.help"),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),o.jsx(Ie,{title:t("node.action.rename"),onClick:()=>y(e.id,e.title),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.type===S.CHARACTER_CARD&&o.jsx(Ie,{title:t("node.action.addCharacter"),onClick:E,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),N&&o.jsx(Ie,{title:t("group.saveToCatalog"),onClick:A,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),(e.type===S.SCRIPT_GENERATOR||e.type===S.SCRIPT_ANALYZER||e.type===S.SCRIPT_PROMPT_MODIFIER||e.type===S.YOUTUBE_ANALYTICS||e.type===S.YOUTUBE_TITLE_GENERATOR||e.type===S.CHARACTER_CARD||e.type===S.MUSIC_IDEA_GENERATOR)&&o.jsx(Ie,{title:t("catalog.card.save"),onClick:()=>{try{const P=JSON.parse(e.value||"{}");let M="",H="data.json",W=P;const O=new Date,U=O.getFullYear(),z=String(O.getMonth()+1).padStart(2,"0"),L=String(O.getDate()).padStart(2,"0"),D=String(O.getHours()).padStart(2,"0"),G=String(O.getMinutes()).padStart(2,"0"),q=String(O.getSeconds()).padStart(2,"0"),ie=`${U}-${z}-${L}_${D}-${G}-${q}`;if(e.type===S.SCRIPT_GENERATOR)M="script-generator-data",H=`script_generated_${ie}.json`;else if(e.type===S.SCRIPT_ANALYZER)M="script-analyzer-data",H=`script_analysis_${ie}.json`;else if(e.type===S.SCRIPT_PROMPT_MODIFIER)M="script-prompt-modifier-data",H=`final_prompts_${ie}.json`,W={finalPrompts:P.finalPrompts||[],videoPrompts:P.videoPrompts||[],usedCharacters:P.usedCharacters||[],sceneContexts:P.sceneContexts||{},visualStyle:P.styleOverride||""};else if(e.type===S.YOUTUBE_ANALYTICS)M="youtube-analytics-data",H=`youtube_analytics_${ie}.json`;else if(e.type===S.YOUTUBE_TITLE_GENERATOR)M="youtube-title-data",H=`youtube_titles_${ie}.json`;else if(e.type===S.MUSIC_IDEA_GENERATOR)M="music-idea-data",H=`music_ideas_${ie}.json`;else if(e.type===S.CHARACTER_CARD){M="character-card";const Te=Array.isArray(P)?P:[P];H=`${(Te.length===1?Te[0].name||"Entity":"Entity_Collection").replace(/[^a-z0-9-\s-_]/gi,"").trim().replace(/\s+/g,"_")}_${ie}.CHAR`,W=Te.map(ce=>{const B={},X=["1:1","16:9","9:16"],F=ce.thumbnails||ce.imageSources||{};X.forEach(K=>{let V=F[K];K==="1:1"&&!V&&(V=ce.image||ce.imageBase64),V?B[K]=V.startsWith("data:image")?V:`data:image/png;base64,${V}`:B[K]=null});let Y=B["1:1"]||null;if(!Y&&(ce.image||ce.imageBase64)){const K=ce.image||ce.imageBase64;Y=K.startsWith("data:image")?K:`data:image/png;base64,${K}`,B["1:1"]||(B["1:1"]=Y)}return{type:M,id:ce.id||`char-card-${Date.now()}-${Math.random()}`,name:ce.name,index:ce.index||ce.alias||"Entity-1",image:Y,selectedRatio:ce.selectedRatio||"1:1",prompt:ce.prompt||"",fullDescription:ce.fullDescription||"",nodeTitle:e.title,imageSources:B,additionalPrompt:ce.additionalPrompt,targetLanguage:ce.targetLanguage,isOutput:ce.isOutput}})}const te=e.type===S.CHARACTER_CARD?W:{type:M,title:e.title,...W},ye=JSON.stringify(te,null,2),ue=new Blob([ye],{type:"application/json"}),$=URL.createObjectURL(ue),ee=document.createElement("a");ee.href=$,ee.download=H,ee.click(),URL.revokeObjectURL($),n(t("youtube_analytics.savedToDisk"),"success")}catch(P){console.error("Failed to download data:",P)}},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),(e.type===S.TEXT_INPUT||e.type===S.NOTE||e.type===S.CHARACTER_CARD||e.type===S.YOUTUBE_ANALYTICS)&&o.jsx(Ie,{title:t("node.action.paste"),onClick:()=>{c(e.id),n(t("toast.pasted"))},children:o.jsx(Ei,{className:"h-4 w-4"})}),o.jsx(Ie,{title:t("node.action.copy"),onClick:()=>{d(e.id),n(t("toast.copied"))},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),e.type===S.GEMINI_CHAT&&o.jsx(Ie,{title:"Download Chat",onClick:()=>v&&v(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),(e.type===S.PROMPT_ANALYZER||e.type===S.CHARACTER_ANALYZER||e.type===S.SCRIPT_GENERATOR||e.type===S.SCRIPT_ANALYZER||e.type===S.CHARACTER_GENERATOR||e.type===S.SCRIPT_PROMPT_MODIFIER||e.type===S.CHARACTER_CARD||e.type===S.TEXT_INPUT||e.type===S.NOTE||e.type===S.ERROR_ANALYZER||e.type===S.NARRATOR_TEXT_GENERATOR||e.type===S.SPEECH_SYNTHESIZER||e.type===S.IDEA_GENERATOR||e.type===S.YOUTUBE_ANALYTICS||e.type===S.YOUTUBE_TITLE_GENERATOR||e.type===S.MUSIC_IDEA_GENERATOR||e.type===S.GEMINI_CHAT||e.type===S.AUDIO_TRANSCRIBER)&&o.jsx(Ie,{title:t("node.action.clear"),onClick:I,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),o.jsx(Ie,{title:t("node.action.duplicateWithContent"),onClick:()=>m(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),o.jsx(Ie,{title:t("node.action.duplicateEmpty"),onClick:()=>_(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 21h10a2 2 0 002-2V7.414a1 1 0 00-.293-.707l-4.414-4.414A1 1 0 0013.586 2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),e.type!==S.NOTE&&e.type!==S.IMAGE_PREVIEW&&o.jsx(Ie,{title:t("node.action.cutConnections"),onClick:()=>{h(e.id),n(t("toast.connectionsCut"))},children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121M12 12L4.5 4.5"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5l.707-.707M19.5 4.5l-.707.707"})]})}),o.jsx(Ie,{title:t("node.action.close"),onClick:()=>{g(e.id)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})})},xI=({onResizeMouseDown:e,onResizeTouchStart:t})=>o.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 cursor-se-resize group",onMouseDown:e,onTouchStart:t,style:{zIndex:13},children:o.jsx("div",{className:"w-full h-full border-r-2 border-b-2 border-gray-600 group-hover:border-emerald-400 transition-colors rounded-br-lg"})}),Mn=({id:e,title:t,color:n,handleCursor:r,position:a,style:i,onMouseDown:s,onTouchStart:l})=>{const[c,d]=x.useState(!1),h=a==="left"?"left-full ml-1.5":"right-full mr-1.5",g={...i,position:"absolute",display:"flex",alignItems:"center",zIndex:16};return a==="left"?g.left="-10px":g.right="-10px",o.jsxs("div",{style:g,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[o.jsx("div",{id:e,onMouseDown:s,onTouchStart:l,className:`w-5 h-5 ${n} rounded-full border-2 border-gray-900 flex-shrink-0`,style:{cursor:r}}),o.jsx("div",{className:`absolute px-2 py-1 bg-gray-900 text-gray-200 text-xs font-medium whitespace-nowrap rounded shadow-xl z-[100] transition-opacity duration-200 pointer-events-none ${h} ${c?"opacity-100":"opacity-0"}`,role:"tooltip",children:t})]})},ks=40,di=10,vI=({node:e,getHandleColor:t,handleCursor:n,isCollapsed:r,t:a})=>{if(r){let c=[];if(e.type===S.SCRIPT_GENERATOR)c=[{handleId:"prompt",type:"text",title:a("node.content.scriptPromptPlaceholder")},{handleId:"characters",type:"text",title:a("node.content.characters")}];else if(e.type===S.SCRIPT_PROMPT_MODIFIER)c=[{handleId:"all-script-analyzer-data",type:"text",title:a("node.content.allScriptAnalyzerData")},{handleId:"style",type:"text",title:a("node.content.style")}];else if(e.type===S.SCRIPT_ANALYZER)c=[{handleId:void 0,type:"text",title:a("node.input.default")}];else{const d=Jr(e);(d!==null||e.type===S.REROUTE_DOT)&&(c=[{handleId:void 0,type:d,title:a("node.input.default")}])}return o.jsx(o.Fragment,{children:c.map((d,h)=>o.jsx(Mn,{id:`handle-in-${e.id}-${d.handleId||"default"}`,title:d.title,color:t(d.type,d.handleId),handleCursor:n,position:"left",style:{top:`${(h+1)*(ks/(c.length+1))}px`,transform:"translateY(-50%)"}},d.handleId||`input-${h}`))})}if(e.type===S.SCRIPT_GENERATOR){const c=[{handleId:"prompt",title:a("node.content.scriptPromptPlaceholder"),y_pos:95},{handleId:"characters",title:a("node.content.characters"),y_pos:330}];return o.jsx(o.Fragment,{children:c.map(d=>{const h=Math.max(ks+di,Math.min(d.y_pos,e.height-di));return o.jsx(Mn,{id:`handle-in-${e.id}-${d.handleId}`,title:d.title,color:t("text",d.handleId),handleCursor:n,position:"left",style:{top:`${h}px`,transform:"translateY(-50%)"}},d.handleId)})})}if(e.type===S.SCRIPT_PROMPT_MODIFIER){const c=[{handleId:"all-script-analyzer-data",title:a("node.content.allScriptAnalyzerData"),y_pos_ratio:.3333333333333333},{handleId:"style",title:a("node.content.style"),y_pos_ratio:.6666666666666666}];return o.jsx(o.Fragment,{children:c.map(d=>{const h=e.height*d.y_pos_ratio,g=Math.max(ks+di,Math.min(h,e.height-di));return o.jsx(Mn,{id:`handle-in-${e.id}-${d.handleId}`,title:d.title,color:t("text",d.handleId),handleCursor:n,position:"left",style:{top:`${g}px`,transform:"translateY(-50%)"}},d.handleId)})})}const i=Jr(e);if(i===null&&e.type!==S.REROUTE_DOT)return null;const s=e.height/2,l=Math.max(ks/2,Math.min(s,e.height-di));return o.jsx(Mn,{id:`handle-in-${e.id}-default`,title:a("node.input.default"),color:t(i,void 0),handleCursor:n,position:"left",style:{top:`${l}px`,transform:"translateY(-50%)"}})},nn=40,ia=12,vn=10,bI=({node:e,getHandleColor:t,handleCursor:n,onOutputHandleMouseDown:r,onOutputHandleTouchStart:a,isCollapsed:i,t:s})=>{if(e.areOutputHandlesHidden)return null;let l=[];const c=Ua(e);if(i){if(e.type===S.PROMPT_ANALYZER){let d=[];try{d=JSON.parse(e.value||"{}").characters||[]}catch{}l=["environment",...Array.from({length:Math.max(1,d.length)},(g,m)=>`character-${m}`),"action","style"].map(g=>({handleId:g,type:"text",title:g.replace("-"," ")}))}else if(e.type===S.CHARACTER_ANALYZER)l=[{handleId:"character",type:"text",title:"Character"},{handleId:"clothing",type:"text",title:"Clothing"}];else if(e.type===S.SCRIPT_GENERATOR){l.push({handleId:"all-script-parts",type:"text",title:s("node.content.allScriptParts")});let d={};try{d=JSON.parse(e.value||"{}")}catch{}(d.scenes||[]).some(m=>m.narratorText&&m.narratorText.trim()!=="")&&l.push({handleId:"all-narrator-text",type:"text",title:s("node.content.allNarratorData")})}else e.type===S.CHARACTER_CARD?l=[{handleId:"all-characters",type:"text",title:s("node.output.allCharacters")},{handleId:"primary-character",type:"text",title:s("node.output.primaryCharacter")}]:(c!==null||e.type===S.REROUTE_DOT)&&(l=[{handleId:void 0,type:c,title:s("node.output.default")}]);return o.jsx(o.Fragment,{children:l.map((d,h)=>o.jsx(Mn,{id:`handle-out-${e.id}-${d.handleId||"default"}`,title:d.title,color:t(d.type,d.handleId),handleCursor:n,position:"right",style:{top:`${(h+1)*(nn/(l.length+1))}px`,transform:"translateY(-50%)"},onMouseDown:g=>{g.stopPropagation(),r(g,e.id,d.handleId)},onTouchStart:g=>{g.stopPropagation(),a(g,e.id,d.handleId)}},d.handleId||`output-${h}`))})}switch(e.type){case S.PROMPT_ANALYZER:let d=[];try{d=JSON.parse(e.value||"{}").characters||[]}catch{}const h=Math.max(1,d.length),g=3+h,m=["environment",...Array.from({length:h},(A,k)=>`character-${k}`),"action","style"],_=40,y=8,v=nn+ia,w=e.height-ia-_-y-v;return o.jsx(o.Fragment,{children:m.map((A,k)=>{const P=v+w/g*(k+.5),M=Math.max(nn+vn,Math.min(P,e.height-vn));return o.jsx(Mn,{id:`handle-out-${e.id}-${A}`,title:A.replace("-"," "),color:t("text",A),handleCursor:n,position:"right",style:{top:`${M}px`,transform:"translateY(-50%)"},onMouseDown:H=>{H.stopPropagation(),r(H,e.id,A)},onTouchStart:H=>{H.stopPropagation(),a(H,e.id,A)}},A)})});case S.CHARACTER_ANALYZER:const b=["character","clothing"],f=2,T=40,I=8,E=nn+ia,N=e.height-ia-T-I-E;return o.jsx(o.Fragment,{children:b.map((A,k)=>{const P=E+N/f*(k+.5),M=Math.max(nn+vn,Math.min(P,e.height-vn));return o.jsx(Mn,{id:`handle-out-${e.id}-${A}`,title:A,color:t("text",A),handleCursor:n,position:"right",style:{top:`${M}px`,transform:"translateY(-50%)"},onMouseDown:H=>{H.stopPropagation(),r(H,e.id,A)},onTouchStart:H=>{H.stopPropagation(),a(H,e.id,A)}},A)})});case S.CHARACTER_GENERATOR:{let A=[];try{A=JSON.parse(e.value||"{}").characters||[]}catch{}const k=[];A.forEach((H,W)=>{const O=H.id?`character-${H.id}`:`character-${W}`;k.push({handleId:O,title:H.name||`${s("node.content.character")} ${W+1}`})});const P=k.length,M=e.height-nn;return P===0?null:o.jsx(o.Fragment,{children:k.map(({handleId:H,title:W},O)=>{const U=nn+M/(P+1)*(O+1),z=Math.max(nn+vn,Math.min(U,e.height-vn));return o.jsx(Mn,{id:`handle-out-${e.id}-${H}`,title:W,color:t("text",H),handleCursor:n,position:"right",style:{top:`${z}px`,transform:"translateY(-50%)"},onMouseDown:L=>{L.stopPropagation(),r(L,e.id,H)},onTouchStart:L=>{L.stopPropagation(),a(L,e.id,H)}},H)})})}case S.SCRIPT_GENERATOR:{const A=Ry(e,s);return o.jsx(o.Fragment,{children:Array.from(A.entries()).map(([k,{y:P,title:M}])=>{const H=Math.max(nn+vn,Math.min(P,e.height-vn));return o.jsx(Mn,{id:`handle-out-${e.id}-${k}`,title:M,color:t("text",k),handleCursor:n,position:"right",style:{top:`${H}px`,transform:"translateY(-50%)"},onMouseDown:W=>{W.stopPropagation(),r(W,e.id,k)},onTouchStart:W=>{W.stopPropagation(),a(W,e.id,k)}},k)})})}case S.SCRIPT_ANALYZER:{let A={characters:[],scenes:[]};try{A=JSON.parse(e.value||"{}")}catch{}const{characters:k=[],scenes:P=[]}=A,M=[];M.push({handleId:"all-script-analyzer-data",title:s("node.content.allScriptAnalyzerData")}),P.some(U=>U.narratorText)&&M.push({handleId:"all-narrator-data",title:s("node.content.allNarratorData")}),k.forEach((U,z)=>{const L=U.id||`char-idx-${z}`;M.push({handleId:`character-${L}`,title:U.name||`${s("node.content.character")} ${z+1}`})});const W=M.length,O=e.height-nn;return o.jsx(o.Fragment,{children:M.map(({handleId:U,title:z},L)=>{const D=nn+O/(W+1)*(L+1),G=Math.max(nn+vn,Math.min(D,e.height-vn));return o.jsx(Mn,{id:`handle-out-${e.id}-${U}`,title:z,color:t("text",U),handleCursor:n,position:"right",style:{top:`${G}px`,transform:"translateY(-50%)"},onMouseDown:q=>{q.stopPropagation(),r(q,e.id,U)},onTouchStart:q=>{q.stopPropagation(),a(q,e.id,U)}},U)})})}case S.SCRIPT_PROMPT_MODIFIER:{let A={finalPrompts:[]};try{A=JSON.parse(e.value||"{}")}catch{}const{finalPrompts:k=[]}=A,P=k.map(W=>({handleId:`final-prompt-${W.frameNumber}`,title:`${s("node.content.finalPrompt")} - ${s("node.content.frame")} ${W.frameNumber}`})),M=P.length,H=e.height-nn;return M===0?null:o.jsx(o.Fragment,{children:P.map(({handleId:W,title:O},U)=>{const z=nn+H/(M+1)*(U+1),L=Math.max(nn+vn,Math.min(z,e.height-vn));return o.jsx(Mn,{id:`handle-out-${e.id}-${W}`,title:O,color:t("text",W),handleCursor:n,position:"right",style:{top:`${L}px`,transform:"translateY(-50%)"},onMouseDown:D=>{D.stopPropagation(),r(D,e.id,W)},onTouchStart:D=>{D.stopPropagation(),a(D,e.id,W)}},W)})})}case S.NARRATOR_TEXT_GENERATOR:{let A={};try{A=JSON.parse(e.value||"{}").targetLanguages||{}}catch{}const k=Object.entries(A).filter(([,G])=>G).map(([G])=>G);if(k.length===0)return null;const P=k.length,M=60,H=96,W=40,O=8,U=M+O+H+O+W,z=nn+ia+U+O,D=e.height-ia-z;if(D<=20*P){const G=e.height-z,q=z;return o.jsx(o.Fragment,{children:k.map((ie,te)=>{const ye=q+G/(P+1)*(te+1),ue=ie==="ru"?" ":"English Text";return o.jsx(Mn,{id:`handle-out-${e.id}-${ie}`,title:ue,color:t("text",ie),handleCursor:n,position:"right",style:{top:`${ye}px`,transform:"translateY(-50%)"},onMouseDown:$=>{$.stopPropagation(),r($,e.id,ie)},onTouchStart:$=>{$.stopPropagation(),a($,e.id,ie)}},ie)})})}return o.jsx(o.Fragment,{children:k.map((G,q)=>{const ie=z+D/P*(q+.5),te=Math.max(nn+vn,Math.min(ie,e.height-vn)),ye=G==="ru"?" ":"English Text";return o.jsx(Mn,{id:`handle-out-${e.id}-${G}`,title:ye,color:t("text",G),handleCursor:n,position:"right",style:{top:`${te}px`,transform:"translateY(-50%)"},onMouseDown:ue=>{ue.stopPropagation(),r(ue,e.id,G)},onTouchStart:ue=>{ue.stopPropagation(),a(ue,e.id,G)}},G)})})}case S.YOUTUBE_TITLE_GENERATOR:{let A={};try{A=JSON.parse(e.value||"{}").targetLanguages||{}}catch{}const k=Object.entries(A).filter(([,H])=>H).map(([H])=>H);if(k.length===0)return null;const P=k.length,M=e.height-nn;return o.jsx(o.Fragment,{children:k.map((H,W)=>{const O=nn+M/(P+1)*(W+1),U=Math.max(nn+vn,Math.min(O,e.height-vn)),z=s("youtube_title_generator.title")+(H==="ru"?" (RU)":" (EN)");return o.jsx(Mn,{id:`handle-out-${e.id}-${H}`,title:z,color:t("text",H),handleCursor:n,position:"right",style:{top:`${U}px`,transform:"translateY(-50%)"},onMouseDown:L=>{L.stopPropagation(),r(L,e.id,H)},onTouchStart:L=>{L.stopPropagation(),a(L,e.id,H)}},H)})})}case S.CHARACTER_CARD:{const A=[{handleId:"all-characters",type:"text",title:s("node.output.allCharacters")},{handleId:"primary-character",type:"text",title:s("node.output.primaryCharacter")}],k=e.height-nn,P=A.length;return o.jsx(o.Fragment,{children:A.map((M,H)=>{const W=nn+k/(P+1)*(H+1),O=Math.max(nn+vn,Math.min(W,e.height-vn));return o.jsx(Mn,{id:`handle-out-${e.id}-${M.handleId}`,title:M.title,color:t("text",M.handleId),handleCursor:n,position:"right",style:{top:`${O}px`,transform:"translateY(-50%)"},onMouseDown:U=>{U.stopPropagation(),r(U,e.id,M.handleId)},onTouchStart:U=>{U.stopPropagation(),a(U,e.id,M.handleId)}},M.handleId)})})}case S.IMAGE_GENERATOR:case S.TEXT_INPUT:case S.PROMPT_PROCESSOR:case S.TRANSLATOR:case S.ERROR_ANALYZER:case S.REROUTE_DOT:case S.AUDIO_TRANSCRIBER:case S.IDEA_GENERATOR:case S.MUSIC_IDEA_GENERATOR:case S.YOUTUBE_ANALYTICS:return c!==null||e.type===S.REROUTE_DOT?o.jsx(Mn,{id:`handle-out-${e.id}-default`,title:s("node.output.default"),color:t(c,void 0),handleCursor:n,position:"right",style:{top:"50%",transform:"translateY(-50%)"},onMouseDown:A=>{A.stopPropagation(),r(A,e.id,void 0)},onTouchStart:A=>{A.stopPropagation(),a(A,e.id,void 0)}}):null;default:return null}},vg=40,wI=e=>{const{node:t,onMouseDown:n,onTouchStart:r,onResizeMouseDown:a,onResizeTouchStart:i,activeTool:s,onOutputHandleMouseDown:l,onOutputHandleTouchStart:c,onNodeClick:d,isHovered:h,isSelected:g,isGrouped:m,onNodeMouseEnter:_,onNodeMouseLeave:y,onDeleteNode:v,onCutConnections:C,onCopyNodeValue:w,onPasteNodeValue:b,onValueChange:f,onReadData:T,connectingInfo:I,connectionTarget:E,lastAddedNodeId:R,isExecuting:N,isDragOverTarget:A,addToast:k,onDuplicateNode:P,onNodeDoubleClick:M,onDuplicateNodeEmpty:H,onRenameNode:W,inputData:O,onSaveCharacterCard:U,onLoadCharacterCard:z,onSaveCharacterToCatalog:L,setFullSizeImage:D,getFullSizeImage:G,setImageViewer:q,onCopyImageToClipboard:ie,onDownloadImage:te,onUpdateCharacterDescription:ye,isUpdatingDescription:ue,onModifyCharacter:$,isModifyingCharacter:ee,getUpstreamNodeValues:Te,onAddNode:le,onDownloadChat:J}=e,{t:ge}=Ht(),ae=t.type===S.REROUTE_DOT,ce=x.useMemo(()=>{if(!ae)return null;try{return JSON.parse(t.value||"{}").type||null}catch{return null}},[ae,t.value]),B=x.useMemo(()=>{switch(t.type){case S.TEXT_INPUT:return{minWidth:460,minHeight:280};case S.PROMPT_PROCESSOR:return{minWidth:460,minHeight:280};case S.PROMPT_ANALYZER:return{minWidth:460,minHeight:1e3};case S.CHARACTER_ANALYZER:return{minWidth:460,minHeight:500};case S.CHARACTER_GENERATOR:return{minWidth:460,minHeight:1e3};case S.IMAGE_GENERATOR:return{minWidth:400,minHeight:520};case S.IMAGE_PREVIEW:return{minWidth:300,minHeight:400};case S.CHARACTER_CARD:return{minWidth:460,minHeight:1e3};case S.GEMINI_CHAT:return{minWidth:400,minHeight:640};case S.TRANSLATOR:return{minWidth:380,minHeight:640};case S.SCRIPT_GENERATOR:return{minWidth:680,minHeight:800};case S.SCRIPT_ANALYZER:return{minWidth:680,minHeight:800};case S.SCRIPT_PROMPT_MODIFIER:return{minWidth:680,minHeight:800};case S.ERROR_ANALYZER:return{minWidth:380,minHeight:280};case S.DATA_READER:return{minWidth:380,minHeight:280};case S.NOTE:return{minWidth:440,minHeight:640};case S.SPEECH_SYNTHESIZER:return{minWidth:680,minHeight:800};case S.NARRATOR_TEXT_GENERATOR:return{minWidth:680,minHeight:800};case S.IDEA_GENERATOR:return{minWidth:680,minHeight:800};case S.AUDIO_TRANSCRIBER:return{minWidth:400,minHeight:480};case S.YOUTUBE_TITLE_GENERATOR:return{minWidth:680,minHeight:800};case S.MUSIC_IDEA_GENERATOR:return{minWidth:680,minHeight:800};case S.YOUTUBE_ANALYTICS:return{minWidth:1200,minHeight:800};case S.REROUTE_DOT:return{minWidth:60,minHeight:40};default:return{minWidth:200,minHeight:150}}},[t.type]),X=ze=>n(ze,t.id),F=ze=>r(ze,t.id),Y=ze=>{s==="cutter"&&(ze.stopPropagation(),ze.preventDefault(),d(t.id))},K=s==="edit"?"crosshair":"inherit",V=()=>{const ze={...e,nodes:e.nodes,connections:e.connections,t:ge,handleCursor:K,isEnhancing:e.isEnhancing===t.id,isAnalyzing:e.isAnalyzing===t.id,isAnalyzingCharacter:e.isAnalyzingCharacter===t.id,isStopping:e.stoppingNodes.has(t.id),onRemoveConnection:e.removeConnectionById,getUpstreamTextValue:e.getUpstreamTextValue,addToast:e.addToast,isGeneratingIdeaCategories:e.isGeneratingIdeaCategories===t.id,isCombiningStoryIdea:e.isCombiningStoryIdea===t.id,isTranscribingAudio:e.isTranscribingAudio===t.id,isGeneratingYouTubeTitles:e.isGeneratingYouTubeTitles===t.id,isGeneratingYouTubeChannelInfo:e.isGeneratingYouTubeChannelInfo===t.id,isGeneratingMusicIdeas:e.isGeneratingMusicIdeas===t.id,isExtractingText:e.isExtractingText===t.id,isAnalyzingYouTubeStats:e.isAnalyzingYouTubeStats===t.id,isImprovingScriptConcept:e.isImprovingScriptConcept===t.id,isGeneratingEntities:e.isGeneratingEntities===t.id?e.isGeneratingEntities:null,inputData:O,onSaveCharacterCard:U,onLoadCharacterCard:z,onSaveCharacterToCatalog:L,setFullSizeImage:D,getFullSizeImage:G,setImageViewer:q,onCopyImageToClipboard:ie,onDownloadImage:te,onUpdateCharacterDescription:ye,isUpdatingDescription:e.isUpdatingDescription===t.id?e.isUpdatingDescription:null,onModifyCharacter:$,isModifyingCharacter:e.isModifyingCharacter===t.id?e.isModifyingCharacter:null,getUpstreamNodeValues:Te,onAddNode:le,onDeleteNode:v};switch(t.type){case S.REROUTE_DOT:return o.jsx(u5,{...ze});case S.NOTE:return o.jsx(l5,{...ze});case S.TRANSLATOR:return o.jsx(F5,{...ze});case S.GEMINI_CHAT:return o.jsx(a5,{...ze});case S.SCRIPT_GENERATOR:return o.jsx(k5,{...ze});case S.SCRIPT_ANALYZER:return o.jsx(w5,{...ze});case S.SCRIPT_PROMPT_MODIFIER:return o.jsx(L5,{...ze});case S.CHARACTER_GENERATOR:return o.jsx(o5,{...ze});case S.CHARACTER_CARD:return o.jsx(e5,{...ze});case S.IMAGE_GENERATOR:return o.jsx(i5,{...ze});case S.IMAGE_PREVIEW:return o.jsx(s5,{...ze});case S.ERROR_ANALYZER:return o.jsx(r5,{...ze});case S.DATA_READER:return o.jsx(z5,{...ze});case S.SPEECH_SYNTHESIZER:return o.jsx(U5,{...ze});case S.NARRATOR_TEXT_GENERATOR:return o.jsx(q5,{...ze});case S.IDEA_GENERATOR:return o.jsx(V5,{...ze});case S.AUDIO_TRANSCRIBER:return o.jsx(Z5,{...ze});case S.YOUTUBE_TITLE_GENERATOR:return o.jsx(nI,{...ze});case S.MUSIC_IDEA_GENERATOR:return o.jsx(iI,{...ze});case S.YOUTUBE_ANALYTICS:return o.jsx(gI,{...ze});case S.TEXT_INPUT:return o.jsx(O5,{...ze});case S.PROMPT_ANALYZER:return o.jsx(c5,{...ze});case S.CHARACTER_ANALYZER:return o.jsx(MA,{...ze});case S.PROMPT_PROCESSOR:return o.jsx(d5,{...ze});default:return null}},oe=(E==null?void 0:E.nodeId)===t.id;let de="border-gray-700";A?de="border-emerald-400":oe?de="border-green-400":N?de="border-yellow-500":g?de="border-emerald-400":ae&&(ce==="text"?de="border-emerald-500":ce==="image"&&(de="border-cyan-500"));const Z=s==="cutter"?`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="%23ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>') 12 12, auto`:"default",Q=ae?ce==="text"?"bg-emerald-900/30":ce==="image"?"bg-cyan-900/30":"bg-gray-600":t.type===S.NOTE?"bg-gray-900/70 backdrop-blur-sm":"bg-gray-800",j=(ze,nt)=>{let at=ze;ae&&(at=ce);let xe;return at==="text"?xe="bg-emerald-400":at==="image"?xe="bg-cyan-400":xe="bg-gray-400",!I||!h&&!ae?xe:oe&&(t.type===S.REROUTE_DOT||I.fromType===Jr(t))?"bg-green-500":h?"bg-red-500 cursor-not-allowed":xe},fe=t.id===R,Pe="absolute flex flex-col transition-colors duration-200 pointer-events-auto",je="rounded-lg",ke="p-3",$e=g?50:m?6:20;return o.jsxs("div",{className:`${Pe} ${Q} ${je} ${fe?"node-newly-added":""} ${ae?"cursor-move":""}`,style:{transform:`translate3d(${t.position.x}px, ${t.position.y}px, 0)`,width:t.width,height:t.isCollapsed?`${vg}px`:t.height,minWidth:ae?void 0:`${B.minWidth}px`,minHeight:t.isCollapsed?`${vg}px`:ae?void 0:`${B.minHeight}px`,zIndex:$e,cursor:Z,backfaceVisibility:"hidden"},onClick:Y,onMouseEnter:()=>_(t.id),onMouseLeave:y,onMouseDown:ae?X:void 0,onTouchStart:ae?F:void 0,onContextMenu:ze=>ze.stopPropagation(),onWheel:ze=>ze.stopPropagation(),children:[o.jsx("div",{className:`absolute inset-0 border-2 ${de} rounded-lg pointer-events-none`,style:{zIndex:12}}),o.jsx(yI,{node:t,t:ge,addToast:k,onMouseDown:X,onTouchStart:F,onNodeDoubleClick:M,onValueChange:f,onReadData:T,onPasteNodeValue:b,onCopyNodeValue:w,onCutConnections:C,onDeleteNode:v,onDuplicateNode:P,onDuplicateNodeEmpty:H,onRenameNode:W,onDownloadChat:J}),!ae&&!t.isCollapsed&&o.jsx("div",{className:`${ke} flex-grow min-h-0`,children:V()}),o.jsx(vI,{node:t,getHandleColor:j,handleCursor:K,t:ge,isHovered:h,isCollapsed:t.isCollapsed}),o.jsx(bI,{node:t,getHandleColor:j,handleCursor:K,t:ge,isHovered:h,isCollapsed:t.isCollapsed,onOutputHandleMouseDown:l,onOutputHandleTouchStart:c}),!ae&&!t.isCollapsed&&o.jsx(xI,{onResizeMouseDown:ze=>a(ze,t.id),onResizeTouchStart:ze=>i(ze,t.id)})]})};function _I(e,t){return!(e.node!==t.node||e.isSelected!==t.isSelected||e.isGrouped!==t.isGrouped||e.isHovered!==t.isHovered||e.isExecuting!==t.isExecuting||e.isEnhancing!==t.isEnhancing||e.isAnalyzing!==t.isAnalyzing||e.isAnalyzingCharacter!==t.isAnalyzingCharacter||e.isExecutingChain!==t.isExecutingChain||e.isChatting!==t.isChatting||e.isTranslating!==t.isTranslating||e.isFixingErrors!==t.isFixingErrors||e.isReadingData!==t.isReadingData||e.isGeneratingScript!==t.isGeneratingScript||e.isGeneratingEntities!==t.isGeneratingEntities||e.isModifyingScriptPart!==t.isModifyingScriptPart||e.isAnalyzingScript!==t.isAnalyzingScript||e.isGeneratingCharacters!==t.isGeneratingCharacters||e.isGeneratingImage!==t.isGeneratingImage||e.isGeneratingCharacterImage!==t.isGeneratingCharacterImage||e.isModifyingScriptPrompts!==t.isModifyingScriptPrompts||e.isGeneratingSpeech!==t.isGeneratingSpeech||e.isGeneratingIdeaCategories!==t.isGeneratingIdeaCategories||e.isCombiningStoryIdea!==t.isCombiningStoryIdea||e.isGeneratingNarratorText!==t.isGeneratingNarratorText||e.isTranscribingAudio!==t.isTranscribingAudio||e.isGeneratingYouTubeTitles!==t.isGeneratingYouTubeTitles||e.isGeneratingYouTubeChannelInfo!==t.isGeneratingYouTubeChannelInfo||e.isGeneratingMusicIdeas!==t.isGeneratingMusicIdeas||e.isExtractingText!==t.isExtractingText||e.isAnalyzingYouTubeStats!==t.isAnalyzingYouTubeStats||e.isImprovingScriptConcept!==t.isImprovingScriptConcept||e.isUpdatingDescription!==t.isUpdatingDescription||e.isModifyingCharacter!==t.isModifyingCharacter||e.inputData!==t.inputData||e.activeTool!==t.activeTool||e.connections!==t.connections||e.connectionTarget!==t.connectionTarget||e.isDragOverTarget!==t.isDragOverTarget||e.connectingInfo!==t.connectingInfo||e.lastAddedNodeId!==t.lastAddedNodeId||e.clearSelectionsSignal!==t.clearSelectionsSignal)}const CI=_t.memo(wI,_I),SI=({connection:e,fromNode:t,start:n,end:r,isNodeHovered:a,activeTool:i,onDelete:s,onSplit:l,lineStyle:c})=>{const[d,h]=x.useState(!1),g=c==="orthogonal"?`M ${n.x} ${n.y} L ${(n.x+r.x)/2} ${n.y} L ${(n.x+r.x)/2} ${r.y} L ${r.x} ${r.y}`:`M ${n.x} ${n.y} C ${n.x+80} ${n.y}, ${r.x-80} ${r.y}, ${r.x} ${r.y}`,m=Ua(t,e.fromHandleId);let _;m==="text"?_="#34d399":m==="image"?_="#22d3ee":_="#6b7280";const y=i==="cutter",v=i==="reroute",C=(y||v)&&(d||a),w=y&&C?"#ef4444":v&&C?"#10b981":_,b=C?5:3;let f="default";y&&(d||a)?f=`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="%23ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"></path><path d="M6 6l12 12"></path></svg>') 12 12, auto`:v&&d?f="crosshair":(y||v)&&(f="pointer");const T=I=>{I.stopPropagation(),y?s(e.id):v&&l(e.id,I)};return o.jsxs("g",{onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),onClick:T,onContextMenu:I=>I.stopPropagation(),style:{cursor:f,pointerEvents:"auto"},children:[o.jsx("path",{d:g,stroke:"transparent",strokeWidth:"20",fill:"none",style:{pointerEvents:"stroke"}}),o.jsx("path",{d:g,stroke:w,strokeWidth:b,fill:"none",style:{pointerEvents:"none",transition:"stroke 0.2s ease-in-out, stroke-width 0.2s ease-in-out"}}),o.jsx("path",{d:g,stroke:"white",strokeWidth:"2",fill:"none",className:"connection-flow",style:{pointerEvents:"none"}})]})},TI=_t.memo(SI),EI=({group:e,onMouseDown:t,onTouchStart:n,onClose:r,onRename:a,onSaveToCatalog:i,onSaveToDisk:s,onCopy:l,onDuplicate:c,isHoveredForDrop:d,isBeingDragged:h})=>{const{t:g}=Ht(),m=h?"border-solid border-emerald-400":d?"border-solid border-emerald-400 ring-2 ring-emerald-400/50":"border-dashed border-gray-500";return o.jsx("div",{className:`absolute bg-white/5 border-2 ${m} rounded-lg transition-colors duration-200 pointer-events-auto`,style:{transform:`translate3d(${e.position.x}px, ${e.position.y}px, 0)`,width:e.width,height:e.height,zIndex:5,backfaceVisibility:"hidden"},children:o.jsxs("div",{className:"bg-gray-700/50 text-white font-bold p-2 rounded-t-md flex justify-between items-center cursor-move pointer-events-auto",onMouseDown:t,onTouchStart:y=>n(y,e.id),onDoubleClick:()=>a(e.id,e.title),onContextMenu:y=>y.stopPropagation(),children:[o.jsx("span",{className:"truncate pr-2",children:e.title}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ie,{title:g("group.rename"),onClick:()=>a(e.id,e.title),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),o.jsx(Ie,{title:g("node.action.copy"),onClick:()=>l(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),o.jsx(Ie,{title:g("node.action.duplicateWithContent"),onClick:()=>c(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),o.jsx(Ie,{title:g("group.saveToCatalog"),onClick:()=>i(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1-4l-3 3-3-3m3 3V3"})})}),o.jsx(Ie,{title:g("group.saveToDisk"),onClick:()=>s(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),o.jsx(Ie,{title:g("group.ungroup"),onClick:y=>r(e.id,y),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]})})},NI=_t.memo(EI),kI=({children:e})=>{const t=or(),n=x.useRef(null),r=x.useRef(null);if(!t)return null;const{viewTransform:a,handleCanvasMouseDown:i,handleCanvasContextMenu:s,updatePointerPosition:l,handleWheel:c,handleCanvasDoubleClick:d,handleDrop:h,handleDragOver:g,handleDragLeave:m,getCanvasCursor:_,handleCanvasTouchStart:y,handleCanvasTouchMove:v,handleCanvasTouchEnd:C,isDraggingOverCanvas:w,openContextMenu:b,connections:f,nodes:T,groups:I,creationLine:E,selectionRect:R,groupButtonPosition:N,hoveredNodeId:A,selectedNodeIds:k,effectiveTool:P,lineStyle:M,hoveredGroupIdForDrop:H,draggingInfo:W,getConnectionPoints:O,removeConnectionById:U,handleSplitConnection:z,handleGroupMouseDown:L,handleGroupTouchStart:D,handleRenameGroup:G,handleRemoveGroup:q,handleSaveGroupToCatalog:ie,handleSaveGroupToDisk:te,handleCopyGroup:ye,handleDuplicateGroup:ue,handleNodeMouseDown:$,handleNodeTouchStart:ee,handleNodeResizeMouseDown:Te,handleNodeResizeTouchStart:le,handleValueChange:J,handleEnhance:ge,isEnhancing:ae,handleAnalyzePrompt:ce,isAnalyzing:B,handleAnalyzeCharacter:X,isAnalyzingCharacter:F,handleExecuteChain:Y,handleExecuteFullChain:K,isExecutingChain:V,executingNodeId:oe,stopGeneration:de,stoppingNodes:Z,handleSendMessage:Q,isChatting:j,handleTranslate:fe,isTranslating:Pe,handleGenerateScript:je,isGeneratingScript:ke,handleGenerateEntities:$e,isGeneratingEntities:ze,handleModifyScriptPart:nt,handleModifyAnalyzerFramePart:at,isModifyingScriptPart:xe,handleFixErrors:he,isFixingErrors:Ge,handleReadData:me,isReadingData:Oe,handleAnalyzeScript:De,isAnalyzingScript:Ce,handleGenerateCharacters:Qe,isGeneratingCharacters:pe,handleGenerateImage:Se,isGeneratingImage:Ee,handleGenerateCharacterImage:Fe,isGeneratingCharacterImage:be,handleModifyScriptPrompts:_e,isModifyingScriptPrompts:Ue,handleApplyAliases:We,handleDetachCharacter:gt,handleStartConnection:Et,handleStartConnectionTouchStart:It,handleNodeClick:Mt,setHoveredNodeId:xt,deleteNodeAndConnections:Ft,removeConnectionsByNodeId:cn,copyNodeValue:Bt,pasteNodeValue:en,handleDuplicateNode:ve,handleDuplicateNodeEmpty:Be,handleNodeDoubleClick:Je,connectedInputs:it,connectingInfo:ct,connectionTarget:jt,libraryItems:Nn,deselectAllNodes:Kt,dragOverNodeId:re,handleProcessChainForward:Le,lastAddedNodeId:Re,getUpstreamTextValue:Ke,addToast:dt,handleGenerateSpeech:rt,isGeneratingSpeech:St,handleGenerateIdeaCategories:Pt,isGeneratingIdeaCategories:Gt,handleCombineStoryIdea:se,isCombiningStoryIdea:Me,handleGenerateNarratorText:Ae,isGeneratingNarratorText:et,handleTranscribeAudio:pt,isTranscribingAudio:Lt,handleGenerateYouTubeTitles:sn,isGeneratingYouTubeTitles:Zt,handleGenerateYouTubeChannelInfo:On,isGeneratingYouTubeChannelInfo:xn,handleGenerateMusicIdeas:Cn,isGeneratingMusicIdeas:xo,handleExtractTextFromImage:vo,isExtractingText:Ir,onAnalyzeYouTubeStats:rr,isAnalyzingYouTubeStats:$a,saveDataToCatalog:Wa,handleRenameNode:Ya,clearSelectionsSignal:st,handleImproveScriptConcept:tt,isImprovingScriptConcept:Dt,t:un,pointerPosition:vt,setFullSizeImage:Po,getFullSizeImage:Pr,setImageViewer:qa,onCopyImageToClipboard:ea,onDownloadImage:Ka,onSaveCharacterCard:Yl,onLoadCharacterCard:ql,onSaveCharacterToCatalog:Kl,handleDownloadChat:Jl}=t,{visibleNodes:Xl,visibleConnections:Zl}=PA(T,f,a),Ql=x.useMemo(()=>{const ht=new Set;return I.forEach(gn=>gn.nodeIds.forEach(tn=>ht.add(tn))),ht},[I]),Zn=_t.useMemo(()=>ct?ct.fromType==="text"?"#34d399":ct.fromType==="image"?"#22d3ee":"#6b7280":"#6b7280",[ct]),ec=ht=>{if(ht.touches.length===1){n.current&&clearTimeout(n.current);const gn=ht.touches[0];r.current={x:gn.clientX,y:gn.clientY},n.current=window.setTimeout(()=>{r.current&&b(r.current),n.current=null},500)}y(ht)},Ja=ht=>{if(n.current&&r.current&&ht.touches.length>0){const gn=ht.touches[0].clientX-r.current.x,tn=ht.touches[0].clientY-r.current.y;Math.hypot(gn,tn)>10&&(clearTimeout(n.current),n.current=null)}v(ht)},Xa=ht=>{n.current&&(clearTimeout(n.current),n.current=null),C(ht)},tc=ht=>{const gn=f.filter(tn=>tn.toNodeId===ht);return gn.length===0?"":gn.map(tn=>{const Ro=T.find(Za=>Za.id===tn.fromNodeId);return Ro?Ro.value.length>2e3?`${tn.fromHandleId}:LEN_${Ro.value.length}_${Ro.value.substring(0,50)}`:`${tn.fromHandleId}:${Ro.value}`:""}).sort().join("||")};return o.jsxs("div",{id:"app-container",tabIndex:-1,className:`relative w-full h-full min-h-0 bg-gray-900 select-none outline-none ${w?"outline-4 outline-dashed outline-emerald-500 outline-offset-[-4px]":""}`,onMouseDown:i,onContextMenu:s,onMouseMove:l,onWheel:c,onDoubleClick:d,onDrop:h,onDragOver:g,onDragLeave:m,onTouchStart:ec,onTouchMove:Ja,onTouchEnd:Xa,style:{cursor:_(),touchAction:"none",overflow:"hidden"},children:[o.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundImage:"radial-gradient(rgba(52, 211, 153, 0.15) 1px, transparent 1px)",backgroundSize:"20px 20px"}}),e,o.jsxs("div",{id:"canvas-transform-layer",className:"pointer-events-none",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",transform:`translate3d(${a.translate.x}px, ${a.translate.y}px, 0) scale(${a.scale})`,transformOrigin:"0 0"},children:[o.jsxs("div",{className:"absolute pointer-events-none",style:{left:0,top:0,zIndex:0},children:[o.jsx("div",{className:"absolute bg-emerald-500/50",style:{width:"20px",height:"2px",left:"-10px",top:"-1px"}}),o.jsx("div",{className:"absolute bg-emerald-500/50",style:{width:"2px",height:"20px",left:"-1px",top:"-10px"}}),o.jsx("div",{className:"absolute text-[10px] text-emerald-500/50 font-mono select-none",style:{left:"4px",top:"4px"},children:"0,0"})]}),R&&o.jsx("div",{className:"absolute border-2 border-dashed border-emerald-400 bg-emerald-400/20 pointer-events-none",style:{left:R.x,top:R.y,width:R.width,height:R.height,zIndex:100}}),N&&o.jsxs("button",{onClick:ht=>{ht.stopPropagation(),t.handleGroupSelection()},className:"absolute z-20 px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 transition-colors duration-200 -translate-x-1/2 flex items-center space-x-2 pointer-events-auto shadow-lg",style:{left:N.x,top:N.y},children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z"})}),o.jsx("span",{children:un("group.button.create",{count:k.length})})]}),o.jsxs("svg",{className:"absolute top-0 left-0 w-full h-full overflow-visible pointer-events-none",style:{zIndex:9},children:[o.jsx("defs",{children:o.jsxs("filter",{id:"glow-connection",x:"-20%",y:"-20%",width:"140%",height:"140%",children:[o.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),o.jsx("feComposite",{in:"SourceGraphic",in2:"blur",operator:"over"})]})}),Zl.map(ht=>{const gn=T.find(ta=>ta.id===ht.fromNodeId),tn=T.find(ta=>ta.id===ht.toNodeId);if(!gn||!tn)return null;const{start:Ro,end:Za}=O(gn,tn,ht);return o.jsx(TI,{connection:ht,fromNode:gn,start:Ro,end:Za,isNodeHovered:P==="cutter"&&(A===ht.fromNodeId||A===ht.toNodeId),activeTool:P,onDelete:U,onSplit:z,lineStyle:M},ht.id)}),ct&&o.jsx("path",{d:`M ${ct.fromPoint.x} ${ct.fromPoint.y} C ${ct.fromPoint.x+80} ${ct.fromPoint.y}, ${vt.x-80} ${vt.y}, ${vt.x} ${vt.y}`,stroke:Zn,strokeWidth:"3",fill:"none",style:{strokeDasharray:"8 4"}}),E&&o.jsx("line",{x1:E.start.x,y1:E.start.y,x2:E.end.x,y2:E.end.y,stroke:"#34d399",strokeWidth:"2",className:"creation-line"})]}),I.map(ht=>{const gn=(W==null?void 0:W.type)==="group"&&W.id===ht.id||(W==null?void 0:W.type)==="node"&&ht.nodeIds.some(tn=>W.offsets.has(tn));return o.jsx(NI,{group:ht,onMouseDown:tn=>L(tn,ht.id),onTouchStart:tn=>D(tn,ht.id),onRename:G,onClose:q,onSaveToCatalog:ie,onSaveToDisk:te,onCopy:ye,onDuplicate:ue,isHoveredForDrop:H===ht.id,isBeingDragged:gn},ht.id)}),Xl.map(ht=>o.jsx(CI,{node:ht,nodes:T,connections:f,removeConnectionById:U,onMouseDown:$,onTouchStart:ee,onResizeMouseDown:Te,onResizeTouchStart:le,onValueChange:J,onEnhance:ge,isEnhancing:ae,onAnalyze:ce,isAnalyzing:B,onAnalyzeCharacter:X,isAnalyzingCharacter:F,onExecuteChain:Y,onExecuteFullChain:K,isExecutingChain:V,isExecuting:oe===ht.id,onStopGeneration:de,stoppingNodes:Z,onSendMessage:Q,isChatting:j,onTranslate:fe,isTranslating:Pe,onGenerateScript:je,isGeneratingScript:ke,onGenerateEntities:$e,isGeneratingEntities:ze,onModifyScriptPart:nt,isModifyingScriptPart:xe,onModifyAnalyzerFramePart:at,onFixErrors:he,isFixingErrors:Ge,onReadData:me,isReadingData:Oe,onAnalyzeScript:De,isAnalyzingScript:Ce,onGenerateCharacters:Qe,isGeneratingCharacters:pe,onGenerateImage:Se,isGeneratingImage:Ee,onGenerateCharacterImage:Fe,isGeneratingCharacterImage:be,onModifyScriptPrompts:_e,isModifyingScriptPrompts:Ue,onApplyAliases:We,onDetachCharacter:gt,activeTool:P,onOutputHandleMouseDown:Et,onOutputHandleTouchStart:It,onNodeClick:Mt,isHovered:A===ht.id,isSelected:k.includes(ht.id),isGrouped:Ql.has(ht.id),onNodeMouseEnter:gn=>xt(gn),onNodeMouseLeave:()=>xt(null),onDeleteNode:Ft,onCutConnections:cn,onCopyNodeValue:Bt,onPasteNodeValue:en,onDuplicateNode:ve,onDuplicateNodeEmpty:Be,onNodeDoubleClick:Je,connectedInputs:it.get(ht.id),connectingInfo:ct,connectionTarget:jt,libraryItems:Nn,deselectAllNodes:Kt,isDragOverTarget:re===ht.id,onProcessChainForward:Le,lastAddedNodeId:Re,getUpstreamTextValue:Ke,addToast:dt,onGenerateSpeech:rt,isGeneratingSpeech:St,onGenerateIdeaCategories:Pt,isGeneratingIdeaCategories:Gt,onCombineStoryIdea:se,isCombiningStoryIdea:Me,onGenerateNarratorText:Ae,isGeneratingNarratorText:et,onTranscribeAudio:pt,isTranscribingAudio:Lt,onGenerateYouTubeTitles:sn,isGeneratingYouTubeTitles:Zt,onGenerateYouTubeChannelInfo:On,isGeneratingYouTubeChannelInfo:xn,onGenerateMusicIdeas:Cn,isGeneratingMusicIdeas:xo,onExtractTextFromImage:vo,isExtractingText:Ir,onAnalyzeYouTubeStats:rr,isAnalyzingYouTubeStats:$a,saveDataToCatalog:Wa,onRenameNode:Ya,clearSelectionsSignal:st,onImproveScriptConcept:tt,isImprovingScriptConcept:Dt,inputData:tc(ht.id),setFullSizeImage:Po,getFullSizeImage:Pr,setImageViewer:qa,onCopyImageToClipboard:ea,onDownloadImage:Ka,onSaveCharacterCard:Yl,onLoadCharacterCard:ql,onSaveCharacterToCatalog:Kl,onDownloadChat:Jl},ht.id))]})]})},bt=({title:e,onClick:t,isActive:n=!1,children:r,tooltipPosition:a="top",customClasses:i,hoverBgClass:s,sizeClass:l="h-9 w-9"})=>{const c=`p-1.5 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center ${l}`,d="bg-emerald-600 text-white shadow-md",h=`bg-gray-700 ${s||"hover:bg-emerald-600"} text-gray-300 hover:text-white`,g=i?`${c} ${i}`:`${c} ${n?d:h}`;return o.jsx(lt,{title:e,position:a,children:o.jsx("button",{onClick:t,"aria-label":e,className:g,children:r})})},AI=({activeTool:e,onToolChange:t,onAddNode:n,onSaveCanvas:r,onSaveProject:a,onLoadCanvas:i,onOpenSearch:s,onOpenCatalog:l,viewTransform:c,setZoom:d,isSnapToGrid:h,setIsSnapToGrid:g,lineStyle:m,setLineStyle:_,handleClearCanvas:y})=>{const{t:v}=Ht(),[C,w]=_t.useState(!1),[b,f]=_t.useState(!1),[T,I]=_t.useState(!1),[E,R]=x.useState(!1),N=x.useRef(null);x.useEffect(()=>{const G=()=>{if(N.current){const ie=N.current.offsetWidth,te=(window.innerWidth-ie)/2;R(te<380)}else R(window.innerWidth<1400)};G(),window.addEventListener("resize",G);const q=new ResizeObserver(()=>G());return N.current&&q.observe(N.current),()=>{window.removeEventListener("resize",G),q.disconnect()}},[]);const[A,k]=x.useState(64),P=x.useRef(null),M=x.useRef(!1),H=x.useRef({y:0,initialTop:0}),W=G=>{G.preventDefault(),G.stopPropagation(),M.current=!0,H.current={y:G.clientY,initialTop:A},document.body.style.cursor="ns-resize",window.addEventListener("mousemove",O),window.addEventListener("mouseup",U)},O=G=>{var $;if(!M.current)return;const q=G.clientY-H.current.y,ie=(($=P.current)==null?void 0:$.offsetHeight)||200,te=56,ye=window.innerHeight-ie-56,ue=Math.max(te,Math.min(ye,H.current.initialTop+q));k(ue)},U=()=>{M.current=!1,document.body.style.cursor="default",window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",U)};x.useEffect(()=>()=>{window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",U)},[]);const z=G=>{d(G,{x:window.innerWidth/2,y:window.innerHeight/2})},L=G=>{const q=Number(G),ie=.2,te=2;if(q<1){const ue=Math.pow(1/ie,.01);return Math.log(q/ie)/Math.log(ue)-100}const ye=Math.pow(te,1/100);return Math.log(q)/Math.log(ye)},D=G=>{const q=Number(G),ie=.2,te=2;if(q<0){const ue=Math.pow(1/ie,.01);return Math.pow(ue,q+100)*ie}const ye=Math.pow(te,1/100);return Math.pow(ye,q)};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{ref:P,style:{top:`${A}px`},className:"absolute left-2 z-20 bg-gray-900/50 backdrop-blur-md p-1 rounded-lg shadow-lg flex flex-col items-center gap-1 border border-gray-700 select-none",onMouseDown:G=>G.stopPropagation(),children:[o.jsx("div",{onMouseDown:W,className:"w-full h-4 flex items-center justify-center cursor-ns-resize group hover:bg-gray-800/50 rounded-t-lg -mt-0.5 mb-1",title:"Drag to move",children:o.jsx("div",{className:"w-6 h-1 bg-gray-600 rounded-full group-hover:bg-gray-400 transition-colors"})}),o.jsx(bt,{sizeClass:"h-9 w-9",title:v("toolbar.edit"),onClick:()=>t("edit"),isActive:e==="edit",tooltipPosition:"right",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})}),o.jsx(bt,{sizeClass:"h-9 w-9",title:v("toolbar.cutter"),onClick:()=>t("cutter"),isActive:e==="cutter",tooltipPosition:"right",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),o.jsx(bt,{sizeClass:"h-9 w-9",title:v("toolbar.selection"),onClick:()=>t("selection"),isActive:e==="selection",tooltipPosition:"right",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})})}),o.jsx(bt,{sizeClass:"h-9 w-9",title:v("toolbar.reroute"),onClick:()=>t("reroute"),isActive:e==="reroute",tooltipPosition:"right",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 12h8m-8 0l4-4m-4 4l4 4m8 0h8m-8 0l4-4m-4 4l4 4"})})})]}),o.jsx("div",{className:`absolute bottom-2 left-14 right-14 z-20 flex justify-center pointer-events-none transition-transform duration-300 ease-in-out ${b?"translate-y-[calc(100%+8px)]":"translate-y-0"}`,children:o.jsxs("div",{className:"relative pointer-events-auto cursor-auto max-w-full",children:[o.jsxs("div",{className:"absolute -top-7 left-1/2 -translate-x-1/2 h-7 w-28 bg-gray-900/50 backdrop-blur-md border-t border-x border-gray-700 rounded-t-xl flex items-stretch overflow-hidden shadow-lg",children:[o.jsx("button",{onClick:()=>I(!T),className:`flex-1 flex items-center justify-center transition-colors border-r border-gray-700/50 ${T?"text-emerald-400 bg-emerald-900/20":"text-gray-400 hover:text-white hover:bg-gray-700"}`,title:v("toolbar.toggleHeaders"),children:T?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88"})}):o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),o.jsx("button",{onClick:()=>f(!b),className:"flex-1 flex items-center justify-center text-gray-400 hover:text-white hover:bg-gray-700 transition-all",title:v(b?"toolbar.expand":"toolbar.collapse"),children:b?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})]}),o.jsxs("div",{ref:N,className:"bg-gray-900/50 backdrop-blur-md p-1 rounded-lg shadow-lg flex flex-wrap justify-center items-center gap-x-2 gap-y-2 border border-gray-700",children:[o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:v("catalog.title")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(bt,{title:v("toolbar.addNode"),onClick:s,hoverBgClass:"hover:bg-emerald-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),o.jsx(bt,{title:v("toolbar.catalog"),onClick:l,hoverBgClass:"hover:bg-emerald-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:v("toolbar.group.general")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(bt,{title:v("toolbar.addNote"),onClick:()=>n(S.NOTE),hoverBgClass:"hover:bg-emerald-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})}),o.jsx(bt,{title:v("toolbar.addDataReader"),onClick:()=>n(S.DATA_READER),hoverBgClass:"hover:bg-emerald-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:v("toolbar.group.prompting")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(bt,{title:v("toolbar.addTextInput"),onClick:()=>n(S.TEXT_INPUT),hoverBgClass:"hover:bg-purple-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 6h8M12 6v12"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 3h-1a2 2 0 00-2 2v14a2 2 0 002 2h1m12-18h1a2 2 0 012 2v14a2 2 0 01-2 2h-1"})]})}),o.jsx(bt,{title:v("toolbar.addPromptProcessor"),onClick:()=>n(S.PROMPT_PROCESSOR),hoverBgClass:"hover:bg-purple-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672-2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})}),o.jsx(bt,{title:v("toolbar.addPromptAnalyzer"),onClick:()=>n(S.PROMPT_ANALYZER),hoverBgClass:"hover:bg-purple-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:v("toolbar.group.scripting")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(bt,{title:v("toolbar.addIdeaGenerator"),onClick:()=>n(S.IDEA_GENERATOR),hoverBgClass:"hover:bg-cyan-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.375 3.375 0 0112 18.375V19.5"})})}),o.jsx(bt,{title:v("toolbar.addScriptGenerator"),onClick:()=>n(S.SCRIPT_GENERATOR),hoverBgClass:"hover:bg-cyan-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})}),o.jsx(bt,{title:v("toolbar.addScriptAnalyzer"),onClick:()=>n(S.SCRIPT_ANALYZER),hoverBgClass:"hover:bg-cyan-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V6A2.25 2.25 0 0018.75 3.75H5.25A2.25 2.25 0 003 6v6"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75-.75h-.008a.75.75 0 01-.75-.75v-.008z"})]})}),o.jsx(bt,{title:v("toolbar.addScriptPromptModifier"),onClick:()=>n(S.SCRIPT_PROMPT_MODIFIER),hoverBgClass:"hover:bg-cyan-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.75l-1.125 1.125m1.125-1.125L16.125 11.5m2.25 1.25l1.125-1.125m-1.125 1.125l-1.125-1.125M15 6l-2.25 2.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 6l2.25-2.25M15 6l-2.25-2.25"})]})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:v("toolbar.group.characters")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(bt,{title:v("toolbar.addCharacterGenerator"),onClick:()=>n(S.CHARACTER_GENERATOR),hoverBgClass:"hover:bg-pink-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),o.jsx(bt,{title:v("toolbar.addCharacterAnalyzer"),onClick:()=>n(S.CHARACTER_ANALYZER),hoverBgClass:"hover:bg-pink-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})}),o.jsx(bt,{title:v("toolbar.addCharacterCard"),onClick:()=>n(S.CHARACTER_CARD),hoverBgClass:"hover:bg-pink-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 3.75H4.5A2.25 2.25 0 002.25 6v12A2.25 2.25 0 004.5 20.25h15A2.25 2.25 0 0021.75 18V6A2.25 2.25 0 0019.5 3.75z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 8.25a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 16.5c0-2.485 2.015-4.5 4.5-4.5s4.5 2.015 4.5 4.5"})]})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:v("toolbar.group.images")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(bt,{title:v("toolbar.addImageGenerator"),onClick:()=>n(S.IMAGE_GENERATOR),hoverBgClass:"hover:bg-yellow-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),o.jsx(bt,{title:v("toolbar.addImagePreview"),onClick:()=>n(S.IMAGE_PREVIEW),hoverBgClass:"hover:bg-yellow-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:v("toolbar.group.ai")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(bt,{title:v("toolbar.addTranslator"),onClick:()=>n(S.TRANSLATOR),hoverBgClass:"hover:bg-green-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})}),o.jsx(bt,{title:v("toolbar.addGeminiChat"),onClick:()=>n(S.GEMINI_CHAT),hoverBgClass:"hover:bg-green-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),o.jsx(bt,{title:v("toolbar.addErrorAnalyzer"),onClick:()=>n(S.ERROR_ANALYZER),hoverBgClass:"hover:bg-green-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:v("toolbar.group.audio")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(bt,{title:v("toolbar.addNarratorTextGenerator"),onClick:()=>n(S.NARRATOR_TEXT_GENERATOR),hoverBgClass:"hover:bg-blue-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h3M18 12h3"})]})}),o.jsx(bt,{title:v("toolbar.addSpeechSynthesizer"),onClick:()=>n(S.SPEECH_SYNTHESIZER),hoverBgClass:"hover:bg-blue-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})}),o.jsx(bt,{title:v("toolbar.addAudioTranscriber"),onClick:()=>n(S.AUDIO_TRANSCRIBER),hoverBgClass:"hover:bg-blue-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12h5m-5 3h5m-5 3h5"})]})}),o.jsx(bt,{title:v("toolbar.addMusicIdeaGenerator"),onClick:()=>n(S.MUSIC_IDEA_GENERATOR),hoverBgClass:"hover:bg-blue-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:v("toolbar.group.youtube")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(bt,{title:v("toolbar.addYouTubeTitleGenerator"),onClick:()=>n(S.YOUTUBE_TITLE_GENERATOR),hoverBgClass:"hover:bg-red-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-12v.75m0 3v.75m0 3v.75m0 3V18m-3 .75h18A2.25 2.25 0 0021 16.5V7.5A2.25 2.25 0 0018.75 5.25H5.25A2.25 2.25 0 003 7.5v9A2.25 2.25 0 005.25 18.75z"})})}),o.jsx(bt,{title:v("toolbar.addYouTubeAnalytics"),onClick:()=>n(S.YOUTUBE_ANALYTICS),hoverBgClass:"hover:bg-red-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})})]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[!T&&o.jsx("span",{className:"text-[10px] text-gray-400 font-semibold tracking-wide",children:v("toolbar.group.file")}),o.jsxs("div",{className:"flex items-center gap-1 p-0.5 rounded-md",children:[o.jsx(bt,{title:v("toolbar.saveProject"),onClick:a,hoverBgClass:"hover:bg-emerald-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"})})}),o.jsx(bt,{title:v("toolbar.saveCanvas"),onClick:r,hoverBgClass:"hover:bg-emerald-600",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"square",strokeLinejoin:"miter",children:[o.jsx("path",{d:"M17.2928932,3.29289322 L21,7 L21,20 C21,20.5522847 20.5522847,21 20,21 L4,21 C3.44771525,21 3,20.5522847 3,20 L3,4 C3,3.44771525 3.44771525,3 4,3 L16.5857864,3 C16.8510029,3 17.1053568,3.10535684 17.2928932,3.29289322 Z"}),o.jsx("rect",{width:"10",height:"8",x:"7",y:"13"}),o.jsx("rect",{width:"8",height:"5",x:"8",y:"3"})]})}),o.jsx(bt,{title:v("toolbar.loadCanvas"),onClick:i,hoverBgClass:"hover:bg-emerald-600",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"})})})]})]})]})]})}),o.jsxs("div",{className:`absolute bottom-2 left-2 z-20 bg-gray-900/50 backdrop-blur-md rounded-lg flex items-center border border-gray-700 shadow-lg pointer-events-auto p-1 
            ${C?"gap-0":"gap-1"} 
            ${E?"flex-col-reverse items-start":"flex-row"}
            max-h-[680px]:top-[calc(4rem+200px+0.5rem)] max-h-[680px]:bottom-auto`,children:[o.jsx("div",{className:"relative flex items-center",children:o.jsx(lt,{title:v(C?"toolbar.expand":"toolbar.collapse"),position:"right",children:o.jsx("button",{onClick:()=>w(!C),className:"h-9 w-9 flex-shrink-0 flex items-center justify-center rounded-md hover:bg-emerald-600 bg-gray-700 text-gray-300 hover:text-white transition-colors",children:C?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})})})}),!C&&o.jsxs("div",{className:`flex items-center gap-1 ${E?"flex-col-reverse":"flex-row"}`,children:[o.jsx(bt,{title:v("toolbar.zoom"),onClick:()=>t("zoom"),isActive:e==="zoom",tooltipPosition:E?"right":"top",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})}),o.jsxs("div",{className:`flex items-center space-x-2 px-2 h-9 ${E?"hidden":""}`,children:[o.jsx("input",{type:"range",min:"-100",max:"100",step:"1",value:L(c.scale),onChange:G=>z(D(parseFloat(G.target.value))),className:"w-24 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-emerald-500"}),o.jsx(lt,{title:v("toolbar.resetZoom"),position:"top",children:o.jsxs("button",{onClick:()=>z(1),className:"text-sm font-semibold text-gray-300 hover:text-white w-12 text-center hover:bg-emerald-600 rounded-md py-1 transition-colors",children:[Math.round(c.scale*100),"%"]})})]}),E&&o.jsx(bt,{title:v("toolbar.resetZoom"),onClick:()=>z(1),isActive:!1,tooltipPosition:E?"right":"top",children:o.jsxs("span",{className:"text-xs font-bold",children:[Math.round(c.scale*100),"%"]})}),o.jsx(bt,{title:v("toolbar.snapToGrid"),onClick:()=>g(G=>!G),isActive:h,tooltipPosition:E?"right":"top",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 20 20",children:[o.jsx("circle",{cx:"4",cy:"4",r:"1.5"}),o.jsx("circle",{cx:"10",cy:"4",r:"1.5"}),o.jsx("circle",{cx:"16",cy:"4",r:"1.5"}),o.jsx("circle",{cx:"4",cy:"10",r:"1.5"}),o.jsx("circle",{cx:"10",cy:"10",r:"1.5"}),o.jsx("circle",{cx:"16",cy:"10",r:"1.5"}),o.jsx("circle",{cx:"4",cy:"16",r:"1.5"}),o.jsx("circle",{cx:"10",cy:"16",r:"1.5"}),o.jsx("circle",{cx:"16",cy:"16",r:"1.5"})]})}),o.jsx(bt,{title:v("toolbar.lineStyleSpaghetti"),onClick:()=>_("spaghetti"),isActive:m==="spaghetti",tooltipPosition:E?"right":"top",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 6C6 12, 18 12, 18 18"})})}),o.jsx(bt,{title:v("toolbar.lineStyleOrthogonal"),onClick:()=>_("orthogonal"),isActive:m==="orthogonal",tooltipPosition:E?"right":"top",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 8h6v8h6"})})}),o.jsx(bt,{title:v("toolbar.clearCanvas"),onClick:y,customClasses:"bg-gray-700 hover:bg-red-600 text-gray-300 hover:text-white",tooltipPosition:E?"right":"top",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]})},II=_t.memo(AI),PI=({isOpen:e,onClose:t,onAddNode:n})=>{const{t:r}=Ht(),[a,i]=x.useState(""),[s,l]=x.useState(0),[c,d]=x.useState(!1),[h,g]=x.useState(!1),m=x.useRef(null),_=x.useRef(null),y=x.useMemo(()=>[{group:"input",type:S.TEXT_INPUT,title:r("search.node.text_input.title"),description:r("search.node.text_input.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 6h8M12 6v12"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 3h-1a2 2 0 00-2 2v14a2 2 0 002 2h1m12-18h1a2 2 0 012 2v14a2 2 0 01-2 2h-1"})]})},{group:"input",type:S.NOTE,title:r("search.node.note.title"),description:r("search.node.note.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})},{group:"scripting",type:S.IDEA_GENERATOR,title:r("search.node.idea_generator.title"),description:r("search.node.idea_generator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.375 3.375 0 0112 18.375V19.5"})})},{group:"scripting",type:S.SCRIPT_GENERATOR,title:r("search.node.script_generator.title"),description:r("search.node.script_generator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{group:"scripting",type:S.SCRIPT_ANALYZER,title:r("search.node.script_analyzer.title"),description:r("search.node.script_analyzer.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V6A2.25 2.25 0 0018.75 3.75H5.25A2.25 2.25 0 003 6v6"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75-.75h-.008a.75.75 0 01-.75-.75v-.008z"})]})},{group:"scripting",type:S.SCRIPT_PROMPT_MODIFIER,title:r("search.node.script_prompt_modifier.title"),description:r("search.node.script_prompt_modifier.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.75l-1.125 1.125m1.125-1.125L16.125 11.5m2.25 1.25l1.125-1.125m-1.125 1.125l-1.125-1.125M15 6l-2.25 2.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 6l2.25-2.25M15 6l-2.25-2.25"})]})},{group:"process",type:S.PROMPT_PROCESSOR,title:r("search.node.prompt_processor.title"),description:r("search.node.prompt_processor.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672-2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{group:"process",type:S.PROMPT_ANALYZER,title:r("search.node.prompt_analyzer.title"),description:r("search.node.prompt_analyzer.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{group:"process",type:S.DATA_READER,title:r("search.node.data_reader.title"),description:r("search.node.data_reader.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{group:"process",type:S.REROUTE_DOT,title:r("search.node.reroute_dot.title"),description:r("search.node.reroute_dot.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 12h8m-8 0l4-4m-4 4l4 4m8 0h8m-8 0l4-4m-4 4l4 4"})})},{group:"character",type:S.CHARACTER_GENERATOR,title:r("search.node.character_generator.title"),description:r("search.node.character_generator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})},{group:"character",type:S.CHARACTER_CARD,title:r("search.node.character_card.title"),description:r("search.node.character_card.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 3.75H4.5A2.25 2.25 0 002.25 6v12A2.25 2.25 0 004.5 20.25h15A2.25 2.25 0 0021.75 18V6A2.25 2.25 0 0019.5 3.75z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 8.25a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 16.5c0-2.485 2.015-4.5 4.5-4.5s4.5 2.015 4.5 4.5"})]})},{group:"character",type:S.CHARACTER_ANALYZER,title:r("search.node.character_analyzer.title"),description:r("search.node.character_analyzer.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})},{group:"images",type:S.IMAGE_GENERATOR,title:r("search.node.image_generator.title"),description:r("search.node.image_generator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})},{group:"images",type:S.IMAGE_PREVIEW,title:r("search.node.image_preview.title"),description:r("search.node.image_preview.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})},{group:"images",type:S.IMAGE_EDITOR,title:r("search.node.image_editor.title"),description:r("search.node.image_editor.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})})},{group:"ai",type:S.TRANSLATOR,title:r("search.node.translator.title"),description:r("search.node.translator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{group:"ai",type:S.GEMINI_CHAT,title:r("search.node.gemini_chat.title"),description:r("search.node.gemini_chat.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{group:"ai",type:S.ERROR_ANALYZER,title:r("search.node.error_analyzer.title"),description:r("search.node.error_analyzer.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{group:"ai",type:S.YOUTUBE_TITLE_GENERATOR,title:r("search.node.youtube_title_generator.title"),description:r("search.node.youtube_title_generator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-12v.75m0 3v.75m0 3v.75m0 3V18m-3 .75h18A2.25 2.25 0 0021 16.5V7.5A2.25 2.25 0 0018.75 5.25H5.25A2.25 2.25 0 003 7.5v9A2.25 2.25 0 005.25 18.75z"})})},{group:"ai",type:S.YOUTUBE_ANALYTICS,title:r("node.title.youtube_analytics"),description:r("node.help.youtube_analytics"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})},{group:"audio",type:S.SPEECH_SYNTHESIZER,title:r("search.node.speech_synthesizer.title"),description:r("search.node.speech_synthesizer.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})},{group:"audio",type:S.NARRATOR_TEXT_GENERATOR,title:r("search.node.narrator_text_generator.title"),description:r("search.node.narrator_text_generator.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h3M18 12h3"})]})},{group:"audio",type:S.AUDIO_TRANSCRIBER,title:r("search.node.audio_transcriber.title"),description:r("search.node.audio_transcriber.description"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12h5m-5 3h5m-5 3h5"})]})},{group:"audio",type:S.MUSIC_IDEA_GENERATOR,title:r("search.node.music_idea_generator.title"),description:r("search.node.music_idea_generator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})})},{group:"youtube",type:S.YOUTUBE_TITLE_GENERATOR,title:r("search.node.youtube_title_generator.title"),description:r("search.node.youtube_title_generator.description"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-12v.75m0 3v.75m0 3v.75m0 3V18m-3 .75h18A2.25 2.25 0 0021 16.5V7.5A2.25 2.25 0 0018.75 5.25H5.25A2.25 2.25 0 003 7.5v9A2.25 2.25 0 005.25 18.75z"})})},{group:"youtube",type:S.YOUTUBE_ANALYTICS,title:r("node.title.youtube_analytics"),description:r("node.help.youtube_analytics"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})}],[r]),v=x.useMemo(()=>({input:r("search.group.input"),process:r("search.group.process"),scripting:r("search.group.scripting"),character:r("search.group.character"),images:r("search.group.images"),ai:r("search.group.ai"),audio:r("search.group.audio"),youtube:r("search.group.youtube")}),[r]),C={input:"bg-purple-800/50 text-purple-300",process:"bg-green-800/50 text-green-300",scripting:"bg-cyan-800/50 text-cyan-300",character:"bg-pink-800/50 text-pink-300",images:"bg-yellow-800/50 text-yellow-300",ai:"bg-green-800/50 text-green-300",audio:"bg-blue-800/50 text-blue-300",youtube:"bg-red-800/50 text-red-300"},w=y.filter(f=>f.title.toLowerCase().includes(a.toLowerCase())||f.description.toLowerCase().includes(a.toLowerCase()));x.useEffect(()=>{if(e)d(!0),requestAnimationFrame(()=>g(!0)),setTimeout(()=>{var f;return(f=m.current)==null?void 0:f.focus()},50),i(""),l(0);else{g(!1);const f=setTimeout(()=>d(!1),200);return()=>clearTimeout(f)}},[e]),x.useEffect(()=>{var f;if(s>=0&&s<w.length){const T=(f=_.current)==null?void 0:f.querySelector(`[data-index="${s}"]`);T==null||T.scrollIntoView({block:"nearest"})}},[s,w]);const b=f=>{f.key==="Escape"?t():f.key==="ArrowDown"?(f.preventDefault(),l(T=>Math.min(T+1,w.length-1))):f.key==="ArrowUp"?(f.preventDefault(),l(T=>Math.max(T-1,0))):f.key==="Enter"&&(f.preventDefault(),w[s]&&(n(w[s].type),t()))};return c?o.jsx("div",{className:`fixed inset-0 bg-black/50 z-50 flex items-center justify-center transition-opacity duration-200 ease-out ${h?"opacity-100":"opacity-0"}`,onMouseDown:t,children:o.jsxs("div",{className:`bg-gray-800 rounded-lg w-full max-w-md border border-gray-700 flex flex-col transition-all duration-200 ease-out ${h?"scale-100 opacity-100":"scale-95 opacity-0"}`,onMouseDown:f=>f.stopPropagation(),onKeyDown:b,children:[o.jsx("div",{className:"p-4 border-b border-gray-700",children:o.jsx("input",{ref:m,type:"text",placeholder:r("search.placeholder"),value:a,onChange:f=>{i(f.target.value),l(0)},className:"w-full px-3 py-2 bg-gray-900 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500"})}),o.jsx("ul",{ref:_,className:"max-h-80 overflow-y-auto p-2",onWheel:f=>f.stopPropagation(),children:w.length>0?w.map((f,T)=>{const I=T>0?w[T-1]:null,E=!I||f.group!==I.group;return o.jsxs(_t.Fragment,{children:[E&&o.jsx("li",{className:`px-3 py-1 mt-2 mb-1 text-xs font-bold rounded ${C[f.group]} select-none list-none`,"aria-hidden":"true",children:v[f.group]}),o.jsxs("li",{"data-index":T,onClick:()=>{n(f.type),t()},onMouseEnter:()=>l(T),className:`flex items-center space-x-4 p-3 rounded-md cursor-pointer transition-colors duration-150 ${T===s?"bg-emerald-600":"hover:bg-gray-700"}`,children:[o.jsx("div",{className:`flex-shrink-0 w-8 h-8 flex items-center justify-center rounded ${T===s?"text-white":"text-gray-300"}`,children:f.icon}),o.jsxs("div",{children:[o.jsx("p",{className:`font-semibold ${T===s?"text-white":"text-gray-100"}`,children:f.title}),o.jsx("p",{className:`text-sm ${T===s?"text-emerald-100":"text-gray-400"}`,children:f.description})]})]})]},f.type)}):o.jsx("li",{className:"p-4 text-center text-gray-500",children:r("search.noResults")})})]})}):null},RI=({title:e,onClick:t,children:n})=>{const[r,a]=x.useState(!1);return o.jsxs("div",{className:"relative flex items-center",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[o.jsx("button",{onClick:i=>{i.stopPropagation(),t()},onMouseDown:i=>i.stopPropagation(),className:"flex items-center justify-center bg-gray-700 rounded-md hover:bg-emerald-600 transition-colors text-gray-300 hover:text-white w-9 h-9",children:n}),o.jsx("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 bg-gray-900 text-gray-100 text-sm whitespace-nowrap rounded-md shadow-xl z-50 transition-opacity duration-200 origin-bottom transform ${r?"opacity-100":"opacity-0 pointer-events-none"}`,role:"tooltip",children:e})]})},MI=({isOpen:e,position:t,onClose:n,onAddNode:r,onToolChange:a})=>{const{t:i}=Ht(),{isQuickAddPinned:s,toggleQuickAddPin:l,handlePasteFromClipboard:c}=or(),d=x.useRef(null),[h,g]=x.useState(t),[m,_]=x.useState(!1),y=x.useRef(!1),v=x.useRef({x:0,y:0});x.useLayoutEffect(()=>{if(e){const k=d.current?d.current.getBoundingClientRect():{width:300,height:400},P=window.innerWidth,M=window.innerHeight,H=20;let W=t.x+H,O=t.y+H;W+k.width>P&&(W=t.x-k.width-H),O+k.height>M&&(O=t.y-k.height-H),W<0&&(W=H),O<0&&(O=H),y.current||g({x:W,y:O}),requestAnimationFrame(()=>_(!0)),setTimeout(()=>{var U;return(U=d.current)==null?void 0:U.focus()},50)}else _(!1)},[e,t]),x.useLayoutEffect(()=>{d.current&&(d.current.style.left=`${h.x}px`,d.current.style.top=`${h.y}px`)},[h]);const C=x.useCallback(k=>{if(!y.current||!d.current)return;k.preventDefault();const P=k.clientX-v.current.x,M=k.clientY-v.current.y;d.current.style.left=`${P}px`,d.current.style.top=`${M}px`},[]),w=x.useCallback(k=>{if(y.current&&d.current){const P=k.clientX-v.current.x,M=k.clientY-v.current.y;g({x:P,y:M})}y.current=!1,window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",w)},[]),b=k=>{var M;if(k.button!==0)return;k.stopPropagation();const P=(M=d.current)==null?void 0:M.getBoundingClientRect();P&&(y.current=!0,v.current={x:k.clientX-P.left,y:k.clientY-P.top},window.addEventListener("mousemove",C),window.addEventListener("mouseup",w))},f=x.useCallback(async()=>{await c(),s||n()},[c,s,n]);x.useEffect(()=>()=>{window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",w)},[C,w]);const T=k=>{k.key==="Escape"&&(k.stopPropagation(),n())},I=x.useMemo(()=>({tools:{title:i("hotkeys.tools.title"),items:[{type:"tool",id:"edit",title:i("toolbar.edit"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})},{type:"tool",id:"cutter",title:i("toolbar.cutter"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:"tool",id:"selection",title:i("toolbar.selection"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})})},{type:"tool",id:"reroute",title:i("toolbar.reroute"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 12h8m-8 0l4-4m-4 4l4 4m8 0h8m-8 0l4-4m-4 4l4 4"})})}]},general_youtube:{title:`${i("toolbar.group.general")} / ${i("toolbar.group.youtube")}`,items:[{type:"node",id:S.NOTE,title:i("toolbar.addNote"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})},{type:"node",id:S.DATA_READER,title:i("toolbar.addDataReader"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{type:"node",id:S.YOUTUBE_TITLE_GENERATOR,title:i("toolbar.addYouTubeTitleGenerator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-12v.75m0 3v.75m0 3v.75m0 3V18m-3 .75h18A2.25 2.25 0 0021 16.5V7.5A2.25 2.25 0 0018.75 5.25H5.25A2.25 2.25 0 003 7.5v9A2.25 2.25 0 005.25 18.75z"})})},{type:"node",id:S.YOUTUBE_ANALYTICS,title:i("toolbar.addYouTubeAnalytics"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})}]},prompting:{title:i("toolbar.group.prompting"),items:[{type:"node",id:S.TEXT_INPUT,title:i("toolbar.addTextInput"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 6h8M12 6v12"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 3h-1a2 2 0 00-2 2v14a2 2 0 002 2h1m12-18h1a2 2 0 012 2v14a2 2 0 01-2 2h-1"})]})},{type:"node",id:S.PROMPT_PROCESSOR,title:i("toolbar.addPromptProcessor"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672 2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{type:"node",id:S.PROMPT_ANALYZER,title:i("toolbar.addPromptAnalyzer"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})}]},scripting:{title:i("toolbar.group.scripting"),items:[{type:"node",id:S.IDEA_GENERATOR,title:i("toolbar.addIdeaGenerator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.375 3.375 0 0112 18.375V19.5"})})},{type:"node",id:S.SCRIPT_GENERATOR,title:i("toolbar.addScriptGenerator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{type:"node",id:S.SCRIPT_ANALYZER,title:i("toolbar.addScriptAnalyzer"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V6A2.25 2.25 0 0018.75 3.75H5.25A2.25 2.25 0 003 6v6"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75-.75h-.008a.75.75 0 01-.75-.75v-.008z"})]})},{type:"node",id:S.SCRIPT_PROMPT_MODIFIER,title:i("toolbar.addScriptPromptModifier"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.75l-1.125 1.125m1.125-1.125L16.125 11.5m2.25 1.25l1.125-1.125m-1.125 1.125l-1.125-1.125M15 6l-2.25 2.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 6l2.25-2.25M15 6l-2.25-2.25"})]})}]},characters:{title:i("toolbar.group.characters"),items:[{type:"node",id:S.CHARACTER_GENERATOR,title:i("toolbar.addCharacterGenerator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})},{type:"node",id:S.CHARACTER_CARD,title:i("toolbar.addCharacterCard"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 3.75H4.5A2.25 2.25 0 002.25 6v12A2.25 2.25 0 004.5 20.25h15A2.25 2.25 0 0021.75 18V6A2.25 2.25 0 0019.5 3.75z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 8.25a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 16.5c0-2.485 2.015-4.5 4.5-4.5s4.5 2.015 4.5 4.5"})]})},{type:"node",id:S.CHARACTER_ANALYZER,title:i("toolbar.addCharacterAnalyzer"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})}]},images:{title:i("toolbar.group.images"),items:[{type:"node",id:S.IMAGE_GENERATOR,title:i("toolbar.addImageGenerator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})},{type:"node",id:S.IMAGE_PREVIEW,title:i("toolbar.addImagePreview"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})}]},ai:{title:i("toolbar.group.ai"),items:[{type:"node",id:S.TRANSLATOR,title:i("toolbar.addTranslator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{type:"node",id:S.GEMINI_CHAT,title:i("toolbar.addGeminiChat"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:"node",id:S.ERROR_ANALYZER,title:i("toolbar.addErrorAnalyzer"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}]},audio:{title:i("toolbar.group.audio"),items:[{type:"node",id:S.SPEECH_SYNTHESIZER,title:i("toolbar.addSpeechSynthesizer"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})},{type:"node",id:S.NARRATOR_TEXT_GENERATOR,title:i("toolbar.addNarratorTextGenerator"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h3M18 12h3"})]})},{type:"node",id:S.AUDIO_TRANSCRIBER,title:i("toolbar.addAudioTranscriber"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12h5m-5 3h5m-5 3h5"})]})},{type:"node",id:S.MUSIC_IDEA_GENERATOR,title:i("toolbar.addMusicIdeaGenerator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})})}]}}),[i]),E=k=>{k.type==="tool"?a(k.id):k.type==="node"&&r(k.id),s||n()},R=["tools","audio","characters","prompting"],N=["scripting","general_youtube","ai","images"],A=k=>o.jsxs("div",{className:"w-full",children:[o.jsx("span",{className:"text-xs text-gray-400 font-semibold px-1",children:k.title}),o.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:k.items.map(P=>o.jsx(RI,{title:P.title,onClick:()=>E(P),children:P.icon},P.id))})]});return e?o.jsxs("div",{ref:d,tabIndex:-1,className:`fixed bg-gray-800/90 backdrop-blur-sm rounded-lg border border-gray-700 p-2 flex flex-col items-start z-[51] focus:outline-none cursor-default transition-[opacity,transform] duration-200 ease-out ${m?"opacity-100 scale-100":"opacity-0 scale-95"} ${s?"pinned-menu":""}`,style:{left:h.x,top:h.y},onMouseDown:b,onKeyDown:T,children:[o.jsxs("div",{className:"flex justify-between items-center w-full mb-1 cursor-move border-b border-gray-700/50 pb-1",children:[o.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase px-1 select-none",children:i("quickAddMenu.title")}),o.jsx("button",{onClick:k=>{k.stopPropagation(),l()},className:`p-1 rounded hover:bg-emerald-600 hover:text-white transition-colors ${s?"text-emerald-400":"text-gray-400"}`,title:s?"Unpin":"Pin",onMouseDown:k=>k.stopPropagation(),children:s?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4 h-4",children:o.jsx("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.563.045.796.77.357 1.145l-4.163 3.566a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.163-3.566c-.44-.375-.206-1.1.357-1.145l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"})})})]}),o.jsxs("div",{className:"flex flex-row items-start gap-2 w-full",children:[o.jsx("div",{className:"flex flex-col space-y-2 w-full",children:R.map(k=>I[k]&&o.jsx("div",{children:A(I[k])},k))}),o.jsx("div",{className:"flex flex-col space-y-2 w-full",children:N.map(k=>I[k]&&o.jsx("div",{children:A(I[k])},k))})]}),o.jsx("div",{className:"h-px bg-gray-700 w-full my-1"}),o.jsxs("button",{onClick:f,className:"w-full flex items-center justify-center space-x-2 p-1.5 rounded hover:bg-gray-700 text-gray-300 hover:text-white transition-colors text-xs font-semibold",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),o.jsx("span",{children:i("contextMenu.paste")})]})]}):null},zr=400,Rn=zr/2,lr=184,cr=116,jI=60,Mc=Math.PI,As={emerald:{fill:"rgba(6, 95, 70, 0.8)",stroke:"rgba(5, 150, 105, 0.9)",iconBg:"rgba(5, 150, 105, 1)",iconColor:"#34d399"},purple:{fill:"rgba(91, 33, 182, 0.8)",stroke:"rgba(124, 58, 237, 0.9)",iconBg:"rgba(124, 58, 237, 1)",iconColor:"#c084fc"},cyan:{fill:"rgba(21, 94, 117, 0.8)",stroke:"rgba(6, 182, 212, 0.9)",iconBg:"rgba(6, 182, 212, 1)",iconColor:"#22d3ee"},pink:{fill:"rgba(157, 23, 77, 0.8)",stroke:"rgba(219, 39, 119, 0.9)",iconBg:"rgba(219, 39, 119, 1)",iconColor:"#f472b6"},yellow:{fill:"rgba(180, 83, 9, 0.8)",stroke:"rgba(234, 179, 8, 0.9)",iconBg:"rgba(234, 179, 8, 1)",iconColor:"#facc15"},amber:{fill:"rgba(146, 64, 14, 0.8)",stroke:"rgba(217, 119, 6, 0.9)",iconBg:"rgba(217, 119, 6, 1)",iconColor:"#fbbf24"},blue:{fill:"rgba(30, 64, 175, 0.8)",stroke:"rgba(59, 130, 246, 0.9)",iconBg:"rgba(59, 130, 246, 1)",iconColor:"#60a5fa"},gray:{fill:"rgba(55, 65, 81, 0.8)",stroke:"rgba(107, 114, 128, 0.9)",iconBg:"rgb(75, 85, 99)",iconColor:"#9ca3af"},green:{fill:"rgba(22, 163, 74, 0.8)",stroke:"rgba(21, 128, 61, 0.9)",iconBg:"rgba(21, 128, 61, 1)",iconColor:"#4ade80"},red:{fill:"rgba(185, 28, 28, 0.8)",stroke:"rgba(220, 38, 38, 0.9)",iconBg:"rgba(220, 38, 38, 1)",iconColor:"#f87171"}},LI=({isOpen:e,position:t,onClose:n,onAddNode:r,onSelectItem:a})=>{const{t:i}=Ht(),[s,l]=x.useState(null),c=x.useMemo(()=>[{name:i("search.group.input"),color:"emerald",options:[{type:S.TEXT_INPUT,title:i("search.node.text_input.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 6h8M12 6v12"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 3h-1a2 2 0 00-2 2v14a2 2 0 002 2h1m12-18h1a2 2 0 012 2v14a2 2 0 01-2 2h-1"})]})},{type:S.NOTE,title:i("search.node.note.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})},{type:S.DATA_READER,title:i("search.node.data_reader.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}]},{name:i("search.group.process"),color:"purple",options:[{type:S.PROMPT_PROCESSOR,title:i("search.node.prompt_processor.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672-2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{type:S.PROMPT_ANALYZER,title:i("search.node.prompt_analyzer.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{type:S.REROUTE_DOT,title:i("search.node.reroute_dot.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 12h8m-8 0l4-4m-4 4l4 4m8 0h8m-8 0l4-4m-4 4l4 4"})})}]},{name:i("search.group.scripting"),color:"cyan",options:[{type:S.IDEA_GENERATOR,title:i("node.title.idea_generator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.375 3.375 0 0112 18.375V19.5"})})},{type:S.SCRIPT_GENERATOR,title:i("search.node.script_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{type:S.SCRIPT_ANALYZER,title:i("search.node.script_analyzer.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V6A2.25 2.25 0 0018.75 3.75H5.25A2.25 2.25 0 003 6v6"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75-.75h-.008a.75.75 0 01-.75-.75v-.008z"})]})},{type:S.SCRIPT_PROMPT_MODIFIER,title:i("search.node.script_prompt_modifier.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.75l-1.125 1.125m1.125-1.125L16.125 11.5m2.25 1.25l1.125-1.125m-1.125 1.125l-1.125-1.125M15 6l-2.25 2.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 6l2.25-2.25M15 6l-2.25-2.25"})]})}]},{name:i("search.group.character"),color:"pink",options:[{type:S.CHARACTER_GENERATOR,title:i("search.node.character_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})},{type:S.CHARACTER_CARD,title:i("search.node.character_card.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 3.75H4.5A2.25 2.25 0 002.25 6v12A2.25 2.25 0 004.5 20.25h15A2.25 2.25 0 0021.75 18V6A2.25 2.25 0 0019.5 3.75z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 8.25a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 16.5c0-2.485 2.015-4.5 4.5-4.5s4.5 2.015 4.5 4.5"})]})},{type:S.CHARACTER_ANALYZER,title:i("search.node.character_analyzer.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})}]},{name:i("search.group.images"),color:"yellow",options:[{type:S.IMAGE_GENERATOR,title:i("search.node.image_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})},{type:S.IMAGE_PREVIEW,title:i("search.node.image_preview.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})}]},{name:i("search.group.ai"),color:"green",options:[{type:S.TRANSLATOR,title:i("search.node.translator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{type:S.GEMINI_CHAT,title:i("search.node.gemini_chat.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:S.ERROR_ANALYZER,title:i("search.node.error_analyzer.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}]},{name:i("search.group.audio"),color:"blue",options:[{type:S.SPEECH_SYNTHESIZER,title:i("search.node.speech_synthesizer.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})},{type:S.NARRATOR_TEXT_GENERATOR,title:i("search.node.narrator_text_generator.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h3M18 12h3"})]})},{type:S.AUDIO_TRANSCRIBER,title:i("search.node.audio_transcriber.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12h5m-5 3h5m-5 3h5"})]})},{type:S.MUSIC_IDEA_GENERATOR,title:i("search.node.music_idea_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})})}]},{name:i("search.group.youtube"),color:"red",options:[{type:S.YOUTUBE_TITLE_GENERATOR,title:i("search.node.youtube_title_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-12v.75m0 3v.75m0 3v.75m0 3V18m-3 .75h18A2.25 2.25 0 0021 16.5V7.5A2.25 2.25 0 0018.75 5.25H5.25A2.25 2.25 0 003 7.5v9A2.25 2.25 0 005.25 18.75z"})})},{type:S.YOUTUBE_ANALYTICS,title:i("search.node.youtube_analytics"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})}]}],[i]),d=x.useMemo(()=>c.reduce((m,_)=>m+_.options.length,0),[c]),h=m=>{const _=m.clientX-t.x,y=m.clientY-t.y;if(Math.sqrt(_*_+y*y)<jI){s&&(l(null),a(null));return}let C=Math.atan2(y,_)-Mc;C<0&&(C+=2*Math.PI);let w=0,b=null;for(const f of c){const T=f.options.length/d*(2*Math.PI);if(C>=w&&C<w+T){const I=C-w,E=T/f.options.length,R=Math.floor(I/E);R>=0&&R<f.options.length&&(b=f.options[R]);break}w+=T}s!==b&&(l(b),a(b?b.type:null))},g=m=>{s&&r(s.type),n()};return e?o.jsx("div",{className:"fixed inset-0 z-40 pointer-events-auto",onMouseMove:h,onMouseDown:g,onContextMenu:m=>m.preventDefault(),children:o.jsx("div",{className:"absolute pointer-events-none",style:{left:t.x-Rn,top:t.y-Rn},children:o.jsxs("svg",{width:zr,height:zr,viewBox:`0 0 ${zr} ${zr}`,children:[o.jsx("defs",{children:o.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[o.jsx("feGaussianBlur",{stdDeviation:"3",result:"coloredBlur"}),o.jsxs("feMerge",{children:[o.jsx("feMergeNode",{in:"coloredBlur"}),o.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),o.jsx("g",{children:(()=>{let m=Mc;return c.map(_=>{const y=_.options.length/d*(2*Math.PI),v=m,C=v+y;m=C;const w=y>Math.PI?1:0,b=`
                                    M ${Rn+cr*Math.cos(v)} ${Rn+cr*Math.sin(v)}
                                    A ${cr} ${cr} 0 ${w} 1 ${Rn+cr*Math.cos(C)} ${Rn+cr*Math.sin(C)}
                                    L ${Rn+lr*Math.cos(C)} ${Rn+lr*Math.sin(C)}
                                    A ${lr} ${lr} 0 ${w} 0 ${Rn+lr*Math.cos(v)} ${Rn+lr*Math.sin(v)}
                                    Z
                                `;return o.jsx("path",{d:b,stroke:"none",style:{fill:"rgba(31, 41, 55, 0.9)",transition:"fill 0.2s"}},_.name)})})()}),o.jsx("circle",{cx:Rn,cy:Rn,r:lr,fill:"none",stroke:"rgba(75, 85, 99, 0.6)",strokeWidth:"1"}),o.jsx("circle",{cx:Rn,cy:Rn,r:cr,fill:"none",stroke:"rgba(75, 85, 99, 0.6)",strokeWidth:"1"}),o.jsx("g",{children:(()=>{let m=Mc;return c.map(_=>{const y=_.options.length/d*(2*Math.PI),v=m,C=y/_.options.length;return m+=y,_.options.map((w,b)=>{const f=v+(b+.5)*C,T=(cr+lr)/2,I=Rn+T*Math.cos(f),E=Rn+T*Math.sin(f),R=s===w;return o.jsxs("g",{transform:`translate(${I}, ${E})`,style:{pointerEvents:"none"},children:[o.jsx("circle",{cx:"0",cy:"0",r:"20",style:{fill:R?As[_.color].iconBg:"transparent",transition:"transform 0.2s, filter 0.2s, fill 0.2s",transform:R?"scale(1.2)":"scale(1)",filter:R?"url(#glow)":"none"}}),o.jsx("g",{transform:"translate(-12, -12)",style:{color:R?"white":As[_.color].iconColor},children:_t.cloneElement(w.icon,{width:24,height:24})})]},w.type)})})})()}),s&&o.jsx("foreignObject",{x:"0",y:"0",width:zr,height:zr,style:{pointerEvents:"none"},children:o.jsxs("div",{className:"relative w-full h-full",children:[(()=>{const m=c.find(y=>y.options.includes(s)),_=m?As[m.color].iconBg:As.gray.iconBg;return o.jsx("div",{style:{backgroundColor:_},className:"w-14 h-14 rounded-lg flex items-center justify-center text-white absolute top-[42%] left-1/2 -translate-x-1/2 -translate-y-1/2",children:_t.cloneElement(s.icon,{className:"h-8 w-8"})})})(),o.jsx("p",{className:"absolute top-[42%] left-1/2 -translate-x-1/2 mt-9 w-40 text-center font-bold text-white drop-shadow-lg",children:s.title})]})})]})})}):null},DI=({isOpen:e,initialValue:t,onConfirm:n,onClose:r,title:a,label:i,confirmButtonText:s,cancelButtonText:l,deselectAllNodes:c})=>{const{t:d}=Ht(),[h,g]=x.useState(t),m=x.useRef(null);x.useEffect(()=>{e&&(g(t),setTimeout(()=>{var v;return(v=m.current)==null?void 0:v.focus()},100))},[e,t]);const _=()=>{h.trim()&&n(h.trim())},y=v=>{v.key==="Enter"?_():v.key==="Escape"&&r()};return e?o.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onMouseDown:r,children:o.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-sm border border-gray-700 flex flex-col",onMouseDown:v=>v.stopPropagation(),onKeyDown:y,children:[o.jsx("div",{className:"p-4 border-b border-gray-700",children:o.jsx("h2",{className:"text-lg font-bold text-emerald-400",children:a||d("dialog.rename.title")})}),o.jsxs("div",{className:"p-4 space-y-4",children:[o.jsx("label",{htmlFor:"rename-input",className:"block text-sm font-medium text-gray-300",children:i||d("dialog.rename.label")}),o.jsx("input",{id:"rename-input",ref:m,type:"text",value:h,onChange:v=>g(v.target.value),className:"w-full px-3 py-2 bg-gray-900 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500",onFocus:c})]}),o.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-800/50 rounded-b-lg",children:[o.jsx("button",{onClick:r,className:"px-4 py-2 font-semibold text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600 transition-colors",children:l||d("dialog.rename.cancel")}),o.jsx("button",{onClick:_,className:"px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 transition-colors",children:s||d("dialog.rename.confirm")})]})]})}):null},Bo=({title:e,onClick:t,children:n})=>o.jsx("button",{onClick:t,onMouseDown:r=>r.stopPropagation(),"aria-label":e,title:e,className:"p-2 text-gray-300 rounded-full hover:bg-gray-600 hover:text-white transition-colors duration-150 focus:outline-none focus:ring-1 focus:ring-emerald-500",children:n}),OI=({item:e,onAddToCanvas:t,onNavigate:n,onRename:r,onSave:a,onDelete:i,draggedItem:s,onDragStart:l,onDragEnd:c,onMoveItem:d,isDragOver:h,setIsDragOver:g})=>{const{t:m}=Ht(),_=e.type===Ze.FOLDER,y=_?()=>n(e.id):()=>{},v=f=>{l(),f.dataTransfer.setData("application/prompt-modifier-drag-item",JSON.stringify({type:e.type===Ze.GROUP?"catalog-group":`catalog-data-${e.type.toLowerCase()}`,itemId:e.id,itemData:e.data})),f.dataTransfer.effectAllowed="copyMove"},C=f=>{_&&s&&(s.tab==="groups"||s.tab==="generic")&&s.id!==e.id&&(f.preventDefault(),g(!0))},w=f=>{_&&(f.preventDefault(),f.stopPropagation(),g(!1),d(e.id))},b=()=>{if(_)return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})});switch(e.type){case Ze.GROUP:return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})});case Ze.CHARACTERS:return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-pink-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})});case Ze.SCRIPT:return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})});case Ze.ANALYSIS:return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})});case Ze.FINAL_PROMPTS:return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-yellow-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})});case Ze.YOUTUBE:return e.data&&e.data.type==="youtube-analytics-data"?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})});case Ze.MUSIC:return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})});default:return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})}};return o.jsxs("div",{draggable:!0,onDragStart:v,onDragEnd:c,onDragOver:C,onDragLeave:()=>g(!1),onDrop:w,className:`bg-gray-700 rounded-lg p-4 flex flex-col items-center justify-between space-y-3 border border-gray-600 hover:border-emerald-500 transition-colors duration-200 ${h?"ring-2 ring-emerald-400":""}`,children:[o.jsx("div",{className:"relative w-24 h-20 mx-auto mb-2 group",onClick:y,style:{cursor:_?"pointer":"default"},children:o.jsx("div",{className:`absolute w-full h-full ${_?"group-hover:scale-110":""} bg-gray-800 rounded-lg flex items-center justify-center transition-transform`,children:b()})}),o.jsx("p",{className:"font-semibold text-gray-100 text-center break-all w-full truncate",title:e.name,children:e.name}),o.jsxs("div",{className:"flex justify-center space-x-2 w-full pt-2 border-t border-gray-600/50",children:[e.type===Ze.GROUP&&o.jsx(Bo,{title:m("catalog.card.addToCanvas"),onClick:()=>t(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),o.jsx(Bo,{title:m("catalog.card.rename"),onClick:()=>r(e.id,e.name),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),o.jsx(Bo,{title:m("catalog.card.save"),onClick:()=>a(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),o.jsx(Bo,{title:m("catalog.card.delete"),onClick:()=>i(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},FI=({item:e,onNavigate:t,onEdit:n,onRename:r,onSave:a,onDelete:i,draggedItem:s,onDragStart:l,onDragEnd:c,onMoveItem:d,isDragOver:h,setIsDragOver:g})=>{const{t:m}=Ht(),_=e.type===$t.FOLDER,y=()=>{e.content&&navigator.clipboard.writeText(e.content).catch(f=>console.error("Copy failed",f))},v=_?()=>t(e.id):()=>{},C=f=>{l(),f.dataTransfer.setData("application/prompt-modifier-drag-item",JSON.stringify({type:e.type===$t.FOLDER?"library-folder":"library-prompt",itemId:e.id,content:e.content})),f.dataTransfer.effectAllowed="copyMove"},w=f=>{_&&s&&s.tab==="library"&&s.id!==e.id&&(f.preventDefault(),g(!0))},b=f=>{_&&(f.preventDefault(),f.stopPropagation(),g(!1),d(e.id))};return o.jsxs("div",{draggable:!0,onDragStart:C,onDragEnd:c,onDragOver:w,onDragLeave:()=>g(!1),onDrop:b,className:`bg-gray-700 rounded-lg p-4 flex flex-col items-center justify-between space-y-3 border border-gray-600 hover:border-emerald-500 transition-colors duration-200 ${h?"ring-2 ring-emerald-400":""}`,children:[o.jsx("div",{className:"relative w-24 h-20 mx-auto mb-2 group",onClick:v,style:{cursor:_?"pointer":"default"},children:o.jsx("div",{className:`absolute w-full h-full ${_?"group-hover:scale-110":""} bg-gray-800 rounded-lg flex items-center justify-center transition-transform`,children:_?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})}),o.jsxs("div",{className:"text-center w-full min-h-[4rem]",children:[o.jsx("p",{className:"font-semibold text-gray-100 break-all w-full truncate",title:e.name,children:e.name}),!_&&o.jsx("p",{className:"text-xs text-gray-400 mt-1 line-clamp-2",children:e.content||m("library.emptyPrompt")})]}),o.jsxs("div",{className:"flex justify-center space-x-2 w-full pt-2 border-t border-gray-600/50",children:[!_&&o.jsxs(o.Fragment,{children:[o.jsx(Bo,{title:m("library.actions.copy"),onClick:y,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),o.jsx(Bo,{title:m("library.actions.edit"),onClick:()=>n(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]}),o.jsx(Bo,{title:m("catalog.card.rename"),onClick:()=>r(e.id,e.name),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),o.jsx(Bo,{title:m("catalog.card.save"),onClick:()=>a(e),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),o.jsx(Bo,{title:m("catalog.card.delete"),onClick:()=>i(e.id),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},zI=e=>{const{isOpen:t,onClose:n,currentCatalogItems:r,catalogPath:a,onCatalogNavigateBack:i,onCatalogNavigateToFolder:s,onCreateCatalogFolder:l,onAddGroupFromCatalog:c,onRenameCatalogItem:d,onSaveCatalogItem:h,onDeleteCatalogItem:g,onLoadCatalogItemFromFile:m,onMoveCatalogItem:_,activeCategory:y,setActiveCategory:v,libraryItems:C,libraryPath:w,onNavigateBack:b,onNavigateToFolder:f,onCreateLibraryItem:T,onEditLibraryItem:I,onRenameLibraryItem:E,onDeleteLibraryItem:R,onSaveLibraryItem:N,onLoadLibraryItemFromFile:A,onMoveLibraryItem:k}=e,{t:P}=Ht(),[M,H]=x.useState(Ze.GROUP),[W,O]=x.useState(null),[U,z]=x.useState(null),L=x.useRef(null),D=x.useRef([]);if(!t)return null;const G=()=>{O(null),z(null)},q=(ue,$)=>{H(ue),ue!=="library"?(v(ue),s(null)):f(null);const ee=L.current,Te=D.current[$];if(ee&&Te){const le=ee.getBoundingClientRect(),J=Te.getBoundingClientRect(),ge=le.left+le.width/2,ce=J.left+J.width/2-ge;ee.scrollTo({left:ee.scrollLeft+ce,behavior:"smooth"})}},ie=[{id:Ze.GROUP,label:P("catalog.tabs.groups")},{id:"library",label:P("catalog.tabs.library")},{id:Ze.CHARACTERS,label:P("catalog.tabs.characters")},{id:Ze.SCRIPT,label:P("catalog.tabs.scripts")},{id:Ze.ANALYSIS,label:P("catalog.tabs.analysis")},{id:Ze.FINAL_PROMPTS,label:P("catalog.tabs.final_prompts")},{id:Ze.YOUTUBE,label:P("catalog.tabs.youtube")},{id:Ze.MUSIC,label:P("catalog.tabs.music")}],te=()=>o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"p-3 border-b border-gray-700 flex items-center justify-between space-x-2 flex-shrink-0",children:[o.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[o.jsx("button",{onClick:i,disabled:a.length<=1,className:`p-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed transition-colors ${U==="back-catalog"?"bg-emerald-700":"hover:bg-gray-700"}`,onDragOver:ue=>{((W==null?void 0:W.tab)==="groups"||(W==null?void 0:W.tab)==="generic")&&a.length>1&&(ue.preventDefault(),z("back-catalog"))},onDragLeave:()=>z(null),onDrop:ue=>{if(ue.preventDefault(),z(null),!W||W.tab!=="groups"&&W.tab!=="generic")return;const $=a.length>1?a[a.length-2].id:null;_(W.id,$)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),o.jsx("div",{className:"flex items-center text-sm text-gray-400 truncate",children:a.map((ue,$)=>o.jsxs(_t.Fragment,{children:[o.jsx("span",{onClick:()=>s(ue.id),className:"px-1 hover:text-white cursor-pointer truncate",children:ue.name}),$<a.length-1&&o.jsx("span",{className:"px-1 select-none",children:"/"})]},ue.id||"root"))})]}),o.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[o.jsxs("button",{onClick:m,className:"px-3 py-2 text-sm font-semibold bg-emerald-600 hover:bg-emerald-700 text-white rounded-md flex items-center space-x-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),o.jsx("span",{children:P("catalog.loadFromFile")})]}),o.jsxs("button",{onClick:l,className:"px-3 py-2 text-sm font-semibold bg-gray-600 hover:bg-gray-500 text-white rounded-md flex items-center space-x-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),o.jsx("span",{children:P("library.actions.newFolder")})]})]})]}),o.jsx("div",{className:"flex-grow overflow-y-auto p-4",children:r.length>0?o.jsx("div",{className:"grid grid-cols-3 gap-4",children:r.map(ue=>o.jsx(OI,{item:ue,onAddToCanvas:c,onNavigate:$=>s($),onRename:d,onSave:h,onDelete:g,draggedItem:W,onDragStart:()=>O({id:ue.id,tab:ue.type===Ze.GROUP?"groups":"generic"}),onDragEnd:G,onMoveItem:$=>_(W.id,$),isDragOver:U===ue.id,setIsDragOver:$=>z($?ue.id:null)},ue.id))}):o.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),o.jsx("p",{className:"font-semibold",children:P("catalog.empty.title")}),o.jsx("p",{className:"text-sm",children:P("catalog.empty.description")})]})})]}),ye=()=>o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"p-3 border-b border-gray-700 flex items-center justify-between space-x-2 flex-shrink-0",children:[o.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[o.jsx("button",{onClick:b,disabled:w.length<=1,className:`p-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed transition-colors ${U==="back-library"?"bg-emerald-700":"hover:bg-gray-700"}`,onDragOver:ue=>{(W==null?void 0:W.tab)==="library"&&w.length>1&&(ue.preventDefault(),z("back-library"))},onDragLeave:()=>z(null),onDrop:ue=>{if(ue.preventDefault(),z(null),!W||W.tab!=="library")return;const $=w.length>1?w[w.length-2].id:null;k(W.id,$)},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),o.jsx("div",{className:"flex items-center text-sm text-gray-400 truncate",children:w.map((ue,$)=>o.jsxs(_t.Fragment,{children:[o.jsx("span",{onClick:()=>f(ue.id==="root"?null:ue.id),className:"px-1 hover:text-white cursor-pointer truncate",children:ue.name}),$<w.length-1&&o.jsx("span",{className:"px-1 select-none",children:"/"})]},ue.id||"root"))})]}),o.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[o.jsxs("button",{onClick:A,className:"px-3 py-2 text-sm font-semibold bg-emerald-600 hover:bg-emerald-700 text-white rounded-md flex items-center space-x-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),o.jsx("span",{children:P("library.loadFromFile")})]}),o.jsxs("button",{onClick:()=>T($t.FOLDER),className:"px-3 py-2 text-sm font-semibold bg-gray-600 hover:bg-gray-500 text-white rounded-md flex items-center space-x-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),o.jsx("span",{children:P("library.actions.newFolder")})]}),o.jsxs("button",{onClick:()=>T($t.PROMPT),className:"px-3 py-2 text-sm font-semibold bg-emerald-600 hover:bg-emerald-700 text-white rounded-md flex items-center space-x-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),o.jsx("span",{children:P("library.actions.newPrompt")})]})]})]}),o.jsx("div",{className:"flex-grow overflow-y-auto p-4",children:C.length>0?o.jsx("div",{className:"grid grid-cols-3 gap-4",children:C.map(ue=>o.jsx(FI,{item:ue,onNavigate:f,onEdit:I,onRename:E,onSave:N,onDelete:R,draggedItem:W,onDragStart:()=>O({id:ue.id,tab:"library"}),onDragEnd:G,onMoveItem:$=>k(W.id,$),isDragOver:U===ue.id,setIsDragOver:$=>z($?ue.id:null)},ue.id))}):o.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center text-gray-500",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),o.jsx("p",{className:"font-semibold",children:P("library.empty.title")}),o.jsx("p",{className:"text-sm",children:P("library.empty.description")})]})})]});return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:o.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-4xl border border-gray-700 flex flex-col h-[80vh] pointer-events-auto shadow-2xl",onMouseDown:ue=>ue.stopPropagation(),children:[o.jsxs("div",{className:"p-4 pb-0 border-b border-gray-700 flex justify-between items-center flex-shrink-0",children:[o.jsx("div",{ref:L,className:"flex items-end space-x-1 overflow-x-auto pb-2 w-full mr-4 no-scrollbar relative",style:{scrollbarWidth:"none"},children:ie.map((ue,$)=>o.jsx("button",{ref:ee=>{D.current[$]=ee},onClick:()=>q(ue.id,$),className:`px-4 py-2 text-sm font-bold whitespace-nowrap transition-colors rounded-t-md ${M===ue.id?"bg-gray-700 text-emerald-400 border-t-2 border-emerald-400":"text-gray-400 hover:text-white hover:bg-gray-700/50"}`,children:ue.label},ue.id))}),o.jsx("button",{onClick:n,className:"p-1 text-gray-400 rounded hover:bg-gray-600 hover:text-white mb-2",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),M==="library"?ye():te()]})})},GI=()=>{const{language:e,setLanguage:t}=Ht(),[n,r]=x.useState(!1),[a,i]=x.useState(()=>e==="en"?"ru":e);x.useEffect(()=>{e!=="en"&&i(e)},[e]);const s=x.useMemo(()=>zl.filter(v=>Sw.includes(v.code)&&v.code!=="en").sort((v,C)=>v.code==="sys"?1:C.code==="sys"?-1:0),[]),l=s.find(y=>y.code===a)||s[0],c=()=>{e!==l.code&&t(l.code)},d=y=>{t(y),r(!1)},h=x.useRef(null),g=x.useRef(null);x.useEffect(()=>{const y=v=>{h.current&&!h.current.contains(v.target)&&g.current&&!g.current.contains(v.target)&&r(!1)};return n&&document.addEventListener("mousedown",y,!0),()=>{document.removeEventListener("mousedown",y,!0)}},[n]);const[m,_]=x.useState({});return x.useEffect(()=>{if(n&&g.current){const y=g.current.getBoundingClientRect();_({position:"fixed",top:`${y.bottom+6}px`,right:`${window.innerWidth-y.right}px`,minWidth:"140px",zIndex:9999})}},[n]),o.jsxs("div",{className:"flex items-center h-9 gap-1",children:[o.jsx(lt,{title:"English",position:"bottom",className:"h-full",children:o.jsx("button",{onClick:()=>t("en"),className:`px-3 py-1 text-xs font-bold transition-colors h-full rounded-md min-w-[36px] ${e==="en"?"bg-emerald-600 text-white shadow-sm":"bg-gray-700 text-gray-300 hover:bg-emerald-600 hover:text-white"}`,children:"EN"})}),o.jsxs("div",{className:"flex items-center h-full relative group",children:[o.jsx(lt,{title:l.name,position:"bottom",className:"h-full",children:o.jsx("button",{onClick:c,className:`px-2 py-1 text-xs font-bold transition-colors h-full min-w-[36px] flex items-center justify-center rounded-l-md ${e===l.code?"bg-emerald-600 text-white shadow-sm":"bg-gray-700 text-gray-300 hover:bg-emerald-600 hover:text-white"}`,children:l.label})}),o.jsx("button",{ref:g,onClick:y=>{y.stopPropagation(),r(!n)},className:`px-1 py-1 h-full rounded-r-md flex items-center justify-center transition-colors border-l ${e===l.code?"bg-emerald-600 hover:bg-emerald-500 text-white border-emerald-700":"bg-gray-700 hover:bg-emerald-600 text-gray-400 hover:text-white border-gray-600/30"}`,children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 transition-transform duration-200 ${n?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}),n&&Ji.createPortal(o.jsxs("div",{ref:h,style:m,className:"bg-gray-800 border border-gray-600 rounded-lg shadow-2xl py-1 flex flex-col animate-fade-in-up origin-top-right",onWheel:y=>y.stopPropagation(),children:[o.jsx("div",{className:"px-3 py-1.5 text-[10px] font-bold text-gray-500 uppercase tracking-wider border-b border-gray-700 mb-1 select-none",children:"Select Language"}),s.map(y=>o.jsxs("button",{onClick:()=>d(y.code),className:`px-4 py-2 text-left text-sm hover:bg-gray-700 flex justify-between items-center group transition-colors ${e===y.code?"text-emerald-400 font-bold bg-gray-700/50":"text-gray-300"}`,children:[o.jsx("span",{className:"truncate mr-4",children:y.name}),o.jsx("span",{className:`text-xs font-mono px-1.5 py-0.5 rounded ${e===y.code?"bg-emerald-900/30 text-emerald-400":"bg-gray-900 text-gray-500 group-hover:text-gray-400"}`,children:y.label})]},y.code))]}),document.body)]})]})},UI=({isOpen:e,onAllow:t,onDecline:n})=>{const{t:r}=Ht();return e?o.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4",children:o.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-md border border-gray-700 flex flex-col",children:[o.jsx("div",{className:"p-4 border-b border-gray-700",children:o.jsx("h2",{className:"text-lg font-bold text-emerald-400",children:r("dialog.permission.title")})}),o.jsx("div",{className:"p-4 space-y-4",children:o.jsx("p",{className:"text-sm text-gray-300",children:r("dialog.permission.description")})}),o.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-800/50 rounded-b-lg",children:[o.jsx("button",{onClick:n,className:"px-4 py-2 font-semibold text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600 transition-colors",children:r("dialog.permission.decline")}),o.jsx("button",{onClick:t,className:"px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 transition-colors",children:r("dialog.permission.allow")})]})]})}):null},HI=({isOpen:e,onConfirm:t,onClose:n,title:r,message:a})=>{const{t:i}=Ht(),s=()=>{t(),n()},l=c=>{c.key==="Enter"?s():c.key==="Escape"&&n()};return e?o.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4",onMouseDown:n,children:o.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-sm border border-gray-700 flex flex-col",onMouseDown:c=>c.stopPropagation(),onKeyDown:l,children:[o.jsx("div",{className:"p-4 border-b border-gray-700",children:o.jsx("h2",{className:"text-lg font-bold text-emerald-400",children:r})}),o.jsx("div",{className:"p-4 space-y-4",children:o.jsx("p",{className:"text-sm text-gray-300",children:a})}),o.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-800/50 rounded-b-lg",children:[o.jsx("button",{onClick:n,className:"px-4 py-2 font-semibold text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600 transition-colors",children:i("dialog.confirmDelete.cancel")}),o.jsx("button",{onClick:s,className:"px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 transition-colors",children:i("dialog.confirmDelete.confirm")})]})]})}):null},$d=({title:e,children:t,position:n="bottom",className:r=""})=>{const[a,i]=x.useState(!1),s={top:"bottom-full left-1/2 -translate-x-1/2 mb-1.5",bottom:"top-full left-1/2 -translate-x-1/2 mt-1.5",left:"right-full top-1/2 -translate-y-1/2 mr-1.5",right:"left-full top-1/2 -translate-y-1/2 ml-1.5"};return o.jsxs("div",{className:`relative flex items-center ${r}`,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[t,o.jsx("div",{className:`absolute px-2 py-1 bg-gray-900 text-gray-200 text-xs font-medium whitespace-nowrap rounded shadow-xl z-[100] pointer-events-none transition-opacity duration-200 ${s[n]} ${a?"opacity-100":"opacity-0"}`,role:"tooltip",children:e})]})},BI=()=>{const{t:e}=Ht(),[t,n]=x.useState(!1),[r,a]=x.useState("hotkeys"),i=x.useRef(null),s=x.useRef(null),[l,c]=x.useState({opacity:0,pointerEvents:"none",position:"fixed"}),[d,h]=x.useState(null);x.useEffect(()=>{const b=f=>{f.key==="F1"&&(f.preventDefault(),n(T=>!T))};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[]),x.useEffect(()=>{if(t){if(i.current){const b=i.current.getBoundingClientRect();c({position:"fixed",top:`${b.bottom+8}px`,left:`${b.left}px`,opacity:1,pointerEvents:"auto",transition:"opacity 150ms ease-in-out"})}}else c(b=>({...b,opacity:0,pointerEvents:"none"}))},[t]),x.useEffect(()=>{if(!t)return;const b=f=>{s.current&&!s.current.contains(f.target)&&i.current&&!i.current.contains(f.target)&&n(!1)};return document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[t]);const g=b=>{navigator.clipboard.writeText(b),h(b),setTimeout(()=>h(null),1500)},m=x.useMemo(()=>[{category:e("help.category.socials"),headerColor:"text-red-400",links:[{label:e("help.link.youtube"),subLabel:"@MurcelloNovaes",url:"https://www.youtube.com/@MurcelloNovaes",iconType:"youtube"},{label:"Linktree",subLabel:"meowmasterart",url:"https://linktr.ee/meowmasterart",iconType:"linktree"},{label:e("help.link.telegram_channel"),subLabel:e("help.sub.news"),url:"https://t.me/+h0YEu0nx9QdhMDNi",iconType:"telegram"},{label:e("help.link.telegram_chat"),subLabel:e("help.sub.discussion"),url:"https://t.me/+tyQLGFxiEbRhMDdi",iconType:"telegram"}]},{category:e("help.category.gh_pages"),headerColor:"text-purple-400",links:[{label:"Script Modifier",subLabel:"GitHub Pages",url:"https://neytrino2134.github.io/Script-Modifier/",iconType:"github"},{label:"Prompt Modifier",subLabel:"GitHub Pages",url:"https://neytrino2134.github.io/Prompt-Modifier/",iconType:"github"}]},{category:e("help.category.web"),headerColor:"text-cyan-400",links:[{label:"Script Modifier Web",subLabel:"scriptmodifier2.netlify.app",url:"https://scriptmodifier2.netlify.app/",iconType:"netlify"},{label:"Prompt Modifier Web",subLabel:"promptmodifier2.netlify.app",url:"https://promptmodifier2.netlify.app/",iconType:"netlify"}]},{category:e("help.category.stable"),headerColor:"text-blue-400",links:[{label:"Script Modifier 0.1.3",subLabel:e("help.sub.stable"),url:"https://ai.studio/apps/drive/1enTmQ5Wz9RBArkZMZm5s5nYQcKxQ9L8M?fullscreenApplet=true",iconType:"google"},{label:"Prompt Modifier 0.1.7",subLabel:e("help.sub.stable"),url:"https://ai.studio/apps/drive/1YCO0DaA4BTm9p0j5XqvpBhX_XTg9ClwC?fullscreenApplet=true",iconType:"google"}]},{category:e("help.category.alpha"),headerColor:"text-blue-400",links:[{label:"Script Modifier 0.1.5",subLabel:e("help.sub.alpha"),url:"https://aistudio.google.com/apps/drive/1y9CSUmlVQK2xq7ckses7fpM6wpbZdBnB?showAssistant=true&resourceKey=&showPreview=true",iconType:"google"},{label:"Prompt Modifier 0.1.8",subLabel:e("help.sub.alpha"),url:"https://aistudio.google.com/apps/drive/1OJfPP9wUKlnjvZ5_2_Fxq_v1dW0iftlW?showAssistant=true&resourceKey=&showPreview=true",iconType:"google"}]},{category:e("help.category.github"),headerColor:"text-yellow-400",links:[{label:"Script Modifier Repo",subLabel:"v0.1.5 Alpha",url:"https://github.com/Neytrino2134/Script-Modifier",iconType:"github"},{label:"Prompt Modifier Repo",subLabel:"v0.1.8 Alpha",url:"https://github.com/Neytrino2134/Prompt-Modifier",iconType:"github"}]}],[e]),_=b=>{switch(b){case"youtube":return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-red-500",children:o.jsx("path",{d:"M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"})});case"telegram":return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-sky-400",children:o.jsx("path",{d:"M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 11.944 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"})});case"google":return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-blue-500",children:o.jsx("path",{d:"M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .307 5.387.307 12s5.56 12 12.173 12c3.573 0 6.267-1.173 8.373-3.36 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.053H12.48z"})});case"netlify":return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-cyan-400",children:o.jsx("path",{d:"M6.48 2.81L2.09 10.42 5.54 21.19zM11.66 21.19L8.21 10.42 12.6 2.81 17 10.42zM18.46 21.19L21.91 10.42 17.52 2.81z"})});case"github":return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-gray-200",children:o.jsx("path",{d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})});case"linktree":return o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"text-green-500",children:o.jsx("path",{d:"M13.736 5.853L12 2 10.264 5.853H2v2.836l6.632 2.65L2.35 17.65l1.836 1.837 6.945-6.946v9.433h1.738v-9.433l6.945 6.946 1.836-1.837-6.281-6.282 6.631-2.65V5.853h-8.264z"})});default:return o.jsx("div",{className:"w-5 h-5 bg-gray-500 rounded-full"})}},y={tools:[{key:"V",description:e("hotkeys.tools.edit")},{key:"C",description:e("hotkeys.tools.cutter")},{key:"S",description:e("hotkeys.tools.selection")},{key:"R",description:e("hotkeys.tools.reroute")},{key:"Z",description:e("hotkeys.tools.zoom")},{key:"H",description:e("node.action.collapse")},{key:"Shift + W",description:e("hotkeys.tools.snapToGrid")},{key:"Shift + E",description:e("hotkeys.tools.toggleLineStyle")},{key:"G",description:e("hotkeys.tools.group")},{key:"D",description:e("node.action.duplicateEmpty")},{key:"Ctrl + D",description:e("hotkeys.tools.duplicate")},{key:"X / Del",description:e("hotkeys.tools.closeNode")},{key:"Ctrl + A",description:e("hotkeys.tools.selectAll")},{key:"Alt + A",description:e("hotkeys.tools.deselectAll")},{key:"Shift+Click",description:e("hotkeys.tools.deleteGroup")}],windows:[{key:"F",description:e("hotkeys.windows.search")},{key:"Space",description:e("hotkeys.windows.quickAdd")},{key:"Ctrl+Space",description:e("hotkeys.windows.catalog")},{key:"F1",description:e("hotkeys.show")}],file:[{key:"Ctrl + S",description:e("hotkeys.file.save")},{key:"Ctrl + Shift + S",description:e("hotkeys.file.saveProject")},{key:"Ctrl + O",description:e("hotkeys.file.load")}],createNode:[{key:"T",description:e("node.title.text_input")},{key:"P",description:e("node.title.prompt_processor")},{key:"A",description:e("node.title.prompt_analyzer")},{key:"M",description:e("node.title.gemini_chat")},{key:"L",description:e("node.title.translator")},{key:"N",description:e("node.title.note")},{key:"O",description:e("node.title.image_generator")},{key:"I",description:e("node.title.image_preview")},{key:"Shift+A",description:e("node.title.idea_generator")},{key:"Shift+C",description:e("node.title.character_generator")},{key:"Ctrl+Shift+C",description:e("node.title.character_card")},{key:"Shift+S",description:e("node.title.script_generator")},{key:"Shift+D",description:e("node.title.script_analyzer")},{key:"Shift+F",description:e("node.title.script_prompt_modifier")},{key:"Shift+R",description:e("node.title.data_reader")},{key:"Shift+G",description:e("node.title.narrator_text_generator")},{key:"Shift+N",description:e("node.title.speech_synthesizer")},{key:"Shift+B",description:e("node.title.audio_transcriber")},{key:"Shift+T",description:e("node.title.youtube_title_generator")},{key:"Shift+Y",description:e("node.title.youtube_analytics")},{key:"Shift+M",description:e("node.title.music_idea_generator")}]},v=(b,f)=>o.jsxs("div",{children:[o.jsx("h4",{className:"font-bold text-gray-300 mb-2 border-b border-gray-600 pb-1 select-none",children:b}),o.jsx("ul",{className:"space-y-1.5",children:f.map(({key:T,description:I})=>o.jsxs("li",{className:"flex justify-between items-center select-none",children:[o.jsx("span",{children:I}),o.jsx("kbd",{className:"font-mono bg-gray-700 px-2 py-1 rounded-md text-gray-300 text-xs",children:T})]},T))})]}),C=()=>o.jsx("div",{className:"space-y-4",children:m.map(b=>o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:`font-bold text-xs uppercase tracking-wider select-none border-b border-gray-700/50 pb-1 text-center ${b.headerColor}`,children:b.category}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:b.links.map((f,T)=>o.jsxs("div",{onClick:()=>window.open(f.url,"_blank"),className:"bg-gray-900/50 hover:bg-gray-800 border border-gray-700 hover:border-emerald-500/50 rounded-lg p-2.5 flex items-center justify-between transition-all group cursor-pointer relative",children:[o.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center flex-shrink-0 group-hover:bg-gray-700 transition-colors",children:_(f.iconType)}),o.jsxs("div",{className:"flex flex-col min-w-0",children:[o.jsx("span",{className:"font-semibold text-gray-200 text-sm truncate select-none",children:f.label}),o.jsx("span",{className:"text-[10px] text-gray-500 truncate select-none",children:f.subLabel||f.url})]})]}),o.jsxs("div",{className:"flex items-center gap-2 opacity-80 group-hover:opacity-100 transition-opacity",children:[o.jsx($d,{title:d===f.url?e("app.error.copied"):"Copy URL",position:"top",children:o.jsx("button",{onClick:I=>{I.stopPropagation(),g(f.url)},className:"p-1.5 rounded-md hover:bg-gray-700 text-gray-500 hover:text-white transition-colors",children:d===f.url?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):o.jsx(Wo,{className:"h-4 w-4"})})}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-600 group-hover:text-emerald-400 transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]},T))})]},b.category))}),w=o.jsxs("div",{ref:s,className:"bg-gray-800 rounded-lg w-[600px] h-[600px] border border-gray-700 z-[60] flex flex-col shadow-2xl select-none",style:l,onMouseDown:b=>b.stopPropagation(),onWheel:b=>b.stopPropagation(),children:[o.jsxs("div",{className:"flex flex-col border-b border-gray-700 flex-shrink-0",children:[o.jsxs("div",{className:"flex justify-between items-center p-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-6 h-6 rounded-full bg-emerald-900/50 flex items-center justify-center border border-emerald-500/30",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),o.jsx("h2",{className:"text-lg font-bold text-emerald-400 select-none",children:e("help.title")})]}),o.jsx("button",{onClick:()=>n(!1),className:"p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),o.jsxs("div",{className:"flex px-3 gap-2",children:[o.jsx("button",{onClick:()=>a("hotkeys"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider border-b-2 transition-colors ${r==="hotkeys"?"border-emerald-500 text-white":"border-transparent text-gray-500 hover:text-gray-300"}`,children:e("help.tabs.hotkeys")}),o.jsx("button",{onClick:()=>a("links"),className:`flex-1 py-2 text-xs font-bold uppercase tracking-wider border-b-2 transition-colors ${r==="links"?"border-emerald-500 text-white":"border-transparent text-gray-500 hover:text-gray-300"}`,children:e("help.tabs.links")})]})]}),o.jsx("div",{className:"p-4 overflow-y-auto text-sm text-gray-400 flex-grow min-h-0 custom-scrollbar",children:r==="hotkeys"?o.jsxs("div",{className:"flex flex-col gap-6",children:[v(e("hotkeys.tools.title"),y.tools),v(e("hotkeys.createNode.title"),y.createNode),v(e("hotkeys.windows.title"),y.windows),v(e("hotkeys.file.title"),y.file)]}):C()}),o.jsxs("div",{className:"p-3 bg-gray-900 border-t border-gray-700 text-xs text-gray-500 flex flex-col gap-2 rounded-b-lg select-none",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{children:"Script Modifier"}),o.jsx("span",{className:"font-mono",children:"Licensed under GNU GPLv3"})]}),o.jsxs("div",{className:"flex justify-between items-end border-t border-gray-800 pt-2 text-gray-400",children:[o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("span",{children:"Author: MeowMaster"}),o.jsx("span",{children:"Email: MeowMasterart@gmail.com"}),o.jsx("a",{href:"https://github.com/Neytrino2134/Script-Modifier",target:"_blank",rel:"noopener noreferrer",className:"hover:text-emerald-400 transition-colors",children:"GitHub: Neytrino2134/Script-Modifier"})]}),o.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",className:"opacity-70 hover:opacity-100 transition-opacity",children:o.jsx("img",{src:"https://www.netlify.com/assets/badges/netlify-badge-color-accent.svg",alt:"Deploys by Netlify",style:{height:"32px"}})})]})]})]});return o.jsxs("div",{ref:i,children:[o.jsx($d,{title:e("hotkeys.show"),position:"bottom",children:o.jsx("button",{onClick:()=>n(!t),className:"p-1.5 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-emerald-600 text-gray-300 hover:text-white",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),t&&Ji.createPortal(w,document.body)]})},VI=({isOpen:e,initialName:t,initialContent:n,onConfirm:r,onClose:a,deselectAllNodes:i})=>{const{t:s}=Ht(),[l,c]=x.useState(t),[d,h]=x.useState(n),g=x.useRef(null);x.useEffect(()=>{e&&(c(t),h(n),setTimeout(()=>{var y;return(y=g.current)==null?void 0:y.focus()},100))},[e,t,n]);const m=()=>{l.trim()&&r(l.trim(),d)},_=y=>{y.key==="Escape"&&a()};return e?o.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onMouseDown:a,children:o.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-lg border border-gray-700 flex flex-col",onMouseDown:y=>y.stopPropagation(),onKeyDown:_,children:[o.jsx("div",{className:"p-4 border-b border-gray-700",children:o.jsx("h2",{className:"text-lg font-bold text-emerald-400",children:s("dialog.promptEdit.title")})}),o.jsxs("div",{className:"p-4 space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{htmlFor:"prompt-name-input",className:"block text-sm font-medium text-gray-300 mb-2",children:s("dialog.promptEdit.nameLabel")}),o.jsx("input",{id:"prompt-name-input",ref:g,type:"text",value:l,onChange:y=>c(y.target.value),className:"w-full px-3 py-2 bg-gray-900 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500",onFocus:i})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"prompt-content-input",className:"block text-sm font-medium text-gray-300 mb-2",children:s("dialog.promptEdit.contentLabel")}),o.jsx("textarea",{id:"prompt-content-input",value:d,onChange:y=>h(y.target.value),className:"w-full h-40 px-3 py-2 bg-gray-900 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 resize-none",onWheel:y=>y.stopPropagation(),onFocus:i})]})]}),o.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-end items-center space-x-3 bg-gray-800/50 rounded-b-lg",children:[o.jsx("button",{onClick:a,className:"px-4 py-2 font-semibold text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600 transition-colors",children:s("dialog.promptEdit.cancel")}),o.jsx("button",{onClick:m,className:"px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 transition-colors",children:s("dialog.promptEdit.confirm")})]})]})}):null},bg=({message:e,type:t,onClose:n,isPositioned:r})=>{const a=()=>{n()},i=r?"toast-animate-positioned":"toast-animate-centered",s=t==="success",l=s?"bg-emerald-600/90 text-white":"bg-gray-700/90 text-gray-100",c=s?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}):null;return o.jsxs("div",{onAnimationEnd:a,className:`flex items-center space-x-3 px-4 py-2 rounded-lg shadow-lg backdrop-blur-sm pointer-events-auto ${l} ${i}`,role:"alert",children:[c&&o.jsx("div",{className:"flex-shrink-0",children:c}),o.jsx("p",{className:"text-sm font-semibold whitespace-pre-wrap",children:e})]})},$I=({toasts:e,removeToast:t})=>{const n=e.filter(a=>a.position),r=e.filter(a=>!a.position);return o.jsxs(o.Fragment,{children:[r.length>0&&o.jsx("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-[101] flex flex-col items-center space-y-2 pointer-events-none",children:r.map(a=>o.jsx(bg,{message:a.message,type:a.type,onClose:()=>t(a.id),isPositioned:!1},a.id))}),n.map(a=>{var i,s;return o.jsx("div",{className:"fixed z-[101] pointer-events-none",style:{left:`${(i=a.position)==null?void 0:i.x}px`,top:`${(s=a.position)==null?void 0:s.y}px`},children:o.jsx(bg,{message:a.message,type:a.type,onClose:()=>t(a.id),isPositioned:!0})},a.id)})]})},WI=()=>{const[e,t]=x.useState(0),n=x.useRef(0),r=x.useRef(performance.now()),a=x.useRef(0);return x.useEffect(()=>{const i=s=>{n.current++,s-r.current>1e3&&(t(n.current),n.current=0,r.current=s),a.current=requestAnimationFrame(i)};return a.current=requestAnimationFrame(i),()=>{cancelAnimationFrame(a.current)}},[]),o.jsx("div",{className:"absolute top-2 right-2 z-20 pointer-events-none bg-gray-800/80 backdrop-blur-sm px-4 py-2 rounded-lg border border-gray-700",children:o.jsxs("div",{className:"font-mono text-2xl font-bold text-emerald-400 select-none",children:[e," FPS"]})})},wg="",YI=({isOpen:e,onSave:t,onClose:n,onClear:r,hasExistingKey:a,initialUseFreeKey:i})=>{const{t:s}=Ht(),[l,c]=x.useState(""),[d,h]=x.useState(i),g=x.useRef(null);x.useEffect(()=>{if(e){const y=localStorage.getItem("gemini-api-key");c(y?wg:""),h(i),setTimeout(()=>{var v;return(v=g.current)==null?void 0:v.focus()},100)}},[e,i]);const m=()=>{const y=l.trim()===wg?"":l.trim();t(y,d)},_=y=>{y.key==="Enter"?m():y.key==="Escape"&&n()};return e?o.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 cursor-default",onMouseDown:n,children:o.jsxs("div",{className:"bg-gray-800 rounded-lg w-full max-w-md border border-gray-700 flex flex-col",onMouseDown:y=>y.stopPropagation(),onKeyDown:_,children:[o.jsx("div",{className:"p-4 border-b border-gray-700",children:o.jsx("h2",{className:"text-lg font-bold text-emerald-400",children:s("dialog.apiKey.title")})}),o.jsxs("div",{className:"p-6 space-y-4",children:[o.jsx("p",{className:"text-sm text-gray-300",children:s("dialog.apiKey.description")}),o.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"block text-sm text-emerald-400 hover:text-emerald-300 hover:underline",children:s("dialog.settings.getApiKeyLink")}),a&&o.jsx("div",{className:"text-sm text-emerald-300 bg-emerald-900/50 p-3 rounded-md border border-emerald-700",children:s("dialog.apiKey.keyExists")}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"api-key-input",className:"block text-sm font-medium text-gray-300 mb-2",children:s(a?"dialog.apiKey.update":"dialog.settings.apiKeyLabel")}),o.jsx("input",{id:"api-key-input",ref:g,type:"password",value:l,onChange:y=>c(y.target.value),placeholder:s("dialog.settings.apiKeyPlaceholder"),disabled:d,className:"w-full px-3 py-2 bg-gray-900 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 disabled:bg-gray-800 disabled:text-gray-500"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("input",{id:"use-free-key-checkbox",type:"checkbox",checked:d,onChange:y=>h(y.target.checked),className:"h-4 w-4 rounded border-gray-500 text-emerald-600 focus:ring-emerald-500 bg-gray-700"}),o.jsx("label",{htmlFor:"use-free-key-checkbox",className:"text-sm text-gray-300 select-none",children:s("dialog.apiKey.useFreeKey")})]})]}),o.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-between items-center bg-gray-800/50 rounded-b-lg",children:[a?o.jsx("button",{onClick:r,className:"px-4 py-2 font-semibold text-white bg-gray-700 rounded-md hover:bg-red-700 transition-colors",children:s("dialog.apiKey.clear")}):o.jsx("div",{}),o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("button",{onClick:n,className:"px-4 py-2 font-semibold text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600 transition-colors",children:s("dialog.rename.cancel")}),o.jsx("button",{onClick:m,className:"px-4 py-2 font-bold text-white bg-emerald-600 rounded-md hover:bg-emerald-700 transition-colors",children:s(a?"dialog.apiKey.update":"dialog.apiKey.save")})]})]})]})}):null},_g="",qI=({isOpen:e,onSave:t,isFirstRun:n})=>{const{t:r,language:a,setLanguage:i}=Ht(),[s,l]=x.useState(""),c=x.useRef(null),[d,h]=x.useState(!1),[g,m]=x.useState(!1),[_,y]=x.useState(e),[v,C]=x.useState(!1),w=x.useRef(null),[b,f]=x.useState(!1),[T,I]=x.useState(!1),E=x.useMemo(()=>zl.filter(D=>D.code!=="sys"),[]),R=E.find(D=>D.code===a)||E[0];x.useEffect(()=>{if(e){y(!0);const D=localStorage.getItem("gemini-api-key");l(D?_g:""),m(!1),requestAnimationFrame(()=>{h(!0)}),setTimeout(()=>{var G;return(G=c.current)==null?void 0:G.focus()},100)}else g||(h(!1),y(!1),C(!1),I(!1))},[e,g]),x.useEffect(()=>{const D=G=>{w.current&&!w.current.contains(G.target)&&C(!1)};return v&&document.addEventListener("mousedown",D),()=>document.removeEventListener("mousedown",D)},[v]),x.useEffect(()=>{b&&a==="ru"&&(f(!1),N("",!0))},[a,b]);const N=(D,G)=>{m(!0),t(D,G),setTimeout(()=>{h(!1),y(!1),m(!1)},1200)},A=()=>{const D=s.trim()===_g?"":s.trim();N(D,!1)},k=()=>{i("ru"),f(!0)},P=()=>{I(!0)},M=async()=>{localStorage.removeItem("script-modifier-autosave"),await new Promise(G=>{const q=indexedDB.deleteDatabase("ScriptModifierDB");q.onsuccess=()=>G(),q.onerror=()=>G(),q.onblocked=()=>G()}),window.isReloading=!0,window.location.reload()},H=D=>{const G=E.findIndex(te=>te.code===a),q=E.length;let ie;if(G===-1){i(E[0].code);return}D==="next"?ie=(G+1)%q:ie=(G-1+q)%q,i(E[ie].code)},W=D=>{if(D.key==="Enter"&&!T){A();return}const G=document.activeElement===c.current,q=s.length>0;if(!(G&&q)){if(T){D.key==="Escape"&&I(!1);return}D.key==="ArrowLeft"?H("prev"):D.key==="ArrowRight"&&H("next")}},O=D=>{i(D),C(!1)},U=()=>{var D;!v&&!T&&((D=c.current)==null||D.focus())};if(!_)return null;const z=d&&!g?"opacity-100":"opacity-0";return o.jsxs("div",{className:`fixed inset-0 bg-gray-900 z-[200] flex flex-col items-center justify-center overflow-hidden font-sans cursor-default transition-opacity duration-700 ease-in-out ${z}`,style:{transitionDelay:g?"0.5s":"0s"},onMouseDown:D=>D.stopPropagation(),onKeyDown:W,onClick:U,children:[o.jsx("style",{children:`
    @keyframes launchSequence {
        0% { transform: scale(1) translateY(0); opacity: 1; }
        /* Phase 1: Preparation (Breathing in / Anticipation) - Scales UP slightly */
        35% { transform: scale(1.03) translateY(5px); opacity: 1; }
        /* Phase 2: Launch (Spring out) - Shoots UP and zooms away */
        100% { transform: scale(0.8) translateY(-120vh); opacity: 0; }
    }
    @keyframes landSequence {
        0% { transform: scale(1.05) translateY(20px); opacity: 0; }
        100% { transform: scale(1) translateY(0); opacity: 1; }
    }
    @keyframes textShimmer {
        0% { background-position: 100% 50%; }
        100% { background-position: -100% 50%; }
    }
    @keyframes rotate-ring {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
  `}),o.jsxs("div",{className:`absolute top-4 right-4 z-50 flex items-center gap-4 transition-opacity duration-300 ${g?"opacity-0":""}`,children:[o.jsxs("button",{onClick:D=>{D.stopPropagation(),P()},className:"flex items-center gap-2 px-3 py-1 bg-gray-800 hover:bg-red-900/50 border border-gray-600 hover:border-red-500 rounded-full text-xs text-gray-400 hover:text-red-400 transition-all group",title:r("welcome.reload"),children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 transition-transform group-hover:rotate-180",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),o.jsx("span",{className:"hidden sm:inline",children:r("welcome.reload")})]}),o.jsx("div",{className:"h-4 w-px bg-gray-700 mx-1"}),o.jsx("a",{href:"https://github.com/Neytrino2134/Script-Modifier",target:"_blank",rel:"noopener noreferrer",className:"opacity-70 hover:opacity-100 transition-opacity",title:"View on GitHub",children:o.jsx("svg",{width:"32",height:"32",viewBox:"0 0 98 96",xmlns:"http://www.w3.org/2000/svg",className:"text-white fill-current",children:o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"})})}),o.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",className:"opacity-70 hover:opacity-100 transition-opacity",children:o.jsx("img",{src:"https://www.netlify.com/assets/badges/netlify-badge-color-accent.svg",alt:"Deploys by Netlify"})})]}),o.jsx("div",{className:"absolute bottom-0 right-0 text-emerald-900/20 pointer-events-none select-none transition-transform duration-1000",style:{transform:g?"scale(1.5) rotate(-30deg)":"scale(1) rotate(-20deg)"},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-[50vw] h-[50vw] transform translate-x-1/5 translate-y-1/5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"0.5",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})})}),T&&o.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:D=>{D.stopPropagation(),I(!1)},children:o.jsxs("div",{className:"bg-gray-800 border border-gray-600 p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4 transform transition-all scale-100",onClick:D=>D.stopPropagation(),children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:r("welcome.reloadTitle")}),o.jsx("p",{className:"text-gray-300 text-sm mb-6 leading-relaxed",children:r("welcome.reloadMessage")}),o.jsxs("div",{className:"flex justify-end gap-3",children:[o.jsx("button",{onClick:()=>I(!1),className:"px-4 py-2 rounded-lg text-gray-300 hover:text-white hover:bg-gray-700 transition-colors text-sm font-semibold",children:r("dialog.rename.cancel")}),o.jsxs("button",{onClick:M,className:"px-4 py-2 rounded-lg bg-red-600 hover:bg-red-500 text-white shadow-lg shadow-red-900/30 transition-colors text-sm font-bold flex items-center gap-2",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),r("welcome.confirmReload")]})]})]})}),o.jsxs("div",{className:`z-10 w-full flex flex-col items-center ${T?"blur-sm pointer-events-none":""}`,style:{animation:g?"launchSequence 0.8s cubic-bezier(0.5, 0, 0.2, 1) forwards":"landSequence 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards"},children:[o.jsxs("div",{className:"w-full px-4 mb-4 flex items-center justify-center gap-6 md:gap-12 relative z-20",children:[o.jsx("button",{onClick:()=>H("prev"),className:`mt-3 w-12 h-12 md:w-16 md:h-16 flex-shrink-0 rounded-full bg-gray-800/40 hover:bg-emerald-600/80 border border-gray-600/50 hover:border-emerald-400 backdrop-blur-md flex items-center justify-center transition-all duration-300 transform hover:scale-110 group focus:outline-none focus:ring-2 focus:ring-emerald-500/50 ${g?"opacity-0 scale-75":"opacity-100 scale-100"}`,"aria-label":"Previous Language",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-6 h-6 md:w-8 md:h-8 text-gray-400 group-hover:text-white transition-colors",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),o.jsxs("div",{className:"flex flex-col items-center justify-center -space-y-4 md:-space-y-6 mb-2",style:{transform:g?"scale(0.9) translateY(10px)":"scale(1) translateY(0)",opacity:g?0:1,filter:g?"blur(4px)":"none",transition:"all 0.5s ease-out"},children:[o.jsx("h1",{className:"font-black tracking-tighter select-none leading-tight whitespace-nowrap text-center text-transparent bg-clip-text px-4",style:{fontSize:"clamp(2.5rem, 10vw, 8rem)",backgroundImage:"linear-gradient(90deg, #34d399, #22d3ee, #34d399)",backgroundSize:"200% auto",animation:"textShimmer 3s linear infinite",paddingBottom:"0.1em",paddingRight:"0.2em",marginRight:"-0.2em"},children:r("dialog.welcome.heading")}),o.jsx("h1",{className:"font-black tracking-tighter select-none leading-tight whitespace-nowrap text-center text-transparent bg-clip-text px-4",style:{fontSize:"clamp(2.5rem, 10vw, 8rem)",backgroundImage:"linear-gradient(90deg, #34d399, #22d3ee, #34d399)",backgroundSize:"200% auto",animation:"textShimmer 3s linear infinite reverse",paddingBottom:"0.1em",paddingRight:"0.2em",marginRight:"-0.2em"},children:r("app.title")})]}),o.jsx("button",{onClick:()=>H("next"),className:`mt-3 w-12 h-12 md:w-16 md:h-16 flex-shrink-0 rounded-full bg-gray-800/40 hover:bg-emerald-600/80 border border-gray-600/50 hover:border-emerald-400 backdrop-blur-md flex items-center justify-center transition-all duration-300 transform hover:scale-110 group focus:outline-none focus:ring-2 focus:ring-emerald-500/50 ${g?"opacity-0 scale-75":"opacity-100 scale-100"}`,"aria-label":"Next Language",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-6 h-6 md:w-8 md:h-8 text-gray-400 group-hover:text-white transition-colors",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})})]}),o.jsxs("div",{className:"relative w-[850px] h-[550px] mx-auto max-w-[95vw] max-h-[85vh]",children:[o.jsx("div",{className:"welcome-ring",style:{"--ring-speed":"10s"}}),o.jsx("div",{className:"relative w-full h-full bg-gray-800/90 backdrop-blur-2xl rounded-3xl border border-gray-700 shadow-2xl overflow-visible z-10 flex flex-col justify-center",onClick:D=>D.stopPropagation(),children:o.jsxs("div",{className:"p-8 md:p-12 space-y-8 flex flex-col h-full justify-between",children:[o.jsxs("div",{className:"space-y-6 flex flex-col flex-grow justify-center",children:[o.jsx("div",{className:"space-y-4 w-full text-left",children:o.jsxs("p",{className:"text-lg md:text-xl text-gray-300 leading-relaxed font-normal",children:[r("dialog.welcome.intro1")," ",r("dialog.welcome.intro2")]})}),o.jsx("div",{className:"h-px w-full bg-gray-700"}),o.jsxs("div",{className:"w-full space-y-5",children:[o.jsxs("div",{className:"space-y-2 relative",ref:w,children:[o.jsx("label",{className:"block text-sm font-semibold text-gray-400 uppercase tracking-wider text-left pl-1",children:"SELECT YOUR PRIMARY LANGUAGE"}),o.jsxs("button",{onClick:()=>C(!v),className:`w-full p-2.5 bg-gray-900/80 border ${v?"border-emerald-500":"border-gray-600 hover:border-gray-500"} rounded-xl text-white focus:outline-none focus:ring-0 transition-colors shadow-inner flex justify-between items-center group`,children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold border border-gray-600 bg-gray-800 text-gray-400",children:R.label}),o.jsxs("span",{className:"font-semibold tracking-wide text-sm",children:[R.name," ",o.jsxs("span",{className:"text-gray-500 ml-1",children:["(",R.englishName,")"]})]})]}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 text-gray-400 group-hover:text-emerald-400 transition-all duration-300 ${v?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),v&&o.jsx("div",{className:"absolute top-full left-0 w-full mt-2 bg-gray-900 border border-cyan-800/50 rounded-xl overflow-hidden shadow-2xl z-50 animate-slide-down max-h-60 overflow-y-auto custom-scrollbar",children:E.map(D=>{const G=a===D.code;return o.jsxs("div",{onClick:()=>O(D.code),className:`p-2.5 px-4 cursor-pointer transition-colors flex justify-between items-center ${G?"bg-cyan-900/30 text-cyan-400":"text-gray-300 hover:bg-gray-800 hover:text-white"}`,children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold border transition-colors ${G?"border-cyan-500 bg-cyan-900/50 text-cyan-400":"border-gray-600 bg-gray-800 text-gray-400"}`,children:D.label}),o.jsxs("span",{className:"font-medium text-sm",children:[D.name," ",o.jsxs("span",{className:`ml-1 ${G?"text-cyan-600/70":"text-gray-600"}`,children:["(",D.englishName,")"]})]})]}),G&&o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-cyan-400",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},D.code)})})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between items-baseline px-1",children:[o.jsx("label",{htmlFor:"welcome-api-key",className:"block text-sm font-semibold text-gray-300",children:r("dialog.settings.apiKeyLabel")}),o.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-emerald-400 hover:text-emerald-300 hover:underline transition-colors",children:r("dialog.settings.getApiKeyLink")})]}),o.jsx("div",{className:"relative group",children:o.jsx("input",{type:"password",id:"welcome-api-key",ref:c,value:s,onChange:D=>l(D.target.value),placeholder:r("dialog.settings.apiKeyPlaceholder"),className:"w-full p-3.5 text-lg bg-gray-900/80 border border-gray-600 rounded-xl text-white focus:outline-none focus:border-emerald-500 focus:ring-0 placeholder-gray-500 transition-colors shadow-inner block hover:border-gray-500"})}),o.jsx("p",{className:"text-xs text-gray-500 px-1 text-center",children:r("dialog.welcome.apiKeyExplanation")})]})]})]}),o.jsxs("div",{className:"flex flex-col-reverse justify-center items-center gap-2 w-full pt-4 border-t border-gray-700/50",children:[o.jsx("button",{onClick:k,className:"w-full py-3 text-sm font-bold text-gray-500 hover:text-gray-300 hover:bg-white/5 rounded-xl transition-all duration-200",children:r("welcome.iAmDeveloper")}),o.jsx("button",{onClick:A,className:`
                                w-full px-12 py-3.5 text-xl font-bold text-white 
                                rounded-xl 
                                shadow-lg shadow-emerald-900/40 
                                transition-all duration-300 ease-out
                                flex items-center justify-center gap-2
                                relative overflow-hidden group
                                ${g?"":"hover:scale-105 active:scale-95"}
                            `,style:{backgroundImage:"linear-gradient(90deg, #059669, #34d399, #059669)",backgroundSize:"200% auto",animation:"textShimmer 3s linear infinite"},children:o.jsxs("div",{className:`flex items-center gap-2 transition-all duration-500 transform ${g?"translate-x-[150%] opacity-0":"translate-x-0 opacity-100"}`,children:[o.jsx("span",{children:r(n?"welcome.letsGo":"welcome.resume")}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"currentColor",className:"w-5 h-5 transition-transform duration-300 group-hover:translate-x-1",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"})})]})})]})]})})]}),o.jsxs("a",{href:"https://promptmodifier2.netlify.app/",target:"_blank",rel:"noopener noreferrer",className:`
            mt-8 px-6 py-2 rounded-full
            bg-gray-800/50 hover:bg-gray-700/80
            border border-gray-600/50 hover:border-emerald-500/50
            text-gray-400 hover:text-emerald-400
            text-sm font-semibold tracking-wide
            transition-all duration-300
            flex items-center gap-2
            backdrop-blur-sm
            z-50
            ${g?"opacity-0 translate-y-4":"opacity-100"}
          `,style:{transitionDelay:"0.1s"},children:[o.jsx("span",{children:"Go to Prompt Modifier"}),o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]})]})},KI=()=>o.jsx("div",{className:"flex items-center h-full px-2 select-none",children:o.jsx("div",{className:"px-2 py-0.5 rounded text-[10px] font-mono text-gray-400 bg-gray-800 border border-gray-700 shadow-sm",children:"v0.1.5 Alpha.3"})}),JI=({tab:e,index:t,isActive:n,onClick:r,onClose:a,onRename:i})=>{const[s,l]=x.useState(!1),[c,d]=x.useState(e.name),h=x.useRef(null);x.useEffect(()=>{d(e.name)},[e.name]),x.useEffect(()=>{s&&h.current&&(h.current.focus(),h.current.select())},[s]);const g=()=>{c.trim()===""?d(e.name):c.trim()!==e.name&&i(t,c.trim()),l(!1)},m=y=>{y.key==="Enter"?g():y.key==="Escape"&&(d(e.name),l(!1))},_=n?"hover:bg-emerald-700":"hover:bg-gray-500";return o.jsx($d,{title:e.name,position:"bottom",className:"h-full",children:o.jsxs("div",{onMouseDown:()=>r(t),onDoubleClick:()=>l(!0),className:`flex items-center justify-between px-4 h-full cursor-pointer max-w-[200px] transition-colors rounded-md ${n?"bg-emerald-600 text-white":"bg-gray-700 text-gray-300 hover:bg-emerald-600 hover:text-white"}`,children:[s?o.jsx("input",{ref:h,value:c,onChange:y=>d(y.target.value),onBlur:g,onKeyDown:m,onMouseDown:y=>y.stopPropagation(),onClick:y=>y.stopPropagation(),className:"bg-transparent outline-none w-full text-sm"}):o.jsx("span",{className:"truncate text-sm",children:e.name}),o.jsx("button",{onMouseDown:y=>{y.stopPropagation(),a(t)},className:`ml-2 p-0.5 rounded-full ${_} transition-colors`,title:"Close tab",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})})},XI=({tabs:e,activeTabIndex:t,onTabClick:n,onCloseTab:r,onRenameTab:a})=>o.jsx("div",{className:"flex items-center h-full gap-1",children:e.map((i,s)=>o.jsx(JI,{tab:i,index:s,isActive:s===t,onClick:n,onClose:r,onRename:a},i.id))}),Is=({active:e,onClick:t,icon:n,title:r})=>o.jsx(lt,{title:r,position:"top",children:o.jsx("button",{onClick:t,className:`rounded-md flex items-center justify-center transition-colors w-8 h-8 ${e?"bg-emerald-600 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300"}`,children:n})}),ZI=({isOpen:e,position:t,onClose:n,onAddNode:r,slots:a,onAssignSlot:i,activeTool:s,onToolChange:l})=>{const{t:c}=Ht(),{isContextMenuPinned:d,toggleContextMenuPin:h,viewTransform:g,setZoom:m,handlePasteFromClipboard:_}=or(),y=x.useRef(null),[v,C]=x.useState(null),[w,b]=x.useState(t),[f,T]=x.useState(!1),I=x.useRef(!1),E=x.useRef({x:0,y:0});x.useLayoutEffect(()=>{e?(b(t),C(null),requestAnimationFrame(()=>{T(!0)})):T(!1)},[e,t]),x.useLayoutEffect(()=>{y.current&&(y.current.style.left=`${w.x}px`,y.current.style.top=`${w.y}px`)},[w]);const R=x.useCallback(D=>{if(!I.current||!y.current)return;D.preventDefault();const G=D.clientX-E.current.x,q=D.clientY-E.current.y;y.current.style.left=`${G}px`,y.current.style.top=`${q}px`},[]),N=x.useCallback(D=>{if(I.current&&y.current){const G=D.clientX-E.current.x,q=D.clientY-E.current.y;b({x:G,y:q})}I.current=!1,window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",N)},[]),A=D=>{var q;if(D.button!==0)return;const G=(q=y.current)==null?void 0:q.getBoundingClientRect();G&&(I.current=!0,E.current={x:D.clientX-G.left,y:D.clientY-G.top},window.addEventListener("mousemove",R),window.addEventListener("mouseup",N))},k=x.useCallback(async()=>{await _(),d||n()},[_,d,n]);x.useEffect(()=>()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",N)},[R,N]);const P=D=>{const G=Number(D),q=.2,ie=2;if(G<1){const ye=Math.pow(1/q,.01);return Math.log(G/q)/Math.log(ye)-100}const te=Math.pow(ie,1/100);return Math.log(G)/Math.log(te)},M=D=>{const G=Number(D),q=.2,ie=2;if(G<0){const ye=Math.pow(1/q,.01);return Math.pow(ye,G+100)*q}const te=Math.pow(ie,1/100);return Math.pow(te,G)},H=D=>{m(D,{x:window.innerWidth/2,y:window.innerHeight/2})},W=(D,G)=>{G.stopPropagation(),a[D]&&!G.shiftKey?(r(a[D]),d||n()):C(D)},O=(D,G)=>{G.preventDefault(),G.stopPropagation(),C(D)},U=D=>{l(D),d||n()},z=x.useMemo(()=>[{title:c("search.group.input"),items:[{type:S.TEXT_INPUT,title:c("search.node.text_input.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 6h8M12 6v12"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 3h-1a2 2 0 00-2 2v14a2 2 0 002 2h1m12-18h1a2 2 0 012 2v14a2 2 0 01-2 2h-1"})]})},{type:S.NOTE,title:c("search.node.note.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})})},{type:S.DATA_READER,title:c("search.node.data_reader.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}]},{title:c("search.group.process"),items:[{type:S.PROMPT_PROCESSOR,title:c("search.node.prompt_processor.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672-2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{type:S.PROMPT_ANALYZER,title:c("search.node.prompt_analyzer.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})},{type:S.REROUTE_DOT,title:c("search.node.reroute_dot.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 12h8m-8 0l4-4m-4 4l4 4m8 0h8m-8 0l4-4m-4 4l4 4"})})}]},{title:c("search.group.scripting"),items:[{type:S.IDEA_GENERATOR,title:c("search.node.idea_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.375 3.375 0 0112 18.375V19.5"})})},{type:S.SCRIPT_GENERATOR,title:c("search.node.script_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{type:S.SCRIPT_ANALYZER,title:c("search.node.script_analyzer.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V6A2.25 2.25 0 0018.75 3.75H5.25A2.25 2.25 0 003 6v6"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75-.75h-.008a.75.75 0 01-.75-.75v-.008z"})]})},{type:S.SCRIPT_PROMPT_MODIFIER,title:c("search.node.script_prompt_modifier.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.75l-1.125 1.125m1.125-1.125L16.125 11.5m2.25 1.25l1.125-1.125m-1.125 1.125l-1.125-1.125M15 6l-2.25 2.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 6l2.25-2.25M15 6l-2.25-2.25"})]})}]},{title:c("search.group.character"),items:[{type:S.CHARACTER_GENERATOR,title:c("search.node.character_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})},{type:S.CHARACTER_CARD,title:c("search.node.character_card.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 3.75H4.5A2.25 2.25 0 002.25 6v12A2.25 2.25 0 004.5 20.25h15A2.25 2.25 0 0021.75 18V6A2.25 2.25 0 0019.5 3.75z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 8.25a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 16.5c0-2.485 2.015-4.5 4.5-4.5s4.5 2.015 4.5 4.5"})]})},{type:S.CHARACTER_ANALYZER,title:c("search.node.character_analyzer.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})}]},{title:c("search.group.images"),items:[{type:S.IMAGE_GENERATOR,title:c("search.node.image_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})},{type:S.IMAGE_PREVIEW,title:c("search.node.image_preview.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})}]},{title:c("search.group.ai"),items:[{type:S.TRANSLATOR,title:c("search.node.translator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{type:S.GEMINI_CHAT,title:c("search.node.gemini_chat.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:S.ERROR_ANALYZER,title:c("search.node.error_analyzer.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}]},{title:c("search.group.audio"),items:[{type:S.SPEECH_SYNTHESIZER,title:c("search.node.speech_synthesizer.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})},{type:S.NARRATOR_TEXT_GENERATOR,title:c("search.node.narrator_text_generator.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h3M18 12h3"})]})},{type:S.AUDIO_TRANSCRIBER,title:c("search.node.audio_transcriber.title"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12h5m-5 3h5m-5 3h5"})]})},{type:S.MUSIC_IDEA_GENERATOR,title:c("search.node.music_idea_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})})}]},{title:c("search.group.youtube"),items:[{type:S.YOUTUBE_TITLE_GENERATOR,title:c("search.node.youtube_title_generator.title"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-12v.75m0 3v.75m0 3v.75m0 3V18m-3 .75h18A2.25 2.25 0 0021 16.5V7.5A2.25 2.25 0 0018.75 5.25H5.25A2.25 2.25 0 003 7.5v9A2.25 2.25 0 005.25 18.75z"})})},{type:S.YOUTUBE_ANALYTICS,title:c("node.title.youtube_analytics"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})}]}],[c]),L=D=>{for(const G of z){const q=G.items.find(ie=>ie.type===D);if(q)return q.icon}return null};return e?o.jsxs(o.Fragment,{children:[o.jsxs("div",{ref:y,className:`fixed bg-gray-800/90 backdrop-blur-sm rounded-lg border border-gray-700 shadow-xl p-1.5 flex flex-col space-y-1.5 z-50 cursor-default transition-[opacity,transform] duration-200 ease-out origin-top-left ${f?"opacity-100 scale-100":"opacity-0 scale-95"} ${d?"pinned-menu":""}`,onClick:D=>D.stopPropagation(),onMouseDown:D=>D.stopPropagation(),onWheel:D=>D.stopPropagation(),onContextMenu:D=>D.preventDefault(),children:[o.jsxs("div",{className:"flex items-center justify-between pb-1 border-b border-gray-600 cursor-move w-full",onMouseDown:A,children:[o.jsx("span",{className:"text-xs text-gray-400 font-semibold px-1 select-none",children:c("contextMenu.tools")}),o.jsx(lt,{title:d?"Unpin":"Pin",position:"left",children:o.jsx("button",{onClick:D=>{D.stopPropagation(),h()},className:`p-1 rounded hover:bg-gray-700 transition-colors ${d?"text-emerald-400":"text-gray-400"}`,onMouseDown:D=>D.stopPropagation(),children:d?o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4 h-4",children:o.jsx("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"})}):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.563.045.796.77.357 1.145l-4.163 3.566a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.163-3.566c-.44-.375-.206-1.1.357-1.145l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"})})})})]}),o.jsxs("div",{className:"grid grid-cols-4 gap-0.5",children:[o.jsx(Is,{active:s==="edit",onClick:()=>U("edit"),title:c("toolbar.edit"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})}),o.jsx(Is,{active:s==="cutter",onClick:()=>U("cutter"),title:c("toolbar.cutter"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),o.jsx(Is,{active:s==="selection",onClick:()=>U("selection"),title:c("toolbar.selection"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"4 4",d:"M3.75 3.75h16.5v16.5H3.75z"})})}),o.jsx(Is,{active:s==="reroute",onClick:()=>U("reroute"),title:c("toolbar.reroute"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 12h8m-8 0l4-4m-4 4l4 4m8 0h8m-8 0l4-4m-4 4l4 4"})})})]}),o.jsx("div",{className:"h-px bg-gray-600 w-full my-0.5"}),o.jsx("div",{className:"grid grid-cols-4 gap-0.5",children:a.map((D,G)=>o.jsx(lt,{title:D?c("contextMenu.addNodeFromSlot",{node:c(`node.title.${D.toLowerCase()}`),index:G+1}):c("contextMenu.assignSlot",{index:G+1}),position:"bottom",children:o.jsxs("button",{onClick:q=>W(G,q),onContextMenu:q=>O(G,q),className:`w-8 h-8 rounded-md flex items-center justify-center transition-colors relative group ${D?"bg-gray-700 hover:bg-emerald-600 text-emerald-400":"bg-gray-800 border border-gray-700 hover:bg-gray-700 text-gray-500"}`,children:[D?L(D):o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),o.jsx("span",{className:"absolute top-0.5 right-0.5 text-[8px] font-mono text-gray-500 group-hover:text-gray-300",children:G+1})]})},G))}),o.jsxs("div",{className:"flex items-center justify-center space-x-2 pt-1 border-t border-gray-600 w-full",children:[o.jsx("input",{type:"range",min:"-100",max:"100",step:"1",value:P(g.scale),onChange:D=>H(M(parseFloat(D.target.value))),className:"w-20 min-w-0 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-emerald-500"}),o.jsxs("button",{onClick:()=>H(1),className:"text-[10px] font-semibold text-gray-400 hover:text-white w-8 text-center hover:bg-emerald-600 rounded py-0.5 flex-shrink-0",children:[Math.round(g.scale*100),"%"]})]}),o.jsx("div",{className:"text-[10px] text-gray-500 text-center pt-1 select-none border-t border-gray-700/50 w-full",children:"Key 1-8 to Quick Add"}),o.jsx("div",{className:"h-px bg-gray-700 w-full my-0.5"}),o.jsxs("button",{onClick:k,className:"w-full flex items-center justify-center space-x-2 p-1 rounded hover:bg-gray-700 text-gray-300 hover:text-white transition-colors text-xs font-semibold",children:[o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),o.jsx("span",{children:c("contextMenu.paste")})]})]}),v!==null&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 z-[59] bg-transparent",onClick:D=>{D.stopPropagation(),C(null)},onMouseDown:D=>D.stopPropagation()}),o.jsxs("div",{className:"fixed z-[60] bg-gray-800 rounded-lg border border-gray-700 shadow-xl flex flex-col overflow-hidden max-h-[400px] w-64 cursor-default",style:{left:w.x+20,top:w.y+20},onClick:D=>D.stopPropagation(),onMouseDown:D=>D.stopPropagation(),onWheel:D=>D.stopPropagation(),children:[o.jsxs("div",{className:"p-2 bg-gray-900 border-b border-gray-700 font-semibold text-gray-300 text-sm flex justify-between items-center",children:[o.jsx("span",{children:c("contextMenu.assignSlot",{index:v+1})}),o.jsx("button",{onClick:()=>C(null),className:"text-gray-500 hover:text-white",children:""})]}),o.jsx("div",{className:"overflow-y-auto custom-scrollbar p-1",children:z.map((D,G)=>o.jsxs("div",{className:"mb-2",children:[o.jsx("div",{className:"px-2 py-1 text-xs font-bold text-gray-500 uppercase",children:D.title}),D.items.map(q=>o.jsxs("button",{onClick:()=>{i(v,q.type),C(null)},className:"w-full flex items-center space-x-2 px-2 py-1.5 hover:bg-emerald-600 rounded-md text-left text-sm text-gray-300 hover:text-white transition-colors",children:[o.jsx("div",{className:"text-gray-400 group-hover:text-white",children:q.icon}),o.jsx("span",{children:q.title})]},q.type))]},G))})]})]})]}):null},QI=_t.memo(ZI),eP=({isOpen:e,position:t,fromType:n,onClose:r,onSelect:a})=>{const{t:i}=Ht(),s=x.useRef(null),l=x.useRef(null),[c,d]=x.useState(""),[h,g]=x.useState(t),[m,_]=x.useState(!1),y=x.useRef(!1),v=x.useRef({x:0,y:0});x.useLayoutEffect(()=>{e?(g(t),d(""),requestAnimationFrame(()=>_(!0)),setTimeout(()=>{var N;return(N=l.current)==null?void 0:N.focus()},50)):_(!1)},[e,t]),x.useLayoutEffect(()=>{s.current&&(s.current.style.left=`${h.x}px`,s.current.style.top=`${h.y}px`)},[h]),x.useEffect(()=>{const N=A=>{if(s.current&&!s.current.contains(A.target)){if(y.current||A.target.closest(".pinned-menu"))return;r()}};return e&&document.addEventListener("mousedown",N),()=>{document.removeEventListener("mousedown",N)}},[e,r]);const C=N=>{if(!y.current||!s.current)return;N.preventDefault();const A=N.clientX-v.current.x,k=N.clientY-v.current.y;s.current.style.left=`${A}px`,s.current.style.top=`${k}px`},w=N=>{if(y.current&&s.current){const A=N.clientX-v.current.x,k=N.clientY-v.current.y;g({x:A,y:k})}y.current=!1,window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",w)},b=N=>{var k;if(N.button!==0)return;N.stopPropagation();const A=(k=s.current)==null?void 0:k.getBoundingClientRect();A&&(y.current=!0,v.current={x:N.clientX-A.left,y:N.clientY-A.top},window.addEventListener("mousemove",C),window.addEventListener("mouseup",w))};x.useEffect(()=>()=>{window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",w)},[]);const f={[S.TEXT_INPUT]:"T",[S.PROMPT_PROCESSOR]:"P",[S.PROMPT_ANALYZER]:"A",[S.GEMINI_CHAT]:"G",[S.TRANSLATOR]:"L",[S.NOTE]:"N",[S.IMAGE_GENERATOR]:"O",[S.IMAGE_PREVIEW]:"I",[S.IDEA_GENERATOR]:"Shift+A",[S.SCRIPT_GENERATOR]:"Shift+S",[S.SCRIPT_ANALYZER]:"Shift+D",[S.SCRIPT_PROMPT_MODIFIER]:"Shift+F",[S.CHARACTER_GENERATOR]:"Shift+C",[S.CHARACTER_CARD]:"Ctrl+Shift+C",[S.DATA_READER]:"Shift+R",[S.NARRATOR_TEXT_GENERATOR]:"Shift+G",[S.SPEECH_SYNTHESIZER]:"Shift+N",[S.AUDIO_TRANSCRIBER]:"Shift+B",[S.YOUTUBE_TITLE_GENERATOR]:"Shift+T",[S.YOUTUBE_ANALYTICS]:"Shift+Y",[S.MUSIC_IDEA_GENERATOR]:"Shift+M"},T=x.useMemo(()=>[{title:i("toolbar.group.prompting"),items:[{type:S.PROMPT_PROCESSOR,title:i("node.title.prompt_processor"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a3.375 3.375 0 00-2.672-2.672L11.25 18l1.938-.648a3.375 3.375 0 002.672-2.672L16.25 13l.648 1.938a3.375 3.375 0 002.672 2.672L21.75 18l-1.938.648a3.375 3.375 0 00-2.672 2.672z"})})},{type:S.PROMPT_ANALYZER,title:i("node.title.prompt_analyzer"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 14h6M9 11h6M9 8h6"})]})}]},{title:i("toolbar.group.scripting"),items:[{type:S.IDEA_GENERATOR,title:i("node.title.idea_generator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.375 3.375 0 0112 18.375V19.5"})})},{type:S.SCRIPT_GENERATOR,title:i("node.title.script_generator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M10.5 16.5h3M15 19.5h-6a2.25 2.25 0 01-2.25-2.25V6.75A2.25 2.25 0 018.25 4.5h7.5a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0115.75 19.5h-1.5"})})},{type:S.SCRIPT_ANALYZER,title:i("node.title.script_analyzer"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 12m18 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6m18 0V6A2.25 2.25 0 0018.75 3.75H5.25A2.25 2.25 0 003 6v6"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15.75a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75-.75h-.008a.75.75 0 01-.75-.75v-.008z"})]})},{type:S.SCRIPT_PROMPT_MODIFIER,title:i("node.title.script_prompt_modifier"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.375 12.75l-1.125 1.125m1.125-1.125L16.125 11.5m2.25 1.25l1.125-1.125m-1.125 1.125l-1.125-1.125M15 6l-2.25 2.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 6l2.25-2.25M15 6l-2.25-2.25"})]})}]},{title:i("toolbar.group.characters"),items:[{type:S.CHARACTER_GENERATOR,title:i("node.title.character_generator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})},{type:S.CHARACTER_CARD,title:i("node.title.character_card"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 3.75H4.5A2.25 2.25 0 002.25 6v12A2.25 2.25 0 004.5 20.25h15A2.25 2.25 0 0021.75 18V6A2.25 2.25 0 0019.5 3.75z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 8.25a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 16.5c0-2.485 2.015-4.5 4.5-4.5s4.5 2.015 4.5 4.5"})]})},{type:S.CHARACTER_ANALYZER,title:i("node.title.character_analyzer"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9a3 3 0 11-6 0 3 3 0 016 0z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14.25c-3.1 0-5.88-1.5-7.5-3.75m15 3.75c-1.62-2.25-4.4-3.75-7.5-3.75S6.12 12 4.5 14.25"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]})}]},{title:i("toolbar.group.images"),items:[{type:S.IMAGE_GENERATOR,title:i("node.title.image_generator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})},{type:S.IMAGE_PREVIEW,title:i("node.title.image_preview"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})})}]},{title:i("toolbar.group.ai"),items:[{type:S.TRANSLATOR,title:i("node.title.translator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L12 6l6 12M8 14h8"})})},{type:S.GEMINI_CHAT,title:i("node.title.gemini_chat"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{type:S.ERROR_ANALYZER,title:i("node.title.error_analyzer"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}]},{title:i("toolbar.group.audio"),items:[{type:S.SPEECH_SYNTHESIZER,title:i("node.title.speech_synthesizer"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})})},{type:S.NARRATOR_TEXT_GENERATOR,title:i("node.title.narrator_text_generator"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h3M18 12h3"})]})},{type:S.AUDIO_TRANSCRIBER,title:i("node.title.audio_transcriber"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12h5m-5 3h5m-5 3h5"})]})},{type:S.MUSIC_IDEA_GENERATOR,title:i("node.title.music_idea_generator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12-3"})})}]},{title:`${i("toolbar.group.general")} / ${i("toolbar.group.youtube")}`,items:[{type:S.DATA_READER,title:i("node.title.data_reader"),icon:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})},{type:S.YOUTUBE_TITLE_GENERATOR,title:i("node.title.youtube_title_generator"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-12v.75m0 3v.75m0 3v.75m0 3V18m-3 .75h18A2.25 2.25 0 0021 16.5V7.5A2.25 2.25 0 0018.75 5.25H5.25A2.25 2.25 0 003 7.5v9A2.25 2.25 0 005.25 18.75z"})})},{type:S.YOUTUBE_ANALYTICS,title:i("node.title.youtube_analytics"),icon:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})}]}],[i]),I=x.useMemo(()=>{const N=[];let A=1;return T.forEach(k=>{k.items.forEach(P=>{const M=Jr({type:P.type});M!==null&&(n==="image"&&M!=="image"||n==="text"&&M!=="text"||N.push({...P,index:A++,hotkey:f[P.type]||""}))})}),N},[T,n]),E=x.useMemo(()=>{if(!c)return I;const N=c.toLowerCase();return I.filter(A=>A.title.toLowerCase().includes(N)||A.index.toString().startsWith(N)||A.hotkey&&A.hotkey.toLowerCase().includes(N))},[I,c]),R=N=>{N.stopPropagation(),N.key==="Escape"?r():N.key==="Enter"&&E.length>0&&a(E[0].type)};return e?o.jsxs("div",{ref:s,className:`fixed bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-2xl border border-gray-700 p-2 flex flex-col space-y-2 max-h-[400px] w-72 cursor-default transition-[opacity,transform] duration-200 ease-out ${m?"opacity-100 scale-100":"opacity-0 scale-95"}`,style:{left:h.x,top:h.y,zIndex:1e3},onMouseDown:b,onWheel:N=>N.stopPropagation(),children:[o.jsxs("div",{className:"px-2 py-1 border-b border-gray-700 flex justify-between items-center cursor-move",onMouseDown:b,children:[o.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase select-none",children:i("connectionMenu.title")}),o.jsx("button",{onClick:N=>{N.stopPropagation(),r()},className:"text-gray-400 hover:text-white hover:bg-red-600/20 focus:outline-none p-1 rounded transition-colors",title:"Close",onMouseDown:N=>N.stopPropagation(),children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),o.jsx("input",{ref:l,type:"text",value:c,onChange:N=>d(N.target.value),onKeyDown:R,placeholder:i("search.placeholder"),className:"w-full px-2 py-1.5 bg-gray-900/50 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 text-sm",onMouseDown:N=>N.stopPropagation()}),o.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar space-y-1 min-h-0",children:E.length===0?o.jsx("div",{className:"p-2 text-gray-400 text-sm text-center",children:i("search.noResults")}):E.map(N=>o.jsxs("button",{onClick:()=>a(N.type),className:"flex items-center space-x-3 p-2 rounded-md text-left w-full text-gray-200 hover:bg-emerald-600 hover:text-white transition-colors group",onMouseDown:A=>A.stopPropagation(),children:[o.jsx("div",{className:"flex-shrink-0 w-6 text-center text-gray-500 font-mono text-xs group-hover:text-emerald-200 select-none",children:N.index}),o.jsx("div",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center bg-gray-700 rounded text-gray-300 group-hover:text-white",children:N.icon}),o.jsx("span",{className:"text-sm font-semibold truncate flex-grow",children:N.title}),N.hotkey&&o.jsx("span",{className:"text-[10px] text-gray-500 font-mono px-1.5 py-0.5 bg-gray-800 rounded group-hover:bg-emerald-700 group-hover:text-emerald-100 select-none",children:N.hotkey})]},N.type))})]}):null};let tP=1e3;const Cg=()=>++tP,nP=(e,t=2)=>{if(e===0)return"0 Bytes";const n=1024,r=t<0?0:t,a=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,i)).toFixed(r))+" "+a[i]},jc="imageViewerPosition",Lc="imageViewerSize",oP=({sources:e,initialIndex:t,initialPosition:n,onClose:r,onDownloadImageFromUrl:a,onCopyImageToClipboard:i,onOpenInEditor:s})=>{const{t:l}=Ht(),[c,d]=x.useState(Cg()),[h,g]=x.useState(!1),[m,_]=x.useState(()=>{try{const B=localStorage.getItem(jc);if(B){const X=JSON.parse(B);if(typeof X.x=="number"&&typeof X.y=="number")return X}}catch(B){console.error("Failed to load ImageViewer position",B)}return n}),[y,v]=x.useState(()=>{try{const B=localStorage.getItem(Lc);if(B){const X=JSON.parse(B);if(X.width&&X.height)return X}}catch(B){console.error("Failed to load ImageViewer size",B)}return{width:"80vw",height:"80vh"}}),[C,w]=x.useState(!1),b=x.useRef(m);x.useEffect(()=>{b.current=m},[m]);const[f,T]=x.useState(t),I=x.useRef(null),E=x.useRef(null),R=x.useRef(null),[N,A]=x.useState(1),[k,P]=x.useState({x:0,y:0}),[M,H]=x.useState(!1),W=x.useRef(null),[O,U]=x.useState({width:0,height:0,size:null}),z=e[f],L=B=>{if(B.startsWith("data:")){const X=B.length-(B.indexOf(",")+1),F=B.charAt(B.length-1)==="="?B.charAt(B.length-2)==="="?2:1:0,Y=X*.75-F;return nP(Y)}return null};x.useEffect(()=>{requestAnimationFrame(()=>w(!0)),D()},[]),x.useEffect(()=>{if(!z)return;const B=new Image;B.onload=()=>{U({width:B.naturalWidth,height:B.naturalHeight,size:L(z.src)});const X=localStorage.getItem(jc),F=localStorage.getItem(Lc);if(!X||!F){const V=window.innerWidth,oe=window.innerHeight,de=V*.95,Z=oe*.95;let Q=B.naturalWidth+20,j=B.naturalHeight+100;if(Q>de||j>Z){const fe=Math.min((de-20)/B.naturalWidth,(Z-100)/B.naturalHeight);Q=B.naturalWidth*fe+20,j=B.naturalHeight*fe+100}Q=Math.max(Q,800),j=Math.max(j,456),v({width:Q,height:j}),_({x:(V-Q)/2,y:(oe-j)/2})}if(E.current){const{width:Y,height:K}=E.current.getBoundingClientRect(),V=Y-20,oe=K-20;if(V>0&&oe>0){const de=V/B.naturalWidth,Z=oe/B.naturalHeight,Q=Math.min(de,Z);A(Math.min(Q,1))}else A(1)}else A(1);P({x:0,y:0})},B.src=z.src},[z]);const D=()=>{d(Cg())},G=B=>{B.stopPropagation(),g(!h)},q=B=>{B==null||B.stopPropagation(),T(X=>X>0?X-1:e.length-1)},ie=B=>{B==null||B.stopPropagation(),T(X=>X<e.length-1?X+1:0)},te=()=>{A(1),P({x:0,y:0})};x.useEffect(()=>{const B=X=>{X.stopPropagation(),X.key==="ArrowLeft"?q():X.key==="ArrowRight"?ie():X.key==="Escape"&&r()};return window.addEventListener("keydown",B,!0),()=>{window.removeEventListener("keydown",B,!0)}},[r,e.length]);const ye=B=>{B.target.closest("button")||(D(),B.preventDefault(),B.stopPropagation(),!h&&(B.currentTarget.setPointerCapture(B.pointerId),I.current={offset:{x:B.clientX-m.x,y:B.clientY-m.y}}))},ue=B=>{if(!I.current)return;const X=B.clientX-I.current.offset.x,F=B.clientY-I.current.offset.y;_({x:X,y:F})},$=B=>{I.current=null,B.currentTarget.releasePointerCapture(B.pointerId),localStorage.setItem(jc,JSON.stringify(b.current))},ee=()=>{if(R.current&&!h){const B=R.current.getBoundingClientRect(),X={width:B.width,height:B.height};v(X),localStorage.setItem(Lc,JSON.stringify(X))}},Te=B=>{if(B.stopPropagation(),!E.current)return;const X=Math.pow(1.0005,-B.deltaY),F=Math.max(.1,Math.min(10,N*X)),Y=E.current.getBoundingClientRect(),K=B.clientX-Y.left,V=B.clientY-Y.top,oe=K-Y.width/2,de=V-Y.height/2,Z=F/N,Q=oe-(oe-k.x)*Z,j=de-(de-k.y)*Z;A(F),P({x:Q,y:j})},le=()=>{if(!E.current||O.width===0)return!1;const{width:B,height:X}=E.current.getBoundingClientRect(),F=O.width*N,Y=O.height*N;return F>B||Y>X},J=N>1||le(),ge=B=>{D(),(J||B.button===1)&&(B.preventDefault(),B.stopPropagation(),H(!0),W.current={x:B.clientX-k.x,y:B.clientY-k.y},window.addEventListener("mousemove",ae),window.addEventListener("mouseup",ce))},ae=B=>{W.current&&(B.preventDefault(),B.stopPropagation(),P({x:B.clientX-W.current.x,y:B.clientY-W.current.y}))},ce=()=>{H(!1),W.current=null,window.removeEventListener("mousemove",ae),window.removeEventListener("mouseup",ce)};return x.useEffect(()=>()=>{window.removeEventListener("mousemove",ae),window.removeEventListener("mouseup",ce)},[]),z?o.jsxs("div",{ref:R,className:`fixed bg-gray-800 rounded-lg shadow-2xl border-2 border-gray-700 flex flex-col group transition-opacity duration-300 ease-out ${C?"opacity-100":"opacity-0"}`,style:h?{zIndex:c,left:0,top:0,width:"100%",height:"100%",maxWidth:"100vw",maxHeight:"100vh",borderRadius:0,border:"none"}:{zIndex:c,left:m.x,top:m.y,width:y.width,height:y.height,maxWidth:"98vw",maxHeight:"98vh",minWidth:"800px",minHeight:"456px",resize:"both",overflow:"hidden"},onMouseDown:B=>{B.stopPropagation(),D()},onMouseUp:ee,children:[o.jsxs("div",{onPointerDown:ye,onPointerMove:ue,onPointerUp:$,className:"bg-gray-700 text-white font-bold p-2 rounded-t-md flex justify-between items-center cursor-move flex-shrink-0",children:[o.jsxs("span",{children:[l("imageViewer.title")," - Frame ",z.frameNumber]}),o.jsxs("div",{className:"flex items-center space-x-1",children:[o.jsx(Ie,{title:"Copy Image",onClick:B=>{B.stopPropagation(),i(z.src)},children:o.jsx(Wo,{className:"h-5 w-5"})}),o.jsx(Ie,{title:"Download Image",onClick:B=>{B.stopPropagation(),a(z.src,z.frameNumber,z.prompt||"")},children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}),o.jsx("div",{className:"w-px h-4 bg-gray-500 mx-1"}),o.jsx("button",{onClick:G,className:"p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white transition-colors",title:h?"Restore":"Full Screen",children:h?o.jsx(Ly,{}):o.jsx(jy,{})}),o.jsx("button",{onClick:B=>{B.stopPropagation(),r()},className:"p-1 text-gray-400 rounded-full hover:bg-gray-600 hover:text-white",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),o.jsxs("div",{ref:E,className:"p-1 flex-grow min-h-0 bg-gray-900 relative overflow-hidden flex items-center justify-center",onWheel:Te,onMouseDown:ge,children:[o.jsx("img",{src:z.src,alt:`Full-size view of frame ${z.frameNumber}`,className:"shrink-0",style:{width:O.width||"auto",height:O.height||"auto",maxWidth:"none",maxHeight:"none",transform:`translate(${k.x}px, ${k.y}px) scale(${N})`,cursor:J?M?"grabbing":"grab":"default",pointerEvents:"auto",transformOrigin:"center"},draggable:!1,onMouseDown:B=>B.preventDefault()}),o.jsxs("div",{className:"absolute bottom-12 left-1/2 -translate-x-1/2 bg-gray-800/90 backdrop-blur-sm p-2 rounded-full flex items-center space-x-3 border border-gray-600 shadow-lg z-20",onMouseDown:B=>B.stopPropagation(),children:[o.jsx("button",{onClick:te,className:"w-8 h-8 rounded-full bg-gray-700 hover:bg-gray-600 text-xs font-bold text-white flex items-center justify-center border border-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500",title:"Reset to 100% (Actual Size)",children:"1:1"}),o.jsx("input",{type:"range",min:"0.1",max:"5",step:"0.01",value:N,onChange:B=>A(parseFloat(B.target.value)),className:"w-32 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),o.jsxs("span",{className:"text-xs font-mono text-gray-300 w-12 text-right",children:[Math.round(N*100),"%"]})]}),e.length>1&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:q,className:"absolute left-4 top-1/2 -translate-y-1/2 p-2 bg-black/40 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity focus:outline-none focus:ring-2 focus:ring-cyan-500 z-10","aria-label":"Previous image",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),o.jsx("button",{onClick:ie,className:"absolute right-4 top-1/2 -translate-y-1/2 p-2 bg-black/40 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity focus:outline-none focus:ring-2 focus:ring-cyan-500 z-10","aria-label":"Next image",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]})]}),o.jsxs("div",{className:"bg-gray-800 text-gray-400 text-xs px-3 py-1 border-t border-gray-700 flex justify-between items-center rounded-b-lg select-none",children:[o.jsx("div",{children:O.width>0&&o.jsxs("span",{children:[O.width," x ",O.height," px"]})}),s&&o.jsx("button",{onClick:B=>{B.stopPropagation(),s(z.src)},className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors font-semibold",children:l("node.action.editor")}),o.jsx("div",{children:O.size&&o.jsx("span",{children:O.size})})]})]}):(r(),null)},rP=({children:e})=>{const[t,n]=x.useState("en"),r=x.useCallback((a,i)=>Tw(t,a,i),[t]);return o.jsx(Of.Provider,{value:{language:t,setLanguage:n,t:r},children:e})},aP=()=>{const e=or();if(!e)return null;const{tabs:t,activeTabIndex:n,switchTab:r,addTab:a,closeTab:i,renameTab:s,nodes:l,t:c,isSnapToGrid:d,setIsSnapToGrid:h,lineStyle:g,setLineStyle:m,viewTransform:_,fileInputRef:y,handleFileChange:v,catalogFileInputRef:C,handleCatalogFileChange:w,libraryFileInputRef:b,handleLibraryFileChange:f,isQuickSearchOpen:T,handleCloseAddNodeMenus:I,onAddNode:E,isQuickAddOpen:R,quickAddPosition:N,setActiveTool:A,isRadialMenuOpen:k,radialMenuPosition:P,openRadialMenu:M,isContextMenuOpen:H,contextMenuPosition:W,contextMenuSlots:O,setContextMenuSlot:U,openContextMenu:z,closeContextMenu:L,isContextMenuPinned:D,isCatalogOpen:G,onOpenCatalog:q,currentCatalogItems:ie,catalogPath:te,navigateCatalogBack:ye,navigateCatalogToFolder:ue,createCatalogItem:$,handleAddGroupFromCatalog:ee,handleRenameCatalogItem:Te,saveCatalogItemToDisk:le,handleDeleteCatalogItem:J,triggerLoadFromFile:ge,moveCatalogItem:ae,currentLibraryItems:ce,libraryItems:B,libraryPath:X,navigateBack:F,navigateToFolder:Y,createLibraryItem:K,updateLibraryItem:V,deleteLibraryItem:oe,saveLibraryItemToDisk:de,triggerLoadLibraryFromFile:Z,moveLibraryItem:Q,setPromptEditInfo:j,renameInfo:fe,confirmRename:Pe,setRenameInfo:je,promptEditInfo:ke,confirmPromptEdit:$e,confirmInfo:ze,setConfirmInfo:nt,error:at,handleCopyError:xe,isErrorCopied:he,setError:Ge,showDialog:me,requestPermission:Oe,declinePermission:De,effectiveTool:Ce,handleSaveCanvas:Qe,handleSaveProject:pe,handleLoadCanvas:Se,openQuickSearchMenu:Ee,openQuickAddMenu:Fe,handleClearCanvas:be,handleResetToDefault:_e,clearProject:Ue,clientPointerPosition:We,selectedNodeIds:gt,deselectAllNodes:Et,toasts:It,removeToast:Mt,addToast:xt,activeCategory:Ft,setActiveCategory:cn,connectionMenu:Bt,setConnectionMenu:en,handleAddNodeFromConnectionMenu:ve,handleAddNodeFromToolbar:Be,translateGraph:Je,imageViewerState:it,setImageViewer:ct,onDownloadImage:jt,onCopyImageToClipboard:Nn}=e,[Kt,re]=x.useState(!1),[Le,Re]=x.useState(!1),[Ke,dt]=x.useState(!1),[rt,St]=x.useState(!1),[Pt,Gt]=x.useState(()=>!!(localStorage.getItem("gemini-api-key")||localStorage.getItem("gemini-use-free-key")==="true")),[se,Me]=x.useState(()=>{const st=localStorage.getItem("gemini-use-free-key")==="true",tt=localStorage.getItem("gemini-api-key");return{hasApiKey:st||!!tt&&tt.trim()!=="",useFreeKey:st}}),[Ae,et]=x.useState(null);x.useEffect(()=>{const st=localStorage.getItem("gemini-api-key"),Dt=localStorage.getItem("gemini-use-free-key")==="true";!Pt&&!st&&!Dt?Re(!0):!se.hasApiKey&&Pt&&re(!0)},[Pt]),x.useEffect(()=>{const st=()=>{St(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",st),()=>{document.removeEventListener("fullscreenchange",st)}},[]);const pt=()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen().catch(st=>{console.error(`Error attempting to enable full-screen mode: ${st.message} (${st.name})`)})},Lt=(st,tt)=>{const Dt=st.trim();localStorage.setItem("gemini-use-free-key",tt?"true":"false"),tt?localStorage.removeItem("gemini-api-key"):Dt&&localStorage.setItem("gemini-api-key",Dt);const un=localStorage.getItem("gemini-api-key"),vt=localStorage.getItem("gemini-use-free-key")==="true",Po=vt||!!un&&un.length>0;Me({hasApiKey:Po,useFreeKey:vt}),Le&&(Pt||_e(!0),Re(!1),Gt(!0)),re(!1),setTimeout(()=>{Je()},50),(Dt||tt)&&xt(c("toast.apiKeySaved"),"success")},sn=()=>{localStorage.removeItem("gemini-api-key"),localStorage.removeItem("gemini-use-free-key"),Me({hasApiKey:!1,useFreeKey:!1}),xt(c("toast.apiKeyCleared"),"info")},Zt=x.useCallback(()=>{I(),et(null)},[I]),On=x.useCallback(st=>{et(null),M(st)},[M]),xn=x.useCallback(st=>{const tt={x:(W.x-_.translate.x)/_.scale,y:(W.y-_.translate.y)/_.scale};E(st,tt,void 0)},[W,_,E]),Cn=x.useCallback(()=>{en(null)},[en]);x.useEffect(()=>{const st=tt=>{const Dt=tt.target,un=Dt.tagName==="INPUT"||Dt.tagName==="TEXTAREA";if((tt.ctrlKey||tt.metaKey)&&!un){if(tt.code==="KeyS"){tt.preventDefault(),Qe();return}if(tt.code==="KeyO"){tt.preventDefault(),Se();return}}if(tt.code==="Space"&&!tt.repeat&&!un){tt.ctrlKey?(tt.preventDefault(),q()):R||(tt.preventDefault(),Fe(We));return}if(tt.code==="KeyF"&&!tt.shiftKey&&!tt.ctrlKey&&!tt.metaKey&&!tt.altKey&&!un){tt.preventDefault(),T||Ee(We);return}if(un||tt.repeat)return;let vt=null;if(tt.shiftKey&&!tt.ctrlKey&&!tt.metaKey&&!tt.altKey)switch(tt.code){case"KeyC":vt=S.CHARACTER_GENERATOR;break;case"KeyS":vt=S.SCRIPT_GENERATOR;break;case"KeyD":vt=S.SCRIPT_ANALYZER;break;case"KeyF":vt=S.SCRIPT_PROMPT_MODIFIER;break;case"KeyR":vt=S.DATA_READER;break;case"KeyG":vt=S.NARRATOR_TEXT_GENERATOR;break;case"KeyN":vt=S.SPEECH_SYNTHESIZER;break;case"KeyB":vt=S.AUDIO_TRANSCRIBER;break;case"KeyT":vt=S.YOUTUBE_TITLE_GENERATOR;break;case"KeyY":vt=S.YOUTUBE_ANALYTICS;break;case"KeyM":vt=S.MUSIC_IDEA_GENERATOR;break}else if(!tt.shiftKey&&!tt.ctrlKey&&!tt.metaKey&&!tt.altKey)switch(tt.code){case"KeyT":vt=S.TEXT_INPUT;break;case"KeyA":vt=S.PROMPT_ANALYZER;break;case"KeyP":vt=S.PROMPT_PROCESSOR;break;case"KeyM":vt=S.GEMINI_CHAT;break;case"KeyL":vt=S.TRANSLATOR;break;case"KeyN":vt=S.NOTE;break;case"KeyO":vt=S.IMAGE_GENERATOR;break;case"KeyI":vt=S.IMAGE_PREVIEW;break}if(vt){tt.preventDefault();const Pr=Ti(vt,c).width,qa=40,ea={x:(We.x-_.translate.x)/_.scale,y:(We.y-_.translate.y)/_.scale},Ka={x:ea.x-Pr/2,y:ea.y-qa/2};E(vt,Ka,void 0)}};return window.addEventListener("keydown",st),()=>window.removeEventListener("keydown",st)},[T,R,q,Ee,Fe,We,E,_.scale,_.translate.x,_.translate.y,c,Qe,Se]);const xo=x.useCallback(st=>{const Dt=Ti(st,c).width,un=40,vt={x:(N.x-_.translate.x)/_.scale,y:(N.y-_.translate.y)/_.scale},Po={x:vt.x-Dt/2,y:vt.y-un/2};E(st,Po,void 0)},[N,_,E,c]),vo=x.useCallback(st=>{const Dt=Ti(st,c).width,un=40,vt={x:(P.x-_.translate.x)/_.scale,y:(P.y-_.translate.y)/_.scale},Po={x:vt.x-Dt/2,y:vt.y-un/2};E(st,Po,void 0)},[P,_,E,c]);x.useEffect(()=>{const st=Dt=>{const un=Dt.target;un.tagName==="INPUT"||un.tagName==="TEXTAREA"||Dt.key==="Tab"&&(Dt.preventDefault(),k||On(We))},tt=Dt=>{Dt.key==="Tab"&&k&&(Dt.preventDefault(),Ae&&vo(Ae),Zt())};return window.addEventListener("keydown",st),window.addEventListener("keyup",tt),()=>{window.removeEventListener("keydown",st),window.removeEventListener("keyup",tt)}},[k,Ae,On,Zt,vo,We]);const Ir=st=>{const tt=B.find(Dt=>Dt.id===st);tt&&j(tt)},rr=()=>{if(!fe)return"";switch(fe.type){case"group":return c("dialog.rename.group.title");case"catalog":return c("dialog.rename.catalog.title");case"node":return c("dialog.rename.title");default:return c("dialog.rename.title")}},$a=()=>{t.some(tt=>tt.nodes.length>0)||l.length>0?nt({title:c("dialog.exit.title"),message:c("dialog.exit.message"),onConfirm:()=>{Ue(),Re(!0),Gt(!1)}}):(Re(!0),Gt(!1))},Wa=(st,tt,Dt)=>{const un=`Image_${tt}_${Dt.slice(0,10).replace(/\s+/g,"_")}.png`;jt(st.startsWith("data:")?st.split(",")[1]:st,un)},Ya=async st=>{const tt=st.startsWith("data:")?st.split(",")[1]:st;await Nn(tt),xt(c("toast.copied"),"success")};return o.jsx("div",{className:"w-screen h-screen overflow-hidden bg-gray-900 flex flex-col",children:o.jsxs(kI,{children:[o.jsx(WI,{}),o.jsxs("div",{className:"absolute bottom-2 right-2 z-50 text-[10px] text-gray-600 pointer-events-none flex flex-col items-end select-none",children:[o.jsx("span",{children:"Author: MeowMaster"}),o.jsx("span",{children:"Email: MeowMasterart@gmail.com"}),o.jsx("a",{href:"https://www.netlify.com",target:"_blank",rel:"noopener noreferrer",className:"pointer-events-auto hover:text-emerald-400 transition-colors mt-1",children:"Powered by Netlify"})]}),o.jsx($I,{toasts:It,removeToast:Mt}),o.jsx(UI,{isOpen:me,onAllow:Oe,onDecline:De}),o.jsx(qI,{isOpen:Le,onSave:Lt,isFirstRun:!Pt}),o.jsx(YI,{isOpen:Kt,onSave:Lt,onClose:()=>re(!1),onClear:sn,hasExistingKey:se.hasApiKey,initialUseFreeKey:se.useFreeKey}),it&&o.jsx(oP,{sources:it.sources,initialIndex:it.initialIndex,initialPosition:{x:window.innerWidth/2-400,y:window.innerHeight/2-300},onClose:()=>ct(null),onDownloadImageFromUrl:Wa,onCopyImageToClipboard:Ya}),o.jsx("input",{type:"file",ref:y,onChange:v,accept:".json,application/json,.SMC,.SMP,.CHAR",className:"hidden"}),o.jsx("input",{type:"file",ref:C,onChange:w,accept:".json,application/json",className:"hidden"}),o.jsx("input",{type:"file",ref:b,onChange:f,accept:".json,application/json",className:"hidden"}),o.jsx(PI,{isOpen:T,onClose:Zt,onAddNode:xo}),o.jsx(MI,{isOpen:R,position:N,onClose:Zt,onAddNode:xo,onToolChange:A}),o.jsx(LI,{isOpen:k,position:P,onClose:Zt,onAddNode:vo,onSelectItem:et}),o.jsx(QI,{isOpen:H,position:W,onClose:L,onAddNode:xn,slots:O,onAssignSlot:U,activeTool:Ce,onToolChange:A}),o.jsx(eP,{isOpen:!!(Bt!=null&&Bt.isOpen),position:(Bt==null?void 0:Bt.position)||{x:0,y:0},fromType:(Bt==null?void 0:Bt.fromType)||null,onClose:Cn,onSelect:ve}),o.jsx(zI,{isOpen:G,onClose:q,currentCatalogItems:ie,catalogPath:te,onCatalogNavigateBack:ye,onCatalogNavigateToFolder:ue,onCreateCatalogFolder:()=>$(Ze.FOLDER),onAddGroupFromCatalog:ee,onRenameCatalogItem:Te,onSaveCatalogItem:le,onDeleteCatalogItem:J,onLoadCatalogItemFromFile:ge,onMoveCatalogItem:ae,libraryItems:ce,libraryPath:X,onNavigateBack:F,onNavigateToFolder:Y,onCreateLibraryItem:K,onEditLibraryItem:Ir,onRenameLibraryItem:(st,tt)=>je({type:"library",id:st,currentTitle:tt}),onDeleteLibraryItem:oe,onSaveLibraryItem:de,onLoadLibraryItemFromFile:Z,onMoveLibraryItem:Q,activeCategory:Ft,setActiveCategory:cn}),o.jsx(DI,{isOpen:!!fe,initialValue:(fe==null?void 0:fe.currentTitle)||"",onConfirm:Pe,onClose:()=>je(null),title:rr(),label:c("dialog.rename.label"),confirmButtonText:c("dialog.rename.confirm"),cancelButtonText:c("dialog.rename.cancel"),deselectAllNodes:Et}),o.jsx(VI,{isOpen:!!ke,initialName:(ke==null?void 0:ke.name)||"",initialContent:(ke==null?void 0:ke.content)||"",onConfirm:$e,onClose:()=>j(null),deselectAllNodes:Et}),o.jsx(HI,{isOpen:!!ze,onClose:()=>nt(null),onConfirm:()=>{ze==null||ze.onConfirm(),nt(null)},title:(ze==null?void 0:ze.title)||"",message:(ze==null?void 0:ze.message)||""}),at&&o.jsxs("div",{className:"absolute top-16 left-1/2 -translate-x-1/2 z-30 bg-blue-900/95 p-4 rounded-lg border border-blue-500 flex items-start space-x-4 max-w-md shadow-xl backdrop-blur-md",children:[o.jsxs("div",{className:"flex-grow text-blue-100",children:[o.jsx("p",{className:"font-bold text-blue-50 mb-1",children:c("app.error.title")}),o.jsx("p",{className:"text-sm text-blue-100",children:c(at)})]}),o.jsxs("div",{className:"flex flex-col space-y-1 flex-shrink-0",children:[o.jsx("button",{onClick:()=>Ge(null),className:"p-1 text-blue-300 rounded-full hover:bg-blue-700/50 hover:text-white transition-colors","aria-label":c("node.action.close"),title:c("node.action.close"),children:o.jsx(_l,{className:"h-5 w-5"})}),o.jsx("button",{onClick:xe,className:"p-1 text-blue-300 rounded-full hover:bg-blue-700/50 hover:text-white transition-colors","aria-label":c("app.error.copy"),title:c(he?"app.error.copied":"app.error.copy"),children:he?o.jsx(HA,{className:"h-5 w-5 text-emerald-400"}):o.jsx(Wo,{className:"h-5 w-5"})})]})]}),o.jsx(II,{activeTool:Ce,onToolChange:A,onAddNode:Be,onSaveCanvas:Qe,onSaveProject:pe,onLoadCanvas:Se,onOpenSearch:()=>Ee(We),onOpenCatalog:q,viewTransform:_,setZoom:e.setZoom,isSnapToGrid:d,setIsSnapToGrid:h,lineStyle:g,setLineStyle:m,handleClearCanvas:be}),o.jsx("div",{className:"absolute top-2 left-2 z-20 flex items-center",children:o.jsxs("div",{className:`flex items-center p-1 ${Ke?"gap-0":"gap-1"} rounded-lg border border-gray-700 shadow-lg bg-gray-900/50 backdrop-blur-md`,children:[o.jsx(lt,{title:c(Ke?"toolbar.expand":"toolbar.collapse"),position:"right",children:o.jsx("button",{onClick:()=>dt(!Ke),className:"h-9 w-9 flex-shrink-0 flex items-center justify-center rounded-md hover:bg-emerald-600 bg-gray-700 text-gray-300 hover:text-white transition-colors",children:Ke?o.jsx(BA,{className:"h-5 w-5"}):o.jsx(VA,{className:"h-5 w-5"})})}),!Ke&&o.jsxs("div",{className:"flex items-center gap-1 whitespace-nowrap",children:[o.jsx(lt,{title:c("toolbar.home"),position:"bottom",children:o.jsx("button",{onClick:()=>Re(!0),className:"p-1.5 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-emerald-600 text-gray-300 hover:text-white",children:o.jsx($A,{className:"h-5 w-5"})})}),o.jsx(BI,{}),o.jsx(lt,{title:c("dialog.apiKey.title"),position:"bottom",children:o.jsx("button",{onClick:()=>re(!0),className:"p-1.5 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-emerald-600 text-gray-300 hover:text-white",children:o.jsx(WA,{className:"h-5 w-5"})})}),o.jsx(lt,{title:c("toolbar.resetToDefault"),position:"bottom",children:o.jsx("button",{onClick:()=>_e(!1),className:"p-1.5 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-emerald-600 text-gray-300 hover:text-white",children:o.jsx(Dy,{className:"h-5 w-5"})})}),o.jsx(lt,{title:c(rt?"toolbar.exitFullscreen":"toolbar.enterFullscreen"),position:"bottom",children:o.jsx("button",{onClick:pt,className:"p-1.5 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-emerald-600 text-gray-300 hover:text-white",children:rt?o.jsx(Ly,{className:"h-5 w-5"}):o.jsx(jy,{className:"h-5 w-5"})})}),o.jsx(GI,{}),o.jsxs("div",{className:"flex items-center h-9 gap-1",children:[o.jsx(XI,{tabs:t,activeTabIndex:n,onTabClick:r,onCloseTab:i,onRenameTab:s}),o.jsx(lt,{title:"Add new tab",position:"bottom",className:"h-full",children:o.jsx("button",{onClick:a,className:"flex items-center justify-center h-full w-9 text-gray-300 hover:bg-emerald-600 bg-gray-700 rounded-md transition-colors hover:text-white",children:o.jsx(Oy,{className:"h-5 w-5"})})})]}),o.jsxs("div",{className:"flex items-center justify-start pl-3 pr-2 h-full",children:[o.jsx("div",{className:"mr-3 text-emerald-400",children:o.jsx(YA,{className:"w-5 h-5"})}),o.jsx("div",{className:"text-left",children:o.jsx("h1",{className:"text-lg font-bold text-emerald-400 select-none leading-tight",children:c("app.title")})})]}),o.jsx(KI,{}),o.jsx(lt,{title:c("toolbar.closeProject"),position:"bottom",children:o.jsx("button",{onClick:$a,className:"p-1.5 rounded-md transition-colors duration-200 focus:outline-none flex items-center justify-center h-9 w-9 bg-gray-700 hover:bg-red-600 text-gray-300 hover:text-white",children:o.jsx(qA,{className:"h-5 w-5"})})})]})]})})]})})},iP=()=>o.jsx(rP,{children:o.jsx(RA,{children:o.jsx(aP,{})})}),zy=document.getElementById("root");if(!zy)throw new Error("Could not find root element to mount to");const sP=Dc.createRoot(zy);sP.render(o.jsx(_t.StrictMode,{children:o.jsx(iP,{})}));
